var Lm=Object.defineProperty;var Im=(n,i,a)=>i in n?Lm(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var Re=(n,i,a)=>(Im(n,typeof i!="symbol"?i+"":i,a),a);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(e){if(e.ep)return;e.ep=!0;const r=a(e);fetch(e.href,r)}})();function Vm(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ip={exports:{}},nc={},Vp={exports:{}},Pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nl=Symbol.for("react.element"),Nm=Symbol.for("react.portal"),Fm=Symbol.for("react.fragment"),Om=Symbol.for("react.strict_mode"),zm=Symbol.for("react.profiler"),Um=Symbol.for("react.provider"),km=Symbol.for("react.context"),Gm=Symbol.for("react.forward_ref"),Hm=Symbol.for("react.suspense"),Wm=Symbol.for("react.memo"),Qm=Symbol.for("react.lazy"),Yf=Symbol.iterator;function Xm(n){return n===null||typeof n!="object"?null:(n=Yf&&n[Yf]||n["@@iterator"],typeof n=="function"?n:null)}var Np={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Fp=Object.assign,Op={};function Ho(n,i,a){this.props=n,this.context=i,this.refs=Op,this.updater=a||Np}Ho.prototype.isReactComponent={};Ho.prototype.setState=function(n,i){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,i,"setState")};Ho.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function zp(){}zp.prototype=Ho.prototype;function b_(n,i,a){this.props=n,this.context=i,this.refs=Op,this.updater=a||Np}var D_=b_.prototype=new zp;D_.constructor=b_;Fp(D_,Ho.prototype);D_.isPureReactComponent=!0;var qf=Array.isArray,Up=Object.prototype.hasOwnProperty,L_={current:null},kp={key:!0,ref:!0,__self:!0,__source:!0};function Gp(n,i,a){var t,e={},r=null,o=null;if(i!=null)for(t in i.ref!==void 0&&(o=i.ref),i.key!==void 0&&(r=""+i.key),i)Up.call(i,t)&&!kp.hasOwnProperty(t)&&(e[t]=i[t]);var s=arguments.length-2;if(s===1)e.children=a;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];e.children=l}if(n&&n.defaultProps)for(t in s=n.defaultProps,s)e[t]===void 0&&(e[t]=s[t]);return{$$typeof:nl,type:n,key:r,ref:o,props:e,_owner:L_.current}}function jm(n,i){return{$$typeof:nl,type:n.type,key:i,ref:n.ref,props:n.props,_owner:n._owner}}function I_(n){return typeof n=="object"&&n!==null&&n.$$typeof===nl}function Ym(n){var i={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(a){return i[a]})}var Jf=/\/+/g;function Vc(n,i){return typeof n=="object"&&n!==null&&n.key!=null?Ym(""+n.key):i.toString(36)}function Jl(n,i,a,t,e){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case nl:case Nm:o=!0}}if(o)return o=n,e=e(o),n=t===""?"."+Vc(o,0):t,qf(e)?(a="",n!=null&&(a=n.replace(Jf,"$&/")+"/"),Jl(e,i,a,"",function(u){return u})):e!=null&&(I_(e)&&(e=jm(e,a+(!e.key||o&&o.key===e.key?"":(""+e.key).replace(Jf,"$&/")+"/")+n)),i.push(e)),1;if(o=0,t=t===""?".":t+":",qf(n))for(var s=0;s<n.length;s++){r=n[s];var l=t+Vc(r,s);o+=Jl(r,i,a,l,e)}else if(l=Xm(n),typeof l=="function")for(n=l.call(n),s=0;!(r=n.next()).done;)r=r.value,l=t+Vc(r,s++),o+=Jl(r,i,a,l,e);else if(r==="object")throw i=String(n),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return o}function yl(n,i,a){if(n==null)return n;var t=[],e=0;return Jl(n,t,"","",function(r){return i.call(a,r,e++)}),t}function qm(n){if(n._status===-1){var i=n._result;i=i(),i.then(function(a){(n._status===0||n._status===-1)&&(n._status=1,n._result=a)},function(a){(n._status===0||n._status===-1)&&(n._status=2,n._result=a)}),n._status===-1&&(n._status=0,n._result=i)}if(n._status===1)return n._result.default;throw n._result}var yn={current:null},Zl={transition:null},Jm={ReactCurrentDispatcher:yn,ReactCurrentBatchConfig:Zl,ReactCurrentOwner:L_};Pe.Children={map:yl,forEach:function(n,i,a){yl(n,function(){i.apply(this,arguments)},a)},count:function(n){var i=0;return yl(n,function(){i++}),i},toArray:function(n){return yl(n,function(i){return i})||[]},only:function(n){if(!I_(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Pe.Component=Ho;Pe.Fragment=Fm;Pe.Profiler=zm;Pe.PureComponent=b_;Pe.StrictMode=Om;Pe.Suspense=Hm;Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jm;Pe.cloneElement=function(n,i,a){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var t=Fp({},n.props),e=n.key,r=n.ref,o=n._owner;if(i!=null){if(i.ref!==void 0&&(r=i.ref,o=L_.current),i.key!==void 0&&(e=""+i.key),n.type&&n.type.defaultProps)var s=n.type.defaultProps;for(l in i)Up.call(i,l)&&!kp.hasOwnProperty(l)&&(t[l]=i[l]===void 0&&s!==void 0?s[l]:i[l])}var l=arguments.length-2;if(l===1)t.children=a;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];t.children=s}return{$$typeof:nl,type:n.type,key:e,ref:r,props:t,_owner:o}};Pe.createContext=function(n){return n={$$typeof:km,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Um,_context:n},n.Consumer=n};Pe.createElement=Gp;Pe.createFactory=function(n){var i=Gp.bind(null,n);return i.type=n,i};Pe.createRef=function(){return{current:null}};Pe.forwardRef=function(n){return{$$typeof:Gm,render:n}};Pe.isValidElement=I_;Pe.lazy=function(n){return{$$typeof:Qm,_payload:{_status:-1,_result:n},_init:qm}};Pe.memo=function(n,i){return{$$typeof:Wm,type:n,compare:i===void 0?null:i}};Pe.startTransition=function(n){var i=Zl.transition;Zl.transition={};try{n()}finally{Zl.transition=i}};Pe.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Pe.useCallback=function(n,i){return yn.current.useCallback(n,i)};Pe.useContext=function(n){return yn.current.useContext(n)};Pe.useDebugValue=function(){};Pe.useDeferredValue=function(n){return yn.current.useDeferredValue(n)};Pe.useEffect=function(n,i){return yn.current.useEffect(n,i)};Pe.useId=function(){return yn.current.useId()};Pe.useImperativeHandle=function(n,i,a){return yn.current.useImperativeHandle(n,i,a)};Pe.useInsertionEffect=function(n,i){return yn.current.useInsertionEffect(n,i)};Pe.useLayoutEffect=function(n,i){return yn.current.useLayoutEffect(n,i)};Pe.useMemo=function(n,i){return yn.current.useMemo(n,i)};Pe.useReducer=function(n,i,a){return yn.current.useReducer(n,i,a)};Pe.useRef=function(n){return yn.current.useRef(n)};Pe.useState=function(n){return yn.current.useState(n)};Pe.useSyncExternalStore=function(n,i,a){return yn.current.useSyncExternalStore(n,i,a)};Pe.useTransition=function(){return yn.current.useTransition()};Pe.version="18.2.0";Vp.exports=Pe;var V_=Vp.exports;const Hp=Vm(V_);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zm=V_,Km=Symbol.for("react.element"),$m=Symbol.for("react.fragment"),ey=Object.prototype.hasOwnProperty,ty=Zm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ny={key:!0,ref:!0,__self:!0,__source:!0};function Wp(n,i,a){var t,e={},r=null,o=null;a!==void 0&&(r=""+a),i.key!==void 0&&(r=""+i.key),i.ref!==void 0&&(o=i.ref);for(t in i)ey.call(i,t)&&!ny.hasOwnProperty(t)&&(e[t]=i[t]);if(n&&n.defaultProps)for(t in i=n.defaultProps,i)e[t]===void 0&&(e[t]=i[t]);return{$$typeof:Km,type:n,key:r,ref:o,props:e,_owner:ty.current}}nc.Fragment=$m;nc.jsx=Wp;nc.jsxs=Wp;Ip.exports=nc;var hd=Ip.exports,Qp={exports:{}},Jn={},Xp={exports:{}},jp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function i(D,N){var O=D.length;D.push(N);e:for(;0<O;){var k=O-1>>>1,Q=D[k];if(0<e(Q,N))D[k]=N,D[O]=Q,O=k;else break e}}function a(D){return D.length===0?null:D[0]}function t(D){if(D.length===0)return null;var N=D[0],O=D.pop();if(O!==N){D[0]=O;e:for(var k=0,Q=D.length,H=Q>>>1;k<H;){var ee=2*(k+1)-1,ge=D[ee],le=ee+1,re=D[le];if(0>e(ge,O))le<Q&&0>e(re,ge)?(D[k]=re,D[le]=O,k=le):(D[k]=ge,D[ee]=O,k=ee);else if(le<Q&&0>e(re,O))D[k]=re,D[le]=O,k=le;else break e}}return N}function e(D,N){var O=D.sortIndex-N.sortIndex;return O!==0?O:D.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,s=o.now();n.unstable_now=function(){return o.now()-s}}var l=[],u=[],c=1,d=null,_=3,f=!1,v=!1,p=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(D){for(var N=a(u);N!==null;){if(N.callback===null)t(u);else if(N.startTime<=D)t(u),N.sortIndex=N.expirationTime,i(l,N);else break;N=a(u)}}function A(D){if(p=!1,y(D),!v)if(a(l)!==null)v=!0,L(S);else{var N=a(u);N!==null&&F(A,N.startTime-D)}}function S(D,N){v=!1,p&&(p=!1,m(E),E=-1),f=!0;var O=_;try{for(y(N),d=a(l);d!==null&&(!(d.expirationTime>N)||D&&!R());){var k=d.callback;if(typeof k=="function"){d.callback=null,_=d.priorityLevel;var Q=k(d.expirationTime<=N);N=n.unstable_now(),typeof Q=="function"?d.callback=Q:d===a(l)&&t(l),y(N)}else t(l);d=a(l)}if(d!==null)var H=!0;else{var ee=a(u);ee!==null&&F(A,ee.startTime-N),H=!1}return H}finally{d=null,_=O,f=!1}}var x=!1,C=null,E=-1,T=5,w=-1;function R(){return!(n.unstable_now()-w<T)}function b(){if(C!==null){var D=n.unstable_now();w=D;var N=!0;try{N=C(!0,D)}finally{N?B():(x=!1,C=null)}}else x=!1}var B;if(typeof h=="function")B=function(){h(b)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,V=I.port2;I.port1.onmessage=b,B=function(){V.postMessage(null)}}else B=function(){g(b,0)};function L(D){C=D,x||(x=!0,B())}function F(D,N){E=g(function(){D(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_continueExecution=function(){v||f||(v=!0,L(S))},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return _},n.unstable_getFirstCallbackNode=function(){return a(l)},n.unstable_next=function(D){switch(_){case 1:case 2:case 3:var N=3;break;default:N=_}var O=_;_=N;try{return D()}finally{_=O}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(D,N){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var O=_;_=D;try{return N()}finally{_=O}},n.unstable_scheduleCallback=function(D,N,O){var k=n.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?k+O:k):O=k,D){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=O+Q,D={id:c++,callback:N,priorityLevel:D,startTime:O,expirationTime:Q,sortIndex:-1},O>k?(D.sortIndex=O,i(u,D),a(l)===null&&D===a(u)&&(p?(m(E),E=-1):p=!0,F(A,O-k))):(D.sortIndex=Q,i(l,D),v||f||(v=!0,L(S))),D},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(D){var N=_;return function(){var O=_;_=N;try{return D.apply(this,arguments)}finally{_=O}}}})(jp);Xp.exports=jp;var ry=Xp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yp=V_,jn=ry;function Y(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qp=new Set,Ps={};function Wa(n,i){Ro(n,i),Ro(n+"Capture",i)}function Ro(n,i){for(Ps[n]=i,n=0;n<i.length;n++)qp.add(i[n])}var Si=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vd=Object.prototype.hasOwnProperty,iy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zf={},Kf={};function ay(n){return vd.call(Kf,n)?!0:vd.call(Zf,n)?!1:iy.test(n)?Kf[n]=!0:(Zf[n]=!0,!1)}function oy(n,i,a,t){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return t?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function sy(n,i,a,t){if(i===null||typeof i>"u"||oy(n,i,a,t))return!0;if(t)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function An(n,i,a,t,e,r,o){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=t,this.attributeNamespace=e,this.mustUseProperty=a,this.propertyName=n,this.type=i,this.sanitizeURL=r,this.removeEmptyString=o}var Xt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Xt[n]=new An(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];Xt[i]=new An(i,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Xt[n]=new An(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Xt[n]=new An(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Xt[n]=new An(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Xt[n]=new An(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Xt[n]=new An(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Xt[n]=new An(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Xt[n]=new An(n,5,!1,n.toLowerCase(),null,!1,!1)});var N_=/[\-:]([a-z])/g;function F_(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(N_,F_);Xt[i]=new An(i,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(N_,F_);Xt[i]=new An(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(N_,F_);Xt[i]=new An(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Xt[n]=new An(n,1,!1,n.toLowerCase(),null,!1,!1)});Xt.xlinkHref=new An("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Xt[n]=new An(n,1,!1,n.toLowerCase(),null,!0,!0)});function O_(n,i,a,t){var e=Xt.hasOwnProperty(i)?Xt[i]:null;(e!==null?e.type!==0:t||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(sy(i,a,e,t)&&(a=null),t||e===null?ay(i)&&(a===null?n.removeAttribute(i):n.setAttribute(i,""+a)):e.mustUseProperty?n[e.propertyName]=a===null?e.type===3?!1:"":a:(i=e.attributeName,t=e.attributeNamespace,a===null?n.removeAttribute(i):(e=e.type,a=e===3||e===4&&a===!0?"":""+a,t?n.setAttributeNS(t,i,a):n.setAttribute(i,a))))}var Ri=Yp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Al=Symbol.for("react.element"),eo=Symbol.for("react.portal"),to=Symbol.for("react.fragment"),z_=Symbol.for("react.strict_mode"),pd=Symbol.for("react.profiler"),Jp=Symbol.for("react.provider"),Zp=Symbol.for("react.context"),U_=Symbol.for("react.forward_ref"),gd=Symbol.for("react.suspense"),md=Symbol.for("react.suspense_list"),k_=Symbol.for("react.memo"),Ii=Symbol.for("react.lazy"),Kp=Symbol.for("react.offscreen"),$f=Symbol.iterator;function Jo(n){return n===null||typeof n!="object"?null:(n=$f&&n[$f]||n["@@iterator"],typeof n=="function"?n:null)}var ut=Object.assign,Nc;function ls(n){if(Nc===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);Nc=i&&i[1]||""}return`
`+Nc+n}var Fc=!1;function Oc(n,i){if(!n||Fc)return"";Fc=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(u){var t=u}Reflect.construct(n,[],i)}else{try{i.call()}catch(u){t=u}n.call(i.prototype)}else{try{throw Error()}catch(u){t=u}n()}}catch(u){if(u&&t&&typeof u.stack=="string"){for(var e=u.stack.split(`
`),r=t.stack.split(`
`),o=e.length-1,s=r.length-1;1<=o&&0<=s&&e[o]!==r[s];)s--;for(;1<=o&&0<=s;o--,s--)if(e[o]!==r[s]){if(o!==1||s!==1)do if(o--,s--,0>s||e[o]!==r[s]){var l=`
`+e[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=s);break}}}finally{Fc=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?ls(n):""}function ly(n){switch(n.tag){case 5:return ls(n.type);case 16:return ls("Lazy");case 13:return ls("Suspense");case 19:return ls("SuspenseList");case 0:case 2:case 15:return n=Oc(n.type,!1),n;case 11:return n=Oc(n.type.render,!1),n;case 1:return n=Oc(n.type,!0),n;default:return""}}function yd(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case to:return"Fragment";case eo:return"Portal";case pd:return"Profiler";case z_:return"StrictMode";case gd:return"Suspense";case md:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Zp:return(n.displayName||"Context")+".Consumer";case Jp:return(n._context.displayName||"Context")+".Provider";case U_:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case k_:return i=n.displayName||null,i!==null?i:yd(n.type)||"Memo";case Ii:i=n._payload,n=n._init;try{return yd(n(i))}catch{}}return null}function uy(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yd(i);case 8:return i===z_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function ta(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function $p(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function cy(n){var i=$p(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),t=""+n[i];if(!n.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var e=a.get,r=a.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return e.call(this)},set:function(o){t=""+o,r.call(this,o)}}),Object.defineProperty(n,i,{enumerable:a.enumerable}),{getValue:function(){return t},setValue:function(o){t=""+o},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function xl(n){n._valueTracker||(n._valueTracker=cy(n))}function eg(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var a=i.getValue(),t="";return n&&(t=$p(n)?n.checked?"true":"false":n.value),n=t,n!==a?(i.setValue(n),!0):!1}function cu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Ad(n,i){var a=i.checked;return ut({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function eh(n,i){var a=i.defaultValue==null?"":i.defaultValue,t=i.checked!=null?i.checked:i.defaultChecked;a=ta(i.value!=null?i.value:a),n._wrapperState={initialChecked:t,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function tg(n,i){i=i.checked,i!=null&&O_(n,"checked",i,!1)}function xd(n,i){tg(n,i);var a=ta(i.value),t=i.type;if(a!=null)t==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(t==="submit"||t==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?Sd(n,i.type,a):i.hasOwnProperty("defaultValue")&&Sd(n,i.type,ta(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function th(n,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var t=i.type;if(!(t!=="submit"&&t!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,a||i===n.value||(n.value=i),n.defaultValue=i}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function Sd(n,i,a){(i!=="number"||cu(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var us=Array.isArray;function go(n,i,a,t){if(n=n.options,i){i={};for(var e=0;e<a.length;e++)i["$"+a[e]]=!0;for(a=0;a<n.length;a++)e=i.hasOwnProperty("$"+n[a].value),n[a].selected!==e&&(n[a].selected=e),e&&t&&(n[a].defaultSelected=!0)}else{for(a=""+ta(a),i=null,e=0;e<n.length;e++){if(n[e].value===a){n[e].selected=!0,t&&(n[e].defaultSelected=!0);return}i!==null||n[e].disabled||(i=n[e])}i!==null&&(i.selected=!0)}}function Cd(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(Y(91));return ut({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function nh(n,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(Y(92));if(us(a)){if(1<a.length)throw Error(Y(93));a=a[0]}i=a}i==null&&(i=""),a=i}n._wrapperState={initialValue:ta(a)}}function ng(n,i){var a=ta(i.value),t=ta(i.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),i.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),t!=null&&(n.defaultValue=""+t)}function rh(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function rg(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ed(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?rg(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Sl,ig=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,t,e){MSApp.execUnsafeLocalFunction(function(){return n(i,a,t,e)})}:n}(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(Sl=Sl||document.createElement("div"),Sl.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Sl.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Bs(n,i){if(i){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=i;return}}n.textContent=i}var hs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},dy=["Webkit","ms","Moz","O"];Object.keys(hs).forEach(function(n){dy.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),hs[i]=hs[n]})});function ag(n,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||hs.hasOwnProperty(n)&&hs[n]?(""+i).trim():i+"px"}function og(n,i){n=n.style;for(var a in i)if(i.hasOwnProperty(a)){var t=a.indexOf("--")===0,e=ag(a,i[a],t);a==="float"&&(a="cssFloat"),t?n.setProperty(a,e):n[a]=e}}var _y=ut({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wd(n,i){if(i){if(_y[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(Y(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(Y(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(Y(61))}if(i.style!=null&&typeof i.style!="object")throw Error(Y(62))}}function Td(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rd=null;function G_(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Md=null,mo=null,yo=null;function ih(n){if(n=al(n)){if(typeof Md!="function")throw Error(Y(280));var i=n.stateNode;i&&(i=sc(i),Md(n.stateNode,n.type,i))}}function sg(n){mo?yo?yo.push(n):yo=[n]:mo=n}function lg(){if(mo){var n=mo,i=yo;if(yo=mo=null,ih(n),i)for(n=0;n<i.length;n++)ih(i[n])}}function ug(n,i){return n(i)}function cg(){}var zc=!1;function dg(n,i,a){if(zc)return n(i,a);zc=!0;try{return ug(n,i,a)}finally{zc=!1,(mo!==null||yo!==null)&&(cg(),lg())}}function bs(n,i){var a=n.stateNode;if(a===null)return null;var t=sc(a);if(t===null)return null;a=t[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(t=!t.disabled)||(n=n.type,t=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!t;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(Y(231,i,typeof a));return a}var Pd=!1;if(Si)try{var Zo={};Object.defineProperty(Zo,"passive",{get:function(){Pd=!0}}),window.addEventListener("test",Zo,Zo),window.removeEventListener("test",Zo,Zo)}catch{Pd=!1}function fy(n,i,a,t,e,r,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{i.apply(a,u)}catch(c){this.onError(c)}}var vs=!1,du=null,_u=!1,Bd=null,hy={onError:function(n){vs=!0,du=n}};function vy(n,i,a,t,e,r,o,s,l){vs=!1,du=null,fy.apply(hy,arguments)}function py(n,i,a,t,e,r,o,s,l){if(vy.apply(this,arguments),vs){if(vs){var u=du;vs=!1,du=null}else throw Error(Y(198));_u||(_u=!0,Bd=u)}}function Qa(n){var i=n,a=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,i.flags&4098&&(a=i.return),n=i.return;while(n)}return i.tag===3?a:null}function _g(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function ah(n){if(Qa(n)!==n)throw Error(Y(188))}function gy(n){var i=n.alternate;if(!i){if(i=Qa(n),i===null)throw Error(Y(188));return i!==n?null:n}for(var a=n,t=i;;){var e=a.return;if(e===null)break;var r=e.alternate;if(r===null){if(t=e.return,t!==null){a=t;continue}break}if(e.child===r.child){for(r=e.child;r;){if(r===a)return ah(e),n;if(r===t)return ah(e),i;r=r.sibling}throw Error(Y(188))}if(a.return!==t.return)a=e,t=r;else{for(var o=!1,s=e.child;s;){if(s===a){o=!0,a=e,t=r;break}if(s===t){o=!0,t=e,a=r;break}s=s.sibling}if(!o){for(s=r.child;s;){if(s===a){o=!0,a=r,t=e;break}if(s===t){o=!0,t=r,a=e;break}s=s.sibling}if(!o)throw Error(Y(189))}}if(a.alternate!==t)throw Error(Y(190))}if(a.tag!==3)throw Error(Y(188));return a.stateNode.current===a?n:i}function fg(n){return n=gy(n),n!==null?hg(n):null}function hg(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=hg(n);if(i!==null)return i;n=n.sibling}return null}var vg=jn.unstable_scheduleCallback,oh=jn.unstable_cancelCallback,my=jn.unstable_shouldYield,yy=jn.unstable_requestPaint,xt=jn.unstable_now,Ay=jn.unstable_getCurrentPriorityLevel,H_=jn.unstable_ImmediatePriority,pg=jn.unstable_UserBlockingPriority,fu=jn.unstable_NormalPriority,xy=jn.unstable_LowPriority,gg=jn.unstable_IdlePriority,rc=null,qr=null;function Sy(n){if(qr&&typeof qr.onCommitFiberRoot=="function")try{qr.onCommitFiberRoot(rc,n,void 0,(n.current.flags&128)===128)}catch{}}var Ir=Math.clz32?Math.clz32:wy,Cy=Math.log,Ey=Math.LN2;function wy(n){return n>>>=0,n===0?32:31-(Cy(n)/Ey|0)|0}var Cl=64,El=4194304;function cs(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function hu(n,i){var a=n.pendingLanes;if(a===0)return 0;var t=0,e=n.suspendedLanes,r=n.pingedLanes,o=a&268435455;if(o!==0){var s=o&~e;s!==0?t=cs(s):(r&=o,r!==0&&(t=cs(r)))}else o=a&~e,o!==0?t=cs(o):r!==0&&(t=cs(r));if(t===0)return 0;if(i!==0&&i!==t&&!(i&e)&&(e=t&-t,r=i&-i,e>=r||e===16&&(r&4194240)!==0))return i;if(t&4&&(t|=a&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=t;0<i;)a=31-Ir(i),e=1<<a,t|=n[a],i&=~e;return t}function Ty(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ry(n,i){for(var a=n.suspendedLanes,t=n.pingedLanes,e=n.expirationTimes,r=n.pendingLanes;0<r;){var o=31-Ir(r),s=1<<o,l=e[o];l===-1?(!(s&a)||s&t)&&(e[o]=Ty(s,i)):l<=i&&(n.expiredLanes|=s),r&=~s}}function bd(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function mg(){var n=Cl;return Cl<<=1,!(Cl&4194240)&&(Cl=64),n}function Uc(n){for(var i=[],a=0;31>a;a++)i.push(n);return i}function rl(n,i,a){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-Ir(i),n[i]=a}function My(n,i){var a=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var t=n.eventTimes;for(n=n.expirationTimes;0<a;){var e=31-Ir(a),r=1<<e;i[e]=0,t[e]=-1,n[e]=-1,a&=~r}}function W_(n,i){var a=n.entangledLanes|=i;for(n=n.entanglements;a;){var t=31-Ir(a),e=1<<t;e&i|n[t]&i&&(n[t]|=i),a&=~e}}var Ue=0;function yg(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Ag,Q_,xg,Sg,Cg,Dd=!1,wl=[],Wi=null,Qi=null,Xi=null,Ds=new Map,Ls=new Map,Fi=[],Py="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sh(n,i){switch(n){case"focusin":case"focusout":Wi=null;break;case"dragenter":case"dragleave":Qi=null;break;case"mouseover":case"mouseout":Xi=null;break;case"pointerover":case"pointerout":Ds.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ls.delete(i.pointerId)}}function Ko(n,i,a,t,e,r){return n===null||n.nativeEvent!==r?(n={blockedOn:i,domEventName:a,eventSystemFlags:t,nativeEvent:r,targetContainers:[e]},i!==null&&(i=al(i),i!==null&&Q_(i)),n):(n.eventSystemFlags|=t,i=n.targetContainers,e!==null&&i.indexOf(e)===-1&&i.push(e),n)}function By(n,i,a,t,e){switch(i){case"focusin":return Wi=Ko(Wi,n,i,a,t,e),!0;case"dragenter":return Qi=Ko(Qi,n,i,a,t,e),!0;case"mouseover":return Xi=Ko(Xi,n,i,a,t,e),!0;case"pointerover":var r=e.pointerId;return Ds.set(r,Ko(Ds.get(r)||null,n,i,a,t,e)),!0;case"gotpointercapture":return r=e.pointerId,Ls.set(r,Ko(Ls.get(r)||null,n,i,a,t,e)),!0}return!1}function Eg(n){var i=xa(n.target);if(i!==null){var a=Qa(i);if(a!==null){if(i=a.tag,i===13){if(i=_g(a),i!==null){n.blockedOn=i,Cg(n.priority,function(){xg(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Kl(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var a=Ld(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var t=new a.constructor(a.type,a);Rd=t,a.target.dispatchEvent(t),Rd=null}else return i=al(a),i!==null&&Q_(i),n.blockedOn=a,!1;i.shift()}return!0}function lh(n,i,a){Kl(n)&&a.delete(i)}function by(){Dd=!1,Wi!==null&&Kl(Wi)&&(Wi=null),Qi!==null&&Kl(Qi)&&(Qi=null),Xi!==null&&Kl(Xi)&&(Xi=null),Ds.forEach(lh),Ls.forEach(lh)}function $o(n,i){n.blockedOn===i&&(n.blockedOn=null,Dd||(Dd=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,by)))}function Is(n){function i(e){return $o(e,n)}if(0<wl.length){$o(wl[0],n);for(var a=1;a<wl.length;a++){var t=wl[a];t.blockedOn===n&&(t.blockedOn=null)}}for(Wi!==null&&$o(Wi,n),Qi!==null&&$o(Qi,n),Xi!==null&&$o(Xi,n),Ds.forEach(i),Ls.forEach(i),a=0;a<Fi.length;a++)t=Fi[a],t.blockedOn===n&&(t.blockedOn=null);for(;0<Fi.length&&(a=Fi[0],a.blockedOn===null);)Eg(a),a.blockedOn===null&&Fi.shift()}var Ao=Ri.ReactCurrentBatchConfig,vu=!0;function Dy(n,i,a,t){var e=Ue,r=Ao.transition;Ao.transition=null;try{Ue=1,X_(n,i,a,t)}finally{Ue=e,Ao.transition=r}}function Ly(n,i,a,t){var e=Ue,r=Ao.transition;Ao.transition=null;try{Ue=4,X_(n,i,a,t)}finally{Ue=e,Ao.transition=r}}function X_(n,i,a,t){if(vu){var e=Ld(n,i,a,t);if(e===null)Jc(n,i,t,pu,a),sh(n,t);else if(By(e,n,i,a,t))t.stopPropagation();else if(sh(n,t),i&4&&-1<Py.indexOf(n)){for(;e!==null;){var r=al(e);if(r!==null&&Ag(r),r=Ld(n,i,a,t),r===null&&Jc(n,i,t,pu,a),r===e)break;e=r}e!==null&&t.stopPropagation()}else Jc(n,i,t,null,a)}}var pu=null;function Ld(n,i,a,t){if(pu=null,n=G_(t),n=xa(n),n!==null)if(i=Qa(n),i===null)n=null;else if(a=i.tag,a===13){if(n=_g(i),n!==null)return n;n=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return pu=n,null}function wg(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ay()){case H_:return 1;case pg:return 4;case fu:case xy:return 16;case gg:return 536870912;default:return 16}default:return 16}}var zi=null,j_=null,$l=null;function Tg(){if($l)return $l;var n,i=j_,a=i.length,t,e="value"in zi?zi.value:zi.textContent,r=e.length;for(n=0;n<a&&i[n]===e[n];n++);var o=a-n;for(t=1;t<=o&&i[a-t]===e[r-t];t++);return $l=e.slice(n,1<t?1-t:void 0)}function eu(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function Tl(){return!0}function uh(){return!1}function Zn(n){function i(a,t,e,r,o){this._reactName=a,this._targetInst=e,this.type=t,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var s in n)n.hasOwnProperty(s)&&(a=n[s],this[s]=a?a(r):r[s]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Tl:uh,this.isPropagationStopped=uh,this}return ut(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Tl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Tl)},persist:function(){},isPersistent:Tl}),i}var Wo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Y_=Zn(Wo),il=ut({},Wo,{view:0,detail:0}),Iy=Zn(il),kc,Gc,es,ic=ut({},il,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:q_,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==es&&(es&&n.type==="mousemove"?(kc=n.screenX-es.screenX,Gc=n.screenY-es.screenY):Gc=kc=0,es=n),kc)},movementY:function(n){return"movementY"in n?n.movementY:Gc}}),ch=Zn(ic),Vy=ut({},ic,{dataTransfer:0}),Ny=Zn(Vy),Fy=ut({},il,{relatedTarget:0}),Hc=Zn(Fy),Oy=ut({},Wo,{animationName:0,elapsedTime:0,pseudoElement:0}),zy=Zn(Oy),Uy=ut({},Wo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),ky=Zn(Uy),Gy=ut({},Wo,{data:0}),dh=Zn(Gy),Hy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xy(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=Qy[n])?!!i[n]:!1}function q_(){return Xy}var jy=ut({},il,{key:function(n){if(n.key){var i=Hy[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=eu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Wy[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:q_,charCode:function(n){return n.type==="keypress"?eu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?eu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Yy=Zn(jy),qy=ut({},ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_h=Zn(qy),Jy=ut({},il,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:q_}),Zy=Zn(Jy),Ky=ut({},Wo,{propertyName:0,elapsedTime:0,pseudoElement:0}),$y=Zn(Ky),eA=ut({},ic,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),tA=Zn(eA),nA=[9,13,27,32],J_=Si&&"CompositionEvent"in window,ps=null;Si&&"documentMode"in document&&(ps=document.documentMode);var rA=Si&&"TextEvent"in window&&!ps,Rg=Si&&(!J_||ps&&8<ps&&11>=ps),fh=" ",hh=!1;function Mg(n,i){switch(n){case"keyup":return nA.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pg(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var no=!1;function iA(n,i){switch(n){case"compositionend":return Pg(i);case"keypress":return i.which!==32?null:(hh=!0,fh);case"textInput":return n=i.data,n===fh&&hh?null:n;default:return null}}function aA(n,i){if(no)return n==="compositionend"||!J_&&Mg(n,i)?(n=Tg(),$l=j_=zi=null,no=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Rg&&i.locale!=="ko"?null:i.data;default:return null}}var oA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vh(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!oA[n.type]:i==="textarea"}function Bg(n,i,a,t){sg(t),i=gu(i,"onChange"),0<i.length&&(a=new Y_("onChange","change",null,a,t),n.push({event:a,listeners:i}))}var gs=null,Vs=null;function sA(n){kg(n,0)}function ac(n){var i=ao(n);if(eg(i))return n}function lA(n,i){if(n==="change")return i}var bg=!1;if(Si){var Wc;if(Si){var Qc="oninput"in document;if(!Qc){var ph=document.createElement("div");ph.setAttribute("oninput","return;"),Qc=typeof ph.oninput=="function"}Wc=Qc}else Wc=!1;bg=Wc&&(!document.documentMode||9<document.documentMode)}function gh(){gs&&(gs.detachEvent("onpropertychange",Dg),Vs=gs=null)}function Dg(n){if(n.propertyName==="value"&&ac(Vs)){var i=[];Bg(i,Vs,n,G_(n)),dg(sA,i)}}function uA(n,i,a){n==="focusin"?(gh(),gs=i,Vs=a,gs.attachEvent("onpropertychange",Dg)):n==="focusout"&&gh()}function cA(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ac(Vs)}function dA(n,i){if(n==="click")return ac(i)}function _A(n,i){if(n==="input"||n==="change")return ac(i)}function fA(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var Fr=typeof Object.is=="function"?Object.is:fA;function Ns(n,i){if(Fr(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var a=Object.keys(n),t=Object.keys(i);if(a.length!==t.length)return!1;for(t=0;t<a.length;t++){var e=a[t];if(!vd.call(i,e)||!Fr(n[e],i[e]))return!1}return!0}function mh(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function yh(n,i){var a=mh(n);n=0;for(var t;a;){if(a.nodeType===3){if(t=n+a.textContent.length,n<=i&&t>=i)return{node:a,offset:i-n};n=t}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=mh(a)}}function Lg(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?Lg(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function Ig(){for(var n=window,i=cu();i instanceof n.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)n=i.contentWindow;else break;i=cu(n.document)}return i}function Z_(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function hA(n){var i=Ig(),a=n.focusedElem,t=n.selectionRange;if(i!==a&&a&&a.ownerDocument&&Lg(a.ownerDocument.documentElement,a)){if(t!==null&&Z_(a)){if(i=t.start,n=t.end,n===void 0&&(n=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(n,a.value.length);else if(n=(i=a.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var e=a.textContent.length,r=Math.min(t.start,e);t=t.end===void 0?r:Math.min(t.end,e),!n.extend&&r>t&&(e=t,t=r,r=e),e=yh(a,r);var o=yh(a,t);e&&o&&(n.rangeCount!==1||n.anchorNode!==e.node||n.anchorOffset!==e.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(i=i.createRange(),i.setStart(e.node,e.offset),n.removeAllRanges(),r>t?(n.addRange(i),n.extend(o.node,o.offset)):(i.setEnd(o.node,o.offset),n.addRange(i)))}}for(i=[],n=a;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)n=i[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var vA=Si&&"documentMode"in document&&11>=document.documentMode,ro=null,Id=null,ms=null,Vd=!1;function Ah(n,i,a){var t=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Vd||ro==null||ro!==cu(t)||(t=ro,"selectionStart"in t&&Z_(t)?t={start:t.selectionStart,end:t.selectionEnd}:(t=(t.ownerDocument&&t.ownerDocument.defaultView||window).getSelection(),t={anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}),ms&&Ns(ms,t)||(ms=t,t=gu(Id,"onSelect"),0<t.length&&(i=new Y_("onSelect","select",null,i,a),n.push({event:i,listeners:t}),i.target=ro)))}function Rl(n,i){var a={};return a[n.toLowerCase()]=i.toLowerCase(),a["Webkit"+n]="webkit"+i,a["Moz"+n]="moz"+i,a}var io={animationend:Rl("Animation","AnimationEnd"),animationiteration:Rl("Animation","AnimationIteration"),animationstart:Rl("Animation","AnimationStart"),transitionend:Rl("Transition","TransitionEnd")},Xc={},Vg={};Si&&(Vg=document.createElement("div").style,"AnimationEvent"in window||(delete io.animationend.animation,delete io.animationiteration.animation,delete io.animationstart.animation),"TransitionEvent"in window||delete io.transitionend.transition);function oc(n){if(Xc[n])return Xc[n];if(!io[n])return n;var i=io[n],a;for(a in i)if(i.hasOwnProperty(a)&&a in Vg)return Xc[n]=i[a];return n}var Ng=oc("animationend"),Fg=oc("animationiteration"),Og=oc("animationstart"),zg=oc("transitionend"),Ug=new Map,xh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function sa(n,i){Ug.set(n,i),Wa(i,[n])}for(var jc=0;jc<xh.length;jc++){var Yc=xh[jc],pA=Yc.toLowerCase(),gA=Yc[0].toUpperCase()+Yc.slice(1);sa(pA,"on"+gA)}sa(Ng,"onAnimationEnd");sa(Fg,"onAnimationIteration");sa(Og,"onAnimationStart");sa("dblclick","onDoubleClick");sa("focusin","onFocus");sa("focusout","onBlur");sa(zg,"onTransitionEnd");Ro("onMouseEnter",["mouseout","mouseover"]);Ro("onMouseLeave",["mouseout","mouseover"]);Ro("onPointerEnter",["pointerout","pointerover"]);Ro("onPointerLeave",["pointerout","pointerover"]);Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ds="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mA=new Set("cancel close invalid load scroll toggle".split(" ").concat(ds));function Sh(n,i,a){var t=n.type||"unknown-event";n.currentTarget=a,py(t,i,void 0,n),n.currentTarget=null}function kg(n,i){i=(i&4)!==0;for(var a=0;a<n.length;a++){var t=n[a],e=t.event;t=t.listeners;e:{var r=void 0;if(i)for(var o=t.length-1;0<=o;o--){var s=t[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==r&&e.isPropagationStopped())break e;Sh(e,s,u),r=l}else for(o=0;o<t.length;o++){if(s=t[o],l=s.instance,u=s.currentTarget,s=s.listener,l!==r&&e.isPropagationStopped())break e;Sh(e,s,u),r=l}}}if(_u)throw n=Bd,_u=!1,Bd=null,n}function Ze(n,i){var a=i[Ud];a===void 0&&(a=i[Ud]=new Set);var t=n+"__bubble";a.has(t)||(Gg(i,n,2,!1),a.add(t))}function qc(n,i,a){var t=0;i&&(t|=4),Gg(a,n,t,i)}var Ml="_reactListening"+Math.random().toString(36).slice(2);function Fs(n){if(!n[Ml]){n[Ml]=!0,qp.forEach(function(a){a!=="selectionchange"&&(mA.has(a)||qc(a,!1,n),qc(a,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[Ml]||(i[Ml]=!0,qc("selectionchange",!1,i))}}function Gg(n,i,a,t){switch(wg(i)){case 1:var e=Dy;break;case 4:e=Ly;break;default:e=X_}a=e.bind(null,i,a,n),e=void 0,!Pd||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(e=!0),t?e!==void 0?n.addEventListener(i,a,{capture:!0,passive:e}):n.addEventListener(i,a,!0):e!==void 0?n.addEventListener(i,a,{passive:e}):n.addEventListener(i,a,!1)}function Jc(n,i,a,t,e){var r=t;if(!(i&1)&&!(i&2)&&t!==null)e:for(;;){if(t===null)return;var o=t.tag;if(o===3||o===4){var s=t.stateNode.containerInfo;if(s===e||s.nodeType===8&&s.parentNode===e)break;if(o===4)for(o=t.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===e||l.nodeType===8&&l.parentNode===e))return;o=o.return}for(;s!==null;){if(o=xa(s),o===null)return;if(l=o.tag,l===5||l===6){t=r=o;continue e}s=s.parentNode}}t=t.return}dg(function(){var u=r,c=G_(a),d=[];e:{var _=Ug.get(n);if(_!==void 0){var f=Y_,v=n;switch(n){case"keypress":if(eu(a)===0)break e;case"keydown":case"keyup":f=Yy;break;case"focusin":v="focus",f=Hc;break;case"focusout":v="blur",f=Hc;break;case"beforeblur":case"afterblur":f=Hc;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=ch;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=Ny;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Zy;break;case Ng:case Fg:case Og:f=zy;break;case zg:f=$y;break;case"scroll":f=Iy;break;case"wheel":f=tA;break;case"copy":case"cut":case"paste":f=ky;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=_h}var p=(i&4)!==0,g=!p&&n==="scroll",m=p?_!==null?_+"Capture":null:_;p=[];for(var h=u,y;h!==null;){y=h;var A=y.stateNode;if(y.tag===5&&A!==null&&(y=A,m!==null&&(A=bs(h,m),A!=null&&p.push(Os(h,A,y)))),g)break;h=h.return}0<p.length&&(_=new f(_,v,null,a,c),d.push({event:_,listeners:p}))}}if(!(i&7)){e:{if(_=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",_&&a!==Rd&&(v=a.relatedTarget||a.fromElement)&&(xa(v)||v[Ci]))break e;if((f||_)&&(_=c.window===c?c:(_=c.ownerDocument)?_.defaultView||_.parentWindow:window,f?(v=a.relatedTarget||a.toElement,f=u,v=v?xa(v):null,v!==null&&(g=Qa(v),v!==g||v.tag!==5&&v.tag!==6)&&(v=null)):(f=null,v=u),f!==v)){if(p=ch,A="onMouseLeave",m="onMouseEnter",h="mouse",(n==="pointerout"||n==="pointerover")&&(p=_h,A="onPointerLeave",m="onPointerEnter",h="pointer"),g=f==null?_:ao(f),y=v==null?_:ao(v),_=new p(A,h+"leave",f,a,c),_.target=g,_.relatedTarget=y,A=null,xa(c)===u&&(p=new p(m,h+"enter",v,a,c),p.target=y,p.relatedTarget=g,A=p),g=A,f&&v)t:{for(p=f,m=v,h=0,y=p;y;y=Za(y))h++;for(y=0,A=m;A;A=Za(A))y++;for(;0<h-y;)p=Za(p),h--;for(;0<y-h;)m=Za(m),y--;for(;h--;){if(p===m||m!==null&&p===m.alternate)break t;p=Za(p),m=Za(m)}p=null}else p=null;f!==null&&Ch(d,_,f,p,!1),v!==null&&g!==null&&Ch(d,g,v,p,!0)}}e:{if(_=u?ao(u):window,f=_.nodeName&&_.nodeName.toLowerCase(),f==="select"||f==="input"&&_.type==="file")var S=lA;else if(vh(_))if(bg)S=_A;else{S=cA;var x=uA}else(f=_.nodeName)&&f.toLowerCase()==="input"&&(_.type==="checkbox"||_.type==="radio")&&(S=dA);if(S&&(S=S(n,u))){Bg(d,S,a,c);break e}x&&x(n,_,u),n==="focusout"&&(x=_._wrapperState)&&x.controlled&&_.type==="number"&&Sd(_,"number",_.value)}switch(x=u?ao(u):window,n){case"focusin":(vh(x)||x.contentEditable==="true")&&(ro=x,Id=u,ms=null);break;case"focusout":ms=Id=ro=null;break;case"mousedown":Vd=!0;break;case"contextmenu":case"mouseup":case"dragend":Vd=!1,Ah(d,a,c);break;case"selectionchange":if(vA)break;case"keydown":case"keyup":Ah(d,a,c)}var C;if(J_)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else no?Mg(n,a)&&(E="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(E="onCompositionStart");E&&(Rg&&a.locale!=="ko"&&(no||E!=="onCompositionStart"?E==="onCompositionEnd"&&no&&(C=Tg()):(zi=c,j_="value"in zi?zi.value:zi.textContent,no=!0)),x=gu(u,E),0<x.length&&(E=new dh(E,n,null,a,c),d.push({event:E,listeners:x}),C?E.data=C:(C=Pg(a),C!==null&&(E.data=C)))),(C=rA?iA(n,a):aA(n,a))&&(u=gu(u,"onBeforeInput"),0<u.length&&(c=new dh("onBeforeInput","beforeinput",null,a,c),d.push({event:c,listeners:u}),c.data=C))}kg(d,i)})}function Os(n,i,a){return{instance:n,listener:i,currentTarget:a}}function gu(n,i){for(var a=i+"Capture",t=[];n!==null;){var e=n,r=e.stateNode;e.tag===5&&r!==null&&(e=r,r=bs(n,a),r!=null&&t.unshift(Os(n,r,e)),r=bs(n,i),r!=null&&t.push(Os(n,r,e))),n=n.return}return t}function Za(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ch(n,i,a,t,e){for(var r=i._reactName,o=[];a!==null&&a!==t;){var s=a,l=s.alternate,u=s.stateNode;if(l!==null&&l===t)break;s.tag===5&&u!==null&&(s=u,e?(l=bs(a,r),l!=null&&o.unshift(Os(a,l,s))):e||(l=bs(a,r),l!=null&&o.push(Os(a,l,s)))),a=a.return}o.length!==0&&n.push({event:i,listeners:o})}var yA=/\r\n?/g,AA=/\u0000|\uFFFD/g;function Eh(n){return(typeof n=="string"?n:""+n).replace(yA,`
`).replace(AA,"")}function Pl(n,i,a){if(i=Eh(i),Eh(n)!==i&&a)throw Error(Y(425))}function mu(){}var Nd=null,Fd=null;function Od(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var zd=typeof setTimeout=="function"?setTimeout:void 0,xA=typeof clearTimeout=="function"?clearTimeout:void 0,wh=typeof Promise=="function"?Promise:void 0,SA=typeof queueMicrotask=="function"?queueMicrotask:typeof wh<"u"?function(n){return wh.resolve(null).then(n).catch(CA)}:zd;function CA(n){setTimeout(function(){throw n})}function Zc(n,i){var a=i,t=0;do{var e=a.nextSibling;if(n.removeChild(a),e&&e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){n.removeChild(e),Is(i);return}t--}else a!=="$"&&a!=="$?"&&a!=="$!"||t++;a=e}while(a);Is(i)}function ji(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function Th(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return n;i--}else a==="/$"&&i++}n=n.previousSibling}return null}var Qo=Math.random().toString(36).slice(2),Yr="__reactFiber$"+Qo,zs="__reactProps$"+Qo,Ci="__reactContainer$"+Qo,Ud="__reactEvents$"+Qo,EA="__reactListeners$"+Qo,wA="__reactHandles$"+Qo;function xa(n){var i=n[Yr];if(i)return i;for(var a=n.parentNode;a;){if(i=a[Ci]||a[Yr]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(n=Th(n);n!==null;){if(a=n[Yr])return a;n=Th(n)}return i}n=a,a=n.parentNode}return null}function al(n){return n=n[Yr]||n[Ci],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ao(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Y(33))}function sc(n){return n[zs]||null}var kd=[],oo=-1;function la(n){return{current:n}}function tt(n){0>oo||(n.current=kd[oo],kd[oo]=null,oo--)}function Ye(n,i){oo++,kd[oo]=n.current,n.current=i}var na={},nn=la(na),Pn=la(!1),La=na;function Mo(n,i){var a=n.type.contextTypes;if(!a)return na;var t=n.stateNode;if(t&&t.__reactInternalMemoizedUnmaskedChildContext===i)return t.__reactInternalMemoizedMaskedChildContext;var e={},r;for(r in a)e[r]=i[r];return t&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=e),e}function Bn(n){return n=n.childContextTypes,n!=null}function yu(){tt(Pn),tt(nn)}function Rh(n,i,a){if(nn.current!==na)throw Error(Y(168));Ye(nn,i),Ye(Pn,a)}function Hg(n,i,a){var t=n.stateNode;if(i=i.childContextTypes,typeof t.getChildContext!="function")return a;t=t.getChildContext();for(var e in t)if(!(e in i))throw Error(Y(108,uy(n)||"Unknown",e));return ut({},a,t)}function Au(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||na,La=nn.current,Ye(nn,n),Ye(Pn,Pn.current),!0}function Mh(n,i,a){var t=n.stateNode;if(!t)throw Error(Y(169));a?(n=Hg(n,i,La),t.__reactInternalMemoizedMergedChildContext=n,tt(Pn),tt(nn),Ye(nn,n)):tt(Pn),Ye(Pn,a)}var ui=null,lc=!1,Kc=!1;function Wg(n){ui===null?ui=[n]:ui.push(n)}function TA(n){lc=!0,Wg(n)}function ua(){if(!Kc&&ui!==null){Kc=!0;var n=0,i=Ue;try{var a=ui;for(Ue=1;n<a.length;n++){var t=a[n];do t=t(!0);while(t!==null)}ui=null,lc=!1}catch(e){throw ui!==null&&(ui=ui.slice(n+1)),vg(H_,ua),e}finally{Ue=i,Kc=!1}}return null}var so=[],lo=0,xu=null,Su=0,rr=[],ir=0,Ia=null,di=1,_i="";function ma(n,i){so[lo++]=Su,so[lo++]=xu,xu=n,Su=i}function Qg(n,i,a){rr[ir++]=di,rr[ir++]=_i,rr[ir++]=Ia,Ia=n;var t=di;n=_i;var e=32-Ir(t)-1;t&=~(1<<e),a+=1;var r=32-Ir(i)+e;if(30<r){var o=e-e%5;r=(t&(1<<o)-1).toString(32),t>>=o,e-=o,di=1<<32-Ir(i)+e|a<<e|t,_i=r+n}else di=1<<r|a<<e|t,_i=n}function K_(n){n.return!==null&&(ma(n,1),Qg(n,1,0))}function $_(n){for(;n===xu;)xu=so[--lo],so[lo]=null,Su=so[--lo],so[lo]=null;for(;n===Ia;)Ia=rr[--ir],rr[ir]=null,_i=rr[--ir],rr[ir]=null,di=rr[--ir],rr[ir]=null}var Wn=null,Hn=null,it=!1,Tr=null;function Xg(n,i){var a=or(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=n,i=n.deletions,i===null?(n.deletions=[a],n.flags|=16):i.push(a)}function Ph(n,i){switch(n.tag){case 5:var a=n.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,Wn=n,Hn=ji(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,Wn=n,Hn=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=Ia!==null?{id:di,overflow:_i}:null,n.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=or(18,null,null,0),a.stateNode=i,a.return=n,n.child=a,Wn=n,Hn=null,!0):!1;default:return!1}}function Gd(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Hd(n){if(it){var i=Hn;if(i){var a=i;if(!Ph(n,i)){if(Gd(n))throw Error(Y(418));i=ji(a.nextSibling);var t=Wn;i&&Ph(n,i)?Xg(t,a):(n.flags=n.flags&-4097|2,it=!1,Wn=n)}}else{if(Gd(n))throw Error(Y(418));n.flags=n.flags&-4097|2,it=!1,Wn=n}}}function Bh(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Wn=n}function Bl(n){if(n!==Wn)return!1;if(!it)return Bh(n),it=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!Od(n.type,n.memoizedProps)),i&&(i=Hn)){if(Gd(n))throw jg(),Error(Y(418));for(;i;)Xg(n,i),i=ji(i.nextSibling)}if(Bh(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Y(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(i===0){Hn=ji(n.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}n=n.nextSibling}Hn=null}}else Hn=Wn?ji(n.stateNode.nextSibling):null;return!0}function jg(){for(var n=Hn;n;)n=ji(n.nextSibling)}function Po(){Hn=Wn=null,it=!1}function ef(n){Tr===null?Tr=[n]:Tr.push(n)}var RA=Ri.ReactCurrentBatchConfig;function Sr(n,i){if(n&&n.defaultProps){i=ut({},i),n=n.defaultProps;for(var a in n)i[a]===void 0&&(i[a]=n[a]);return i}return i}var Cu=la(null),Eu=null,uo=null,tf=null;function nf(){tf=uo=Eu=null}function rf(n){var i=Cu.current;tt(Cu),n._currentValue=i}function Wd(n,i,a){for(;n!==null;){var t=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,t!==null&&(t.childLanes|=i)):t!==null&&(t.childLanes&i)!==i&&(t.childLanes|=i),n===a)break;n=n.return}}function xo(n,i){Eu=n,tf=uo=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&i&&(Rn=!0),n.firstContext=null)}function cr(n){var i=n._currentValue;if(tf!==n)if(n={context:n,memoizedValue:i,next:null},uo===null){if(Eu===null)throw Error(Y(308));uo=n,Eu.dependencies={lanes:0,firstContext:n}}else uo=uo.next=n;return i}var Sa=null;function af(n){Sa===null?Sa=[n]:Sa.push(n)}function Yg(n,i,a,t){var e=i.interleaved;return e===null?(a.next=a,af(i)):(a.next=e.next,e.next=a),i.interleaved=a,Ei(n,t)}function Ei(n,i){n.lanes|=i;var a=n.alternate;for(a!==null&&(a.lanes|=i),a=n,n=n.return;n!==null;)n.childLanes|=i,a=n.alternate,a!==null&&(a.childLanes|=i),a=n,n=n.return;return a.tag===3?a.stateNode:null}var Vi=!1;function of(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qg(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function vi(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function Yi(n,i,a){var t=n.updateQueue;if(t===null)return null;if(t=t.shared,Ne&2){var e=t.pending;return e===null?i.next=i:(i.next=e.next,e.next=i),t.pending=i,Ei(n,a)}return e=t.interleaved,e===null?(i.next=i,af(t)):(i.next=e.next,e.next=i),t.interleaved=i,Ei(n,a)}function tu(n,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var t=i.lanes;t&=n.pendingLanes,a|=t,i.lanes=a,W_(n,a)}}function bh(n,i){var a=n.updateQueue,t=n.alternate;if(t!==null&&(t=t.updateQueue,a===t)){var e=null,r=null;if(a=a.firstBaseUpdate,a!==null){do{var o={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};r===null?e=r=o:r=r.next=o,a=a.next}while(a!==null);r===null?e=r=i:r=r.next=i}else e=r=i;a={baseState:t.baseState,firstBaseUpdate:e,lastBaseUpdate:r,shared:t.shared,effects:t.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=i:n.next=i,a.lastBaseUpdate=i}function wu(n,i,a,t){var e=n.updateQueue;Vi=!1;var r=e.firstBaseUpdate,o=e.lastBaseUpdate,s=e.shared.pending;if(s!==null){e.shared.pending=null;var l=s,u=l.next;l.next=null,o===null?r=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=u:s.next=u,c.lastBaseUpdate=l))}if(r!==null){var d=e.baseState;o=0,c=u=l=null,s=r;do{var _=s.lane,f=s.eventTime;if((t&_)===_){c!==null&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var v=n,p=s;switch(_=i,f=a,p.tag){case 1:if(v=p.payload,typeof v=="function"){d=v.call(f,d,_);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=p.payload,_=typeof v=="function"?v.call(f,d,_):v,_==null)break e;d=ut({},d,_);break e;case 2:Vi=!0}}s.callback!==null&&s.lane!==0&&(n.flags|=64,_=e.effects,_===null?e.effects=[s]:_.push(s))}else f={eventTime:f,lane:_,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,o|=_;if(s=s.next,s===null){if(s=e.shared.pending,s===null)break;_=s,s=_.next,_.next=null,e.lastBaseUpdate=_,e.shared.pending=null}}while(!0);if(c===null&&(l=d),e.baseState=l,e.firstBaseUpdate=u,e.lastBaseUpdate=c,i=e.shared.interleaved,i!==null){e=i;do o|=e.lane,e=e.next;while(e!==i)}else r===null&&(e.shared.lanes=0);Na|=o,n.lanes=o,n.memoizedState=d}}function Dh(n,i,a){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var t=n[i],e=t.callback;if(e!==null){if(t.callback=null,t=a,typeof e!="function")throw Error(Y(191,e));e.call(t)}}}var Jg=new Yp.Component().refs;function Qd(n,i,a,t){i=n.memoizedState,a=a(t,i),a=a==null?i:ut({},i,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var uc={isMounted:function(n){return(n=n._reactInternals)?Qa(n)===n:!1},enqueueSetState:function(n,i,a){n=n._reactInternals;var t=_n(),e=Ji(n),r=vi(t,e);r.payload=i,a!=null&&(r.callback=a),i=Yi(n,r,e),i!==null&&(Vr(i,n,e,t),tu(i,n,e))},enqueueReplaceState:function(n,i,a){n=n._reactInternals;var t=_n(),e=Ji(n),r=vi(t,e);r.tag=1,r.payload=i,a!=null&&(r.callback=a),i=Yi(n,r,e),i!==null&&(Vr(i,n,e,t),tu(i,n,e))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var a=_n(),t=Ji(n),e=vi(a,t);e.tag=2,i!=null&&(e.callback=i),i=Yi(n,e,t),i!==null&&(Vr(i,n,t,a),tu(i,n,t))}};function Lh(n,i,a,t,e,r,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(t,r,o):i.prototype&&i.prototype.isPureReactComponent?!Ns(a,t)||!Ns(e,r):!0}function Zg(n,i,a){var t=!1,e=na,r=i.contextType;return typeof r=="object"&&r!==null?r=cr(r):(e=Bn(i)?La:nn.current,t=i.contextTypes,r=(t=t!=null)?Mo(n,e):na),i=new i(a,r),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=uc,n.stateNode=i,i._reactInternals=n,t&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),i}function Ih(n,i,a,t){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,t),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,t),i.state!==n&&uc.enqueueReplaceState(i,i.state,null)}function Xd(n,i,a,t){var e=n.stateNode;e.props=a,e.state=n.memoizedState,e.refs=Jg,of(n);var r=i.contextType;typeof r=="object"&&r!==null?e.context=cr(r):(r=Bn(i)?La:nn.current,e.context=Mo(n,r)),e.state=n.memoizedState,r=i.getDerivedStateFromProps,typeof r=="function"&&(Qd(n,i,r,a),e.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof e.getSnapshotBeforeUpdate=="function"||typeof e.UNSAFE_componentWillMount!="function"&&typeof e.componentWillMount!="function"||(i=e.state,typeof e.componentWillMount=="function"&&e.componentWillMount(),typeof e.UNSAFE_componentWillMount=="function"&&e.UNSAFE_componentWillMount(),i!==e.state&&uc.enqueueReplaceState(e,e.state,null),wu(n,a,e,t),e.state=n.memoizedState),typeof e.componentDidMount=="function"&&(n.flags|=4194308)}function ts(n,i,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Y(309));var t=a.stateNode}if(!t)throw Error(Y(147,n));var e=t,r=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===r?i.ref:(i=function(o){var s=e.refs;s===Jg&&(s=e.refs={}),o===null?delete s[r]:s[r]=o},i._stringRef=r,i)}if(typeof n!="string")throw Error(Y(284));if(!a._owner)throw Error(Y(290,n))}return n}function bl(n,i){throw n=Object.prototype.toString.call(i),Error(Y(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function Vh(n){var i=n._init;return i(n._payload)}function Kg(n){function i(m,h){if(n){var y=m.deletions;y===null?(m.deletions=[h],m.flags|=16):y.push(h)}}function a(m,h){if(!n)return null;for(;h!==null;)i(m,h),h=h.sibling;return null}function t(m,h){for(m=new Map;h!==null;)h.key!==null?m.set(h.key,h):m.set(h.index,h),h=h.sibling;return m}function e(m,h){return m=Zi(m,h),m.index=0,m.sibling=null,m}function r(m,h,y){return m.index=y,n?(y=m.alternate,y!==null?(y=y.index,y<h?(m.flags|=2,h):y):(m.flags|=2,h)):(m.flags|=1048576,h)}function o(m){return n&&m.alternate===null&&(m.flags|=2),m}function s(m,h,y,A){return h===null||h.tag!==6?(h=ad(y,m.mode,A),h.return=m,h):(h=e(h,y),h.return=m,h)}function l(m,h,y,A){var S=y.type;return S===to?c(m,h,y.props.children,A,y.key):h!==null&&(h.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ii&&Vh(S)===h.type)?(A=e(h,y.props),A.ref=ts(m,h,y),A.return=m,A):(A=su(y.type,y.key,y.props,null,m.mode,A),A.ref=ts(m,h,y),A.return=m,A)}function u(m,h,y,A){return h===null||h.tag!==4||h.stateNode.containerInfo!==y.containerInfo||h.stateNode.implementation!==y.implementation?(h=od(y,m.mode,A),h.return=m,h):(h=e(h,y.children||[]),h.return=m,h)}function c(m,h,y,A,S){return h===null||h.tag!==7?(h=Ba(y,m.mode,A,S),h.return=m,h):(h=e(h,y),h.return=m,h)}function d(m,h,y){if(typeof h=="string"&&h!==""||typeof h=="number")return h=ad(""+h,m.mode,y),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Al:return y=su(h.type,h.key,h.props,null,m.mode,y),y.ref=ts(m,null,h),y.return=m,y;case eo:return h=od(h,m.mode,y),h.return=m,h;case Ii:var A=h._init;return d(m,A(h._payload),y)}if(us(h)||Jo(h))return h=Ba(h,m.mode,y,null),h.return=m,h;bl(m,h)}return null}function _(m,h,y,A){var S=h!==null?h.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return S!==null?null:s(m,h,""+y,A);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Al:return y.key===S?l(m,h,y,A):null;case eo:return y.key===S?u(m,h,y,A):null;case Ii:return S=y._init,_(m,h,S(y._payload),A)}if(us(y)||Jo(y))return S!==null?null:c(m,h,y,A,null);bl(m,y)}return null}function f(m,h,y,A,S){if(typeof A=="string"&&A!==""||typeof A=="number")return m=m.get(y)||null,s(h,m,""+A,S);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Al:return m=m.get(A.key===null?y:A.key)||null,l(h,m,A,S);case eo:return m=m.get(A.key===null?y:A.key)||null,u(h,m,A,S);case Ii:var x=A._init;return f(m,h,y,x(A._payload),S)}if(us(A)||Jo(A))return m=m.get(y)||null,c(h,m,A,S,null);bl(h,A)}return null}function v(m,h,y,A){for(var S=null,x=null,C=h,E=h=0,T=null;C!==null&&E<y.length;E++){C.index>E?(T=C,C=null):T=C.sibling;var w=_(m,C,y[E],A);if(w===null){C===null&&(C=T);break}n&&C&&w.alternate===null&&i(m,C),h=r(w,h,E),x===null?S=w:x.sibling=w,x=w,C=T}if(E===y.length)return a(m,C),it&&ma(m,E),S;if(C===null){for(;E<y.length;E++)C=d(m,y[E],A),C!==null&&(h=r(C,h,E),x===null?S=C:x.sibling=C,x=C);return it&&ma(m,E),S}for(C=t(m,C);E<y.length;E++)T=f(C,m,E,y[E],A),T!==null&&(n&&T.alternate!==null&&C.delete(T.key===null?E:T.key),h=r(T,h,E),x===null?S=T:x.sibling=T,x=T);return n&&C.forEach(function(R){return i(m,R)}),it&&ma(m,E),S}function p(m,h,y,A){var S=Jo(y);if(typeof S!="function")throw Error(Y(150));if(y=S.call(y),y==null)throw Error(Y(151));for(var x=S=null,C=h,E=h=0,T=null,w=y.next();C!==null&&!w.done;E++,w=y.next()){C.index>E?(T=C,C=null):T=C.sibling;var R=_(m,C,w.value,A);if(R===null){C===null&&(C=T);break}n&&C&&R.alternate===null&&i(m,C),h=r(R,h,E),x===null?S=R:x.sibling=R,x=R,C=T}if(w.done)return a(m,C),it&&ma(m,E),S;if(C===null){for(;!w.done;E++,w=y.next())w=d(m,w.value,A),w!==null&&(h=r(w,h,E),x===null?S=w:x.sibling=w,x=w);return it&&ma(m,E),S}for(C=t(m,C);!w.done;E++,w=y.next())w=f(C,m,E,w.value,A),w!==null&&(n&&w.alternate!==null&&C.delete(w.key===null?E:w.key),h=r(w,h,E),x===null?S=w:x.sibling=w,x=w);return n&&C.forEach(function(b){return i(m,b)}),it&&ma(m,E),S}function g(m,h,y,A){if(typeof y=="object"&&y!==null&&y.type===to&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Al:e:{for(var S=y.key,x=h;x!==null;){if(x.key===S){if(S=y.type,S===to){if(x.tag===7){a(m,x.sibling),h=e(x,y.props.children),h.return=m,m=h;break e}}else if(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ii&&Vh(S)===x.type){a(m,x.sibling),h=e(x,y.props),h.ref=ts(m,x,y),h.return=m,m=h;break e}a(m,x);break}else i(m,x);x=x.sibling}y.type===to?(h=Ba(y.props.children,m.mode,A,y.key),h.return=m,m=h):(A=su(y.type,y.key,y.props,null,m.mode,A),A.ref=ts(m,h,y),A.return=m,m=A)}return o(m);case eo:e:{for(x=y.key;h!==null;){if(h.key===x)if(h.tag===4&&h.stateNode.containerInfo===y.containerInfo&&h.stateNode.implementation===y.implementation){a(m,h.sibling),h=e(h,y.children||[]),h.return=m,m=h;break e}else{a(m,h);break}else i(m,h);h=h.sibling}h=od(y,m.mode,A),h.return=m,m=h}return o(m);case Ii:return x=y._init,g(m,h,x(y._payload),A)}if(us(y))return v(m,h,y,A);if(Jo(y))return p(m,h,y,A);bl(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,h!==null&&h.tag===6?(a(m,h.sibling),h=e(h,y),h.return=m,m=h):(a(m,h),h=ad(y,m.mode,A),h.return=m,m=h),o(m)):a(m,h)}return g}var Bo=Kg(!0),$g=Kg(!1),ol={},Jr=la(ol),Us=la(ol),ks=la(ol);function Ca(n){if(n===ol)throw Error(Y(174));return n}function sf(n,i){switch(Ye(ks,i),Ye(Us,n),Ye(Jr,ol),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Ed(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=Ed(i,n)}tt(Jr),Ye(Jr,i)}function bo(){tt(Jr),tt(Us),tt(ks)}function e0(n){Ca(ks.current);var i=Ca(Jr.current),a=Ed(i,n.type);i!==a&&(Ye(Us,n),Ye(Jr,a))}function lf(n){Us.current===n&&(tt(Jr),tt(Us))}var st=la(0);function Tu(n){for(var i=n;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var $c=[];function uf(){for(var n=0;n<$c.length;n++)$c[n]._workInProgressVersionPrimary=null;$c.length=0}var nu=Ri.ReactCurrentDispatcher,ed=Ri.ReactCurrentBatchConfig,Va=0,lt=null,Bt=null,Vt=null,Ru=!1,ys=!1,Gs=0,MA=0;function qt(){throw Error(Y(321))}function cf(n,i){if(i===null)return!1;for(var a=0;a<i.length&&a<n.length;a++)if(!Fr(n[a],i[a]))return!1;return!0}function df(n,i,a,t,e,r){if(Va=r,lt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,nu.current=n===null||n.memoizedState===null?DA:LA,n=a(t,e),ys){r=0;do{if(ys=!1,Gs=0,25<=r)throw Error(Y(301));r+=1,Vt=Bt=null,i.updateQueue=null,nu.current=IA,n=a(t,e)}while(ys)}if(nu.current=Mu,i=Bt!==null&&Bt.next!==null,Va=0,Vt=Bt=lt=null,Ru=!1,i)throw Error(Y(300));return n}function _f(){var n=Gs!==0;return Gs=0,n}function Hr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?lt.memoizedState=Vt=n:Vt=Vt.next=n,Vt}function dr(){if(Bt===null){var n=lt.alternate;n=n!==null?n.memoizedState:null}else n=Bt.next;var i=Vt===null?lt.memoizedState:Vt.next;if(i!==null)Vt=i,Bt=n;else{if(n===null)throw Error(Y(310));Bt=n,n={memoizedState:Bt.memoizedState,baseState:Bt.baseState,baseQueue:Bt.baseQueue,queue:Bt.queue,next:null},Vt===null?lt.memoizedState=Vt=n:Vt=Vt.next=n}return Vt}function Hs(n,i){return typeof i=="function"?i(n):i}function td(n){var i=dr(),a=i.queue;if(a===null)throw Error(Y(311));a.lastRenderedReducer=n;var t=Bt,e=t.baseQueue,r=a.pending;if(r!==null){if(e!==null){var o=e.next;e.next=r.next,r.next=o}t.baseQueue=e=r,a.pending=null}if(e!==null){r=e.next,t=t.baseState;var s=o=null,l=null,u=r;do{var c=u.lane;if((Va&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),t=u.hasEagerState?u.eagerState:n(t,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(s=l=d,o=t):l=l.next=d,lt.lanes|=c,Na|=c}u=u.next}while(u!==null&&u!==r);l===null?o=t:l.next=s,Fr(t,i.memoizedState)||(Rn=!0),i.memoizedState=t,i.baseState=o,i.baseQueue=l,a.lastRenderedState=t}if(n=a.interleaved,n!==null){e=n;do r=e.lane,lt.lanes|=r,Na|=r,e=e.next;while(e!==n)}else e===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function nd(n){var i=dr(),a=i.queue;if(a===null)throw Error(Y(311));a.lastRenderedReducer=n;var t=a.dispatch,e=a.pending,r=i.memoizedState;if(e!==null){a.pending=null;var o=e=e.next;do r=n(r,o.action),o=o.next;while(o!==e);Fr(r,i.memoizedState)||(Rn=!0),i.memoizedState=r,i.baseQueue===null&&(i.baseState=r),a.lastRenderedState=r}return[r,t]}function t0(){}function n0(n,i){var a=lt,t=dr(),e=i(),r=!Fr(t.memoizedState,e);if(r&&(t.memoizedState=e,Rn=!0),t=t.queue,ff(a0.bind(null,a,t,n),[n]),t.getSnapshot!==i||r||Vt!==null&&Vt.memoizedState.tag&1){if(a.flags|=2048,Ws(9,i0.bind(null,a,t,e,i),void 0,null),Ft===null)throw Error(Y(349));Va&30||r0(a,i,e)}return e}function r0(n,i,a){n.flags|=16384,n={getSnapshot:i,value:a},i=lt.updateQueue,i===null?(i={lastEffect:null,stores:null},lt.updateQueue=i,i.stores=[n]):(a=i.stores,a===null?i.stores=[n]:a.push(n))}function i0(n,i,a,t){i.value=a,i.getSnapshot=t,o0(i)&&s0(n)}function a0(n,i,a){return a(function(){o0(i)&&s0(n)})}function o0(n){var i=n.getSnapshot;n=n.value;try{var a=i();return!Fr(n,a)}catch{return!0}}function s0(n){var i=Ei(n,1);i!==null&&Vr(i,n,1,-1)}function Nh(n){var i=Hr();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hs,lastRenderedState:n},i.queue=n,n=n.dispatch=bA.bind(null,lt,n),[i.memoizedState,n]}function Ws(n,i,a,t){return n={tag:n,create:i,destroy:a,deps:t,next:null},i=lt.updateQueue,i===null?(i={lastEffect:null,stores:null},lt.updateQueue=i,i.lastEffect=n.next=n):(a=i.lastEffect,a===null?i.lastEffect=n.next=n:(t=a.next,a.next=n,n.next=t,i.lastEffect=n)),n}function l0(){return dr().memoizedState}function ru(n,i,a,t){var e=Hr();lt.flags|=n,e.memoizedState=Ws(1|i,a,void 0,t===void 0?null:t)}function cc(n,i,a,t){var e=dr();t=t===void 0?null:t;var r=void 0;if(Bt!==null){var o=Bt.memoizedState;if(r=o.destroy,t!==null&&cf(t,o.deps)){e.memoizedState=Ws(i,a,r,t);return}}lt.flags|=n,e.memoizedState=Ws(1|i,a,r,t)}function Fh(n,i){return ru(8390656,8,n,i)}function ff(n,i){return cc(2048,8,n,i)}function u0(n,i){return cc(4,2,n,i)}function c0(n,i){return cc(4,4,n,i)}function d0(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function _0(n,i,a){return a=a!=null?a.concat([n]):null,cc(4,4,d0.bind(null,i,n),a)}function hf(){}function f0(n,i){var a=dr();i=i===void 0?null:i;var t=a.memoizedState;return t!==null&&i!==null&&cf(i,t[1])?t[0]:(a.memoizedState=[n,i],n)}function h0(n,i){var a=dr();i=i===void 0?null:i;var t=a.memoizedState;return t!==null&&i!==null&&cf(i,t[1])?t[0]:(n=n(),a.memoizedState=[n,i],n)}function v0(n,i,a){return Va&21?(Fr(a,i)||(a=mg(),lt.lanes|=a,Na|=a,n.baseState=!0),i):(n.baseState&&(n.baseState=!1,Rn=!0),n.memoizedState=a)}function PA(n,i){var a=Ue;Ue=a!==0&&4>a?a:4,n(!0);var t=ed.transition;ed.transition={};try{n(!1),i()}finally{Ue=a,ed.transition=t}}function p0(){return dr().memoizedState}function BA(n,i,a){var t=Ji(n);if(a={lane:t,action:a,hasEagerState:!1,eagerState:null,next:null},g0(n))m0(i,a);else if(a=Yg(n,i,a,t),a!==null){var e=_n();Vr(a,n,t,e),y0(a,i,t)}}function bA(n,i,a){var t=Ji(n),e={lane:t,action:a,hasEagerState:!1,eagerState:null,next:null};if(g0(n))m0(i,e);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=i.lastRenderedReducer,r!==null))try{var o=i.lastRenderedState,s=r(o,a);if(e.hasEagerState=!0,e.eagerState=s,Fr(s,o)){var l=i.interleaved;l===null?(e.next=e,af(i)):(e.next=l.next,l.next=e),i.interleaved=e;return}}catch{}finally{}a=Yg(n,i,e,t),a!==null&&(e=_n(),Vr(a,n,t,e),y0(a,i,t))}}function g0(n){var i=n.alternate;return n===lt||i!==null&&i===lt}function m0(n,i){ys=Ru=!0;var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}function y0(n,i,a){if(a&4194240){var t=i.lanes;t&=n.pendingLanes,a|=t,i.lanes=a,W_(n,a)}}var Mu={readContext:cr,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useInsertionEffect:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useSyncExternalStore:qt,useId:qt,unstable_isNewReconciler:!1},DA={readContext:cr,useCallback:function(n,i){return Hr().memoizedState=[n,i===void 0?null:i],n},useContext:cr,useEffect:Fh,useImperativeHandle:function(n,i,a){return a=a!=null?a.concat([n]):null,ru(4194308,4,d0.bind(null,i,n),a)},useLayoutEffect:function(n,i){return ru(4194308,4,n,i)},useInsertionEffect:function(n,i){return ru(4,2,n,i)},useMemo:function(n,i){var a=Hr();return i=i===void 0?null:i,n=n(),a.memoizedState=[n,i],n},useReducer:function(n,i,a){var t=Hr();return i=a!==void 0?a(i):i,t.memoizedState=t.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},t.queue=n,n=n.dispatch=BA.bind(null,lt,n),[t.memoizedState,n]},useRef:function(n){var i=Hr();return n={current:n},i.memoizedState=n},useState:Nh,useDebugValue:hf,useDeferredValue:function(n){return Hr().memoizedState=n},useTransition:function(){var n=Nh(!1),i=n[0];return n=PA.bind(null,n[1]),Hr().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,a){var t=lt,e=Hr();if(it){if(a===void 0)throw Error(Y(407));a=a()}else{if(a=i(),Ft===null)throw Error(Y(349));Va&30||r0(t,i,a)}e.memoizedState=a;var r={value:a,getSnapshot:i};return e.queue=r,Fh(a0.bind(null,t,r,n),[n]),t.flags|=2048,Ws(9,i0.bind(null,t,r,a,i),void 0,null),a},useId:function(){var n=Hr(),i=Ft.identifierPrefix;if(it){var a=_i,t=di;a=(t&~(1<<32-Ir(t)-1)).toString(32)+a,i=":"+i+"R"+a,a=Gs++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=MA++,i=":"+i+"r"+a.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},LA={readContext:cr,useCallback:f0,useContext:cr,useEffect:ff,useImperativeHandle:_0,useInsertionEffect:u0,useLayoutEffect:c0,useMemo:h0,useReducer:td,useRef:l0,useState:function(){return td(Hs)},useDebugValue:hf,useDeferredValue:function(n){var i=dr();return v0(i,Bt.memoizedState,n)},useTransition:function(){var n=td(Hs)[0],i=dr().memoizedState;return[n,i]},useMutableSource:t0,useSyncExternalStore:n0,useId:p0,unstable_isNewReconciler:!1},IA={readContext:cr,useCallback:f0,useContext:cr,useEffect:ff,useImperativeHandle:_0,useInsertionEffect:u0,useLayoutEffect:c0,useMemo:h0,useReducer:nd,useRef:l0,useState:function(){return nd(Hs)},useDebugValue:hf,useDeferredValue:function(n){var i=dr();return Bt===null?i.memoizedState=n:v0(i,Bt.memoizedState,n)},useTransition:function(){var n=nd(Hs)[0],i=dr().memoizedState;return[n,i]},useMutableSource:t0,useSyncExternalStore:n0,useId:p0,unstable_isNewReconciler:!1};function Do(n,i){try{var a="",t=i;do a+=ly(t),t=t.return;while(t);var e=a}catch(r){e=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:i,stack:e,digest:null}}function rd(n,i,a){return{value:n,source:null,stack:a??null,digest:i??null}}function jd(n,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var VA=typeof WeakMap=="function"?WeakMap:Map;function A0(n,i,a){a=vi(-1,a),a.tag=3,a.payload={element:null};var t=i.value;return a.callback=function(){Bu||(Bu=!0,r_=t),jd(n,i)},a}function x0(n,i,a){a=vi(-1,a),a.tag=3;var t=n.type.getDerivedStateFromError;if(typeof t=="function"){var e=i.value;a.payload=function(){return t(e)},a.callback=function(){jd(n,i)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(a.callback=function(){jd(n,i),typeof t!="function"&&(qi===null?qi=new Set([this]):qi.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})}),a}function Oh(n,i,a){var t=n.pingCache;if(t===null){t=n.pingCache=new VA;var e=new Set;t.set(i,e)}else e=t.get(i),e===void 0&&(e=new Set,t.set(i,e));e.has(a)||(e.add(a),n=qA.bind(null,n,i,a),i.then(n,n))}function zh(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function Uh(n,i,a,t,e){return n.mode&1?(n.flags|=65536,n.lanes=e,n):(n===i?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=vi(-1,1),i.tag=2,Yi(a,i,1))),a.lanes|=1),n)}var NA=Ri.ReactCurrentOwner,Rn=!1;function un(n,i,a,t){i.child=n===null?$g(i,null,a,t):Bo(i,n.child,a,t)}function kh(n,i,a,t,e){a=a.render;var r=i.ref;return xo(i,e),t=df(n,i,a,t,r,e),a=_f(),n!==null&&!Rn?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~e,wi(n,i,e)):(it&&a&&K_(i),i.flags|=1,un(n,i,t,e),i.child)}function Gh(n,i,a,t,e){if(n===null){var r=a.type;return typeof r=="function"&&!Sf(r)&&r.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=r,S0(n,i,r,t,e)):(n=su(a.type,null,t,i,i.mode,e),n.ref=i.ref,n.return=i,i.child=n)}if(r=n.child,!(n.lanes&e)){var o=r.memoizedProps;if(a=a.compare,a=a!==null?a:Ns,a(o,t)&&n.ref===i.ref)return wi(n,i,e)}return i.flags|=1,n=Zi(r,t),n.ref=i.ref,n.return=i,i.child=n}function S0(n,i,a,t,e){if(n!==null){var r=n.memoizedProps;if(Ns(r,t)&&n.ref===i.ref)if(Rn=!1,i.pendingProps=t=r,(n.lanes&e)!==0)n.flags&131072&&(Rn=!0);else return i.lanes=n.lanes,wi(n,i,e)}return Yd(n,i,a,t,e)}function C0(n,i,a){var t=i.pendingProps,e=t.children,r=n!==null?n.memoizedState:null;if(t.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ye(_o,kn),kn|=a;else{if(!(a&1073741824))return n=r!==null?r.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,Ye(_o,kn),kn|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},t=r!==null?r.baseLanes:a,Ye(_o,kn),kn|=t}else r!==null?(t=r.baseLanes|a,i.memoizedState=null):t=a,Ye(_o,kn),kn|=t;return un(n,i,e,a),i.child}function E0(n,i){var a=i.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function Yd(n,i,a,t,e){var r=Bn(a)?La:nn.current;return r=Mo(i,r),xo(i,e),a=df(n,i,a,t,r,e),t=_f(),n!==null&&!Rn?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~e,wi(n,i,e)):(it&&t&&K_(i),i.flags|=1,un(n,i,a,e),i.child)}function Hh(n,i,a,t,e){if(Bn(a)){var r=!0;Au(i)}else r=!1;if(xo(i,e),i.stateNode===null)iu(n,i),Zg(i,a,t),Xd(i,a,t,e),t=!0;else if(n===null){var o=i.stateNode,s=i.memoizedProps;o.props=s;var l=o.context,u=a.contextType;typeof u=="object"&&u!==null?u=cr(u):(u=Bn(a)?La:nn.current,u=Mo(i,u));var c=a.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==t||l!==u)&&Ih(i,o,t,u),Vi=!1;var _=i.memoizedState;o.state=_,wu(i,t,o,e),l=i.memoizedState,s!==t||_!==l||Pn.current||Vi?(typeof c=="function"&&(Qd(i,a,c,t),l=i.memoizedState),(s=Vi||Lh(i,a,s,t,_,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(i.flags|=4194308)):(typeof o.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=t,i.memoizedState=l),o.props=t,o.state=l,o.context=u,t=s):(typeof o.componentDidMount=="function"&&(i.flags|=4194308),t=!1)}else{o=i.stateNode,qg(n,i),s=i.memoizedProps,u=i.type===i.elementType?s:Sr(i.type,s),o.props=u,d=i.pendingProps,_=o.context,l=a.contextType,typeof l=="object"&&l!==null?l=cr(l):(l=Bn(a)?La:nn.current,l=Mo(i,l));var f=a.getDerivedStateFromProps;(c=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||_!==l)&&Ih(i,o,t,l),Vi=!1,_=i.memoizedState,o.state=_,wu(i,t,o,e);var v=i.memoizedState;s!==d||_!==v||Pn.current||Vi?(typeof f=="function"&&(Qd(i,a,f,t),v=i.memoizedState),(u=Vi||Lh(i,a,u,t,_,v,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(t,v,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(t,v,l)),typeof o.componentDidUpdate=="function"&&(i.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=1024),i.memoizedProps=t,i.memoizedState=v),o.props=t,o.state=v,o.context=l,t=u):(typeof o.componentDidUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&_===n.memoizedState||(i.flags|=1024),t=!1)}return qd(n,i,a,t,r,e)}function qd(n,i,a,t,e,r){E0(n,i);var o=(i.flags&128)!==0;if(!t&&!o)return e&&Mh(i,a,!1),wi(n,i,r);t=i.stateNode,NA.current=i;var s=o&&typeof a.getDerivedStateFromError!="function"?null:t.render();return i.flags|=1,n!==null&&o?(i.child=Bo(i,n.child,null,r),i.child=Bo(i,null,s,r)):un(n,i,s,r),i.memoizedState=t.state,e&&Mh(i,a,!0),i.child}function w0(n){var i=n.stateNode;i.pendingContext?Rh(n,i.pendingContext,i.pendingContext!==i.context):i.context&&Rh(n,i.context,!1),sf(n,i.containerInfo)}function Wh(n,i,a,t,e){return Po(),ef(e),i.flags|=256,un(n,i,a,t),i.child}var Jd={dehydrated:null,treeContext:null,retryLane:0};function Zd(n){return{baseLanes:n,cachePool:null,transitions:null}}function T0(n,i,a){var t=i.pendingProps,e=st.current,r=!1,o=(i.flags&128)!==0,s;if((s=o)||(s=n!==null&&n.memoizedState===null?!1:(e&2)!==0),s?(r=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(e|=1),Ye(st,e&1),n===null)return Hd(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(i.mode&1?n.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(o=t.children,n=t.fallback,r?(t=i.mode,r=i.child,o={mode:"hidden",children:o},!(t&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=fc(o,t,0,null),n=Ba(n,t,a,null),r.return=i,n.return=i,r.sibling=n,i.child=r,i.child.memoizedState=Zd(a),i.memoizedState=Jd,n):vf(i,o));if(e=n.memoizedState,e!==null&&(s=e.dehydrated,s!==null))return FA(n,i,o,t,s,e,a);if(r){r=t.fallback,o=i.mode,e=n.child,s=e.sibling;var l={mode:"hidden",children:t.children};return!(o&1)&&i.child!==e?(t=i.child,t.childLanes=0,t.pendingProps=l,i.deletions=null):(t=Zi(e,l),t.subtreeFlags=e.subtreeFlags&14680064),s!==null?r=Zi(s,r):(r=Ba(r,o,a,null),r.flags|=2),r.return=i,t.return=i,t.sibling=r,i.child=t,t=r,r=i.child,o=n.child.memoizedState,o=o===null?Zd(a):{baseLanes:o.baseLanes|a,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=n.childLanes&~a,i.memoizedState=Jd,t}return r=n.child,n=r.sibling,t=Zi(r,{mode:"visible",children:t.children}),!(i.mode&1)&&(t.lanes=a),t.return=i,t.sibling=null,n!==null&&(a=i.deletions,a===null?(i.deletions=[n],i.flags|=16):a.push(n)),i.child=t,i.memoizedState=null,t}function vf(n,i){return i=fc({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function Dl(n,i,a,t){return t!==null&&ef(t),Bo(i,n.child,null,a),n=vf(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function FA(n,i,a,t,e,r,o){if(a)return i.flags&256?(i.flags&=-257,t=rd(Error(Y(422))),Dl(n,i,o,t)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(r=t.fallback,e=i.mode,t=fc({mode:"visible",children:t.children},e,0,null),r=Ba(r,e,o,null),r.flags|=2,t.return=i,r.return=i,t.sibling=r,i.child=t,i.mode&1&&Bo(i,n.child,null,o),i.child.memoizedState=Zd(o),i.memoizedState=Jd,r);if(!(i.mode&1))return Dl(n,i,o,null);if(e.data==="$!"){if(t=e.nextSibling&&e.nextSibling.dataset,t)var s=t.dgst;return t=s,r=Error(Y(419)),t=rd(r,t,void 0),Dl(n,i,o,t)}if(s=(o&n.childLanes)!==0,Rn||s){if(t=Ft,t!==null){switch(o&-o){case 4:e=2;break;case 16:e=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:e=32;break;case 536870912:e=268435456;break;default:e=0}e=e&(t.suspendedLanes|o)?0:e,e!==0&&e!==r.retryLane&&(r.retryLane=e,Ei(n,e),Vr(t,n,e,-1))}return xf(),t=rd(Error(Y(421))),Dl(n,i,o,t)}return e.data==="$?"?(i.flags|=128,i.child=n.child,i=JA.bind(null,n),e._reactRetry=i,null):(n=r.treeContext,Hn=ji(e.nextSibling),Wn=i,it=!0,Tr=null,n!==null&&(rr[ir++]=di,rr[ir++]=_i,rr[ir++]=Ia,di=n.id,_i=n.overflow,Ia=i),i=vf(i,t.children),i.flags|=4096,i)}function Qh(n,i,a){n.lanes|=i;var t=n.alternate;t!==null&&(t.lanes|=i),Wd(n.return,i,a)}function id(n,i,a,t,e){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:t,tail:a,tailMode:e}:(r.isBackwards=i,r.rendering=null,r.renderingStartTime=0,r.last=t,r.tail=a,r.tailMode=e)}function R0(n,i,a){var t=i.pendingProps,e=t.revealOrder,r=t.tail;if(un(n,i,t.children,a),t=st.current,t&2)t=t&1|2,i.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Qh(n,a,i);else if(n.tag===19)Qh(n,a,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}t&=1}if(Ye(st,t),!(i.mode&1))i.memoizedState=null;else switch(e){case"forwards":for(a=i.child,e=null;a!==null;)n=a.alternate,n!==null&&Tu(n)===null&&(e=a),a=a.sibling;a=e,a===null?(e=i.child,i.child=null):(e=a.sibling,a.sibling=null),id(i,!1,e,a,r);break;case"backwards":for(a=null,e=i.child,i.child=null;e!==null;){if(n=e.alternate,n!==null&&Tu(n)===null){i.child=e;break}n=e.sibling,e.sibling=a,a=e,e=n}id(i,!0,a,null,r);break;case"together":id(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function iu(n,i){!(i.mode&1)&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function wi(n,i,a){if(n!==null&&(i.dependencies=n.dependencies),Na|=i.lanes,!(a&i.childLanes))return null;if(n!==null&&i.child!==n.child)throw Error(Y(153));if(i.child!==null){for(n=i.child,a=Zi(n,n.pendingProps),i.child=a,a.return=i;n.sibling!==null;)n=n.sibling,a=a.sibling=Zi(n,n.pendingProps),a.return=i;a.sibling=null}return i.child}function OA(n,i,a){switch(i.tag){case 3:w0(i),Po();break;case 5:e0(i);break;case 1:Bn(i.type)&&Au(i);break;case 4:sf(i,i.stateNode.containerInfo);break;case 10:var t=i.type._context,e=i.memoizedProps.value;Ye(Cu,t._currentValue),t._currentValue=e;break;case 13:if(t=i.memoizedState,t!==null)return t.dehydrated!==null?(Ye(st,st.current&1),i.flags|=128,null):a&i.child.childLanes?T0(n,i,a):(Ye(st,st.current&1),n=wi(n,i,a),n!==null?n.sibling:null);Ye(st,st.current&1);break;case 19:if(t=(a&i.childLanes)!==0,n.flags&128){if(t)return R0(n,i,a);i.flags|=128}if(e=i.memoizedState,e!==null&&(e.rendering=null,e.tail=null,e.lastEffect=null),Ye(st,st.current),t)break;return null;case 22:case 23:return i.lanes=0,C0(n,i,a)}return wi(n,i,a)}var M0,Kd,P0,B0;M0=function(n,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Kd=function(){};P0=function(n,i,a,t){var e=n.memoizedProps;if(e!==t){n=i.stateNode,Ca(Jr.current);var r=null;switch(a){case"input":e=Ad(n,e),t=Ad(n,t),r=[];break;case"select":e=ut({},e,{value:void 0}),t=ut({},t,{value:void 0}),r=[];break;case"textarea":e=Cd(n,e),t=Cd(n,t),r=[];break;default:typeof e.onClick!="function"&&typeof t.onClick=="function"&&(n.onclick=mu)}wd(a,t);var o;a=null;for(u in e)if(!t.hasOwnProperty(u)&&e.hasOwnProperty(u)&&e[u]!=null)if(u==="style"){var s=e[u];for(o in s)s.hasOwnProperty(o)&&(a||(a={}),a[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ps.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in t){var l=t[u];if(s=e!=null?e[u]:void 0,t.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(a||(a={}),a[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(a||(a={}),a[o]=l[o])}else a||(r||(r=[]),r.push(u,a)),a=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(r=r||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ps.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ze("scroll",n),r||s===l||(r=[])):(r=r||[]).push(u,l))}a&&(r=r||[]).push("style",a);var u=r;(i.updateQueue=u)&&(i.flags|=4)}};B0=function(n,i,a,t){a!==t&&(i.flags|=4)};function ns(n,i){if(!it)switch(n.tailMode){case"hidden":i=n.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var t=null;a!==null;)a.alternate!==null&&(t=a),a=a.sibling;t===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:t.sibling=null}}function Jt(n){var i=n.alternate!==null&&n.alternate.child===n.child,a=0,t=0;if(i)for(var e=n.child;e!==null;)a|=e.lanes|e.childLanes,t|=e.subtreeFlags&14680064,t|=e.flags&14680064,e.return=n,e=e.sibling;else for(e=n.child;e!==null;)a|=e.lanes|e.childLanes,t|=e.subtreeFlags,t|=e.flags,e.return=n,e=e.sibling;return n.subtreeFlags|=t,n.childLanes=a,i}function zA(n,i,a){var t=i.pendingProps;switch($_(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(i),null;case 1:return Bn(i.type)&&yu(),Jt(i),null;case 3:return t=i.stateNode,bo(),tt(Pn),tt(nn),uf(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(n===null||n.child===null)&&(Bl(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Tr!==null&&(o_(Tr),Tr=null))),Kd(n,i),Jt(i),null;case 5:lf(i);var e=Ca(ks.current);if(a=i.type,n!==null&&i.stateNode!=null)P0(n,i,a,t,e),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!t){if(i.stateNode===null)throw Error(Y(166));return Jt(i),null}if(n=Ca(Jr.current),Bl(i)){t=i.stateNode,a=i.type;var r=i.memoizedProps;switch(t[Yr]=i,t[zs]=r,n=(i.mode&1)!==0,a){case"dialog":Ze("cancel",t),Ze("close",t);break;case"iframe":case"object":case"embed":Ze("load",t);break;case"video":case"audio":for(e=0;e<ds.length;e++)Ze(ds[e],t);break;case"source":Ze("error",t);break;case"img":case"image":case"link":Ze("error",t),Ze("load",t);break;case"details":Ze("toggle",t);break;case"input":eh(t,r),Ze("invalid",t);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},Ze("invalid",t);break;case"textarea":nh(t,r),Ze("invalid",t)}wd(a,r),e=null;for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];o==="children"?typeof s=="string"?t.textContent!==s&&(r.suppressHydrationWarning!==!0&&Pl(t.textContent,s,n),e=["children",s]):typeof s=="number"&&t.textContent!==""+s&&(r.suppressHydrationWarning!==!0&&Pl(t.textContent,s,n),e=["children",""+s]):Ps.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Ze("scroll",t)}switch(a){case"input":xl(t),th(t,r,!0);break;case"textarea":xl(t),rh(t);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(t.onclick=mu)}t=e,i.updateQueue=t,t!==null&&(i.flags|=4)}else{o=e.nodeType===9?e:e.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=rg(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof t.is=="string"?n=o.createElement(a,{is:t.is}):(n=o.createElement(a),a==="select"&&(o=n,t.multiple?o.multiple=!0:t.size&&(o.size=t.size))):n=o.createElementNS(n,a),n[Yr]=i,n[zs]=t,M0(n,i,!1,!1),i.stateNode=n;e:{switch(o=Td(a,t),a){case"dialog":Ze("cancel",n),Ze("close",n),e=t;break;case"iframe":case"object":case"embed":Ze("load",n),e=t;break;case"video":case"audio":for(e=0;e<ds.length;e++)Ze(ds[e],n);e=t;break;case"source":Ze("error",n),e=t;break;case"img":case"image":case"link":Ze("error",n),Ze("load",n),e=t;break;case"details":Ze("toggle",n),e=t;break;case"input":eh(n,t),e=Ad(n,t),Ze("invalid",n);break;case"option":e=t;break;case"select":n._wrapperState={wasMultiple:!!t.multiple},e=ut({},t,{value:void 0}),Ze("invalid",n);break;case"textarea":nh(n,t),e=Cd(n,t),Ze("invalid",n);break;default:e=t}wd(a,e),s=e;for(r in s)if(s.hasOwnProperty(r)){var l=s[r];r==="style"?og(n,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ig(n,l)):r==="children"?typeof l=="string"?(a!=="textarea"||l!=="")&&Bs(n,l):typeof l=="number"&&Bs(n,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Ps.hasOwnProperty(r)?l!=null&&r==="onScroll"&&Ze("scroll",n):l!=null&&O_(n,r,l,o))}switch(a){case"input":xl(n),th(n,t,!1);break;case"textarea":xl(n),rh(n);break;case"option":t.value!=null&&n.setAttribute("value",""+ta(t.value));break;case"select":n.multiple=!!t.multiple,r=t.value,r!=null?go(n,!!t.multiple,r,!1):t.defaultValue!=null&&go(n,!!t.multiple,t.defaultValue,!0);break;default:typeof e.onClick=="function"&&(n.onclick=mu)}switch(a){case"button":case"input":case"select":case"textarea":t=!!t.autoFocus;break e;case"img":t=!0;break e;default:t=!1}}t&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Jt(i),null;case 6:if(n&&i.stateNode!=null)B0(n,i,n.memoizedProps,t);else{if(typeof t!="string"&&i.stateNode===null)throw Error(Y(166));if(a=Ca(ks.current),Ca(Jr.current),Bl(i)){if(t=i.stateNode,a=i.memoizedProps,t[Yr]=i,(r=t.nodeValue!==a)&&(n=Wn,n!==null))switch(n.tag){case 3:Pl(t.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Pl(t.nodeValue,a,(n.mode&1)!==0)}r&&(i.flags|=4)}else t=(a.nodeType===9?a:a.ownerDocument).createTextNode(t),t[Yr]=i,i.stateNode=t}return Jt(i),null;case 13:if(tt(st),t=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(it&&Hn!==null&&i.mode&1&&!(i.flags&128))jg(),Po(),i.flags|=98560,r=!1;else if(r=Bl(i),t!==null&&t.dehydrated!==null){if(n===null){if(!r)throw Error(Y(318));if(r=i.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Y(317));r[Yr]=i}else Po(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;Jt(i),r=!1}else Tr!==null&&(o_(Tr),Tr=null),r=!0;if(!r)return i.flags&65536?i:null}return i.flags&128?(i.lanes=a,i):(t=t!==null,t!==(n!==null&&n.memoizedState!==null)&&t&&(i.child.flags|=8192,i.mode&1&&(n===null||st.current&1?Dt===0&&(Dt=3):xf())),i.updateQueue!==null&&(i.flags|=4),Jt(i),null);case 4:return bo(),Kd(n,i),n===null&&Fs(i.stateNode.containerInfo),Jt(i),null;case 10:return rf(i.type._context),Jt(i),null;case 17:return Bn(i.type)&&yu(),Jt(i),null;case 19:if(tt(st),r=i.memoizedState,r===null)return Jt(i),null;if(t=(i.flags&128)!==0,o=r.rendering,o===null)if(t)ns(r,!1);else{if(Dt!==0||n!==null&&n.flags&128)for(n=i.child;n!==null;){if(o=Tu(n),o!==null){for(i.flags|=128,ns(r,!1),t=o.updateQueue,t!==null&&(i.updateQueue=t,i.flags|=4),i.subtreeFlags=0,t=a,a=i.child;a!==null;)r=a,n=t,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,n=o.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return Ye(st,st.current&1|2),i.child}n=n.sibling}r.tail!==null&&xt()>Lo&&(i.flags|=128,t=!0,ns(r,!1),i.lanes=4194304)}else{if(!t)if(n=Tu(o),n!==null){if(i.flags|=128,t=!0,a=n.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),ns(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!it)return Jt(i),null}else 2*xt()-r.renderingStartTime>Lo&&a!==1073741824&&(i.flags|=128,t=!0,ns(r,!1),i.lanes=4194304);r.isBackwards?(o.sibling=i.child,i.child=o):(a=r.last,a!==null?a.sibling=o:i.child=o,r.last=o)}return r.tail!==null?(i=r.tail,r.rendering=i,r.tail=i.sibling,r.renderingStartTime=xt(),i.sibling=null,a=st.current,Ye(st,t?a&1|2:a&1),i):(Jt(i),null);case 22:case 23:return Af(),t=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==t&&(i.flags|=8192),t&&i.mode&1?kn&1073741824&&(Jt(i),i.subtreeFlags&6&&(i.flags|=8192)):Jt(i),null;case 24:return null;case 25:return null}throw Error(Y(156,i.tag))}function UA(n,i){switch($_(i),i.tag){case 1:return Bn(i.type)&&yu(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return bo(),tt(Pn),tt(nn),uf(),n=i.flags,n&65536&&!(n&128)?(i.flags=n&-65537|128,i):null;case 5:return lf(i),null;case 13:if(tt(st),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(Y(340));Po()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return tt(st),null;case 4:return bo(),null;case 10:return rf(i.type._context),null;case 22:case 23:return Af(),null;case 24:return null;default:return null}}var Ll=!1,Kt=!1,kA=typeof WeakSet=="function"?WeakSet:Set,ne=null;function co(n,i){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(t){vt(n,i,t)}else a.current=null}function $d(n,i,a){try{a()}catch(t){vt(n,i,t)}}var Xh=!1;function GA(n,i){if(Nd=vu,n=Ig(),Z_(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var t=a.getSelection&&a.getSelection();if(t&&t.rangeCount!==0){a=t.anchorNode;var e=t.anchorOffset,r=t.focusNode;t=t.focusOffset;try{a.nodeType,r.nodeType}catch{a=null;break e}var o=0,s=-1,l=-1,u=0,c=0,d=n,_=null;t:for(;;){for(var f;d!==a||e!==0&&d.nodeType!==3||(s=o+e),d!==r||t!==0&&d.nodeType!==3||(l=o+t),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)_=d,d=f;for(;;){if(d===n)break t;if(_===a&&++u===e&&(s=o),_===r&&++c===t&&(l=o),(f=d.nextSibling)!==null)break;d=_,_=d.parentNode}d=f}a=s===-1||l===-1?null:{start:s,end:l}}else a=null}a=a||{start:0,end:0}}else a=null;for(Fd={focusedElem:n,selectionRange:a},vu=!1,ne=i;ne!==null;)if(i=ne,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,ne=n;else for(;ne!==null;){i=ne;try{var v=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var p=v.memoizedProps,g=v.memoizedState,m=i.stateNode,h=m.getSnapshotBeforeUpdate(i.elementType===i.type?p:Sr(i.type,p),g);m.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var y=i.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(A){vt(i,i.return,A)}if(n=i.sibling,n!==null){n.return=i.return,ne=n;break}ne=i.return}return v=Xh,Xh=!1,v}function As(n,i,a){var t=i.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&n)===n){var r=e.destroy;e.destroy=void 0,r!==void 0&&$d(i,a,r)}e=e.next}while(e!==t)}}function dc(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&n)===n){var t=a.create;a.destroy=t()}a=a.next}while(a!==i)}}function e_(n){var i=n.ref;if(i!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof i=="function"?i(n):i.current=n}}function b0(n){var i=n.alternate;i!==null&&(n.alternate=null,b0(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[Yr],delete i[zs],delete i[Ud],delete i[EA],delete i[wA])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function D0(n){return n.tag===5||n.tag===3||n.tag===4}function jh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||D0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function t_(n,i,a){var t=n.tag;if(t===5||t===6)n=n.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(n,i):a.insertBefore(n,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(n,a)):(i=a,i.appendChild(n)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=mu));else if(t!==4&&(n=n.child,n!==null))for(t_(n,i,a),n=n.sibling;n!==null;)t_(n,i,a),n=n.sibling}function n_(n,i,a){var t=n.tag;if(t===5||t===6)n=n.stateNode,i?a.insertBefore(n,i):a.appendChild(n);else if(t!==4&&(n=n.child,n!==null))for(n_(n,i,a),n=n.sibling;n!==null;)n_(n,i,a),n=n.sibling}var Ot=null,Cr=!1;function Bi(n,i,a){for(a=a.child;a!==null;)L0(n,i,a),a=a.sibling}function L0(n,i,a){if(qr&&typeof qr.onCommitFiberUnmount=="function")try{qr.onCommitFiberUnmount(rc,a)}catch{}switch(a.tag){case 5:Kt||co(a,i);case 6:var t=Ot,e=Cr;Ot=null,Bi(n,i,a),Ot=t,Cr=e,Ot!==null&&(Cr?(n=Ot,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Ot.removeChild(a.stateNode));break;case 18:Ot!==null&&(Cr?(n=Ot,a=a.stateNode,n.nodeType===8?Zc(n.parentNode,a):n.nodeType===1&&Zc(n,a),Is(n)):Zc(Ot,a.stateNode));break;case 4:t=Ot,e=Cr,Ot=a.stateNode.containerInfo,Cr=!0,Bi(n,i,a),Ot=t,Cr=e;break;case 0:case 11:case 14:case 15:if(!Kt&&(t=a.updateQueue,t!==null&&(t=t.lastEffect,t!==null))){e=t=t.next;do{var r=e,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&$d(a,i,o),e=e.next}while(e!==t)}Bi(n,i,a);break;case 1:if(!Kt&&(co(a,i),t=a.stateNode,typeof t.componentWillUnmount=="function"))try{t.props=a.memoizedProps,t.state=a.memoizedState,t.componentWillUnmount()}catch(s){vt(a,i,s)}Bi(n,i,a);break;case 21:Bi(n,i,a);break;case 22:a.mode&1?(Kt=(t=Kt)||a.memoizedState!==null,Bi(n,i,a),Kt=t):Bi(n,i,a);break;default:Bi(n,i,a)}}function Yh(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new kA),i.forEach(function(t){var e=ZA.bind(null,n,t);a.has(t)||(a.add(t),t.then(e,e))})}}function Ar(n,i){var a=i.deletions;if(a!==null)for(var t=0;t<a.length;t++){var e=a[t];try{var r=n,o=i,s=o;e:for(;s!==null;){switch(s.tag){case 5:Ot=s.stateNode,Cr=!1;break e;case 3:Ot=s.stateNode.containerInfo,Cr=!0;break e;case 4:Ot=s.stateNode.containerInfo,Cr=!0;break e}s=s.return}if(Ot===null)throw Error(Y(160));L0(r,o,e),Ot=null,Cr=!1;var l=e.alternate;l!==null&&(l.return=null),e.return=null}catch(u){vt(e,i,u)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)I0(i,n),i=i.sibling}function I0(n,i){var a=n.alternate,t=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ar(i,n),kr(n),t&4){try{As(3,n,n.return),dc(3,n)}catch(p){vt(n,n.return,p)}try{As(5,n,n.return)}catch(p){vt(n,n.return,p)}}break;case 1:Ar(i,n),kr(n),t&512&&a!==null&&co(a,a.return);break;case 5:if(Ar(i,n),kr(n),t&512&&a!==null&&co(a,a.return),n.flags&32){var e=n.stateNode;try{Bs(e,"")}catch(p){vt(n,n.return,p)}}if(t&4&&(e=n.stateNode,e!=null)){var r=n.memoizedProps,o=a!==null?a.memoizedProps:r,s=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{s==="input"&&r.type==="radio"&&r.name!=null&&tg(e,r),Td(s,o);var u=Td(s,r);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?og(e,d):c==="dangerouslySetInnerHTML"?ig(e,d):c==="children"?Bs(e,d):O_(e,c,d,u)}switch(s){case"input":xd(e,r);break;case"textarea":ng(e,r);break;case"select":var _=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=!!r.multiple;var f=r.value;f!=null?go(e,!!r.multiple,f,!1):_!==!!r.multiple&&(r.defaultValue!=null?go(e,!!r.multiple,r.defaultValue,!0):go(e,!!r.multiple,r.multiple?[]:"",!1))}e[zs]=r}catch(p){vt(n,n.return,p)}}break;case 6:if(Ar(i,n),kr(n),t&4){if(n.stateNode===null)throw Error(Y(162));e=n.stateNode,r=n.memoizedProps;try{e.nodeValue=r}catch(p){vt(n,n.return,p)}}break;case 3:if(Ar(i,n),kr(n),t&4&&a!==null&&a.memoizedState.isDehydrated)try{Is(i.containerInfo)}catch(p){vt(n,n.return,p)}break;case 4:Ar(i,n),kr(n);break;case 13:Ar(i,n),kr(n),e=n.child,e.flags&8192&&(r=e.memoizedState!==null,e.stateNode.isHidden=r,!r||e.alternate!==null&&e.alternate.memoizedState!==null||(mf=xt())),t&4&&Yh(n);break;case 22:if(c=a!==null&&a.memoizedState!==null,n.mode&1?(Kt=(u=Kt)||c,Ar(i,n),Kt=u):Ar(i,n),kr(n),t&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(ne=n,c=n.child;c!==null;){for(d=ne=c;ne!==null;){switch(_=ne,f=_.child,_.tag){case 0:case 11:case 14:case 15:As(4,_,_.return);break;case 1:co(_,_.return);var v=_.stateNode;if(typeof v.componentWillUnmount=="function"){t=_,a=_.return;try{i=t,v.props=i.memoizedProps,v.state=i.memoizedState,v.componentWillUnmount()}catch(p){vt(t,a,p)}}break;case 5:co(_,_.return);break;case 22:if(_.memoizedState!==null){Jh(d);continue}}f!==null?(f.return=_,ne=f):Jh(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{e=d.stateNode,u?(r=e.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(s=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=ag("display",o))}catch(p){vt(n,n.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){vt(n,n.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ar(i,n),kr(n),t&4&&Yh(n);break;case 21:break;default:Ar(i,n),kr(n)}}function kr(n){var i=n.flags;if(i&2){try{e:{for(var a=n.return;a!==null;){if(D0(a)){var t=a;break e}a=a.return}throw Error(Y(160))}switch(t.tag){case 5:var e=t.stateNode;t.flags&32&&(Bs(e,""),t.flags&=-33);var r=jh(n);n_(n,r,e);break;case 3:case 4:var o=t.stateNode.containerInfo,s=jh(n);t_(n,s,o);break;default:throw Error(Y(161))}}catch(l){vt(n,n.return,l)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function HA(n,i,a){ne=n,V0(n)}function V0(n,i,a){for(var t=(n.mode&1)!==0;ne!==null;){var e=ne,r=e.child;if(e.tag===22&&t){var o=e.memoizedState!==null||Ll;if(!o){var s=e.alternate,l=s!==null&&s.memoizedState!==null||Kt;s=Ll;var u=Kt;if(Ll=o,(Kt=l)&&!u)for(ne=e;ne!==null;)o=ne,l=o.child,o.tag===22&&o.memoizedState!==null?Zh(e):l!==null?(l.return=o,ne=l):Zh(e);for(;r!==null;)ne=r,V0(r),r=r.sibling;ne=e,Ll=s,Kt=u}qh(n)}else e.subtreeFlags&8772&&r!==null?(r.return=e,ne=r):qh(n)}}function qh(n){for(;ne!==null;){var i=ne;if(i.flags&8772){var a=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:Kt||dc(5,i);break;case 1:var t=i.stateNode;if(i.flags&4&&!Kt)if(a===null)t.componentDidMount();else{var e=i.elementType===i.type?a.memoizedProps:Sr(i.type,a.memoizedProps);t.componentDidUpdate(e,a.memoizedState,t.__reactInternalSnapshotBeforeUpdate)}var r=i.updateQueue;r!==null&&Dh(i,r,t);break;case 3:var o=i.updateQueue;if(o!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}Dh(i,o,a)}break;case 5:var s=i.stateNode;if(a===null&&i.flags&4){a=s;var l=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&a.focus();break;case"img":l.src&&(a.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var u=i.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Is(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}Kt||i.flags&512&&e_(i)}catch(_){vt(i,i.return,_)}}if(i===n){ne=null;break}if(a=i.sibling,a!==null){a.return=i.return,ne=a;break}ne=i.return}}function Jh(n){for(;ne!==null;){var i=ne;if(i===n){ne=null;break}var a=i.sibling;if(a!==null){a.return=i.return,ne=a;break}ne=i.return}}function Zh(n){for(;ne!==null;){var i=ne;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{dc(4,i)}catch(l){vt(i,a,l)}break;case 1:var t=i.stateNode;if(typeof t.componentDidMount=="function"){var e=i.return;try{t.componentDidMount()}catch(l){vt(i,e,l)}}var r=i.return;try{e_(i)}catch(l){vt(i,r,l)}break;case 5:var o=i.return;try{e_(i)}catch(l){vt(i,o,l)}}}catch(l){vt(i,i.return,l)}if(i===n){ne=null;break}var s=i.sibling;if(s!==null){s.return=i.return,ne=s;break}ne=i.return}}var WA=Math.ceil,Pu=Ri.ReactCurrentDispatcher,pf=Ri.ReactCurrentOwner,lr=Ri.ReactCurrentBatchConfig,Ne=0,Ft=null,Rt=null,Qt=0,kn=0,_o=la(0),Dt=0,Qs=null,Na=0,_c=0,gf=0,xs=null,wn=null,mf=0,Lo=1/0,li=null,Bu=!1,r_=null,qi=null,Il=!1,Ui=null,bu=0,Ss=0,i_=null,au=-1,ou=0;function _n(){return Ne&6?xt():au!==-1?au:au=xt()}function Ji(n){return n.mode&1?Ne&2&&Qt!==0?Qt&-Qt:RA.transition!==null?(ou===0&&(ou=mg()),ou):(n=Ue,n!==0||(n=window.event,n=n===void 0?16:wg(n.type)),n):1}function Vr(n,i,a,t){if(50<Ss)throw Ss=0,i_=null,Error(Y(185));rl(n,a,t),(!(Ne&2)||n!==Ft)&&(n===Ft&&(!(Ne&2)&&(_c|=a),Dt===4&&Oi(n,Qt)),bn(n,t),a===1&&Ne===0&&!(i.mode&1)&&(Lo=xt()+500,lc&&ua()))}function bn(n,i){var a=n.callbackNode;Ry(n,i);var t=hu(n,n===Ft?Qt:0);if(t===0)a!==null&&oh(a),n.callbackNode=null,n.callbackPriority=0;else if(i=t&-t,n.callbackPriority!==i){if(a!=null&&oh(a),i===1)n.tag===0?TA(Kh.bind(null,n)):Wg(Kh.bind(null,n)),SA(function(){!(Ne&6)&&ua()}),a=null;else{switch(yg(t)){case 1:a=H_;break;case 4:a=pg;break;case 16:a=fu;break;case 536870912:a=gg;break;default:a=fu}a=H0(a,N0.bind(null,n))}n.callbackPriority=i,n.callbackNode=a}}function N0(n,i){if(au=-1,ou=0,Ne&6)throw Error(Y(327));var a=n.callbackNode;if(So()&&n.callbackNode!==a)return null;var t=hu(n,n===Ft?Qt:0);if(t===0)return null;if(t&30||t&n.expiredLanes||i)i=Du(n,t);else{i=t;var e=Ne;Ne|=2;var r=O0();(Ft!==n||Qt!==i)&&(li=null,Lo=xt()+500,Pa(n,i));do try{jA();break}catch(s){F0(n,s)}while(!0);nf(),Pu.current=r,Ne=e,Rt!==null?i=0:(Ft=null,Qt=0,i=Dt)}if(i!==0){if(i===2&&(e=bd(n),e!==0&&(t=e,i=a_(n,e))),i===1)throw a=Qs,Pa(n,0),Oi(n,t),bn(n,xt()),a;if(i===6)Oi(n,t);else{if(e=n.current.alternate,!(t&30)&&!QA(e)&&(i=Du(n,t),i===2&&(r=bd(n),r!==0&&(t=r,i=a_(n,r))),i===1))throw a=Qs,Pa(n,0),Oi(n,t),bn(n,xt()),a;switch(n.finishedWork=e,n.finishedLanes=t,i){case 0:case 1:throw Error(Y(345));case 2:ya(n,wn,li);break;case 3:if(Oi(n,t),(t&130023424)===t&&(i=mf+500-xt(),10<i)){if(hu(n,0)!==0)break;if(e=n.suspendedLanes,(e&t)!==t){_n(),n.pingedLanes|=n.suspendedLanes&e;break}n.timeoutHandle=zd(ya.bind(null,n,wn,li),i);break}ya(n,wn,li);break;case 4:if(Oi(n,t),(t&4194240)===t)break;for(i=n.eventTimes,e=-1;0<t;){var o=31-Ir(t);r=1<<o,o=i[o],o>e&&(e=o),t&=~r}if(t=e,t=xt()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*WA(t/1960))-t,10<t){n.timeoutHandle=zd(ya.bind(null,n,wn,li),t);break}ya(n,wn,li);break;case 5:ya(n,wn,li);break;default:throw Error(Y(329))}}}return bn(n,xt()),n.callbackNode===a?N0.bind(null,n):null}function a_(n,i){var a=xs;return n.current.memoizedState.isDehydrated&&(Pa(n,i).flags|=256),n=Du(n,i),n!==2&&(i=wn,wn=a,i!==null&&o_(i)),n}function o_(n){wn===null?wn=n:wn.push.apply(wn,n)}function QA(n){for(var i=n;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var t=0;t<a.length;t++){var e=a[t],r=e.getSnapshot;e=e.value;try{if(!Fr(r(),e))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Oi(n,i){for(i&=~gf,i&=~_c,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var a=31-Ir(i),t=1<<a;n[a]=-1,i&=~t}}function Kh(n){if(Ne&6)throw Error(Y(327));So();var i=hu(n,0);if(!(i&1))return bn(n,xt()),null;var a=Du(n,i);if(n.tag!==0&&a===2){var t=bd(n);t!==0&&(i=t,a=a_(n,t))}if(a===1)throw a=Qs,Pa(n,0),Oi(n,i),bn(n,xt()),a;if(a===6)throw Error(Y(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,ya(n,wn,li),bn(n,xt()),null}function yf(n,i){var a=Ne;Ne|=1;try{return n(i)}finally{Ne=a,Ne===0&&(Lo=xt()+500,lc&&ua())}}function Fa(n){Ui!==null&&Ui.tag===0&&!(Ne&6)&&So();var i=Ne;Ne|=1;var a=lr.transition,t=Ue;try{if(lr.transition=null,Ue=1,n)return n()}finally{Ue=t,lr.transition=a,Ne=i,!(Ne&6)&&ua()}}function Af(){kn=_o.current,tt(_o)}function Pa(n,i){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,xA(a)),Rt!==null)for(a=Rt.return;a!==null;){var t=a;switch($_(t),t.tag){case 1:t=t.type.childContextTypes,t!=null&&yu();break;case 3:bo(),tt(Pn),tt(nn),uf();break;case 5:lf(t);break;case 4:bo();break;case 13:tt(st);break;case 19:tt(st);break;case 10:rf(t.type._context);break;case 22:case 23:Af()}a=a.return}if(Ft=n,Rt=n=Zi(n.current,null),Qt=kn=i,Dt=0,Qs=null,gf=_c=Na=0,wn=xs=null,Sa!==null){for(i=0;i<Sa.length;i++)if(a=Sa[i],t=a.interleaved,t!==null){a.interleaved=null;var e=t.next,r=a.pending;if(r!==null){var o=r.next;r.next=e,t.next=o}a.pending=t}Sa=null}return n}function F0(n,i){do{var a=Rt;try{if(nf(),nu.current=Mu,Ru){for(var t=lt.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}Ru=!1}if(Va=0,Vt=Bt=lt=null,ys=!1,Gs=0,pf.current=null,a===null||a.return===null){Dt=1,Qs=i,Rt=null;break}e:{var r=n,o=a.return,s=a,l=i;if(i=Qt,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var _=c.alternate;_?(c.updateQueue=_.updateQueue,c.memoizedState=_.memoizedState,c.lanes=_.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=zh(o);if(f!==null){f.flags&=-257,Uh(f,o,s,r,i),f.mode&1&&Oh(r,u,i),i=f,l=u;var v=i.updateQueue;if(v===null){var p=new Set;p.add(l),i.updateQueue=p}else v.add(l);break e}else{if(!(i&1)){Oh(r,u,i),xf();break e}l=Error(Y(426))}}else if(it&&s.mode&1){var g=zh(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Uh(g,o,s,r,i),ef(Do(l,s));break e}}r=l=Do(l,s),Dt!==4&&(Dt=2),xs===null?xs=[r]:xs.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,i&=-i,r.lanes|=i;var m=A0(r,l,i);bh(r,m);break e;case 1:s=l;var h=r.type,y=r.stateNode;if(!(r.flags&128)&&(typeof h.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(qi===null||!qi.has(y)))){r.flags|=65536,i&=-i,r.lanes|=i;var A=x0(r,s,i);bh(r,A);break e}}r=r.return}while(r!==null)}U0(a)}catch(S){i=S,Rt===a&&a!==null&&(Rt=a=a.return);continue}break}while(!0)}function O0(){var n=Pu.current;return Pu.current=Mu,n===null?Mu:n}function xf(){(Dt===0||Dt===3||Dt===2)&&(Dt=4),Ft===null||!(Na&268435455)&&!(_c&268435455)||Oi(Ft,Qt)}function Du(n,i){var a=Ne;Ne|=2;var t=O0();(Ft!==n||Qt!==i)&&(li=null,Pa(n,i));do try{XA();break}catch(e){F0(n,e)}while(!0);if(nf(),Ne=a,Pu.current=t,Rt!==null)throw Error(Y(261));return Ft=null,Qt=0,Dt}function XA(){for(;Rt!==null;)z0(Rt)}function jA(){for(;Rt!==null&&!my();)z0(Rt)}function z0(n){var i=G0(n.alternate,n,kn);n.memoizedProps=n.pendingProps,i===null?U0(n):Rt=i,pf.current=null}function U0(n){var i=n;do{var a=i.alternate;if(n=i.return,i.flags&32768){if(a=UA(a,i),a!==null){a.flags&=32767,Rt=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Dt=6,Rt=null;return}}else if(a=zA(a,i,kn),a!==null){Rt=a;return}if(i=i.sibling,i!==null){Rt=i;return}Rt=i=n}while(i!==null);Dt===0&&(Dt=5)}function ya(n,i,a){var t=Ue,e=lr.transition;try{lr.transition=null,Ue=1,YA(n,i,a,t)}finally{lr.transition=e,Ue=t}return null}function YA(n,i,a,t){do So();while(Ui!==null);if(Ne&6)throw Error(Y(327));a=n.finishedWork;var e=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(Y(177));n.callbackNode=null,n.callbackPriority=0;var r=a.lanes|a.childLanes;if(My(n,r),n===Ft&&(Rt=Ft=null,Qt=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Il||(Il=!0,H0(fu,function(){return So(),null})),r=(a.flags&15990)!==0,a.subtreeFlags&15990||r){r=lr.transition,lr.transition=null;var o=Ue;Ue=1;var s=Ne;Ne|=4,pf.current=null,GA(n,a),I0(a,n),hA(Fd),vu=!!Nd,Fd=Nd=null,n.current=a,HA(a),yy(),Ne=s,Ue=o,lr.transition=r}else n.current=a;if(Il&&(Il=!1,Ui=n,bu=e),r=n.pendingLanes,r===0&&(qi=null),Sy(a.stateNode),bn(n,xt()),i!==null)for(t=n.onRecoverableError,a=0;a<i.length;a++)e=i[a],t(e.value,{componentStack:e.stack,digest:e.digest});if(Bu)throw Bu=!1,n=r_,r_=null,n;return bu&1&&n.tag!==0&&So(),r=n.pendingLanes,r&1?n===i_?Ss++:(Ss=0,i_=n):Ss=0,ua(),null}function So(){if(Ui!==null){var n=yg(bu),i=lr.transition,a=Ue;try{if(lr.transition=null,Ue=16>n?16:n,Ui===null)var t=!1;else{if(n=Ui,Ui=null,bu=0,Ne&6)throw Error(Y(331));var e=Ne;for(Ne|=4,ne=n.current;ne!==null;){var r=ne,o=r.child;if(ne.flags&16){var s=r.deletions;if(s!==null){for(var l=0;l<s.length;l++){var u=s[l];for(ne=u;ne!==null;){var c=ne;switch(c.tag){case 0:case 11:case 15:As(8,c,r)}var d=c.child;if(d!==null)d.return=c,ne=d;else for(;ne!==null;){c=ne;var _=c.sibling,f=c.return;if(b0(c),c===u){ne=null;break}if(_!==null){_.return=f,ne=_;break}ne=f}}}var v=r.alternate;if(v!==null){var p=v.child;if(p!==null){v.child=null;do{var g=p.sibling;p.sibling=null,p=g}while(p!==null)}}ne=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,ne=o;else e:for(;ne!==null;){if(r=ne,r.flags&2048)switch(r.tag){case 0:case 11:case 15:As(9,r,r.return)}var m=r.sibling;if(m!==null){m.return=r.return,ne=m;break e}ne=r.return}}var h=n.current;for(ne=h;ne!==null;){o=ne;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,ne=y;else e:for(o=h;ne!==null;){if(s=ne,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:dc(9,s)}}catch(S){vt(s,s.return,S)}if(s===o){ne=null;break e}var A=s.sibling;if(A!==null){A.return=s.return,ne=A;break e}ne=s.return}}if(Ne=e,ua(),qr&&typeof qr.onPostCommitFiberRoot=="function")try{qr.onPostCommitFiberRoot(rc,n)}catch{}t=!0}return t}finally{Ue=a,lr.transition=i}}return!1}function $h(n,i,a){i=Do(a,i),i=A0(n,i,1),n=Yi(n,i,1),i=_n(),n!==null&&(rl(n,1,i),bn(n,i))}function vt(n,i,a){if(n.tag===3)$h(n,n,a);else for(;i!==null;){if(i.tag===3){$h(i,n,a);break}else if(i.tag===1){var t=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof t.componentDidCatch=="function"&&(qi===null||!qi.has(t))){n=Do(a,n),n=x0(i,n,1),i=Yi(i,n,1),n=_n(),i!==null&&(rl(i,1,n),bn(i,n));break}}i=i.return}}function qA(n,i,a){var t=n.pingCache;t!==null&&t.delete(i),i=_n(),n.pingedLanes|=n.suspendedLanes&a,Ft===n&&(Qt&a)===a&&(Dt===4||Dt===3&&(Qt&130023424)===Qt&&500>xt()-mf?Pa(n,0):gf|=a),bn(n,i)}function k0(n,i){i===0&&(n.mode&1?(i=El,El<<=1,!(El&130023424)&&(El=4194304)):i=1);var a=_n();n=Ei(n,i),n!==null&&(rl(n,i,a),bn(n,a))}function JA(n){var i=n.memoizedState,a=0;i!==null&&(a=i.retryLane),k0(n,a)}function ZA(n,i){var a=0;switch(n.tag){case 13:var t=n.stateNode,e=n.memoizedState;e!==null&&(a=e.retryLane);break;case 19:t=n.stateNode;break;default:throw Error(Y(314))}t!==null&&t.delete(i),k0(n,a)}var G0;G0=function(n,i,a){if(n!==null)if(n.memoizedProps!==i.pendingProps||Pn.current)Rn=!0;else{if(!(n.lanes&a)&&!(i.flags&128))return Rn=!1,OA(n,i,a);Rn=!!(n.flags&131072)}else Rn=!1,it&&i.flags&1048576&&Qg(i,Su,i.index);switch(i.lanes=0,i.tag){case 2:var t=i.type;iu(n,i),n=i.pendingProps;var e=Mo(i,nn.current);xo(i,a),e=df(null,i,t,n,e,a);var r=_f();return i.flags|=1,typeof e=="object"&&e!==null&&typeof e.render=="function"&&e.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Bn(t)?(r=!0,Au(i)):r=!1,i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,of(i),e.updater=uc,i.stateNode=e,e._reactInternals=i,Xd(i,t,n,a),i=qd(null,i,t,!0,r,a)):(i.tag=0,it&&r&&K_(i),un(null,i,e,a),i=i.child),i;case 16:t=i.elementType;e:{switch(iu(n,i),n=i.pendingProps,e=t._init,t=e(t._payload),i.type=t,e=i.tag=$A(t),n=Sr(t,n),e){case 0:i=Yd(null,i,t,n,a);break e;case 1:i=Hh(null,i,t,n,a);break e;case 11:i=kh(null,i,t,n,a);break e;case 14:i=Gh(null,i,t,Sr(t.type,n),a);break e}throw Error(Y(306,t,""))}return i;case 0:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:Sr(t,e),Yd(n,i,t,e,a);case 1:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:Sr(t,e),Hh(n,i,t,e,a);case 3:e:{if(w0(i),n===null)throw Error(Y(387));t=i.pendingProps,r=i.memoizedState,e=r.element,qg(n,i),wu(i,t,null,a);var o=i.memoizedState;if(t=o.element,r.isDehydrated)if(r={element:t,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},i.updateQueue.baseState=r,i.memoizedState=r,i.flags&256){e=Do(Error(Y(423)),i),i=Wh(n,i,t,a,e);break e}else if(t!==e){e=Do(Error(Y(424)),i),i=Wh(n,i,t,a,e);break e}else for(Hn=ji(i.stateNode.containerInfo.firstChild),Wn=i,it=!0,Tr=null,a=$g(i,null,t,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Po(),t===e){i=wi(n,i,a);break e}un(n,i,t,a)}i=i.child}return i;case 5:return e0(i),n===null&&Hd(i),t=i.type,e=i.pendingProps,r=n!==null?n.memoizedProps:null,o=e.children,Od(t,e)?o=null:r!==null&&Od(t,r)&&(i.flags|=32),E0(n,i),un(n,i,o,a),i.child;case 6:return n===null&&Hd(i),null;case 13:return T0(n,i,a);case 4:return sf(i,i.stateNode.containerInfo),t=i.pendingProps,n===null?i.child=Bo(i,null,t,a):un(n,i,t,a),i.child;case 11:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:Sr(t,e),kh(n,i,t,e,a);case 7:return un(n,i,i.pendingProps,a),i.child;case 8:return un(n,i,i.pendingProps.children,a),i.child;case 12:return un(n,i,i.pendingProps.children,a),i.child;case 10:e:{if(t=i.type._context,e=i.pendingProps,r=i.memoizedProps,o=e.value,Ye(Cu,t._currentValue),t._currentValue=o,r!==null)if(Fr(r.value,o)){if(r.children===e.children&&!Pn.current){i=wi(n,i,a);break e}}else for(r=i.child,r!==null&&(r.return=i);r!==null;){var s=r.dependencies;if(s!==null){o=r.child;for(var l=s.firstContext;l!==null;){if(l.context===t){if(r.tag===1){l=vi(-1,a&-a),l.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}r.lanes|=a,l=r.alternate,l!==null&&(l.lanes|=a),Wd(r.return,a,i),s.lanes|=a;break}l=l.next}}else if(r.tag===10)o=r.type===i.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(Y(341));o.lanes|=a,s=o.alternate,s!==null&&(s.lanes|=a),Wd(o,a,i),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===i){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}un(n,i,e.children,a),i=i.child}return i;case 9:return e=i.type,t=i.pendingProps.children,xo(i,a),e=cr(e),t=t(e),i.flags|=1,un(n,i,t,a),i.child;case 14:return t=i.type,e=Sr(t,i.pendingProps),e=Sr(t.type,e),Gh(n,i,t,e,a);case 15:return S0(n,i,i.type,i.pendingProps,a);case 17:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:Sr(t,e),iu(n,i),i.tag=1,Bn(t)?(n=!0,Au(i)):n=!1,xo(i,a),Zg(i,t,e),Xd(i,t,e,a),qd(null,i,t,!0,n,a);case 19:return R0(n,i,a);case 22:return C0(n,i,a)}throw Error(Y(156,i.tag))};function H0(n,i){return vg(n,i)}function KA(n,i,a,t){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=t,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function or(n,i,a,t){return new KA(n,i,a,t)}function Sf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function $A(n){if(typeof n=="function")return Sf(n)?1:0;if(n!=null){if(n=n.$$typeof,n===U_)return 11;if(n===k_)return 14}return 2}function Zi(n,i){var a=n.alternate;return a===null?(a=or(n.tag,i,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=i,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,i=n.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function su(n,i,a,t,e,r){var o=2;if(t=n,typeof n=="function")Sf(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case to:return Ba(a.children,e,r,i);case z_:o=8,e|=8;break;case pd:return n=or(12,a,i,e|2),n.elementType=pd,n.lanes=r,n;case gd:return n=or(13,a,i,e),n.elementType=gd,n.lanes=r,n;case md:return n=or(19,a,i,e),n.elementType=md,n.lanes=r,n;case Kp:return fc(a,e,r,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Jp:o=10;break e;case Zp:o=9;break e;case U_:o=11;break e;case k_:o=14;break e;case Ii:o=16,t=null;break e}throw Error(Y(130,n==null?n:typeof n,""))}return i=or(o,a,i,e),i.elementType=n,i.type=t,i.lanes=r,i}function Ba(n,i,a,t){return n=or(7,n,t,i),n.lanes=a,n}function fc(n,i,a,t){return n=or(22,n,t,i),n.elementType=Kp,n.lanes=a,n.stateNode={isHidden:!1},n}function ad(n,i,a){return n=or(6,n,null,i),n.lanes=a,n}function od(n,i,a){return i=or(4,n.children!==null?n.children:[],n.key,i),i.lanes=a,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function e1(n,i,a,t,e){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Uc(0),this.expirationTimes=Uc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Uc(0),this.identifierPrefix=t,this.onRecoverableError=e,this.mutableSourceEagerHydrationData=null}function Cf(n,i,a,t,e,r,o,s,l){return n=new e1(n,i,a,s,l),i===1?(i=1,r===!0&&(i|=8)):i=0,r=or(3,null,null,i),n.current=r,r.stateNode=n,r.memoizedState={element:t,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},of(r),n}function t1(n,i,a){var t=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:eo,key:t==null?null:""+t,children:n,containerInfo:i,implementation:a}}function W0(n){if(!n)return na;n=n._reactInternals;e:{if(Qa(n)!==n||n.tag!==1)throw Error(Y(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Bn(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(Y(171))}if(n.tag===1){var a=n.type;if(Bn(a))return Hg(n,a,i)}return i}function Q0(n,i,a,t,e,r,o,s,l){return n=Cf(a,t,!0,n,e,r,o,s,l),n.context=W0(null),a=n.current,t=_n(),e=Ji(a),r=vi(t,e),r.callback=i??null,Yi(a,r,e),n.current.lanes=e,rl(n,e,t),bn(n,t),n}function hc(n,i,a,t){var e=i.current,r=_n(),o=Ji(e);return a=W0(a),i.context===null?i.context=a:i.pendingContext=a,i=vi(r,o),i.payload={element:n},t=t===void 0?null:t,t!==null&&(i.callback=t),n=Yi(e,i,o),n!==null&&(Vr(n,e,o,r),tu(n,e,o)),o}function Lu(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function ev(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<i?a:i}}function Ef(n,i){ev(n,i),(n=n.alternate)&&ev(n,i)}function n1(){return null}var X0=typeof reportError=="function"?reportError:function(n){console.error(n)};function wf(n){this._internalRoot=n}vc.prototype.render=wf.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(Y(409));hc(n,i,null,null)};vc.prototype.unmount=wf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;Fa(function(){hc(null,n,null,null)}),i[Ci]=null}};function vc(n){this._internalRoot=n}vc.prototype.unstable_scheduleHydration=function(n){if(n){var i=Sg();n={blockedOn:null,target:n,priority:i};for(var a=0;a<Fi.length&&i!==0&&i<Fi[a].priority;a++);Fi.splice(a,0,n),a===0&&Eg(n)}};function Tf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function pc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function tv(){}function r1(n,i,a,t,e){if(e){if(typeof t=="function"){var r=t;t=function(){var u=Lu(o);r.call(u)}}var o=Q0(i,t,n,0,null,!1,!1,"",tv);return n._reactRootContainer=o,n[Ci]=o.current,Fs(n.nodeType===8?n.parentNode:n),Fa(),o}for(;e=n.lastChild;)n.removeChild(e);if(typeof t=="function"){var s=t;t=function(){var u=Lu(l);s.call(u)}}var l=Cf(n,0,!1,null,null,!1,!1,"",tv);return n._reactRootContainer=l,n[Ci]=l.current,Fs(n.nodeType===8?n.parentNode:n),Fa(function(){hc(i,l,a,t)}),l}function gc(n,i,a,t,e){var r=a._reactRootContainer;if(r){var o=r;if(typeof e=="function"){var s=e;e=function(){var l=Lu(o);s.call(l)}}hc(i,o,n,e)}else o=r1(a,i,n,e,t);return Lu(o)}Ag=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var a=cs(i.pendingLanes);a!==0&&(W_(i,a|1),bn(i,xt()),!(Ne&6)&&(Lo=xt()+500,ua()))}break;case 13:Fa(function(){var t=Ei(n,1);if(t!==null){var e=_n();Vr(t,n,1,e)}}),Ef(n,1)}};Q_=function(n){if(n.tag===13){var i=Ei(n,134217728);if(i!==null){var a=_n();Vr(i,n,134217728,a)}Ef(n,134217728)}};xg=function(n){if(n.tag===13){var i=Ji(n),a=Ei(n,i);if(a!==null){var t=_n();Vr(a,n,i,t)}Ef(n,i)}};Sg=function(){return Ue};Cg=function(n,i){var a=Ue;try{return Ue=n,i()}finally{Ue=a}};Md=function(n,i,a){switch(i){case"input":if(xd(n,a),i=a.name,a.type==="radio"&&i!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var t=a[i];if(t!==n&&t.form===n.form){var e=sc(t);if(!e)throw Error(Y(90));eg(t),xd(t,e)}}}break;case"textarea":ng(n,a);break;case"select":i=a.value,i!=null&&go(n,!!a.multiple,i,!1)}};ug=yf;cg=Fa;var i1={usingClientEntryPoint:!1,Events:[al,ao,sc,sg,lg,yf]},rs={findFiberByHostInstance:xa,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},a1={bundleType:rs.bundleType,version:rs.version,rendererPackageName:rs.rendererPackageName,rendererConfig:rs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ri.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=fg(n),n===null?null:n.stateNode},findFiberByHostInstance:rs.findFiberByHostInstance||n1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vl.isDisabled&&Vl.supportsFiber)try{rc=Vl.inject(a1),qr=Vl}catch{}}Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=i1;Jn.createPortal=function(n,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tf(i))throw Error(Y(200));return t1(n,i,null,a)};Jn.createRoot=function(n,i){if(!Tf(n))throw Error(Y(299));var a=!1,t="",e=X0;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(t=i.identifierPrefix),i.onRecoverableError!==void 0&&(e=i.onRecoverableError)),i=Cf(n,1,!1,null,null,a,!1,t,e),n[Ci]=i.current,Fs(n.nodeType===8?n.parentNode:n),new wf(i)};Jn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(Y(188)):(n=Object.keys(n).join(","),Error(Y(268,n)));return n=fg(i),n=n===null?null:n.stateNode,n};Jn.flushSync=function(n){return Fa(n)};Jn.hydrate=function(n,i,a){if(!pc(i))throw Error(Y(200));return gc(null,n,i,!0,a)};Jn.hydrateRoot=function(n,i,a){if(!Tf(n))throw Error(Y(405));var t=a!=null&&a.hydratedSources||null,e=!1,r="",o=X0;if(a!=null&&(a.unstable_strictMode===!0&&(e=!0),a.identifierPrefix!==void 0&&(r=a.identifierPrefix),a.onRecoverableError!==void 0&&(o=a.onRecoverableError)),i=Q0(i,null,n,1,a??null,e,!1,r,o),n[Ci]=i.current,Fs(n),t)for(n=0;n<t.length;n++)a=t[n],e=a._getVersion,e=e(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,e]:i.mutableSourceEagerHydrationData.push(a,e);return new vc(i)};Jn.render=function(n,i,a){if(!pc(i))throw Error(Y(200));return gc(null,n,i,!1,a)};Jn.unmountComponentAtNode=function(n){if(!pc(n))throw Error(Y(40));return n._reactRootContainer?(Fa(function(){gc(null,null,n,!1,function(){n._reactRootContainer=null,n[Ci]=null})}),!0):!1};Jn.unstable_batchedUpdates=yf;Jn.unstable_renderSubtreeIntoContainer=function(n,i,a,t){if(!pc(a))throw Error(Y(200));if(n==null||n._reactInternals===void 0)throw Error(Y(38));return gc(n,i,a,!1,t)};Jn.version="18.2.0-next-9e3b772b8-20220608";function j0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(j0)}catch(n){console.error(n)}}j0(),Qp.exports=Jn;var o1=Qp.exports,Y0,nv=o1;Y0=nv.createRoot,nv.hydrateRoot;var ht;(function(n){n[n.Disjoint=0]="Disjoint",n[n.Contains=1]="Contains",n[n.Intersects=2]="Intersects"})(ht||(ht={}));var sn;(function(n){n[n.Back=0]="Back",n[n.Front=1]="Front",n[n.Intersecting=2]="Intersecting"})(sn||(sn={}));var Se;(function(n){n[n.Near=0]="Near",n[n.Far=1]="Far",n[n.Left=2]="Left",n[n.Right=3]="Right",n[n.Bottom=4]="Bottom",n[n.Top=5]="Top"})(Se||(Se={}));function rv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Xo(n,i,a){return i&&rv(n.prototype,i),a&&rv(n,a),n}var G=function(){function n(){}return n.clamp=function(a,t,e){return Math.max(t,Math.min(e,a))},n.equals=function(a,t){return Math.abs(a-t)<=n.zeroTolerance},n.isPowerOf2=function(a){return(a&a-1)===0},n.radianToDegree=function(a){return a*n.radToDegreeFactor},n.degreeToRadian=function(a){return a*n.degreeToRadFactor},n}();(function(){G.zeroTolerance=1e-6})();(function(){G.radToDegreeFactor=180/Math.PI})();(function(){G.degreeToRadFactor=Math.PI/180})();var M=function(){function n(a,t,e){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),this._onValueChanged=null,this._x=a,this._y=t,this._z=e}var i=n.prototype;return i.set=function(t,e,r){return this._x=t,this._y=e,this._z=r,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y,o=t._z;return Math.sqrt(e*e+r*r+o*o)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y,o=t._z;return e*e+r*r+o*o},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return n.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._onValueChanged&&this._onValueChanged(),this},i.transformNormal=function(t){return n.transformNormal(this,t,this),this},i.transformToVec3=function(t){return n.transformToVec3(this,t,this),this},i.transformCoordinate=function(t){return n.transformCoordinate(this,t,this),this},i.transformByQuat=function(t){return n.transformByQuat(this,t,this),this},i.clone=function(){return new n(this._x,this._y,this._z)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z},i.toJSON=function(){return{x:this._x,y:this._y,z:this._z}},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._z=t._z+e._z,r._onValueChanged&&r._onValueChanged()},n.subtract=function(t,e,r){r._x=t._x-e._x,r._y=t._y-e._y,r._z=t._z-e._z,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){r._x=t._x*e._x,r._y=t._y*e._y,r._z=t._z*e._z,r._onValueChanged&&r._onValueChanged()},n.divide=function(t,e,r){r._x=t._x/e._x,r._y=t._y/e._y,r._z=t._z/e._z,r._onValueChanged&&r._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z},n.cross=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e._x,c=e._y,d=e._z;r.set(s*d-l*c,l*u-o*d,o*c-s*u)},n.distance=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z;return Math.sqrt(r*r+o*o+s*s)},n.distanceSquared=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z;return r*r+o*o+s*s},n.equals=function(t,e){return G.equals(t._x,e._x)&&G.equals(t._y,e._y)&&G.equals(t._z,e._z)},n.lerp=function(t,e,r,o){var s=t._x,l=t._y,u=t._z;o._x=s+(e._x-s)*r,o._y=l+(e._y-l)*r,o._z=u+(e._z-u)*r,o._onValueChanged&&o._onValueChanged()},n.max=function(t,e,r){r._x=Math.max(t._x,e._x),r._y=Math.max(t._y,e._y),r._z=Math.max(t._z,e._z),r._onValueChanged&&r._onValueChanged()},n.min=function(t,e,r){r._x=Math.min(t._x,e._x),r._y=Math.min(t._y,e._y),r._z=Math.min(t._z,e._z),r._onValueChanged&&r._onValueChanged()},n.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._onValueChanged&&e._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=t._z,l=Math.sqrt(r*r+o*o+s*s);l>G.zeroTolerance&&(l=1/l,e.set(r*l,o*l,s*l))},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._z=t._z*e,r._onValueChanged&&r._onValueChanged()},n.transformNormal=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements;r._x=o*u[0]+s*u[4]+l*u[8],r._y=o*u[1]+s*u[5]+l*u[9],r._z=o*u[2]+s*u[6]+l*u[10],r._onValueChanged&&r._onValueChanged()},n.transformToVec3=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements;r._x=o*u[0]+s*u[4]+l*u[8]+u[12],r._y=o*u[1]+s*u[5]+l*u[9]+u[13],r._z=o*u[2]+s*u[6]+l*u[10]+u[14],r._onValueChanged&&r._onValueChanged()},n.transformToVec4=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements;r._x=o*u[0]+s*u[4]+l*u[8]+u[12],r._y=o*u[1]+s*u[5]+l*u[9]+u[13],r._z=o*u[2]+s*u[6]+l*u[10]+u[14],r._w=o*u[3]+s*u[7]+l*u[11]+u[15],r._onValueChanged&&r._onValueChanged()},n.transformCoordinate=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e.elements,c=o*u[3]+s*u[7]+l*u[11]+u[15];c=1/c,r._x=(o*u[0]+s*u[4]+l*u[8]+u[12])*c,r._y=(o*u[1]+s*u[5]+l*u[9]+u[13])*c,r._z=(o*u[2]+s*u[6]+l*u[10]+u[14])*c,r._onValueChanged&&r._onValueChanged()},n.transformByQuat=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=e._x,c=e._y,d=e._z,_=e._w,f=_*o+c*l-d*s,v=_*s+d*o-u*l,p=_*l+u*s-c*o,g=-u*o-c*s-d*l;r._x=f*_-g*u-v*d+p*c,r._y=v*_-g*c-p*u+f*d,r._z=p*_-g*d-f*c+v*u,r._onValueChanged&&r._onValueChanged()},Xo(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}}]),n}();(function(){M._zero=new M(0,0,0)})();(function(){M._one=new M(1,1,1)})();var sl=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=0),this.center=new M,this.radius=0,a&&this.center.copyFrom(a),this.radius=t}var i=n.prototype;return i.clone=function(){return new n(this.center,this.radius)},i.copyFrom=function(t){return this.center.copyFrom(t.center),this.radius=t.radius,this},n.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var r=t.length,o=n._tempVec30;o.x=o.y=o.z=0;for(var s=0;s<r;++s)M.add(t[s],o,o);M.scale(o,1/r,e.center);for(var l=0,u=0;u<r;++u){var c=M.distanceSquared(o,t[u]);c>l&&(l=c)}e.radius=Math.sqrt(l)},n.fromBox=function(t,e){var r=e.center,o=t.min,s=t.max;r.x=(o.x+s.x)*.5,r.y=(o.y+s.y)*.5,r.z=(o.z+s.z)*.5,e.radius=M.distance(r,s)},n}();(function(){sl._tempVec30=new M})();var jt=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=null),this.min=new M,this.max=new M,a&&this.min.copyFrom(a),t&&this.max.copyFrom(t)}var i=n.prototype;return i.getCenter=function(t){var e=this,r=e.min,o=e.max,s=o._x+r._x,l=o._y+r._y,u=o._z+r._z;return t.set(isNaN(s)?0:s*.5,isNaN(l)?0:l*.5,isNaN(u)?0:u*.5),t},i.getExtent=function(t){var e=this,r=e.min,o=e.max,s=o._x-r._x,l=o._y-r._y,u=o._z-r._z;return t.set(isNaN(s)?0:s*.5,isNaN(l)?0:l*.5,isNaN(u)?0:u*.5),t},i.getCorners=function(t){t===void 0&&(t=[]);var e=this,r=e.min,o=e.max,s=r.x,l=r.y,u=r.z,c=o.x,d=o.y,_=o.z,f=t.length;if(f<8)for(var v=0,p=8-f;v<p;++v)t[f+v]=new M;return t[0].set(s,d,_),t[1].set(c,d,_),t[2].set(c,l,_),t[3].set(s,l,_),t[4].set(s,d,u),t[5].set(c,d,u),t[6].set(c,l,u),t[7].set(s,l,u),t},i.transform=function(t){return n.transform(this,t,this),this},i.clone=function(){return new n(this.min,this.max)},i.copyFrom=function(t){return this.min.copyFrom(t.min),this.max.copyFrom(t.max),this},n.fromCenterAndExtent=function(t,e,r){M.subtract(t,e,r.min),M.add(t,e,r.max)},n.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var r=e.min,o=e.max;r.x=r.y=r.z=Number.MAX_VALUE,o.x=o.y=o.z=-Number.MAX_VALUE;for(var s=0,l=t.length;s<l;++s){var u=t[s];M.min(r,u,r),M.max(o,u,o)}},n.fromSphere=function(t,e){var r=t.center,o=t.radius,s=e.min,l=e.max;s.x=r.x-o,s.y=r.y-o,s.z=r.z-o,l.x=r.x+o,l.y=r.y+o,l.z=r.z+o},n.transform=function(t,e,r){var o=n._tempVec30,s=n._tempVec31;t.getCenter(o),t.getExtent(s),M.transformCoordinate(o,e,o);var l=s.x,u=s.y,c=s.z,d=e.elements,_=d[0],f=d[1],v=d[2],p=d[4],g=d[5],m=d[6],h=d[8],y=d[9],A=d[10];s.set((_===0?0:Math.abs(l*_))+(p===0?0:Math.abs(u*p))+(h===0?0:Math.abs(c*h)),(f===0?0:Math.abs(l*f))+(g===0?0:Math.abs(u*g))+(y===0?0:Math.abs(c*y)),(v===0?0:Math.abs(l*v))+(m===0?0:Math.abs(u*m))+(A===0?0:Math.abs(c*A))),M.subtract(o,s,r.min),M.add(o,s,r.max)},n.merge=function(t,e,r){return M.min(t.min,e.min,r.min),M.max(t.max,e.max,r.max),r},n}();(function(){jt._tempVec30=new M})();(function(){jt._tempVec31=new M})();var Et=function(){function n(){}return n.intersectionPointThreePlanes=function(a,t,e,r){var o=a.normal,s=t.normal,l=e.normal;M.cross(s,l,n._tempVec30),M.cross(l,o,n._tempVec31),M.cross(o,s,n._tempVec32);var u=-M.dot(o,n._tempVec30),c=-M.dot(s,n._tempVec31),d=-M.dot(l,n._tempVec32);M.scale(n._tempVec30,a.distance/u,n._tempVec30),M.scale(n._tempVec31,t.distance/c,n._tempVec31),M.scale(n._tempVec32,e.distance/d,n._tempVec32),M.add(n._tempVec30,n._tempVec31,r),M.add(r,n._tempVec32,r)},n.distancePlaneAndPoint=function(a,t){return M.dot(a.normal,t)+a.distance},n.intersectsPlaneAndPoint=function(a,t){var e=n.distancePlaneAndPoint(a,t);return e>0?sn.Front:e<0?sn.Back:sn.Intersecting},n.intersectsPlaneAndBox=function(a,t){var e=t.min,r=t.max,o=a.normal,s=n._tempVec30,l=n._tempVec31;return o.x>=0?(s.x=r.x,l.x=e.x):(s.x=e.x,l.x=r.x),o.y>=0?(s.y=r.y,l.y=e.y):(s.y=e.y,l.y=r.y),o.z>=0?(s.z=r.z,l.z=e.z):(s.z=e.z,l.z=r.z),n.distancePlaneAndPoint(a,s)<0?sn.Back:n.distancePlaneAndPoint(a,l)>0?sn.Front:sn.Intersecting},n.intersectsPlaneAndSphere=function(a,t){var e=t.center,r=t.radius,o=n.distancePlaneAndPoint(a,e);return o>r?sn.Front:o<-r?sn.Back:sn.Intersecting},n.intersectsRayAndPlane=function(a,t){var e=t.normal,r=G.zeroTolerance,o=M.dot(e,a.direction);if(Math.abs(o)<r)return-1;var s=M.dot(e,a.origin),l=(-t.distance-s)/o;if(l<0){if(l<-r)return-1;l=0}return l},n.intersectsRayAndBox=function(a,t){var e=G.zeroTolerance,r=a.origin,o=a.direction,s=t.min,l=t.max,u=o.x,c=o.y,d=o.z,_=r.x,f=r.y,v=r.z,p=0,g=Number.MAX_VALUE;if(Math.abs(u)<e){if(_<s.x||_>l.x)return-1}else{var m=1/u,h=(s.x-_)*m,y=(l.x-_)*m;if(h>y){var A=h;h=y,y=A}if(p=Math.max(h,p),g=Math.min(y,g),p>g)return-1}if(Math.abs(c)<e){if(f<s.y||f>l.y)return-1}else{var S=1/c,x=(s.y-f)*S,C=(l.y-f)*S;if(x>C){var E=x;x=C,C=E}if(p=Math.max(x,p),g=Math.min(C,g),p>g)return-1}if(Math.abs(d)<e){if(v<s.z||v>l.z)return-1}else{var T=1/d,w=(s.z-v)*T,R=(l.z-v)*T;if(w>R){var b=w;w=R,R=b}if(p=Math.max(w,p),g=Math.min(R,g),p>g)return-1}return p},n.intersectsRayAndSphere=function(a,t){var e=a.origin,r=a.direction,o=t.center,s=t.radius,l=n._tempVec30;M.subtract(e,o,l);var u=M.dot(l,r),c=M.dot(l,l)-s*s;if(u>0&&c>0)return-1;var d=u*u-c;if(d<0)return-1;var _=-u-Math.sqrt(d);return _<0&&(_=0),_},n.intersectsBoxAndBox=function(a,t){return a.min.x>t.max.x||t.min.x>a.max.x||a.min.y>t.max.y||t.min.y>a.max.y?!1:!(a.min.z>t.max.z||t.min.z>a.max.z)},n.intersectsSphereAndSphere=function(a,t){var e=a.radius+t.radius;return M.distanceSquared(a.center,t.center)<e*e},n.intersectsSphereAndBox=function(a,t){var e=a.center,r=t.max,o=t.min,s=n._tempVec30;s.set(Math.max(o.x,Math.min(e.x,r.x)),Math.max(o.y,Math.min(e.y,r.y)),Math.max(o.z,Math.min(e.z,r.z)));var l=M.distanceSquared(e,s);return l<=a.radius*a.radius},n.intersectsFrustumAndBox=function(a,t){for(var e=t.min,r=t.max,o=n._tempVec30,s=0;s<6;++s){var l=a.getPlane(s),u=l.normal;if(o.set(u.x>=0?r.x:e.x,u.y>=0?r.y:e.y,u.z>=0?r.z:e.z),M.dot(u,o)<-l.distance)return!1}return!0},n.frustumContainsPoint=function(a,t){var e=n.distancePlaneAndPoint(a.near,t);return Math.abs(e)<G.zeroTolerance?ht.Intersects:e<0?ht.Disjoint:(e=n.distancePlaneAndPoint(a.far,t),Math.abs(e)<G.zeroTolerance?ht.Intersects:e<0?ht.Disjoint:(e=n.distancePlaneAndPoint(a.left,t),Math.abs(e)<G.zeroTolerance?ht.Intersects:e<0?ht.Disjoint:(e=n.distancePlaneAndPoint(a.right,t),Math.abs(e)<G.zeroTolerance?ht.Intersects:e<0?ht.Disjoint:(e=n.distancePlaneAndPoint(a.top,t),Math.abs(e)<G.zeroTolerance?ht.Intersects:e<0?ht.Disjoint:(e=n.distancePlaneAndPoint(a.bottom,t),Math.abs(e)<G.zeroTolerance?ht.Intersects:e<0?ht.Disjoint:ht.Contains)))))},n.frustumContainsBox=function(a,t){for(var e=t.min,r=t.max,o=n._tempVec30,s=n._tempVec31,l=ht.Contains,u=0;u<6;++u){var c=a.getPlane(u),d=c.normal;if(d.x>=0?(o.x=r.x,s.x=e.x):(o.x=e.x,s.x=r.x),d.y>=0?(o.y=r.y,s.y=e.y):(o.y=e.y,s.y=r.y),d.z>=0?(o.z=r.z,s.z=e.z):(o.z=e.z,s.z=r.z),n.intersectsPlaneAndPoint(c,o)===sn.Back)return ht.Disjoint;n.intersectsPlaneAndPoint(c,s)===sn.Back&&(l=ht.Intersects)}return l},n.frustumContainsSphere=function(a,t){for(var e=ht.Contains,r=0;r<6;++r){var o=a.getPlane(r),s=n.intersectsPlaneAndSphere(o,t);if(s===sn.Back)return ht.Disjoint;if(s===sn.Intersecting){e=ht.Intersects;break}}return e},n}();(function(){Et._tempVec30=new M})();(function(){Et._tempVec31=new M})();(function(){Et._tempVec32=new M})();var Mt=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=0),this.normal=new M,this.distance=0,a&&this.normal.copyFrom(a),this.distance=t}var i=n.prototype;return i.normalize=function(){return n.normalize(this,this),this},i.clone=function(){var t=new n;return t.copyFrom(this),t},i.copyFrom=function(t){return this.normal.copyFrom(t.normal),this.distance=t.distance,this},n.normalize=function(t,e){var r=t.normal,o=1/r.length();M.scale(r,o,e.normal),e.distance=t.distance*o},n.fromPoints=function(t,e,r,o){var s=t.x,l=t.y,u=t.z,c=e.x-s,d=e.y-l,_=e.z-u,f=r.x-s,v=r.y-l,p=r.z-u,g=d*p-_*v,m=_*f-c*p,h=c*v-d*f,y=1/Math.sqrt(g*g+m*m+h*h),A=g*y,S=m*y,x=h*y,C=o.normal;C.x=A,C.y=S,C.z=x,o.distance=-(A*s+S*l+x*u)},n}(),s1=function(){function n(a){a===void 0&&(a=null),this.near=new Mt,this.far=new Mt,this.left=new Mt,this.right=new Mt,this.top=new Mt,this.bottom=new Mt,a&&this.calculateFromMatrix(a)}var i=n.prototype;return i.getPlane=function(t){switch(t){case Se.Near:return this.near;case Se.Far:return this.far;case Se.Left:return this.left;case Se.Right:return this.right;case Se.Bottom:return this.bottom;case Se.Top:return this.top;default:return null}},i.calculateFromMatrix=function(t){var e=t.elements,r=e[0],o=e[1],s=e[2],l=e[3],u=e[4],c=e[5],d=e[6],_=e[7],f=e[8],v=e[9],p=e[10],g=e[11],m=e[12],h=e[13],y=e[14],A=e[15],S=this.near.normal;S.set(l+s,_+d,g+p),this.near.distance=A+y,this.near.normalize();var x=this.far.normal;x.set(l-s,_-d,g-p),this.far.distance=A-y,this.far.normalize();var C=this.left.normal;C.set(l+r,_+u,g+f),this.left.distance=A+m,this.left.normalize();var E=this.right.normal;E.set(l-r,_-u,g-f),this.right.distance=A-m,this.right.normalize();var T=this.bottom.normal;T.set(l+o,_+c,g+v),this.bottom.distance=A+h,this.bottom.normalize();var w=this.top.normal;w.set(l-o,_-c,g-v),this.top.distance=A-h,this.top.normalize()},i.intersectsBox=function(t){return Et.intersectsFrustumAndBox(this,t)},i.intersectsSphere=function(t){return Et.frustumContainsSphere(this,t)!==ht.Disjoint},i.clone=function(){var t=new n;return t.copyFrom(this),t},i.copyFrom=function(t){return this.near.copyFrom(t.near),this.far.copyFrom(t.far),this.left.copyFrom(t.left),this.right.copyFrom(t.right),this.bottom.copyFrom(t.bottom),this.top.copyFrom(t.top),this},n}(),Io=function(){function n(a,t,e,r,o,s,l,u,c){a===void 0&&(a=1),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),o===void 0&&(o=1),s===void 0&&(s=0),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=1),this.elements=new Float32Array(9);var d=this.elements;d[0]=a,d[1]=t,d[2]=e,d[3]=r,d[4]=o,d[5]=s,d[6]=l,d[7]=u,d[8]=c}var i=n.prototype;return i.set=function(t,e,r,o,s,l,u,c,d){var _=this.elements;return _[0]=t,_[1]=e,_[2]=r,_[3]=o,_[4]=s,_[5]=l,_[6]=u,_[7]=c,_[8]=d,this},i.add=function(t){return n.add(this,t,this),this},i.subtract=function(t){return n.subtract(this,t,this),this},i.multiply=function(t){return n.multiply(this,t,this),this},i.determinant=function(){var t=this.elements,e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],c=t[6],d=t[7],_=t[8],f=_*l-u*d,v=-_*s+u*c,p=d*s-l*c;return e*f+r*v+o*p},i.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},i.invert=function(){return n.invert(this,this),this},i.rotate=function(t){return n.rotate(this,t,this),this},i.scale=function(t){return n.scale(this,t,this),this},i.translate=function(t){return n.translate(this,t,this),this},i.transpose=function(){return n.transpose(this,this),this},i.clone=function(){var t=this.elements,e=new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);return e},i.copyFrom=function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},i.copyFromArray=function(t,e){e===void 0&&(e=0);for(var r=this.elements,o=0;o<12;o++)r[o]=t[o+e];return this},i.copyToArray=function(t,e){e===void 0&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8]},i.copyFromMatrix=function(t){var e=t.elements,r=this.elements;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],this},n.add=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8]},n.subtract=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements;l[0]=o[0]-s[0],l[1]=o[1]-s[1],l[2]=o[2]-s[2],l[3]=o[3]-s[3],l[4]=o[4]-s[4],l[5]=o[5]-s[5],l[6]=o[6]-s[6],l[7]=o[7]-s[7],l[8]=o[8]-s[8]},n.multiply=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements,u=o[0],c=o[1],d=o[2],_=o[3],f=o[4],v=o[5],p=o[6],g=o[7],m=o[8],h=s[0],y=s[1],A=s[2],S=s[3],x=s[4],C=s[5],E=s[6],T=s[7],w=s[8];l[0]=u*h+_*y+p*A,l[1]=c*h+f*y+g*A,l[2]=d*h+v*y+m*A,l[3]=u*S+_*x+p*C,l[4]=c*S+f*x+g*C,l[5]=d*S+v*x+m*C,l[6]=u*E+_*T+p*w,l[7]=c*E+f*T+g*w,l[8]=d*E+v*T+m*w},n.equals=function(t,e){var r=t.elements,o=e.elements;return G.equals(r[0],o[0])&&G.equals(r[1],o[1])&&G.equals(r[2],o[2])&&G.equals(r[3],o[3])&&G.equals(r[4],o[4])&&G.equals(r[5],o[5])&&G.equals(r[6],o[6])&&G.equals(r[7],o[7])&&G.equals(r[8],o[8])},n.lerp=function(t,e,r,o){var s=t.elements,l=e.elements,u=o.elements,c=1-r;u[0]=s[0]*c+l[0]*r,u[1]=s[1]*c+l[1]*r,u[2]=s[2]*c+l[2]*r,u[3]=s[3]*c+l[3]*r,u[4]=s[4]*c+l[4]*r,u[5]=s[5]*c+l[5]*r,u[6]=s[6]*c+l[6]*r,u[7]=s[7]*c+l[7]*r,u[8]=s[8]*c+l[8]*r},n.rotationQuaternion=function(t,e){var r=e.elements,o=t._x,s=t._y,l=t._z,u=t._w,c=o+o,d=s+s,_=l+l,f=o*c,v=s*c,p=s*d,g=l*c,m=l*d,h=l*_,y=u*c,A=u*d,S=u*_;r[0]=1-p-h,r[3]=v-S,r[6]=g+A,r[1]=v+S,r[4]=1-f-h,r[7]=m-y,r[2]=g-A,r[5]=m+y,r[8]=1-f-p},n.scaling=function(t,e){var r=e.elements;r[0]=t._x,r[1]=0,r[2]=0,r[3]=0,r[4]=t._y,r[5]=0,r[6]=0,r[7]=0,r[8]=1},n.translation=function(a,t){var e=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=a._x,e[7]=a._y,e[8]=1},n.invert=function(t,e){var r=t.elements,o=e.elements,s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],_=r[5],f=r[6],v=r[7],p=r[8],g=p*d-_*v,m=-p*c+_*f,h=v*c-d*f,y=s*g+l*m+u*h;y&&(y=1/y,o[0]=g*y,o[1]=(-p*l+u*v)*y,o[2]=(_*l-u*d)*y,o[3]=m*y,o[4]=(p*s-u*f)*y,o[5]=(-_*s+u*c)*y,o[6]=h*y,o[7]=(-v*s+l*f)*y,o[8]=(d*s-l*c)*y)},n.normalMatrix=function(t,e){var r=t.elements,o=e.elements,s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],_=r[5],f=r[6],v=r[7],p=r[8],g=r[9],m=r[10],h=r[11],y=r[12],A=r[13],S=r[14],x=r[15],C=s*_-l*d,E=s*f-u*d,T=s*v-c*d,w=l*f-u*_,R=l*v-c*_,b=u*v-c*f,B=p*A-g*y,I=p*S-m*y,V=p*x-h*y,L=g*S-m*A,F=g*x-h*A,D=m*x-h*S,N=C*D-E*F+T*L+w*V-R*I+b*B;if(!N)return null;N=1/N,o[0]=(_*D-f*F+v*L)*N,o[1]=(f*V-d*D-v*I)*N,o[2]=(d*F-_*V+v*B)*N,o[3]=(u*F-l*D-c*L)*N,o[4]=(s*D-u*V+c*I)*N,o[5]=(l*V-s*F-c*B)*N,o[6]=(A*b-S*R+x*w)*N,o[7]=(S*T-y*b-x*E)*N,o[8]=(y*R-A*T+x*C)*N},n.rotate=function(t,e,r){var o=t.elements,s=r.elements,l=Math.sin(e),u=Math.cos(e),c=o[0],d=o[1],_=o[2],f=o[3],v=o[4],p=o[5],g=o[6],m=o[7],h=o[8];s[0]=u*c+l*f,s[1]=u*d+l*v,s[2]=u*_+l*p,s[3]=u*f-l*c,s[4]=u*v-l*d,s[5]=u*p-l*_,s[6]=g,s[7]=m,s[8]=h},n.scale=function(t,e,r){var o=e._x,s=e._y,l=t.elements,u=r.elements;u[0]=o*l[0],u[1]=o*l[1],u[2]=o*l[2],u[3]=s*l[3],u[4]=s*l[4],u[5]=s*l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8]},n.translate=function(t,e,r){var o=e._x,s=e._y,l=t.elements,u=r.elements,c=l[0],d=l[1],_=l[2],f=l[3],v=l[4],p=l[5],g=l[6],m=l[7],h=l[8];u[0]=c,u[1]=d,u[2]=_,u[3]=f,u[4]=v,u[5]=p,u[6]=o*c+s*f+g,u[7]=o*d+s*v+m,u[8]=o*_+s*p+h},n.transpose=function(t,e){var r=t.elements,o=e.elements;if(e===t){var s=r[1],l=r[2],u=r[5];o[1]=r[3],o[2]=r[6],o[3]=s,o[5]=r[7],o[6]=l,o[7]=u}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8]},n}(),xe=function(){function n(a,t,e,r){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=1),this._onValueChanged=null,this._x=a,this._y=t,this._z=e,this._w=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._x=t,this._y=e,this._z=r,this._w=o,this._onValueChanged&&this._onValueChanged(),this},i.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onValueChanged&&this._onValueChanged(),this},i.getAxisAngle=function(t){var e=this,r=e._x,o=e._y,s=e._z,l=r*r+o*o+s*s;if(l<G.zeroTolerance)return t._x=1,t._y=0,t._z=0,0;var u=1/l;return t._x=this._x*u,t._y=this._y*u,t._z=this._z*u,Math.acos(this._w)*2},i.identity=function(){return this._x=0,this._y=0,this._z=0,this._w=1,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return Math.sqrt(e*e+r*r+o*o+s*s)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return e*e+r*r+o*o+s*s},i.normalize=function(){return n.normalize(this,this),this},i.toEuler=function(t){this._toYawPitchRoll(t);var e=t._x;return t._x=t._y,t._y=e,t._onValueChanged&&t._onValueChanged(),t},i.toYawPitchRoll=function(t){return this._toYawPitchRoll(t),t._onValueChanged&&t._onValueChanged(),t},i.rotateX=function(t){return n.rotateX(this,t,this),this},i.rotateY=function(t){return n.rotateY(this,t,this),this},i.rotateZ=function(t){return n.rotateZ(this,t,this),this},i.rotationAxisAngle=function(t,e){return n.rotationAxisAngle(t,e,this),this},i.multiply=function(t){return n.multiply(this,t,this),this},i.invert=function(){return n.invert(this,this),this},i.dot=function(t){return n.dot(this,t)},i.lerp=function(t,e){return n.lerp(this,t,e,this),this},i.rotateAxisAngle=function(t,e){return n._tempQuat1.rotationAxisAngle(t,e),this.multiply(n._tempQuat1),this},i.clone=function(){return new n(this._x,this._y,this._z,this._w)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},i.toJSON=function(){return{x:this._x,y:this._y,z:this._z,w:this._w}},i._toYawPitchRoll=function(t){var e=this,r=e._x,o=e._y,s=e._z,l=e._w,u=r*r,c=o*o,d=s*s,_=l*l,f=u+c+d+_,v=2*(r*l-o*s);v>(1-G.zeroTolerance)*f?(t._x=Math.atan2(2*(l*o-r*s),d+_-c-d),t._y=Math.PI/2,t._z=0):v<-(1-G.zeroTolerance)*f?(t._x=Math.atan2(2*(l*o-r*s),d+_-c-d),t._y=-Math.PI/2,t._z=0):(t._x=Math.atan2(2*(s*r+o*l),d+_-c-u),t._y=Math.asin(v/f),t._z=Math.atan2(2*(r*o+s*l),c+_-d-u))},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._z=t._z+e._z,r._w=t._w+e._w,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w,c=e._x,d=e._y,_=e._z,f=e._w;r._x=o*f+u*c+s*_-l*d,r._y=s*f+u*d+l*c-o*_,r._z=l*f+u*_+o*d-s*c,r._w=u*f-o*c-s*d-l*_,r._onValueChanged&&r._onValueChanged()},n.conjugate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=t._w,e._onValueChanged&&e._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},n.equals=function(t,e){return G.equals(t._x,e._x)&&G.equals(t._y,e._y)&&G.equals(t._z,e._z)&&G.equals(t._w,e._w)},n.rotationAxisAngle=function(t,e,r){var o=n._tempVector3;M.normalize(t,o),e*=.5;var s=Math.sin(e);r._x=o._x*s,r._y=o._y*s,r._z=o._z*s,r._w=Math.cos(e),r._onValueChanged&&r._onValueChanged()},n.rotationEuler=function(t,e,r,o){n.rotationYawPitchRoll(e,t,r,o)},n.rotationYawPitchRoll=function(t,e,r,o){var s=r*.5,l=e*.5,u=t*.5,c=Math.sin(s),d=Math.cos(s),_=Math.sin(l),f=Math.cos(l),v=Math.sin(u),p=Math.cos(u),g=p*f,m=v*_;o._x=p*_*d+v*f*c,o._y=v*f*d-p*_*c,o._z=g*c-m*d,o._w=g*d+m*c,o._onValueChanged&&o._onValueChanged()},n.rotationMatrix3x3=function(t,e){var r=t.elements,o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],d=r[5],_=r[6],f=r[7],v=r[8],p=o+c+v,g,m;p>0?(g=Math.sqrt(p+1),e._w=g*.5,g=.5/g,e._x=(d-f)*g,e._y=(_-l)*g,e._z=(s-u)*g):o>=c&&o>=v?(g=Math.sqrt(1+o-c-v),m=.5/g,e._x=.5*g,e._y=(s+u)*m,e._z=(l+_)*m,e._w=(d-f)*m):c>v?(g=Math.sqrt(1+c-o-v),m=.5/g,e._x=(u+s)*m,e._y=.5*g,e._z=(f+d)*m,e._w=(_-l)*m):(g=Math.sqrt(1+v-o-c),m=.5/g,e._x=(l+_)*m,e._y=(d+f)*m,e._z=.5*g,e._w=(s-u)*m),e._onValueChanged&&e._onValueChanged()},n.invert=function(t,e){var r=t._x,o=t._y,s=t._z,l=t._w,u=r*r+o*o+s*s+l*l;if(u>G.zeroTolerance){var c=1/u;e._x=-r*c,e._y=-o*c,e._z=-s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged()}},n.lerp=function(t,e,r,o){var s=1-r;n.dot(t,e)>=0?(o._x=t._x*s+e._x*r,o._y=t._y*s+e._y*r,o._z=t._z*s+e._z*r,o._w=t._w*s+e._w*r):(o._x=t._x*s-e._x*r,o._y=t._y*s-e._y*r,o._z=t._z*s-e._z*r,o._w=t._w*s-e._w*r),o.normalize()},n.slerp=function(t,e,r,o){var s,l,u=n.dot(t,e);if(Math.abs(u)>1-G.zeroTolerance)l=1-r,s=r*Math.sign(u);else{var c=Math.acos(Math.abs(u)),d=1/Math.sin(c);l=Math.sin((1-r)*c)*d,s=Math.sin(r*c)*d*Math.sign(u)}o.x=l*t.x+s*e.x,o.y=l*t.y+s*e.y,o.z=l*t.z+s*e.z,o.w=l*t.w+s*e.w,o._onValueChanged&&o._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=t._z,l=t._w,u=Math.sqrt(r*r+o*o+s*s+l*l);u>G.zeroTolerance&&(u=1/u,e._x=r*u,e._y=o*u,e._z=s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged())},n.rotationX=function(t,e){t*=.5;var r=Math.sin(t),o=Math.cos(t);e._x=r,e._y=0,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},n.rotationY=function(t,e){t*=.5;var r=Math.sin(t),o=Math.cos(t);e._x=0,e._y=r,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},n.rotationZ=function(t,e){t*=.5;var r=Math.sin(t),o=Math.cos(t);e._x=0,e._y=0,e._z=r,e._w=o,e._onValueChanged&&e._onValueChanged()},n.rotateX=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w;e*=.5;var c=Math.sin(e),d=Math.cos(e);r._x=o*d+u*c,r._y=s*d+l*c,r._z=l*d-s*c,r._w=u*d-o*c,r._onValueChanged&&r._onValueChanged()},n.rotateY=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w;e*=.5;var c=Math.sin(e),d=Math.cos(e);r._x=o*d-l*c,r._y=s*d+u*c,r._z=l*d+o*c,r._w=u*d-s*c,r._onValueChanged&&r._onValueChanged()},n.rotateZ=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w;e*=.5;var c=Math.sin(e),d=Math.cos(e);r._x=o*d+s*c,r._y=s*d-o*c,r._z=l*d+u*c,r._w=u*d-l*c,r._onValueChanged&&r._onValueChanged()},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._z=t._z*e,r._w=t._w*e,r._onValueChanged&&r._onValueChanged()},Xo(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"normalized",get:function(){return Math.abs(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w-1)<G.zeroTolerance}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),n}();(function(){xe._tempVector3=new M})();(function(){xe._tempQuat1=new xe})();var $=function(){function n(a,t,e,r,o,s,l,u,c,d,_,f,v,p,g,m){a===void 0&&(a=1),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=1),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=0),d===void 0&&(d=0),_===void 0&&(_=1),f===void 0&&(f=0),v===void 0&&(v=0),p===void 0&&(p=0),g===void 0&&(g=0),m===void 0&&(m=1),this.elements=new Float32Array(16);var h=this.elements;h[0]=a,h[1]=t,h[2]=e,h[3]=r,h[4]=o,h[5]=s,h[6]=l,h[7]=u,h[8]=c,h[9]=d,h[10]=_,h[11]=f,h[12]=v,h[13]=p,h[14]=g,h[15]=m}var i=n.prototype;return i.set=function(t,e,r,o,s,l,u,c,d,_,f,v,p,g,m,h){var y=this.elements;return y[0]=t,y[1]=e,y[2]=r,y[3]=o,y[4]=s,y[5]=l,y[6]=u,y[7]=c,y[8]=d,y[9]=_,y[10]=f,y[11]=v,y[12]=p,y[13]=g,y[14]=m,y[15]=h,this},i.multiply=function(t){return n.multiply(this,t,this),this},i.determinant=function(){var t=this.elements,e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],c=t[6],d=t[7],_=t[8],f=t[9],v=t[10],p=t[11],g=t[12],m=t[13],h=t[14],y=t[15],A=e*u-r*l,S=e*c-o*l,x=e*d-s*l,C=r*c-o*u,E=r*d-s*u,T=o*d-s*c,w=_*m-f*g,R=_*h-v*g,b=_*y-p*g,B=f*h-v*m,I=f*y-p*m,V=v*y-p*h;return A*V-S*I+x*B+C*b-E*R+T*w},i.decompose=function(t,e,r){var o=n._tempMat30,s=this.elements,l=o.elements,u=s[0],c=s[1],d=s[2],_=s[4],f=s[5],v=s[6],p=s[8],g=s[9],m=s[10];t.set(s[12],s[13],s[14]);var h=Math.sqrt(u*u+c*c+d*d),y=Math.sqrt(_*_+f*f+v*v),A=Math.sqrt(p*p+g*g+m*m);if(this.determinant()<0&&(h=-h),r.set(h,y,A),Math.abs(h)<G.zeroTolerance||Math.abs(y)<G.zeroTolerance||Math.abs(A)<G.zeroTolerance)return e.identity(),!1;var S=1/h,x=1/y,C=1/A;return l[0]=u*S,l[1]=c*S,l[2]=d*S,l[3]=_*x,l[4]=f*x,l[5]=v*x,l[6]=p*C,l[7]=g*C,l[8]=m*C,xe.rotationMatrix3x3(o,e),!0},i.getRotation=function(t){var e=this.elements,r=e[0]+e[5]+e[10];if(r>G.zeroTolerance){var o=Math.sqrt(r+1)*2;t._w=.25*o,t._x=(e[6]-e[9])/o,t._y=(e[8]-e[2])/o,t._z=(e[1]-e[4])/o}else if(e[0]>e[5]&&e[0]>e[10]){var s=Math.sqrt(1+e[0]-e[5]-e[10])*2;t._w=(e[6]-e[9])/s,t._x=.25*s,t._y=(e[1]+e[4])/s,t._z=(e[8]+e[2])/s}else if(e[5]>e[10]){var l=Math.sqrt(1+e[5]-e[0]-e[10])*2;t._w=(e[8]-e[2])/l,t._x=(e[1]+e[4])/l,t._y=.25*l,t._z=(e[6]+e[9])/l}else{var u=Math.sqrt(1+e[10]-e[0]-e[5])*2;t._w=(e[1]-e[4])/u,t._x=(e[8]+e[2])/u,t._y=(e[6]+e[9])/u,t._z=.25*u}return t._onValueChanged&&t._onValueChanged(),t},i.getScaling=function(t){var e=this.elements,r=e[0],o=e[1],s=e[2],l=e[4],u=e[5],c=e[6],d=e[8],_=e[9],f=e[10];return t.set(Math.sqrt(r*r+o*o+s*s),Math.sqrt(l*l+u*u+c*c),Math.sqrt(d*d+_*_+f*f)),t},i.getTranslation=function(t){var e=this.elements;return t.set(e[12],e[13],e[14]),t},i.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.invert=function(){return n.invert(this,this),this},i.rotateAxisAngle=function(t,e){return n.rotateAxisAngle(this,t,e,this),this},i.scale=function(t){return n.scale(this,t,this),this},i.translate=function(t){return n.translate(this,t,this),this},i.transpose=function(){return n.transpose(this,this),this},i.clone=function(){var t=this.elements,e=new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);return e},i.copyFrom=function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},i.copyFromArray=function(t,e){e===void 0&&(e=0);for(var r=this.elements,o=0;o<16;o++)r[o]=t[o+e];return this},i.copyToArray=function(t,e){e===void 0&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15]},n.multiply=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements,u=o[0],c=o[1],d=o[2],_=o[3],f=o[4],v=o[5],p=o[6],g=o[7],m=o[8],h=o[9],y=o[10],A=o[11],S=o[12],x=o[13],C=o[14],E=o[15],T=s[0],w=s[1],R=s[2],b=s[3],B=s[4],I=s[5],V=s[6],L=s[7],F=s[8],D=s[9],N=s[10],O=s[11],k=s[12],Q=s[13],H=s[14],ee=s[15];l[0]=u*T+f*w+m*R+S*b,l[1]=c*T+v*w+h*R+x*b,l[2]=d*T+p*w+y*R+C*b,l[3]=_*T+g*w+A*R+E*b,l[4]=u*B+f*I+m*V+S*L,l[5]=c*B+v*I+h*V+x*L,l[6]=d*B+p*I+y*V+C*L,l[7]=_*B+g*I+A*V+E*L,l[8]=u*F+f*D+m*N+S*O,l[9]=c*F+v*D+h*N+x*O,l[10]=d*F+p*D+y*N+C*O,l[11]=_*F+g*D+A*N+E*O,l[12]=u*k+f*Q+m*H+S*ee,l[13]=c*k+v*Q+h*H+x*ee,l[14]=d*k+p*Q+y*H+C*ee,l[15]=_*k+g*Q+A*H+E*ee},n.equals=function(t,e){var r=t.elements,o=e.elements;return G.equals(r[0],o[0])&&G.equals(r[1],o[1])&&G.equals(r[2],o[2])&&G.equals(r[3],o[3])&&G.equals(r[4],o[4])&&G.equals(r[5],o[5])&&G.equals(r[6],o[6])&&G.equals(r[7],o[7])&&G.equals(r[8],o[8])&&G.equals(r[9],o[9])&&G.equals(r[10],o[10])&&G.equals(r[11],o[11])&&G.equals(r[12],o[12])&&G.equals(r[13],o[13])&&G.equals(r[14],o[14])&&G.equals(r[15],o[15])},n.lerp=function(t,e,r,o){var s=t.elements,l=e.elements,u=o.elements,c=1-r;u[0]=s[0]*c+l[0]*r,u[1]=s[1]*c+l[1]*r,u[2]=s[2]*c+l[2]*r,u[3]=s[3]*c+l[3]*r,u[4]=s[4]*c+l[4]*r,u[5]=s[5]*c+l[5]*r,u[6]=s[6]*c+l[6]*r,u[7]=s[7]*c+l[7]*r,u[8]=s[8]*c+l[8]*r,u[9]=s[9]*c+l[9]*r,u[10]=s[10]*c+l[10]*r,u[11]=s[11]*c+l[11]*r,u[12]=s[12]*c+l[12]*r,u[13]=s[13]*c+l[13]*r,u[14]=s[14]*c+l[14]*r,u[15]=s[15]*c+l[15]*r},n.add=function(t,e,r){var o=t.elements,s=e.elements,l=r.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8],l[9]=o[9]+s[9],l[10]=o[10]+s[10],l[11]=o[11]+s[11],l[12]=o[12]+s[12],l[13]=o[13]+s[13],l[14]=o[14]+s[14],l[15]=o[15]+s[15]},n.multiplyScalar=function(t,e,r){var o=t.elements,s=r.elements;s[0]=o[0]*e,s[1]=o[1]*e,s[2]=o[2]*e,s[3]=o[3]*e,s[4]=o[4]*e,s[5]=o[5]*e,s[6]=o[6]*e,s[7]=o[7]*e,s[8]=o[8]*e,s[9]=o[9]*e,s[10]=o[10]*e,s[11]=o[11]*e,s[12]=o[12]*e,s[13]=o[13]*e,s[14]=o[14]*e,s[15]=o[15]*e},n.rotationQuaternion=function(t,e){var r=e.elements,o=t._x,s=t._y,l=t._z,u=t._w,c=o+o,d=s+s,_=l+l,f=o*c,v=s*c,p=s*d,g=l*c,m=l*d,h=l*_,y=u*c,A=u*d,S=u*_;r[0]=1-p-h,r[1]=v+S,r[2]=g-A,r[3]=0,r[4]=v-S,r[5]=1-f-h,r[6]=m+y,r[7]=0,r[8]=g+A,r[9]=m-y,r[10]=1-f-p,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1},n.rotationAxisAngle=function(t,e,r){var o=r.elements,s=t._x,l=t._y,u=t._z,c=Math.sqrt(s*s+l*l+u*u),d,_,f;Math.abs(c)<G.zeroTolerance||(c=1/c,s*=c,l*=c,u*=c,d=Math.sin(e),_=Math.cos(e),f=1-_,o[0]=s*s*f+_,o[1]=l*s*f+u*d,o[2]=u*s*f-l*d,o[3]=0,o[4]=s*l*f-u*d,o[5]=l*l*f+_,o[6]=u*l*f+s*d,o[7]=0,o[8]=s*u*f+l*d,o[9]=l*u*f-s*d,o[10]=u*u*f+_,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1)},n.rotationTranslation=function(t,e,r){n.rotationQuaternion(t,r);var o=r.elements;o[12]=e._x,o[13]=e._y,o[14]=e._z},n.affineTransformation=function(t,e,r,o){var s=o.elements,l=e._x,u=e._y,c=e._z,d=e._w,_=l+l,f=u+u,v=c+c,p=l*_,g=l*f,m=l*v,h=u*f,y=u*v,A=c*v,S=d*_,x=d*f,C=d*v,E=t._x,T=t._y,w=t._z;s[0]=(1-(h+A))*E,s[1]=(g+C)*E,s[2]=(m-x)*E,s[3]=0,s[4]=(g-C)*T,s[5]=(1-(p+A))*T,s[6]=(y+S)*T,s[7]=0,s[8]=(m+x)*w,s[9]=(y-S)*w,s[10]=(1-(p+h))*w,s[11]=0,s[12]=r._x,s[13]=r._y,s[14]=r._z,s[15]=1},n.scaling=function(t,e){var r=e.elements;r[0]=t._x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t._y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t._z,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1},n.translation=function(a,t){var e=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a._x,e[13]=a._y,e[14]=a._z,e[15]=1},n.invert=function(t,e){var r=t.elements,o=e.elements,s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],_=r[5],f=r[6],v=r[7],p=r[8],g=r[9],m=r[10],h=r[11],y=r[12],A=r[13],S=r[14],x=r[15],C=s*_-l*d,E=s*f-u*d,T=s*v-c*d,w=l*f-u*_,R=l*v-c*_,b=u*v-c*f,B=p*A-g*y,I=p*S-m*y,V=p*x-h*y,L=g*S-m*A,F=g*x-h*A,D=m*x-h*S,N=C*D-E*F+T*L+w*V-R*I+b*B;if(!N)return null;N=1/N,o[0]=(_*D-f*F+v*L)*N,o[1]=(u*F-l*D-c*L)*N,o[2]=(A*b-S*R+x*w)*N,o[3]=(m*R-g*b-h*w)*N,o[4]=(f*V-d*D-v*I)*N,o[5]=(s*D-u*V+c*I)*N,o[6]=(S*T-y*b-x*E)*N,o[7]=(p*b-m*T+h*E)*N,o[8]=(d*F-_*V+v*B)*N,o[9]=(l*V-s*F-c*B)*N,o[10]=(y*R-A*T+x*C)*N,o[11]=(g*T-p*R-h*C)*N,o[12]=(_*I-d*L-f*B)*N,o[13]=(s*L-l*I+u*B)*N,o[14]=(A*E-y*w-S*C)*N,o[15]=(p*w-g*E+m*C)*N},n.lookAt=function(t,e,r,o){var s=o.elements,l=n._tempVec30,u=n._tempVec31,c=n._tempVec32;M.subtract(t,e,c),c.normalize(),M.cross(r,c,l),l.normalize(),M.cross(c,l,u),s[0]=l._x,s[1]=u._x,s[2]=c._x,s[3]=0,s[4]=l._y,s[5]=u._y,s[6]=c._y,s[7]=0,s[8]=l._z,s[9]=u._z,s[10]=c._z,s[11]=0,s[12]=-M.dot(l,t),s[13]=-M.dot(u,t),s[14]=-M.dot(c,t),s[15]=1},n.ortho=function(t,e,r,o,s,l,u){var c=u.elements,d=1/(t-e),_=1/(r-o),f=1/(s-l);c[0]=-2*d,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*f,c[11]=0,c[12]=(t+e)*d,c[13]=(o+r)*_,c[14]=(l+s)*f,c[15]=1},n.perspective=function(t,e,r,o,s){var l=s.elements,u=1/Math.tan(t/2),c=1/(r-o);l[0]=u/e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=u,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=(o+r)*c,l[11]=-1,l[12]=0,l[13]=0,l[14]=2*o*r*c,l[15]=0},n.rotateAxisAngle=function(t,e,r,o){var s=e._x,l=e._y,u=e._z,c=Math.sqrt(s*s+l*l+u*u);if(!(Math.abs(c)<G.zeroTolerance)){var d=t.elements,_=o.elements,f,v,p;c=1/c,s*=c,l*=c,u*=c,f=Math.sin(r),v=Math.cos(r),p=1-v;var g=d[0],m=d[1],h=d[2],y=d[3],A=d[4],S=d[5],x=d[6],C=d[7],E=d[8],T=d[9],w=d[10],R=d[11],b=s*s*p+v,B=l*s*p+u*f,I=u*s*p-l*f,V=s*l*p-u*f,L=l*l*p+v,F=u*l*p+s*f,D=s*u*p+l*f,N=l*u*p-s*f,O=u*u*p+v;_[0]=g*b+A*B+E*I,_[1]=m*b+S*B+T*I,_[2]=h*b+x*B+w*I,_[3]=y*b+C*B+R*I,_[4]=g*V+A*L+E*F,_[5]=m*V+S*L+T*F,_[6]=h*V+x*L+w*F,_[7]=y*V+C*L+R*F,_[8]=g*D+A*N+E*O,_[9]=m*D+S*N+T*O,_[10]=h*D+x*N+w*O,_[11]=y*D+C*N+R*O,t!==o&&(_[12]=d[12],_[13]=d[13],_[14]=d[14],_[15]=d[15])}},n.scale=function(t,e,r){var o=t.elements,s=r.elements,l=e._x,u=e._y,c=e._z;s[0]=o[0]*l,s[1]=o[1]*l,s[2]=o[2]*l,s[3]=o[3]*l,s[4]=o[4]*u,s[5]=o[5]*u,s[6]=o[6]*u,s[7]=o[7]*u,s[8]=o[8]*c,s[9]=o[9]*c,s[10]=o[10]*c,s[11]=o[11]*c,s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15]},n.translate=function(t,e,r){var o=t.elements,s=r.elements,l=e._x,u=e._y,c=e._z;if(t===r)s[12]=o[0]*l+o[4]*u+o[8]*c+o[12],s[13]=o[1]*l+o[5]*u+o[9]*c+o[13],s[14]=o[2]*l+o[6]*u+o[10]*c+o[14],s[15]=o[3]*l+o[7]*u+o[11]*c+o[15];else{var d=o[0],_=o[1],f=o[2],v=o[3],p=o[4],g=o[5],m=o[6],h=o[7],y=o[8],A=o[9],S=o[10],x=o[11];s[0]=d,s[1]=_,s[2]=f,s[3]=v,s[4]=p,s[5]=g,s[6]=m,s[7]=h,s[8]=y,s[9]=A,s[10]=S,s[11]=x,s[12]=d*l+p*u+y*c+o[12],s[13]=_*l+g*u+A*c+o[13],s[14]=f*l+m*u+S*c+o[14],s[15]=v*l+h*u+x*c+o[15]}},n.transpose=function(t,e){var r=t.elements,o=e.elements;if(e===t){var s=r[1],l=r[2],u=r[3],c=r[6],d=r[7],_=r[11];o[1]=r[4],o[2]=r[8],o[3]=r[12],o[4]=s,o[6]=r[9],o[7]=r[13],o[8]=l,o[9]=c,o[11]=r[14],o[12]=u,o[13]=d,o[14]=_}else o[0]=r[0],o[1]=r[4],o[2]=r[8],o[3]=r[12],o[4]=r[1],o[5]=r[5],o[6]=r[9],o[7]=r[13],o[8]=r[2],o[9]=r[6],o[10]=r[10],o[11]=r[14],o[12]=r[3],o[13]=r[7],o[14]=r[11],o[15]=r[15]},n}();(function(){$._tempVec30=new M})();(function(){$._tempVec31=new M})();(function(){$._tempVec32=new M})();(function(){$._tempMat30=new Io})();(function(){$._identity=new $(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)})();var q0=function(){function n(a,t){a===void 0&&(a=null),t===void 0&&(t=null),this.origin=new M,this.direction=new M,a&&this.origin.copyFrom(a),t&&this.direction.copyFrom(t)}var i=n.prototype;return i.intersectPlane=function(t){return Et.intersectsRayAndPlane(this,t)},i.intersectSphere=function(t){return Et.intersectsRayAndSphere(this,t)},i.intersectBox=function(t){return Et.intersectsRayAndBox(this,t)},i.getPoint=function(t,e){return M.scale(this.direction,t,e),e.add(this.origin)},n}(),te=function(){function n(a,t){a===void 0&&(a=0),t===void 0&&(t=0),this._onValueChanged=null,this._x=a,this._y=t}var i=n.prototype;return i.set=function(t,e){return this._x=t,this._y=e,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y;return Math.sqrt(e*e+r*r)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y;return e*e+r*r},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return n.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){return new n(this._x,this._y)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y},i.toJSON=function(){return{x:this._x,y:this._y}},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._onValueChanged&&r._onValueChanged()},n.subtract=function(t,e,r){r._x=t._x-e._x,r._y=t._y-e._y,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){r._x=t._x*e._x,r._y=t._y*e._y,r._onValueChanged&&r._onValueChanged()},n.divide=function(t,e,r){r._x=t._x/e._x,r._y=t._y/e._y,r._onValueChanged&&r._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y},n.distance=function(t,e){var r=e._x-t._x,o=e._y-t._y;return Math.sqrt(r*r+o*o)},n.distanceSquared=function(t,e){var r=e._x-t._x,o=e._y-t._y;return r*r+o*o},n.equals=function(t,e){return G.equals(t._x,e._x)&&G.equals(t._y,e._y)},n.lerp=function(t,e,r,o){var s=t._x,l=t._y;o._x=s+(e._x-s)*r,o._y=l+(e._y-l)*r,o._onValueChanged&&o._onValueChanged()},n.max=function(t,e,r){r._x=Math.max(t._x,e._x),r._y=Math.max(t._y,e._y),r._onValueChanged&&r._onValueChanged()},n.min=function(t,e,r){r._x=Math.min(t._x,e._x),r._y=Math.min(t._y,e._y),r._onValueChanged&&r._onValueChanged()},n.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._onValueChanged&&e._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=Math.sqrt(r*r+o*o);s>G.zeroTolerance&&(s=1/s,e._x=r*s,e._y=o*s,e._onValueChanged&&e._onValueChanged())},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._onValueChanged&&r._onValueChanged()},Xo(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}}]),n}();(function(){te._zero=new te(0,0)})();(function(){te._one=new te(1,1)})();var ue=function(){function n(a,t,e,r){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this._onValueChanged=null,this._x=a,this._y=t,this._z=e,this._w=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._x=t,this._y=e,this._z=r,this._w=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._w-=t._w,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._w*=t._w,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._w/=t._w,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return Math.sqrt(e*e+r*r+o*o+s*s)},i.lengthSquared=function(){var t=this,e=t._x,r=t._y,o=t._z,s=t._w;return e*e+r*r+o*o+s*s},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return n.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new n(this._x,this._y,this._z,this._w);return t},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},i.toJSON=function(){return{x:this._x,y:this._y,z:this._z,w:this._w}},n.add=function(t,e,r){r._x=t._x+e._x,r._y=t._y+e._y,r._z=t._z+e._z,r._w=t._w+e._w,r._onValueChanged&&r._onValueChanged()},n.subtract=function(t,e,r){r._x=t._x-e._x,r._y=t._y-e._y,r._z=t._z-e._z,r._w=t._w-e._w,r._onValueChanged&&r._onValueChanged()},n.multiply=function(t,e,r){r._x=t._x*e._x,r._y=t._y*e._y,r._z=t._z*e._z,r._w=t._w*e._w,r._onValueChanged&&r._onValueChanged()},n.divide=function(t,e,r){r._x=t._x/e._x,r._y=t._y/e._y,r._z=t._z/e._z,r._w=t._w/e._w,r._onValueChanged&&r._onValueChanged()},n.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},n.distance=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return Math.sqrt(r*r+o*o+s*s+l*l)},n.distanceSquared=function(t,e){var r=e._x-t._x,o=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return r*r+o*o+s*s+l*l},n.equals=function(t,e){return G.equals(t._x,e._x)&&G.equals(t._y,e._y)&&G.equals(t._z,e._z)&&G.equals(t._w,e._w)},n.lerp=function(t,e,r,o){var s=t._x,l=t._y,u=t._z,c=t._w;o._x=s+(e._x-s)*r,o._y=l+(e._y-l)*r,o._z=u+(e._z-u)*r,o._w=c+(e._w-c)*r,o._onValueChanged&&o._onValueChanged()},n.max=function(t,e,r){r._x=Math.max(t._x,e._x),r._y=Math.max(t._y,e._y),r._z=Math.max(t._z,e._z),r._w=Math.max(t._w,e._w),r._onValueChanged&&r._onValueChanged()},n.min=function(t,e,r){r._x=Math.min(t._x,e._x),r._y=Math.min(t._y,e._y),r._z=Math.min(t._z,e._z),r._w=Math.min(t._w,e._w),r._onValueChanged&&r._onValueChanged()},n.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=-t._w,e._onValueChanged&&e._onValueChanged()},n.normalize=function(t,e){var r=t._x,o=t._y,s=t._z,l=t._w,u=Math.sqrt(r*r+o*o+s*s+l*l);u>G.zeroTolerance&&(u=1/u,e._x=r*u,e._y=o*u,e._z=s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged())},n.scale=function(t,e,r){r._x=t._x*e,r._y=t._y*e,r._z=t._z*e,r._w=t._w*e,r._onValueChanged&&r._onValueChanged()},n.transform=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w,c=e.elements;r._x=o*c[0]+s*c[4]+l*c[8]+u*c[12],r._y=o*c[1]+s*c[5]+l*c[9]+u*c[13],r._z=o*c[2]+s*c[6]+l*c[10]+u*c[14],r._w=o*c[3]+s*c[7]+l*c[11]+u*c[15],r._onValueChanged&&r._onValueChanged()},n.transformByQuat=function(t,e,r){var o=t._x,s=t._y,l=t._z,u=t._w,c=e._x,d=e._y,_=e._z,f=e._w,v=f*o+d*l-_*s,p=f*s+_*o-c*l,g=f*l+c*s-d*o,m=-c*o-d*s-_*l;r._x=v*f-m*c-p*_+g*d,r._y=p*f-m*d-g*c+v*_,r._z=g*f-m*_-v*d+p*c,r._w=u,r._onValueChanged&&r._onValueChanged()},Xo(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),n}();(function(){ue._zero=new ue(0,0,0,0)})();(function(){ue._one=new ue(1,1,1,1)})();var J=function(){function n(a,t,e,r){a===void 0&&(a=1),t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),this._onValueChanged=null,this._r=a,this._g=t,this._b=e,this._a=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._r=t,this._g=e,this._b=r,this._a=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._r+=t._r,this._g+=t._g,this._b+=t._b,this._a+=t._a,this._onValueChanged&&this._onValueChanged(),this},i.scale=function(t){return this._r*=t,this._g*=t,this._b*=t,this._a*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new n(this._r,this._g,this._b,this._a);return t},i.copyFrom=function(t){return this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._r=t[e],this._g=t[e+1],this._b=t[e+2],this._a=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._r,t[e+1]=this._g,t[e+2]=this._b,t[e+3]=this._a},i.toLinear=function(t){return t._r=n.gammaToLinearSpace(this._r),t._g=n.gammaToLinearSpace(this._g),t._b=n.gammaToLinearSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.toGamma=function(t){return t._r=n.linearToGammaSpace(this._r),t._g=n.linearToGammaSpace(this._g),t._b=n.linearToGammaSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.getBrightness=function(){var t=this.r,e=this.g,r=this.b,o=t,s=t;return e>o&&(o=e),r>o&&(o=r),e<s&&(s=e),r<s&&(s=r),(o+s)/2},i.toJSON=function(){return{r:this._r,g:this._g,b:this._b,a:this._a}},n.gammaToLinearSpace=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},n.linearToGammaSpace=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},n.equals=function(t,e){return G.equals(t._r,e._r)&&G.equals(t._g,e._g)&&G.equals(t._b,e._b)&&G.equals(t._a,e._a)},n.add=function(t,e,r){return r._r=t._r+e._r,r._g=t._g+e._g,r._b=t._b+e._b,r._a=t._a+e._a,r._onValueChanged&&r._onValueChanged(),r},n.subtract=function(t,e,r){r._r=t._r-e._r,r._g=t._g-e._g,r._b=t._b-e._b,r._a=t._a-e._a,r._onValueChanged&&r._onValueChanged()},n.scale=function(t,e,r){return r._r=t._r*e,r._g=t._g*e,r._b=t._b*e,r._a=t._a*e,r._onValueChanged&&r._onValueChanged(),r},n.lerp=function(t,e,r,o){var s=t._r,l=t._g,u=t._b,c=t._a;return o._r=s+(e._r-s)*r,o._g=l+(e._g-l)*r,o._b=u+(e._b-u)*r,o._a=c+(e._a-c)*r,o._onValueChanged&&o._onValueChanged(),o},Xo(n,[{key:"r",get:function(){return this._r},set:function(t){this._r=t,this._onValueChanged&&this._onValueChanged()}},{key:"g",get:function(){return this._g},set:function(t){this._g=t,this._onValueChanged&&this._onValueChanged()}},{key:"b",get:function(){return this._b},set:function(t){this._b=t,this._onValueChanged&&this._onValueChanged()}},{key:"a",get:function(){return this._a},set:function(t){this._a=t,this._onValueChanged&&this._onValueChanged()}}]),n}(),Rr=function(){function n(a,t,e,r){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this._onValueChanged=null,this._x=a,this._y=t,this._width=e,this._height=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._x=t,this._y=e,this._width=r,this._height=o,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){return new n(this.x,this.y,this.width,this.height)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this._onValueChanged&&this._onValueChanged(),this},Xo(n,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._onValueChanged&&this._onValueChanged()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._onValueChanged&&this._onValueChanged()}}]),n}(),l1=function(){function n(){this.coefficients=new Float32Array(27)}var i=n.prototype;return i.addLight=function(t,e,r){e.scale(r);var o=this.coefficients,s=t._x,l=t._y,u=t._z,c=e.r,d=e.g,_=e.b,f=.282095,v=-.488603*l,p=.488603*u,g=-.488603*s,m=1.092548*(s*l),h=-1.092548*(l*u),y=.315392*(3*u*u-1),A=-1.092548*(s*u),S=.546274*(s*s-l*l);o[0]+=c*f,o[1]+=d*f,o[2]+=_*f,o[3]+=c*v,o[4]+=d*v,o[5]+=_*v,o[6]+=c*p,o[7]+=d*p,o[8]+=_*p,o[9]+=c*g,o[10]+=d*g,o[11]+=_*g,o[12]+=c*m,o[13]+=d*m,o[14]+=_*m,o[15]+=c*h,o[16]+=d*h,o[17]+=_*h,o[18]+=c*y,o[19]+=d*y,o[20]+=_*y,o[21]+=c*A,o[22]+=d*A,o[23]+=_*A,o[24]+=c*S,o[25]+=d*S,o[26]+=_*S},i.evaluate=function(t,e){var r=this.coefficients,o=t._x,s=t._y,l=t._z,u=.886227,c=-1.023327*s,d=1.023327*l,_=-1.023327*o,f=.858086*s*o,v=-.858086*s*l,p=.247708*(3*l*l-1),g=-.858086*l*o,m=.429042*(o*o-s*s),h=r[0]*u,y=r[1]*u,A=r[2]*u;return h+=r[3]*c+r[6]*d+r[9]*_,y+=r[4]*c+r[7]*d+r[10]*_,A+=r[5]*c+r[8]*d+r[11]*_,h+=r[12]*f+r[15]*v+r[18]*p+r[21]*g+r[24]*m,y+=r[13]*f+r[16]*v+r[19]*p+r[22]*g+r[25]*m,A+=r[14]*f+r[17]*v+r[20]*p+r[23]*g+r[26]*m,e.set(h,y,A,1),e},i.scale=function(t){var e=this.coefficients;e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,e[16]*=t,e[17]*=t,e[18]*=t,e[19]*=t,e[20]*=t,e[21]*=t,e[22]*=t,e[23]*=t,e[24]*=t,e[25]*=t,e[26]*=t},i.clone=function(){var t=new n;return t.copyFrom(this),t},i.copyFrom=function(t){return t.copyToArray(this.coefficients),this},i.copyFromArray=function(t,e){e===void 0&&(e=0);var r=this.coefficients;r[0]=t[e],r[1]=t[1+e],r[2]=t[2+e],r[3]=t[3+e],r[4]=t[4+e],r[5]=t[5+e],r[6]=t[6+e],r[7]=t[7+e],r[8]=t[8+e],r[9]=t[9+e],r[10]=t[10+e],r[11]=t[11+e],r[12]=t[12+e],r[13]=t[13+e],r[14]=t[14+e],r[15]=t[15+e],r[16]=t[16+e],r[17]=t[17+e],r[18]=t[18+e],r[19]=t[19+e],r[20]=t[20+e],r[21]=t[21+e],r[22]=t[22+e],r[23]=t[23+e],r[24]=t[24+e],r[25]=t[25+e],r[26]=t[26+e]},i.copyToArray=function(t,e){e===void 0&&(e=0);var r=this.coefficients;t[0+e]=r[0],t[1+e]=r[1],t[2+e]=r[2],t[3+e]=r[3],t[4+e]=r[4],t[5+e]=r[5],t[6+e]=r[6],t[7+e]=r[7],t[8+e]=r[8],t[9+e]=r[9],t[10+e]=r[10],t[11+e]=r[11],t[12+e]=r[12],t[13+e]=r[13],t[14+e]=r[14],t[15+e]=r[15],t[16+e]=r[16],t[17+e]=r[17],t[18+e]=r[18],t[19+e]=r[19],t[20+e]=r[20],t[21+e]=r[21],t[22+e]=r[22],t[23+e]=r[23],t[24+e]=r[24],t[25+e]=r[25],t[26+e]=r[26]},n}(),Pr=function(){function n(a,t){this.reset(a,t)}var i=n.prototype;return i.randomInt32=function(){var t=this._state0,e=this._state1;return this._state0=e,t^=t<<23,t^=t>>>17,t^=e^e>>>26,this._state1=t,this._state0+this._state1>>>0},i.random=function(){return this.randomInt32()/4294967295},i.reset=function(t,e){this._state0=t>>>0,this._state1=e>>>0},n}(),cn;(function(n){n[n.Android=0]="Android",n[n.IPhone=1]="IPhone",n[n.IPad=2]="IPad",n[n.Mac=3]="Mac",n[n.Unknown=4]="Unknown"})(cn||(cn={}));function fe(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function iv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function q(n,i,a){return i&&iv(n.prototype,i),a&&iv(n,a),n}function s_(n,i){return s_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s_(n,i)}function W(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&s_(n,i)}var Ea=function(){function n(){}return n.clamp=function(a,t,e){return Math.max(t,Math.min(e,a))},n.equals=function(a,t){return Math.abs(a-t)<=n.zeroTolerance},n.isPowerOf2=function(a){return(a&a-1)===0},n.radianToDegree=function(a){return a*n.radToDegreeFactor},n.degreeToRadian=function(a){return a*n.degreeToRadFactor},n}();(function(){Ea.zeroTolerance=1e-6})();(function(){Ea.radToDegreeFactor=180/Math.PI})();(function(){Ea.degreeToRadFactor=Math.PI/180})();var av=function(){function n(a,t,e,r){a===void 0&&(a=1),t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),this._onValueChanged=null,this._r=a,this._g=t,this._b=e,this._a=r}var i=n.prototype;return i.set=function(t,e,r,o){return this._r=t,this._g=e,this._b=r,this._a=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._r+=t._r,this._g+=t._g,this._b+=t._b,this._a+=t._a,this._onValueChanged&&this._onValueChanged(),this},i.scale=function(t){return this._r*=t,this._g*=t,this._b*=t,this._a*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new n(this._r,this._g,this._b,this._a);return t},i.copyFrom=function(t){return this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._r=t[e],this._g=t[e+1],this._b=t[e+2],this._a=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._r,t[e+1]=this._g,t[e+2]=this._b,t[e+3]=this._a},i.toLinear=function(t){return t._r=n.gammaToLinearSpace(this._r),t._g=n.gammaToLinearSpace(this._g),t._b=n.gammaToLinearSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.toGamma=function(t){return t._r=n.linearToGammaSpace(this._r),t._g=n.linearToGammaSpace(this._g),t._b=n.linearToGammaSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.getBrightness=function(){var t=this.r,e=this.g,r=this.b,o=t,s=t;return e>o&&(o=e),r>o&&(o=r),e<s&&(s=e),r<s&&(s=r),(o+s)/2},i.toJSON=function(){return{r:this._r,g:this._g,b:this._b,a:this._a}},n.gammaToLinearSpace=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},n.linearToGammaSpace=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},n.equals=function(t,e){return Ea.equals(t._r,e._r)&&Ea.equals(t._g,e._g)&&Ea.equals(t._b,e._b)&&Ea.equals(t._a,e._a)},n.add=function(t,e,r){return r._r=t._r+e._r,r._g=t._g+e._g,r._b=t._b+e._b,r._a=t._a+e._a,r._onValueChanged&&r._onValueChanged(),r},n.subtract=function(t,e,r){r._r=t._r-e._r,r._g=t._g-e._g,r._b=t._b-e._b,r._a=t._a-e._a,r._onValueChanged&&r._onValueChanged()},n.scale=function(t,e,r){return r._r=t._r*e,r._g=t._g*e,r._b=t._b*e,r._a=t._a*e,r._onValueChanged&&r._onValueChanged(),r},n.lerp=function(t,e,r,o){var s=t._r,l=t._g,u=t._b,c=t._a;return o._r=s+(e._r-s)*r,o._g=l+(e._g-l)*r,o._b=u+(e._b-u)*r,o._a=c+(e._a-c)*r,o._onValueChanged&&o._onValueChanged(),o},q(n,[{key:"r",get:function(){return this._r},set:function(t){this._r=t,this._onValueChanged&&this._onValueChanged()}},{key:"g",get:function(){return this._g},set:function(t){this._g=t,this._onValueChanged&&this._onValueChanged()}},{key:"b",get:function(){return this._b},set:function(t){this._b=t,this._onValueChanged&&this._onValueChanged()}},{key:"a",get:function(){return this._a},set:function(t){this._a=t,this._onValueChanged&&this._onValueChanged()}}]),n}();function P(n,i,a,t){var e=arguments.length,r=e<3?i:t===null?t=Object.getOwnPropertyDescriptor(i,a):t,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,i,a,t);else for(var s=n.length-1;s>=0;s--)(o=n[s])&&(r=(e<3?o(r):e>3?o(i,a,r):o(i,a))||r);return e>3&&r&&Object.defineProperty(i,a,r),r}function gt(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var pi;(function(n){n[n.Ignore=0]="Ignore",n[n.Assignment=1]="Assignment",n[n.Shallow=2]="Shallow",n[n.Deep=3]="Deep"})(pi||(pi={}));function z(n,i){_r.registerCloneMode(n,i,pi.Ignore)}function Ie(n,i){_r.registerCloneMode(n,i,pi.Assignment)}function Rf(n,i){_r.registerCloneMode(n,i,pi.Shallow)}function K(n,i){_r.registerCloneMode(n,i,pi.Deep)}var _r=function(){function n(){}return n.registerCloneMode=function(a,t,e){var r=n._subCloneModeMap.get(a.constructor);r||(r=Object.create(null),n._subCloneModeMap.set(a.constructor,r)),r[t]=e},n.getCloneMode=function(a){var t=n._cloneModeMap.get(a);if(!t){t=Object.create(null),n._cloneModeMap.set(a,t);for(var e=n._objectType,r=n._subCloneModeMap;a!==e;){var o=r.get(a);o&&Object.assign(t,o),a=Object.getPrototypeOf(a)}}return t},n.cloneProperty=function(a,t,e,r){if(r!==pi.Ignore){var o=a[e];if(gt(o,Object)){if(r===void 0||r===pi.Assignment){t[e]=o;return}var s=o.constructor;switch(s){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var l=t[e];l==null||l.length!==o.length?t[e]=o.slice():l.set(o);break;case Array:var u=t[e],c=o.length;u==null?t[e]=u=new Array(c):u.length=c;for(var d=0;d<c;d++)n.cloneProperty(o,u,d,r);break;default:var _,f,v=(_=t)[f=e]||(_[f]=new o.constructor),p=n.getCloneMode(o.constructor);for(var g in o)n.cloneProperty(o,v,g,p[g]);o._cloneTo&&o._cloneTo(v),o.copyFrom&&v.copyFrom(o);break}}else t[e]=o}},n.deepCloneObject=function(a,t){for(var e in a)n.cloneProperty(a,t,e,pi.Deep)},n}();(function(){_r._subCloneModeMap=new Map})();(function(){_r._cloneModeMap=new Map})();(function(){_r._objectType=Object.getPrototypeOf(Object)})();var ti=function(){function n(a){this.instanceId=++n._instanceIdCounter,this._destroyed=!1,this._engine=a}var i=n.prototype;return i.destroy=function(){this._destroyed||(this._onDestroy(),this._destroyed=!0)},i._onDestroy=function(){var t=this._engine.resourceManager;t._deleteAsset(this),t._deleteContentRestorer(this)},q(n,[{key:"engine",get:function(){return this._engine}},{key:"destroyed",get:function(){return this._destroyed}}]),n}();(function(){ti._instanceIdCounter=0})();P([z],ti.prototype,"instanceId",void 0);P([z],ti.prototype,"_engine",void 0);var ni=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e.isGCIgnored=!1,e._refCount=0,t.resourceManager._addReferResource(fe(e)),e}var a=i.prototype;return a.destroy=function(e){return e===void 0&&(e=!1),!e&&this._refCount!==0?!1:(n.prototype.destroy.call(this),!0)},a._getReferCount=function(){return this._refCount},a._addReferCount=function(e){this._refCount+=e},a._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._engine.resourceManager._deleteReferResource(this);var e=this._getReferCount();e>0&&this._addReferCount(-e)},q(i,[{key:"refCount",get:function(){return this._refCount}}]),i}(ti),gi=function(i){this.resource=i},kt;(function(n){n[n.Depth=0]="Depth",n[n.DepthStencil=1]="DepthStencil",n[n.Stencil=2]="Stencil",n[n.Depth16=3]="Depth16",n[n.Depth24=4]="Depth24",n[n.Depth32=5]="Depth32",n[n.Depth24Stencil8=6]="Depth24Stencil8",n[n.Depth32Stencil8=7]="Depth32Stencil8"})(kt||(kt={}));var fr;(function(n){n[n.PositiveX=0]="PositiveX",n[n.NegativeX=1]="NegativeX",n[n.PositiveY=2]="PositiveY",n[n.NegativeY=3]="NegativeY",n[n.PositiveZ=4]="PositiveZ",n[n.NegativeZ=5]="NegativeZ"})(fr||(fr={}));var er;(function(n){n[n.Never=0]="Never",n[n.Less=1]="Less",n[n.Equal=2]="Equal",n[n.LessEqual=3]="LessEqual",n[n.Greater=4]="Greater",n[n.NotEqual=5]="NotEqual",n[n.GreaterEqual=6]="GreaterEqual",n[n.Always=7]="Always"})(er||(er={}));var tn;(function(n){n[n.Point=0]="Point",n[n.Bilinear=1]="Bilinear",n[n.Trilinear=2]="Trilinear"})(tn||(tn={}));var X;(function(n){n[n.R8G8B8=0]="R8G8B8",n[n.R8G8B8A8=1]="R8G8B8A8",n[n.R4G4B4A4=2]="R4G4B4A4",n[n.R5G5B5A1=3]="R5G5B5A1",n[n.R5G6B5=4]="R5G6B5",n[n.Alpha8=5]="Alpha8",n[n.LuminanceAlpha=6]="LuminanceAlpha",n[n.R16G16B16A16=7]="R16G16B16A16",n[n.R32G32B32A32=8]="R32G32B32A32",n[n.BC1=9]="BC1",n[n.BC3=10]="BC3",n[n.BC7=11]="BC7",n[n.ETC1_RGB=12]="ETC1_RGB",n[n.ETC2_RGB=13]="ETC2_RGB",n[n.ETC2_RGBA5=14]="ETC2_RGBA5",n[n.ETC2_RGBA8=15]="ETC2_RGBA8",n[n.PVRTC_RGB2=16]="PVRTC_RGB2",n[n.PVRTC_RGBA2=17]="PVRTC_RGBA2",n[n.PVRTC_RGB4=18]="PVRTC_RGB4",n[n.PVRTC_RGBA4=19]="PVRTC_RGBA4",n[n.ASTC_4x4=20]="ASTC_4x4",n[n.ASTC_5x5=21]="ASTC_5x5",n[n.ASTC_6x6=22]="ASTC_6x6",n[n.ASTC_8x8=23]="ASTC_8x8",n[n.ASTC_10x10=24]="ASTC_10x10",n[n.ASTC_12x12=25]="ASTC_12x12",n[n.Depth=26]="Depth",n[n.DepthStencil=27]="DepthStencil",n[n.Depth16=28]="Depth16",n[n.Depth24=29]="Depth24",n[n.Depth32=30]="Depth32",n[n.Depth24Stencil8=31]="Depth24Stencil8",n[n.Depth32Stencil8=32]="Depth32Stencil8",n[n.DXT1=33]="DXT1",n[n.DXT5=34]="DXT5"})(X||(X={}));var Vo;(function(n){n[n.Static=0]="Static",n[n.Dynamic=1]="Dynamic"})(Vo||(Vo={}));var $t;(function(n){n[n.Clamp=0]="Clamp",n[n.Repeat=1]="Repeat",n[n.Mirror=2]="Mirror"})($t||($t={}));var mc=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._isContentLost=!1,t.resourceManager._addGraphicResource(fe(e)),e}var a=i.prototype;return a._onDestroy=function(){n.prototype._onDestroy.call(this),this.engine.resourceManager._deleteGraphicResource(this)},q(i,[{key:"isContentLost",get:function(){return this._isContentLost}}]),i}(ni),bi=function(n){for(var i=arguments.length,a=new Array(i>1?i-1:0),t=1;t<i;t++)a[t-1]=arguments[t]},u1=console.log.bind(console),c1=console.info.bind(console),d1=console.warn.bind(console),_1=console.error.bind(console),ve={debug:bi,info:bi,warn:bi,error:bi,isEnabled:!1,enable:function(){this.debug=u1,this.info=c1,this.warn=d1,this.error=_1,this.isEnabled=!0},disable:function(){this.debug=bi,this.info=bi,this.warn=bi,this.error=bi,this.isEnabled=!1}},Zr=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._isDepthTexture=!1,t._anisoLevel=1,t._useDepthCompareMode=!1,t}var a=i.prototype;return a.generateMipmaps=function(){this._mipmap&&this._platformTexture.generateMipmaps()},a._setUseDepthCompareMode=function(e){this._useDepthCompareMode!==e&&(this._platformTexture.setUseDepthCompareMode(e),this._useDepthCompareMode=e)},a._rebuild=function(){var e=this._platformTexture;e.wrapModeU=this._wrapModeU,e.wrapModeV=this._wrapModeV,e.filterMode=this._filterMode,e.anisoLevel=this._anisoLevel,this._engine._hardwareRenderer._isWebGL2&&(e.depthCompareFunction=this._depthCompareFunction,e.setUseDepthCompareMode(this._useDepthCompareMode))},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._platformTexture.destroy(),this._platformTexture=null},a._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},a._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},q(i,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"usage",get:function(){return this._usage}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var r=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>r&&(ve.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+r),e=r),e<1&&(ve.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}},{key:"depthCompareFunction",get:function(){return this._depthCompareFunction},set:function(e){if(!this._engine._hardwareRenderer._isWebGL2){console.warn("depthCompareFunction only support WebGL2");return}e!==this._depthCompareFunction&&(this._depthCompareFunction=e,this._platformTexture.depthCompareFunction=e)}}]),i}(mc),Iu=function(n){W(i,n);function i(t,e,r,o,s,l){s===void 0&&(s=kt.Depth),l===void 0&&(l=1);var u;if(u=n.call(this,t)||this,u._autoGenerateMipmaps=!0,u._width=e,u._height=r,u._antiAliasing=l,u._depth=s,o){for(var c=gt(o,Array)?o.slice():[o],d=0,_=c.length;d<_;d++){var f=c[d];if(f._isDepthTexture)throw"Render texture can't use depth format.";f._addReferCount(1)}u._colorTextures=c}else u._colorTextures=[];if(gt(s,Zr)){if(!s._isDepthTexture)throw"Depth texture must use depth format.";u._depthTexture=s,u._depthTexture._addReferCount(1)}return u._platformRenderTarget=t._hardwareRenderer.createPlatformRenderTarget(fe(u)),u}var a=i.prototype;return a.getColorTexture=function(e){e===void 0&&(e=0);var r;return(r=this._colorTextures[e])!=null?r:null},a.generateMipmaps=function(){if(this._autoGenerateMipmaps){for(var e=this._colorTextures,r=0,o=e.length;r<o;r++){var s=e[r];s.generateMipmaps()}this._depthTexture&&this._depthTexture.generateMipmaps()}},a._onDestroy=function(){var e;n.prototype._onDestroy.call(this),this._platformRenderTarget.destroy();for(var r=this,o=r._colorTextures,s=0,l=o.length;s<l;s++)o[s]._addReferCount(-1);o.length=0,(e=this._depthTexture)==null||e._addReferCount(-1),this._depthTexture=null,this._depth=null},a._setRenderTargetInfo=function(e,r){this._platformRenderTarget.setRenderTargetInfo(e,r),this._isContentLost=!1},a._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},a._rebuild=function(){this._platformRenderTarget=this._engine._hardwareRenderer.createPlatformRenderTarget(this)},q(i,[{key:"autoGenerateMipmaps",get:function(){return this._autoGenerateMipmaps},set:function(e){this._autoGenerateMipmaps=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),i}(mc),fn=function(n){W(i,n);function i(t,e,r,o,s,l){o===void 0&&(o=X.R8G8B8A8),s===void 0&&(s=!0),l===void 0&&(l=Vo.Static);var u;return u=n.call(this,t)||this,u._mipmap=s,u._width=e,u._height=r,u._usage=l,u._format=o,u._mipmapCount=u._getMipmapCount(),u._isDepthTexture=o==X.Depth||o==X.DepthStencil||o==X.Depth16||o==X.Depth24||o==X.Depth32||o==X.Depth24Stencil8||o==X.Depth32Stencil8,u._platformTexture=t._hardwareRenderer.createPlatformTexture2D(fe(u)),u.filterMode=tn.Bilinear,u.wrapModeU=u.wrapModeV=$t.Repeat,u}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u){r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=0),this._platformTexture.setPixelBuffer(e,r,o,s,l,u),this._isContentLost=!1},a.setImageSource=function(e,r,o,s,l,u){r===void 0&&(r=0),o===void 0&&(o=!1),s===void 0&&(s=!1),l===void 0&&(l=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,r,o,s,l,u),this._isContentLost=!1},a.getPixelBuffer=function(e,r,o,s,l,u){var c=arguments.length;c===1?this._platformTexture.getPixelBuffer(0,0,this._width,this._height,0,e):c===2?this._platformTexture.getPixelBuffer(0,0,this._width>>e,this._height>>e,e,r):c===5?this._platformTexture.getPixelBuffer(e,r,o,s,0,l):c===6&&this._platformTexture.getPixelBuffer(e,r,o,s,l,u)},a._rebuild=function(){this._platformTexture=this._engine._hardwareRenderer.createPlatformTexture2D(this),n.prototype._rebuild.call(this)},i}(Zr),Mf=function(n){W(i,n);function i(t,e,r,o,s,l){s===void 0&&(s=X.R8G8B8A8),l===void 0&&(l=!0);var u;return u=n.call(this,t)||this,u._mipmap=l,u._width=e,u._height=r,u._length=o,u._format=s,u._mipmapCount=u._getMipmapCount(),u._platformTexture=t._hardwareRenderer.createPlatformTexture2DArray(fe(u)),u.filterMode=tn.Bilinear,u.wrapModeU=u.wrapModeV=$t.Repeat,u}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c,d){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,r,o,s,l,u,c,d),this._isContentLost=!1},a.setImageSource=function(e,r,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),u===void 0&&(u=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,r,o,s,l,u,c),this._isContentLost=!1},a.getPixelBuffer=function(e,r,o,s,l,u,c){var d=arguments.length;d===1?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,r):d===2?this._platformTexture.getPixelBuffer(e,0,0,this._width>>r,this._height>>r,r,o):d===5?this._platformTexture.getPixelBuffer(e,r,o,s,l,0,u):d===6&&this._platformTexture.getPixelBuffer(e,r,o,s,l,u,c)},a._rebuild=function(){this._platformTexture=this._engine._hardwareRenderer.createPlatformTexture2DArray(this),n.prototype._rebuild.call(this)},q(i,[{key:"length",get:function(){return this._length}}]),i}(Zr),Tn=function(n){W(i,n);function i(t,e,r,o){r===void 0&&(r=X.R8G8B8A8),o===void 0&&(o=!0);var s;return s=n.call(this,t)||this,s._mipmap=o,s._width=e,s._height=e,s._format=r,s._mipmapCount=s._getMipmapCount(),s._platformTexture=t._hardwareRenderer.createPlatformTextureCube(fe(s)),s.filterMode=tn.Bilinear,s.wrapModeU=s.wrapModeV=$t.Clamp,s}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,r,o,s,l,u,c),this._isContentLost=!1},a.setImageSource=function(e,r,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),u===void 0&&(u=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,r,o,s,l,u,c),this._isContentLost=!1},a.getPixelBuffer=function(e,r,o,s,l,u,c){var d=arguments.length;d===2?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,r):d===3?this._platformTexture.getPixelBuffer(e,0,0,this._width>>r,this._height>>r,r,o):d===6?this._platformTexture.getPixelBuffer(e,r,o,s,l,0,u):d===7&&this._platformTexture.getPixelBuffer(e,r,o,s,l,u,c)},a._rebuild=function(){this._platformTexture=this._engine._hardwareRenderer.createPlatformTextureCube(this),n.prototype._rebuild.call(this)},i}(Zr),f1=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._charInfoMap={},e._space=1,e._curX=1,e._curY=1,e._nextY=1,e}var a=i.prototype;return a.uploadCharTexture=function(e){var r=e.w,o=e.h,s=e.data,l=this,u=l._space,c=l.texture,d=c.width,_=r+u,f=o+u;if(1+_>=d||1+f>=d)throw Error("The char fontSize is too large.");var v=this._curX+_;v>=d&&(this._curX=u,this._curY=this._nextY+u);var p=this._curY+f;if(p>this._nextY&&(this._nextY=p),p>=d)return!1;r>0&&o>0&&s&&(e.bufferOffset=new te(this._curX,this._curY),c.setPixelBuffer(s,0,this._curX,this._curY,r,o),c.generateMipmaps());var g=1/d,m=this._curX,h=this._curY,y=r,A=o,S=m*g,x=(m+y)*g,C=h*g,E=(h+A)*g;e.x=m,e.y=h;var T=e.uvs;return T[0].set(S,C),T[1].set(x,C),T[2].set(x,E),T[3].set(S,E),this._curX+=_+u,!0},a.addCharInfo=function(e,r){this._charInfoMap[e.charCodeAt(0)]=r},a.getCharInfo=function(e){return this._charInfoMap[e.charCodeAt(0)]},a._onDestroy=function(){n.prototype._onDestroy.call(this),this.texture.destroy(),this.texture=null,this._charInfoMap={}},i}(ni),ki;(function(n){n[n.None=0]="None",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic"})(ki||(ki={}));var Oa;(function(n){n[n.Overflow=0]="Overflow",n[n.Truncate=1]="Truncate"})(Oa||(Oa={}));var ur=function(){function n(){}return n.textContext=function(){var a=n._textContext;if(!a){var t;try{t=new OffscreenCanvas(0,0)}catch{t=document.createElement("canvas")}var e=t.getContext("2d",{willReadFrequently:!0});a={canvas:t,context:e},n._textContext=a}return a},n.measureFont=function(a){var t=n._fontSizeInfoCache,e=t[a];return e||(e=n._measureFontOrChar(a),t[a]=e,e)},n.getNativeFontString=function(a,t,e){var r=e&ki.Bold?"bold ":"";return e&ki.Italic&&(r+="italic "),!/([\"\'])[^\'\"]+\1/.test(a)&&n._genericFontFamilies.indexOf(a)==-1&&(a='"'+a+'"'),r+=t+"px "+a,r},n.measureChar=function(a,t){return n._measureFontOrChar(t,a)},n.measureTextWithWrap=function(a){var t=a._subFont,e=t.nativeFontString,r=n.measureFont(e),o=a.text.split(/(?:\r\n|\r|\n)/),s=new Array,l=new Array,u=new Array,c=$r._pixelsPerUnit,d=r.size+a.lineSpacing*c,_=a.width*c,f=0;t.nativeFontString=e;for(var v=0,p=o.length;v<p;v++){var g=o[v];if(g.length===0){this._pushLine(s,l,u,"",0,0,0);continue}for(var m="",h=0,y=0,A=0,S="",x=0,C=0,E=0,T=!1,w=0,R=g.length;w<R;++w){var b=g[w],B=n._getCharInfo(b,e,t),I=b.charCodeAt(0),V=I===32;if(!(V&&T&&S.length===0&&m.length===0)){var L=V||I>=19968&&I<=40959,F=B.w,D=B.offsetY,N=B.h*.5,O=N+D,k=N-D;L?(m.length>0&&(x+h>_?(x>0&&this._pushLine(s,l,u,S,x,C,E),f=Math.max(f,x),T=!0,S=m,x=h,C=y,E=A):(S+=m,x+=h,C=Math.max(C,y),E=Math.max(E,A)),m="",h=y=A=0),x+F>_&&x>0?(this._pushLine(s,l,u,S,x,C,E),f=Math.max(f,x),T=!0,V?(S="",x=C=E=0):(S=b,x=B.xAdvance,C=O,E=k)):(S+=b,x+=B.xAdvance,C=Math.max(C,O),E=Math.max(E,k))):h+B.w>_?(x>0&&(this._pushLine(s,l,u,S,x,C,E),f=Math.max(f,x),S="",x=C=E=0),h>0&&this._pushLine(s,l,u,m,h,y,A),f=Math.max(f,h),T=!0,m=b,h=B.xAdvance,y=O,A=k):(m+=b,h+=B.xAdvance,y=C=Math.max(y,O),A=E=Math.max(A,k))}}h>0&&(x+h>_?(x>0&&this._pushLine(s,l,u,S,x,C,E),f=Math.max(f,x),x=0,h>0&&this._pushLine(s,l,u,m,h,y,A),f=Math.max(f,h)):(S+=m,x+=h,C=Math.max(C,y),E=Math.max(E,A))),x>0&&(this._pushLine(s,l,u,S,x,C,E),f=Math.max(f,x))}var Q=a.height*c;return a.overflowMode===Oa.Overflow&&(Q=d*s.length),{width:f,height:Q,lines:s,lineWidths:l,lineHeight:d,lineMaxSizes:u}},n.measureTextWithoutWrap=function(a){var t=a._subFont,e=t.nativeFontString,r=n.measureFont(e),o=a.text.split(/(?:\r\n|\r|\n)/),s=o.length,l=new Array,u=new Array,c=new Array,d=$r._pixelsPerUnit,_=r.size+a.lineSpacing*d,f=0;t.nativeFontString=e;for(var v=0;v<s;++v){for(var p=o[v],g=0,m=0,h=0,y=0,A=p.length;y<A;++y){var S=n._getCharInfo(p[y],e,t);g+=S.xAdvance;var x=S.offsetY,C=S.h*.5,E=C+x,T=C-x;m<E&&(m=E),h<T&&(h=T)}g>0&&(this._pushLine(l,u,c,p,g,m,h),f=Math.max(f,g))}var w=a.height*d;return a.overflowMode===Oa.Overflow&&(w=_*l.length),{width:f,height:w,lines:l,lineWidths:u,lineHeight:_,lineMaxSizes:c}},n.getNativeFontHash=function(a,t,e){var r=e&ki.Bold?"bold":"";return e&ki.Italic&&(r+="italic"),!/([\"\'])[^\'\"]+\1/.test(a)&&n._genericFontFamilies.indexOf(a)==-1&&(a=""+a),r+=t+"px"+a,r},n._measureFontOrChar=function(a,t){t===void 0&&(t="");var e=n.textContext(),r=e.canvas,o=e.context;o.font=a;var s=t||n._measureString,l=Math.max(1,Math.round(o.measureText(s).width)),u=Math.ceil(o.measureText(n._measureBaseline).width),c=u*n._heightMultiplier;u=n._baselineMultiplier*u|0,r.width=l,r.height=c,o.font=a,o.fillStyle="#000",o.clearRect(0,0,l,c),o.textBaseline="middle",o.fillStyle="#fff",o.fillText(s,0,u);for(var d=o.getImageData(0,0,l,c).data,_=d.length,f=-1,v=-1,p,g=0,m=0,h=0,y=r.width,A=1/y,S=0;S<_;S+=4)if(d[S+3]!==0){var x=S*.25;p=~~(x*A),f===-1&&(f=p),p>v&&(v=p)}else d[S]=d[S+1]=d[S+2]=255;f!==-1&&v!==-1&&(g=u-f,m=v-u+1,h=g+m);var C={ascent:g,descent:m,size:h};if(t){var E=null;if(h>0){var T=y*4;E=new Uint8Array(d.buffer,f*T,h*T)}return{char:t,x:0,y:0,w:l,h,offsetX:0,offsetY:(g-m)*.5,xAdvance:l,uvs:[new te,new te,new te,new te],ascent:g,descent:m,index:0,data:E}}else return C},n._getCharInfo=function(a,t,e){var r=e._getCharInfo(a);return r||(r=n.measureChar(a,t),e._uploadCharTexture(r),e._addCharInfo(a,r)),r},n._pushLine=function(a,t,e,r,o,s,l){a.push(r),t.push(o),e.push({ascent:s,descent:l,size:s+l})},n}();(function(){ur._genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui","math","emoji","fangsong"]})();(function(){ur._measureString="|ÉqÅ"})();(function(){ur._measureBaseline="M"})();(function(){ur._heightMultiplier=2})();(function(){ur._baselineMultiplier=1.4})();(function(){ur._fontSizeInfoCache={}})();(function(){ur._textContext=null})();var h1=function(){function n(a){this._fontAtlases=[],this._lastIndex=-1,this._engine=a}var i=n.prototype;return i.destroy=function(){for(var t=this._fontAtlases,e=0,r=t.length;e<r;++e)t[e].destroy(!0);t.length=0},i._uploadCharTexture=function(t){var e=this._fontAtlases,r=this._lastIndex;r===-1&&(this._createFontAtlas(),r++);var o=e[r];o.uploadCharTexture(t)||(o=this._createFontAtlas(),o.uploadCharTexture(t),r++),this._lastIndex=r,t.data=null},i._addCharInfo=function(t,e){var r=this._lastIndex;e.index=r,this._fontAtlases[r].addCharInfo(t,e)},i._getCharInfo=function(t){for(var e=this._fontAtlases,r=0,o=e.length;r<o;++r){var s=e[r],l=s.getCharInfo(t);if(l)return l}return null},i._getTextureByIndex=function(t){var e=this._fontAtlases[t];return e?e.texture:null},i._getLastIndex=function(){return this._lastIndex},i._createFontAtlas=function(){var t=this,e=t._engine,r=new f1(e),o=new fn(e,256,256);r.texture=o,r.isGCIgnored=o.isGCIgnored=!0,this._fontAtlases.push(r);var s=this.nativeFontString;return e.resourceManager.addContentRestorer(new(function(l){W(u,l);function u(){return l.call(this,r)}var c=u.prototype;return c.restoreContent=function(){var _=this.resource,f=_._charInfoMap,v=_.texture;for(var p in f){var g=f[p],m=ur.measureChar(g.char,s).data;if(g.w>0&&g.h>0&&m){var h=g.bufferOffset;v.setPixelBuffer(m,0,h.x,h.y,g.w,g.h)}}v.generateMipmaps()},u}(gi))),r},n}(),No=function(n){W(i,n);function i(t,e){e===void 0&&(e="");var r;return r=n.call(this,t)||this,r._name="",r._subFontMap={},r._name=e,r}var a=i.prototype;return a._getSubFont=function(e,r){var o=e+"-"+r,s=this._subFontMap,l=s[o];return l||(l=new h1(this.engine),s[o]=l,l)},a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._subFontMap;for(var r in e)e[r].destroy();this._subFontMap=null,delete this.engine._fontMap[this._name]},i.createFromOS=function(e,r){if(r){var o=e._fontMap,s=o[r];return s||(s=new i(e,r),o[r]=s,s)}return null},q(i,[{key:"name",get:function(){return this._name}}]),i}(ni),Pf=function(){function n(){this._events=Object.create(null),this._eventCount=0}var i=n.prototype;return i.hasEvent=function(t){return this._events[t]!=null},i.eventNames=function(){return this._eventCount===0?[]:Object.keys(this._events)},i.listenerCount=function(t){var e=this._events[t];return e?Array.isArray(e)?e.length:1:0},i.dispatch=function(t,e){if(!this._events[t])return!1;var r=this._events[t];if(Array.isArray(r)){var o=r.length,s=n._dispatchingListenersPool,l=s.length>0?s.pop():[];l.length=o;for(var u=0;u<o;u++)l[u]=r[u];for(var c=0;c<o;c++){var d=l[c];d.destroyed||(d.once&&this.off(t,d.fn),d.fn(e))}l.length=0,s.push(l)}else r.once&&this.off(t,r.fn),r.fn(e);return!0},i.on=function(t,e){return this._addEventListener(t,e)},i.once=function(t,e){return this._addEventListener(t,e,!0)},i.off=function(t,e){if(!this._events[t])return this;if(!e)return this._clearEvent(t),this;var r=this._events[t],o=Array.isArray(r);if(!o&&r.fn===e)this._clearEvent(t);else if(o){for(var s=r.length-1;s>=0;s--)r[s].fn===e&&(r[s].destroyed=!0,r.splice(s,1));r.length===0?this._clearEvent(t):r.length===1&&(this._events[t]=r[0])}return this},i.removeEventListener=function(t,e){return this.off(t,e)},i.removeAllEventListeners=function(t){t?this._events[t]&&this._clearEvent(t):(this._events=Object.create(null),this._eventCount=0)},i._addEventListener=function(t,e,r){var o={fn:e,once:r},s=this._events,l=s[t];return l?Array.isArray(l)?l.push(o):s[t]=[l,o]:(s[t]=o,this._eventCount++),this},i._clearEvent=function(t){--this._eventCount===0?this._events=Object.create(null):delete this._events[t]},n}();(function(){Pf._dispatchingListenersPool=[]})();var U=function(){function n(i){this.name=i,this._uniqueId=n._propertyNameCounter++}return n.getByName=function(a){var t=n._propertyNameMap;if(t[a]!=null)return t[a];var e=new n(a);return t[a]=e,n._propertyIdMap[e._uniqueId]=e,e},n._getShaderPropertyGroup=function(a){var t,e=n._propertyNameMap[a];return(t=e)==null?void 0:t._group},q(n,[{key:"type",get:function(){return this._type}}]),n}();(function(){U._propertyIdMap=Object.create(null)})();(function(){U._propertyNameCounter=0})();(function(){U._propertyNameMap=Object.create(null)})();var yc=function(){function n(){this._frameCount=0,this._deltaTime=0,this._actualDeltaTime=0,this._elapsedTime=0,this._actualElapsedTime=0,this._elapsedTimeValue=new ue,this._deltaTimeValue=new ue,this.maximumDeltaTime=.333333,this.timeScale=1,this._lastSystemTime=performance.now()/1e3}var i=n.prototype;return i._reset=function(){this._lastSystemTime=performance.now()/1e3},i._update=function(){var t=performance.now()/1e3,e=t-this._lastSystemTime;this._actualDeltaTime=e,this._actualElapsedTime+=e;var r=Math.min(e,this.maximumDeltaTime)*this.timeScale;this._deltaTime=r,this._elapsedTime+=r,this._frameCount++,this._lastSystemTime=t},i._updateSceneShaderData=function(t){var e=this,r=e._elapsedTimeValue,o=e._deltaTimeValue,s=this._elapsedTime;r.set(s,Math.sin(s),Math.cos(s),0),t.setVector4(n._elapsedTimeProperty,r),o.set(this._deltaTime,0,0,0),t.setVector4(n._deltaTimeProperty,o)},q(n,[{key:"frameCount",get:function(){return this._frameCount}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"elapsedTime",get:function(){return this._elapsedTime}},{key:"actualDeltaTime",get:function(){return this._actualDeltaTime}},{key:"actualElapsedTime",get:function(){return this._actualElapsedTime}}]),n}();(function(){yc._elapsedTimeProperty=U.getByName("scene_ElapsedTime")})();(function(){yc._deltaTimeProperty=U.getByName("scene_DeltaTime")})();var We;(function(n){n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT=5124]="INT",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.FLOAT_ARRAY=35677]="FLOAT_ARRAY",n[n.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",n[n.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",n[n.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",n[n.INT_ARRAY=100003]="INT_ARRAY",n[n.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",n[n.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",n[n.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",n[n.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",n[n.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",n[n.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",n[n.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",n[n.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT"})(We||(We={}));var Z;(function(n){n.shaderVertexID="shaderVertexID",n.standardDerivatives="OES_standard_derivatives",n.shaderTextureLod="EXT_shader_texture_lod",n.elementIndexUint="OES_element_index_uint",n.depthTexture="WEBGL_depth_texture",n.drawBuffers="WEBGL_draw_buffers",n.vertexArrayObject="OES_vertex_array_object",n.instancedArrays="ANGLE_instanced_arrays",n.multipleSample="multipleSampleOnlySupportedInWebGL2",n.textureFloat="OES_texture_float",n.textureFloatLinear="OES_texture_float_linear",n.textureHalfFloat="OES_texture_half_float",n.textureHalfFloatLinear="OES_texture_half_float_linear",n.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",n.colorBufferFloat="EXT_color_buffer_float",n.colorBufferHalfFloat="EXT_color_buffer_half_float",n.textureFilterAnisotropic="EXT_texture_filter_anisotropic",n.blendMinMax="EXT_blend_minmax",n.astc="WEBGL_compressed_texture_astc",n.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",n.etc="WEBGL_compressed_texture_etc",n.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",n.etc1="WEBGL_compressed_texture_etc1",n.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",n.pvrtc="WEBGL_compressed_texture_pvrtc",n.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",n.s3tc="WEBGL_compressed_texture_s3tc",n.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc",n.bptc="EXT_texture_compression_bptc",n.WEBGL_lose_context="WEBGL_lose_context"})(Z||(Z={}));var _e;(function(n){n[n.None=0]="None",n[n.Scene=1]="Scene",n[n.Hierarchy=2]="Hierarchy",n[n.All=3]="All"})(_e||(_e={}));var rn=function(n){W(i,n);function i(t){var e;return e=n.call(this,t.engine)||this,e._awoken=!1,e._phasedActiveInScene=!1,e._phasedActive=!1,e._enabled=!0,e._entity=t,e}var a=i.prototype;return a._onAwake=function(){},a._onEnable=function(){},a._onDisable=function(){},a._onEnableInScene=function(){},a._onDisableInScene=function(){},a._setActive=function(e,r){var o=this._entity;r&_e.Scene&&(e?!this._phasedActiveInScene&&o._isActiveInScene&&this._enabled&&(this._phasedActiveInScene=!0,this._onEnableInScene()):this._phasedActiveInScene&&!(o._isActiveInScene&&this._enabled)&&(this._phasedActiveInScene=!1,this._onDisableInScene())),r&_e.Hierarchy&&(e?(!this._awoken&&o._isActiveInHierarchy&&(this._awoken=!0,this._onAwake()),!this._phasedActive&&o._isActiveInHierarchy&&this._enabled&&(this._phasedActive=!0,this._onEnable())):this._phasedActive&&!(o._isActiveInHierarchy&&this._enabled)&&(this._phasedActive=!1,this._onDisable()))},a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._entity;e._removeComponent(this),this._enabled&&(e._isActiveInScene&&this._onDisableInScene(),e._isActiveInHierarchy&&this._onDisable())},q(i,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,this._entity._isActiveInScene&&(e?(this._phasedActiveInScene=!0,this._onEnableInScene()):(this._phasedActiveInScene=!1,this._onDisableInScene())),this._entity.isActiveInHierarchy&&(e?(this._phasedActive=!0,this._onEnable()):(this._phasedActive=!1,this._onDisable())))}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),i}(ti);P([z],rn.prototype,"_entity",void 0);P([z],rn.prototype,"_awoken",void 0);P([z],rn.prototype,"_phasedActiveInScene",void 0);P([z],rn.prototype,"_phasedActive",void 0);P([Ie],rn.prototype,"_enabled",void 0);var Fo=function(){function n(){}return n._addCheck=function(a,t){for(;t!==rn;){var e=n._dependenciesMap.get(t);if(e)for(var r=e.components,o=e.mode,s=0,l=r.length;s<l;s++){var u=r[s];if(!a.getComponent(u))if(o===1)a.addComponent(u);else throw"Should add "+u.name+" before adding "+t.name}t=Object.getPrototypeOf(t)}},n._removeCheck=function(a,t){for(;t!==rn;){var e=n._invDependenciesMap.get(t);if(e){for(var r=0,o=e.length;r<o;r++)if(a.getComponent(e[r]))throw"Should remove "+e[r].name+" before adding "+t.name}t=Object.getPrototypeOf(t)}},n._addDependency=function(a,t,e){var r=e.get(a);r?r.includes(t)||r.push(t):e.set(a,[t])},n._addInvDependency=function(a,t){var e=this._invDependenciesMap,r=e.get(a);r?r.includes(t)||r.push(t):e.set(a,[t])},n}();(function(){Fo._invDependenciesMap=new Map})();(function(){Fo._dependenciesMap=new Map})();function ll(n,i){i===void 0&&(i=0);var a=Array.isArray(n)?n:[n];return function(t){Fo._dependenciesMap.set(t,{mode:i,components:a}),a.forEach(function(e){return Fo._addInvDependency(e,t)})}}var za;(function(n){n[n.CheckOnly=0]="CheckOnly",n[n.AutoAdd=1]="AutoAdd"})(za||(za={}));var rt=function(){function n(a){a===void 0&&(a=0),this.length=0,this._isLooping=!1,this._blankCount=0,this._elements=new Array(a)}var i=n.prototype;return i.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},i.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},i.set=function(t,e){if(t>=this.length)throw"Index is out of range.";this._elements[t]=e},i.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},i.deleteByIndex=function(t){var e=this._elements,r;if(this._isLooping)this._elements[t]=null,this._blankCount++;else{var o=this.length-1;t!==o&&(r=e[o],e[t]=r),e[o]=null,this.length--}return r},i.forEach=function(t,e){this._startLoop();for(var r=this._elements,o=0;o<this.length;o++){var s=r[o];s&&t(s)}this._endLoop(e)},i.forEachAndClean=function(t){this._startLoop();for(var e=this._elements,r=0;r<this.length;r++){var o=e[r];o&&t(o)}this._endLoopAndClear()},i.garbageCollection=function(){this._elements.length=this.length},i._startLoop=function(){this._isLooping=!0},i._endLoop=function(t){if(this._isLooping=!1,this._blankCount){var e=0,r=this.length-1,o=this._elements;e:do{for(;o[e];)if(++e>=r)break e;for(;!o[r];)if(e>=--r)break e;var s=o[r];t(s,e),o[e++]=s,o[r--]=null}while(e<r);this.length-=this._blankCount,this._blankCount=0}},i._endLoopAndClear=function(){this._isLooping=!1,this.length=0,this._blankCount=0},n}(),Yn;(function(n){n[n.Layer0=1]="Layer0",n[n.Layer1=2]="Layer1",n[n.Layer2=4]="Layer2",n[n.Layer3=8]="Layer3",n[n.Layer4=16]="Layer4",n[n.Layer5=32]="Layer5",n[n.Layer6=64]="Layer6",n[n.Layer7=128]="Layer7",n[n.Layer8=256]="Layer8",n[n.Layer9=512]="Layer9",n[n.Layer10=1024]="Layer10",n[n.Layer11=2048]="Layer11",n[n.Layer12=4096]="Layer12",n[n.Layer13=8192]="Layer13",n[n.Layer14=16384]="Layer14",n[n.Layer15=32768]="Layer15",n[n.Layer16=65536]="Layer16",n[n.Layer17=131072]="Layer17",n[n.Layer18=262144]="Layer18",n[n.Layer19=524288]="Layer19",n[n.Layer20=1048576]="Layer20",n[n.Layer21=2097152]="Layer21",n[n.Layer22=4194304]="Layer22",n[n.Layer23=8388608]="Layer23",n[n.Layer24=16777216]="Layer24",n[n.Layer25=33554432]="Layer25",n[n.Layer26=67108864]="Layer26",n[n.Layer27=134217728]="Layer27",n[n.Layer28=268435456]="Layer28",n[n.Layer29=536870912]="Layer29",n[n.Layer30=1073741824]="Layer30",n[n.Layer31=2147483648]="Layer31",n[n.Everything=4294967295]="Everything",n[n.Nothing=0]="Nothing"})(Yn||(Yn={}));var yt=function(){function n(){}return n._floatMatrixMultiply=function(a,t,e,r,o){var s=a.elements,l=s[0],u=s[1],c=s[2],d=s[3],_=s[4],f=s[5],v=s[6],p=s[7],g=s[8],m=s[9],h=s[10],y=s[11],A=s[12],S=s[13],x=s[14],C=s[15],E=t[e],T=t[e+1],w=t[e+2],R=t[e+3],b=t[e+4],B=t[e+5],I=t[e+6],V=t[e+7],L=t[e+8],F=t[e+9],D=t[e+10],N=t[e+11],O=t[e+12],k=t[e+13],Q=t[e+14],H=t[e+15];r[o]=l*E+_*T+g*w+A*R,r[o+1]=u*E+f*T+m*w+S*R,r[o+2]=c*E+v*T+h*w+x*R,r[o+3]=d*E+p*T+y*w+C*R,r[o+4]=l*b+_*B+g*I+A*V,r[o+5]=u*b+f*B+m*I+S*V,r[o+6]=c*b+v*B+h*I+x*V,r[o+7]=d*b+p*B+y*I+C*V,r[o+8]=l*L+_*F+g*D+A*N,r[o+9]=u*L+f*F+m*D+S*N,r[o+10]=c*L+v*F+h*D+x*N,r[o+11]=d*L+p*F+y*D+C*N,r[o+12]=l*O+_*k+g*Q+A*H,r[o+13]=u*O+f*k+m*Q+S*H,r[o+14]=c*O+v*k+h*Q+x*H,r[o+15]=d*O+p*k+y*Q+C*H},n._reflectGet=function(a,t){for(var e=this._stringToPath(t),r=a,o=0,s=e.length;r!=null&&o<s;)r=r[e[o++]];return o&&o==s?r:void 0},n.removeFromArray=function(a,t){var e=a.indexOf(t);if(e<0)return!1;var r=a.length-1;if(e!==r){var o=a[r];a[e]=o}return a.length--,!0},n.decodeText=function(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);for(var t="",e=0,r=a.length;e<r;e++)t+=String.fromCharCode(a[e]);return decodeURIComponent(encodeURIComponent(t))},n.isAbsoluteUrl=function(a){return/^(?:http|blob|data:|\/)/.test(a)},n.objectValues=function(a){return Object.keys(a).map(function(t){return a[t]})},n.resolveAbsoluteUrl=function(a,t){return n.isAbsoluteUrl(t)?t:a.substring(0,a.lastIndexOf("/")+1)+this._formatRelativePath(t)},n._stringToPath=function(a){var t=[];return a.charCodeAt(0)===v1&&t.push(""),a.replace(g1,function(e,r,o,s){var l=e;o?l=s.replace(p1,"$1"):r&&(l=r.trim()),t.push(l)}),t},n._formatRelativePath=function(a){return a.split("/").filter(Boolean).reduce(function(t,e){return e===".."?t.pop():e!=="."&&t.push(e),t},[]).join("/")},n}(),v1=46,p1=/\\(\\)?/g,g1=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),m1=function(){function n(){this._flagManagers=[]}var i=n.prototype;return i.clearFromManagers=function(){this._removeFromManagers(),this._flagManagers.length=0},i.destroy=function(){this._removeFromManagers(),this._flagManagers=null},i._removeFromManagers=function(){for(var t=this._flagManagers,e=0,r=t.length;e<r;e++)yt.removeFromArray(t[e]._updateFlags,this)},n}(),Ac=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.flag=!0,t}var a=i.prototype;return a.dispatch=function(){this.flag=!0},i}(m1),ra=function(){function n(){this._updateFlags=[],this._listeners=[]}var i=n.prototype;return i.createFlag=function(t){var e=new t;return this.addFlag(e),e},i.addFlag=function(t){this._updateFlags.push(t),t._flagManagers.push(this)},i.removeFlag=function(t){var e=yt.removeFromArray(this._updateFlags,t);e&&yt.removeFromArray(t._flagManagers,this)},i.addListener=function(t){this._listeners.push(t)},i.removeListener=function(t){yt.removeFromArray(this._listeners,t)},i.dispatch=function(t,e){for(var r=this._updateFlags,o=r.length-1;o>=0;o--)r[o].dispatch(t,e);for(var s=this._listeners,l=s.length-1;l>=0;l--)s[l](t,e)},n}(),ye=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._position=new M,e._rotation=new M,e._rotationQuaternion=new xe,e._scale=new M(1,1,1),e._worldPosition=new M,e._worldRotation=new M,e._worldRotationQuaternion=new xe,e._lossyWorldScale=new M(1,1,1),e._localMatrix=new $,e._worldMatrix=new $,e._worldForward=null,e._worldRight=null,e._worldUp=null,e._isParentDirty=!0,e._parentTransformCache=null,e._dirtyFlag=188,e._updateFlagManager=new ra,e._onPositionChanged=e._onPositionChanged.bind(fe(e)),e._onWorldPositionChanged=e._onWorldPositionChanged.bind(fe(e)),e._onRotationChanged=e._onRotationChanged.bind(fe(e)),e._onWorldRotationChanged=e._onWorldRotationChanged.bind(fe(e)),e._onRotationQuaternionChanged=e._onRotationQuaternionChanged.bind(fe(e)),e._onWorldRotationQuaternionChanged=e._onWorldRotationQuaternionChanged.bind(fe(e)),e._onScaleChanged=e._onScaleChanged.bind(fe(e)),e._position._onValueChanged=e._onPositionChanged,e._worldPosition._onValueChanged=e._onWorldPositionChanged,e._rotation._onValueChanged=e._onRotationChanged,e._worldRotation._onValueChanged=e._onWorldRotationChanged,e._rotationQuaternion._onValueChanged=e._onRotationQuaternionChanged,e._worldRotationQuaternion._onValueChanged=e._onWorldRotationQuaternionChanged,e._scale._onValueChanged=e._onScaleChanged,e}var a=i.prototype;return a.setPosition=function(e,r,o){this._position.set(e,r,o)},a.setRotation=function(e,r,o){this._rotation.set(e,r,o)},a.setRotationQuaternion=function(e,r,o,s){this._rotationQuaternion.set(e,r,o,s)},a.setScale=function(e,r,o){this._scale.set(e,r,o)},a.setWorldPosition=function(e,r,o){this._worldPosition.set(e,r,o)},a.setWorldRotation=function(e,r,o){this._worldRotation.set(e,r,o)},a.setWorldRotationQuaternion=function(e,r,o,s){this._worldRotationQuaternion.set(e,r,o,s)},a.translate=function(e,r,o,s){if(typeof e=="number"){var l=i._tempVec30;l.set(e,r,o),this._translate(l,s)}else this._translate(e,r)},a.rotate=function(e,r,o,s){typeof e=="number"?this._rotateXYZ(e,r,o,s):this._rotateXYZ(e.x,e.y,e.z,r)},a.rotateByAxis=function(e,r,o){o===void 0&&(o=!0);var s=r*G.degreeToRadFactor;xe.rotationAxisAngle(e,s,i._tempQuat0),this._rotateByQuat(i._tempQuat0,o)},a.lookAt=function(e,r){var o=i._tempVec30;M.subtract(this.worldPosition,e,o);var s=o.length();if(!(s<=G.zeroTolerance)){o.scale(1/s);var l=i._tempVec31;if(r?M.cross(r,o,l):l.set(o.z,0,-o.x),s=l.length(),!(s<=G.zeroTolerance)){l.scale(1/s);var u=i._tempVec32;M.cross(o,l,u);var c=i._tempMat41,d=c.elements;d[0]=l.x,d[1]=l.y,d[2]=l.z,d[4]=u.x,d[5]=u.y,d[6]=u.z,d[8]=o.x,d[9]=o.y,d[10]=o.z,c.getRotation(this._worldRotationQuaternion)}}},a.registerWorldChangeFlag=function(){return this._updateFlagManager.createFlag(Ac)},a._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},a._isFrontFaceInvert=function(){var e=this.lossyWorldScale,r=e.x<0;return e.y<0&&(r=!r),e.z<0&&(r=!r),r},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._worldPosition._onValueChanged=null,this._rotation._onValueChanged=null,this._worldRotation._onValueChanged=null,this._rotationQuaternion._onValueChanged=null,this._worldRotationQuaternion._onValueChanged=null,this._position._onValueChanged=null,this._scale._onValueChanged=null},a._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(132)){this._worldAssociatedChange(132);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionFlag()}}},a._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(152)){this._worldAssociatedChange(152);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(156)){this._worldAssociatedChange(156);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(160)){this._worldAssociatedChange(160);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndScaleFlag()}}},a._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(164)){this._worldAssociatedChange(164);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateWorldPositionAndScaleFlag()}}},a._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(188)){this._worldAssociatedChange(188);for(var e=this._entity._children,r=0,o=e.length;r<o;r++){var s;(s=e[r].transform)==null||s._updateAllWorldFlag()}}},a._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,r=this._entity.parent;r;){var o=r.transform;if(o){e=o;break}else r=r.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},a._getScaleMatrix=function(){var e=i._tempQuat0,r=i._tempMat30,o=i._tempMat31,s=i._tempMat32;return o.copyFromMatrix(this.worldMatrix),xe.invert(this.worldRotationQuaternion,e),Io.rotationQuaternion(e,r),Io.multiply(r,o,s),s},a._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.dispatch(128)},a._rotateByQuat=function(e,r){r?xe.multiply(this.rotationQuaternion,e,this._rotationQuaternion):xe.multiply(e,this.worldRotationQuaternion,this._worldRotationQuaternion)},a._translate=function(e,r){if(r===void 0&&(r=!0),r){var o=i._tempVec30;M.transformByQuat(e,this.worldRotationQuaternion,o),this.worldPosition.add(o)}else this.worldPosition.add(e)},a._rotateXYZ=function(e,r,o,s){s===void 0&&(s=!0);var l=G.degreeToRadFactor,u=i._tempQuat0;xe.rotationEuler(e*l,r*l,o*l,u),this._rotateByQuat(u,s)},a._onPositionChanged=function(){this._setDirtyFlagTrue(64),this._updateWorldPositionFlag()},a._onWorldPositionChanged=function(){var e=this._worldPosition,r=this._getParentTransform();r?($.invert(r.worldMatrix,i._tempMat41),M.transformCoordinate(e,i._tempMat41,this._position)):this._position.copyFrom(e),this._setDirtyFlagFalse(4)},a._onRotationChanged=function(){this._setDirtyFlagTrue(66),this._setDirtyFlagFalse(1),this._updateWorldRotationFlag()},a._onWorldRotationChanged=function(){var e=this._worldRotation;xe.rotationEuler(G.degreeToRadian(e.x),G.degreeToRadian(e.y),G.degreeToRadian(e.z),this._worldRotationQuaternion),this._setDirtyFlagFalse(8)},a._onRotationQuaternionChanged=function(){this._setDirtyFlagTrue(65),this._setDirtyFlagFalse(2),this._updateWorldRotationFlag()},a._onWorldRotationQuaternionChanged=function(){var e=this._worldRotationQuaternion,r=this._getParentTransform();if(r){var o=i._tempQuat0;xe.invert(r.worldRotationQuaternion,o),xe.multiply(o,e,this._rotationQuaternion)}else this._rotationQuaternion.copyFrom(e);this._setDirtyFlagFalse(16)},a._onScaleChanged=function(){this._setDirtyFlagTrue(64),this._updateWorldScaleFlag()},q(i,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&this._position.copyFrom(e)}},{key:"worldPosition",get:function(){var e=this._worldPosition;return this._isContainDirtyFlag(4)&&(e._onValueChanged=null,this._getParentTransform()?this.worldMatrix.getTranslation(e):e.copyFrom(this._position),e._onValueChanged=this._onWorldPositionChanged,this._setDirtyFlagFalse(4)),e},set:function(e){this._worldPosition!==e&&this._worldPosition.copyFrom(e)}},{key:"rotation",get:function(){var e=this._rotation;return this._isContainDirtyFlag(1)&&(e._onValueChanged=null,this._rotationQuaternion.toEuler(e),e.scale(G.radToDegreeFactor),e._onValueChanged=this._onRotationChanged,this._setDirtyFlagFalse(1)),e},set:function(e){this._rotation!==e&&this._rotation.copyFrom(e)}},{key:"worldRotation",get:function(){var e=this._worldRotation;return this._isContainDirtyFlag(8)&&(e._onValueChanged=null,this.worldRotationQuaternion.toEuler(e),e.scale(G.radToDegreeFactor),e._onValueChanged=this._onWorldRotationChanged,this._setDirtyFlagFalse(8)),e},set:function(e){this._worldRotation!==e&&this._worldRotation.copyFrom(e)}},{key:"rotationQuaternion",get:function(){var e=this._rotationQuaternion;return this._isContainDirtyFlag(2)&&(e._onValueChanged=null,xe.rotationEuler(G.degreeToRadian(this._rotation.x),G.degreeToRadian(this._rotation.y),G.degreeToRadian(this._rotation.z),e),e._onValueChanged=this._onRotationQuaternionChanged,this._setDirtyFlagFalse(2)),e},set:function(e){this._rotationQuaternion!==e?e.normalized?this._rotationQuaternion.copyFrom(e):xe.normalize(e,this._rotationQuaternion):e.normalized||e.normalize()}},{key:"worldRotationQuaternion",get:function(){var e=this._worldRotationQuaternion;if(this._isContainDirtyFlag(16)){e._onValueChanged=null;var r=this._getParentTransform();r!=null?xe.multiply(r.worldRotationQuaternion,this.rotationQuaternion,e):e.copyFrom(this.rotationQuaternion),e._onValueChanged=this._onWorldRotationQuaternionChanged,this._setDirtyFlagFalse(16)}return e},set:function(e){this._worldRotationQuaternion!==e&&(e.normalized?this._worldRotationQuaternion.copyFrom(e):xe.normalize(e,this._worldRotationQuaternion)),e.normalized||e.normalize()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&this._scale.copyFrom(e)}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(32)){if(this._getParentTransform()){var e=this._getScaleMatrix(),r=e.elements;this._lossyWorldScale.set(r[0],r[4],r[8])}else this._lossyWorldScale.copyFrom(this._scale);this._setDirtyFlagFalse(32)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(64)&&($.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(64)),this._localMatrix},set:function(e){this._localMatrix!==e&&this._localMatrix.copyFrom(e),this._position._onValueChanged=this._rotationQuaternion._onValueChanged=this._scale._onValueChanged=null,this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._position._onValueChanged=this._onPositionChanged,this._rotationQuaternion._onValueChanged=this._onRotationQuaternionChanged,this._scale._onValueChanged=this._onScaleChanged,this._setDirtyFlagTrue(1),this._setDirtyFlagFalse(66),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(128)){var e=this._getParentTransform();e?$.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(128)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e);var r=this._getParentTransform();r?($.invert(r.worldMatrix,i._tempMat42),$.multiply(i._tempMat42,e,this._localMatrix)):this._localMatrix.copyFrom(e),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(128)}},{key:"worldForward",get:function(){var e=this._worldForward||(this._worldForward=new M),r=this.worldMatrix.elements;return e.set(-r[8],-r[9],-r[10]),e.normalize()}},{key:"worldRight",get:function(){var e=this._worldRight||(this._worldRight=new M),r=this.worldMatrix.elements;return e.set(r[0],r[1],r[2]),e.normalize()}},{key:"worldUp",get:function(){var e=this._worldUp||(this._worldUp=new M),r=this.worldMatrix.elements;return e.set(r[4],r[5],r[6]),e.normalize()}}]),i}(rn);(function(){ye._tempQuat0=new xe})();(function(){ye._tempVec30=new M})();(function(){ye._tempVec31=new M})();(function(){ye._tempVec32=new M})();(function(){ye._tempMat30=new Io})();(function(){ye._tempMat31=new Io})();(function(){ye._tempMat32=new Io})();(function(){ye._tempMat41=new $})();(function(){ye._tempMat42=new $})();P([K],ye.prototype,"_position",void 0);P([K],ye.prototype,"_rotation",void 0);P([K],ye.prototype,"_rotationQuaternion",void 0);P([K],ye.prototype,"_scale",void 0);P([K],ye.prototype,"_worldPosition",void 0);P([K],ye.prototype,"_worldRotation",void 0);P([K],ye.prototype,"_worldRotationQuaternion",void 0);P([K],ye.prototype,"_lossyWorldScale",void 0);P([K],ye.prototype,"_localMatrix",void 0);P([K],ye.prototype,"_worldMatrix",void 0);P([z],ye.prototype,"_worldForward",void 0);P([z],ye.prototype,"_worldRight",void 0);P([z],ye.prototype,"_worldUp",void 0);P([z],ye.prototype,"_isParentDirty",void 0);P([z],ye.prototype,"_parentTransformCache",void 0);P([z],ye.prototype,"_updateFlagManager",void 0);P([z],ye.prototype,"_onPositionChanged",null);P([z],ye.prototype,"_onWorldPositionChanged",null);P([z],ye.prototype,"_onRotationChanged",null);P([z],ye.prototype,"_onWorldRotationChanged",null);P([z],ye.prototype,"_onRotationQuaternionChanged",null);P([z],ye.prototype,"_onWorldRotationQuaternionChanged",null);P([z],ye.prototype,"_onScaleChanged",null);var ov;(function(n){n[n.LocalEuler=1]="LocalEuler",n[n.LocalQuat=2]="LocalQuat",n[n.WorldPosition=4]="WorldPosition",n[n.WorldEuler=8]="WorldEuler",n[n.WorldQuat=16]="WorldQuat",n[n.WorldScale=32]="WorldScale",n[n.LocalMatrix=64]="LocalMatrix",n[n.WorldMatrix=128]="WorldMatrix",n[n.WmWp=132]="WmWp",n[n.WmWeWq=152]="WmWeWq",n[n.WmWpWeWq=156]="WmWpWeWq",n[n.WmWs=160]="WmWs",n[n.WmWpWs=164]="WmWpWs",n[n.WmWpWeWqWs=188]="WmWpWeWqWs"})(ov||(ov={}));var y1=function(){function n(){}return n.cloneComponent=function(a,t,e,r){var o=_r.getCloneMode(a.constructor);for(var s in a)_r.cloneProperty(a,t,s,o[s]);a._cloneTo&&a._cloneTo(t,e,r)},n}(),Br=function(n){W(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r.layer=Yn.Layer0,r._isActiveInHierarchy=!1,r._isActiveInScene=!1,r._components=[],r._scripts=new rt,r._children=[],r._isRoot=!1,r._isActive=!0,r._siblingIndex=-1,r._parent=null,r._invModelMatrix=new $,r.name=e,r.transform=r.addComponent(ye),r._inverseWorldMatFlag=r.transform.registerWorldChangeFlag(),r}var a=i.prototype;return a.addComponent=function(e){Fo._addCheck(this,e);var r=new e(this);return this._components.push(r),r._setActive(!0,_e.All),r},a.getComponent=function(e){for(var r=this._components,o=r.length-1;o>=0;o--){var s=r[o];if(gt(s,e))return s}return null},a.getComponents=function(e,r){r.length=0;for(var o=this._components,s=0,l=o.length;s<l;s++){var u=o[s];gt(u,e)&&r.push(u)}return r},a.getComponentsIncludeChildren=function(e,r){return r.length=0,this._getComponentsInChildren(e,r),r},a.addChild=function(e,r){var o;if(typeof e=="number"?o=e:(o=void 0,r=e),r._isRoot){r._scene._removeFromEntityList(r),r._isRoot=!1,this._addToChildrenList(o,r),r._parent=this;var s=r._scene,l=this._scene,u=_e.None;this._isActiveInHierarchy||r._isActiveInHierarchy&&(u|=_e.Hierarchy),r._isActiveInScene&&(this._isActiveInScene?s!==l&&(u|=_e.Scene):u|=_e.Scene),u&&r._processInActive(u),r._scene!==l&&i._traverseSetOwnerScene(r,l);var c=_e.None;r._isActive&&(this._isActiveInHierarchy&&!r._isActiveInHierarchy&&(c|=_e.Hierarchy),this._isActiveInScene&&(!r._isActiveInScene||s!==l)&&(c|=_e.Scene)),c&&r._processActive(c),r._setTransformDirty()}else r._setParent(this,o)},a.removeChild=function(e){e._setParent(null)},a.getChild=function(e){return this._children[e]},a.findByName=function(e){if(e===this.name)return this;for(var r=this._children,o=0,s=r.length;o<s;o++){var l=r[o].findByName(e);if(l)return l}return null},a.findByPath=function(e){for(var r=e.split("/"),o=this,s=0,l=r.length;s<l;++s){var u=r[s];if(u&&(o=i._findChildByName(o,u),!o))return null}return o},a.createChild=function(e){var r=new i(this.engine,e);return r.layer=this.layer,r.parent=this,r},a.clearChildren=function(){for(var e=this._children,r=e.length-1;r>=0;r--){var o=e[r];o._parent=null;var s=_e.None;o._isActiveInHierarchy&&(s|=_e.Hierarchy),o._isActiveInScene&&(s|=_e.Scene),s&&o._processInActive(s),i._traverseSetOwnerScene(o,null)}e.length=0},a.clone=function(){var e=this._createCloneEntity(this);return this._parseCloneEntity(this,e,this,e),e},a._createCloneEntity=function(e){var r=new i(e._engine,e.name),o=this,s=o._hookResource;s&&(r._hookResource=s,s._addReferCount(1)),r.layer=e.layer,r._isActive=e._isActive;var l=r.transform,u=e.transform;l.position=u.position,l.rotation=u.rotation,l.scale=u.scale;for(var c=e._children,d=0,_=e._children.length;d<_;d++)r.addChild(this._createCloneEntity(c[d]));return r},a._parseCloneEntity=function(e,r,o,s){for(var l=e._children,u=r._children,c=0,d=l.length;c<d;c++)this._parseCloneEntity(l[c],u[c],o,s);for(var _=e._components,f=0,v=_.length;f<v;f++){var p=_[f];if(!gt(p,ye)){var g=r.addComponent(p.constructor);y1.cloneComponent(p,g,o,s)}}},a.destroy=function(){if(!this._destroyed){n.prototype.destroy.call(this),this._hookResource&&(this._hookResource._addReferCount(-1),this._hookResource=null);for(var e=this._components,r=e.length-1;r>=0;r--)e[r].destroy();this._components.length=0;for(var o=this._children;o.length>0;)o[0].destroy();this._isRoot?this._scene.removeRootEntity(this):this._setParent(null),this.isActive=!1}},a._removeComponent=function(e){Fo._removeCheck(this,e.constructor);var r=this._components;r.splice(r.indexOf(e),1)},a._addScript=function(e){e._entityScriptsIndex=this._scripts.length,this._scripts.add(e)},a._removeScript=function(e){var r=this._scripts.deleteByIndex(e._entityScriptsIndex);r&&(r._entityScriptsIndex=e._entityScriptsIndex),e._entityScriptsIndex=-1},a._removeFromParent=function(){var e=this._parent;if(e!=null){var r=e._children,o=this._siblingIndex;r.splice(o,1);for(var s=r.length;o<s;o++)r[o]._siblingIndex--;this._parent=null,this._siblingIndex=-1}},a._processActive=function(e){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._scene._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents,e),this._setActiveComponents(!0,e)},a._processInActive=function(e){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._scene._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents,e),this._setActiveComponents(!1,e)},a._addToChildrenList=function(e,r){var o=this._children,s=o.length;if(e===void 0)r._siblingIndex=s,o.push(r);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;r._siblingIndex=e,o.splice(e,0,r);for(var l=e+1,u=s+1;l<u;l++)o[l]._siblingIndex++}},a._setParent=function(e,r){var o=this._parent;if(e!==o){if(this._removeFromParent(),this._parent=e,e){e._addToChildrenList(r,this);var s=this._scene,l=e._scene,u=_e.None;e._isActiveInHierarchy||this._isActiveInHierarchy&&(u|=_e.Hierarchy),e._isActiveInScene?this._isActiveInScene&&s!==l&&(u|=_e.Scene):this._isActiveInScene&&(u|=_e.Scene),u&&this._processInActive(u),s!==l&&i._traverseSetOwnerScene(this,l);var c=_e.None;this._isActive&&(e._isActiveInHierarchy&&!this._isActiveInHierarchy&&(c|=_e.Hierarchy),e._isActiveInScene&&(!this._isActiveInScene||s!==l)&&(c|=_e.Scene)),c&&this._processActive(c)}else{var d=_e.None;this._isActiveInHierarchy&&(d|=_e.Hierarchy),this._isActiveInScene&&(d|=_e.Scene),d&&this._processInActive(d),o&&i._traverseSetOwnerScene(this,null)}this._setTransformDirty()}},a._getComponentsInChildren=function(e,r){for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];gt(s,e)&&r.push(s)}for(var l=this._children.length-1;l>=0;l--)this._children[l]._getComponentsInChildren(e,r)},a._setActiveComponents=function(e,r){for(var o=this._activeChangedComponents,s=0,l=o.length;s<l;++s)o[s]._setActive(e,r);this._scene._componentsManager.putActiveChangedTempList(o),this._activeChangedComponents=null},a._setActiveInHierarchy=function(e,r){r&_e.Hierarchy&&(this._isActiveInHierarchy=!0),r&_e.Scene&&(this._isActiveInScene=!0);for(var o=this._components,s=o.length-1;s>=0;s--){var l=o[s];(l.enabled||!l._awoken)&&e.push(l)}for(var u=this._children,c=u.length-1;c>=0;c--){var d=u[c];d.isActive&&d._setActiveInHierarchy(e,r)}},a._setInActiveInHierarchy=function(e,r){r&_e.Hierarchy&&(this._isActiveInHierarchy=!1),r&_e.Scene&&(this._isActiveInScene=!1);for(var o=this._components,s=o.length-1;s>=0;s--){var l=o[s];l.enabled&&e.push(l)}for(var u=this._children,c=u.length-1;c>=0;c--){var d=u[c];d.isActive&&d._setInActiveInHierarchy(e,r)}},a._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,r=this._children.length;e<r;e++)this._children[e]._setTransformDirty()},a._setSiblingIndex=function(e,r){if(r=Math.min(r,e.length-1),r<0)throw"Sibling index "+r+" should large than 0";if(this._siblingIndex!==r){var o=this._siblingIndex;if(r<o)for(var s=o;s>=r;s--){var l=s==r?this:e[s-1];e[s]=l,l._siblingIndex=s}else for(var u=o;u<=r;u++){var c=u==r?this:e[u+1];e[u]=c,c._siblingIndex=u}}},a.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&($.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},i._findChildByName=function(e,r){for(var o=e._children,s=o.length-1;s>=0;s--){var l=o[s];if(l.name===r)return l}return null},i._traverseSetOwnerScene=function(e,r){e._scene=r;for(var o=e._children,s=o.length-1;s>=0;s--)this._traverseSetOwnerScene(o[s],r)},q(i,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var r=this._parent,o=_e.None;if(this._isRoot&&this._scene._isActiveInEngine)o|=_e.All;else{var s,l;(s=r)!=null&&s._isActiveInHierarchy&&(o|=_e.Hierarchy),(l=r)!=null&&l._isActiveInScene&&(o|=_e.Scene)}o&&this._processActive(o)}else{var u=_e.None;this._isActiveInHierarchy&&(u|=_e.Hierarchy),this._isActiveInScene&&(u|=_e.Scene),u&&this._processInActive(u)}}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this._setParent(e)}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(e){if(this._siblingIndex===-1)throw"The entity "+this.name+" is not in the hierarchy";this._setSiblingIndex(this._isRoot?this._scene._rootEntities:this._parent._children,e)}}]),i}(ti),Aa=function(){function n(a){this._elementPoolIndex=0,this._elementPool=[],this._type=a}var i=n.prototype;return i.getFromPool=function(){var t=this,e=t._elementPoolIndex,r=t._elementPool;if(this._elementPoolIndex++,r.length===e){var o=new this._type;return r.push(o),o}else return r[e]},i.resetPool=function(){this._elementPoolIndex=0},i.garbageCollection=function(){for(var t=this,e=t._elementPool,r=e.length-1;r>=0;r--)e[r].dispose&&e[r].dispose()},n}(),we;(function(n){n[n.Zero=0]="Zero",n[n.One=1]="One",n[n.SourceColor=2]="SourceColor",n[n.OneMinusSourceColor=3]="OneMinusSourceColor",n[n.DestinationColor=4]="DestinationColor",n[n.OneMinusDestinationColor=5]="OneMinusDestinationColor",n[n.SourceAlpha=6]="SourceAlpha",n[n.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",n[n.DestinationAlpha=8]="DestinationAlpha",n[n.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",n[n.SourceAlphaSaturate=10]="SourceAlphaSaturate",n[n.BlendColor=11]="BlendColor",n[n.OneMinusBlendColor=12]="OneMinusBlendColor"})(we||(we={}));var dn;(function(n){n[n.Add=0]="Add",n[n.Subtract=1]="Subtract",n[n.ReverseSubtract=2]="ReverseSubtract",n[n.Min=3]="Min",n[n.Max=4]="Max"})(dn||(dn={}));var ar;(function(n){n[n.None=0]="None",n[n.Red=1]="Red",n[n.Green=2]="Green",n[n.Blue=4]="Blue",n[n.Alpha=8]="Alpha",n[n.All=15]="All"})(ar||(ar={}));var Me;(function(n){n[n.Never=0]="Never",n[n.Less=1]="Less",n[n.Equal=2]="Equal",n[n.LessEqual=3]="LessEqual",n[n.Greater=4]="Greater",n[n.NotEqual=5]="NotEqual",n[n.GreaterEqual=6]="GreaterEqual",n[n.Always=7]="Always"})(Me||(Me={}));var Mn;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(Mn||(Mn={}));var ae;(function(n){n[n.BlendStateEnabled0=0]="BlendStateEnabled0",n[n.BlendStateColorBlendOperation0=1]="BlendStateColorBlendOperation0",n[n.BlendStateAlphaBlendOperation0=2]="BlendStateAlphaBlendOperation0",n[n.BlendStateSourceColorBlendFactor0=3]="BlendStateSourceColorBlendFactor0",n[n.BlendStateSourceAlphaBlendFactor0=4]="BlendStateSourceAlphaBlendFactor0",n[n.BlendStateDestinationColorBlendFactor0=5]="BlendStateDestinationColorBlendFactor0",n[n.BlendStateDestinationAlphaBlendFactor0=6]="BlendStateDestinationAlphaBlendFactor0",n[n.BlendStateColorWriteMask0=7]="BlendStateColorWriteMask0",n[n.BlendStateBlendColor=8]="BlendStateBlendColor",n[n.BlendStateAlphaToCoverage=9]="BlendStateAlphaToCoverage",n[n.DepthStateEnabled=10]="DepthStateEnabled",n[n.DepthStateWriteEnabled=11]="DepthStateWriteEnabled",n[n.DepthStateCompareFunction=12]="DepthStateCompareFunction",n[n.StencilStateEnabled=13]="StencilStateEnabled",n[n.StencilStateReferenceValue=14]="StencilStateReferenceValue",n[n.StencilStateMask=15]="StencilStateMask",n[n.StencilStateWriteMask=16]="StencilStateWriteMask",n[n.StencilStateCompareFunctionFront=17]="StencilStateCompareFunctionFront",n[n.StencilStateCompareFunctionBack=18]="StencilStateCompareFunctionBack",n[n.StencilStatePassOperationFront=19]="StencilStatePassOperationFront",n[n.StencilStatePassOperationBack=20]="StencilStatePassOperationBack",n[n.StencilStateFailOperationFront=21]="StencilStateFailOperationFront",n[n.StencilStateFailOperationBack=22]="StencilStateFailOperationBack",n[n.StencilStateZFailOperationFront=23]="StencilStateZFailOperationFront",n[n.StencilStateZFailOperationBack=24]="StencilStateZFailOperationBack",n[n.RasterStateCullMode=25]="RasterStateCullMode",n[n.RasterStateDepthBias=26]="RasterStateDepthBias",n[n.RasterStateSlopeScaledDepthBias=27]="RasterStateSlopeScaledDepthBias",n[n.RenderQueueType=28]="RenderQueueType"})(ae||(ae={}));var bt;(function(n){n[n.Opaque=0]="Opaque",n[n.AlphaTest=1]="AlphaTest",n[n.Transparent=2]="Transparent"})(bt||(bt={}));var ln;(function(n){n[n.Float=0]="Float",n[n.Int=1]="Int",n[n.Vector2=2]="Vector2",n[n.Vector3=3]="Vector3",n[n.Vector4=4]="Vector4",n[n.Matrix=5]="Matrix",n[n.Color=6]="Color",n[n.Texture=7]="Texture",n[n.FloatArray=8]="FloatArray",n[n.IntArray=9]="IntArray",n[n.TextureArray=10]="TextureArray"})(ln||(ln={}));var Ke;(function(n){n[n.Keep=0]="Keep",n[n.Zero=1]="Zero",n[n.Replace=2]="Replace",n[n.IncrementSaturate=3]="IncrementSaturate",n[n.DecrementSaturate=4]="DecrementSaturate",n[n.Invert=5]="Invert",n[n.IncrementWrap=6]="IncrementWrap",n[n.DecrementWrap=7]="DecrementWrap"})(Ke||(Ke={}));var oe=function(){function n(i,a,t,e){this.name=i,this._maskIndex=t,this._maskValue=e,this.value=a;var r=n._macroNameIdMap,o=r[i];r[i]===void 0&&(r[i]=o=n._macroNameCounter++),this._nameId=o}return n.getByName=function(a,t){var e=t?a+" "+t:a,r=n._macroMap[e];if(!r){var o=n._macroMaskMap,s=n._macroCounter,l=Math.floor(s/32),u=s%32;r=new n(a,t,l,1<<u),n._macroMap[e]=r,l==o.length&&(o.length++,o[l]=new Array(32)),o[l][u]=e,n._macroCounter++}return r},n._getNamesByMacros=function(a,t){var e=n._macroMaskMap,r=a._mask;t.length=0;for(var o=0,s=a._length;o<s;o++)for(var l=e[o],u=r[o],c=u<0?32:Math.floor(Math.log2(u))+1,d=0;d<c;d++)u&1<<d&&t.push(l[d])},n}();(function(){oe._macroMaskMap=[]})();(function(){oe._macroNameIdMap=Object.create(null)})();(function(){oe._macroNameCounter=0})();(function(){oe._macroCounter=0})();(function(){oe._macroMap=Object.create(null)})();var Dn=function(){function n(){this._mask=[],this._length=0}var i=n.prototype;return i.enable=function(t){var e=t._maskIndex,r=e+1,o=this._mask,s=this._length;if(s<r){for(o.length<r&&(o.length=r);s<e;s++)o[s]=0;o[e]=t._maskValue,this._length=r}else o[e]|=t._maskValue},i.disable=function(t){var e=t._maskIndex,r=this._mask,o=this._length-1;if(!(e>o)){var s=r[e]&~t._maskValue;e==o&&s===0?this._length--:r[e]=s}},i.unionCollection=function(t){var e=t._mask,r=t._length,o=this._mask,s=this._length;if(s<r){o.length<r&&(o.length=r);for(var l=0;l<s;l++)o[l]|=e[l];for(;l<r;l++)o[l]=e[l];this._length=r}else for(var u=0;u<r;u++)o[u]|=e[u]},i.complementaryCollection=function(t){for(var e=t._mask,r=this._mask,o=this._length-1,s=Math.min(t._length-1,o);s>=0;s--){var l=r[s]&~e[s];s==o&&l===0?(o--,this._length--):r[s]=l}},i.intersectionCollection=function(t){for(var e=t._mask,r=this._mask,o=this._length-1;o>=0;o--){var s=r[o]&e[o];s==0&&o==this._length-1?this._length--:r[o]=s}},i.isEnable=function(t){var e=t._maskIndex;return e>=this._length?!1:(this._mask[e]&t._maskValue)!==0},i.clear=function(){this._length=0},n.unionCollection=function(t,e,r){var o=r._mask,s,l,u,c;t._length<e._length?(s=t._length,l=e._length,u=t._mask,c=e._mask):(s=e._length,l=t._length,u=e._mask,c=t._mask);var d=0;for(o.length<l&&(o.length=l);d<s;d++)o[d]=u[d]|c[d];for(;d<l;d++)o[d]=c[d];r._length=l},n}(),hn;(function(n){n.DepthOnly="DepthOnly",n.ShadowCaster="ShadowCaster",n.Forward="Forward"})(hn||(hn={}));function l_(){return l_=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},l_.apply(this,arguments)}var A1=`#define GLSLIFY 1
uniform vec3 camera_Position;`,x1=`#define GLSLIFY 1
#define PI 3.14159265359
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define LOG2 1.442695
#define saturate( a ) clamp( a, 0.0, 1.0 )
float pow2(float x){return x*x;}vec4 RGBMToLinear(vec4 value,float maxRange){return vec4(value.rgb*value.a*maxRange,1.0);}vec4 gammaToLinear(vec4 srgbIn){return vec4(pow(srgbIn.rgb,vec3(2.2)),srgbIn.a);}vec4 linearToGamma(vec4 linearIn){return vec4(pow(linearIn.rgb,vec3(1.0/2.2)),linearIn.a);}uniform vec4 camera_DepthBufferParams;float remapDepthBufferLinear01(float z){return 1.0/(camera_DepthBufferParams.x*z+camera_DepthBufferParams.y);}
#ifdef GRAPHICS_API_WEBGL2
#define INVERSE_MAT(mat) inverse(mat)
#else
mat2 inverseMat(mat2 m){return mat2(m[1][1],-m[0][1],-m[1][0],m[0][0])/(m[0][0]*m[1][1]-m[0][1]*m[1][0]);}mat3 inverseMat(mat3 m){float a00=m[0][0],a01=m[0][1],a02=m[0][2];float a10=m[1][0],a11=m[1][1],a12=m[1][2];float a20=m[2][0],a21=m[2][1],a22=m[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}mat4 inverseMat(mat4 m){float a00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],a10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],a20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],a30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return mat4(a11*b11-a12*b10+a13*b09,a02*b10-a01*b11-a03*b09,a31*b05-a32*b04+a33*b03,a22*b04-a21*b05-a23*b03,a12*b08-a10*b11-a13*b07,a00*b11-a02*b08+a03*b07,a32*b02-a30*b05-a33*b01,a20*b05-a22*b02+a23*b01,a10*b10-a11*b08+a13*b06,a01*b08-a00*b10-a03*b06,a30*b04-a31*b02+a33*b00,a21*b02-a20*b04-a23*b00,a11*b07-a10*b09-a12*b06,a00*b09-a01*b07+a02*b06,a31*b01-a30*b03-a32*b00,a20*b03-a21*b01+a22*b00)/det;}
#define INVERSE_MAT(mat) inverseMat(mat)
#endif
`,S1=`#define GLSLIFY 1
attribute vec3 POSITION;
#ifdef RENDERER_HAS_UV
attribute vec2 TEXCOORD_0;
#endif
#ifdef RENDERER_HAS_UV1
attribute vec2 TEXCOORD_1;
#endif
#ifdef RENDERER_HAS_SKIN
attribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;
#ifdef RENDERER_USE_JOINT_TEXTURE
uniform sampler2D renderer_JointSampler;uniform float renderer_JointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/renderer_JointCount;float hf=0.5/renderer_JointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}
#else
uniform mat4 renderer_JointMatrix[RENDERER_JOINTS_NUM];
#endif
#endif
#ifdef RENDERER_ENABLE_VERTEXCOLOR
attribute vec4 COLOR_0;
#endif
#include <transform_declare>
#include <camera_declare>
uniform vec4 material_TilingOffset;
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
attribute vec3 NORMAL;
#endif
#ifdef RENDERER_HAS_TANGENT
attribute vec4 TANGENT;
#endif
#endif
`,C1=`#define GLSLIFY 1
uniform mat4 renderer_LocalMat;uniform mat4 renderer_ModelMat;uniform mat4 camera_ViewMat;uniform mat4 camera_ProjMat;uniform mat4 renderer_MVMat;uniform mat4 renderer_MVPMat;uniform mat4 renderer_NormalMat;`,E1=`#define GLSLIFY 1
#ifdef RENDERER_ENABLE_VERTEXCOLOR
varying vec4 v_color;
#endif
`,w1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
varying vec3 v_positionVS;uniform vec4 scene_FogColor;uniform vec4 scene_FogParams;float ComputeFogIntensity(float fogDepth){
#if SCENE_FOG_MODE == 1
return clamp(fogDepth*scene_FogParams.x+scene_FogParams.y,0.0,1.0);
#elif SCENE_FOG_MODE == 2
return clamp(exp2(-fogDepth*scene_FogParams.z),0.0,1.0);
#elif SCENE_FOG_MODE == 3
float factor=fogDepth*scene_FogParams.w;return clamp(exp2(-factor*factor),0.0,1.0);
#endif
}
#endif
`,T1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
varying vec3 v_positionVS;
#endif
`,R1=`#define GLSLIFY 1
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
varying vec3 v_normal;
#if defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
varying mat3 v_TBN;
#endif
#endif
#endif
`,M1=`#define GLSLIFY 1
varying vec2 v_uv;
#ifdef RENDERER_HAS_UV1
varying vec2 v_uv1;
#endif
`,P1=`#define GLSLIFY 1
#ifdef MATERIAL_NEED_WORLD_POS
varying vec3 v_pos;
#endif
`,B1=`#define GLSLIFY 1
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
vec3 normal=vec3(NORMAL);
#endif
#ifdef RENDERER_HAS_TANGENT
vec4 tangent=vec4(TANGENT);
#endif
#endif
`,b1=`#define GLSLIFY 1
vec4 position=vec4(POSITION,1.0);`,D1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_BLENDSHAPE
#ifdef RENDERER_BLENDSHAPE_USE_TEXTURE
uniform mediump sampler2DArray renderer_BlendShapeTexture;uniform ivec3 renderer_BlendShapeTextureInfo;uniform float renderer_BlendShapeWeights[RENDERER_BLENDSHAPE_COUNT];
#else
attribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) && defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;uniform float renderer_BlendShapeWeights[2];
#else
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) || defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;
#ifdef RENDERER_BLENDSHAPE_HAS_NORMAL
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;
#endif
#ifdef RENDERER_BLENDSHAPE_HAS_TANGENT
attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;
#endif
uniform float renderer_BlendShapeWeights[4];
#else
attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;attribute vec3 POSITION_BS4;attribute vec3 POSITION_BS5;attribute vec3 POSITION_BS6;attribute vec3 POSITION_BS7;uniform float renderer_BlendShapeWeights[8];
#endif
#endif
#endif
#ifdef RENDERER_BLENDSHAPE_USE_TEXTURE
vec3 getBlendShapeVertexElement(int blendShapeIndex,int vertexElementIndex){int y=vertexElementIndex/renderer_BlendShapeTextureInfo.y;int x=vertexElementIndex-y*renderer_BlendShapeTextureInfo.y;ivec3 uv=ivec3(x,y,blendShapeIndex);return texelFetch(renderer_BlendShapeTexture,uv,0).xyz;}
#endif
#endif
`,L1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_BLENDSHAPE
#ifdef RENDERER_BLENDSHAPE_USE_TEXTURE
int vertexOffset=gl_VertexID*renderer_BlendShapeTextureInfo.x;for(int i=0;i<RENDERER_BLENDSHAPE_COUNT;i++){int vertexElementOffset=vertexOffset;float weight=renderer_BlendShapeWeights[i];if(weight!=0.0){position.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#ifndef MATERIAL_OMIT_NORMAL
#if defined( RENDERER_HAS_NORMAL ) && defined( RENDERER_BLENDSHAPE_HAS_NORMAL )
vertexElementOffset+=1;normal+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#if defined( RENDERER_HAS_TANGENT ) && defined(RENDERER_BLENDSHAPE_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
vertexElementOffset+=1;tangent.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#endif
}}
#else
position.xyz+=POSITION_BS0*renderer_BlendShapeWeights[0];position.xyz+=POSITION_BS1*renderer_BlendShapeWeights[1];
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) && defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
normal+=NORMAL_BS0*renderer_BlendShapeWeights[0];normal+=NORMAL_BS1*renderer_BlendShapeWeights[1];
#endif
#if defined( RENDERER_HAS_TANGENT ) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
tangent.xyz+=TANGENT_BS0*renderer_BlendShapeWeights[0];tangent.xyz+=TANGENT_BS1*renderer_BlendShapeWeights[1];
#endif
#endif
#else
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) || defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
#ifndef MATERIAL_OMIT_NORMAL
position.xyz+=POSITION_BS2*renderer_BlendShapeWeights[2];position.xyz+=POSITION_BS3*renderer_BlendShapeWeights[3];
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) && defined( RENDERER_HAS_NORMAL )
normal+=NORMAL_BS0*renderer_BlendShapeWeights[0];normal+=NORMAL_BS1*renderer_BlendShapeWeights[1];normal+=NORMAL_BS2*renderer_BlendShapeWeights[2];normal+=NORMAL_BS3*renderer_BlendShapeWeights[3];
#endif
#if defined(RENDERER_BLENDSHAPE_HAS_TANGENT) && defined( RENDERER_HAS_TANGENT ) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
tangent.xyz+=TANGENT_BS0*renderer_BlendShapeWeights[0];tangent.xyz+=TANGENT_BS1*renderer_BlendShapeWeights[1];tangent.xyz+=TANGENT_BS2*renderer_BlendShapeWeights[2];tangent.xyz+=TANGENT_BS3*renderer_BlendShapeWeights[3];
#endif
#endif
#else
position.xyz+=POSITION_BS2*renderer_BlendShapeWeights[2];position.xyz+=POSITION_BS3*renderer_BlendShapeWeights[3];position.xyz+=POSITION_BS4*renderer_BlendShapeWeights[4];position.xyz+=POSITION_BS5*renderer_BlendShapeWeights[5];position.xyz+=POSITION_BS6*renderer_BlendShapeWeights[6];position.xyz+=POSITION_BS7*renderer_BlendShapeWeights[7];
#endif
#endif
#endif
#endif
`,I1=`#define GLSLIFY 1
#ifdef RENDERER_ENABLE_VERTEXCOLOR
v_color=COLOR_0;
#endif
`,V1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
vec4 positionVS=renderer_MVMat*position;v_positionVS=positionVS.xyz/positionVS.w;
#endif
`,N1=`#define GLSLIFY 1
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
v_normal=normalize(mat3(renderer_NormalMat)*normal);
#if defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
vec3 normalW=normalize(mat3(renderer_NormalMat)*normal.xyz);vec3 tangentW=normalize(mat3(renderer_NormalMat)*tangent.xyz);vec3 bitangentW=cross(normalW,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,normalW);
#endif
#endif
#endif
`,F1=`#define GLSLIFY 1
gl_Position=renderer_MVPMat*position;`,O1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_SKIN
#ifdef RENDERER_USE_JOINT_TEXTURE
mat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(renderer_JointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(renderer_JointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(renderer_JointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(renderer_JointSampler,JOINTS_0.w);
#else
mat4 skinMatrix=WEIGHTS_0.x*renderer_JointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*renderer_JointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*renderer_JointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*renderer_JointMatrix[int(JOINTS_0.w)];
#endif
position=skinMatrix*position;
#if defined(RENDERER_HAS_NORMAL) && !defined(MATERIAL_OMIT_NORMAL)
mat3 skinNormalMatrix=INVERSE_MAT(mat3(skinMatrix));normal=normal*skinNormalMatrix;
#if defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
tangent.xyz=tangent.xyz*skinNormalMatrix;
#endif
#endif
#endif
`,z1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_UV
v_uv=TEXCOORD_0;
#else
v_uv=vec2(0.,0.);
#endif
#ifdef RENDERER_HAS_UV1
v_uv1=TEXCOORD_1;
#endif
#ifdef MATERIAL_NEED_TILING_OFFSET
v_uv=v_uv*material_TilingOffset.xy+material_TilingOffset.zw;
#endif
`,U1=`#define GLSLIFY 1
#ifdef MATERIAL_NEED_WORLD_POS
vec4 temp_pos=renderer_ModelMat*position;v_pos=temp_pos.xyz/temp_pos.w;
#endif
`,k1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
float fogIntensity=ComputeFogIntensity(length(v_positionVS));gl_FragColor.rgb=mix(scene_FogColor.rgb,gl_FragColor.rgb,fogIntensity);
#endif
`,G1=`#define GLSLIFY 1
#ifdef SCENE_DIRECT_LIGHT_COUNT
struct DirectLight{vec3 color;vec3 direction;};uniform ivec2 scene_DirectLightCullingMask[SCENE_DIRECT_LIGHT_COUNT];uniform vec3 scene_DirectLightColor[SCENE_DIRECT_LIGHT_COUNT];uniform vec3 scene_DirectLightDirection[SCENE_DIRECT_LIGHT_COUNT];
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
struct PointLight{vec3 color;vec3 position;float distance;};uniform ivec2 scene_PointLightCullingMask[SCENE_POINT_LIGHT_COUNT];uniform vec3 scene_PointLightColor[SCENE_POINT_LIGHT_COUNT];uniform vec3 scene_PointLightPosition[SCENE_POINT_LIGHT_COUNT];uniform float scene_PointLightDistance[SCENE_POINT_LIGHT_COUNT];
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
struct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform ivec2 scene_SpotLightCullingMask[SCENE_SPOT_LIGHT_COUNT];uniform vec3 scene_SpotLightColor[SCENE_SPOT_LIGHT_COUNT];uniform vec3 scene_SpotLightPosition[SCENE_SPOT_LIGHT_COUNT];uniform vec3 scene_SpotLightDirection[SCENE_SPOT_LIGHT_COUNT];uniform float scene_SpotLightDistance[SCENE_SPOT_LIGHT_COUNT];uniform float scene_SpotLightAngleCos[SCENE_SPOT_LIGHT_COUNT];uniform float scene_SpotLightPenumbraCos[SCENE_SPOT_LIGHT_COUNT];
#endif
struct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;};uniform EnvMapLight scene_EnvMapLight;uniform ivec4 renderer_Layer;
#ifdef SCENE_USE_SH
uniform vec3 scene_EnvSH[9];
#endif
#ifdef SCENE_USE_SPECULAR_ENV
uniform samplerCube scene_EnvSpecularSampler;
#endif
#ifndef GRAPHICS_API_WEBGL2
bool isBitSet(float value,float mask,float bitIndex){return mod(floor(value/pow(2.0,bitIndex)),2.0)==1.0&&mod(floor(mask/pow(2.0,bitIndex)),2.0)==1.0;}
#endif
bool isRendererCulledByLight(ivec2 rendererLayer,ivec2 lightCullingMask){
#ifdef GRAPHICS_API_WEBGL2
return!((rendererLayer.x&lightCullingMask.x)!=0||(rendererLayer.y&lightCullingMask.y)!=0);
#else
for(int i=0;i<16;i++){if(isBitSet(float(rendererLayer.x),float(lightCullingMask.x),float(i))||isBitSet(float(rendererLayer.y),float(lightCullingMask.y),float(i))){return false;}}return true;
#endif
}`,H1=`#define GLSLIFY 1
uniform vec4 material_EmissiveColor;uniform vec4 material_BaseColor;uniform vec4 material_SpecularColor;uniform float material_Shininess;uniform float material_NormalIntensity;uniform float material_AlphaCutoff;
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
uniform sampler2D material_EmissiveTexture;
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
uniform sampler2D material_BaseTexture;
#endif
#ifdef MATERIAL_HAS_SPECULAR_TEXTURE
uniform sampler2D material_SpecularTexture;
#endif
#ifdef MATERIAL_HAS_NORMALTEXTURE
uniform sampler2D material_NormalTexture;
#endif
`,W1=`#define GLSLIFY 1
vec4 ambient=vec4(0.0);vec4 emission=material_EmissiveColor;vec4 diffuse=material_BaseColor;vec4 specular=material_SpecularColor;
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
vec4 emissiveTextureColor=texture2D(material_EmissiveTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
emissiveTextureColor=gammaToLinear(emissiveTextureColor);
#endif
emission*=emissiveTextureColor;
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 diffuseTextureColor=texture2D(material_BaseTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
diffuseTextureColor=gammaToLinear(diffuseTextureColor);
#endif
diffuse*=diffuseTextureColor;
#endif
#ifdef RENDERER_ENABLE_VERTEXCOLOR
diffuse*=v_color;
#endif
#ifdef MATERIAL_HAS_SPECULAR_TEXTURE
vec4 specularTextureColor=texture2D(material_SpecularTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
specularTextureColor=gammaToLinear(specularTextureColor);
#endif
specular*=specularTextureColor;
#endif
ambient=vec4(scene_EnvMapLight.diffuse*scene_EnvMapLight.diffuseIntensity,1.0)*diffuse;`,Q1=`#define GLSLIFY 1
#ifdef MATERIAL_NEED_WORLD_POS
vec3 V=normalize(camera_Position-v_pos);
#endif
`,X1=`#define GLSLIFY 1
#ifdef MATERIAL_HAS_NORMALTEXTURE
mat3 tbn=getTBN(gl_FrontFacing);vec3 N=getNormalByNormalTexture(tbn,material_NormalTexture,material_NormalIntensity,v_uv,gl_FrontFacing);
#else
vec3 N=getNormal(gl_FrontFacing);
#endif
vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);float shadowAttenuation=1.0;
#ifdef SCENE_DIRECT_LIGHT_COUNT
shadowAttenuation=1.0;
#ifdef SCENE_IS_CALCULATE_SHADOWS
shadowAttenuation*=sampleShadowMap();
#endif
DirectLight directionalLight;for(int i=0;i<SCENE_DIRECT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_DirectLightCullingMask[i])){directionalLight.color=scene_DirectLightColor[i];
#ifdef SCENE_IS_CALCULATE_SHADOWS
if(i==0){directionalLight.color*=shadowAttenuation;}
#endif
directionalLight.direction=scene_DirectLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),material_Shininess);lightSpecular+=directionalLight.color*s;}}
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<SCENE_POINT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_PointLightCullingMask[i])){pointLight.color=scene_PointLightColor[i];pointLight.position=scene_PointLightPosition[i];pointLight.distance=scene_PointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),material_Shininess)*decay;lightSpecular+=pointLight.color*s;}}
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<SCENE_SPOT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_SpotLightCullingMask[i])){spotLight.color=scene_SpotLightColor[i];spotLight.position=scene_SpotLightPosition[i];spotLight.direction=scene_SpotLightDirection[i];spotLight.distance=scene_SpotLightDistance[i];spotLight.angleCos=scene_SpotLightAngleCos[i];spotLight.penumbraCos=scene_SpotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),material_Shininess)*decayTotal;lightSpecular+=spotLight.color*s;}}
#endif
diffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);
#ifdef MATERIAL_IS_ALPHA_CUTOFF
if(diffuse.a<material_AlphaCutoff){discard;}
#endif
`,j1=`#define GLSLIFY 1
#include <noise_cellular_2D>
#include <noise_cellular_3D>
#include <noise_cellular_2x2>
#include <noise_cellular_2x2x2>
`,Y1=`#define GLSLIFY 1
vec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}`,q1=`#define GLSLIFY 1
vec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}`,J1=`#define GLSLIFY 1
vec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}`,Z1=`#define GLSLIFY 1
vec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}`,K1=`#define GLSLIFY 1
vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
#define K 0.142857142857
#define Ko 0.428571428571
#define K2 0.020408163265306
#define Kd2 0.0714285714285
#define Kz 0.166666666667
#define Kzo 0.416666666667
#define jitter 1.0
#define jitter1 0.8
`,$1=`#define GLSLIFY 1
#include <noise_perlin_2D>
#include <noise_perlin_3D>
#include <noise_perlin_4D>
`,ex=`#define GLSLIFY 1
float perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}`,tx=`#define GLSLIFY 1
float perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}`,nx=`#define GLSLIFY 1
float perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}`,rx=`#define GLSLIFY 1
vec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}`,ix=`#define GLSLIFY 1
#include <noise_simplex_2D>
#include <noise_simplex_3D>
#include <noise_simplex_3D_grad>
#include <noise_simplex_4D>
`,ax=`#define GLSLIFY 1
float simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}`,ox=`#define GLSLIFY 1
float simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`,sx=`#define GLSLIFY 1
float simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}`,lx=`#define GLSLIFY 1
vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}
#define F4 0.309016994374947451
float simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}`,ux=`#define GLSLIFY 1
uniform float material_AlphaCutoff;uniform vec4 material_BaseColor;uniform float material_Metal;uniform float material_Roughness;uniform float material_IOR;uniform vec3 material_PBRSpecularColor;uniform float material_Glossiness;uniform vec3 material_EmissiveColor;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
uniform float material_ClearCoat;uniform float material_ClearCoatRoughness;
#endif
uniform float material_NormalIntensity;uniform float material_OcclusionIntensity;uniform float material_OcclusionTextureCoord;
#ifdef MATERIAL_HAS_BASETEXTURE
uniform sampler2D material_BaseTexture;
#endif
#ifdef MATERIAL_HAS_NORMALTEXTURE
uniform sampler2D material_NormalTexture;
#endif
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
uniform sampler2D material_EmissiveTexture;
#endif
#ifdef MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE
uniform sampler2D material_RoughnessMetallicTexture;
#endif
#ifdef MATERIAL_HAS_SPECULAR_GLOSSINESS_TEXTURE
uniform sampler2D material_SpecularGlossinessTexture;
#endif
#ifdef MATERIAL_HAS_OCCLUSION_TEXTURE
uniform sampler2D material_OcclusionTexture;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_TEXTURE
uniform sampler2D material_ClearCoatTexture;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE
uniform sampler2D material_ClearCoatRoughnessTexture;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE
uniform sampler2D material_ClearCoatNormalTexture;
#endif
struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct Geometry{vec3 position;vec3 normal;vec3 viewDir;float dotNV;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
vec3 clearCoatNormal;float clearCoatDotNV;
#endif
};struct Material{vec3 diffuseColor;float roughness;vec3 specularColor;float opacity;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
float clearCoat;float clearCoatRoughness;
#endif
};`,cx=`#define GLSLIFY 1
#include <normal_get>
float computeSpecularOcclusion(float ambientOcclusion,float roughness,float dotNV){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}float getAARoughnessFactor(vec3 normal){
#ifdef HAS_DERIVATIVES
vec3 dxy=max(abs(dFdx(normal)),abs(dFdy(normal)));return 0.04+max(max(dxy.x,dxy.y),dxy.z);
#else
return 0.04;
#endif
}void initGeometry(out Geometry geometry,bool isFrontFacing){geometry.position=v_pos;geometry.viewDir=normalize(camera_Position-v_pos);
#if defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE)
mat3 tbn=getTBN(isFrontFacing);
#endif
#ifdef MATERIAL_HAS_NORMALTEXTURE
geometry.normal=getNormalByNormalTexture(tbn,material_NormalTexture,material_NormalIntensity,v_uv,isFrontFacing);
#else
geometry.normal=getNormal(isFrontFacing);
#endif
geometry.dotNV=saturate(dot(geometry.normal,geometry.viewDir));
#ifdef MATERIAL_ENABLE_CLEAR_COAT
#ifdef MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE
geometry.clearCoatNormal=getNormalByNormalTexture(tbn,material_ClearCoatNormalTexture,material_NormalIntensity,v_uv,isFrontFacing);
#else
geometry.clearCoatNormal=getNormal(isFrontFacing);
#endif
geometry.clearCoatDotNV=saturate(dot(geometry.clearCoatNormal,geometry.viewDir));
#endif
}void initMaterial(out Material material,const in Geometry geometry){vec4 baseColor=material_BaseColor;float metal=material_Metal;float roughness=material_Roughness;vec3 specularColor=material_PBRSpecularColor;float glossiness=material_Glossiness;float alphaCutoff=material_AlphaCutoff;float F0=pow2((material_IOR-1.0)/(material_IOR+1.0));
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 baseTextureColor=texture2D(material_BaseTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
baseTextureColor=gammaToLinear(baseTextureColor);
#endif
baseColor*=baseTextureColor;
#endif
#ifdef RENDERER_ENABLE_VERTEXCOLOR
baseColor*=v_color;
#endif
#ifdef MATERIAL_IS_ALPHA_CUTOFF
if(baseColor.a<alphaCutoff){discard;}
#endif
#ifdef MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE
vec4 metalRoughMapColor=texture2D(material_RoughnessMetallicTexture,v_uv);roughness*=metalRoughMapColor.g;metal*=metalRoughMapColor.b;
#endif
#ifdef MATERIAL_HAS_SPECULAR_GLOSSINESS_TEXTURE
vec4 specularGlossinessColor=texture2D(material_SpecularGlossinessTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
specularGlossinessColor=gammaToLinear(specularGlossinessColor);
#endif
specularColor*=specularGlossinessColor.rgb;glossiness*=specularGlossinessColor.a;
#endif
#ifdef IS_METALLIC_WORKFLOW
material.diffuseColor=baseColor.rgb*(1.0-metal);material.specularColor=mix(vec3(F0),baseColor.rgb,metal);material.roughness=roughness;
#else
float specularStrength=max(max(specularColor.r,specularColor.g),specularColor.b);material.diffuseColor=baseColor.rgb*(1.0-specularStrength);material.specularColor=specularColor;material.roughness=1.0-glossiness;
#endif
material.roughness=max(material.roughness,getAARoughnessFactor(geometry.normal));
#ifdef MATERIAL_ENABLE_CLEAR_COAT
material.clearCoat=material_ClearCoat;material.clearCoatRoughness=material_ClearCoatRoughness;
#ifdef MATERIAL_HAS_CLEAR_COAT_TEXTURE
material.clearCoat*=texture2D(material_ClearCoatTexture,v_uv).r;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE
material.clearCoatRoughness*=texture2D(material_ClearCoatRoughnessTexture,v_uv).g;
#endif
material.clearCoat=saturate(material.clearCoat);material.clearCoatRoughness=max(material.clearCoatRoughness,getAARoughnessFactor(geometry.clearCoatNormal));
#endif
#ifdef MATERIAL_IS_TRANSPARENT
material.opacity=baseColor.a;
#else
material.opacity=1.0;
#endif
}
#include <brdf>
#include <direct_irradiance_frag_define>
#include <ibl_frag_define>
`,dx=`#define GLSLIFY 1
float F_Schlick(float dotLH){return 0.04+0.96*(pow(1.0-dotLH,5.0));}vec3 F_Schlick(vec3 specularColor,float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(float alpha,float dotNL,float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(float alpha,float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(vec3 incidentDirection,vec3 viewDir,vec3 normal,vec3 specularColor,float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentDirection+viewDir);float dotNL=saturate(dot(normal,incidentDirection));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotLH=saturate(dot(incidentDirection,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}vec3 BRDF_Diffuse_Lambert(vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}`,_x=`#define GLSLIFY 1
#include <ShadowFragmentDeclaration>
void addDirectRadiance(vec3 incidentDirection,vec3 color,Geometry geometry,Material material,inout ReflectedLight reflectedLight){float attenuation=1.0;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
float clearCoatDotNL=saturate(dot(geometry.clearCoatNormal,incidentDirection));vec3 clearCoatIrradiance=clearCoatDotNL*color;reflectedLight.directSpecular+=material.clearCoat*clearCoatIrradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.clearCoatNormal,vec3(0.04),material.clearCoatRoughness);attenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
float dotNL=saturate(dot(geometry.normal,incidentDirection));vec3 irradiance=dotNL*color*PI;reflectedLight.directSpecular+=attenuation*irradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.normal,material.specularColor,material.roughness);reflectedLight.directDiffuse+=attenuation*irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}
#ifdef SCENE_DIRECT_LIGHT_COUNT
void addDirectionalDirectLightRadiance(DirectLight directionalLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 color=directionalLight.color;vec3 direction=-directionalLight.direction;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
void addPointDirectLightRadiance(PointLight pointLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=pointLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);vec3 color=pointLight.color;color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
void addSpotDirectLightRadiance(SpotLight spotLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=spotLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);vec3 color=spotLight.color;color*=spotEffect*decayEffect;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
void addTotalDirectRadiance(Geometry geometry,Material material,inout ReflectedLight reflectedLight){float shadowAttenuation=1.0;
#ifdef SCENE_DIRECT_LIGHT_COUNT
shadowAttenuation=1.0;
#ifdef SCENE_IS_CALCULATE_SHADOWS
shadowAttenuation*=sampleShadowMap();
#endif
DirectLight directionalLight;for(int i=0;i<SCENE_DIRECT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_DirectLightCullingMask[i])){directionalLight.color=scene_DirectLightColor[i];
#ifdef SCENE_IS_CALCULATE_SHADOWS
if(i==0){directionalLight.color*=shadowAttenuation;}
#endif
directionalLight.direction=scene_DirectLightDirection[i];addDirectionalDirectLightRadiance(directionalLight,geometry,material,reflectedLight);}}
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<SCENE_POINT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_PointLightCullingMask[i])){pointLight.color=scene_PointLightColor[i];pointLight.position=scene_PointLightPosition[i];pointLight.distance=scene_PointLightDistance[i];addPointDirectLightRadiance(pointLight,geometry,material,reflectedLight);}}
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<SCENE_SPOT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_SpotLightCullingMask[i])){spotLight.color=scene_SpotLightColor[i];spotLight.position=scene_SpotLightPosition[i];spotLight.direction=scene_SpotLightDirection[i];spotLight.distance=scene_SpotLightDistance[i];spotLight.angleCos=scene_SpotLightAngleCos[i];spotLight.penumbraCos=scene_SpotLightPenumbraCos[i];addSpotDirectLightRadiance(spotLight,geometry,material,reflectedLight);}}
#endif
}`,fx=`#define GLSLIFY 1
vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){normal.x=-normal.x;vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}vec3 envBRDFApprox(vec3 specularColor,float roughness,float dotNV){const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(float roughness,int maxMIPLevel){return roughness*float(maxMIPLevel);}vec3 getLightProbeRadiance(vec3 viewDir,vec3 normal,float roughness,int maxMIPLevel,float specularIntensity){
#ifndef SCENE_USE_SPECULAR_ENV
return vec3(0);
#else
vec3 reflectVec=reflect(-viewDir,normal);reflectVec.x=-reflectVec.x;float specularMIPLevel=getSpecularMIPLevel(roughness,maxMIPLevel);
#ifdef HAS_TEX_LOD
vec4 envMapColor=textureCubeLodEXT(scene_EnvSpecularSampler,reflectVec,specularMIPLevel);
#else
vec4 envMapColor=textureCube(scene_EnvSpecularSampler,reflectVec,specularMIPLevel);
#endif
#ifdef SCENE_IS_DECODE_ENV_RGBM
envMapColor.rgb=RGBMToLinear(envMapColor,5.0).rgb;
#ifdef ENGINE_IS_COLORSPACE_GAMMA
envMapColor=linearToGamma(envMapColor);
#endif
#else
#ifndef ENGINE_IS_COLORSPACE_GAMMA
envMapColor=gammaToLinear(envMapColor);
#endif
#endif
return envMapColor.rgb*specularIntensity;
#endif
}`,hx=`#define GLSLIFY 1
Geometry geometry;Material material;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));initGeometry(geometry,gl_FrontFacing);initMaterial(material,geometry);addTotalDirectRadiance(geometry,material,reflectedLight);
#ifdef SCENE_USE_SH
vec3 irradiance=getLightProbeIrradiance(scene_EnvSH,geometry.normal);
#ifdef ENGINE_IS_COLORSPACE_GAMMA
irradiance=linearToGamma(vec4(irradiance,1.0)).rgb;
#endif
irradiance*=scene_EnvMapLight.diffuseIntensity;
#else
vec3 irradiance=scene_EnvMapLight.diffuse*scene_EnvMapLight.diffuseIntensity;irradiance*=PI;
#endif
reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);vec3 radiance=getLightProbeRadiance(geometry.viewDir,geometry.normal,material.roughness,int(scene_EnvMapLight.mipMapLevel),scene_EnvMapLight.specularIntensity);float radianceAttenuation=1.0;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
vec3 clearCoatRadiance=getLightProbeRadiance(geometry.viewDir,geometry.clearCoatNormal,material.clearCoatRoughness,int(scene_EnvMapLight.mipMapLevel),scene_EnvMapLight.specularIntensity);reflectedLight.indirectSpecular+=clearCoatRadiance*material.clearCoat*envBRDFApprox(vec3(0.04),material.clearCoatRoughness,geometry.clearCoatDotNV);radianceAttenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
reflectedLight.indirectSpecular+=radianceAttenuation*radiance*envBRDFApprox(material.specularColor,material.roughness,geometry.dotNV);
#ifdef MATERIAL_HAS_OCCLUSION_TEXTURE
vec2 aoUV=v_uv;
#ifdef RENDERER_HAS_UV1
if(material_OcclusionTextureCoord==1.0){aoUV=v_uv1;}
#endif
float ambientOcclusion=(texture2D(material_OcclusionTexture,aoUV).r-1.0)*material_OcclusionIntensity+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;
#ifdef SCENE_USE_SPECULAR_ENV
reflectedLight.indirectSpecular*=computeSpecularOcclusion(ambientOcclusion,material.roughness,geometry.dotNV);
#endif
#endif
vec3 emissiveRadiance=material_EmissiveColor;
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
vec4 emissiveColor=texture2D(material_EmissiveTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
emissiveColor=gammaToLinear(emissiveColor);
#endif
emissiveRadiance*=emissiveColor.rgb;
#endif
vec3 totalRadiance=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+emissiveRadiance;vec4 targetColor=vec4(totalRadiance,material.opacity);gl_FragColor=targetColor;`,vx={pbr_frag_define:ux,pbr_helper:cx,brdf:dx,direct_irradiance_frag_define:_x,ibl_frag_define:fx,pbr_frag:hx},px=`#define GLSLIFY 1
uniform mat4 scene_ShadowMatrices[SCENE_SHADOW_CASCADED_COUNT+1];uniform vec4 scene_ShadowSplitSpheres[4];mediump int computeCascadeIndex(vec3 positionWS){vec3 fromCenter0=positionWS-scene_ShadowSplitSpheres[0].xyz;vec3 fromCenter1=positionWS-scene_ShadowSplitSpheres[1].xyz;vec3 fromCenter2=positionWS-scene_ShadowSplitSpheres[2].xyz;vec3 fromCenter3=positionWS-scene_ShadowSplitSpheres[3].xyz;mediump vec4 comparison=vec4(dot(fromCenter0,fromCenter0)<scene_ShadowSplitSpheres[0].w,dot(fromCenter1,fromCenter1)<scene_ShadowSplitSpheres[1].w,dot(fromCenter2,fromCenter2)<scene_ShadowSplitSpheres[2].w,dot(fromCenter3,fromCenter3)<scene_ShadowSplitSpheres[3].w);comparison.yzw=clamp(comparison.yzw-comparison.xyz,0.0,1.0);mediump vec4 indexCoefficient=vec4(4.0,3.0,2.0,1.0);mediump int index=4-int(dot(comparison,indexCoefficient));return index;}vec3 getShadowCoord(){
#if SCENE_SHADOW_CASCADED_COUNT == 1
mediump int cascadeIndex=0;
#else
mediump int cascadeIndex=computeCascadeIndex(v_pos);
#endif
#ifdef GRAPHICS_API_WEBGL2
mat4 shadowMatrix=scene_ShadowMatrices[cascadeIndex];
#else
mat4 shadowMatrix;
#if SCENE_SHADOW_CASCADED_COUNT == 4
if(cascadeIndex==0){shadowMatrix=scene_ShadowMatrices[0];}else if(cascadeIndex==1){shadowMatrix=scene_ShadowMatrices[1];}else if(cascadeIndex==2){shadowMatrix=scene_ShadowMatrices[2];}else if(cascadeIndex==3){shadowMatrix=scene_ShadowMatrices[3];}else{shadowMatrix=scene_ShadowMatrices[4];}
#endif
#if SCENE_SHADOW_CASCADED_COUNT == 2
if(cascadeIndex==0){shadowMatrix=scene_ShadowMatrices[0];}else if(cascadeIndex==1){shadowMatrix=scene_ShadowMatrices[1];}else{shadowMatrix=scene_ShadowMatrices[2];}
#endif
#if SCENE_SHADOW_CASCADED_COUNT == 1
if(cascadeIndex==0){shadowMatrix=scene_ShadowMatrices[0];}else{shadowMatrix=scene_ShadowMatrices[1];}
#endif
#endif
vec4 shadowCoord=shadowMatrix*vec4(v_pos,1.0);return shadowCoord.xyz;}`,gx=`#define GLSLIFY 1
#if defined(SCENE_SHADOW_TYPE) && defined(RENDERER_IS_RECEIVE_SHADOWS)
#define SCENE_IS_CALCULATE_SHADOWS
#endif
#ifdef SCENE_IS_CALCULATE_SHADOWS
#if SCENE_SHADOW_CASCADED_COUNT == 1
varying vec3 v_shadowCoord;
#else
#include <ShadowCoord>
#endif
uniform vec3 scene_ShadowInfo;uniform vec4 scene_ShadowMapSize;
#ifdef GRAPHICS_API_WEBGL2
uniform mediump sampler2DShadow scene_ShadowMap;
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName, coord3 , 0.0)
#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2DShadow shadowMap
#else
uniform sampler2D scene_ShadowMap;
#ifdef ENGINE_NO_DEPTH_TEXTURE
const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (unpack(texture2D(textureName, coord3.xy)) < coord3.z ? 0.0 : 1.0)
#else
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName, coord3.xy).r < coord3.z ? 0.0 : 1.0)
#endif
#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2D shadowMap
#endif
#if SCENE_SHADOW_TYPE == 2
float sampleShadowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowMapSize){float attenuation;vec4 attenuation4;vec2 offset=shadowMapSize.xy/2.0;vec3 shadowCoord0=shadowCoord+vec3(-offset,0.0);vec3 shadowCoord1=shadowCoord+vec3(offset.x,-offset.y,0.0);vec3 shadowCoord2=shadowCoord+vec3(-offset.x,offset.y,0.0);vec3 shadowCoord3=shadowCoord+vec3(offset,0.0);attenuation4.x=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord0);attenuation4.y=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord1);attenuation4.z=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord2);attenuation4.w=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord3);attenuation=dot(attenuation4,vec4(0.25));return attenuation;}
#endif
#if SCENE_SHADOW_TYPE == 3
#include <shadow_sample_tent>
float sampleShadowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowmapSize){float attenuation;float fetchesWeights[9];vec2 fetchesUV[9];sampleShadowComputeSamplesTent5x5(shadowmapSize,shadowCoord.xy,fetchesWeights,fetchesUV);attenuation=fetchesWeights[0]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[0].xy,shadowCoord.z));attenuation+=fetchesWeights[1]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[1].xy,shadowCoord.z));attenuation+=fetchesWeights[2]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[2].xy,shadowCoord.z));attenuation+=fetchesWeights[3]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[3].xy,shadowCoord.z));attenuation+=fetchesWeights[4]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[4].xy,shadowCoord.z));attenuation+=fetchesWeights[5]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[5].xy,shadowCoord.z));attenuation+=fetchesWeights[6]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[6].xy,shadowCoord.z));attenuation+=fetchesWeights[7]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[7].xy,shadowCoord.z));attenuation+=fetchesWeights[8]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[8].xy,shadowCoord.z));return attenuation;}
#endif
float sampleShadowMap(){
#if SCENE_SHADOW_CASCADED_COUNT == 1
vec3 shadowCoord=v_shadowCoord;
#else
vec3 shadowCoord=getShadowCoord();
#endif
float attenuation=1.0;if(shadowCoord.z>0.0&&shadowCoord.z<1.0){
#if SCENE_SHADOW_TYPE == 1
attenuation=SAMPLE_TEXTURE2D_SHADOW(scene_ShadowMap,shadowCoord);
#endif
#if SCENE_SHADOW_TYPE == 2
attenuation=sampleShadowMapFiltered4(scene_ShadowMap,shadowCoord,scene_ShadowMapSize);
#endif
#if SCENE_SHADOW_TYPE == 3
attenuation=sampleShadowMapFiltered9(scene_ShadowMap,shadowCoord,scene_ShadowMapSize);
#endif
attenuation=mix(1.0,attenuation,scene_ShadowInfo.x);}return attenuation;}
#endif
`,mx=`#define GLSLIFY 1
float sampleShadowGetIRTriangleTexelArea(float triangleHeight){return triangleHeight-0.5;}void sampleShadowGetTexelAreasTent3x3(float offset,out vec4 computedArea,out vec4 computedAreaUncut){float a=offset+0.5;float offsetSquaredHalved=a*a*0.5;computedAreaUncut.x=computedArea.x=offsetSquaredHalved-offset;computedAreaUncut.w=computedArea.w=offsetSquaredHalved;computedAreaUncut.y=sampleShadowGetIRTriangleTexelArea(1.5-offset);float clampedOffsetLeft=min(offset,0.0);float areaOfSmallLeftTriangle=clampedOffsetLeft*clampedOffsetLeft;computedArea.y=computedAreaUncut.y-areaOfSmallLeftTriangle;computedAreaUncut.z=sampleShadowGetIRTriangleTexelArea(1.5+offset);float clampedOffsetRight=max(offset,0.0);float areaOfSmallRightTriangle=clampedOffsetRight*clampedOffsetRight;computedArea.z=computedAreaUncut.z-areaOfSmallRightTriangle;}void sampleShadowGetTexelWeightsTent5x5(float offset,out vec3 texelsWeightsA,out vec3 texelsWeightsB){vec4 areaFrom3texelTriangle;vec4 areaUncutFrom3texelTriangle;sampleShadowGetTexelAreasTent3x3(offset,areaFrom3texelTriangle,areaUncutFrom3texelTriangle);texelsWeightsA.x=0.16*(areaFrom3texelTriangle.x);texelsWeightsA.y=0.16*(areaUncutFrom3texelTriangle.y);texelsWeightsA.z=0.16*(areaFrom3texelTriangle.y+1.0);texelsWeightsB.x=0.16*(areaFrom3texelTriangle.z+1.0);texelsWeightsB.y=0.16*(areaUncutFrom3texelTriangle.z);texelsWeightsB.z=0.16*(areaFrom3texelTriangle.w);}void sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize,vec2 coord,out float fetchesWeights[9],out vec2 fetchesUV[9]){vec2 tentCenterInTexelSpace=coord.xy*shadowMapTextureTexelSize.zw;vec2 centerOfFetchesInTexelSpace=floor(tentCenterInTexelSpace+0.5);vec2 offsetFromTentCenterToCenterOfFetches=tentCenterInTexelSpace-centerOfFetchesInTexelSpace;vec3 texelsWeightsUA,texelsWeightsUB;vec3 texelsWeightsVA,texelsWeightsVB;sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x,texelsWeightsUA,texelsWeightsUB);sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y,texelsWeightsVA,texelsWeightsVB);vec3 fetchesWeightsU=vec3(texelsWeightsUA.xz,texelsWeightsUB.y)+vec3(texelsWeightsUA.y,texelsWeightsUB.xz);vec3 fetchesWeightsV=vec3(texelsWeightsVA.xz,texelsWeightsVB.y)+vec3(texelsWeightsVA.y,texelsWeightsVB.xz);vec3 fetchesOffsetsU=vec3(texelsWeightsUA.y,texelsWeightsUB.xz)/fetchesWeightsU.xyz+vec3(-2.5,-0.5,1.5);vec3 fetchesOffsetsV=vec3(texelsWeightsVA.y,texelsWeightsVB.xz)/fetchesWeightsV.xyz+vec3(-2.5,-0.5,1.5);fetchesOffsetsU*=shadowMapTextureTexelSize.xxx;fetchesOffsetsV*=shadowMapTextureTexelSize.yyy;vec2 bilinearFetchOrigin=centerOfFetchesInTexelSpace*shadowMapTextureTexelSize.xy;fetchesUV[0]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.x);fetchesUV[1]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.x);fetchesUV[2]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.x);fetchesUV[3]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.y);fetchesUV[4]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.y);fetchesUV[5]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.y);fetchesUV[6]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.z);fetchesUV[7]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.z);fetchesUV[8]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.z);fetchesWeights[0]=fetchesWeightsU.x*fetchesWeightsV.x;fetchesWeights[1]=fetchesWeightsU.y*fetchesWeightsV.x;fetchesWeights[2]=fetchesWeightsU.z*fetchesWeightsV.x;fetchesWeights[3]=fetchesWeightsU.x*fetchesWeightsV.y;fetchesWeights[4]=fetchesWeightsU.y*fetchesWeightsV.y;fetchesWeights[5]=fetchesWeightsU.z*fetchesWeightsV.y;fetchesWeights[6]=fetchesWeightsU.x*fetchesWeightsV.z;fetchesWeights[7]=fetchesWeightsU.y*fetchesWeightsV.z;fetchesWeights[8]=fetchesWeightsU.z*fetchesWeightsV.z;}`,yx=`#define GLSLIFY 1
#if defined(SCENE_SHADOW_TYPE) && defined(RENDERER_IS_RECEIVE_SHADOWS)
#define SCENE_IS_CALCULATE_SHADOWS
#endif
#ifdef SCENE_IS_CALCULATE_SHADOWS
#if SCENE_SHADOW_CASCADED_COUNT==1
#include <ShadowCoord>
varying vec3 v_shadowCoord;
#endif
#endif
`,Ax=`#define GLSLIFY 1
#ifdef SCENE_IS_CALCULATE_SHADOWS
#if SCENE_SHADOW_CASCADED_COUNT == 1
v_shadowCoord=getShadowCoord();
#endif
#endif
`,xx={ShadowCoord:px,ShadowFragmentDeclaration:gx,shadow_sample_tent:mx,ShadowVertexDeclaration:yx,ShadowVertex:Ax},Sx=`#define GLSLIFY 1
vec3 rotationByEuler(in vec3 vector,in vec3 rot){float halfRoll=rot.z*0.5;float halfPitch=rot.x*0.5;float halfYaw=rot.y*0.5;float sinRoll=sin(halfRoll);float cosRoll=cos(halfRoll);float sinPitch=sin(halfPitch);float cosPitch=cos(halfPitch);float sinYaw=sin(halfYaw);float cosYaw=cos(halfYaw);float quaX=(cosYaw*sinPitch*cosRoll)+(sinYaw*cosPitch*sinRoll);float quaY=(sinYaw*cosPitch*cosRoll)-(cosYaw*sinPitch*sinRoll);float quaZ=(cosYaw*cosPitch*sinRoll)-(sinYaw*sinPitch*cosRoll);float quaW=(cosYaw*cosPitch*cosRoll)+(sinYaw*sinPitch*sinRoll);float x=quaX+quaX;float y=quaY+quaY;float z=quaZ+quaZ;float wx=quaW*x;float wy=quaW*y;float wz=quaW*z;float xx=quaX*x;float xy=quaX*y;float xz=quaX*z;float yy=quaY*y;float yz=quaY*z;float zz=quaZ*z;return vec3(((vector.x*((1.0-yy)-zz))+(vector.y*(xy-wz)))+(vector.z*(xz+wy)),((vector.x*(xy+wz))+(vector.y*((1.0-xx)-zz)))+(vector.z*(yz-wx)),((vector.x*(xz-wy))+(vector.y*(yz+wx)))+(vector.z*((1.0-xx)-yy)));}vec3 rotationByAxis(in vec3 vector,in vec3 axis,in float angle){float halfAngle=angle*0.5;float sin=sin(halfAngle);float quaX=axis.x*sin;float quaY=axis.y*sin;float quaZ=axis.z*sin;float quaW=cos(halfAngle);float x=quaX+quaX;float y=quaY+quaY;float z=quaZ+quaZ;float wx=quaW*x;float wy=quaW*y;float wz=quaW*z;float xx=quaX*x;float xy=quaX*y;float xz=quaX*z;float yy=quaY*y;float yz=quaY*z;float zz=quaZ*z;return vec3(((vector.x*((1.0-yy)-zz))+(vector.y*(xy-wz)))+(vector.z*(xz+wy)),((vector.x*(xy+wz))+(vector.y*((1.0-xx)-zz)))+(vector.z*(yz-wx)),((vector.x*(xz-wy))+(vector.y*(yz+wx)))+(vector.z*((1.0-xx)-yy)));}vec3 rotationByQuaternions(in vec3 v,in vec4 q){return v+2.0*cross(q.xyz,cross(q.xyz,v)+q.w*v);}float evaluateParticleCurve(in vec2 keys[4],in float normalizedAge){float value;for(int i=1;i<4;i++){vec2 key=keys[i];float time=key.x;if(time>=normalizedAge){vec2 lastKey=keys[i-1];float lastTime=lastKey.x;float age=(normalizedAge-lastTime)/(time-lastTime);value=mix(lastKey.y,key.y,age);break;}}return value;}float evaluateParticleCurveCumulative(in vec2 keys[4],in float normalizedAge){float cumulativeValue=0.0;for(int i=1;i<4;i++){vec2 key=keys[i];float time=key.x;vec2 lastKey=keys[i-1];float lastValue=lastKey.y;if(time>=normalizedAge){float lastTime=lastKey.x;float offsetTime=normalizedAge-lastTime;float age=offsetTime/(time-lastTime);cumulativeValue+=(lastValue+mix(lastValue,key.y,age))*0.5*offsetTime;break;}else{cumulativeValue+=(lastValue+key.y)*0.5*(time-lastKey.x);}}return cumulativeValue;}`,Cx=`#define GLSLIFY 1
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
uniform int renderer_VOLSpace;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_RANDOM_CONSTANT)
uniform vec3 renderer_VOLMaxConst;
#ifdef RENDERER_VOL_RANDOM_CONSTANT
uniform vec3 renderer_VOLMinConst;
#endif
#endif
#if defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CURVE)
uniform vec2 renderer_VOLMaxGradientX[4];uniform vec2 renderer_VOLMaxGradientY[4];uniform vec2 renderer_VOLMaxGradientZ[4];
#ifdef RENDERER_VOL_RANDOM_CURVE
uniform vec2 renderer_VOLMinGradientX[4];uniform vec2 renderer_VOLMinGradientY[4];uniform vec2 renderer_VOLMinGradientZ[4];
#endif
#endif
#endif
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
vec3 computeParticleLifeVelocity(in float normalizedAge){vec3 velocity;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_RANDOM_CONSTANT)
velocity=renderer_VOLMaxConst;
#ifdef RENDERER_VOL_RANDOM_CONSTANT
velocity=mix(renderer_VOLMinConst,velocity,vec3(a_Random1.y,a_Random1.z,a_Random1.w));
#endif
#endif
#if defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CURVE)
velocity=vec3(evaluateParticleCurve(renderer_VOLMaxGradientX,normalizedAge),evaluateParticleCurve(renderer_VOLMaxGradientY,normalizedAge),evaluateParticleCurve(renderer_VOLMaxGradientZ,normalizedAge));
#endif
#ifdef RENDERER_VOL_RANDOM_CURVE
velocity=vec3(mix(velocity.x,evaluateParticleCurve(renderer_VOLMinGradientX,normalizedAge),a_Random1.y),mix(velocity.y,evaluateParticleCurve(renderer_VOLMinGradientY,normalizedAge),a_Random1.z),mix(velocity.z,evaluateParticleCurve(renderer_VOLMinGradientZ,normalizedAge),a_Random1.w));
#endif
return velocity;}
#endif
vec3 getStartPosition(vec3 startVelocity,float age,vec3 dragData){vec3 startPosition;float lastTime=min(startVelocity.x/dragData.x,age);startPosition=lastTime*(startVelocity-0.5*dragData*lastTime);return startPosition;}vec3 computeParticlePosition(in vec3 startVelocity,in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation,vec3 dragData){vec3 startPosition=getStartPosition(startVelocity,age,dragData);vec3 lifePosition;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
#if defined(RENDERER_VOL_CONSTANT)|| defined(RENDERER_VOL_RANDOM_CONSTANT)
lifePosition=lifeVelocity*age;
#endif
#if defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CURVE)
lifePosition=vec3(evaluateParticleCurveCumulative(renderer_VOLMaxGradientX,normalizedAge)evaluateParticleCurveCumulative(renderer_VOLMaxGradientY,normalizedAge),evaluateParticleCurveCumulative(renderer_VOLMaxGradientZ,normalizedAge));
#ifdef RENDERER_VOL_RANDOM_CURVE
lifePosition=vec3(mix(evaluateParticleCurveCumulative(renderer_VOLMinGradientX,normalizedAge),lifePosition.x,a_Random1.y),mix(evaluateParticleCurveCumulative(renderer_VOLMinGradientY,normalizedAge),lifePosition.y,a_Random1.z),mix(evaluateParticleCurveCumulative(renderer_VOLMinGradientZ,normalizedAge),lifePosition.z,a_Random1.w));
#endif
lifePosition*=vec3(a_ShapePositionStartLifeTime.w);
#endif
vec3 finalPosition;if(renderer_VOLSpace==0){finalPosition=rotationByQuaternions(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);}else{finalPosition=rotationByQuaternions(a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;}
#else
vec3 finalPosition=rotationByQuaternions(a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);
#endif
if(renderer_SimulationSpace==0){finalPosition=finalPosition+renderer_WorldPosition;}else if(renderer_SimulationSpace==1){finalPosition=finalPosition+a_SimulationWorldPosition;}finalPosition+=0.5*gravityVelocity*age;return finalPosition;}`,Ex=`#define GLSLIFY 1
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
#ifdef RENDERER_ROL_CURVE_MODE
uniform vec2 renderer_ROLMaxCurveZ[4];
#ifdef RENDERER_ROL_IS_RANDOM_TWO
uniform vec2 renderer_ROLMinCurveZ[4];
#endif
#else
uniform vec3 renderer_ROLMaxConst;
#ifdef RENDERER_ROL_IS_RANDOM_TWO
uniform vec3 renderer_ROLMinConst;
#endif
#endif
#endif
float computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge){
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
#ifdef RENDERER_ROL_CURVE_MODE
float lifeRotation=evaluateParticleCurveCumulative(renderer_ROLMaxCurveZ,normalizedAge);
#ifdef RENDERER_ROL_IS_RANDOM_TWO
lifeRotation=mix(evaluateParticleCurveCumulative(renderer_ROLMinCurveZ,normalizedAge),lifeRotation,a_Random0.w);
#endif
rotation+=lifeRotation*a_ShapePositionStartLifeTime.w;
#else
float lifeRotation=renderer_ROLMaxConst.z;
#ifdef RENDERER_ROL_IS_RANDOM_TWO
lifeRotation=mix(renderer_ROLMinConst.z,lifeRotation,a_Random0.w);
#endif
rotation+=lifeRotation*age;
#endif
#endif
return rotation;}
#if defined(RENDERER_MODE_MESH) && (defined(ROTATION_OVER_LIFETIME) || defined(ROTATION_OVER_LIFETIME_SEPARATE))
vec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge){
#ifdef ROTATION_OVER_LIFETIME
#ifdef ROTATION_OVER_LIFETIME_CONSTANT
float ageRot=u_ROLAngularVelocityConst*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_CURVE
rotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CONSTANTS
float ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CURVES
rotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);
#endif
#endif
#ifdef ROTATION_OVER_LIFETIME_SEPARATE
#ifdef ROTATION_OVER_LIFETIME_CONSTANT
vec3 ageRot=u_ROLAngularVelocityConstSeparate*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_CURVE
rotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CONSTANTS
vec3 ageRot=mix(u_ROLAngularVelocityConstSeparate,renderer_ROLMaxConst,a_Random0.w)*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CURVES
rotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(renderer_ROLMaxCurveX,normalizedAge),a_Random0.w),mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(renderer_ROLMaxCurveY,normalizedAge),a_Random0.w),mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(renderer_ROLMaxCurveZ,normalizedAge),a_Random0.w));
#endif
#endif
return rotation;}
#endif
`,wx=`#define GLSLIFY 1
#ifdef RENDERER_SOL_CURVE_MODE
uniform vec2 renderer_SOLMaxCurveX[4];
#ifdef RENDERER_SOL_IS_SEPARATE
uniform vec2 renderer_SOLMaxCurveY[4];uniform vec2 renderer_SOLMaxCurveZ[4];
#endif
#ifdef RENDERER_SOL_IS_RANDOM_TWO
uniform vec2 renderer_SOLMinCurveX[4];
#ifdef RENDERER_SOL_IS_SEPARATE
uniform vec2 renderer_SOLMinCurveY[4];uniform vec2 renderer_SOLMinCurveZ[4];
#endif
#endif
#endif
vec2 computeParticleSizeBillboard(in vec2 size,in float normalizedAge){
#ifdef RENDERER_SOL_CURVE_MODE
float lifeSizeX=evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge);
#ifdef RENDERER_SOL_IS_RANDOM_TWO
lifeSizeX=mix(evaluateParticleCurve(renderer_SOLMinCurveX,normalizedAge),lifeSizeX,a_Random0.z);
#endif
#ifdef RENDERER_SOL_IS_SEPARATE
float lifeSizeY=evaluateParticleCurve(renderer_SOLMaxCurveY,normalizedAge);
#ifdef RENDERER_SOL_IS_RANDOM_TWO
lifeSizeY=mix(evaluateParticleCurve(renderer_SOLMinCurveY,normalizedAge),lifeSizeY,a_Random0.z);
#endif
size*=vec2(lifeSizeX,lifeSizeY);
#else
size*=lifeSizeX;
#endif
#endif
return size;}
#ifdef RENDERER_MODE_MESH
vec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge){
#ifdef RENDERER_SOL_CURVE
size*=evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge);
#endif
#ifdef RENDERER_SOL_RANDOM_CURVES
size*=mix(evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge),evaluateParticleCurve(u_SOLSizeGradientMax,normalizedAge),a_Random0.z);
#endif
#ifdef RENDERER_SOL_CURVE_SEPARATE
size*=vec3(evaluateParticleCurve(renderer_SOLMinCurveX,normalizedAge),evaluateParticleCurve(renderer_SOLMinCurveY,normalizedAge),evaluateParticleCurve(renderer_SOLMinCurveZ,normalizedAge));
#endif
#ifdef RENDERER_SOL_RANDOM_CURVES_SEPARATE
size*=vec3(mix(evaluateParticleCurve(renderer_SOLMinCurveX,normalizedAge),evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge),a_Random0.z),mix(evaluateParticleCurve(renderer_SOLMinCurveY,normalizedAge),evaluateParticleCurve(renderer_SOLMaxCurveY,normalizedAge),a_Random0.z),mix(evaluateParticleCurve(renderer_SOLMinCurveZ,normalizedAge),evaluateParticleCurve(renderer_SOLMaxCurveZ,normalizedAge),a_Random0.z));
#endif
return size;}
#endif
`,Tx=`#define GLSLIFY 1
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
uniform vec4 renderer_COLMaxGradientColor[4];uniform vec2 renderer_COLMaxGradientAlpha[4];
#ifdef RENDERER_COL_RANDOM_GRADIENTS
uniform vec4 renderer_COLMinGradientColor[4];uniform vec2 renderer_COLMinGradientAlpha[4];
#endif
uniform vec4 renderer_COLGradientKeysMaxTime;
#endif
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
vec4 evaluateParticleGradient(in vec4 colorKeys[4],in float colorKeysMaxTime,in vec2 alphaKeys[4],in float alphaKeysMaxTime,in float normalizedAge){vec4 value;float alphaAge=min(normalizedAge,alphaKeysMaxTime);for(int i=0;i<4;i++){vec2 key=alphaKeys[i];float time=key.x;if(alphaAge<=time){if(i==0){value.a=colorKeys[0].y;}else{vec2 lastKey=alphaKeys[i-1];float lastTime=lastKey.x;float age=(alphaAge-lastTime)/(time-lastTime);value.a=mix(lastKey.y,key.y,age);}break;}}float colorAge=min(normalizedAge,colorKeysMaxTime);for(int i=0;i<4;i++){vec4 key=colorKeys[i];float time=key.x;if(colorAge<=time){if(i==0){value.rgb=colorKeys[0].yzw;}else{vec4 lastKey=colorKeys[i-1];float lastTime=lastKey.x;float age=(colorAge-lastTime)/(time-lastTime);value.rgb=mix(lastKey.yzw,key.yzw,age);}break;}}return value;}
#endif
vec4 computeParticleColor(in vec4 color,in float normalizedAge){
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
vec4 gradientColor=evaluateParticleGradient(renderer_COLMaxGradientColor,renderer_COLGradientKeysMaxTime.z,renderer_COLMaxGradientAlpha,renderer_COLGradientKeysMaxTime.w,normalizedAge);
#endif
#ifdef RENDERER_COL_RANDOM_GRADIENTS
gradientColor=mix(evaluateParticleGradient(renderer_COLMinGradientColor,renderer_COLGradientKeysMaxTime.x,renderer_COLMinGradientAlpha,renderer_COLGradientKeysMaxTime.y,normalizedAge),gradientColor,a_Random0.y);
#endif
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
color*=gradientColor;
#endif
return color;}`,Rx=`#define GLSLIFY 1
#if defined(RENDERER_TSA_FRAME_CURVE) || defined(RENDERER_TSA_FRAME_RANDOM_CURVES)
uniform float renderer_TSACycles;uniform vec3 renderer_TSATillingParams;uniform vec2 renderer_TSAFrameMaxCurve[4];
#endif
#ifdef RENDERER_TSA_FRAME_RANDOM_CURVES
uniform vec2 renderer_TSAFrameMinCurve[4];
#endif
vec2 computeParticleUV(in vec2 uv,in float normalizedAge){
#if defined(RENDERER_TSA_FRAME_CURVE) || defined(RENDERER_TSA_FRAME_RANDOM_CURVES)
float scaledNormalizedAge=normalizedAge*renderer_TSACycles;float cycleNormalizedAge=scaledNormalizedAge-floor(scaledNormalizedAge);float normalizedFrame=evaluateParticleCurve(renderer_TSAFrameMaxCurve,cycleNormalizedAge);
#ifdef RENDERER_TSA_FRAME_RANDOM_CURVES
normalizedFrame=mix(evaluateParticleCurve(renderer_TSAFrameMinCurve,cycleNormalizedAge),normalizedFrame,a_Random1.x);
#endif
float frame=floor(normalizedFrame*renderer_TSATillingParams.z);float totalULength=frame*renderer_TSATillingParams.x;float floorTotalULength=floor(totalULength);uv.x+=totalULength-floorTotalULength;uv.y+=floorTotalULength*renderer_TSATillingParams.y;
#endif
return uv;}`,Mx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_SPHERE_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;vec3 sideVector=normalize(cross(camera_Forward,camera_Up));vec3 upVector=normalize(cross(sideVector,camera_Forward));corner*=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
if(renderer_ThreeDStartRotation){vec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));center+=renderer_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);}else{float rot=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);float c=cos(rot);float s=sin(rot);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner;center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);}
#else
if(renderer_ThreeDStartRotation){center+=renderer_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);}else{float c=cos(a_StartRotation0.x);float s=sin(a_StartRotation0.x);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner;center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);}
#endif
#endif
`,Px=`#define GLSLIFY 1
#ifdef RENDERER_MODE_STRETCHED_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;vec3 velocity;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
if(renderer_VOLSpace==0){velocity=rotationByQuaternions(renderer_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;}else{velocity=rotationByQuaternions(renderer_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;}
#else
velocity=rotationByQuaternions(renderer_SizeScale*startVelocity,worldRotation)+gravityVelocity;
#endif
vec3 cameraUpVector=normalize(velocity);vec3 direction=normalize(center-camera_Position);vec3 sideVector=normalize(cross(direction,normalize(velocity)));sideVector=renderer_SizeScale.xzy*sideVector;cameraUpVector=length(vec3(renderer_SizeScale.x,0.0,0.0))*cameraUpVector;vec2 size=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);const mat2 rotationZHalfPI=mat2(0.0,-1.0,1.0,0.0);corner=rotationZHalfPI*corner;corner.y=corner.y-abs(corner.y);float speed=length(velocity);center+=sign(renderer_SizeScale.x)*(sign(renderer_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*renderer_StretchedBillboardSpeedScale+size.y*renderer_StretchedBillboardLengthScale)*corner.y*cameraUpVector);
#endif
`,Bx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_VERTICAL_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;const vec3 cameraUpVector=vec3(0.0,1.0,0.0);vec3 sideVector=normalize(cross(camera_Forward,cameraUpVector));float rot=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);float c=cos(rot);float s=sin(rot);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner*cos(0.78539816339744830961566084581988);corner*=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*cameraUpVector);
#endif
`,bx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_HORIZONTAL_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;const vec3 cameraUpVector=vec3(0.0,0.0,1.0);const vec3 sideVector=vec3(-1.0,0.0,0.0);float rot=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);float c=cos(rot);float s=sin(rot);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner*cos(0.78539816339744830961566084581988);corner*=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*cameraUpVector);
#endif
`,Dx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_MESH
vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
if(renderer_ThreeDStartRotation){vec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));center+=rotationByQuaternions(renderer_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);}else{
#ifdef RENDERER_ROL_IS_SEPARATE
float angle=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);if(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){center+=(rotationByQuaternions(rotationByAxis(renderer_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));}else{
#ifdef SHAPE
center+=renderer_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));
#else
if(renderer_SimulationSpace==1)center+=rotationByAxis(renderer_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);else if(renderer_SimulationSpace==0)center+=rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);
#endif
}
#endif
#ifdef ROTATION_OVER_LIFETIME_SEPARATE
vec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,-a_StartRotation0.x),age,normalizedAge);center+=(rotationByQuaternions(rotationByEuler(renderer_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));
#endif
}
#else
if(renderer_ThreeDStartRotation){center+=rotationByQuaternions(renderer_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);}else{if(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){if(renderer_SimulationSpace==1)center+=rotationByAxis(renderer_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);else if(renderer_SimulationSpace==0)center+=(rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));}else{
#ifdef SHAPE
if(renderer_SimulationSpace==1)center+=renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);else if(renderer_SimulationSpace==0)center+=rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);
#else
if(renderer_SimulationSpace==1)center+=rotationByAxis(renderer_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);else if(renderer_SimulationSpace==0)center+=rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);
#endif
}}
#endif
v_MeshColor=a_MeshColor;
#endif
`,Lx={particle_common:Sx,velocity_over_lifetime_module:Cx,rotation_over_lifetime_module:Ex,size_over_lifetime_module:wx,color_over_lifetime_module:Tx,texture_sheet_animation_module:Rx,sphere_billboard:Mx,stretched_billboard:Px,vertical_billboard:Bx,horizontal_billboard:bx,particle_mesh:Dx},Ix=`#define GLSLIFY 1
vec3 getNormal(bool isFrontFacing){
#ifdef RENDERER_HAS_NORMAL
vec3 normal=normalize(v_normal);
#elif defined(HAS_DERIVATIVES)
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 normal=normalize(cross(pos_dx,pos_dy));
#else
vec3 normal=vec3(0,0,1);
#endif
normal*=float(isFrontFacing)*2.0-1.0;return normal;}vec3 getNormalByNormalTexture(mat3 tbn,sampler2D normalTexture,float normalIntensity,vec2 uv,bool isFrontFacing){vec3 normal=texture2D(normalTexture,uv).rgb;normal=normalize(tbn*((2.0*normal-1.0)*vec3(normalIntensity,normalIntensity,1.0)));normal*=float(isFrontFacing)*2.0-1.0;return normal;}mat3 getTBN(bool isFrontFacing){
#if defined(RENDERER_HAS_NORMAL) && defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
mat3 tbn=v_TBN;
#else
vec3 normal=getNormal(isFrontFacing);vec3 position=v_pos;vec2 uv=isFrontFacing? v_uv:-v_uv;
#ifdef HAS_DERIVATIVES
vec3 dp1=dFdx(position);vec3 dp2=dFdy(position);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));mat3 tbn=mat3(tangent*invmax,binormal*invmax,normal);
#else
mat3 tbn=mat3(vec3(0.0),vec3(0.0),normal);
#endif
#endif
return tbn;}`,sd=l_({common:x1,common_vert:S1,transform_declare:C1,camera_declare:A1,color_share:E1,normal_share:R1,uv_share:M1,worldpos_share:P1,FogVertexDeclaration:T1,FogFragmentDeclaration:w1,begin_normal_vert:B1,begin_position_vert:b1,position_vert:F1,color_vert:I1,normal_vert:N1,skinning_vert:O1,blendShape_input:D1,blendShape_vert:L1,uv_vert:z1,worldpos_vert:U1,FogVertex:V1,light_frag_define:G1,mobile_material_frag:H1,FogFragment:k1,begin_mobile_frag:W1,begin_viewdir_frag:Q1,mobile_blinnphong_frag:X1,noise_common:K1,noise_cellular_2D:Y1,noise_cellular_2x2:q1,noise_cellular_2x2x2:J1,noise_cellular_3D:Z1,noise_cellular:j1,noise_perlin_2D:ex,noise_perlin_3D:tx,noise_perlin_4D:nx,noise_perlin:$1,noise_psrd_2D:rx,noise_simplex_2D:ax,noise_simplex_3D_grad:sx,noise_simplex_3D:ox,noise_simplex_4D:lx,noise_simplex:ix},xx,vx,{normal_get:Ix},Lx),Ni=function(){function n(){}return n.parseCustomMacros=function(a){return a.map(function(t){return"#define "+t+`
`}).join("")},n.registerInclude=function(a,t){if(sd[a])throw'The "'+a+'" shader include already exist';sd[a]=t},n.parseIncludes=function(a){var t=function(o,s){var l=sd[s];return l===void 0?(ve.error('Shader slice "'+o.trim()+'" not founded.'),""):n.parseIncludes(l)},e=/^[ \t]*#include +<([\w\d.]+)>/gm;return a.replace(e,t)},n.convertTo300=function(a,t){if(a=a.replace(/\battribute\b/g,"in"),a=a.replace(/\bvarying\b/g,t?"in":"out"),a=a.replace(/\btexture(2D|Cube)\b/g,"texture"),a=a.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),t){var e=/\bgl_FragData\[.+?\]/g.test(a);if(e){a=a.replace(/\bgl_FragColor\b/g,"gl_FragData[0]");var r=a.match(/\bgl_FragData\[.+?\]/g);a=this._replaceMRTShader(a,r)}else a=a.replace(/void\s+?main\s*\(/g,`out vec4 glFragColor;
void main(`),a=a.replace(/\bgl_FragColor\b/g,"glFragColor")}return a},n._replaceMRTShader=function(a,t){for(var e="",r=new Set,o=0;o<t.length;o++){var s=t[o].match(/\bgl_FragData\[(.+?)\]/);r.add(s[1])}return r.forEach(function(l){e+="layout(location="+l+") out vec4 fragOutColor"+l+`;
`}),e+="void main(",a=a.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1"),a=a.replace(/void\s+?main\s*\(/g,e),a},n}();(function(){Ni._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"].map(function(n){return"#extension "+n+` : enable
`}).join("")})();var mi=function(){function n(i){this.name=i,this._uniqueId=n._nameCounter++}return n.getByName=function(a){var t,e,r=n._nameMap;return(t=r)[e=a]||(t[e]=new n(a))},n}();(function(){mi._nameCounter=0})();(function(){mi._nameMap=Object.create(null)})();var J0=function(){function n(){this._tagsMap=Object.create(null)}var i=n.prototype;return i.setTag=function(t,e){var r=typeof t=="string"?mi.getByName(t):t,o=this._tagsMap;o[r._uniqueId]!==void 0&&ve.warn('The value of tag named "'+r.name+'" is being replaced.'),o[r._uniqueId]=e},i.deleteTag=function(t){delete this._tagsMap[(typeof t=="string"?mi.getByName(t):t)._uniqueId]},i.getTagValue=function(t){return this._tagsMap[typeof t=="string"?mi.getByName(t)._uniqueId:t._uniqueId]},q(n,[{key:"name",get:function(){return this._name}}]),n}(),br;(function(n){n[n.Scene=0]="Scene",n[n.Camera=1]="Camera",n[n.Renderer=2]="Renderer",n[n.Material=3]="Material"})(br||(br={}));var Qn;(function(n){n[n.Linear=0]="Linear",n[n.Gamma=1]="Gamma"})(Qn||(Qn={}));var Vx=function(){function n(a){this.textureUseCompareMode=!1;var t=a._hardwareRenderer;this._rhi=t,this._gl=t.gl,this._colorSpace=a.settings.colorSpace}var i=n.prototype;return i.upload1f=function(t,e){this.cacheValue!==e&&(this._gl.uniform1f(t.location,e),this.cacheValue=e)},i.upload1fv=function(t,e){this._gl.uniform1fv(t.location,e)},i.upload2f=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g)&&(this._colorSpace===Qn.Linear?this._gl.uniform2f(t.location,J.gammaToLinearSpace(e.r),J.gammaToLinearSpace(e.g)):this._gl.uniform2f(t.location,e.r,e.g),r.x=e.r,r.y=e.g):(r.x!==e.x||r.y!==e.y)&&(this._gl.uniform2f(t.location,e.x,e.y),r.x=e.x,r.y=e.y)},i.upload2fv=function(t,e){this._gl.uniform2fv(t.location,e)},i.upload3f=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b)&&(this._colorSpace===Qn.Linear?this._gl.uniform3f(t.location,J.gammaToLinearSpace(e.r),J.gammaToLinearSpace(e.g),J.gammaToLinearSpace(e.b)):this._gl.uniform3f(t.location,e.r,e.g,e.b),r.x=e.r,r.y=e.g,r.z=e.b):(r.x!==e.x||r.y!==e.y||r.z!==e.z)&&(this._gl.uniform3f(t.location,e.x,e.y,e.z),r.x=e.x,r.y=e.y,r.z=e.z)},i.upload3fv=function(t,e){this._gl.uniform3fv(t.location,e)},i.upload4f=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b||r.w!==e.a)&&(this._colorSpace===Qn.Linear?this._gl.uniform4f(t.location,J.gammaToLinearSpace(e.r),J.gammaToLinearSpace(e.g),J.gammaToLinearSpace(e.b),e.a):this._gl.uniform4f(t.location,e.r,e.g,e.b,e.a),r.x=e.r,r.y=e.g,r.z=e.b,r.w=e.a):(r.x!==e.x||r.y!==e.y||r.z!==e.z||r.w!==e.w)&&(this._gl.uniform4f(t.location,e.x,e.y,e.z,e.w),r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w)},i.upload4fv=function(t,e){this._gl.uniform4fv(t.location,e)},i.upload1i=function(t,e){this.cacheValue!==e&&(this._gl.uniform1i(t.location,e),this.cacheValue=e)},i.upload1iv=function(t,e){this._gl.uniform1iv(t.location,e)},i.upload2i=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g)&&(this._gl.uniform2i(t.location,e.r,e.g),r.x=e.r,r.y=e.g):(r.x!==e.x||r.y!==e.y)&&(this._gl.uniform2i(t.location,e.x,e.y),r.x=e.x,r.y=e.y)},i.upload2iv=function(t,e){this._gl.uniform2iv(t.location,e)},i.upload3i=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b)&&(this._gl.uniform3i(t.location,e.r,e.g,e.b),r.x=e.r,r.y=e.g,r.z=e.b):(r.x!==e.x||r.y!==e.y||r.z!==e.z)&&(this._gl.uniform3i(t.location,e.x,e.y,e.z),r.x=e.x,r.y=e.y,r.z=e.z)},i.upload3iv=function(t,e){this._gl.uniform3iv(t.location,e)},i.upload4i=function(t,e){var r=this.cacheValue;e.r!==void 0?(r.x!==e.r||r.y!==e.g||r.z!==e.b||r.w!==e.a)&&(this._gl.uniform4i(t.location,e.r,e.g,e.b,e.a),r.x=e.r,r.y=e.g,r.z=e.b,r.w=e.a):(r.x!==e.x||r.y!==e.y||r.z!==e.z||r.w!==e.w)&&(this._gl.uniform4i(t.location,e.x,e.y,e.z,e.w),r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w)},i.upload4iv=function(t,e){this._gl.uniform4iv(t.location,e)},i.uploadMat4=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e.elements)},i.uploadMat4v=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e)},i.uploadTexture=function(t,e){var r=this._rhi;r.activeTexture(t.textureIndex),r.bindTexture(e._platformTexture),e._setUseDepthCompareMode(t.textureUseCompareMode)},i.uploadTextureArray=function(t,e){for(var r=this._rhi,o=t.textureIndex,s=0;s<e.length;s++){var l=e[s];r.activeTexture(o[s]),r.bindTexture(l._platformTexture),l._setUseDepthCompareMode(t.textureUseCompareMode)}},n}(),is=function(){this.constUniforms=[],this.textureUniforms=[]},Z0=function(){function n(a,t,e){this.sceneUniformBlock=new is,this.cameraUniformBlock=new is,this.rendererUniformBlock=new is,this.materialUniformBlock=new is,this.otherUniformBlock=new is,this._uploadRenderCount=-1,this.attributeLocation=Object.create(null),this._activeTextureUint=0,this._engine=a,this._gl=a._hardwareRenderer.gl,this._glProgram=this._createProgram(t,e),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=n._counter++}var i=n.prototype;return i.uploadAll=function(t,e){this.uploadUniforms(t,e),this.uploadTextures(t,e)},i.uploadUniforms=function(t,e){for(var r=e._propertyValueMap,o=t.constUniforms,s=0,l=o.length;s<l;s++){var u=o[s],c=r[u.propertyId];c!=null&&u.applyFunc(u,c)}},i.uploadTextures=function(t,e){var r=e._propertyValueMap,o=t.textureUniforms;if(o)for(var s=0,l=o.length;s<l;s++){var u=o[s],c=r[u.propertyId];c&&!c.destroyed?u.applyFunc(u,c):u.applyFunc(u,u.textureDefault)}},i.uploadUnGroupTextures=function(){var t=this.otherUniformBlock.textureUniforms;if(t)for(var e=0,r=t.length;e<r;e++){var o=t[e];o.applyFunc(o,o.textureDefault)}},i.groupingOtherUniformBlock=function(){var t=this.otherUniformBlock,e=t.constUniforms,r=t.textureUniforms;e.length>0&&this._groupingSubOtherUniforms(e,!1),r.length>0&&this._groupingSubOtherUniforms(r,!0)},i.bind=function(){var t=this._engine._hardwareRenderer;return t._currentBindShaderProgram!==this?(this._gl.useProgram(this._glProgram),t._currentBindShaderProgram=this,!0):!1},i.destroy=function(){var t=this._gl;this._glProgram&&t.deleteProgram(this._glProgram)},i._groupingSubOtherUniforms=function(t,e){for(var r=t.length-1;r>=0;r--){var o=t[r],s=U._getShaderPropertyGroup(o.name);s!==void 0&&(t.splice(t.indexOf(o),1),this._groupingUniform(o,s,e))}},i._groupingUniform=function(t,e,r){switch(e){case br.Scene:r?this.sceneUniformBlock.textureUniforms.push(t):this.sceneUniformBlock.constUniforms.push(t);break;case br.Camera:r?this.cameraUniformBlock.textureUniforms.push(t):this.cameraUniformBlock.constUniforms.push(t);break;case br.Renderer:r?this.rendererUniformBlock.textureUniforms.push(t):this.rendererUniformBlock.constUniforms.push(t);break;case br.Material:r?this.materialUniformBlock.textureUniforms.push(t):this.materialUniformBlock.constUniforms.push(t);break;default:r?this.otherUniformBlock.textureUniforms.push(t):this.otherUniformBlock.constUniforms.push(t)}},i._createProgram=function(t,e){var r=this._gl,o=this._createShader(r.VERTEX_SHADER,t);if(!o)return null;var s=this._createShader(r.FRAGMENT_SHADER,e);if(!s)return null;var l=r.createProgram();return l?(r.attachShader(l,o),r.attachShader(l,s),r.linkProgram(l),r.validateProgram(l),r.deleteShader(o),r.deleteShader(s),ve.isEnabled&&!r.getProgramParameter(l,r.LINK_STATUS)&&!r.isContextLost()?(ve.error(`Could not link WebGL program

`+("Shader error: "+r.getError()+`

`)+("Validate status: "+r.getProgramParameter(l,r.VALIDATE_STATUS)+`

`)+("Program information log: "+r.getProgramInfoLog(l))),r.deleteProgram(l),null):l):(console.warn("Context lost while create program."),null)},i._createShader=function(t,e){var r=this._gl,o=r.createShader(t);return o?(r.shaderSource(o,e),r.compileShader(o),ve.isEnabled&&!r.getShaderParameter(o,r.COMPILE_STATUS)&&!r.isContextLost()?(console.warn(`Could not compile WebGL shader

`+("Shader type: "+(t==r.VERTEX_SHADER?"vertex":"fragment")+`

`)+(`Shader information log:
`+r.getShaderInfoLog(o)+`
`)+(`Shader source:
`+n._addLineNum(e))),r.deleteShader(o),null):o):(console.warn("Context lost while create shader."),null)},i._recordLocation=function(){var t=this,e=this._gl,r=this._glProgram,o=this._getUniformInfos(),s=this._getAttributeInfos();o.forEach(function(l){var u=l.name,c=l.size,d=l.type,_=new Vx(t._engine),f=!1,v=!1;u.indexOf("[0]")>0&&(u=u.substr(0,u.length-3),f=!0);var p=e.getUniformLocation(r,u);switch(_.name=u,_.propertyId=U.getByName(u)._uniqueId,_.location=p,d){case e.FLOAT:f?_.applyFunc=_.upload1fv:(_.applyFunc=_.upload1f,_.cacheValue=0);break;case e.FLOAT_VEC2:f?_.applyFunc=_.upload2fv:(_.applyFunc=_.upload2f,_.cacheValue=new te(0,0));break;case e.FLOAT_VEC3:f?_.applyFunc=_.upload3fv:(_.applyFunc=_.upload3f,_.cacheValue=new M(0,0,0));break;case e.FLOAT_VEC4:f?_.applyFunc=_.upload4fv:(_.applyFunc=_.upload4f,_.cacheValue=new ue(0,0,0,0));break;case e.BOOL:case e.INT:f?_.applyFunc=_.upload1iv:(_.applyFunc=_.upload1i,_.cacheValue=0);break;case e.BOOL_VEC2:case e.INT_VEC2:f?_.applyFunc=_.upload2iv:(_.applyFunc=_.upload2i,_.cacheValue=new te(0,0));break;case e.BOOL_VEC3:case e.INT_VEC3:f?_.applyFunc=_.upload3iv:(_.applyFunc=_.upload3i,_.cacheValue=new M(0,0,0));break;case e.BOOL_VEC4:case e.INT_VEC4:f?_.applyFunc=_.upload4iv:(_.applyFunc=_.upload4i,_.cacheValue=new ue(0,0,0));break;case e.FLOAT_MAT4:_.applyFunc=f?_.uploadMat4v:_.uploadMat4;break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_SHADOW:var g;switch(d){case e.SAMPLER_2D:g=t._engine._magentaTexture2D;break;case e.SAMPLER_CUBE:g=t._engine._magentaTextureCube;break;case e.SAMPLER_2D_ARRAY:g=t._engine._magentaTexture2DArray;break;case e.SAMPLER_2D_SHADOW:g=t._engine._depthTexture2D,_.textureUseCompareMode=!0;break}if(v=!0,f){for(var m=new Array(c),h=new Int32Array(c),y=new Array(c),A=0;A<c;A++)m[A]=g,h[A]=t._activeTextureUint,y[A]=e.TEXTURE0+t._activeTextureUint++;_.textureDefault=m,_.textureIndex=y,_.applyFunc=_.uploadTextureArray,t.bind(),e.uniform1iv(p,h)}else{var S=e.TEXTURE0+t._activeTextureUint;_.textureDefault=g,_.textureIndex=S,_.applyFunc=_.uploadTexture,t.bind(),e.uniform1i(p,t._activeTextureUint++)}break;default:throw new Error("Unsupported uniform type")}var x=U._getShaderPropertyGroup(u);t._groupingUniform(_,x,v)}),s.forEach(function(l){var u=l.name;t.attributeLocation[u]=e.getAttribLocation(r,u)})},i._getUniformInfos=function(){for(var t=this._gl,e=this._glProgram,r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=new Array(r),s=0;s<r;++s){var l=t.getActiveUniform(e,s);o[s]=l}return o},i._getAttributeInfos=function(){for(var t=this._gl,e=this._glProgram,r=new Array,o=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s=0;s<o;++s){var l=t.getActiveAttrib(e,s);r[s]=l}return r},n._addLineNum=function(t){var e=t.split(`
`),r=(e.length+1).toString().length+6,o;return e.map(function(s,l){if(o="0:"+(l+1),o.length>=r)return o.substring(0,r)+s;for(var u=0;u<r-o.length;u++)o+=" ";return o+s}).join(`
`)},q(n,[{key:"isValid",get:function(){return this._isValid}}]),n}();(function(){Z0._counter=0})();var zt=function(n){W(i,n);function i(t,e,r,o){var s;s=n.call(this)||this,s._shaderPassId=0,s._renderStateDataMap={},s._shaderPassId=i._shaderPassCounter++,typeof r=="string"?(s._name=t,s._vertexSource=e,s._fragmentSource=r,o=o??{pipelineStage:hn.Forward}):(s._name="Default",s._vertexSource=t,s._fragmentSource=e,o=r??{pipelineStage:hn.Forward});for(var l in o)s.setTag(l,o[l]);return s}var a=i.prototype;return a._getShaderProgram=function(e,r){var o=e._getShaderProgramPool(this),s=o.get(r);if(s)return s;var l=e._hardwareRenderer.isWebGL2,u=[];oe._getNamesByMacros(r,u);var c=Ni.parseCustomMacros(u),d=l?"#version 300 es":"#version 100",_=l?"#define GRAPHICS_API_WEBGL2":"#define GRAPHICS_API_WEBGL1",f=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      precision highp int;
    #else
      precision mediump float;
      precision mediump int;
    #endif
    `;e._hardwareRenderer.canIUse(Z.shaderTextureLod)&&(f+=`#define HAS_TEX_LOD
`),e._hardwareRenderer.canIUse(Z.standardDerivatives)&&(f+=`#define HAS_DERIVATIVES
`);var v=" "+d+`
        `+_+`
        `+c+`
      `+Ni.parseIncludes(this._vertexSource),p=" "+d+`
        `+_+`
        `+(l?"":Ni._shaderExtension)+`
        `+f+`
        `+c+`
      `+Ni.parseIncludes(this._fragmentSource);return l&&(v=Ni.convertTo300(v),p=Ni.convertTo300(p,!0)),s=new Z0(e,v,p),o.cache(s),s},i}(J0);(function(){zt._shaderPassCounter=0})();var lu=function(n){W(i,n);function i(a,t,e){var r;r=n.call(this)||this,r._name=a;var o=t.length;if(o<1)throw" count must large than 0.";r._passes=t.slice();for(var s in e)r.setTag(s,e[s]);return r}return q(i,[{key:"passes",get:function(){return this._passes}}]),i}(J0),K0=function(){this.enabled=!1,this.colorBlendOperation=dn.Add,this.alphaBlendOperation=dn.Add,this.sourceColorBlendFactor=we.One,this.sourceAlphaBlendFactor=we.One,this.destinationColorBlendFactor=we.Zero,this.destinationAlphaBlendFactor=we.Zero,this.colorWriteMask=ar.All},xc=function(){function n(){this.targetBlendState=new K0,this.blendColor=new J(0,0,0,0),this.alphaToCoverage=!1}var i=n.prototype;return i._applyShaderDataValue=function(t,e){var r=this.targetBlendState,o=t[ae.BlendStateEnabled0];if(o!==void 0){var s=e.getFloat(o);r.enabled=s!==void 0?!!s:!1}var l=t[ae.BlendStateColorBlendOperation0];if(l!==void 0){var u;r.colorBlendOperation=(u=e.getFloat(l))!=null?u:dn.Add}var c=t[ae.BlendStateAlphaBlendOperation0];if(c!==void 0){var d;r.alphaBlendOperation=(d=e.getFloat(c))!=null?d:dn.Add}var _=t[ae.BlendStateSourceColorBlendFactor0];if(_!==void 0){var f;r.sourceColorBlendFactor=(f=e.getFloat(_))!=null?f:we.One}var v=t[ae.BlendStateSourceAlphaBlendFactor0];if(v!==void 0){var p;r.sourceAlphaBlendFactor=(p=e.getFloat(v))!=null?p:we.One}var g=t[ae.BlendStateDestinationColorBlendFactor0];if(g!==void 0){var m;r.destinationColorBlendFactor=(m=e.getFloat(g))!=null?m:we.Zero}var h=t[ae.BlendStateDestinationAlphaBlendFactor0];if(h!==void 0){var y;r.destinationAlphaBlendFactor=(y=e.getFloat(h))!=null?y:we.Zero}var A=t[ae.BlendStateColorWriteMask0];if(A!==void 0){var S;r.colorWriteMask=(S=e.getFloat(A))!=null?S:ar.All}var x=t[ae.BlendStateBlendColor];if(x!==void 0){var C=e.getColor(x);C!==void 0&&this.blendColor.copyFrom(C)}var E=t[ae.BlendStateAlphaToCoverage];if(E!==void 0){var T=e.getFloat(E);this.alphaToCoverage=T!==void 0?!!T:!1}},i._apply=function(t,e){this._platformApply(t,e.blendState)},i._platformApply=function(t,e){var r=t.gl,o=e.targetBlendState,s=this.targetBlendState,l=s.enabled,u=s.colorBlendOperation,c=s.alphaBlendOperation,d=s.sourceColorBlendFactor,_=s.destinationColorBlendFactor,f=s.sourceAlphaBlendFactor,v=s.destinationAlphaBlendFactor,p=s.colorWriteMask;if(l!==o.enabled&&(l?r.enable(r.BLEND):r.disable(r.BLEND),o.enabled=l),l){(d!==o.sourceColorBlendFactor||_!==o.destinationColorBlendFactor||f!==o.sourceAlphaBlendFactor||v!==o.destinationAlphaBlendFactor)&&(r.blendFuncSeparate(n._getGLBlendFactor(t,d),n._getGLBlendFactor(t,_),n._getGLBlendFactor(t,f),n._getGLBlendFactor(t,v)),o.sourceColorBlendFactor=d,o.destinationColorBlendFactor=_,o.sourceAlphaBlendFactor=f,o.destinationAlphaBlendFactor=v),(u!==o.colorBlendOperation||c!==o.alphaBlendOperation)&&(r.blendEquationSeparate(n._getGLBlendOperation(t,u),n._getGLBlendOperation(t,c)),o.colorBlendOperation=u,o.alphaBlendOperation=c);var g=this.blendColor;J.equals(e.blendColor,g)||(r.blendColor(g.r,g.g,g.b,g.a),e.blendColor.copyFrom(g))}p!==o.colorWriteMask&&(r.colorMask((p&ar.Red)!==0,(p&ar.Green)!==0,(p&ar.Blue)!==0,(p&ar.Alpha)!==0),o.colorWriteMask=p);var m=this.alphaToCoverage;m!==e.alphaToCoverage&&(m?r.enable(r.SAMPLE_ALPHA_TO_COVERAGE):r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),e.alphaToCoverage=m)},n._getGLBlendFactor=function(t,e){var r=t.gl;switch(e){case we.Zero:return r.ZERO;case we.One:return r.ONE;case we.SourceColor:return r.SRC_COLOR;case we.OneMinusSourceColor:return r.ONE_MINUS_SRC_COLOR;case we.DestinationColor:return r.DST_COLOR;case we.OneMinusDestinationColor:return r.ONE_MINUS_DST_COLOR;case we.SourceAlpha:return r.SRC_ALPHA;case we.OneMinusSourceAlpha:return r.ONE_MINUS_SRC_ALPHA;case we.DestinationAlpha:return r.DST_ALPHA;case we.OneMinusDestinationAlpha:return r.ONE_MINUS_DST_ALPHA;case we.SourceAlphaSaturate:return r.SRC_ALPHA_SATURATE;case we.BlendColor:return r.CONSTANT_COLOR;case we.OneMinusBlendColor:return r.ONE_MINUS_CONSTANT_COLOR}},n._getGLBlendOperation=function(t,e){var r=t.gl;switch(e){case dn.Add:return r.FUNC_ADD;case dn.Subtract:return r.FUNC_SUBTRACT;case dn.ReverseSubtract:return r.FUNC_REVERSE_SUBTRACT;case dn.Min:if(!t.canIUse(Z.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return r.MIN;case dn.Max:if(!t.canIUse(Z.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return r.MAX}},n}();P([K],xc.prototype,"targetBlendState",void 0);P([K],xc.prototype,"blendColor",void 0);var $0=function(){function n(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=Me.Less}var i=n.prototype;return i._applyShaderDataValue=function(t,e){var r=t[ae.DepthStateEnabled];if(r!==void 0){var o=e.getFloat(r);this.enabled=o!==void 0?!!o:!1}var s=t[ae.DepthStateWriteEnabled];if(s!==void 0){var l=e.getFloat(s);this.writeEnabled=l!==void 0?!!l:!1}var u=t[ae.DepthStateCompareFunction];if(u!==void 0){var c;this.compareFunction=(c=e.getFloat(u))!=null?c:Me.Less}},i._apply=function(t,e){this._platformApply(t,e.depthState)},i._platformApply=function(t,e){var r=t.gl,o=this,s=o.enabled,l=o.compareFunction,u=o.writeEnabled;s!=e.enabled&&(s?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),e.enabled=s),s&&(l!=e.compareFunction&&(r.depthFunc(n._getGLCompareFunction(t,l)),e.compareFunction=l),u!=e.writeEnabled&&(r.depthMask(u),e.writeEnabled=u))},n._getGLCompareFunction=function(t,e){var r=t.gl;switch(e){case Me.Never:return r.NEVER;case Me.Less:return r.LESS;case Me.Equal:return r.EQUAL;case Me.LessEqual:return r.LEQUAL;case Me.Greater:return r.GREATER;case Me.NotEqual:return r.NOTEQUAL;case Me.GreaterEqual:return r.GEQUAL;case Me.Always:return r.ALWAYS}},n}(),em=function(){function n(){this.cullMode=Mn.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0,this._frontFaceInvert=!1}var i=n.prototype;return i._applyShaderDataValue=function(t,e){var r=t[ae.RasterStateCullMode];if(r!==void 0){var o;this.cullMode=(o=e.getFloat(r))!=null?o:Mn.Back}var s=t[ae.RasterStateDepthBias];if(s!==void 0){var l;this.depthBias=(l=e.getFloat(s))!=null?l:0}var u=t[ae.RasterStateSlopeScaledDepthBias];if(u!==void 0){var c;this.slopeScaledDepthBias=(c=e.getFloat(u))!=null?c:0}},i._apply=function(t,e,r){this._platformApply(t,e.rasterState,r)},i._platformApply=function(t,e,r){var o=t.gl,s=this,l=s.cullMode,u=s.depthBias,c=s.slopeScaledDepthBias,d=l!==Mn.Off;d!==e._cullFaceEnable&&(d?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),e._cullFaceEnable=d),d&&l!==e.cullMode&&(l==Mn.Back?o.cullFace(o.BACK):o.cullFace(o.FRONT),e.cullMode=l),r!==e._frontFaceInvert&&(r?o.frontFace(o.CW):o.frontFace(o.CCW),e._frontFaceInvert=r),t._enableGlobalDepthBias||(u!==e.depthBias||c!==e.slopeScaledDepthBias)&&(u!==0||c!==0?(o.enable(o.POLYGON_OFFSET_FILL),o.polygonOffset(c,u)):o.disable(o.POLYGON_OFFSET_FILL),e.depthBias=u,e.slopeScaledDepthBias=c)},n}(),tm=function(){function n(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=Me.Always,this.compareFunctionBack=Me.Always,this.passOperationFront=Ke.Keep,this.passOperationBack=Ke.Keep,this.failOperationFront=Ke.Keep,this.failOperationBack=Ke.Keep,this.zFailOperationFront=Ke.Keep,this.zFailOperationBack=Ke.Keep}var i=n.prototype;return i._applyShaderDataValue=function(t,e){var r=t[ae.StencilStateEnabled];if(r!==void 0){var o=e.getFloat(r);this.enabled=o!==void 0?!!o:!1}var s=t[ae.StencilStateReferenceValue];if(s!==void 0){var l;this.referenceValue=(l=e.getFloat(s))!=null?l:0}var u=t[ae.StencilStateMask];if(u!==void 0){var c;this.mask=(c=e.getFloat(u))!=null?c:255}var d=t[ae.StencilStateWriteMask];if(d!==void 0){var _;this.writeMask=(_=e.getFloat(d))!=null?_:255}var f=t[ae.StencilStateCompareFunctionFront];if(f!==void 0){var v;this.compareFunctionFront=(v=e.getFloat(f))!=null?v:Me.Always}var p=t[ae.StencilStateCompareFunctionBack];if(p!==void 0){var g;this.compareFunctionBack=(g=e.getFloat(p))!=null?g:Me.Always}var m=t[ae.StencilStatePassOperationFront];if(m!==void 0){var h;this.passOperationFront=(h=e.getFloat(m))!=null?h:Ke.Keep}var y=t[ae.StencilStatePassOperationBack];if(y!==void 0){var A;this.passOperationBack=(A=e.getFloat(y))!=null?A:Ke.Keep}var S=t[ae.StencilStateFailOperationFront];if(S!==void 0){var x;this.failOperationFront=(x=e.getFloat(S))!=null?x:Ke.Keep}var C=t[ae.StencilStateFailOperationBack];if(C!==void 0){var E;this.failOperationBack=(E=e.getFloat(C))!=null?E:Ke.Keep}var T=t[ae.StencilStateZFailOperationFront];if(T!==void 0){var w;this.zFailOperationFront=(w=e.getFloat(T))!=null?w:Ke.Keep}var R=t[ae.StencilStateZFailOperationBack];if(R!==void 0){var b;this.zFailOperationBack=(b=e.getFloat(R))!=null?b:Ke.Keep}},i._apply=function(t,e){this._platformApply(t,e.stencilState)},i._platformApply=function(t,e){var r=t.gl,o=this,s=o.enabled,l=o.referenceValue,u=o.mask,c=o.compareFunctionFront,d=o.compareFunctionBack,_=o.failOperationFront,f=o.zFailOperationFront,v=o.passOperationFront,p=o.failOperationBack,g=o.zFailOperationBack,m=o.passOperationBack,h=o.writeMask;if(s!=e.enabled&&(s?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),e.enabled=s),s){var y=l!==e.referenceValue||u!==e.mask;(y||c!==e.compareFunctionFront)&&(r.stencilFuncSeparate(r.FRONT,n._getGLCompareFunction(t,c),l,u),e.compareFunctionFront=c),(y||d!==e.compareFunctionBack)&&(r.stencilFuncSeparate(r.BACK,n._getGLCompareFunction(t,d),l,u),e.compareFunctionBack=this.compareFunctionBack),y&&(e.referenceValue=this.referenceValue,e.mask=this.mask),(_!==e.failOperationFront||f!==e.zFailOperationFront||v!==e.passOperationFront)&&(r.stencilOpSeparate(r.FRONT,n._getGLStencilOperation(t,_),n._getGLStencilOperation(t,f),n._getGLStencilOperation(t,v)),e.failOperationFront=_,e.zFailOperationFront=f,e.passOperationFront=v),(p!==e.failOperationBack||g!==e.zFailOperationBack||m!==e.passOperationBack)&&(r.stencilOpSeparate(r.BACK,n._getGLStencilOperation(t,p),n._getGLStencilOperation(t,g),n._getGLStencilOperation(t,m)),e.failOperationBack=p,e.zFailOperationBack=g,e.passOperationBack=m),h!==e.writeMask&&(r.stencilMask(h),e.writeMask=h)}},n._getGLCompareFunction=function(t,e){var r=t.gl;switch(e){case Me.Never:return r.NEVER;case Me.Less:return r.LESS;case Me.Equal:return r.EQUAL;case Me.LessEqual:return r.LEQUAL;case Me.Greater:return r.GREATER;case Me.NotEqual:return r.NOTEQUAL;case Me.GreaterEqual:return r.GEQUAL;case Me.Always:return r.ALWAYS}},n._getGLStencilOperation=function(t,e){var r=t.gl;switch(e){case Ke.Keep:return r.KEEP;case Ke.Zero:return r.ZERO;case Ke.Replace:return r.REPLACE;case Ke.IncrementSaturate:return r.INCR;case Ke.DecrementSaturate:return r.DECR;case Ke.Invert:return r.INVERT;case Ke.IncrementWrap:return r.INCR_WRAP;case Ke.DecrementWrap:return r.DECR_WRAP}},n}(),Kr=function(){function n(){this.blendState=new xc,this.depthState=new $0,this.stencilState=new tm,this.rasterState=new em,this.renderQueueType=bt.Opaque}var i=n.prototype;return i._applyShaderDataValue=function(t,e){this.blendState._applyShaderDataValue(t,e),this.depthState._applyShaderDataValue(t,e),this.stencilState._applyShaderDataValue(t,e),this.rasterState._applyShaderDataValue(t,e);var r=t[ae.RenderQueueType];if(r!==void 0){var o;this.renderQueueType=(o=e.getFloat(r))!=null?o:bt.Opaque}},i._apply=function(t,e,r,o){r&&this._applyShaderDataValue(r,o);var s=t._hardwareRenderer,l=t._lastRenderState;this.blendState._apply(s,l),this.depthState._apply(s,l),this.stencilState._apply(s,l),this.rasterState._apply(s,l,e)},n}();P([K],Kr.prototype,"blendState",void 0);P([K],Kr.prototype,"depthState",void 0);P([K],Kr.prototype,"stencilState",void 0);P([K],Kr.prototype,"rasterState",void 0);var be=function(){function n(a,t){this.name=a,this.name=a,this._subShaders=t}var i=n.prototype;return i.compileVariant=function(t,e){var r=n._compileMacros;r.clear();for(var o=0,s=e.length;o<s;o++)r.enable(oe.getByName(e[o]));for(var l=this._subShaders,u=0,c=l.length;u<c;u++){for(var d=void 0,_=l[u].passes,f=0,v=_.length;f<v;f++)(d===void 0||d)&&(d=_[f]._getShaderProgram(t,r).isValid);if(d)return!0}return!1},n.create=function(t,e,r){var o,s=n._shaderMap;if(e){if(s[t])throw'Shader named "'+t+'" already exists.';if(typeof e=="string"){var c=new zt(e,r);o=new n(t,[new lu("Default",[c])])}else if(e.length>0)e[0].constructor===zt?o=new n(t,[new lu("Default",e)]):o=new n(t,e.slice());else throw"SubShader or ShaderPass count must large than 0."}else{if(!n._shaderLab)throw"ShaderLab has not been set up yet.";var l=n._shaderLab.parseShader(t);if(s[l.name])throw'Shader named "'+l.name+'" already exists.';var u=l.subShaders.map(function(d){var _=d.passes.map(function(f){if(typeof f=="string"){var v,p,g=f.split("/");return(p=n.find(g[0]))==null||(v=p.subShaders.find(function(T){return T.name===g[1]}))==null?void 0:v.passes.find(function(T){return T.name===g[2]})}var m=new zt(f.name,f.vertexSource,f.fragmentSource,f.tags),h=f.renderStates,y=new Kr;m._renderState=y;var A=h[0];for(var S in A)n._applyConstRenderStates(y,parseInt(S),A[S]);var x=h[1],C={};for(var E in x)C[E]=U.getByName(x[E]);return m._renderStateDataMap=C,m});return new lu(l.name,_,d.tags)});return o=new n(l.name,u),s[l.name]=o,o}return s[t]=o,o},n.find=function(t){return n._shaderMap[t]},n._applyConstRenderStates=function(t,e,r){switch(e){case ae.BlendStateEnabled0:t.blendState.targetBlendState.enabled=r;break;case ae.BlendStateColorBlendOperation0:t.blendState.targetBlendState.colorBlendOperation=r;break;case ae.BlendStateAlphaBlendOperation0:t.blendState.targetBlendState.alphaBlendOperation=r;break;case ae.BlendStateSourceColorBlendFactor0:t.blendState.targetBlendState.sourceColorBlendFactor=r;break;case ae.BlendStateDestinationColorBlendFactor0:t.blendState.targetBlendState.destinationColorBlendFactor=r;break;case ae.BlendStateSourceAlphaBlendFactor0:t.blendState.targetBlendState.sourceAlphaBlendFactor=r;break;case ae.BlendStateDestinationAlphaBlendFactor0:t.blendState.targetBlendState.destinationAlphaBlendFactor=r;break;case ae.BlendStateColorWriteMask0:t.blendState.targetBlendState.colorWriteMask=r;break;case ae.DepthStateEnabled:t.depthState.enabled=r;break;case ae.DepthStateWriteEnabled:t.depthState.writeEnabled=r;break;case ae.DepthStateCompareFunction:t.depthState.compareFunction=r;break;case ae.StencilStateEnabled:t.stencilState.enabled=r;break;case ae.StencilStateReferenceValue:t.stencilState.referenceValue=r;break;case ae.StencilStateMask:t.stencilState.mask=r;break;case ae.StencilStateWriteMask:t.stencilState.writeMask=r;break;case ae.StencilStateCompareFunctionFront:t.stencilState.compareFunctionFront=r;break;case ae.StencilStateCompareFunctionBack:t.stencilState.compareFunctionBack=r;break;case ae.StencilStatePassOperationFront:t.stencilState.passOperationFront=r;break;case ae.StencilStatePassOperationBack:t.stencilState.passOperationBack=r;break;case ae.StencilStateFailOperationFront:t.stencilState.failOperationFront=r;break;case ae.StencilStateFailOperationBack:t.stencilState.failOperationBack=r;break;case ae.StencilStateZFailOperationFront:t.stencilState.zFailOperationFront=r;break;case ae.StencilStateZFailOperationBack:t.stencilState.zFailOperationBack=r;break;case ae.RasterStateCullMode:t.rasterState.cullMode=r;break;case ae.RasterStateDepthBias:t.rasterState.depthBias=r;break;case ae.RasterStateSlopeScaledDepthBias:t.rasterState.slopeScaledDepthBias=r;break;case ae.RenderQueueType:t.renderQueueType=r;break}},n.getMacroByName=function(t,e){return oe.getByName(t,e)},n.getPropertyByName=function(t){return U.getByName(t)},q(n,[{key:"subShaders",get:function(){return this._subShaders}}]),n}();(function(){be._compileMacros=new Dn})();(function(){be._shaderMap=Object.create(null)})();var ri=function(){function n(a){this._propertyValueMap=Object.create(null),this._macroCollection=new Dn,this._macroMap=Object.create(null),this._refCount=0,this._group=a}var i=n.prototype;return i.getFloat=function(t){return this.getPropertyValue(t)},i.setFloat=function(t,e){this._setPropertyValue(t,ln.Float,e)},i.getInt=function(t){return this.getPropertyValue(t)},i.setInt=function(t,e){this._setPropertyValue(t,ln.Int,e)},i.getFloatArray=function(t){return this.getPropertyValue(t)},i.setFloatArray=function(t,e){this._setPropertyValue(t,ln.FloatArray,e)},i.getIntArray=function(t){return this.getPropertyValue(t)},i.setIntArray=function(t,e){this._setPropertyValue(t,ln.IntArray,e)},i.getVector2=function(t){return this.getPropertyValue(t)},i.setVector2=function(t,e){this._setPropertyValue(t,ln.Vector2,e)},i.getVector3=function(t){return this.getPropertyValue(t)},i.setVector3=function(t,e){this._setPropertyValue(t,ln.Vector3,e)},i.getVector4=function(t){return this.getPropertyValue(t)},i.setVector4=function(t,e){this._setPropertyValue(t,ln.Vector4,e)},i.getMatrix=function(t){return this.getPropertyValue(t)},i.setMatrix=function(t,e){this._setPropertyValue(t,ln.Matrix,e)},i.getColor=function(t){return this.getPropertyValue(t)},i.setColor=function(t,e){this._setPropertyValue(t,ln.Color,e)},i.getTexture=function(t){return this.getPropertyValue(t)},i.setTexture=function(t,e){var r=this._refCount;if(r>0){var o=this.getPropertyValue(t);o&&o._addReferCount(-r),e&&e._addReferCount(r)}this._setPropertyValue(t,ln.Texture,e)},i.getTextureArray=function(t){return this.getPropertyValue(t)},i.setTextureArray=function(t,e){var r=this._refCount;if(r>0){var o=this.getPropertyValue(t);if(o)for(var s=0,l=o.length;s<l;s++)o[s]._addReferCount(-r);if(e)for(var u=0,c=e.length;u<c;u++)e[u]._addReferCount(r)}this._setPropertyValue(t,ln.TextureArray,e)},i.getPropertyValue=function(t){return typeof t=="string"&&(t=U.getByName(t)),this._propertyValueMap[t._uniqueId]},i.enableMacro=function(t,e){typeof t=="string"&&(t=oe.getByName(t,e));var r=t._nameId,o=this._macroMap[r];if(o!==t){var s=this._macroCollection;o&&s.disable(o),s.enable(t),this._macroMap[r]=t}},i.disableMacro=function(t){var e;if(typeof t=="string"){if(e=oe._macroNameIdMap[t],e===void 0)return}else e=t._nameId;var r=this._macroMap[e];r&&(this._macroCollection.disable(r),delete this._macroMap[e])},i.getMacros=function(t){if(t){var e=this._macroMap;t.length=0;for(var r in e)t.push(e[r])}else return Object.values(this._macroMap)},i.getProperties=function(t){var e;t?(t.length=0,e=t):e=[];var r=this._propertyValueMap,o=U._propertyIdMap;for(var s in r)e.push(o[s]);if(!t)return e},i.clone=function(){var t=new n(this._group);return this.cloneTo(t),t},i.cloneTo=function(t){_r.deepCloneObject(this._macroCollection,t._macroCollection),Object.assign(t._macroMap,this._macroMap);for(var e=t._getReferCount(),r=this._propertyValueMap,o=t._propertyValueMap,s=Object.keys(r),l=0,u=s.length;l<u;l++){var c=s[l],d=r[c];if(d!=null)if(typeof d=="number")o[c]=d;else if(gt(d,Zr))o[c]=d,e>0&&d._addReferCount(e);else if(gt(d,Array)||gt(d,Float32Array)||gt(d,Int32Array))o[c]=d.slice();else{var _=o[c];_?_.copyFrom(d):o[c]=d.clone()}else o[c]=d}},i._setPropertyValue=function(t,e,r){if(typeof t=="string"&&(t=U.getByName(t)),t._group!==this._group)if(t._group===void 0)t._group=this._group;else throw"Shader property "+t.name+" has been used as "+br[t._group]+" group.";if(t._type!==e)if(t._type===void 0)t._type=e;else throw"Shader property "+t.name+" has been used as "+ln[t._type]+" type.";this._propertyValueMap[t._uniqueId]=r},i._getReferCount=function(){return this._refCount},i._addReferCount=function(t){this._refCount+=t;var e=this._propertyValueMap;for(var r in e){var o=e[r];o&&gt(o,Zr)&&o._addReferCount(t)}},n}();P([z],ri.prototype,"_group",void 0);P([z],ri.prototype,"_propertyValueMap",void 0);P([z],ri.prototype,"_macroCollection",void 0);P([z],ri.prototype,"_macroMap",void 0);P([z],ri.prototype,"_refCount",void 0);var yi=function(){function n(){}var i=n.prototype;return i.applyVirtualCamera=function(t){this.virtualCamera=t;var e=this.camera.shaderData;e.setMatrix(n._viewMatrixProperty,t.viewMatrix),e.setMatrix(n._projectionMatrixProperty,t.projectionMatrix),e.setMatrix(n.vpMatrixProperty,t.viewProjectionMatrix)},n}();(function(){yi.vpMatrixProperty=U.getByName("camera_VPMat")})();(function(){yi.pipelineStageKey=mi.getByName("pipelineStage")})();(function(){yi._viewMatrixProperty=U.getByName("camera_ViewMat")})();(function(){yi._projectionMatrixProperty=U.getByName("camera_ProjMat")})();var Sc=function(){function n(){}var i=n.prototype;return i.setX=function(t,e,r,o){this.component=t,this.material=e,this.primitive=r,this.subPrimitive=o},i.dispose=function(){this.component=null,this.material=null,this.primitive=null,this.subPrimitive=null},n}(),Nx=function(){function n(){}var i=n.prototype;return i.set=function(t,e){this.data=t,this.shaderPasses=e},i.dispose=function(){this.data=this.shaderPasses=null},n}(),wt;(function(n){n[n.None=0]="None",n[n.VisibleInsideMask=1]="VisibleInsideMask",n[n.VisibleOutsideMask=2]="VisibleOutsideMask"})(wt||(wt={}));var xr,Ce=(xr=function(n){W(i,n);function i(t){var e;e=n.call(this,t)||this,e._onUpdateIndex=-1,e._rendererIndex=-1,e._globalShaderMacro=new Dn,e._bounds=new jt,e._overrideUpdate=!1,e._materials=[],e._dirtyUpdateFlag=0,e._shaderData=new ri(br.Renderer),e._mvMatrix=new $,e._mvpMatrix=new $,e._mvInvMatrix=new $,e._normalMatrix=new $,e._materialsInstanced=[],e._priority=0,e._receiveShadows=!0,e._rendererLayer=new ue,e.castShadows=!0;var r=Ce.prototype,o=e.shaderData;return e._overrideUpdate=e.update!==r.update,o._addReferCount(1),e._onTransformChanged=e._onTransformChanged.bind(fe(e)),e._registerEntityTransformListener(),o.enableMacro(Ce._receiveShadowMacro),o.setVector4(Ce._rendererLayerProperty,e._rendererLayer),e}var a=i.prototype;return a.getInstanceMaterial=function(e){e===void 0&&(e=0);var r=this._materials;if(r.length>e){var o=r[e];if(o)return this._materialsInstanced[e]?o:this._createInstanceMaterial(o,e)}return null},a.getMaterial=function(e){return e===void 0&&(e=0),this._materials[e]||null},a.setMaterial=function(e,r){r===void 0&&(r=null),typeof e=="number"?this._setMaterial(e,r):this._setMaterial(0,e)},a.getInstanceMaterials=function(){for(var e=this._materials,r=this._materialsInstanced,o=0,s=e.length;o<s;o++)r[o]||this._createInstanceMaterial(this._materials[o],o);return e},a.getMaterials=function(){return this._materials},a.setMaterials=function(e){for(var r=e.length,o=this._materials,s=this._materialsInstanced,l=r,u=o.length;l<u;l++){var c=o[l];c&&c._addReferCount(-1)}o.length!==r&&(o.length=r),s.length!==0&&(s.length=0);for(var d=0;d<r;d++){var _=o[d],f=e[d];_!==f&&(o[d]=f,_&&_._addReferCount(-1),f&&f._addReferCount(1))}},a.update=function(e){},a._onEnableInScene=function(){var e=this.scene._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},a._onDisableInScene=function(){var e=this.scene._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},a._prepareRender=function(e){var r=e.virtualCamera,o=r.position,s=this.bounds.getCenter(Ce._tempVector0);r.isOrthographic?(M.subtract(s,o,s),this._distanceForSort=M.dot(s,r.forward)):this._distanceForSort=M.distanceSquared(s,o),this._updateShaderData(e),this._render(e),Dn.unionCollection(e.camera._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro)},a._cloneTo=function(e,r,o){for(var s=this._materials,l=0,u=s.length;l<u;l++)e._setMaterial(l,s[l])},a._onDestroy=function(){n.prototype._onDestroy.call(this),this.entity.transform._updateFlagManager.removeListener(this._onTransformChanged),this.shaderData._addReferCount(-1);for(var e=this._materials,r=0,o=e.length;r<o;r++){var s;(s=e[r])==null||s._addReferCount(-1)}this._entity=null,this._globalShaderMacro=null,this._bounds=null,this._materials=null,this._shaderData=null,this._mvMatrix=null,this._mvpMatrix=null,this._mvInvMatrix=null,this._normalMatrix=null,this._materialsInstanced=null,this._rendererLayer=null},a._updateShaderData=function(e){var r=this.entity,o=r.transform.worldMatrix;this._updateTransformShaderData(e,o);var s=r.layer;this._rendererLayer.set(s&65535,s>>>16&65535,0,0)},a._updateTransformShaderData=function(e,r){var o=this.shaderData,s=e.virtualCamera,l=this._mvMatrix,u=this._mvpMatrix,c=this._mvInvMatrix,d=this._normalMatrix;$.multiply(s.viewMatrix,r,l),$.multiply(s.viewProjectionMatrix,r,u),$.invert(l,c),$.invert(r,d),d.transpose(),o.setMatrix(Ce._localMatrixProperty,this.entity.transform.localMatrix),o.setMatrix(Ce._worldMatrixProperty,r),o.setMatrix(Ce._mvMatrixProperty,l),o.setMatrix(Ce._mvpMatrixProperty,u),o.setMatrix(Ce._mvInvMatrixProperty,c),o.setMatrix(Ce._normalMatrixProperty,d)},a._registerEntityTransformListener=function(){this.entity.transform._updateFlagManager.addListener(this._onTransformChanged)},a._updateBounds=function(e){},a._render=function(e){throw"not implement"},a._createInstanceMaterial=function(e,r){var o=e.clone();return o.name=o.name+"(Instance)",e._addReferCount(-1),o._addReferCount(1),this._materialsInstanced[r]=!0,this._materials[r]=o,o},a._setMaterial=function(e,r){var o=this._materials;e>=o.length&&(o.length=e+1);var s=o[e];if(s!==r){var l=this._materialsInstanced;e<l.length&&(l[e]=!1),s&&s._addReferCount(-1),r&&r._addReferCount(1),o[e]=r}},a._onTransformChanged=function(e){this._dirtyUpdateFlag|=1},q(i,[{key:"shaderData",get:function(){return this._shaderData}},{key:"isCulled",get:function(){return!(this._renderFrameCount===void 0||this._renderFrameCount===this._engine.time.frameCount-1)}},{key:"receiveShadows",get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(e?this.shaderData.enableMacro(Ce._receiveShadowMacro):this.shaderData.disableMacro(Ce._receiveShadowMacro),this._receiveShadows=e)}},{key:"materialCount",get:function(){return this._materials.length},set:function(e){var r=this._materials,o=this._materialsInstanced;r.length!==e&&(r.length=e),o.length>e&&(o.length=e)}},{key:"bounds",get:function(){return this._dirtyUpdateFlag&1&&(this._updateBounds(this._bounds),this._dirtyUpdateFlag&=-2),this._bounds}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}}]),i}(rn),function(){xr._tempVector0=new M}(),function(){xr._receiveShadowMacro=oe.getByName("RENDERER_IS_RECEIVE_SHADOWS")}(),function(){xr._localMatrixProperty=U.getByName("renderer_LocalMat")}(),function(){xr._worldMatrixProperty=U.getByName("renderer_ModelMat")}(),function(){xr._mvMatrixProperty=U.getByName("renderer_MVMat")}(),function(){xr._mvpMatrixProperty=U.getByName("renderer_MVPMat")}(),function(){xr._mvInvMatrixProperty=U.getByName("renderer_MVInvMat")}(),function(){xr._normalMatrixProperty=U.getByName("renderer_NormalMat")}(),function(){xr._rendererLayerProperty=U.getByName("renderer_Layer")}(),xr);P([z],Ce.prototype,"_distanceForSort",void 0);P([z],Ce.prototype,"_onUpdateIndex",void 0);P([z],Ce.prototype,"_rendererIndex",void 0);P([z],Ce.prototype,"_globalShaderMacro",void 0);P([z],Ce.prototype,"_bounds",void 0);P([z],Ce.prototype,"_renderFrameCount",void 0);P([z],Ce.prototype,"_overrideUpdate",void 0);P([z],Ce.prototype,"_materials",void 0);P([z],Ce.prototype,"_dirtyUpdateFlag",void 0);P([K],Ce.prototype,"_shaderData",void 0);P([z],Ce.prototype,"_mvMatrix",void 0);P([z],Ce.prototype,"_mvpMatrix",void 0);P([z],Ce.prototype,"_mvInvMatrix",void 0);P([z],Ce.prototype,"_normalMatrix",void 0);P([z],Ce.prototype,"_materialsInstanced",void 0);P([Ie],Ce.prototype,"_priority",void 0);P([Ie],Ce.prototype,"_receiveShadows",void 0);P([z],Ce.prototype,"_rendererLayer",void 0);P([z],Ce.prototype,"_onTransformChanged",null);Ce=P([ll(ye,za.CheckOnly)],Ce);var pt;(function(n){n[n.WorldVolume=1]="WorldVolume"})(pt||(pt={}));function In(){return function(n){}}var Nl,fi=(Nl=function(){function n(){}return n.resetData=function(a){var t=a._verticesData,e=t.positions,r=t.uvs;t.vertexCount=e.length=r.length=4;for(var o=0;o<4;o++){var s,l,u,c;(s=e)[l=o]||(s[l]=new M),(u=r)[c=o]||(u[c]=new te)}t.triangles=fi._rectangleTriangles},n.updatePositions=function(a){var t=a.width,e=a.height,r=a.sprite,o=r.pivot,s=o.x,l=o.y,u=fi._worldMatrix,c=u.elements,d=a.entity.transform.worldMatrix,_=d.elements,f=a.flipX?-t:t,v=a.flipY?-e:e;c[0]=_[0]*f,c[1]=_[1]*f,c[2]=_[2]*f,c[4]=_[4]*v,c[5]=_[5]*v,c[6]=_[6]*v,c[8]=_[8],c[9]=_[9],c[10]=_[10],c[12]=_[12]-s*c[0]-l*c[4],c[13]=_[13]-s*c[1]-l*c[5],c[14]=_[14]-s*c[2]-l*c[6];for(var p=r._getPositions(),g=a._verticesData.positions,m=0;m<4;m++){var h=p[m],y=h.x,A=h.y;g[m].set(c[0]*y+c[4]*A+c[12],c[1]*y+c[5]*A+c[13],c[2]*y+c[6]*A+c[14])}jt.transform(r._getBounds(),u,a._bounds)},n.updateUVs=function(a){var t=a.sprite._getUVs(),e=a._verticesData.uvs,r=t[0],o=r.x,s=r.y,l=t[3],u=l.x,c=l.y;e[0].set(o,s),e[1].set(u,s),e[2].set(o,c),e[3].set(u,c)},n}(),function(){Nl._rectangleTriangles=[0,1,2,2,1,3]}(),function(){Nl._worldMatrix=new $}(),Nl);fi=P([In()],fi);var Bf=function(i,a,t,e,r){e===void 0&&(e=null),r===void 0&&(r=null),this.vertexCount=i,this.positions=a,this.uvs=t,this.triangles=e,this.color=r},Oo;(function(n){n[n.Layer0=1]="Layer0",n[n.Layer1=2]="Layer1",n[n.Layer2=4]="Layer2",n[n.Layer3=8]="Layer3",n[n.Layer4=16]="Layer4",n[n.Layer5=32]="Layer5",n[n.Layer6=64]="Layer6",n[n.Layer7=128]="Layer7",n[n.Layer8=256]="Layer8",n[n.Layer9=512]="Layer9",n[n.Layer10=1024]="Layer10",n[n.Layer11=2048]="Layer11",n[n.Layer12=4096]="Layer12",n[n.Layer13=8192]="Layer13",n[n.Layer14=16384]="Layer14",n[n.Layer15=32768]="Layer15",n[n.Layer16=65536]="Layer16",n[n.Layer17=131072]="Layer17",n[n.Layer18=262144]="Layer18",n[n.Layer19=524288]="Layer19",n[n.Layer20=1048576]="Layer20",n[n.Layer21=2097152]="Layer21",n[n.Layer22=4194304]="Layer22",n[n.Layer23=8388608]="Layer23",n[n.Layer24=16777216]="Layer24",n[n.Layer25=33554432]="Layer25",n[n.Layer26=67108864]="Layer26",n[n.Layer27=134217728]="Layer27",n[n.Layer28=268435456]="Layer28",n[n.Layer29=536870912]="Layer29",n[n.Layer30=1073741824]="Layer30",n[n.Layer31=2147483648]="Layer31",n[n.Everything=4294967295]="Everything"})(Oo||(Oo={}));var Be;(function(n){n[n.texture=1]="texture",n[n.size=2]="size",n[n.atlasRotate=4]="atlasRotate",n[n.atlasRegion=8]="atlasRegion",n[n.atlasRegionOffset=16]="atlasRegionOffset",n[n.region=32]="region",n[n.pivot=64]="pivot",n[n.border=128]="border",n[n.destroy=256]="destroy"})(Be||(Be={}));var an=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e.influenceLayers=Oo.Everything,e._sprite=null,e._automaticWidth=0,e._automaticHeight=0,e._customWidth=void 0,e._customHeight=void 0,e._flipX=!1,e._flipY=!1,e._alphaCutoff=.5,e._verticesData=new Bf(4,[],[]),fi.resetData(fe(e)),e.setMaterial(e._engine._spriteMaskDefaultMaterial),e.shaderData.setFloat(i._alphaCutoffProperty,e._alphaCutoff),e._onSpriteChange=e._onSpriteChange.bind(fe(e)),e}var a=i.prototype;return a._cloneTo=function(e,r,o){n.prototype._cloneTo.call(this,e,r,o),e.sprite=this._sprite},a._updateBounds=function(e){this.sprite?fi.updatePositions(this):(e.min.set(0,0,0),e.max.set(0,0,0))},a._render=function(e){var r;if(!(!((r=this.sprite)!=null&&r.texture)||!this.width||!this.height)){this._dirtyUpdateFlag&pt.WorldVolume&&(fi.updatePositions(this),this._dirtyUpdateFlag&=~pt.WorldVolume),this._dirtyUpdateFlag&2&&(fi.updateUVs(this),this._dirtyUpdateFlag&=-3),e.camera._renderPipeline._allSpriteMasks.add(this);var o=this._engine._spriteMaskRenderDataPool.getFromPool(),s=this.getMaterial();o.set(this,s,this._verticesData);var l=this._engine._renderElementPool.getFromPool();l.set(o,s.shader.subShaders[0].passes),this._maskElement=l}},a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._sprite;e&&(e._addReferCount(-1),e._updateFlagManager.removeListener(this._onSpriteChange)),this._entity=null,this._sprite=null,this._verticesData=null},a._calDefaultSize=function(){var e=this._sprite;e?(this._automaticWidth=e.width,this._automaticHeight=e.height):this._automaticWidth=this._automaticHeight=0,this._dirtyUpdateFlag&=-5},a._onSpriteChange=function(e){switch(e){case Be.texture:this.shaderData.setTexture(i._textureProperty,this.sprite.texture);break;case Be.size:this._dirtyUpdateFlag|=4,(this._customWidth===void 0||this._customHeight===void 0)&&(this._dirtyUpdateFlag|=pt.WorldVolume);break;case Be.region:case Be.atlasRegionOffset:this._dirtyUpdateFlag|=3;break;case Be.atlasRegion:this._dirtyUpdateFlag|=2;break;case Be.pivot:this._dirtyUpdateFlag|=pt.WorldVolume;break;case Be.destroy:this.sprite=null;break}},q(i,[{key:"width",get:function(){return this._customWidth!==void 0?this._customWidth:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticWidth)},set:function(e){this._customWidth!==e&&(this._customWidth=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"height",get:function(){return this._customHeight!==void 0?this._customHeight:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticHeight)},set:function(e){this._customHeight!==e&&(this._customHeight=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"sprite",get:function(){return this._sprite},set:function(e){var r=this._sprite;r!==e&&(r&&(r._addReferCount(-1),r._updateFlagManager.removeListener(this._onSpriteChange)),this._dirtyUpdateFlag|=7,e?(e._addReferCount(1),e._updateFlagManager.addListener(this._onSpriteChange),this.shaderData.setTexture(i._textureProperty,e.texture)):this.shaderData.setTexture(i._textureProperty,null),this._sprite=e)}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(i._alphaCutoffProperty,e))}}]),i}(Ce);(function(){an._textureProperty=U.getByName("renderer_MaskTexture")})();(function(){an._alphaCutoffProperty=U.getByName("renderer_MaskAlphaCutoff")})();P([Ie],an.prototype,"influenceLayers",void 0);P([z],an.prototype,"_sprite",void 0);P([z],an.prototype,"_automaticWidth",void 0);P([z],an.prototype,"_automaticHeight",void 0);P([Ie],an.prototype,"_customWidth",void 0);P([Ie],an.prototype,"_customHeight",void 0);P([Ie],an.prototype,"_flipX",void 0);P([Ie],an.prototype,"_flipY",void 0);P([Ie],an.prototype,"_alphaCutoff",void 0);P([z],an.prototype,"_onSpriteChange",null);var sv;(function(n){n[n.UV=2]="UV",n[n.RenderData=3]="RenderData",n[n.AutomaticSize=4]="AutomaticSize",n[n.All=7]="All"})(sv||(sv={}));var ie;(function(n){n[n.Float=0]="Float",n[n.Vector2=1]="Vector2",n[n.Vector3=2]="Vector3",n[n.Vector4=3]="Vector4",n[n.Byte4=4]="Byte4",n[n.UByte4=5]="UByte4",n[n.NormalizedByte4=6]="NormalizedByte4",n[n.NormalizedUByte4=7]="NormalizedUByte4",n[n.Short2=8]="Short2",n[n.UShort2=9]="UShort2",n[n.NormalizedShort2=10]="NormalizedShort2",n[n.NormalizedUShort2=11]="NormalizedUShort2",n[n.Short4=12]="Short4",n[n.UShort4=13]="UShort4",n[n.NormalizedShort4=14]="NormalizedShort4",n[n.NormalizedUShort4=15]="NormalizedUShort4"})(ie||(ie={}));var Ht;(function(n){n[n.UInt8=0]="UInt8",n[n.UInt16=1]="UInt16",n[n.UInt32=2]="UInt32"})(Ht||(Ht={}));var Vu=function(){function n(){}return n._getGLIndexType=function(a){switch(a){case Ht.UInt8:return We.UNSIGNED_BYTE;case Ht.UInt16:return We.UNSIGNED_SHORT;case Ht.UInt32:return We.UNSIGNED_INT}},n._getGLIndexByteCount=function(a){switch(a){case Ht.UInt8:return 1;case Ht.UInt16:return 2;case Ht.UInt32:return 4}},n._getElementInfo=function(a){var t,e,r=!1,o;switch(a){case ie.Float:t=1,e=We.FLOAT;break;case ie.Vector2:t=2,e=We.FLOAT;break;case ie.Vector3:t=3,e=We.FLOAT;break;case ie.Vector4:t=4,e=We.FLOAT;break;case ie.Byte4:t=4,e=We.BYTE;break;case ie.UByte4:t=4,e=We.UNSIGNED_BYTE;break;case ie.NormalizedByte4:t=4,e=We.BYTE,r=!0,o=1/127;break;case ie.NormalizedUByte4:t=4,e=We.UNSIGNED_BYTE,r=!0,o=1/255;break;case ie.Short2:t=2,e=We.SHORT;break;case ie.UShort2:t=2,e=We.UNSIGNED_SHORT;break;case ie.NormalizedShort2:t=2,e=We.SHORT,r=!0,o=1/32767;break;case ie.NormalizedUShort2:t=2,e=We.UNSIGNED_SHORT,r=!0,o=1/65535;break;case ie.Short4:t=4,e=We.SHORT;break;case ie.UShort4:t=4,e=We.UNSIGNED_SHORT;break;case ie.NormalizedShort4:t=4,e=We.SHORT,r=!0,o=1/32767;break;case ie.NormalizedUShort4:t=4,e=We.UNSIGNED_SHORT,r=!0,o=1/65535;break}return{size:t,type:e,normalized:r,normalizedScaleFactor:o}},n}(),Le=function(){function n(i,a,t,e,r){r===void 0&&(r=0),this._attributeName=i,this._offset=a,this._format=t,this._bindingIndex=e,this._formatMetaInfo=Vu._getElementInfo(this.format),this._instanceStepRate=Math.floor(r)}return q(n,[{key:"attribute",get:function(){return this._attributeName}},{key:"offset",get:function(){return this._offset},set:function(a){this._offset=a}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex},set:function(a){this._bindingIndex=a}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}},{key:"semantic",get:function(){return this.attribute}}]),n}(),mt;(function(n){n[n.Static=0]="Static",n[n.Dynamic=1]="Dynamic",n[n.Stream=2]="Stream"})(mt||(mt={}));var Ua;(function(n){n[n.None=0]="None",n[n.Discard=1]="Discard"})(Ua||(Ua={}));var qn=function(n){W(i,n);function i(t,e,r,o,s){o===void 0&&(o=mt.Static),s===void 0&&(s=!1);var l;if(l=n.call(this,t)||this,l._dataUpdateManager=new ra,l._engine=t,l._type=e,l._bufferUsage=o,l._readable=s,typeof r=="number")l._byteLength=r,l._platformBuffer=t._hardwareRenderer.createPlatformBuffer(e,r,o),s&&(l._data=new Uint8Array(r));else{var u=r,c=u.byteLength;if(l._byteLength=c,l._platformBuffer=t._hardwareRenderer.createPlatformBuffer(e,c,o,u),s){var d=(u.constructor===ArrayBuffer?u:u.buffer).slice(0,c);l._data=new Uint8Array(d)}}return l}var a=i.prototype;return a.bind=function(){this._platformBuffer.bind()},a.setData=function(e,r,o,s,l){if(r===void 0&&(r=0),o===void 0&&(o=0),l===void 0&&(l=Ua.None),this._platformBuffer.setData(this._byteLength,e,r,o,s,l),this._readable){var u=e.constructor===ArrayBuffer?e:e.buffer;if(this._data.buffer!==u){var c=e.BYTES_PER_ELEMENT||1,d=s?c*s:e.byteLength,_=e.byteOffset!==void 0,f=_?e.byteOffset+o*c:o,v=new Uint8Array(u,f,d);this._data.set(v,r)}}this._isContentLost=!1,this._dataUpdateManager.dispatch()},a.getData=function(e,r,o,s){r===void 0&&(r=0),o===void 0&&(o=0),this._platformBuffer.getData(e,r,o,s)},a.markAsUnreadable=function(){this._data=null,this._readable=!1},a._rebuild=function(){var e=this._engine._hardwareRenderer.createPlatformBuffer(this._type,this._byteLength,this._bufferUsage);this._platformBuffer=e},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._platformBuffer.destroy()},q(i,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}},{key:"readable",get:function(){return this._readable}},{key:"data",get:function(){if(this._readable)return this._data;throw"Buffer is not readable."}}]),i}(mc),vn;(function(n){n[n.VertexBuffer=0]="VertexBuffer",n[n.IndexBuffer=1]="IndexBuffer"})(vn||(vn={}));var ia;(function(n){n[n.Points=0]="Points",n[n.Lines=1]="Lines",n[n.LineLoop=2]="LineLoop",n[n.LineStrip=3]="LineStrip",n[n.Triangles=4]="Triangles",n[n.TriangleStrip=5]="TriangleStrip",n[n.TriangleFan=6]="TriangleFan"})(ia||(ia={}));var Xs=function(){function n(i,a){this._buffer=i,this._format=a}return q(n,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),n}(),Cc=function(){function n(a,t,e){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=ia.Triangles),this.start=a,this.count=t,this.topology=e}var i=n.prototype;return i.dispose=function(){},n}(),bf=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e.enableVAO=!0,e.instanceCount=0,e.vertexBufferBindings=[],e._vertexElementMap={},e._bufferStructChanged=!1,e._vertexElements=[],e._platformPrimitive=t._hardwareRenderer.createPlatformPrimitive(fe(e)),e}var a=i.prototype;return a.addVertexElement=function(e){var r=this._vertexElementMap,o=this._vertexElements,s=e.attribute,l=r[s];l&&(console.warn("VertexElement "+s+" already exists."),o.splice(o.indexOf(l),1)),r[s]=e,o.push(e),this._bufferStructChanged=!0},a.removeVertexElement=function(e){var r=this._vertexElements,o=r[e];r.splice(e,1),delete this._vertexElementMap[o.attribute],this._bufferStructChanged=!0},a.clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var r in e)delete e[r];this._bufferStructChanged=!0},a.setVertexElement=function(e,r){var o=this._vertexElementMap,s=this._vertexElements,l=s[e];l&&delete o[l.attribute],o[r.attribute]=r,s[e]=r,this._bufferStructChanged=!0},a.setVertexElementsLength=function(e){for(var r=this._vertexElementMap,o=this._vertexElements,s=e,l=o.length;s<l;s++){var u=o[s];delete r[u.attribute]}o.length=e},a.setVertexBufferBinding=function(e,r){var o=this._getReferCount(),s=this.vertexBufferBindings;if(o>0){var l,u;(l=s[e])==null||l.buffer._addReferCount(-o),(u=r)==null||u.buffer._addReferCount(o)}s[e]=r,this._bufferStructChanged=!0},a.setVertexBufferBindings=function(e,r){r===void 0&&(r=0);var o=this.vertexBufferBindings,s=e.length,l=r+s;o.length<l&&(o.length=l);for(var u=0;u<s;u++)this.setVertexBufferBinding(r+u,e[u])},a.setIndexBufferBinding=function(e){var r=this.indexBufferBinding,o=this._getReferCount();if(r!==e){var s,l,u;this._indexBufferBinding=e,o>0&&((s=r)==null||s.buffer._addReferCount(-o)),e?(o>0&&e.buffer._addReferCount(o),this._glIndexType=Vu._getGLIndexType(e.format),this._glIndexByteCount=Vu._getGLIndexByteCount(e.format)):this._glIndexType=void 0,this._bufferStructChanged=((l=r)==null?void 0:l.buffer)!==((u=e)==null?void 0:u.buffer)}},a.draw=function(e,r){this._platformPrimitive.draw(e,r),this._bufferStructChanged=!1},a._addReferCount=function(e){var r;n.prototype._addReferCount.call(this,e);for(var o=this.vertexBufferBindings,s=0,l=o.length;s<l;s++){var u;(u=o[s])==null||u.buffer._addReferCount(e)}(r=this.indexBufferBinding)==null||r._buffer._addReferCount(e)},a._rebuild=function(){this._engine._hardwareRenderer.createPlatformPrimitive(this),this._isContentLost=!1},a._onDestroy=function(){this._platformPrimitive.destroy(),this._vertexElementMap=null},q(i,[{key:"vertexElements",get:function(){return this._vertexElements}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}}]),i}(mc),Df=function(n){W(i,n);function i(t,e){var r;r=n.call(this,t)||this,r._updateFlagManager=new ra,r._bounds=new jt,r._subMeshes=[],r.name=e,r._primitive=new bf(t),r._onBoundsChanged=r._onBoundsChanged.bind(fe(r));var o=r._bounds;return o.min._onValueChanged=r._onBoundsChanged,o.max._onValueChanged=r._onBoundsChanged,r}var a=i.prototype;return a.addSubMesh=function(e,r,o){return o===void 0&&(o=ia.Triangles),typeof e=="number"&&(e=new Cc(e,r,o)),this._subMeshes.push(e),e},a.removeSubMesh=function(e){var r=this._subMeshes,o=r.indexOf(e);o!==-1&&r.splice(o,1)},a.clearSubMesh=function(){this._subMeshes.length=0},a._clearVertexElements=function(){this._primitive.clearVertexElements(),this._updateFlagManager.dispatch(2)},a._addVertexElement=function(e){this._primitive.addVertexElement(e),this._updateFlagManager.dispatch(2)},a._removeVertexElement=function(e){this._primitive.removeVertexElement(e),this._updateFlagManager.dispatch(2)},a._setVertexElement=function(e,r){this._primitive.setVertexElement(e,r),this._updateFlagManager.dispatch(2)},a._setVertexElementsLength=function(e){this._primitive.setVertexElementsLength(e)},a._setVertexBufferBinding=function(e,r){this._primitive.setVertexBufferBinding(e,r)},a._addReferCount=function(e){n.prototype._addReferCount.call(this,e),this._primitive._addReferCount(e)},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._primitive.destroy()},a._setVertexElements=function(e){this._clearVertexElements();for(var r=0,o=e.length;r<o;r++)this._addVertexElement(e[r])},a._setIndexBufferBinding=function(e){this._primitive.setIndexBufferBinding(e)},a._onBoundsChanged=function(){this._updateFlagManager.dispatch(1)},q(i,[{key:"bounds",get:function(){return this._bounds},set:function(e){this._bounds!==e&&this._bounds.copyFrom(e)}},{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),i}(ni),Nu;(function(n){n[n.Bounds=1]="Bounds",n[n.VertexElements=2]="VertexElements"})(Nu||(Nu={}));var ka=function(){function n(i,a){this._buffer=i,this._stride=a}return q(n,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),n}(),nm=function(){function n(a,t,e,r){if(e===void 0&&(e=null),r===void 0&&(r=null),this._dataChangeManager=new ra,this._dirty=7,e&&e.length!==t.length)throw"deltaNormals length must same with deltaPositions length.";if(r&&r.length!==t.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=a,this._deltaPositions=t,this._deltaNormals=e,this._deltaTangents=r}var i=n.prototype;return i._releaseData=function(){this._deltaPositions=null,this._deltaNormals=null,this._deltaTangents=null},q(n,[{key:"deltaPositions",get:function(){return this._deltaPositions},set:function(t){this._deltaPositions=t,this._dirty|=1,this._dataChangeManager.dispatch(this._dirty,this)}},{key:"deltaNormals",get:function(){return this._deltaNormals},set:function(t){this._deltaNormals=t,this._dirty|=2,this._dataChangeManager.dispatch(this._dirty,this)}},{key:"deltaTangents",get:function(){return this._deltaTangents},set:function(t){this._deltaTangents=t,this._dirty|=4,this._dataChangeManager.dispatch(this._dirty,this)}}]),n}(),u_;(function(n){n[n.Position=1]="Position",n[n.Normal=2]="Normal",n[n.Tangent=4]="Tangent",n[n.All=7]="All"})(u_||(u_={}));var Lf=function(){function n(a){this._useBlendShapeNormal=!0,this._useBlendShapeTangent=!0,this._layoutChangeManager=new ra,this._dataChangeManager=new ra,this._frames=[],this.name=a,this._frameDataChangeListener=this._frameDataChangeListener.bind(this)}var i=n.prototype;return i.addFrame=function(t,e,r,o){if(typeof t=="number"){var s=new nm(t,e,r,o);return this._addFrame(s),s}else this._addFrame(t)},i.clearFrames=function(){for(var t=this._frames,e=0,r=t.length;e<r;e++)t[e]._dataChangeManager.removeListener(this._frameDataChangeListener);t.length=0,this._updateUseNormalAndTangent(!0,!0),this._dataChangeManager.dispatch()},i._releaseData=function(){for(var t=this._frames,e=0,r=t.length;e<r;e++)t[e]._releaseData()},i._addFrame=function(t){var e=this._frames,r=e.length;if(r>0&&t.deltaPositions.length!==e[r-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._frames.push(t),this._frameDataChangeListener(u_.All,t),t._dataChangeManager.addListener(this._frameDataChangeListener)},i._updateUseNormalAndTangent=function(t,e){var r=this._useBlendShapeNormal&&t,o=this._useBlendShapeTangent&&e;(this._useBlendShapeNormal!==r||this._useBlendShapeTangent!==o)&&(this._useBlendShapeNormal=r,this._useBlendShapeTangent=o,this._layoutChangeManager.dispatch(0,this))},i._frameDataChangeListener=function(t,e){this._updateUseNormalAndTangent(!!e.deltaNormals,!!e.deltaTangents),this._dataChangeManager.dispatch()},q(n,[{key:"frames",get:function(){return this._frames}}]),n}(),If=function(n){W(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.setVertexElements=function(e){this._setVertexElements(e)},a.setVertexBufferBinding=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new ka(e,r));var u=this._primitive.vertexBufferBindings;u.length<=o&&(u.length=o+1),this._setVertexBufferBinding(l?r:o,s)},a.setVertexBufferBindings=function(e,r){r===void 0&&(r=0);var o=this._primitive.vertexBufferBindings,s=e.length,l=r+s;o.length<l&&(o.length=l);for(var u=0;u<s;u++)this._setVertexBufferBinding(r+u,e[u])},a.setIndexBufferBinding=function(e,r){var o=e;if(o){var s=o.buffer!==void 0;s||(o=new Xs(e,r))}this._setIndexBufferBinding(o)},q(i,[{key:"instanceCount",get:function(){return this._primitive.instanceCount},set:function(e){this._primitive.instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._primitive.vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._primitive.indexBufferBinding}},{key:"vertexElements",get:function(){return this._primitive.vertexElements}}]),i}(Df),en=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._enableVertexColor=!1,e._onMeshChanged=e._onMeshChanged.bind(fe(e)),e}var a=i.prototype;return a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._mesh;e&&(e.destroyed||e._addReferCount(-1),e._updateFlagManager.removeListener(this._onMeshChanged),this._mesh=null)},a._cloneTo=function(e,r,o){n.prototype._cloneTo.call(this,e,r,o),e.mesh=this._mesh},a._prepareRender=function(e){if(!this._mesh){ve.error("mesh is null.");return}if(this._mesh.destroyed){ve.error("mesh is destroyed.");return}n.prototype._prepareRender.call(this,e)},a._updateBounds=function(e){var r=this._mesh;if(r){var o=r.bounds,s=this._entity.transform.worldMatrix;jt.transform(o,s,e)}else e.min.set(0,0,0),e.max.set(0,0,0)},a._render=function(e){var r=this._mesh;if(this._dirtyUpdateFlag&2){var o=this.shaderData,s=r._primitive.vertexElements;o.disableMacro(i._uvMacro),o.disableMacro(i._uv1Macro),o.disableMacro(i._normalMacro),o.disableMacro(i._tangentMacro),o.disableMacro(i._enableVertexColorMacro);for(var l=0,u=s.length;l<u;l++)switch(s[l].attribute){case"TEXCOORD_0":o.enableMacro(i._uvMacro);break;case"TEXCOORD_1":o.enableMacro(i._uv1Macro);break;case"NORMAL":o.enableMacro(i._normalMacro);break;case"TANGENT":o.enableMacro(i._tangentMacro);break;case"COLOR_0":this._enableVertexColor&&o.enableMacro(i._enableVertexColorMacro);break}this._dirtyUpdateFlag&=-3}for(var c=this._materials,d=r.subMeshes,_=e.camera._renderPipeline,f=this._engine._renderDataPool,v=0,p=d.length;v<p;v++){var g=c[v];if(g){g.destroyed&&(g=this.engine._meshMagentaMaterial);var m=f.getFromPool();m.setX(this,g,r._primitive,d[v]),_.pushRenderData(e,m)}}},a._setMesh=function(e){var r=this._mesh;r&&(r._addReferCount(-1),r._updateFlagManager.removeListener(this._onMeshChanged)),e&&(e._addReferCount(1),e._updateFlagManager.addListener(this._onMeshChanged),this._dirtyUpdateFlag|=3),this._mesh=e},a._onMeshChanged=function(e){e&Nu.Bounds&&(this._dirtyUpdateFlag|=pt.WorldVolume),e&Nu.VertexElements&&(this._dirtyUpdateFlag|=2)},q(i,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&this._setMesh(e)}},{key:"enableVertexColor",get:function(){return this._enableVertexColor},set:function(e){e!==this._enableVertexColor&&(this._dirtyUpdateFlag|=2,this._enableVertexColor=e)}}]),i}(Ce);(function(){en._uvMacro=oe.getByName("RENDERER_HAS_UV")})();(function(){en._uv1Macro=oe.getByName("RENDERER_HAS_UV1")})();(function(){en._normalMacro=oe.getByName("RENDERER_HAS_NORMAL")})();(function(){en._tangentMacro=oe.getByName("RENDERER_HAS_TANGENT")})();(function(){en._enableVertexColorMacro=oe.getByName("RENDERER_ENABLE_VERTEXCOLOR")})();P([z],en.prototype,"_mesh",void 0);P([z],en.prototype,"_onMeshChanged",null);var lv;(function(n){n[n.VertexElementMacro=2]="VertexElementMacro",n[n.All=3]="All"})(lv||(lv={}));var ca=function(){function n(a,t){this._blendShapeCount=0,this._blendShapes=[],this._subDataDirtyFlags=[],this._vertexBuffers=[],this._uniformOccupiesCount=0,this._bufferBindingOffset=-1,this._vertexElementOffset=0,this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._storeInVertexBufferInfo=[],this._maxCountSingleVertexBuffer=0,this._lastHostCreatedInfo=new ue,this._canUseTextureStoreData=!0,this._dataTextureInfo=new M,this._engine=a,this._modelMesh=t,this._canUseTextureStoreData=this._engine._hardwareRenderer.capability.canUseFloatTextureBlendShape,this._updateLayoutChange=this._updateLayoutChange.bind(this)}var i=n.prototype;return i._addBlendShape=function(t){this._blendShapes.push(t),this._blendShapeCount++,t._layoutChangeManager.addListener(this._updateLayoutChange),this._updateLayoutChange(0,t),this._subDataDirtyFlags.push(t._dataChangeManager.createFlag(Ac))},i._clearBlendShapes=function(){for(var t=this._blendShapes,e=0,r=t.length;e<r;e++)t[e]._layoutChangeManager.removeListener(this._updateLayoutChange);this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._blendShapes.length=0,this._blendShapeCount=0;for(var o=this._subDataDirtyFlags,s=0,l=o.length;s<l;s++)o[s].destroy();o.length=0},i._updateShaderData=function(t,e){var r=this._blendShapeCount;if(r>0){if(t.enableMacro(n._blendShapeMacro),this._useTextureMode())t.enableMacro(n._blendShapeTextureMacro),t.setTexture(n._blendShapeTextureProperty,this._vertexTexture),t.setVector3(n._blendShapeTextureInfoProperty,this._dataTextureInfo),t.setFloatArray(n._blendShapeWeightsProperty,e.blendShapeWeights),t.enableMacro("RENDERER_BLENDSHAPE_COUNT",r.toString()),this._uniformOccupiesCount=r+1;else{var o=this._getVertexBufferModeSupportCount();if(r>o){var s=e._condensedBlendShapeWeights;s||(s=new Float32Array(o),e._condensedBlendShapeWeights=s),this._filterCondensedBlendShapeWeights(e.blendShapeWeights,s),t.setFloatArray(n._blendShapeWeightsProperty,s),this._modelMesh._primitive.enableVAO=!1,r=o}else t.setFloatArray(n._blendShapeWeightsProperty,e.blendShapeWeights),this._modelMesh._primitive.enableVAO=!0;t.disableMacro(n._blendShapeTextureMacro),t.disableMacro("RENDERER_BLENDSHAPE_COUNT"),this._uniformOccupiesCount=r}this._useBlendNormal?t.enableMacro(n._blendShapeNormalMacro):t.disableMacro(n._blendShapeNormalMacro),this._useBlendTangent?t.enableMacro(n._blendShapeTangentMacro):t.disableMacro(n._blendShapeTangentMacro)}else t.disableMacro(n._blendShapeMacro),t.disableMacro("RENDERER_BLENDSHAPE_COUNT")},i._useTextureMode=function(){return this._canUseTextureStoreData?this._blendShapeCount>this._getVertexBufferModeSupportCount():!1},i._isCreateHost=function(t){var e=this._lastHostCreatedInfo;return e.x!==this._blendShapeCount||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent||e.w!==t},i._vertexElementsNeedUpdate=function(){var t=this._getVertexBufferModeSupportCount(),e=this._lastHostCreatedInfo;return Math.min(e.x,t)!==Math.min(this._blendShapeCount,t)||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent},i._needUpdateData=function(){for(var t=this._subDataDirtyFlags,e=0,r=t.length;e<r;e++)if(t[e].flag)return!0;return!1},i._updateVertexBufferIndex=function(){if(this._bufferBindingOffset===-1){for(var t=this._modelMesh,e=t._internalVertexBufferIndex,r=t._primitive.vertexBufferBindings,o=0,s=Math.max(r.length,e+1);o<s&&!(!r[o]&&o!==e);o++);this._bufferBindingOffset=o}},i._addVertexElements=function(t){this._updateVertexBufferIndex();for(var e=this._vertexElementOffset,r=this._bufferBindingOffset,o=0,s=0,l=Math.min(this._blendShapeCount,this._getVertexBufferModeSupportCount());s<l;s++)t._setVertexElement(e++,new Le("POSITION_BS"+s,o,ie.Vector3,r)),o+=12,this._useBlendNormal&&(t._setVertexElement(e++,new Le("NORMAL_BS"+s,o,ie.Vector3,r)),o+=12),this._useBlendTangent&&(t._setVertexElement(e++,new Le("TANGENT_BS"+s,o,ie.Vector3,r)),o+=12);return e},i._update=function(t){var e=this._modelMesh.vertexCount,r=this._useTextureMode(),o=this._isCreateHost(e);o&&(r?this._createTextureArray(e):this._createVertexBuffers(e,t),this._lastHostCreatedInfo.set(this._blendShapeCount,+this._useBlendNormal,+this._useBlendTangent,e)),this._needUpdateData()&&(r?this._updateTextureArray(e,o):this._updateVertexBuffers(e,o))},i._releaseMemoryCache=function(){for(var t=this._blendShapes,e=0,r=t.length;e<r;e++)t[e]._releaseData();this._vertices=null},i._createVertexBuffers=function(t,e){var r=this,o=r._engine,s=r._modelMesh,l=r._blendShapeCount,u=r._vertexBuffers,c=this._vertexElementCount*3,d=c*4,_=Math.floor(255/d),f=Math.ceil(l/_),v=c*t*Math.min(_,l);u.length=f,this._vertices=new Float32Array(v),this._maxCountSingleVertexBuffer=_,this._storeInVertexBufferInfo.length=l;for(var p=this._bufferBindingOffset,g=0;g<f;g++){var m=f-1,h=g===m?l-m*_:_,y=h*d,A=y*t,S=e?mt.Static:mt.Dynamic,x=new qn(o,vn.VertexBuffer,A,S);s._setVertexBufferBinding(p+g,new ka(x,y)),u[g]=x}},i._createTextureArray=function(t){var e=this._engine._hardwareRenderer.capability.maxTextureSize,r=this._vertexElementCount,o=r*t,s=1;o>e&&(s=Math.ceil(o/e),o=e);var l=this._vertexTexture,u=this._blendShapes.length;l&&l.destroy(),l=new Mf(this._engine,o,s,u,X.R32G32B32A32,!1),l.filterMode=tn.Point,this._vertices=new Float32Array(u*o*s*4),this._vertexTexture=l,this._dataTextureInfo.set(r,o,s)},i._updateVertexBuffers=function(t,e){for(var r=this,o=r._blendShapes,s=r._maxCountSingleVertexBuffer,l=this,u=l._vertices,c=l._vertexBuffers,d=l._storeInVertexBufferInfo,_=this._subDataDirtyFlags,f=this._vertexElementCount*3,v=f*4,p=this._bufferBindingOffset,g=0,m=o.length;g<m;g++){var h=_[g];if(e||h.flag){var y=o[g].frames,A=y.length,S=y[A-1];if(A>0&&S.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";var x=Math.floor(g/s),C=g%s,E=c[x],T=E.byteLength/(t*4),w=C*f,R=d[g];R||(d[g]=R=new te),R.set(p+x,C*v);for(var b=S.deltaPositions,B=0;B<t;B++){var I=w+T*B,V=b[B];V&&(u[I]=V.x,u[I+1]=V.y,u[I+2]=V.z)}if(w+=3,this._useBlendNormal){var L=S.deltaNormals;if(L)for(var F=0;F<t;F++){var D=w+T*F,N=L[F];N&&(u[D]=N.x,u[D+1]=N.y,u[D+2]=N.z)}w+=3}if(this._useBlendTangent){var O=S.deltaTangents;if(O)for(var k=0;k<t;k++){var Q=w+T*k,H=O[k];H&&(u[Q]=H.x,u[Q+1]=H.y,u[Q+2]=H.z)}w+=3}(C===s-1||g===m-1)&&E.setData(u,0,0,E.byteLength/4),h.flag=!1}}},i._updateTextureArray=function(t,e){for(var r=this,o=r._blendShapes,s=r._vertexTexture,l=r._vertices,u=r._subDataDirtyFlags,c=0,d=o.length;c<d;c++){var _=u[c],f=s.width*s.height*4;if(e||_.flag){var v=o[c].frames,p=v.length,g=v[p-1];if(p>0&&g.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var m=g.deltaPositions,h=g.deltaNormals,y=g.deltaTangents,A=c*f,S=0;S<t;S++){var x=m[S];if(l[A]=x.x,l[A+1]=x.y,l[A+2]=x.z,A+=4,h){var C=h[S];l[A]=C.x,l[A+1]=C.y,l[A+2]=C.z,A+=4}if(y){var E=y[S];l[A]=E.x,l[A+1]=E.y,l[A+2]=E.z,A+=4}}_.flag=!1}}s.setPixelBuffer(0,l)},i._updateLayoutChange=function(t,e){var r=this._blendShapeCount>1,o=1,s=e._useBlendShapeNormal,l=e._useBlendShapeTangent;r&&(s&&(s=this._useBlendNormal),l&&(l=this._useBlendTangent)),s&&o++,l&&o++,this._useBlendNormal=s,this._useBlendTangent=l,this._vertexElementCount=o},i._attributeModeUpdateVertexElement=function(t,e,r,o){var s=this._vertexElementOffset+this._vertexElementCount*o,l=e[r],u=l.x,c=l.y,d=t[s];if(d.bindingIndex=u,d.offset=c,this._useBlendNormal){var _=t[++s];c+=12,_.bindingIndex=u,_.offset=c}if(this._useBlendTangent){var f=t[++s];c+=12,f.bindingIndex=u,f.offset=c}},i._getVertexBufferModeSupportCount=function(){return this._useBlendNormal&&this._useBlendTangent?2:this._useBlendNormal||this._useBlendTangent?4:8},i._filterCondensedBlendShapeWeights=function(t,e){for(var r=e.length,o=this._modelMesh._primitive.vertexElements,s=this._storeInVertexBufferInfo,l=Number.POSITIVE_INFINITY,u,c=0,d=Math.min(t.length,this._blendShapeCount);c<d;c++){var _=t[c];if(c<r)this._attributeModeUpdateVertexElement(o,s,c,c),e[c]=_,_<l&&(l=_,u=c);else if(_>l){this._attributeModeUpdateVertexElement(o,s,c,u),e[u]=_,l=Number.POSITIVE_INFINITY;for(var f=0;f<r;f++){var v=e[f];v<l&&(l=v,u=f)}}}},n}();(function(){ca._blendShapeMacro=oe.getByName("RENDERER_HAS_BLENDSHAPE")})();(function(){ca._blendShapeTextureMacro=oe.getByName("RENDERER_BLENDSHAPE_USE_TEXTURE")})();(function(){ca._blendShapeNormalMacro=oe.getByName("RENDERER_BLENDSHAPE_HAS_NORMAL")})();(function(){ca._blendShapeTangentMacro=oe.getByName("RENDERER_BLENDSHAPE_HAS_TANGENT")})();(function(){ca._blendShapeWeightsProperty=U.getByName("renderer_BlendShapeWeights")})();(function(){ca._blendShapeTextureProperty=U.getByName("renderer_BlendShapeTexture")})();(function(){ca._blendShapeTextureInfoProperty=U.getByName("renderer_BlendShapeTextureInfo")})();var j;(function(n){n.Position="POSITION",n.Normal="NORMAL",n.Color="COLOR_0",n.Tangent="TANGENT",n.BoneWeight="WEIGHTS_0",n.BoneIndex="JOINTS_0",n.UV="TEXCOORD_0",n.UV1="TEXCOORD_1",n.UV2="TEXCOORD_2",n.UV3="TEXCOORD_3",n.UV4="TEXCOORD_4",n.UV5="TEXCOORD_5",n.UV6="TEXCOORD_6",n.UV7="TEXCOORD_7"})(j||(j={}));var Nt=function(n){W(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r._internalVertexBufferIndex=-1,r._vertexCount=0,r._vertexCountDirty=!1,r._dataVersionCounter=0,r._positions=null,r._normals=null,r._colors=null,r._tangents=null,r._uv=null,r._uv1=null,r._uv2=null,r._uv3=null,r._uv4=null,r._uv5=null,r._uv6=null,r._uv7=null,r._boneWeights=null,r._boneIndices=null,r._advancedElementUpdateFlag=0,r._advancedDataUpdateFlag=0,r._advancedVertexDataVersions=new Array(14),r._advancedDataSyncToBuffer=!1,r._internalVertexBufferStride=0,r._internalVertexBufferCreatedInfo=new M(0,0,-1),r._internalVertexElementsOffset=0,r._internalVertexElementsFlags=0,r._vertexBufferInfos=[],r._indices=null,r._indicesFormat=null,r._indicesChangeFlag=!1,r._accessible=!0,r.name=e,r._blendShapeManager=new ca(t,fe(r)),r}var a=i.prototype;return a.setPositions=function(e){var r;if(!(!this._positions&&!e)){this._updateAdvancedVertexDataMarks(1,0),this._positions=e;var o;this._vertexCount=(o=(r=e)==null?void 0:r.length)!=null?o:0,this._vertexCountDirty=!1}},a.getPositions=function(){var e=this._getVertexElementData(this._positions,j.Position,0,this._readVector3VertexData);return this._positions=e,e},a.setNormals=function(e){this._beforeSetAdvancedVertexData(e,2,1),this._normals=e},a.getNormals=function(){var e=this._getVertexElementData(this._normals,j.Normal,1,this._readVector3VertexData);return this._normals=e,e},a.setColors=function(e){this._beforeSetAdvancedVertexData(e,4,2),this._colors=e},a.getColors=function(){var e=this._getVertexElementData(this._colors,j.Color,2,this._readColorVertexData);return this._colors=e,e},a.setBoneWeights=function(e){this._beforeSetAdvancedVertexData(e,16,4),this._boneWeights=e},a.getBoneWeights=function(){var e=this._getVertexElementData(this._boneWeights,j.BoneWeight,4,this._readVector4VertexData);return this._boneWeights=e,e},a.setBoneIndices=function(e){this._beforeSetAdvancedVertexData(e,32,5),this._boneIndices=e},a.getBoneIndices=function(){var e=this._getVertexElementData(this._boneIndices,j.BoneIndex,5,this._readVector4VertexData);return this._boneIndices=e,e},a.setTangents=function(e){this._beforeSetAdvancedVertexData(e,8,3),this._tangents=e},a.getTangents=function(){var e=this._getVertexElementData(this._tangents,j.Tangent,3,this._readVector4VertexData);return this._tangents=e,e},a.setUVs=function(e,r){switch(r=r??0,r){case 0:this._beforeSetAdvancedVertexData(e,64,6),this._uv=e;break;case 1:this._beforeSetAdvancedVertexData(e,128,7),this._uv1=e;break;case 2:this._beforeSetAdvancedVertexData(e,256,8),this._uv2=e;break;case 3:this._beforeSetAdvancedVertexData(e,512,9),this._uv3=e;break;case 4:this._beforeSetAdvancedVertexData(e,1024,10),this._uv4=e;break;case 5:this._beforeSetAdvancedVertexData(e,2048,11),this._uv5=e;break;case 6:this._beforeSetAdvancedVertexData(e,4096,12),this._uv6=e;break;case 7:this._beforeSetAdvancedVertexData(e,8192,13),this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},a.getUVs=function(e){switch(e=e??0,e){case 0:var r=this._getVertexElementData(this._uv,j.UV,6,this._readVector2VertexData);return this._uv=r,r;case 1:var o=this._getVertexElementData(this._uv1,j.UV1,7,this._readVector2VertexData);return this._uv1=o,o;case 2:var s=this._getVertexElementData(this._uv2,j.UV2,8,this._readVector2VertexData);return this._uv2=s,s;case 3:var l=this._getVertexElementData(this._uv3,j.UV3,9,this._readVector2VertexData);return this._uv3=l,l;case 4:var u=this._getVertexElementData(this._uv4,j.UV4,10,this._readVector2VertexData);return this._uv4=u,u;case 5:var c=this._getVertexElementData(this._uv5,j.UV5,11,this._readVector2VertexData);return this._uv5=c,c;case 6:var d=this._getVertexElementData(this._uv6,j.UV6,12,this._readVector2VertexData);return this._uv6=d,d;case 7:var _=this._getVertexElementData(this._uv7,j.UV7,13,this._readVector2VertexData);return this._uv7=_,_}throw"The index of channel needs to be in range [0 - 7]."},a.setIndices=function(e){this._indices!==e&&(this._indices=e,gt(e,Uint8Array)?this._indicesFormat=Ht.UInt8:gt(e,Uint16Array)?this._indicesFormat=Ht.UInt16:gt(e,Uint32Array)&&(this._indicesFormat=Ht.UInt32)),this._indicesChangeFlag=!0},a.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},a.setVertexElements=function(e){this._clearVertexElements();for(var r=e.length,o=0;o<r;o++)this._addVertexElement(e[o]);var s=this._primitive._vertexElementMap;s[j.Position]||this.setPositions(null),s[j.Normal]||this.setNormals(null),s[j.Color]||this.setColors(null),s[j.BoneWeight]||this.setBoneWeights(null),s[j.BoneIndex]||this.setBoneIndices(null),s[j.Tangent]||this.setTangents(null),s[j.UV]||this.setUVs(null,0),s[j.UV1]||this.setUVs(null,1),s[j.UV2]||this.setUVs(null,2),s[j.UV3]||this.setUVs(null,3),s[j.UV4]||this.setUVs(null,4),s[j.UV5]||this.setUVs(null,5),s[j.UV6]||this.setUVs(null,6),s[j.UV7]||this.setUVs(null,7);var l=this._internalVertexBufferCreatedInfo.z;if(l!==-1){var u;(u=this._primitive.vertexBufferBindings[l])==null||u.buffer.destroy(),this._setVertexBufferBinding(l,null),this._internalVertexBufferCreatedInfo.z=-1}this._internalVertexBufferStride=0,this._internalVertexElementsOffset=r,this._advancedElementUpdateFlag=0,this._vertexCountDirty=!0,this._blendShapeManager._bufferBindingOffset=-1,this._blendShapeManager._vertexElementOffset=r},a.setVertexBufferBinding=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new ka(e,r));var u=l?r:o,c=this._primitive.vertexBufferBindings,d=this._vertexBufferInfos,_=u+1;c.length<_&&(c.length=_,d.length=_),this._setVertexBufferBinding(u,s),u===this._internalVertexBufferIndex&&(this._internalVertexBufferIndex=-1),u===this._blendShapeManager._bufferBindingOffset&&(this._blendShapeManager._bufferBindingOffset=-1),this._vertexCountDirty=!0},a.setVertexBufferBindings=function(e,r){r===void 0&&(r=0);var o=e.length,s=this._primitive.vertexBufferBindings,l=this._vertexBufferInfos,u=r+o;s.length<u&&(s.length=u,l.length=u);for(var c=0;c<o;c++){var d=r+c;this._setVertexBufferBinding(d,e[c]),d===this._internalVertexBufferIndex&&(this._internalVertexBufferIndex=-1),d===this._blendShapeManager._bufferBindingOffset&&(this._blendShapeManager._bufferBindingOffset=-1)}this._vertexCountDirty=!0},a.getVertexElement=function(e){return this._updateVertexElements(),this._primitive._vertexElementMap[e]},a.addBlendShape=function(e){this._blendShapeManager._addBlendShape(e)},a.clearBlendShapes=function(){this._blendShapeManager._clearBlendShapes()},a.getBlendShapeName=function(e){var r=this._blendShapeManager._blendShapes;return r[e].name},a.uploadData=function(e){if(this._updateVertexElements(),this._advancedDataSyncToBuffer=!0,this._updateInternalVertexBuffer(e),this._advancedDataUpdateFlag&65535){this._updateAdvancedVertices();for(var r=this._vertexBufferInfos,o=this._primitive.vertexBufferBindings,s=0,l=o.length;s<l;s++){var u,c=r[s];if((u=c)!=null&&u.uploadAdvancedData){var d,_=(d=o[s])==null?void 0:d.buffer;_.setData(_.data),c.uploadAdvancedData=!1}}}if(this._advancedDataSyncToBuffer=!1,this._indicesChangeFlag){var f,v=this,p=v._indices,g=(f=this._primitive.indexBufferBinding)==null?void 0:f._buffer;if(p)if(!g||p.byteLength!=g.byteLength){var m;(m=g)==null||m.destroy();var h=new qn(this._engine,vn.IndexBuffer,p);this._setIndexBufferBinding(new Xs(h,this._indicesFormat))}else g.setData(p),this._primitive.indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new Xs(g,this._indicesFormat));else g&&(g.destroy(),this._setIndexBufferBinding(null));this._indicesChangeFlag=!1}var y=this._blendShapeManager;y._blendShapeCount>0&&y._update(e),e&&(this._accessible=!1,this._releaseCache(!1))},a.calculateTangents=function(){var e=this.getPositions(),r=this.getNormals(),o=this.getUVs();if(!r||!o)throw"Set normal and uv before calculation.";for(var s=this,l=s._indices,u=s.vertexCount,c=i._tempVec0,d=i._tempVec1,_=i._tempVec2,f=i._tempVec3,v=i._tempVec4,p=l?l.length/3:e.length/3,g=new Array(u),m=new Array(u),h=0;h<u;h++)g[h]=new ue,m[h]=new M;for(var y=0;y<p;y++){var A=3*y,S=3*y+1,x=3*y+2;l&&(A=l[A],S=l[S],x=l[x]);var C=e[A],E=e[S],T=e[x],w=o[A],R=o[S],b=o[x];M.subtract(E,C,c),M.subtract(T,C,d);var B=R.x-w.x,I=b.x-w.x,V=R.y-w.y,L=b.y-w.y,F=1/(B*L-I*V);M.scale(c,L*F,_),M.scale(d,V*F,v),M.subtract(_,v,_),M.scale(d,B*F,f),M.scale(c,I*F,v),M.subtract(f,v,f);var D=g[A];D.set(D.x+_.x,D.y+_.y,D.z+_.z,1),D=g[S],D.set(D.x+_.x,D.y+_.y,D.z+_.z,1),D=g[x],D.set(D.x+_.x,D.y+_.y,D.z+_.z,1),m[A].add(f),m[S].add(f),m[x].add(f)}for(var N=0;N<u;N++){var O=r[N],k=m[N],Q=g[N];_.set(Q.x,Q.y,Q.z),M.cross(_,k,v);var H=M.dot(v,O)>0?1:-1;M.scale(O,M.dot(_,O),v),M.subtract(_,v,_),_.normalize(),Q.set(_.x,_.y,_.z,H)}this.setTangents(g)},a._setVertexBufferBinding=function(e,r){var o=this,s=this._primitive.vertexBufferBindings,l=this._vertexBufferInfos,u=function(){o._advancedDataSyncToBuffer||(l[e].dataVersion=o._dataVersionCounter++)},c=s[e];if(c&&c.buffer._dataUpdateManager.removeListener(u),n.prototype._setVertexBufferBinding.call(this,e,r),r){var d,_;r.buffer._dataUpdateManager.addListener(u),((d=l)[_=e]||(d[_]=new Fx)).reset(),u()}else e+1==s.length&&s.length--},a._getVertexTypedArray=function(e,r){switch(r){case We.BYTE:return new Int8Array(e);case We.UNSIGNED_BYTE:return new Uint8Array(e);case We.SHORT:return new Int16Array(e);case We.UNSIGNED_SHORT:return new Uint16Array(e);case We.FLOAT:return new Float32Array(e)}},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._releaseCache(!0)},a._getVertexElementData=function(e,r,o,s){var l=this._advancedVertexDataVersions,u,c=(u=l[o])!=null?u:-1,d=this._primitive._vertexElementMap[r],_=d?this._vertexBufferInfos[d.bindingIndex].dataVersion:-1;return c>=_?e:(l[o]=_,s.call(this,r))},a._beforeSetAdvancedVertexData=function(e,r,o){if(e&&e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._updateAdvancedVertexDataMarks(r,o)},a._updateAdvancedVertexDataMarks=function(e,r){this._advancedElementUpdateFlag|=e,this._advancedDataUpdateFlag|=e,this._advancedVertexDataVersions[r]=this._dataVersionCounter++},a._updateInternalVertexBuffer=function(e){var r=this._internalVertexBufferStride,o=this.vertexCount,s=this._internalVertexBufferCreatedInfo,l=r*o;if(s.x*s.y!==l){var u=s.z;if(u!==-1){var c;(c=this._primitive.vertexBufferBindings[u])==null||c.buffer.destroy(),this._setVertexBufferBinding(u,null)}var d=this._internalVertexBufferIndex,_=r*this.vertexCount>0;if(_){this._advancedDataUpdateFlag|=this._internalVertexElementsFlags;var f=e?mt.Static:mt.Dynamic,v=new qn(this._engine,vn.VertexBuffer,l,f,!0);this._setVertexBufferBinding(d,new ka(v,r))}s.set(r,o,_?d:-1)}},a._readVector2VertexData=function(e){return this._readVertexData(e,function(r,o){return new te(r[o],r[o+1])})},a._readVector3VertexData=function(e){return this._readVertexData(e,function(r,o){return new M(r[o],r[o+1],r[o+2])})},a._readVector4VertexData=function(e){return this._readVertexData(e,function(r,o){return new ue(r[o],r[o+1],r[o+2],r[o+3])})},a._readColorVertexData=function(e){return this._readVertexData(e,function(r,o){return new J(r[o],r[o+1],r[o+2],r[o+3])})},a._readVertexData=function(e,r){var o,s=this._primitive,l=s._vertexElementMap[e];if(!l)return null;var u=s.vertexBufferBindings[l.bindingIndex],c=(o=u)==null?void 0:o.buffer;if(!c)return null;if(!c.readable)throw"Not allowed to access data while vertex buffer readable is false.";for(var d=this.vertexCount,_=l._formatMetaInfo,f=new Array(d),v=this._getVertexTypedArray(c.data.buffer,_.type),p=l.offset,g=u.stride,m=0;m<d;m++){var h=(m*g+p)/v.BYTES_PER_ELEMENT,y=r(v,h);_.normalized&&y.scale(_.normalizedScaleFactor),f[m]=y}return f},a._updateAdvancedVertexElement=function(e,r,o){var s=this._primitive,l=s._vertexElementMap;if(e){if(!l[r]){var u=this._getAttributeFormat(r),c=this._internalVertexBufferStride,d=this._getInternalVertexBufferIndex();this._addVertexElement(new Le(r,c,u,d)),this._internalVertexBufferStride+=this._getAttributeByteLength(r),this._internalVertexElementsFlags|=o,this._blendShapeManager._vertexElementOffset++}}else{var _=l[r];if(_){var f=this._primitive.vertexElements.indexOf(_);f>=this._internalVertexElementsOffset?(this._internalVertexBufferStride-=this._getAttributeByteLength(r),this._internalVertexElementsFlags&=~o):this._internalVertexElementsOffset--,this._blendShapeManager._vertexElementOffset--,this._removeVertexElement(f)}}},a._updateAdvancedVertexElements=function(){var e=this._advancedElementUpdateFlag;e&1&&this._updateAdvancedVertexElement(this._positions,j.Position,1),e&2&&this._updateAdvancedVertexElement(this._normals,j.Normal,2),e&4&&this._updateAdvancedVertexElement(this._colors,j.Color,4),e&16&&this._updateAdvancedVertexElement(this._boneWeights,j.BoneWeight,16),e&32&&this._updateAdvancedVertexElement(this._boneIndices,j.BoneIndex,32),e&8&&this._updateAdvancedVertexElement(this._tangents,j.Tangent,8),e&64&&this._updateAdvancedVertexElement(this._uv,j.UV,64),e&128&&this._updateAdvancedVertexElement(this._uv1,j.UV1,128),e&256&&this._updateAdvancedVertexElement(this._uv2,j.UV2,256),e&512&&this._updateAdvancedVertexElement(this._uv3,j.UV3,512),e&1024&&this._updateAdvancedVertexElement(this._uv4,j.UV4,1024),e&2048&&this._updateAdvancedVertexElement(this._uv5,j.UV5,2048),e&4096&&this._updateAdvancedVertexElement(this._uv6,j.UV6,4096),e&8192&&this._updateAdvancedVertexElement(this._uv7,j.UV7,8192)},a._updateVertexElements=function(){var e=this._primitive.vertexElements,r=this._blendShapeManager,o=e.length,s=r._vertexElementOffset;this._advancedElementUpdateFlag&65535&&(this._updateAdvancedVertexElements(),this._advancedElementUpdateFlag=0);var l=!r._useTextureMode()&&r._vertexElementsNeedUpdate();if(s!==r._vertexElementOffset||l&&r._blendShapeCount>0){var u=r._addVertexElements(this);u<o&&this._setVertexElementsLength(u)}},a._writeVector2AdvancedVertexData=function(e,r,o){this._writeAdvancedVertexData(e,r,function(s,l,u){var c=o[u];c&&(s[l]=c.x,s[l+1]=c.y)})},a._writeVector3AdvancedVertexData=function(e,r,o){this._writeAdvancedVertexData(e,r,function(s,l,u){var c=o[u];c&&(s[l]=c.x,s[l+1]=c.y,s[l+2]=c.z)})},a._writeVector4AdvancedVertexData=function(e,r,o){this._writeAdvancedVertexData(e,r,function(s,l,u){var c=o[u];c&&(s[l]=c.x,s[l+1]=c.y,s[l+2]=c.z,s[l+3]=c.w)})},a._writeColorAdvancedVertexData=function(e,r,o){this._writeAdvancedVertexData(e,r,function(s,l,u){var c=o[u];c&&(s[l]=c.r,s[l+1]=c.g,s[l+2]=c.b,s[l+3]=c.a)})},a._writeAdvancedVertexData=function(e,r,o){var s,l=this._primitive,u=l._vertexElementMap[e],c=u.bindingIndex,d=l.vertexBufferBindings[c],_=(s=d)==null?void 0:s.buffer;if(_){if(!_.readable)throw"Vertex buffer is not readable, can't write vertex data.";var f,v=(f=this._advancedVertexDataVersions[r])!=null?f:-1,p=this._vertexBufferInfos[c];if(v>p.dataVersion){for(var g=u._formatMetaInfo,m=this._getVertexTypedArray(_.data.buffer,g.type),h=u.offset,y=d.stride,A=m.BYTES_PER_ELEMENT,S=g.normalized,x=g.size,C=g.normalizedScaleFactor,E=0,T=this._vertexCount;E<T;E++){var w=(E*y+h)/A;if(o(m,w,E),S)for(var R=0;R<x;R++)m[w+R]/=C}p.uploadAdvancedData=!0}}},a._updateAdvancedVertices=function(){var e=this,r=e._positions,o=e._normals,s=e._colors,l=e._advancedDataUpdateFlag,u=e._boneWeights,c=e._boneIndices,d=e._tangents,_=e._uv,f=e._uv1,v=e._uv2,p=e._uv3,g=e._uv4,m=e._uv5,h=e._uv6,y=e._uv7;l&1&&this._writeVector3AdvancedVertexData(j.Position,0,r),o&&l&2&&this._writeVector3AdvancedVertexData(j.Normal,1,o),s&&l&4&&this._writeColorAdvancedVertexData(j.Color,2,s),u&&l&16&&this._writeVector4AdvancedVertexData(j.BoneWeight,4,u),c&&l&32&&this._writeVector4AdvancedVertexData(j.BoneIndex,5,c),d&&l&8&&this._writeVector4AdvancedVertexData(j.Tangent,3,d),_&&l&64&&this._writeVector2AdvancedVertexData(j.UV,6,_),f&&l&128&&this._writeVector2AdvancedVertexData(j.UV1,7,f),v&&l&256&&this._writeVector2AdvancedVertexData(j.UV2,8,v),p&&l&512&&this._writeVector2AdvancedVertexData(j.UV3,9,p),g&&l&1024&&this._writeVector2AdvancedVertexData(j.UV4,10,g),m&&l&2048&&this._writeVector2AdvancedVertexData(j.UV5,11,m),h&&l&4096&&this._writeVector2AdvancedVertexData(j.UV6,12,h),y&&l&8192&&this._writeVector2AdvancedVertexData(j.UV7,13,y),this._advancedDataUpdateFlag=0},a._getInternalVertexBufferIndex=function(){var e=this._internalVertexBufferIndex;if(e!==-1)return e;for(var r=0,o=this._primitive.vertexBufferBindings,s=o.length;r<s&&o[r];r++);return this._internalVertexBufferIndex=r,r},a._getAttributeFormat=function(e){switch(e){case j.Position:case j.Normal:return ie.Vector3;case j.Color:case j.BoneWeight:case j.Tangent:return ie.Vector4;case j.BoneIndex:return ie.UByte4;case j.UV:case j.UV1:case j.UV2:case j.UV3:case j.UV4:case j.UV5:case j.UV6:case j.UV7:return ie.Vector2}},a._getAttributeByteLength=function(e){switch(e){case j.Position:case j.Normal:return 12;case j.Color:case j.BoneWeight:case j.Tangent:return 16;case j.BoneIndex:return 4;case j.UV:case j.UV1:case j.UV2:case j.UV3:case j.UV4:case j.UV5:case j.UV6:case j.UV7:return 8}},a._releaseCache=function(e){if(this._positions=null,this._tangents=null,this._normals=null,this._colors=null,this._boneIndices=null,this._boneWeights=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._indices=null,this._blendShapeManager._releaseMemoryCache(),!e){var r;(r=this._primitive.vertexBufferBindings[this._internalVertexBufferIndex])==null||r.buffer.markAsUnreadable();for(var o=this._dataVersionCounter++,s=this._vertexBufferInfos,l=0,u=s.length;l<u;l++){var c=s[l];c&&(c.dataVersion=o)}}},q(i,[{key:"vertexCount",get:function(){if(this._vertexCountDirty){var e=0,r=this._primitive._vertexElementMap[j.Position];if(r){var o=this._primitive.vertexBufferBindings[r.bindingIndex];o&&(e=o.buffer.byteLength/o.stride)}this._vertexCount=e,this._vertexCountDirty=!1}return this._vertexCount}},{key:"vertexElements",get:function(){return this._updateVertexElements(),this._primitive.vertexElements}},{key:"vertexBufferBindings",get:function(){return this._primitive.vertexBufferBindings}},{key:"blendShapes",get:function(){return this._blendShapeManager._blendShapes}},{key:"blendShapeCount",get:function(){return this._blendShapeManager._blendShapeCount}},{key:"accessible",get:function(){return this._accessible}}]),i}(Df);(function(){Nt._tempVec0=new M})();(function(){Nt._tempVec1=new M})();(function(){Nt._tempVec2=new M})();(function(){Nt._tempVec3=new M})();(function(){Nt._tempVec4=new M})();var Fx=function(){function n(){this.dataVersion=-1,this.uploadAdvancedData=!1}var i=n.prototype;return i.reset=function(){this.uploadAdvancedData=!1},n}(),uv;(function(n){n[n.None=0]="None",n[n.Position=1]="Position",n[n.Normal=2]="Normal",n[n.Color=4]="Color",n[n.Tangent=8]="Tangent",n[n.BoneWeight=16]="BoneWeight",n[n.BoneIndex=32]="BoneIndex",n[n.UV=64]="UV",n[n.UV1=128]="UV1",n[n.UV2=256]="UV2",n[n.UV3=512]="UV3",n[n.UV4=1024]="UV4",n[n.UV5=2048]="UV5",n[n.UV6=4096]="UV6",n[n.UV7=8192]="UV7",n[n.All=65535]="All"})(uv||(uv={}));var cv;(function(n){n[n.Position=0]="Position",n[n.Normal=1]="Normal",n[n.Color=2]="Color",n[n.Tangent=3]="Tangent",n[n.BoneWeight=4]="BoneWeight",n[n.BoneIndex=5]="BoneIndex",n[n.UV=6]="UV",n[n.UV1=7]="UV1",n[n.UV2=8]="UV2",n[n.UV3=9]="UV3",n[n.UV4=10]="UV4",n[n.UV5=11]="UV5",n[n.UV6=12]="UV6",n[n.UV7=13]="UV7"})(cv||(cv={}));var ha=function(n){W(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r.primitiveInfo=e,r}var a=i.prototype;return a.restoreContent=function(){var e=this.primitiveInfo;switch(e.type){case 0:var r=e;Er._setSphereData(this.resource,r.radius,r.segments,r.noLongerAccessible,!0,r.vertexBuffer);break;case 1:var o=e;Er._setCuboidData(this.resource,o.width,o.height,o.depth,o.noLongerAccessible,!0,o.vertexBuffer);break;case 2:var s=e;Er._setPlaneData(this.resource,s.width,s.height,s.horizontalSegments,s.verticalSegments,s.noLongerAccessible,!0,s.vertexBuffer);break;case 3:var l=e;Er._setCylinderData(this.resource,l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.noLongerAccessible,!0,l.vertexBuffer);break;case 4:var u=e;Er._setTorusData(this.resource,u.radius,u.tubeRadius,u.radialSegments,u.tubularSegments,u.arc,u.noLongerAccessible,!0,u.vertexBuffer);break;case 5:var c=e;Er._setConeData(this.resource,c.radius,c.height,c.radialSegments,c.heightSegments,c.noLongerAccessible,!0,c.vertexBuffer);break;case 6:var d=e;Er._setCapsuleData(this.resource,d.radius,d.height,d.radialSegments,d.heightSegments,d.noLongerAccessible,!0,d.vertexBuffer);break}},i}(gi),dv;(function(n){n[n.Sphere=0]="Sphere",n[n.Cuboid=1]="Cuboid",n[n.Plane=2]="Plane",n[n.Cylinder=3]="Cylinder",n[n.Torus=4]="Torus",n[n.Cone=5]="Cone",n[n.Capsule=6]="Capsule"})(dv||(dv={}));var Xa=function(i,a,t){this.type=i,this.vertexBuffer=a,this.noLongerAccessible=t},Ox=function(n){W(i,n);function i(a,t,e,r){var o;return o=n.call(this,0,e,r)||this,o.radius=a,o.segments=t,o}return i}(Xa),zx=function(n){W(i,n);function i(a,t,e,r,o){var s;return s=n.call(this,1,r,o)||this,s.width=a,s.height=t,s.depth=e,s}return i}(Xa),Ux=function(n){W(i,n);function i(a,t,e,r,o,s){var l;return l=n.call(this,2,o,s)||this,l.width=a,l.height=t,l.horizontalSegments=e,l.verticalSegments=r,l}return i}(Xa),kx=function(n){W(i,n);function i(a,t,e,r,o,s,l){var u;return u=n.call(this,3,s,l)||this,u.radiusTop=a,u.radiusBottom=t,u.height=e,u.radialSegments=r,u.heightSegments=o,u}return i}(Xa),Gx=function(n){W(i,n);function i(a,t,e,r,o,s,l){var u;return u=n.call(this,4,s,l)||this,u.radius=a,u.tubeRadius=t,u.radialSegments=e,u.tubularSegments=r,u.arc=o,u}return i}(Xa),Hx=function(n){W(i,n);function i(a,t,e,r,o,s){var l;return l=n.call(this,5,o,s)||this,l.radius=a,l.height=t,l.radialSegments=e,l.heightSegments=r,l}return i}(Xa),Wx=function(n){W(i,n);function i(a,t,e,r,o,s){var l;return l=n.call(this,6,o,s)||this,l.radius=a,l.height=t,l.radialSegments=e,l.heightSegments=r,l}return i}(Xa),Er=function(){function n(){}return n.createSphere=function(a,t,e,r){t===void 0&&(t=.5),e===void 0&&(e=18),r===void 0&&(r=!0);var o=new Nt(a);n._setSphereData(o,t,e,r,!1);var s=o.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(o,new Ox(t,e,s,r))),o},n.createCuboid=function(a,t,e,r,o){t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=!0);var s=new Nt(a);n._setCuboidData(s,t,e,r,o,!1);var l=s.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(s,new zx(t,e,r,l,o))),s},n.createPlane=function(a,t,e,r,o,s){t===void 0&&(t=1),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Nt(a);n._setPlaneData(l,t,e,r,o,s,!1);var u=l.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(l,new Ux(t,e,r,o,u,s))),l},n.createCylinder=function(a,t,e,r,o,s,l){t===void 0&&(t=.5),e===void 0&&(e=.5),r===void 0&&(r=2),o===void 0&&(o=20),s===void 0&&(s=1),l===void 0&&(l=!0);var u=new Nt(a);n._setCylinderData(u,t,e,r,o,s,l,!1);var c=u.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(u,new kx(t,e,r,o,s,c,l))),u},n.createTorus=function(a,t,e,r,o,s,l){t===void 0&&(t=.5),e===void 0&&(e=.1),r===void 0&&(r=30),o===void 0&&(o=30),s===void 0&&(s=360),l===void 0&&(l=!0);var u=new Nt(a);n._setTorusData(u,t,e,r,o,s,l,!1);var c=u.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(u,new Gx(t,e,r,o,s,c,l))),u},n.createCone=function(a,t,e,r,o,s){t===void 0&&(t=.5),e===void 0&&(e=2),r===void 0&&(r=20),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Nt(a);n._setConeData(l,t,e,r,o,s,!1);var u=l.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(l,new Hx(t,e,r,o,u,s))),l},n.createCapsule=function(a,t,e,r,o,s){t===void 0&&(t=.5),e===void 0&&(e=2),r===void 0&&(r=6),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Nt(a);n._setCapsuleData(l,t,e,r,o,s,!1);var u=l.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new ha(l,new Wx(t,e,r,o,u,s))),l},n._setSphereData=function(a,t,e,r,o,s){e=Math.max(2,Math.floor(e));for(var l=e+1,u=l*l,c=e*e,d=n._generateIndices(a.engine,u,c*6),_=Math.PI,f=_*2,v=1/l,p=1/e,g=8,m=new Float32Array(u*g),h=0;h<u;++h){var y=h%l,A=h*v|0,S=y*p,x=A*p,C=S*f,E=x*_,T=Math.sin(E),w=-t*Math.cos(C)*T,R=t*Math.cos(E),b=t*Math.sin(C)*T,B=h*g;m[B++]=w,m[B++]=R,m[B++]=b,m[B++]=w,m[B++]=R,m[B++]=b,m[B++]=S,m[B++]=x}for(var I=0,V=0;V<c;++V){var L=V%e,F=V*p|0,D=F*l+L,N=D+1,O=D+l,k=O+1;d[I++]=N,d[I++]=D,d[I++]=k,d[I++]=D,d[I++]=O,d[I++]=k}if(!o){var Q=a.bounds;Q.min.set(-t,-t,-t),Q.max.set(t,t,t)}n._initialize(a,m,d,r,o,s)},n._setCuboidData=function(a,t,e,r,o,s,l){var u=t/2,c=e/2,d=r/2,_=8,f=new Float32Array(24*_);f[0]=-u,f[1]=c,f[2]=-d,f[6]=0,f[7]=0,f[8]=u,f[9]=c,f[10]=-d,f[14]=1,f[15]=0,f[16]=u,f[17]=c,f[18]=d,f[22]=1,f[23]=1,f[24]=-u,f[25]=c,f[26]=d,f[30]=0,f[31]=1;for(var v=0;v<4;v++){var p=_*v+3;f[p++]=0,f[p++]=1,f[p++]=0}f[32]=-u,f[33]=-c,f[34]=-d,f[38]=0,f[39]=1,f[40]=u,f[41]=-c,f[42]=-d,f[46]=1,f[47]=1,f[48]=u,f[49]=-c,f[50]=d,f[54]=1,f[55]=0,f[56]=-u,f[57]=-c,f[58]=d,f[62]=0,f[63]=0;for(var g=0;g<4;g++){var m=_*g+35;f[m++]=0,f[m++]=-1,f[m++]=0}f[64]=-u,f[65]=c,f[66]=-d,f[70]=0,f[71]=0,f[72]=-u,f[73]=c,f[74]=d,f[78]=1,f[79]=0,f[80]=-u,f[81]=-c,f[82]=d,f[86]=1,f[87]=1,f[88]=-u,f[89]=-c,f[90]=-d,f[94]=0,f[95]=1;for(var h=0;h<4;h++){var y=_*h+67;f[y++]=-1,f[y++]=0,f[y++]=0}f[96]=u,f[97]=c,f[98]=-d,f[102]=1,f[103]=0,f[104]=u,f[105]=c,f[106]=d,f[110]=0,f[111]=0,f[112]=u,f[113]=-c,f[114]=d,f[118]=0,f[119]=1,f[120]=u,f[121]=-c,f[122]=-d,f[126]=1,f[127]=1;for(var A=0;A<4;A++){var S=_*A+99;f[S++]=1,f[S++]=0,f[S++]=0}f[128]=-u,f[129]=c,f[130]=d,f[134]=0,f[135]=0,f[136]=u,f[137]=c,f[138]=d,f[142]=1,f[143]=0,f[144]=u,f[145]=-c,f[146]=d,f[150]=1,f[151]=1,f[152]=-u,f[153]=-c,f[154]=d,f[158]=0,f[159]=1;for(var x=0;x<4;x++){var C=_*x+131;f[C++]=0,f[C++]=0,f[C++]=1}f[160]=-u,f[161]=c,f[162]=-d,f[166]=1,f[167]=0,f[168]=u,f[169]=c,f[170]=-d,f[174]=0,f[175]=0,f[176]=u,f[177]=-c,f[178]=-d,f[182]=0,f[183]=1,f[184]=-u,f[185]=-c,f[186]=-d,f[190]=1,f[191]=1;for(var E=0;E<4;E++){var T=_*E+163;f[T++]=0,f[T++]=0,f[T++]=-1}var w=new Uint16Array(36);if(w[0]=0,w[1]=2,w[2]=1,w[3]=2,w[4]=0,w[5]=3,w[6]=4,w[7]=6,w[8]=7,w[9]=6,w[10]=4,w[11]=5,w[12]=8,w[13]=10,w[14]=9,w[15]=10,w[16]=8,w[17]=11,w[18]=12,w[19]=14,w[20]=15,w[21]=14,w[22]=12,w[23]=13,w[24]=16,w[25]=18,w[26]=17,w[27]=18,w[28]=16,w[29]=19,w[30]=20,w[31]=22,w[32]=23,w[33]=22,w[34]=20,w[35]=21,!s){var R=a.bounds;R.min.set(-u,-c,-d),R.max.set(u,c,d)}n._initialize(a,f,w,o,s,l)},n._setPlaneData=function(a,t,e,r,o,s,l,u){r=Math.max(1,Math.floor(r)),o=Math.max(1,Math.floor(o));for(var c=r+1,d=o+1,_=t/2,f=e/2,v=t/r,p=e/o,g=c*d,m=o*r,h=n._generateIndices(a.engine,g,m*6),y=1/c,A=1/r,S=1/o,x=8,C=new Float32Array(g*x),E=0;E<g;++E){var T=E%c,w=E*y|0,R=E*x;C[R++]=T*v-_,C[R++]=0,C[R++]=w*p-f,C[R++]=0,C[R++]=1,C[R++]=0,C[R++]=T*A,C[R++]=w*S}for(var b=0,B=0;B<m;++B){var I=B%r,V=B*A|0,L=V*c+I,F=L+1,D=L+c,N=D+1;h[b++]=L,h[b++]=D,h[b++]=F,h[b++]=D,h[b++]=N,h[b++]=F}if(!l){var O=a.bounds;O.min.set(-_,0,-f),O.max.set(_,0,f)}n._initialize(a,C,h,s,l,u)},n._setCylinderData=function(a,t,e,r,o,s,l,u,c){t===void 0&&(t=.5),e===void 0&&(e=.5),r===void 0&&(r=2),o===void 0&&(o=20),s===void 0&&(s=1),o=Math.floor(o),s=Math.floor(s);for(var d=o+1,_=s+1,f=r*.5,v=r/s,p=d*_,g=o*s,m=o*2,h=p+2+m,y=n._generateIndices(a.engine,h,g*6+m*3),A=1/d,S=1/o,x=1/s,C=8,E=new Float32Array(h*C),T=0,w=Math.PI,R=Math.PI*2,b=e-t,B=b/r,I=b/s,V=0;V<p;++V){var L=V%d,F=V*A|0,D=L*S,N=F*x,O=w+D*R,k=Math.sin(O),Q=Math.cos(O),H=e-F*I,ee=H*k,ge=F*v-f,le=H*Q,re=V*C;E[re++]=ee,E[re++]=ge,E[re++]=le,E[re++]=k,E[re++]=B,E[re++]=Q,E[re++]=D,E[re++]=1-N}for(var Ve=0;Ve<g;++Ve){var He=Ve%o,Qe=Ve*S|0,Ee=Qe*d+He,ft=Ee+1,Je=Ee+d,at=Je+1;y[T++]=ft,y[T++]=Je,y[T++]=Ee,y[T++]=ft,y[T++]=at,y[T++]=Je}var se=p*C;E[se++]=0,E[se++]=-f,E[se++]=0,E[se++]=0,E[se++]=-1,E[se++]=0,E[se++]=.5,E[se++]=.5,E[se++]=0,E[se++]=f,E[se++]=0,E[se++]=0,E[se++]=1,E[se++]=0,E[se++]=.5,E[se++]=.5,se=(p+2)*C;for(var St=1/(t*2),Fn=1/(e*2),ai=d*s,yr=0;yr<o;++yr){var Pi=yr*C,oi=E[Pi],fa=E[Pi+2];E[se++]=oi,E[se++]=-f,E[se++]=fa,E[se++]=0,E[se++]=-1,E[se++]=0,E[se++]=oi*Fn+.5,E[se++]=.5-fa*Fn;var pl=(yr+ai)*C;oi=E[pl],fa=E[pl+2],E[se++]=oi,E[se++]=f,E[se++]=fa,E[se++]=0,E[se++]=1,E[se++]=0,E[se++]=oi*St+.5,E[se++]=.5-fa*St}for(var Dm=p+1,Lc=p+2,Qf=Lc+1,gl=0;gl<o;++gl){var Ic=gl*2,Xf=gl===o-1?0:Ic+2;y[T++]=p,y[T++]=Lc+Xf,y[T++]=Lc+Ic,y[T++]=Dm,y[T++]=Qf+Ic,y[T++]=Qf+Xf}if(!u){var jf=a.bounds,ml=Math.max(t,e);jf.min.set(-ml,-f,-ml),jf.max.set(ml,f,ml)}n._initialize(a,E,y,l,u,c)},n._setTorusData=function(a,t,e,r,o,s,l,u,c){r=Math.floor(r),o=Math.floor(o);var d=(r+1)*(o+1),_=r*o,f=n._generateIndices(a.engine,d,_*6),v=8,p=new Float32Array(d*v);s=s/180*Math.PI;for(var g=0,m=n._tempVec30,h=0;h<=r;h++)for(var y=0;y<=o;y++){var A=y/o*s,S=h/r*Math.PI*2,x=Math.cos(S),C=Math.sin(S),E=Math.cos(A),T=Math.sin(A),w=(t+e*x)*E,R=(t+e*x)*T,b=e*C;p[g++]=w,p[g++]=R,p[g++]=b;var B=t*E,I=t*T;m.set(w-B,R-I,b).normalize(),p[g++]=m.x,p[g++]=m.y,p[g++]=m.z,p[g++]=y/o,p[g++]=h/r}g=0;for(var V=1;V<=r;V++)for(var L=1;L<=o;L++){var F=(o+1)*V+L-1,D=(o+1)*(V-1)+L-1,N=(o+1)*(V-1)+L,O=(o+1)*V+L;f[g++]=F,f[g++]=D,f[g++]=O,f[g++]=D,f[g++]=N,f[g++]=O}if(!u){var k=a.bounds,Q=t+e;k.min.set(-Q,-Q,-e),k.max.set(Q,Q,e)}n._initialize(a,p,f,l,u,c)},n._setConeData=function(a,t,e,r,o,s,l,u){r=Math.floor(r),o=Math.floor(o);for(var c=r+1,d=o+1,_=e*.5,f=e/o,v=c*d,p=r*o,g=v+1+r,m=n._generateIndices(a.engine,g,p*6+r*3),h=1/c,y=1/r,A=1/o,S=8,x=new Float32Array(g*8),C=0,E=Math.PI,T=Math.PI*2,w=t/e,R=0;R<v;++R){var b=R%c,B=R*h|0,I=b*y,V=B*A,L=E+I*T,F=Math.sin(L),D=Math.cos(L),N=t-B*t,O=N*F,k=B*f-_,Q=N*D,H=R*S;x[H++]=O,x[H++]=k,x[H++]=Q,x[H++]=F,x[H++]=w,x[H++]=D,x[H++]=I,x[H++]=1-V}for(var ee=0;ee<p;++ee){var ge=ee%r,le=ee*y|0,re=le*c+ge,Ve=re+1,He=re+c,Qe=He+1;m[C++]=Ve,m[C++]=He,m[C++]=re,m[C++]=Ve,m[C++]=Qe,m[C++]=He}var Ee=v*S;x[Ee++]=0,x[Ee++]=-_,x[Ee++]=0,x[Ee++]=0,x[Ee++]=-1,x[Ee++]=0,x[Ee++]=.5,x[Ee++]=.5,Ee=(v+1)*S;for(var ft=1/(t*2),Je=0;Je<r;++Je){var at=x[Je*S],se=x[Je*S+2];x[Ee++]=at,x[Ee++]=-_,x[Ee++]=se,x[Ee++]=0,x[Ee++]=-1,x[Ee++]=0,x[Ee++]=at*ft+.5,x[Ee++]=.5-se*ft}for(var St=v+1,Fn=0;Fn<r;++Fn){var ai=Fn,yr=Fn===r-1?0:ai+1;m[C++]=v,m[C++]=St+yr,m[C++]=St+ai}if(!l){var Pi=a.bounds;Pi.min.set(-t,-_,-t),Pi.max.set(t,_,t)}n._initialize(a,x,m,s,l,u)},n._setCapsuleData=function(a,t,e,r,o,s,l,u){r=Math.max(2,Math.floor(r)),o=Math.floor(o);for(var c=r+1,d=o+1,_=e*.5,f=e/o,v=c*d,p=r*o,g=c*c,m=r*r,h=v+2*g,y=n._generateIndices(a.engine,h,(p+2*m)*6),A=1/c,S=1/r,x=1/o,C=Math.PI,E=Math.PI*2,T=8,w=new Float32Array(h*T),R=0,b=0;b<v;++b){var B=b%c,I=b*A|0,V=B*S,L=I*x,F=C+V*E,D=Math.sin(F),N=Math.cos(F),O=b*T;w[O++]=t*D,w[O++]=I*f-_,w[O++]=t*N,w[O++]=D,w[O++]=0,w[O++]=N,w[O++]=V,w[O++]=1-L}for(var k=0;k<p;++k){var Q=k%r,H=k*S|0,ee=H*c+Q,ge=ee+1,le=ee+c,re=le+1;y[R++]=ge,y[R++]=le,y[R++]=ee,y[R++]=ge,y[R++]=re,y[R++]=le}if(n._createCapsuleCap(t,e,r,E,v,1,w,y,R),n._createCapsuleCap(t,e,r,-E,v+g,-1,w,y,R+6*m),!l){var Ve=a.bounds;Ve.min.set(-t,-t-_,-t),Ve.max.set(t,t+_,t)}n._initialize(a,w,y,s,l,u)},n._initialize=function(a,t,e,r,o,s){if(o)s.setData(t),a.setIndices(e),a.uploadData(r);else{var l=[new Le(j.Position,0,ie.Vector3,0),new Le(j.Normal,12,ie.Vector3,0),new Le(j.UV,24,ie.Vector2,0)];a.setVertexElements(l);var u=new qn(a.engine,vn.VertexBuffer,t,mt.Static,!0);a.setVertexBufferBinding(u,32,0),a.setIndices(e),a.calculateTangents(),a.uploadData(r),a.addSubMesh(0,e.length)}},n._generateIndices=function(a,t,e){var r=null;if(t>65535)if(a._hardwareRenderer.canIUse(Z.elementIndexUint))r=new Uint32Array(e);else throw Error("The vertex count is over limit.");else r=new Uint16Array(e);return r},n._createCapsuleCap=function(a,t,e,r,o,s,l,u,c){for(var d=e+1,_=t*.5*s,f=d*d,v=e*e,p=1/d,g=1/e,m=8,h=0;h<f;++h){var y=h%d,A=h*p|0,S=y*g,x=A*g,C=S*r,E=x*Math.PI/2,T=Math.sin(E),w=-a*Math.cos(C)*T,R=a*Math.cos(E)*s+_,b=a*Math.sin(C)*T,B=(h+o)*m;l[B++]=w,l[B++]=R,l[B++]=b,l[B++]=w,l[B++]=R-_,l[B++]=b,l[B++]=S,l[B++]=x}for(var I=0;I<v;++I){var V=I%e,L=I*g|0,F=L*d+V+o,D=F+1,N=F+d,O=N+1;u[c++]=D,u[c++]=F,u[c++]=O,u[c++]=F,u[c++]=N,u[c++]=O}},n}();(function(){Er._tempVec30=new M})();var rm=function(n){W(i,n);function i(a){var t;return t=n.call(this,null)||this,t.name=a,t._bones=[],t.inverseBindMatrices=[],t.joints=[],t.skeleton="none",t}return i}(ti),Lt=function(n){W(i,n);function i(t){var e;e=n.call(this,t)||this,e._localBounds=new jt,e._jointDataCreateCache=new te(-1,-1),e._skin=null;var r=e.entity.engine._hardwareRenderer,o=r.renderStates.getParameter(r.gl.MAX_VERTEX_UNIFORM_VECTORS);o=Math.min(o,r._options._maxAllowSkinUniformVectorCount),e._maxVertexUniformVectors=o,e._onLocalBoundsChanged=e._onLocalBoundsChanged.bind(fe(e));var s=e._localBounds;return s.min._onValueChanged=e._onLocalBoundsChanged,s.max._onValueChanged=e._onLocalBoundsChanged,e}var a=i.prototype;return a.update=function(){var e=this,r=e._skin,o=e._bones;if(r&&o)for(var s=this._jointMatrices,l=r.inverseBindMatrices,u,c=((u=this._rootBone)!=null?u:this.entity).getInvModelMatrix(),d=o.length-1;d>=0;d--){var _=o[d],f=d*16;_?yt._floatMatrixMultiply(_.transform.worldMatrix,l[d].elements,0,s,f):s.set(l[d].elements,f),yt._floatMatrixMultiply(c,s,f,s,f)}},a._updateShaderData=function(e){var r=this.entity,o=this._rootBone?this._rootBone.transform.worldMatrix:r.transform.worldMatrix;this._updateTransformShaderData(e,o);var s=this.shaderData,l=this.mesh,u=l._blendShapeManager;u._updateShaderData(s,this);var c=this._bones;if(c){var d=u._uniformOccupiesCount,_=c.length,f=this._jointDataCreateCache,v=_!==f.x;if(v||d!==f.y){var p=Math.ceil((this._maxVertexUniformVectors-(44+d))/4);if(_>p){var g=this.engine;if(g._hardwareRenderer.canIUseMoreJoints){if(v){var m;(m=this._jointTexture)==null||m.destroy(),this._jointTexture=new fn(g,4,_,X.R32G32B32A32,!1),this._jointTexture.filterMode=tn.Point,this._jointTexture.isGCIgnored=!0}s.disableMacro("RENDERER_JOINTS_NUM"),s.enableMacro("RENDERER_USE_JOINT_TEXTURE"),s.setTexture(i._jointSamplerProperty,this._jointTexture)}else ve.error("component's joints count("+_+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+this._maxVertexUniformVectors+", and don't support jointTexture in this device. suggest joint count less than "+p+".",this)}else{var h;(h=this._jointTexture)==null||h.destroy(),s.disableMacro("RENDERER_USE_JOINT_TEXTURE"),s.enableMacro("RENDERER_JOINTS_NUM",p.toString()),s.setFloatArray(i._jointMatrixProperty,this._jointMatrices)}f.set(_,d)}this._jointTexture&&this._jointTexture.setPixelBuffer(this._jointMatrices)}var y=r.layer;this._rendererLayer.set(y&65535,y>>>16&65535,0,0)},a._onDestroy=function(){var e,r;n.prototype._onDestroy.call(this),(e=this._rootBone)==null||e.transform._updateFlagManager.removeListener(this._onTransformChanged),this._rootBone=null,this._jointDataCreateCache=null,this._skin=null,this._blendShapeWeights=null,this._localBounds=null,this._jointMatrices=null,(r=this._jointTexture)==null||r.destroy(),this._jointTexture=null,this._bones=null},a._cloneTo=function(e,r,o){n.prototype._cloneTo.call(this,e,r,o);var s=new Array;if(this.rootBone){var l=this._getEntityHierarchyPath(r,this.rootBone,s);e.rootBone=l?this._getEntityByHierarchyPath(o,s):this.rootBone}var u=this._bones;if(u){for(var c=u.length,d=new Array(c),_=0;_<c;_++){var f=u[_],v=this._getEntityHierarchyPath(r,f,s);d[_]=v?this._getEntityByHierarchyPath(o,s):f}e.bones=d}this._blendShapeWeights&&(e._blendShapeWeights=this._blendShapeWeights.slice())},a._registerEntityTransformListener=function(){},a._updateBounds=function(e){if(this._rootBone){var r=this._localBounds,o=this._rootBone.transform.worldMatrix;jt.transform(r,o,e)}else n.prototype._updateBounds.call(this,e)},a._checkBlendShapeWeightLength=function(){var e=this._mesh,r=e?e.blendShapeCount:0,o=this._blendShapeWeights;if(o){var s=o.length;if(s!==r){var l=new Float32Array(r);if(r>s)l.set(o);else for(var u=0;u<r;u++)l[u]=o[u];this._blendShapeWeights=l}}else this._blendShapeWeights=new Float32Array(r)},a._onLocalBoundsChanged=function(){this._dirtyUpdateFlag|=pt.WorldVolume},a._getEntityHierarchyPath=function(e,r,o){for(o.length=0;r!==e;){var s=r.parent;if(!s)return!1;o.push(r.siblingIndex),r=s}return!0},a._getEntityByHierarchyPath=function(e,r){for(var o=e,s=r.length-1;s>=0;s--)o=o.children[r[s]];return o},q(i,[{key:"blendShapeWeights",get:function(){return this._checkBlendShapeWeightLength(),this._blendShapeWeights},set:function(e){this._checkBlendShapeWeightLength();var r=this._blendShapeWeights;if(e.length<=r.length)r.set(e);else for(var o=0,s=r.length;o<s;o++)r[o]=e[o]}},{key:"localBounds",get:function(){return this._localBounds},set:function(e){this._localBounds!==e&&this._localBounds.copyFrom(e)}},{key:"rootBone",get:function(){return this._rootBone},set:function(e){if(this._rootBone!==e){var r;(r=this._rootBone)==null||r.transform._updateFlagManager.removeListener(this._onTransformChanged),e.transform._updateFlagManager.addListener(this._onTransformChanged),this._rootBone=e,this._dirtyUpdateFlag|=pt.WorldVolume}}},{key:"bones",get:function(){return this._bones},set:function(e){if(this._bones!==e){var r,o,s,l=(s=(r=this._bones)==null?void 0:r.length)!=null?s:0,u,c=(u=(o=e)==null?void 0:o.length)!=null?u:0;if(l!==c){var d=this.shaderData;c>0?(this._jointMatrices=new Float32Array(c*16),d.enableMacro("RENDERER_HAS_SKIN"),d.setInt(i._jointCountProperty,c)):(this._jointMatrices=null,d.disableMacro("RENDERER_HAS_SKIN"))}this._bones=e}}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}}]),i}(en);(function(){Lt._jointCountProperty=U.getByName("renderer_JointCount")})();(function(){Lt._jointSamplerProperty=U.getByName("renderer_JointSampler")})();(function(){Lt._jointMatrixProperty=U.getByName("renderer_JointMatrix")})();P([K],Lt.prototype,"_localBounds",void 0);P([z],Lt.prototype,"_jointDataCreateCache",void 0);P([z],Lt.prototype,"_blendShapeWeights",void 0);P([z],Lt.prototype,"_maxVertexUniformVectors",void 0);P([z],Lt.prototype,"_rootBone",void 0);P([z],Lt.prototype,"_jointMatrices",void 0);P([z],Lt.prototype,"_jointTexture",void 0);P([z],Lt.prototype,"_bones",void 0);P([z],Lt.prototype,"_condensedBlendShapeWeights",void 0);P([z],Lt.prototype,"_onLocalBoundsChanged",null);var Dr=function(){function n(a){this._subMeshPool=new Aa(Cc),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._flushId=0,this._vertexCount=0,this._elementCount=0,this._engine=a,this._initMeshes(a)}var i=n.prototype;return i.drawElement=function(t,e){var r=t.data;if(r.multiRenderData)for(var o=r.charsData,s=e.engine._renderElementPool,l=0,u=o.length;l<u;++l){var c=s.getFromPool();c.set(o[l],t.shaderPasses),this._drawSubElement(c,e)}else this._drawSubElement(t,e)},i._initMeshes=function(t){var e=n.MAX_VERTEX_COUNT;this._vertices=new Float32Array(e*9),this._indices=new Uint16Array(e*3);for(var r=this,o=r._meshes,s=r._meshCount,l=0;l<s;l++)o[l]=this._createMesh(t,l)},i.flush=function(t){var e=this._batchedQueue;e.length!==0&&(this._updateData(this._engine),this.drawBatches(t),n._canUploadSameBuffer||this._flushId++,e.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},i.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},i.destroy=function(){this._batchedQueue=null;for(var t=this,e=t._meshes,r=t._vertexBuffers,o=t._indiceBuffers,s=0,l=e.length;s<l;++s)e[s].destroy();this._meshes=null;for(var u=0,c=r.length;u<c;++u)r[u].destroy();this._vertexBuffers=null;for(var d=0,_=o.length;d<_;++d)o[d].destroy();this._indiceBuffers=null},i._drawSubElement=function(t,e){var r=t.data.verticesData.vertexCount;this._vertexCount+r>n.MAX_VERTEX_COUNT&&this.flush(e),this._vertexCount+=r,this._batchedQueue[this._elementCount++]=t},i._createMesh=function(t,e){var r=n.MAX_VERTEX_COUNT,o=new If(t,"BufferMesh"+e);o.isGCIgnored=!0;var s=[],l=this.createVertexElements(s),u=this._vertexBuffers[e]=new qn(t,vn.VertexBuffer,r*l,mt.Dynamic);u.isGCIgnored=!0;var c=this._indiceBuffers[e]=new qn(t,vn.IndexBuffer,r*6,mt.Dynamic);return c.isGCIgnored=!0,o.setVertexBufferBinding(u,l),o.setIndexBufferBinding(c,Ht.UInt16),o.setVertexElements(s),o},i._updateData=function(t){var e=this,r=e._meshes,o=e._flushId;!n._canUploadSameBuffer&&this._meshCount<=o&&(this._meshCount++,r[o]=this._createMesh(t,o));var s=this,l=s._batchedQueue,u=s._vertices,c=s._indices,d=r[o];d.clearSubMesh();for(var _=0,f=0,v=0,p=0,g=0,m=0,h=null,y=0,A=l.length;y<A;y++){var S=l[y],x=S.data;_=this.updateVertices(x,u,_);for(var C=x.verticesData.triangles,E=C.length,T=0;T<E;T++)c[f++]=C[T]+g;g+=x.verticesData.vertexCount,h===null||this.canBatch(h,S)?p+=E:(d.addSubMesh(this._getSubMeshFromPool(v,p)),v+=p,p=E,l[m++]=h),h=S}d.addSubMesh(this._getSubMeshFromPool(v,p)),l[m]=h,this._vertexBuffers[o].setData(u,0,0,_),this._indiceBuffers[o].setData(c,0,0,f)},i._getSubMeshFromPool=function(t,e){var r=this._subMeshPool.getFromPool();return r.start=t,r.count=e,r.topology=ia.Triangles,r},n}();(function(){Dr._disableBatchTag=mi.getByName("spriteDisableBatching")})();(function(){Dr.MAX_VERTEX_COUNT=4096})();(function(){Dr._canUploadSameBuffer=!0})();var Qx=function(n){W(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new Le("POSITION",0,ie.Vector3,0),e[1]=new Le("TEXCOORD_0",12,ie.Vector2,0),20},a.canBatch=function(e,r){var o=e.data,s=r.data;if(o.isAdd!==s.isAdd)return!1;var l=o.component.shaderData,u=s.component.shaderData,c=an._textureProperty,d=an._alphaCutoffProperty;return l.getTexture(c)===u.getTexture(c)&&l.getTexture(d)===u.getTexture(d)},a.updateVertices=function(e,r,o){for(var s=e.verticesData,l=s.positions,u=s.uvs,c=s.vertexCount,d=0;d<c;d++){var _=l[d],f=u[d];r[o++]=_.x,r[o++]=_.y,r[o++]=_.z,r[o++]=f.x,r[o++]=f.y}return o},a.drawBatches=function(e){for(var r=this,o=r._engine,s=r._batchedQueue,l=this._meshes[this._flushId],u=l.subMeshes,c=l._primitive,d=e.scene.shaderData,_=e.shaderData,f=0,v=u.length;f<v;f++){var p=u[f],g=s[f],m=g.data;if(!p||!g)return;var h=m.component,y=m.material,A=be._compileMacros;Dn.unionCollection(h._globalShaderMacro,y.shaderData._macroCollection,A);var S=y.renderState.stencilState,x=m.isAdd?Ke.IncrementSaturate:Ke.DecrementSaturate;S.passOperationFront=x,S.passOperationBack=x;var C=y.shader.subShaders[0].passes[0],E=C._getShaderProgram(o,A);if(!E.isValid)return;E.bind(),E.groupingOtherUniformBlock(),E.uploadAll(E.sceneUniformBlock,d),E.uploadAll(E.cameraUniformBlock,_),E.uploadAll(E.rendererUniformBlock,h.shaderData),E.uploadAll(E.materialUniformBlock,y.shaderData),y.renderState._apply(o,!1,C._renderStateDataMap,y.shaderData),o._hardwareRenderer.drawPrimitive(c,p,E)}},i}(Dr),Xx=function(){function n(a){this._preMaskLayer=0,this._batcher=new Qx(a)}var i=n.prototype;return i.clear=function(){this._preMaskLayer=0,this._batcher.clear()},i.preRender=function(t,e){e.maskInteraction!==wt.None&&(this._batcher.clear(),this._processMasksDiff(t,e),this._batcher.flush(t))},i.postRender=function(t){t.maskInteraction!==wt.None&&(this._preMaskLayer=t.maskLayer)},i.destroy=function(){this._batcher.destroy(),this._batcher=null},i._processMasksDiff=function(t,e){var r=this._preMaskLayer,o=e.maskLayer;if(r!==o)for(var s=t._renderPipeline._allSpriteMasks,l=r&o,u=o&~r,c=r&~o,d=s._elements,_=0,f=s.length;_<f;_++){var v=d[_],p=v.influenceLayers;if(!(p&l)){if(p&u){var g=v._maskElement;g.data.isAdd=!0,this._batcher.drawElement(g,t);continue}if(p&c){var m=v._maskElement;m.data.isAdd=!1,this._batcher.drawElement(m,t)}}}},n}(),jx=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.isAdd=!0,t.multiRenderData=!1,t}var a=i.prototype;return a.set=function(e,r,o){this.component=e,this.material=r,this.verticesData=o},a.dispose=function(){this.component=this.material=this.verticesData=null},i}(Sc),Yx=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.multiRenderData=!1,t}var a=i.prototype;return a.set=function(e,r,o,s,l){l===void 0&&(l=0),this.component=e,this.material=r,this.verticesData=o,this.texture=s,this.dataIndex=l},a.dispose=function(){this.component=this.material=this.verticesData=this.texture=null},i}(Sc),qx=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.charsData=[],t.multiRenderData=!0,t}var a=i.prototype;return a.dispose=function(){this.component=this.material=null,this.charsData.length=0},i}(Sc),De;(function(n){n.Text="Text",n.JSON="JSON",n.Buffer="Buffer",n.Texture2D="Texture2D",n.TextureCube="TextureCube",n.Material="Material",n.Mesh="Mesh",n.AnimationClip="AnimationClip",n.AnimatorController="AnimatorController",n.GLTF="GLTF",n.KTX="KTX",n.KTXCube="KTXCube",n.KTX2="KTX2",n.Sprite="Sprite",n.SpriteAtlas="SpriteAtlas",n.Env="Environment",n.Scene="Scene",n.HDR="HDR",n.Font="Font",n.SourceFont="SourceFont",n.Project="project"})(De||(De={}));var Jx=function(){function n(){this._array=[],this._loopArray=[],this._loopArrayDirty=!1}var i=n.prototype;return i.push=function(t){this._array.push(t),this._loopArrayDirty=!0},i.add=function(t,e){this._array.splice(t,0,e),this._loopArrayDirty=!0},i.removeByIndex=function(t){this._array.splice(t,1),this._loopArrayDirty=!0},i.indexOf=function(t){return this._array.indexOf(t)},i.getArray=function(){return this._array},i.getLoopArray=function(){var t=this._loopArray;if(this._loopArrayDirty){var e=this._array,r=e.length;t.length=r;for(var o=0;o<r;o++)t[o]=e[o];this._loopArrayDirty=!1}return t},q(n,[{key:"length",get:function(){return this._array.length}}]),n}(),im=function(){function n(a){this.engine=a,this._allCreatedScenes=[],this._scenes=new Jx}var i=n.prototype;return i.addScene=function(t,e){var r=this._scenes,o;if(typeof t=="number"){if(t<0||t>r.length)throw"The index is out of range.";o=t}else o=r.length,e=t;if(e.engine!==this.engine)throw"The scene is not belong to this engine.";if(e._sceneManager){var s=r.indexOf(e);s!==o&&(r.removeByIndex(s),r.add(o,e))}else e._sceneManager=this,r.add(o,e),e.isActive&&e._processActive(!0)},i.removeScene=function(t){var e=this._scenes,r=e.indexOf(t);if(r!==-1){var o=e.getArray()[r];e.removeByIndex(r),t._sceneManager=null,o.isActive&&o._processActive(!1)}},i.loadScene=function(t,e){e===void 0&&(e=!0);var r=this,o=this.engine.resourceManager.load({url:t,type:De.Scene});return o.then(function(s){if(e)for(var l=r._scenes.getArray(),u=0,c=l.length;u<c;u++)l[u].destroy();r.addScene(s)}),o},i.mergeScenes=function(t,e){for(var r=t.rootEntities;r.length>0;)e.addRootEntity(r[0])},i._destroyAllScene=function(){for(var t=this._allCreatedScenes;t.length>0;)t[0].destroy()},q(n,[{key:"scenes",get:function(){return this._scenes.getArray()}},{key:"activeScene",get:function(){return this._scenes.getArray()[0]},set:function(t){var e=this.scenes[0];e&&this.removeScene(e),t&&this.addScene(0,t)}}]),n}(),Oe=function(){function n(a){var t=this;this._state="pending",this._progress=0,this._onProgressCallback=[],this._promise=new Promise(function(e,r){t._reject=r;var o=function(c){t._state==="pending"&&(e(c),t._state="fulfilled",t._onProgressCallback=void 0)},s=function(c){t._state==="pending"&&(r(c),t._state="rejected",t._onProgressCallback=void 0)},l=function(c){t._state==="pending"&&(t._onCancelHandler=c)},u=function(c){t._state==="pending"&&(t._progress=c,t._onProgressCallback.forEach(function(d){return d(c)}))};a(o,s,u,l)})}var i=n.prototype;return i.onProgress=function(t){return this._progress&&t(this._progress),this._state==="pending"&&this._onProgressCallback.push(t),this},i.then=function(t,e){var r=this;return new n(function(o,s){r._promise.then(t,e).then(o).catch(s)})},i.catch=function(t){var e=this;return new n(function(r,o){e._promise.catch(t).then(r).catch(o)})},i.finally=function(t){return this._promise.finally(t)},i.cancel=function(){if(this._state==="pending")return this._state="canceled",this._reject("canceled"),this._onCancelHandler&&this._onCancelHandler(),this},n.all=function(t){return new n(function(e,r,o){var s=function(v,p){d++,c[v]=p,o(d/u),d===u&&e(c)},l=function(v,p){gt(v,Promise)||gt(v,n)?v.then(function(g){s(p,g)},r):Promise.resolve().then(function(){s(p,v)})},u=t.length,c=new Array(u),d=0;if(u===0)return e(c);for(var _=0;_<u;_++)l(t[_],_)})},q(n,[{key:Symbol.toStringTag,get:function(){return"AssetPromise"}}]),n}(),_v;(function(n){n.Pending="pending",n.Fulfilled="fulfilled",n.Rejected="rejected",n.Canceled="canceled"})(_v||(_v={}));var zo=function(){function n(a){this.engine=a,this.retryCount=1,this.retryInterval=0,this.timeout=1/0,this._loadingPromises={},this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._referResourcePool=Object.create(null),this._graphicResourcePool=Object.create(null),this._contentRestorerPool=Object.create(null),this._subAssetPromiseCallbacks={},this._objectPool=Object.create(null),this._editorResourceConfig=Object.create(null),this._virtualPathMap=Object.create(null)}var i=n.prototype;return i.load=function(t){var e=this;if(!Array.isArray(t))return this._loadSingleItem(t);var r=t.map(function(o){return e._loadSingleItem(o)});return Oe.all(r)},i.getFromCache=function(t){var e;return(e=this._assetUrlPool[t])!=null?e:null},i.findResourcesByType=function(t){var e=new Array,r=this._referResourcePool;for(var o in r){var s=r[o];gt(s,t)&&e.push(s)}return e},i.getAssetPath=function(t){return this._assetPool[t]},i.cancelNotLoaded=function(t){var e=this;if(!t)yt.objectValues(this._loadingPromises).forEach(function(o){o.cancel()});else if(typeof t=="string"){var r;(r=this._loadingPromises[t])==null||r.cancel()}else t.forEach(function(o){var s;(s=e._loadingPromises[o])==null||s.cancel()})},i.gc=function(){this._gc(!1),this.engine._pendingGC()},i.addContentRestorer=function(t){this._contentRestorerPool[t.resource.instanceId]=t},i._onSubAssetSuccess=function(t,e){var r;(r=this._subAssetPromiseCallbacks[t])==null||r.resolve(e),delete this._subAssetPromiseCallbacks[t]},i._onSubAssetFail=function(t,e){var r;(r=this._subAssetPromiseCallbacks[t])==null||r.reject(e),delete this._subAssetPromiseCallbacks[t]},i._addAsset=function(t,e){this._assetPool[e.instanceId]=t,this._assetUrlPool[t]=e},i._deleteAsset=function(t){var e=t.instanceId,r=this._assetPool[e];r&&(delete this._assetPool[e],delete this._assetUrlPool[r])},i._addReferResource=function(t){this._referResourcePool[t.instanceId]=t},i._deleteReferResource=function(t){delete this._referResourcePool[t.instanceId]},i._addGraphicResource=function(t){this._graphicResourcePool[t.instanceId]=t},i._deleteGraphicResource=function(t){delete this._graphicResourcePool[t.instanceId]},i._deleteContentRestorer=function(t){delete this._contentRestorerPool[t.instanceId]},i._restoreGraphicResources=function(){var t=this._graphicResourcePool;for(var e in t)t[e]._rebuild()},i._lostGraphicResources=function(){var t=this._graphicResourcePool;for(var e in t)t[e]._isContentLost=!0},i._restoreResourcesContent=function(){var t=this._contentRestorerPool,e=new Array;for(var r in t){var o=t[r],s=o.restoreContent();s&&e.push(s)}return Promise.all(e)},i._destroy=function(){this.cancelNotLoaded(),this._gc(!0),this._assetPool=null,this._assetUrlPool=null,this._referResourcePool=null,this._graphicResourcePool=null,this._contentRestorerPool=null,this._loadingPromises=null},i._assignDefaultOptions=function(t){var e;if(t.type=(e=t.type)!=null?e:n._getTypeByUrl(t.url),t.type===void 0)throw"asset type should be specified: "+t.url;var r;t.retryCount=(r=t.retryCount)!=null?r:this.retryCount;var o;t.timeout=(o=t.timeout)!=null?o:this.timeout;var s;t.retryInterval=(s=t.retryInterval)!=null?s:this.retryInterval;var l;return t.url=(l=t.url)!=null?l:t.urls.join(","),t},i._loadSingleItem=function(t){var e=this,r=this._assignDefaultOptions(typeof t=="string"?{url:t}:t),o=r.url,s=this._virtualPathMap[o]?this._virtualPathMap[o]:o,l=this._parseURL(s),u=l.assetBaseURL,c=l.queryPath,d=c?this._parseQueryPath(c):[],_=this._assetUrlPool[u];if(_)return new Oe(function(A,S,x){x(1),A(e._getResolveResource(_,d))});var f=u;if(c){f+="?q="+d.shift();for(var v;v=d.shift();)f+="["+v+"]"}var p=this._loadingPromises,g=p[f];if(g)return new Oe(function(A,S,x){g.onProgress(function(C){x(C)}).then(function(C){A(C)}).catch(function(C){S(C)})});var m=n._loaders[r.type];if(!m)throw"loader not found: "+r.type;r.url=u;var h=m.load(r,this);if(p[u]=h,h.then(function(A){m.useCache&&e._addAsset(u,A),delete p[u]},function(){return delete p[u]}),c){var y=new Oe(function(A,S){e._pushSubAssetPromiseCallback(f,A,S)});return p[f]=y,y.then(function(){delete p[f]},function(){return delete p[f]}),h.catch(function(A){e._onSubAssetFail(f,A)}),y}return h},i._pushSubAssetPromiseCallback=function(t,e,r){this._subAssetPromiseCallbacks[t]={resolve:e,reject:r}},i._gc=function(t){for(var e=yt.objectValues(this._referResourcePool),r=0,o=e.length;r<o;r++)(!e[r].isGCIgnored||t)&&e[r].destroy(t)},i._getResolveResource=function(t,e){var r=t;if(e)for(var o=0,s=e.length;o<s;o++){var l=e[o];r=r[l]}return r},i._parseURL=function(t){var e=t.split("?"),r=e[0],o=e[1],s=new URLSearchParams(o),l=s.get("q");s.delete("q");var u=s.size>0?r+"?"+s.toString():r;return{assetBaseURL:u,queryPath:l}},i._parseQueryPath=function(t){var e=[];return t.charCodeAt(0)===Zx&&e.push(""),t.replace($x,function(r,o,s,l){var u=r;s?u=l.replace(Kx,"$1"):o&&(u=o.trim()),e.push(u)}),e},i.getResourceByRef=function(t){var e=t.refId,r=t.key,o=t.isClone,s=this._objectPool[e],l;if(s)l=Promise.resolve(s);else{var u,c=(u=this._editorResourceConfig[e])==null?void 0:u.path;if(!c)return ve.warn("refId:"+e+" is not find in this._editorResourceConfig."),Promise.resolve(null);c=r?""+c+(c.indexOf("?")>-1?"&":"?")+"q="+r:c,l=this.load({url:c,type:this._editorResourceConfig[e].type})}return l.then(function(d){return o?d.clone():d})},i.initVirtualResources=function(t){var e=this;t.forEach(function(r){e._virtualPathMap[r.virtualPath]=r.path,e._editorResourceConfig[r.id]=r})},n._addLoader=function(t,e,r){this._loaders[t]=e;for(var o=0,s=r.length;o<s;o++)this._extTypeMapping[r[o].toLowerCase()]=t},n._getTypeByUrl=function(t){var e=t.split("?")[0];return this._extTypeMapping[e.substring(e.lastIndexOf(".")+1).toLowerCase()]},n}();(function(){zo._loaders={}})();(function(){zo._extTypeMapping={}})();function ct(n,i,a){return a===void 0&&(a=!0),function(t){var e=new t(a);zo._addLoader(n,e,i)}}var Zx=46,Kx=/\\(\\)?/g,$x=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),zn;(function(n){n[n.Down=0]="Down",n[n.Move=1]="Move",n[n.Stationary=2]="Stationary",n[n.Up=3]="Up",n[n.Leave=4]="Leave"})(zn||(zn={}));var am=function(){function n(a){this.phase=zn.Leave,this.position=new te,this.deltaPosition=new te,this._events=[],this._upMap=[],this._downMap=[],this._upList=new rt,this._downList=new rt,this.id=a}var i=n.prototype;return i._firePointerExitAndEnter=function(t){var e=this;this._currentEnteredEntity!==t&&(this._currentEnteredEntity&&this._currentEnteredEntity._scripts.forEach(function(r){r.onPointerExit(e)},function(r,o){r._entityScriptsIndex=o}),t&&t._scripts.forEach(function(r){r.onPointerEnter(e)},function(r,o){r._entityScriptsIndex=o}),this._currentEnteredEntity=t)},i._firePointerDown=function(t){var e=this;t&&t._scripts.forEach(function(r){r.onPointerDown(e)},function(r,o){r._entityScriptsIndex=o}),this._currentPressedEntity=t},i._firePointerDrag=function(){var t=this;this._currentPressedEntity&&this._currentPressedEntity._scripts.forEach(function(e){e.onPointerDrag(t)},function(e,r){e._entityScriptsIndex=r})},i._firePointerUpAndClick=function(t){var e=this,r=this,o=r._currentPressedEntity;if(o){var s=o===t;o._scripts.forEach(function(l){s&&l.onPointerClick(e),l.onPointerUp(e)},function(l,u){l._entityScriptsIndex=u}),this._currentPressedEntity=null}},n}(),Co;(function(n){n[n.None=0]="None",n[n.Primary=1]="Primary",n[n.Secondary=2]="Secondary",n[n.Auxiliary=4]="Auxiliary",n[n.XButton1=8]="XButton1",n[n.XButton2=16]="XButton2",n[n.XButton3=32]="XButton3",n[n.XButton4=64]="XButton4",n[n.XButton5=128]="XButton5",n[n.XButton6=256]="XButton6",n[n.XButton7=512]="XButton7",n[n.XButton8=1024]="XButton8"})(Co||(Co={}));var eS=[1,4,2,8,16,32,64,128,256,512,1024],fv={1:0,2:2,4:1,8:3,16:4,32:5,64:6,128:7,256:8,512:9,1024:10},Ki=function(){function n(){}return n._initialize=function(){{if(typeof navigator>"u")return;var a=navigator.userAgent;/iPhone/i.test(a)?n.platform=cn.IPhone:/iPad/i.test(a)?n.platform=cn.IPad:/Android/i.test(a)?n.platform=cn.Android:/Macintosh/i.test(a)&&(n.platform=cn.Mac);var t;switch(n.platform){case cn.IPhone:t=a.match(/OS (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"iPhone OS "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"iPhone OS";break;case cn.IPad:t=a.match(/OS (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"iPad OS "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"iPad OS";break;case cn.Android:t=a.match(/Android (\d+).?(\d+)?.?(\d+)?/),this.operatingSystem=t?"Android "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"Android";break;case cn.Mac:t=a.match(/Mac OS X (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"Mac OS X "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"Mac OS X";break}}},q(n,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),n}();(function(){Ki.platform=cn.Unknown})();(function(){Ki.operatingSystem=""})();Ki._initialize();var ba;(function(n){n[n.Backquote=0]="Backquote",n[n.Backslash=1]="Backslash",n[n.Backspace=2]="Backspace",n[n.BracketLeft=3]="BracketLeft",n[n.BracketRight=4]="BracketRight",n[n.Comma=5]="Comma",n[n.Digit0=6]="Digit0",n[n.Digit1=7]="Digit1",n[n.Digit2=8]="Digit2",n[n.Digit3=9]="Digit3",n[n.Digit4=10]="Digit4",n[n.Digit5=11]="Digit5",n[n.Digit6=12]="Digit6",n[n.Digit7=13]="Digit7",n[n.Digit8=14]="Digit8",n[n.Digit9=15]="Digit9",n[n.Equal=16]="Equal",n[n.IntlBackslash=17]="IntlBackslash",n[n.IntlRo=18]="IntlRo",n[n.IntlYen=19]="IntlYen",n[n.KeyA=20]="KeyA",n[n.KeyB=21]="KeyB",n[n.KeyC=22]="KeyC",n[n.KeyD=23]="KeyD",n[n.KeyE=24]="KeyE",n[n.KeyF=25]="KeyF",n[n.KeyG=26]="KeyG",n[n.KeyH=27]="KeyH",n[n.KeyI=28]="KeyI",n[n.KeyJ=29]="KeyJ",n[n.KeyK=30]="KeyK",n[n.KeyL=31]="KeyL",n[n.KeyM=32]="KeyM",n[n.KeyN=33]="KeyN",n[n.KeyO=34]="KeyO",n[n.KeyP=35]="KeyP",n[n.KeyQ=36]="KeyQ",n[n.KeyR=37]="KeyR",n[n.KeyS=38]="KeyS",n[n.KeyT=39]="KeyT",n[n.KeyU=40]="KeyU",n[n.KeyV=41]="KeyV",n[n.KeyW=42]="KeyW",n[n.KeyX=43]="KeyX",n[n.KeyY=44]="KeyY",n[n.KeyZ=45]="KeyZ",n[n.Minus=46]="Minus",n[n.Period=47]="Period",n[n.Quote=48]="Quote",n[n.Semicolon=49]="Semicolon",n[n.Slash=50]="Slash",n[n.AltLeft=51]="AltLeft",n[n.AltRight=52]="AltRight",n[n.CapsLock=53]="CapsLock",n[n.ContextMenu=54]="ContextMenu",n[n.ControlLeft=55]="ControlLeft",n[n.ControlRight=56]="ControlRight",n[n.Enter=57]="Enter",n[n.MetaLeft=58]="MetaLeft",n[n.MetaRight=59]="MetaRight",n[n.ShiftLeft=60]="ShiftLeft",n[n.ShiftRight=61]="ShiftRight",n[n.Space=62]="Space",n[n.Tab=63]="Tab",n[n.Convert=64]="Convert",n[n.KanaMode=65]="KanaMode",n[n.Lang1=66]="Lang1",n[n.Lang2=67]="Lang2",n[n.Lang3=68]="Lang3",n[n.Lang4=69]="Lang4",n[n.Lang5=70]="Lang5",n[n.NonConvert=71]="NonConvert",n[n.Delete=72]="Delete",n[n.End=73]="End",n[n.Help=74]="Help",n[n.Home=75]="Home",n[n.Insert=76]="Insert",n[n.PageDown=77]="PageDown",n[n.PageUp=78]="PageUp",n[n.ArrowDown=79]="ArrowDown",n[n.ArrowLeft=80]="ArrowLeft",n[n.ArrowRight=81]="ArrowRight",n[n.ArrowUp=82]="ArrowUp",n[n.NumLock=83]="NumLock",n[n.Numpad0=84]="Numpad0",n[n.Numpad1=85]="Numpad1",n[n.Numpad2=86]="Numpad2",n[n.Numpad3=87]="Numpad3",n[n.Numpad4=88]="Numpad4",n[n.Numpad5=89]="Numpad5",n[n.Numpad6=90]="Numpad6",n[n.Numpad7=91]="Numpad7",n[n.Numpad8=92]="Numpad8",n[n.Numpad9=93]="Numpad9",n[n.NumpadAdd=94]="NumpadAdd",n[n.NumpadBackspace=95]="NumpadBackspace",n[n.NumpadClear=96]="NumpadClear",n[n.NumpadClearEntry=97]="NumpadClearEntry",n[n.NumpadComma=98]="NumpadComma",n[n.NumpadDecimal=99]="NumpadDecimal",n[n.NumpadDivide=100]="NumpadDivide",n[n.NumpadEnter=101]="NumpadEnter",n[n.NumpadEqual=102]="NumpadEqual",n[n.NumpadHash=103]="NumpadHash",n[n.NumpadMemoryAdd=104]="NumpadMemoryAdd",n[n.NumpadMemoryClear=105]="NumpadMemoryClear",n[n.NumpadMemoryRecall=106]="NumpadMemoryRecall",n[n.NumpadMemoryStore=107]="NumpadMemoryStore",n[n.NumpadMemorySubtract=108]="NumpadMemorySubtract",n[n.NumpadMultiply=109]="NumpadMultiply",n[n.NumpadParenLeft=110]="NumpadParenLeft",n[n.NumpadParenRight=111]="NumpadParenRight",n[n.NumpadStar=112]="NumpadStar",n[n.NumpadSubtract=113]="NumpadSubtract",n[n.Escape=114]="Escape",n[n.F1=115]="F1",n[n.F2=116]="F2",n[n.F3=117]="F3",n[n.F4=118]="F4",n[n.F5=119]="F5",n[n.F6=120]="F6",n[n.F7=121]="F7",n[n.F8=122]="F8",n[n.F9=123]="F9",n[n.F10=124]="F10",n[n.F11=125]="F11",n[n.F12=126]="F12",n[n.F13=127]="F13",n[n.F14=128]="F14",n[n.F15=129]="F15",n[n.Fn=130]="Fn",n[n.FnLock=131]="FnLock",n[n.PrintScreen=132]="PrintScreen",n[n.ScrollLock=133]="ScrollLock",n[n.Pause=134]="Pause",n[n.BrowserBack=135]="BrowserBack",n[n.BrowserFavorites=136]="BrowserFavorites",n[n.BrowserForward=137]="BrowserForward",n[n.BrowserHome=138]="BrowserHome",n[n.BrowserRefresh=139]="BrowserRefresh",n[n.BrowserSearch=140]="BrowserSearch",n[n.BrowserStop=141]="BrowserStop",n[n.Eject=142]="Eject",n[n.LaunchApp1=143]="LaunchApp1",n[n.LaunchApp2=144]="LaunchApp2",n[n.LaunchMail=145]="LaunchMail",n[n.MediaPlayPause=146]="MediaPlayPause",n[n.MediaSelect=147]="MediaSelect",n[n.MediaStop=148]="MediaStop",n[n.MediaTrackNext=149]="MediaTrackNext",n[n.MediaTrackPrevious=150]="MediaTrackPrevious",n[n.Power=151]="Power",n[n.Sleep=152]="Sleep",n[n.AudioVolumeDown=153]="AudioVolumeDown",n[n.AudioVolumeMute=154]="AudioVolumeMute",n[n.AudioVolumeUp=155]="AudioVolumeUp",n[n.WakeUp=156]="WakeUp",n[n.Hyper=157]="Hyper",n[n.Super=158]="Super",n[n.Turbo=159]="Turbo",n[n.Abort=160]="Abort",n[n.Resume=161]="Resume",n[n.Suspend=162]="Suspend",n[n.Again=163]="Again",n[n.Copy=164]="Copy",n[n.Cut=165]="Cut",n[n.Find=166]="Find",n[n.Open=167]="Open",n[n.Paste=168]="Paste",n[n.Props=169]="Props",n[n.Select=170]="Select",n[n.Undo=171]="Undo",n[n.Hiragana=172]="Hiragana",n[n.Katakana=173]="Katakana",n[n.Unidentified=174]="Unidentified"})(ba||(ba={}));var tS=function(){function n(a){this._curHeldDownKeyToIndexMap=[],this._upKeyToFrameCountMap=[],this._downKeyToFrameCountMap=[],this._curFrameHeldDownList=new rt,this._curFrameDownList=new rt,this._curFrameUpList=new rt,this._nativeEvents=[],this._hadListener=!1;var t=a._canvas._webCanvas;this._engine=a,this._htmlCanvas=t,t.tabIndex=t.tabIndex,this._onKeyEvent=this._onKeyEvent.bind(this),t.addEventListener("keydown",this._onKeyEvent),t.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0}var i=n.prototype;return i._update=function(){var t=this,e=t._nativeEvents,r=t._curFrameDownList,o=t._curFrameUpList;if(r.length=0,o.length=0,e.length>0){for(var s=this._engine.time.frameCount,l=this,u=l._curHeldDownKeyToIndexMap,c=l._curFrameHeldDownList,d=l._downKeyToFrameCountMap,_=l._upKeyToFrameCountMap,f=0,v=e.length;f<v;f++){var p=e[f],g=ba[p.code];switch(p.type){case"keydown":u[g]==null&&(r.add(g),c.add(g),u[g]=c.length-1,d[g]=s);break;case"keyup":var m=u[g];if(m!=null){u[g]=null;var h=c.deleteByIndex(m);h&&(u[h]=m)}if(o.add(g),_[g]=s,Ki.platform===cn.Mac&&(g===ba.MetaLeft||g===ba.MetaRight)){for(var y=0,A=c.length;y<A;y++)u[c.get(y)]=null;c.length=0}break}}e.length=0}},i._onFocus=function(){this._hadListener||(this._htmlCanvas.addEventListener("keydown",this._onKeyEvent),this._htmlCanvas.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0)},i._onBlur=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._curHeldDownKeyToIndexMap.length=0,this._curFrameHeldDownList.length=0,this._curFrameDownList.length=0,this._curFrameUpList.length=0,this._nativeEvents.length=0,this._hadListener=!1)},i._destroy=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._hadListener=!1),this._curHeldDownKeyToIndexMap.length=0,this._curHeldDownKeyToIndexMap=null,this._upKeyToFrameCountMap.length=0,this._upKeyToFrameCountMap=null,this._downKeyToFrameCountMap.length=0,this._downKeyToFrameCountMap=null,this._nativeEvents.length=0,this._nativeEvents=null,this._curFrameHeldDownList.length=0,this._curFrameHeldDownList=null,this._curFrameDownList.length=0,this._curFrameDownList=null,this._curFrameUpList.length=0,this._curFrameUpList=null,this._htmlCanvas=null,this._engine=null},i._onKeyEvent=function(t){this._nativeEvents.push(t)},n}(),Xn;(function(n){n[n.None=0]="None",n[n.Color=1]="Color",n[n.Depth=2]="Depth",n[n.Stencil=4]="Stencil",n[n.ColorDepth=3]="ColorDepth",n[n.ColorStencil=5]="ColorStencil",n[n.DepthStencil=6]="DepthStencil",n[n.All=7]="All"})(Xn||(Xn={}));var Ln=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._index=-1,e._shapes=[],e._updateFlag=e.entity.transform.registerWorldChangeFlag(),e}var a=i.prototype;return a.addShape=function(e){var r=e._collider;r!==this&&(r&&r.removeShape(e),this._shapes.push(e),e._collider=this,this._nativeCollider.addShape(e._nativeShape),this._phasedActiveInScene&&this.scene.physics._addColliderShape(e))},a.removeShape=function(e){var r=this._shapes.indexOf(e);r!==-1&&(this._shapes.splice(r,1),this._phasedActiveInScene&&this.scene.physics._removeColliderShape(e),e._collider=null,this._nativeCollider.removeShape(e._nativeShape))},a.clearShapes=function(){for(var e=this._shapes,r=0,o=e.length;r<o;r++){var s=e[r];this._phasedActiveInScene&&this.scene.physics._removeColliderShape(s),s._destroy(),this._nativeCollider.removeShape(s._nativeShape)}e.length=0},a._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform;this._nativeCollider.setWorldTransform(e.worldPosition,e.worldRotationQuaternion);for(var r=e.lossyWorldScale,o=0,s=this.shapes.length;o<s;o++)this.shapes[o]._nativeShape.setWorldScale(r);this._updateFlag.flag=!1}},a._onLateUpdate=function(){},a._onEnableInScene=function(){var e=this.scene.physics;e._addCollider(this);for(var r=this.shapes,o=0,s=r.length;o<s;o++)e._addColliderShape(r[o])},a._onDisableInScene=function(){var e=this.scene.physics;e._removeCollider(this);for(var r=this.shapes,o=0,s=r.length;o<s;o++)e._removeColliderShape(r[o])},a._cloneTo=function(e){for(var r=e._shapes,o=0,s=r.length;o<s;o++)e._addPhysicsShape(r[o])},a._onDestroy=function(){n.prototype._onDestroy.call(this),this.clearShapes(),this._nativeCollider.destroy()},a._addPhysicsShape=function(e){e._collider=this,this._nativeCollider.addShape(e._nativeShape),this._phasedActiveInScene&&this.scene.physics._addColliderShape(e)},q(i,[{key:"shapes",get:function(){return this._shapes}}]),i}(rn);P([z],Ln.prototype,"_index",void 0);P([z],Ln.prototype,"_nativeCollider",void 0);P([z],Ln.prototype,"_updateFlag",void 0);P([K],Ln.prototype,"_shapes",void 0);Ln=P([ll(ye,za.CheckOnly)],Ln);var nS=function(){},xn=function(){function n(a){var t=this;this._restTime=0,this._fixedTimeStep=1/60,this._colliders=new rt,this._gravity=new M(0,-9.81,0),this._onContactEnter=function(r,o){var s=t._scene.engine._physicalObjectsMap,l=s[r],u=s[o];l.collider.entity._scripts.forEach(function(c){var d=n._collision;d.shape=u,c.onCollisionEnter(d)},function(c,d){c._entityScriptsIndex=d}),u.collider.entity._scripts.forEach(function(c){var d=n._collision;d.shape=l,c.onCollisionEnter(d)},function(c,d){c._entityScriptsIndex=d})},this._onContactExit=function(r,o){var s=t._scene.engine._physicalObjectsMap,l=s[r],u=s[o];l.collider.entity._scripts.forEach(function(c){var d=n._collision;d.shape=u,c.onCollisionExit(d)},function(c,d){c._entityScriptsIndex=d}),u.collider.entity._scripts.forEach(function(c){var d=n._collision;d.shape=l,c.onCollisionExit(d)},function(c,d){c._entityScriptsIndex=d})},this._onContactStay=function(r,o){var s=t._scene.engine._physicalObjectsMap,l=s[r],u=s[o];l.collider.entity._scripts.forEach(function(c){var d=n._collision;d.shape=u,c.onCollisionStay(d)},function(c,d){c._entityScriptsIndex=d}),u.collider.entity._scripts.forEach(function(c){var d=n._collision;d.shape=l,c.onCollisionStay(d)},function(c,d){c._entityScriptsIndex=d})},this._onTriggerEnter=function(r,o){var s=t._scene.engine._physicalObjectsMap,l=s[r],u=s[o];l.collider.entity._scripts.forEach(function(c){c.onTriggerEnter(u)},function(c,d){c._entityScriptsIndex=d}),u.collider.entity._scripts.forEach(function(c){c.onTriggerEnter(l)},function(c,d){c._entityScriptsIndex=d})},this._onTriggerExit=function(r,o){var s=t._scene.engine._physicalObjectsMap,l=s[r],u=s[o];l.collider.entity._scripts.forEach(function(c){c.onTriggerExit(u)},function(c,d){c._entityScriptsIndex=d}),u.collider.entity._scripts.forEach(function(c){c.onTriggerExit(l)},function(c,d){c._entityScriptsIndex=d})},this._onTriggerStay=function(r,o){var s=t._scene.engine._physicalObjectsMap,l=s[r],u=s[o];l.collider.entity._scripts.forEach(function(c){c.onTriggerStay(u)},function(c,d){c._entityScriptsIndex=d}),u.collider.entity._scripts.forEach(function(c){c.onTriggerStay(l)},function(c,d){c._entityScriptsIndex=d})},this._scene=a,this._setGravity=this._setGravity.bind(this),this._gravity._onValueChanged=this._setGravity;var e=a.engine;e._physicsInitialized&&(this._nativePhysicsScene=n._nativePhysics.createPhysicsScene(e._nativePhysicsManager,this._onContactEnter,this._onContactExit,this._onContactStay,this._onTriggerEnter,this._onTriggerExit,this._onTriggerStay))}var i=n.prototype;return i.raycast=function(t,e,r,o){var s=this,l,u=Number.MAX_VALUE;typeof e=="number"?u=e:e!=null&&(l=e);var c=Yn.Everything;typeof r=="number"?c=r:r!=null&&(l=r),o&&(l=o);var d=function(f){var v=s._scene.engine._physicalObjectsMap[f];return v?v.collider.entity.layer&c&&v.isSceneQuery:!1};if(l!=null){var _=this._nativePhysicsScene.raycast(t,u,d,function(f,v,p,g){l.entity=s._scene.engine._physicalObjectsMap[f]._collider.entity,l.distance=v,l.normal.copyFrom(g),l.point.copyFrom(p)});return _?!0:(l.entity=null,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0),!1)}else return this._nativePhysicsScene.raycast(t,u,d)},i._update=function(t){var e=this,r=e._fixedTimeStep,o=e._nativePhysicsScene,s=this._scene._componentsManager,l=this._restTime+t,u=Math.floor(l/r);this._restTime=l-u*r;for(var c=0;c<u;c++)s.callScriptOnPhysicsUpdate(),this._callColliderOnUpdate(),o.update(r),this._callColliderOnLateUpdate()},i._addColliderShape=function(t){this._scene.engine._physicalObjectsMap[t.id]=t,this._nativePhysicsScene.addColliderShape(t._nativeShape)},i._removeColliderShape=function(t){delete this._scene.engine._physicalObjectsMap[t.id],this._nativePhysicsScene.removeColliderShape(t._nativeShape)},i._addCollider=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsScene.addCollider(t._nativeCollider)},i._addCharacterController=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsScene.addCharacterController(t._nativeCollider)},i._removeCollider=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsScene.removeCollider(t._nativeCollider)},i._removeCharacterController=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsScene.removeCharacterController(t._nativeCollider)},i._callColliderOnUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onUpdate()},i._callColliderOnLateUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onLateUpdate()},i._gc=function(){this._colliders.garbageCollection()},i._setGravity=function(){this._nativePhysicsScene.setGravity(this._gravity)},q(n,[{key:"gravity",get:function(){return this._gravity},set:function(t){var e=this._gravity;e!==t&&e.copyFrom(t)}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=Math.max(t,G.zeroTolerance)}}]),n}();(function(){xn._collision=new nS})();var Fu;(function(n){n[n.PreventClimbing=0]="PreventClimbing",n[n.PreventClimbingAndForceSliding=1]="PreventClimbingAndForceSliding"})(Fu||(Fu={}));var rS=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._stepOffset=.5,e._nonWalkableMode=Fu.PreventClimbing,e._upDirection=new M(0,1,0),e._slopeLimit=.707,e._nativeCollider=xn._nativePhysics.createCharacterController(),e._setUpDirection=e._setUpDirection.bind(fe(e)),e._upDirection._onValueChanged=e._setUpDirection,e}var a=i.prototype;return a.move=function(e,r,o){return this._nativeCollider.move(e,r,o)},a.addShape=function(e){if(this._shapes.length>0)throw"only allow single shape on controller!";n.prototype.addShape.call(this,e),this._updateFlag.flag=!0},a.clearShapes=function(){this._shapes.length>0&&n.prototype.removeShape.call(this,this._shapes[0])},a._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform,r=this.shapes;this._nativeCollider.setWorldPosition(e.worldPosition);for(var o=e.lossyWorldScale,s=0,l=r.length;s<l;s++)r[s]._nativeShape.setWorldScale(o);this._updateFlag.flag=!1}},a._onLateUpdate=function(){var e=this.entity.transform.worldPosition;this._nativeCollider.getWorldPosition(e),this._updateFlag.flag=!1},a._onEnableInScene=function(){var e=this.scene.physics;e._addCharacterController(this);for(var r=this.shapes,o=0,s=r.length;o<s;o++)e._addColliderShape(r[o])},a._onDisableInScene=function(){var e=this.scene.physics;e._removeCharacterController(this);for(var r=this.shapes,o=0,s=r.length;o<s;o++)e._removeColliderShape(r[o])},a._setUpDirection=function(){this._nativeCollider.setUpDirection(this._upDirection)},q(i,[{key:"stepOffset",get:function(){return this._stepOffset},set:function(e){this._stepOffset!==e&&(this._stepOffset=e,this._nativeCollider.setStepOffset(e))}},{key:"nonWalkableMode",get:function(){return this._nonWalkableMode},set:function(e){this._nonWalkableMode!==e&&(this._nonWalkableMode=e,this._nativeCollider.setNonWalkableMode(e))}},{key:"upDirection",get:function(){return this._upDirection},set:function(e){this._upDirection!==e&&this._upDirection.copyFrom(e)}},{key:"slopeLimit",get:function(){return this._slopeLimit},set:function(e){this._slopeLimit!==e&&(this._slopeLimit=e,this._nativeCollider.setSlopeLimit(e))}}]),i}(Ln),Sn=function(n){W(i,n);function i(t){var e;e=n.call(this,t)||this,e._linearDamping=0,e._angularDamping=.05,e._linearVelocity=new M,e._angularVelocity=new M,e._mass=1,e._centerOfMass=new M,e._inertiaTensor=new M(1,1,1),e._maxAngularVelocity=100,e._maxDepenetrationVelocity=1e3,e._solverIterations=4,e._isKinematic=!1,e._constraints=0,e._collisionDetectionMode=0,e._sleepThreshold=.005;var r=e.entity.transform;return e._nativeCollider=xn._nativePhysics.createDynamicCollider(r.worldPosition,r.worldRotationQuaternion),e._setLinearVelocity=e._setLinearVelocity.bind(fe(e)),e._setAngularVelocity=e._setAngularVelocity.bind(fe(e)),e._setCenterOfMass=e._setCenterOfMass.bind(fe(e)),e._setInertiaTensor=e._setInertiaTensor.bind(fe(e)),e._linearVelocity._onValueChanged=e._setLinearVelocity,e._angularVelocity._onValueChanged=e._setAngularVelocity,e._centerOfMass._onValueChanged=e._setCenterOfMass,e._inertiaTensor._onValueChanged=e._setInertiaTensor,e}var a=i.prototype;return a.applyForce=function(e){this._nativeCollider.addForce(e)},a.applyTorque=function(e){this._nativeCollider.addTorque(e)},a.move=function(e,r){this._nativeCollider.move(e,r)},a.sleep=function(){this._nativeCollider.sleep()},a.wakeUp=function(){this._nativeCollider.wakeUp()},a._onLateUpdate=function(){var e=this.entity.transform,r=e.worldPosition,o=e.worldRotationQuaternion;this._nativeCollider.getWorldTransform(r,o),this._updateFlag.flag=!1},a._cloneTo=function(e){n.prototype._cloneTo.call(this,e),e.linearDamping=this.linearDamping,e.angularDamping=this.angularDamping,e.linearVelocity=this.linearVelocity,e.angularVelocity=this.angularVelocity,e.mass=this.mass,e.centerOfMass=this.centerOfMass,e.inertiaTensor=this.inertiaTensor,e.maxAngularVelocity=this.maxAngularVelocity,e.maxDepenetrationVelocity=this.maxDepenetrationVelocity,e.sleepThreshold=this.sleepThreshold,e.solverIterations=this.solverIterations,e.isKinematic=this.isKinematic,e.constraints=this.constraints,e.collisionDetectionMode=this.collisionDetectionMode},a._setLinearVelocity=function(){this._nativeCollider.setLinearVelocity(this._linearVelocity)},a._setAngularVelocity=function(){this._nativeCollider.setAngularVelocity(this._angularVelocity)},a._setCenterOfMass=function(){this._nativeCollider.setCenterOfMass(this._centerOfMass)},a._setInertiaTensor=function(){this._nativeCollider.setInertiaTensor(this._inertiaTensor)},q(i,[{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping!==e&&(this._linearDamping=e,this._nativeCollider.setLinearDamping(e))}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping!==e&&(this._angularDamping=e,this._nativeCollider.setAngularDamping(e))}},{key:"linearVelocity",get:function(){return this._linearVelocity},set:function(e){this._linearVelocity!==e&&this._linearVelocity.copyFrom(e)}},{key:"angularVelocity",get:function(){return this._angularVelocity},set:function(e){this._angularVelocity!==e&&this._angularVelocity.copyFrom(e)}},{key:"mass",get:function(){return this._mass},set:function(e){this._mass!==e&&(this._mass=e,this._nativeCollider.setMass(e))}},{key:"centerOfMass",get:function(){return this._centerOfMass},set:function(e){this._centerOfMass!==e&&this._centerOfMass.copyFrom(e)}},{key:"inertiaTensor",get:function(){return this._inertiaTensor},set:function(e){this._inertiaTensor!==e&&this._inertiaTensor.copyFrom(e)}},{key:"maxAngularVelocity",get:function(){return this._maxAngularVelocity},set:function(e){this._maxAngularVelocity!==e&&(this._maxAngularVelocity=e,this._nativeCollider.setMaxAngularVelocity(e))}},{key:"maxDepenetrationVelocity",get:function(){return this._maxDepenetrationVelocity},set:function(e){this._maxDepenetrationVelocity!==e&&(this._maxDepenetrationVelocity=e,this._nativeCollider.setMaxDepenetrationVelocity(e))}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(e){e!==this._sleepThreshold&&(this._sleepThreshold=e,this._nativeCollider.setSleepThreshold(e))}},{key:"solverIterations",get:function(){return this._solverIterations},set:function(e){this._solverIterations!==e&&(this._solverIterations=e,this._nativeCollider.setSolverIterations(e))}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic!==e&&(this._isKinematic=e,this._nativeCollider.setIsKinematic(e))}},{key:"constraints",get:function(){return this._constraints},set:function(e){this._constraints!==e&&(this._constraints=e,this._nativeCollider.setConstraints(e))}},{key:"collisionDetectionMode",get:function(){return this._collisionDetectionMode},set:function(e){this._collisionDetectionMode!==e&&(this._collisionDetectionMode=e,this._nativeCollider.setCollisionDetectionMode(e))}}]),i}(Ln);P([z],Sn.prototype,"_linearDamping",void 0);P([z],Sn.prototype,"_angularDamping",void 0);P([z],Sn.prototype,"_linearVelocity",void 0);P([z],Sn.prototype,"_angularVelocity",void 0);P([z],Sn.prototype,"_mass",void 0);P([z],Sn.prototype,"_centerOfMass",void 0);P([z],Sn.prototype,"_inertiaTensor",void 0);P([z],Sn.prototype,"_maxAngularVelocity",void 0);P([z],Sn.prototype,"_maxDepenetrationVelocity",void 0);P([z],Sn.prototype,"_solverIterations",void 0);P([z],Sn.prototype,"_isKinematic",void 0);P([z],Sn.prototype,"_constraints",void 0);P([z],Sn.prototype,"_collisionDetectionMode",void 0);P([z],Sn.prototype,"_sleepThreshold",void 0);var c_;(function(n){n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous",n[n.ContinuousDynamic=2]="ContinuousDynamic",n[n.ContinuousSpeculative=3]="ContinuousSpeculative"})(c_||(c_={}));var d_;(function(n){n[n.None=0]="None",n[n.FreezePositionX=1]="FreezePositionX",n[n.FreezePositionY=2]="FreezePositionY",n[n.FreezePositionZ=4]="FreezePositionZ",n[n.FreezeRotationX=8]="FreezeRotationX",n[n.FreezeRotationY=16]="FreezeRotationY",n[n.FreezeRotationZ=32]="FreezeRotationZ"})(d_||(d_={}));var om=function(){this.entity=null,this.distance=0,this.point=new M,this.normal=new M},js;(function(n){n[n.Average=0]="Average",n[n.Minimum=1]="Minimum",n[n.Multiply=2]="Multiply",n[n.Maximum=3]="Maximum"})(js||(js={}));var sm=function(){function n(){this._bounciness=.1,this._dynamicFriction=.1,this._staticFriction=.1,this._bounceCombine=js.Average,this._frictionCombine=js.Average,this._nativeMaterial=xn._nativePhysics.createPhysicsMaterial(this._staticFriction,this._dynamicFriction,this._bounciness,this._bounceCombine,this._frictionCombine)}var i=n.prototype;return i._destroy=function(){!this._destroyed&&this._nativeMaterial.destroy(),this._destroyed=!0},q(n,[{key:"bounciness",get:function(){return this._bounciness},set:function(t){this._bounciness!==t&&(this._bounciness=t,this._nativeMaterial.setBounciness(t))}},{key:"dynamicFriction",get:function(){return this._dynamicFriction},set:function(t){this._dynamicFriction!==t&&(this._dynamicFriction=t,this._nativeMaterial.setDynamicFriction(t))}},{key:"staticFriction",get:function(){return this._staticFriction},set:function(t){this._staticFriction!==t&&(this._staticFriction=t,this._nativeMaterial.setStaticFriction(t))}},{key:"bounceCombine",get:function(){return this._bounceCombine},set:function(t){this._bounceCombine!==t&&(this._bounceCombine=t,this._nativeMaterial.setBounceCombine(t))}},{key:"frictionCombine",get:function(){return this._frictionCombine},set:function(t){this._frictionCombine!==t&&(this._frictionCombine=t,this._nativeMaterial.setFrictionCombine(t))}}]),n}(),__=function(n){W(i,n);function i(a){var t;t=n.call(this,a)||this;var e=t.entity.transform;return t._nativeCollider=xn._nativePhysics.createStaticCollider(e.worldPosition,e.worldRotationQuaternion),t}return i}(Ln),Ou;(function(n){n[n.X=0]="X",n[n.Y=1]="Y",n[n.Z=2]="Z"})(Ou||(Ou={}));var f_;(function(n){n[n.Sides=1]="Sides",n[n.Up=2]="Up",n[n.Down=4]="Down"})(f_||(f_={}));var Or=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._colliderInfo=new hv,e._connectedColliderInfo=new hv,e._force=0,e._torque=0,e._connectedColliderInfo.localPosition=new M,e}var a=i.prototype;return a._cloneTo=function(e){e.connectedCollider=this.connectedCollider,e.connectedAnchor=this.connectedAnchor,e.connectedMassScale=this.connectedMassScale,e.connectedInertiaScale=this.connectedInertiaScale,e.massScale=this.massScale,e.inertiaScale=this.inertiaScale,e.breakForce=this.breakForce,e.breakTorque=this.breakTorque},q(i,[{key:"connectedCollider",get:function(){return this._connectedColliderInfo.collider},set:function(e){this._connectedColliderInfo.collider!==e&&(this._connectedColliderInfo.collider=e,this._nativeJoint.setConnectedCollider(e._nativeCollider))}},{key:"connectedAnchor",get:function(){return this._connectedColliderInfo.localPosition},set:function(e){var r=this._connectedColliderInfo.localPosition;e!==r&&r.copyFrom(e),this._nativeJoint.setConnectedAnchor(e)}},{key:"connectedMassScale",get:function(){return this._connectedColliderInfo.massScale},set:function(e){e!==this._connectedColliderInfo.massScale&&(this._connectedColliderInfo.massScale=e,this._nativeJoint.setConnectedMassScale(e))}},{key:"connectedInertiaScale",get:function(){return this._connectedColliderInfo.inertiaScale},set:function(e){e!==this._connectedColliderInfo.inertiaScale&&(this._connectedColliderInfo.inertiaScale=e,this._nativeJoint.setConnectedInertiaScale(e))}},{key:"massScale",get:function(){return this._colliderInfo.massScale},set:function(e){e!==this._colliderInfo.massScale&&(this._colliderInfo.massScale=e,this._nativeJoint.setMassScale(e))}},{key:"inertiaScale",get:function(){return this._colliderInfo.inertiaScale},set:function(e){e!==this._colliderInfo.inertiaScale&&(this._colliderInfo.inertiaScale=e,this._nativeJoint.setInertiaScale(e))}},{key:"breakForce",get:function(){return this._force},set:function(e){e!==this._force&&(this._force=e,this._nativeJoint.setBreakForce(e))}},{key:"breakTorque",get:function(){return this._torque},set:function(e){e!==this._torque&&(this._torque=e,this._nativeJoint.setBreakTorque(e))}}]),i}(rn);P([z],Or.prototype,"_colliderInfo",void 0);P([z],Or.prototype,"_connectedColliderInfo",void 0);P([z],Or.prototype,"_nativeJoint",void 0);P([z],Or.prototype,"_force",void 0);P([z],Or.prototype,"_torque",void 0);Or=P([ll(Ln,za.CheckOnly)],Or);var hv=function(){this.collider=null,this.massScale=0,this.inertiaScale=0},iS=function(n){W(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a._onAwake=function(){var e=this._colliderInfo;e.collider=this.entity.getComponent(Ln),this._nativeJoint=xn._nativePhysics.createFixedJoint(e.collider._nativeCollider)},i}(Or),Cn;(function(n){n[n.None=0]="None",n[n.LimitEnabled=1]="LimitEnabled",n[n.DriveEnabled=2]="DriveEnabled",n[n.DriveFreeSpin=4]="DriveFreeSpin"})(Cn||(Cn={}));var jo=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._axis=new M(1,0,0),t._hingeFlags=Cn.None,t._useSpring=!1,t}var a=i.prototype;return a._onAwake=function(){var e=this._colliderInfo;e.localPosition=new M,e.collider=this.entity.getComponent(Ln),this._nativeJoint=xn._nativePhysics.createHingeJoint(e.collider._nativeCollider)},a._cloneTo=function(e){e.axis=this.axis,e.swingOffset=this.swingOffset,e.useLimits=this.useLimits,e.useMotor=this.useMotor,e.useSpring=this.useSpring,e.motor=this.motor,e.limits=this.limits},q(i,[{key:"axis",get:function(){return this._axis},set:function(e){var r=this._axis;e!==r&&r.copyFrom(e),this._nativeJoint.setAxis(r)}},{key:"swingOffset",get:function(){return this._colliderInfo.localPosition},set:function(e){var r=this._colliderInfo.localPosition;e!==r&&r.copyFrom(e),this._nativeJoint.setSwingOffset(r)}},{key:"angle",get:function(){return this._nativeJoint.getAngle()}},{key:"velocity",get:function(){return this._nativeJoint.getVelocity()}},{key:"useLimits",get:function(){return(this._hingeFlags&Cn.LimitEnabled)==Cn.LimitEnabled},set:function(e){e!==this.useLimits&&(e?this._hingeFlags|=Cn.LimitEnabled:this._hingeFlags&=~Cn.LimitEnabled,this._nativeJoint.setHingeJointFlag(Cn.LimitEnabled,e))}},{key:"useMotor",get:function(){return(this._hingeFlags&Cn.DriveEnabled)==Cn.DriveEnabled},set:function(e){e!==this.useMotor&&(e?this._hingeFlags|=Cn.DriveEnabled:this._hingeFlags&=~Cn.DriveEnabled,this._nativeJoint.setHingeJointFlag(Cn.DriveEnabled,e))}},{key:"useSpring",get:function(){return this._useSpring},set:function(e){this._useSpring!==e&&(this._useSpring=e,this.limits=this._limits)}},{key:"motor",get:function(){return this._jointMonitor},set:function(e){this._jointMonitor!==e&&(this._jointMonitor=e,this._nativeJoint.setDriveVelocity(e.targetVelocity),this._nativeJoint.setDriveForceLimit(e.forceLimit),this._nativeJoint.setDriveGearRatio(e.gearRation),this._nativeJoint.setHingeJointFlag(Cn.DriveFreeSpin,e.freeSpin))}},{key:"limits",get:function(){return this._limits},set:function(e){this._limits!==e&&(this._limits=e,this.useSpring?this._nativeJoint.setSoftLimit(e.min,e.max,e.stiffness,e.damping):this._nativeJoint.setHardLimit(e.min,e.max,e.contactDistance))}}]),i}(Or);P([z],jo.prototype,"_axis",void 0);P([z],jo.prototype,"_hingeFlags",void 0);P([z],jo.prototype,"_useSpring",void 0);P([z],jo.prototype,"_jointMonitor",void 0);P([z],jo.prototype,"_limits",void 0);var aS=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._minDistance=0,t._maxDistance=0,t._tolerance=.25,t._stiffness=0,t._damping=0,t}var a=i.prototype;return a._onAwake=function(){var e=this._colliderInfo;e.localPosition=new M,e.collider=this.entity.getComponent(Ln),this._nativeJoint=xn._nativePhysics.createSpringJoint(e.collider._nativeCollider)},a._cloneTo=function(e){e.swingOffset=this.swingOffset,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.tolerance=this.tolerance,e.stiffness=this.stiffness,e.damping=this.damping},q(i,[{key:"swingOffset",get:function(){return this._colliderInfo.localPosition},set:function(e){var r=this._colliderInfo.localPosition;e!==r&&r.copyFrom(e),this._nativeJoint.setSwingOffset(e)}},{key:"minDistance",get:function(){return this._minDistance},set:function(e){this._minDistance!==e&&(this._minDistance=e,this._nativeJoint.setMinDistance(e))}},{key:"maxDistance",get:function(){return this._maxDistance},set:function(e){this._maxDistance!==e&&(this._maxDistance=e,this._nativeJoint.setMaxDistance(e))}},{key:"tolerance",get:function(){return this._tolerance},set:function(e){this._tolerance!==e&&(this._tolerance=e,this._nativeJoint.setTolerance(e))}},{key:"stiffness",get:function(){return this._stiffness},set:function(e){this._stiffness!==e&&(this._stiffness=e,this._nativeJoint.setStiffness(e))}},{key:"damping",get:function(){return this._damping},set:function(e){this._damping!==e&&(this._damping=e,this._nativeJoint.setDamping(e))}}]),i}(Or),oS=function(){this.max=0,this.min=0,this.contactDistance=-1,this.stiffness=0,this.damping=0},sS=function(){this.targetVelocity=0,this.forceLimit=Number.MAX_VALUE,this.gearRation=1,this.freeSpin=!1},Vn=function(){function n(){this._isTrigger=!1,this._rotation=new M,this._position=new M,this._contactOffset=.02,this.isSceneQuery=!0,this._material=new sm,this._id=n._idGenerator++,this._setRotation=this._setRotation.bind(this),this._setPosition=this._setPosition.bind(this),this._rotation._onValueChanged=this._setRotation,this._position._onValueChanged=this._setPosition}var i=n.prototype;return i._cloneTo=function(t){t.contactOffset=this.contactOffset,t.rotation=this.rotation,t.position=this.position,t.isTrigger=this.isTrigger,t.material=this.material},i._destroy=function(){this._material._destroy(),this._nativeShape.destroy()},i._setPosition=function(){this._nativeShape.setPosition(this._position)},i._setRotation=function(){this._nativeShape.setRotation(this._rotation)},q(n,[{key:"collider",get:function(){return this._collider}},{key:"id",get:function(){return this._id}},{key:"contactOffset",get:function(){return this._contactOffset},set:function(t){this._contactOffset!==t&&(this._contactOffset=t,this._nativeShape.setContactOffset(t))}},{key:"material",get:function(){return this._material},set:function(t){this._material!==t&&(this._material=t,this._nativeShape.setMaterial(t._nativeMaterial))}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation!=t&&this._rotation.copyFrom(t)}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t)}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger!==t&&(this._isTrigger=t,this._nativeShape.setIsTrigger(t))}}]),n}();(function(){Vn._idGenerator=0})();P([z],Vn.prototype,"_collider",void 0);P([z],Vn.prototype,"_nativeShape",void 0);P([z],Vn.prototype,"_id",void 0);P([z],Vn.prototype,"_material",void 0);P([z],Vn.prototype,"_isTrigger",void 0);P([z],Vn.prototype,"_rotation",void 0);P([z],Vn.prototype,"_position",void 0);P([z],Vn.prototype,"_contactOffset",void 0);var zu=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t._size=new M(1,1,1),t._nativeShape=xn._nativePhysics.createBoxColliderShape(t._id,t._size,t._material._nativeMaterial),t._setSize=t._setSize.bind(fe(t)),t._size._onValueChanged=t._setSize,t}var a=i.prototype;return a._cloneTo=function(e){n.prototype._cloneTo.call(this,e),e.size=this.size},a._setSize=function(){this._nativeShape.setSize(this._size)},q(i,[{key:"size",get:function(){return this._size},set:function(e){this._size!==e&&this._size.copyFrom(e)}}]),i}(Vn);P([z],zu.prototype,"_size",void 0);var lm=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t._radius=1,t._nativeShape=xn._nativePhysics.createSphereColliderShape(t._id,t._radius,t._material._nativeMaterial),t}var a=i.prototype;return a._cloneTo=function(e){n.prototype._cloneTo.call(this,e),e.radius=this.radius},q(i,[{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._nativeShape.setRadius(e))}}]),i}(Vn);P([z],lm.prototype,"_radius",void 0);var lS=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._nativeShape=xn._nativePhysics.createPlaneColliderShape(a._id,a._material._nativeMaterial),a}return i}(Vn),Ec=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t._radius=1,t._height=2,t._upAxis=Ou.Y,t._nativeShape=xn._nativePhysics.createCapsuleColliderShape(t._id,t._radius,t._height,t._material._nativeMaterial),t}var a=i.prototype;return a._cloneTo=function(e){n.prototype._cloneTo.call(this,e),e.radius=this.radius,e.height=this.height,e.upAxis=this.upAxis},q(i,[{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._nativeShape.setRadius(e))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._nativeShape.setHeight(e))}},{key:"upAxis",get:function(){return this._upAxis},set:function(e){this._upAxis!==e&&(this._upAxis=e,this._nativeShape.setUpAxis(e))}}]),i}(Vn);P([z],Ec.prototype,"_radius",void 0);P([z],Ec.prototype,"_height",void 0);P([z],Ec.prototype,"_upAxis",void 0);var wc=function(){function n(a){this._pointers=[],this._multiPointerEnabled=!0,this._buttons=Co.None,this._upMap=[],this._downMap=[],this._upList=new rt,this._downList=new rt,this._nativeEvents=[],this._hadListener=!1;var t=a._canvas._webCanvas;this._engine=a,this._canvas=a.canvas,this._htmlCanvas=t,this._onPointerEvent=this._onPointerEvent.bind(this),this._onFocus(),this._pointerPool=new Array(11)}var i=n.prototype;return i._update=function(){for(var t=this,e=t._pointers,r=t._nativeEvents,o=t._htmlCanvas,s=this._canvas,l=s.width,u=s.height,c=o.clientWidth,d=o.clientHeight,_=o.getBoundingClientRect(),f=_.left,v=_.top,p=l/c,g=u/d,m=e.length-1;m>=0;m--)e[m].phase===zn.Leave&&e.splice(m,1);for(var h=0,y=r.length;h<y;h++){var A=r[h],S=A.pointerId,x=this._getPointerByID(S);if(x)x._events.push(A);else{var C=e.length;if(C===0||this._multiPointerEnabled){for(var E,T,w=this,R=w._pointerPool,b=0;b<C&&!(e[b].id>b);b++);x=(E=R)[T=b]||(E[T]=new am(b)),x._uniqueID=S,x._events.push(A),x.position.set((A.clientX-f)*p,(A.clientY-v)*g),e.splice(b,0,x)}}}r.length=0,this._upList.length=this._downList.length=0,this._buttons=Co.None;for(var B=this._engine.time.frameCount,I=0,V=e.length;I<V;I++){var L=e[I];L._upList.length=L._downList.length=0,this._updatePointerInfo(B,L,f,v,p,g),this._buttons|=L.pressedButtons}},i._firePointerScript=function(t){for(var e=this,r=e._pointers,o=e._canvas,s=0,l=r.length;s<l;s++){var u=r[s],c=u._events,d=u.position;u._firePointerDrag();var _=this._pointerRayCast(t,d.x/o.width,d.y/o.height);u._firePointerExitAndEnter(_);var f=c.length;if(f>0){for(var v=0;v<f;v++)switch(c[v].type){case"pointerdown":u.phase=zn.Down,u._firePointerDown(_);break;case"pointerup":u.phase=zn.Up,u._firePointerUpAndClick(_);break;case"pointerleave":case"pointercancel":u.phase=zn.Leave,u._firePointerExitAndEnter(null);break}c.length=0}}},i._onFocus=function(){if(!this._hadListener){var t=this,e=t._htmlCanvas,r=t._onPointerEvent;e.addEventListener("pointerdown",r),e.addEventListener("pointerup",r),e.addEventListener("pointerleave",r),e.addEventListener("pointermove",r),e.addEventListener("pointercancel",r),this._hadListener=!0}},i._onBlur=function(){if(this._hadListener){var t=this,e=t._htmlCanvas,r=t._onPointerEvent;e.removeEventListener("pointerdown",r),e.removeEventListener("pointerup",r),e.removeEventListener("pointerleave",r),e.removeEventListener("pointermove",r),e.removeEventListener("pointercancel",r),this._hadListener=!1,this._pointers.length=0,this._downList.length=0,this._upList.length=0}},i._destroy=function(){if(this._hadListener){var t=this,e=t._htmlCanvas,r=t._onPointerEvent;e.removeEventListener("pointerdown",r),e.removeEventListener("pointerup",r),e.removeEventListener("pointerleave",r),e.removeEventListener("pointermove",r),e.removeEventListener("pointercancel",r),this._hadListener=!1}this._pointerPool.length=0,this._pointerPool=null,this._pointers.length=0,this._pointers=null,this._downList.length=0,this._downList=null,this._upList.length=0,this._upList=null,this._nativeEvents.length=0,this._nativeEvents=null,this._upMap.length=0,this._upMap=null,this._downMap.length=0,this._downMap=null,this._htmlCanvas=null,this._canvas=null,this._engine=null},i._onPointerEvent=function(t){t.type==="pointerdown"&&this._htmlCanvas.focus(),this._nativeEvents.push(t)},i._getPointerByID=function(t){for(var e=this,r=e._pointers,o=r.length-1;o>=0;o--)if(r[o]._uniqueID===t)return r[o];return null},i._updatePointerInfo=function(t,e,r,o,s,l){var u=e._events,c=e.position,d=u.length;if(d>0){var _=this,f=_._upList,v=_._upMap,p=_._downList,g=_._downMap,m=u[d-1],h=(m.clientX-r)*s,y=(m.clientY-o)*l;e.deltaPosition.set(h-c.x,y-c.y),c.set(h,y);for(var A=0;A<d;A++){var S=u[A],x=S.button;switch(e.button=eS[x]||Co.None,e.pressedButtons=S.buttons,S.type){case"pointerdown":p.add(x),g[x]=t,e._downList.add(x),e._downMap[x]=t,e.phase=zn.Down;break;case"pointerup":f.add(x),v[x]=t,e._upList.add(x),e._upMap[x]=t,e.phase=zn.Up;break;case"pointermove":e.phase=zn.Move;break;case"pointerleave":case"pointercancel":e.phase=zn.Leave}}this._engine._physicsInitialized||(u.length=0)}else e.deltaPosition.set(0,0),e.phase=zn.Stationary},i._pointerRayCast=function(t,e,r){for(var o=n._tempPoint,s=n._tempRay,l=n._tempHitResult,u=t.length-1;u>=0;u--){var c=t[u];if(!(!c.isActive||c.destroyed))for(var d=c._activeCameras,_=d.length-1;_>=0;_--){var f=d[_];if(!(!f.enabled||f.renderTarget)){var v=f.viewport,p=v.x,g=v.y,m=v.z,h=v.w;if(e>=p&&r>=g&&e-p<=m&&r-g<=h){if(o.set((e-p)/m,(r-g)/h),c.physics.raycast(f.viewportPointToRay(o,s),Number.MAX_VALUE,f.cullingMask,l))return l.entity;if(f.clearFlags&Xn.Color)return null}}}}return null},n}();(function(){wc._tempRay=new q0})();(function(){wc._tempPoint=new te})();(function(){wc._tempHitResult=new om})();var uS=function(){function n(a){this._delta=new M,this._nativeEvents=[];var t=a._canvas._webCanvas;this._onWheelEvent=this._onWheelEvent.bind(this),t.addEventListener("wheel",this._onWheelEvent),this._canvas=t,this._hadListener=!0}var i=n.prototype;return i._update=function(){var t=this,e=t._delta;e.set(0,0,0);var r=this,o=r._nativeEvents;if(o.length>0){for(var s=o.length-1;s>=0;s--){var l=o[s];e.x+=l.deltaX,e.y+=l.deltaY,e.z+=l.deltaZ}o.length=0}},i._onFocus=function(){this._hadListener||(this._canvas.addEventListener("wheel",this._onWheelEvent),this._hadListener=!0)},i._onBlur=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._nativeEvents.length=0,this._delta.set(0,0,0),this._hadListener=!1)},i._destroy=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._hadListener=!1),this._nativeEvents=null,this._canvas=null,this._delta=null},i._onWheelEvent=function(t){t.cancelable&&t.preventDefault(),this._nativeEvents.push(t)},n}(),um=function(){function n(a){this._initialized=!1,this._engine=a;var t=a._canvas._webCanvas;(typeof OffscreenCanvas>"u"||!gt(t,OffscreenCanvas))&&(this._wheelManager=new uS(a),this._pointerManager=new wc(a),this._keyboardManager=new tS(a),this._onBlur=this._onBlur.bind(this),window.addEventListener("blur",this._onBlur),this._onFocus=this._onFocus.bind(this),window.addEventListener("focus",this._onFocus),this._initialized=!0)}var i=n.prototype;return i.isKeyHeldDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameHeldDownList.length>0:this._keyboardManager._curHeldDownKeyToIndexMap[t]!=null:!1},i.isKeyDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameDownList.length>0:this._keyboardManager._downKeyToFrameCountMap[t]===this._engine.time.frameCount:!1},i.isKeyUp=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameUpList.length>0:this._keyboardManager._upKeyToFrameCountMap[t]===this._engine.time.frameCount:!1},i.isPointerHeldDown=function(t){return this._initialized?t===void 0?this._pointerManager._buttons!==0:(this._pointerManager._buttons&t)!==0:!1},i.isPointerDown=function(t){return this._initialized?t===void 0?this._pointerManager._downList.length>0:this._pointerManager._downMap[fv[t]]===this._engine.time.frameCount:!1},i.isPointerUp=function(t){return this._initialized?t===void 0?this._pointerManager._upList.length>0:this._pointerManager._upMap[fv[t]]===this._engine.time.frameCount:!1},i._update=function(){this._initialized&&(this._wheelManager._update(),this._pointerManager._update(),this._keyboardManager._update())},i._firePointerScript=function(t){this._initialized&&this._pointerManager._firePointerScript(t)},i._destroy=function(){this._initialized&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._wheelManager._destroy(),this._wheelManager=null,this._pointerManager._destroy(),this._pointerManager=null,this._keyboardManager._destroy(),this._keyboardManager=null)},i._onBlur=function(){this._wheelManager._onBlur(),this._pointerManager._onBlur(),this._keyboardManager._onBlur()},i._onFocus=function(){this._wheelManager._onFocus(),this._pointerManager._onFocus(),this._keyboardManager._onFocus()},q(n,[{key:"pointers",get:function(){return this._initialized?this._pointerManager._pointers:[]}},{key:"multiPointerEnabled",get:function(){return this._initialized?this._pointerManager._multiPointerEnabled:!1},set:function(t){this._initialized&&(this._pointerManager._multiPointerEnabled=t)}},{key:"wheelDelta",get:function(){return this._initialized?this._wheelManager._delta:null}}]),n}(),Lr=function(n){W(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r._renderStates=[],r._shaderData=new ri(br.Material),r.shader=e,r}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){e.shader=this.shader,this.shaderData.cloneTo(e.shaderData),_r.deepCloneObject(this.renderStates,e.renderStates)},a._addReferCount=function(e){this._destroyed||(n.prototype._addReferCount.call(this,e),this.shaderData._addReferCount(e))},a._onDestroy=function(){n.prototype._onDestroy.call(this),this._shader=null,this._shaderData=null,this._renderStates.length=0,this._renderStates=null},q(i,[{key:"shaderData",get:function(){return this._shaderData}},{key:"shader",get:function(){return this._shader},set:function(e){this._shader=e;for(var r=this._renderStates,o=r.length,s=0,l=e.subShaders,u=0;u<l.length;u++)s=Math.max(l[u].passes.length,s);if(o<s)for(var c=o;c<s;c++)r.push(new Kr);else r.length=s}},{key:"renderState",get:function(){return this._renderStates[0]}},{key:"renderStates",get:function(){return this._renderStates}}]),i}(ni),h_;(function(n){n.cornerTextureCoordinate="a_CornerTextureCoordinate"})(h_||(h_={}));var On;(function(n){n.ShapePositionStartLifeTime="a_ShapePositionStartLifeTime",n.DirectionTime="a_DirectionTime",n.StartColor="a_StartColor",n.StartSize="a_StartSize",n.StartRotation0="a_StartRotation0",n.StartSpeed="a_StartSpeed",n.Random0="a_Random0",n.Random1="a_Random1",n.SimulationWorldPosition="a_SimulationWorldPosition",n.SimulationWorldRotation="a_SimulationWorldRotation",n.SimulationUV="a_SimulationUV"})(On||(On={}));var cS=function(){function n(a){this.billboardVertexElement=new Le(h_.cornerTextureCoordinate,0,ie.Vector4,0),this.instanceVertexElements=[new Le(On.ShapePositionStartLifeTime,0,ie.Vector4,1,1),new Le(On.DirectionTime,16,ie.Vector4,1,1),new Le(On.StartColor,32,ie.Vector4,1,1),new Le(On.StartSize,48,ie.Vector3,1,1),new Le(On.StartRotation0,60,ie.Vector3,1,1),new Le(On.StartSpeed,72,ie.Float,1,1),new Le(On.Random0,76,ie.Vector4,1,1),new Le(On.Random1,92,ie.Vector4,1,1),new Le(On.SimulationWorldPosition,108,ie.Vector3,1,1),new Le(On.SimulationWorldRotation,120,ie.Vector4,1,1),new Le(On.SimulationUV,136,ie.Vector4,1,1)],this.instanceVertexStride=152,this.instanceVertexFloatStride=this.instanceVertexStride/4,this.startLifeTimeOffset=3,this.timeOffset=7,this.simulationUVOffset=34,this.billboardIndexCount=6;var t=16,e=new qn(a,vn.VertexBuffer,t*4,mt.Static,!1);this.billboardVertexBufferBinding=new ka(e,t);var r=new qn(a,vn.IndexBuffer,this.billboardIndexCount,mt.Static,!1);this.billboardIndexBufferBinding=new Xs(r,Ht.UInt8),this.setBufferData()}var i=n.prototype;return i.setBufferData=function(){this.billboardVertexBufferBinding.buffer.setData(new Float32Array([-.5,-.5,0,1,.5,-.5,1,1,.5,.5,1,0,-.5,.5,0,0])),this.billboardIndexBufferBinding.buffer.setData(new Uint8Array([0,2,3,0,1,2]))},n}(),dS=`#define GLSLIFY 1
#include <common>
const float MIE_G=-0.990;const float MIE_G2=0.9801;const float SKY_GROUND_THRESHOLD=0.02;uniform float material_SunSize;uniform float material_SunSizeConvergence;uniform vec4 scene_SunlightColor;uniform vec3 scene_SunlightDirection;varying vec3 v_GroundColor;varying vec3 v_SkyColor;
#ifdef MATERIAL_SUN_HIGH_QUALITY
varying vec3 v_Vertex;
#elif defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_RayDir;
#else
varying float v_SkyGroundFactor;
#endif
#if defined(MATERIAL_SUN_HIGH_QUALITY)||defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_SunColor;
#endif
#if defined(ENGINE_IS_COLORSPACE_GAMMA)
#define LINEAR_2_OUTPUT(color) sqrt(color)
#endif
float getMiePhase(float eyeCos,float eyeCos2){float temp=1.0+MIE_G2-2.0*MIE_G*eyeCos;temp=pow(temp,pow(material_SunSize,0.65)*10.0);temp=max(temp,1.0e-4);temp=1.5*((1.0-MIE_G2)/(2.0+MIE_G2))*(1.0+eyeCos2)/temp;return temp;}float calcSunAttenuation(vec3 lightPos,vec3 ray){
#ifdef MATERIAL_SUN_HIGH_QUALITY
float focusedEyeCos=pow(clamp(dot(lightPos,ray),0.0,1.0),material_SunSizeConvergence);return getMiePhase(-focusedEyeCos,focusedEyeCos*focusedEyeCos);
#else
vec3 delta=lightPos-ray;float dist=length(delta);float spot=1.0-smoothstep(0.0,material_SunSize,dist);return spot*spot;
#endif
}void main(){vec3 col=vec3(0.0,0.0,0.0);
#ifdef MATERIAL_SUN_HIGH_QUALITY
vec3 ray=normalize(v_Vertex);float y=ray.y/SKY_GROUND_THRESHOLD;
#elif defined(MATERIAL_SUN_SIMPLE)
vec3 ray=v_RayDir;float y=ray.y/SKY_GROUND_THRESHOLD;
#else
float y=v_SkyGroundFactor;
#endif
col=mix(v_SkyColor,v_GroundColor,clamp(y,0.0,1.0));
#if defined(MATERIAL_SUN_HIGH_QUALITY)||defined(MATERIAL_SUN_SIMPLE)
if(y<0.0)col+=v_SunColor*calcSunAttenuation(-scene_SunlightDirection,-ray);
#endif
#ifdef ENGINE_IS_COLORSPACE_GAMMA
col=LINEAR_2_OUTPUT(col);
#endif
gl_FragColor=vec4(col,1.0);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,_S=`#define GLSLIFY 1
#define OUTER_RADIUS 1.025
#define RAYLEIGH (mix(0.0, 0.0025, pow(material_AtmosphereThickness,2.5)))
#define MIE 0.0010
#define SUN_BRIGHTNESS 20.0
#define MAX_SCATTER 50.0
const float SKY_GROUND_THRESHOLD=0.02;const float outerRadius=OUTER_RADIUS;const float outerRadius2=OUTER_RADIUS*OUTER_RADIUS;const float innerRadius=1.0;const float innerRadius2=1.0;const float cameraHeight=0.0001;const float HDSundiskIntensityFactor=15.0;const float simpleSundiskIntensityFactor=27.0;const float sunScale=400.0*SUN_BRIGHTNESS;const float kmESun=MIE*SUN_BRIGHTNESS;const float km4PI=MIE*4.0*3.14159265;const float scale=1.0/(OUTER_RADIUS-1.0);const float scaleDepth=0.25;const float scaleOverScaleDepth=(1.0/(OUTER_RADIUS-1.0))/0.25;const float samples=2.0;const vec3 c_DefaultScatteringWavelength=vec3(0.65,0.57,0.475);const vec3 c_VariableRangeForScatteringWavelength=vec3(0.15,0.15,0.15);attribute vec4 POSITION;uniform mat4 camera_VPMat;uniform vec3 material_SkyTint;uniform vec3 material_GroundTint;uniform float material_Exposure;uniform float material_AtmosphereThickness;uniform vec4 scene_SunlightColor;uniform vec3 scene_SunlightDirection;varying vec3 v_GroundColor;varying vec3 v_SkyColor;
#ifdef MATERIAL_SUN_HIGH_QUALITY
varying vec3 v_Vertex;
#elif defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_RayDir;
#else
varying float v_SkyGroundFactor;
#endif
#if defined(MATERIAL_SUN_HIGH_QUALITY)||defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_SunColor;
#endif
#if defined(ENGINE_IS_COLORSPACE_GAMMA)
#define COLOR_2_GAMMA(color) color
#define COLOR_2_LINEAR(color) color*color
#else
#define GAMMA 2.2
#define COLOR_2_GAMMA(color) pow(color,vec3(1.0/GAMMA))
#define COLOR_2_LINEAR(color) color
#endif
float getRayleighPhase(vec3 light,vec3 ray){float eyeCos=dot(light,ray);return 0.75+0.75*eyeCos*eyeCos;}float scaleAngle(float inCos){float x=1.0-inCos;return 0.25*exp(-0.00287+x*(0.459+x*(3.83+x*(-6.80+x*5.25))));}void main(){gl_Position=camera_VPMat*vec4(POSITION.xyz,1.0);vec3 skyTintInGammaSpace=COLOR_2_GAMMA(material_SkyTint);vec3 scatteringWavelength=mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0)-skyTintInGammaSpace);vec3 invWavelength=1.0/pow(scatteringWavelength,vec3(4.0));float krESun=RAYLEIGH*SUN_BRIGHTNESS;float kr4PI=RAYLEIGH*4.0*3.14159265;vec3 cameraPos=vec3(0.0,innerRadius+cameraHeight,0.0);vec3 eyeRay=normalize(POSITION.xyz);float far=0.0;vec3 cIn,cOut;if(eyeRay.y>=0.0){far=sqrt(outerRadius2+innerRadius2*eyeRay.y*eyeRay.y-innerRadius2)-innerRadius*eyeRay.y;float height=innerRadius+cameraHeight;float depth=exp(scaleOverScaleDepth*-cameraHeight);float startAngle=dot(eyeRay,cameraPos)/height;float startOffset=depth*scaleAngle(startAngle);float sampleLength=far/samples;float scaledLength=sampleLength*scale;vec3 sampleRay=eyeRay*sampleLength;vec3 samplePoint=cameraPos+sampleRay*0.5;vec3 frontColor=vec3(0.0);{float height=length(samplePoint);float depth=exp(scaleOverScaleDepth*(innerRadius-height));float lightAngle=dot(-scene_SunlightDirection,samplePoint)/height;float cameraAngle=dot(eyeRay,samplePoint)/height;float scatter=(startOffset+depth*(scaleAngle(lightAngle)-scaleAngle(cameraAngle)));vec3 attenuate=exp(-clamp(scatter,0.0,MAX_SCATTER)*(invWavelength*kr4PI+km4PI));frontColor+=attenuate*(depth*scaledLength);samplePoint+=sampleRay;}{float height=length(samplePoint);float depth=exp(scaleOverScaleDepth*(innerRadius-height));float lightAngle=dot(-scene_SunlightDirection,samplePoint)/height;float cameraAngle=dot(eyeRay,samplePoint)/height;float scatter=(startOffset+depth*(scaleAngle(lightAngle)-scaleAngle(cameraAngle)));vec3 attenuate=exp(-clamp(scatter,0.0,MAX_SCATTER)*(invWavelength*kr4PI+km4PI));frontColor+=attenuate*(depth*scaledLength);samplePoint+=sampleRay;}cIn=frontColor*(invWavelength*krESun);cOut=frontColor*kmESun;}else{far=(-cameraHeight)/(min(-0.001,eyeRay.y));vec3 pos=cameraPos+far*eyeRay;float depth=exp((-cameraHeight)*(1.0/scaleDepth));float cameraAngle=dot(-eyeRay,pos);float lightAngle=dot(-scene_SunlightDirection,pos);float cameraScale=scaleAngle(cameraAngle);float lightScale=scaleAngle(lightAngle);float cameraOffset=depth*cameraScale;float temp=lightScale+cameraScale;float sampleLength=far/samples;float scaledLength=sampleLength*scale;vec3 sampleRay=eyeRay*sampleLength;vec3 samplePoint=cameraPos+sampleRay*0.5;vec3 frontColor=vec3(0.0,0.0,0.0);vec3 attenuate;{float height=length(samplePoint);float depth=exp(scaleOverScaleDepth*(innerRadius-height));float scatter=depth*temp-cameraOffset;attenuate=exp(-clamp(scatter,0.0,MAX_SCATTER)*(invWavelength*kr4PI+km4PI));frontColor+=attenuate*(depth*scaledLength);samplePoint+=sampleRay;}cIn=frontColor*(invWavelength*krESun+kmESun);cOut=clamp(attenuate,0.0,1.0);}
#ifdef MATERIAL_SUN_HIGH_QUALITY
v_Vertex=-POSITION.xyz;
#elif defined(MATERIAL_SUN_SIMPLE)
v_RayDir=-eyeRay;
#else
v_SkyGroundFactor=-eyeRay.y/SKY_GROUND_THRESHOLD;
#endif
v_GroundColor=material_Exposure*(cIn+COLOR_2_LINEAR(material_GroundTint)*cOut);v_SkyColor=material_Exposure*(cIn*getRayleighPhase(-scene_SunlightDirection,-eyeRay));float lightColorIntensity=clamp(length(scene_SunlightColor.xyz),0.25,1.0);
#ifdef MATERIAL_SUN_HIGH_QUALITY
v_SunColor=HDSundiskIntensityFactor*clamp(cOut,0.0,1.0)*scene_SunlightColor.xyz/lightColorIntensity;
#elif defined(MATERIAL_SUN_SIMPLE)
v_SunColor=simpleSundiskIntensityFactor*clamp(cOut*sunScale,0.0,1.0)*scene_SunlightColor.xyz/lightColorIntensity;
#endif
}`,fS=`#define GLSLIFY 1
uniform sampler2D material_BaseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(material_BaseTexture,v_uv);}`,hS=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,vS=`#define GLSLIFY 1
#include <common>
#include <camera_declare>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <ShadowFragmentDeclaration>
#include <mobile_material_frag>
#include <FogFragmentDeclaration>
#include <normal_get>
void main(){
#include <begin_mobile_frag>
#include <begin_viewdir_frag>
#include <mobile_blinnphong_frag>
gl_FragColor=emission+ambient+diffuse+specular;
#ifdef MATERIAL_IS_TRANSPARENT
gl_FragColor.a=diffuse.a;
#else
gl_FragColor.a=1.0;
#endif
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,pS=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <ShadowVertexDeclaration>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <position_vert>
#include <ShadowVertex>
#include <FogVertex>
}`,gS=`#define GLSLIFY 1
void main(){}`,mS=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
uniform mat4 camera_VPMat;void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <position_vert>
}`,yS=`#define GLSLIFY 1
#include <common>
varying vec4 v_Color;varying vec2 v_TextureCoordinate;uniform sampler2D material_BaseTexture;uniform vec4 material_BaseColor;
#ifdef RENDERER_MODE_MESH
varying vec4 v_MeshColor;
#endif
void main(){vec4 color=material_BaseColor*v_Color;
#ifdef RENDERER_MODE_MESH
color*=v_MeshColor;
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 textureColor=texture2D(material_BaseTexture,v_TextureCoordinate);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
color*=textureColor;
#endif
gl_FragColor=color;
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,AS=`#define GLSLIFY 1
#if defined(RENDERER_MODE_SPHERE_BILLBOARD) || defined(RENDERER_MODE_STRETCHED_BILLBOARD) || defined(RENDERER_MODE_HORIZONTAL_BILLBOARD) || defined(RENDERER_MODE_VERTICAL_BILLBOARD)
attribute vec4 a_CornerTextureCoordinate;
#endif
#ifdef RENDERER_MODE_MESH
attribute vec3 a_MeshPosition;attribute vec4 a_MeshColor;attribute vec2 a_MeshTextureCoordinate;varying vec4 v_MeshColor;
#endif
attribute vec4 a_ShapePositionStartLifeTime;attribute vec4 a_DirectionTime;attribute vec4 a_StartColor;attribute vec3 a_StartSize;attribute vec3 a_StartRotation0;attribute float a_StartSpeed;attribute vec4 a_Random0;
#if defined(RENDERER_TSA_FRAME_RANDOM_CURVES) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
attribute vec4 a_Random1;
#endif
attribute vec3 a_SimulationWorldPosition;attribute vec4 a_SimulationWorldRotation;varying vec4 v_Color;
#ifdef MATERIAL_HAS_BASETEXTURE
attribute vec4 a_SimulationUV;varying vec2 v_TextureCoordinate;
#endif
uniform float renderer_CurrentTime;uniform vec3 renderer_Gravity;uniform vec2 u_DragConstant;uniform vec3 renderer_WorldPosition;uniform vec4 renderer_WorldRotation;uniform bool renderer_ThreeDStartRotation;uniform int renderer_ScalingMode;uniform vec3 renderer_PositionScale;uniform vec3 renderer_SizeScale;uniform vec3 renderer_PivotOffset;uniform mat4 camera_ViewMat;uniform mat4 camera_ProjMat;
#ifdef RENDERER_MODE_STRETCHED_BILLBOARD
uniform vec3 camera_Position;
#endif
uniform vec3 camera_Forward;uniform vec3 camera_Up;uniform float renderer_StretchedBillboardLengthScale;uniform float renderer_StretchedBillboardSpeedScale;uniform int renderer_SimulationSpace;
#include <particle_common>
#include <velocity_over_lifetime_module>
#include <color_over_lifetime_module>
#include <size_over_lifetime_module>
#include <rotation_over_lifetime_module>
#include <texture_sheet_animation_module>
void main(){float age=renderer_CurrentTime-a_DirectionTime.w;float normalizedAge=age/a_ShapePositionStartLifeTime.w;vec3 lifeVelocity;if(normalizedAge<1.0){vec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
lifeVelocity=computeParticleLifeVelocity(normalizedAge);
#endif
vec3 gravityVelocity=renderer_Gravity*age;vec4 worldRotation;if(renderer_SimulationSpace==0){worldRotation=renderer_WorldRotation;}else{worldRotation=a_SimulationWorldRotation;}vec3 dragData=a_DirectionTime.xyz*mix(u_DragConstant.x,u_DragConstant.y,a_Random0.x);vec3 center=computeParticlePosition(startVelocity,lifeVelocity,age,normalizedAge,gravityVelocity,worldRotation,dragData);
#include <sphere_billboard>
#include <stretched_billboard>
#include <horizontal_billboard>
#include <vertical_billboard>
#include <particle_mesh>
gl_Position=camera_ProjMat*camera_ViewMat*vec4(center,1.0);v_Color=computeParticleColor(a_StartColor,normalizedAge);
#ifdef MATERIAL_HAS_BASETEXTURE
vec2 simulateUV;
#if defined(RENDERER_MODE_SPHERE_BILLBOARD) || defined(RENDERER_MODE_STRETCHED_BILLBOARD) || defined(RENDERER_MODE_HORIZONTAL_BILLBOARD) || defined(RENDERER_MODE_VERTICAL_BILLBOARD)
simulateUV=a_CornerTextureCoordinate.zw*a_SimulationUV.xy+a_SimulationUV.zw;v_TextureCoordinate=computeParticleUV(simulateUV,normalizedAge);
#endif
#ifdef RENDERER_MODE_MESH
simulateUV=a_SimulationUV.xy+a_MeshTextureCoordinate*a_SimulationUV.zw;v_TextureCoordinate=computeParticleUV(simulateUV,normalizedAge);
#endif
#endif
}else{gl_Position=vec4(2.0,2.0,2.0,1.0);}}`,xS=`#define GLSLIFY 1
#include <common>
#include <camera_declare>
#include <FogFragmentDeclaration>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,SS=`#define GLSLIFY 1
#define IS_METALLIC_WORKFLOW
#include <common>
#include <camera_declare>
#include <FogFragmentDeclaration>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,vv=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <ShadowVertexDeclaration>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <position_vert>
#include <ShadowVertex>
#include <FogVertex>
}`,CS=`#define GLSLIFY 1
#ifdef ENGINE_NO_DEPTH_TEXTURE
vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}
#endif
void main(){
#ifdef ENGINE_NO_DEPTH_TEXTURE
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
#endif
}`,ES=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <normal_share>
uniform mat4 camera_VPMat;uniform vec2 scene_ShadowBias;uniform vec3 scene_LightDirection;vec3 applyShadowBias(vec3 positionWS){positionWS-=scene_LightDirection*scene_ShadowBias.x;return positionWS;}vec3 applyShadowNormalBias(vec3 positionWS,vec3 normalWS){float invNdotL=1.0-clamp(dot(-scene_LightDirection,normalWS),0.0,1.0);float scale=invNdotL*scene_ShadowBias.y;positionWS+=normalWS*vec3(scale);return positionWS;}void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
vec4 positionWS=renderer_ModelMat*position;positionWS.xyz=applyShadowBias(positionWS.xyz);
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
vec3 normalWS=normalize(mat3(renderer_NormalMat)*normal);positionWS.xyz=applyShadowNormalBias(positionWS.xyz,normalWS);
#endif
#endif
vec4 positionCS=camera_VPMat*positionWS;positionCS.z=max(positionCS.z,-1.0);gl_Position=positionCS;}`,wS=`#define GLSLIFY 1
#include <common>
uniform samplerCube material_CubeTexture;varying vec3 v_cubeUV;uniform float material_Exposure;uniform vec4 material_TintColor;void main(){vec4 textureColor=textureCube(material_CubeTexture,v_cubeUV);
#ifdef MATERIAL_IS_DECODE_SKY_RGBM
textureColor=RGBMToLinear(textureColor,5.0);
#elif !defined(ENGINE_IS_COLORSPACE_GAMMA)
textureColor=gammaToLinear(textureColor);
#endif
textureColor.rgb*=material_Exposure*material_TintColor.rgb;gl_FragColor=textureColor;
#if defined(MATERIAL_IS_DECODE_SKY_RGBM) || !defined(ENGINE_IS_COLORSPACE_GAMMA)
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,TS=`#define GLSLIFY 1
#include <common_vert>
uniform mat4 camera_VPMat;varying vec3 v_cubeUV;uniform float material_Rotation;vec4 rotateY(vec4 v,float angle){const float deg2rad=3.1415926/180.0;float radian=angle*deg2rad;float sina=sin(radian);float cosa=cos(radian);mat2 m=mat2(cosa,-sina,sina,cosa);return vec4(m*v.xz,v.yw).xzyw;}void main(){v_cubeUV=vec3(-POSITION.x,POSITION.yz);gl_Position=camera_VPMat*rotateY(vec4(POSITION,1.0),material_Rotation);}`,RS=`#define GLSLIFY 1
uniform sampler2D renderer_MaskTexture;uniform float renderer_MaskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(renderer_MaskTexture,v_uv);if(color.a<renderer_MaskAlphaCutoff){discard;}gl_FragColor=color;}`,MS=`#define GLSLIFY 1
uniform mat4 camera_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=camera_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,PS=`#define GLSLIFY 1
uniform sampler2D renderer_SpriteTexture;varying vec2 v_uv;varying vec4 v_color;void main(){vec4 baseColor=texture2D(renderer_SpriteTexture,v_uv);gl_FragColor=baseColor*v_color;}`,BS=`#define GLSLIFY 1
uniform mat4 renderer_MVPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){gl_Position=renderer_MVPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;v_color=COLOR_0;}`,bS=`#define GLSLIFY 1
#include <common>
#include <uv_share>
#include <FogFragmentDeclaration>
uniform vec4 material_BaseColor;uniform float material_AlphaCutoff;
#ifdef MATERIAL_HAS_BASETEXTURE
uniform sampler2D material_BaseTexture;
#endif
void main(){vec4 baseColor=material_BaseColor;
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 textureColor=texture2D(material_BaseTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
baseColor*=textureColor;
#endif
#ifdef MATERIAL_IS_ALPHA_CUTOFF
if(baseColor.a<material_AlphaCutoff){discard;}
#endif
gl_FragColor=baseColor;
#ifndef MATERIAL_IS_TRANSPARENT
gl_FragColor.a=1.0;
#endif
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,DS=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <position_vert>
#include <FogVertex>
}`,LS=function(){function n(){}return n.init=function(){var a=new zt("ShadowCaster",ES,CS,{pipelineStage:hn.ShadowCaster}),t=new zt("DepthOnly",mS,gS,{pipelineStage:hn.DepthOnly}),e=[a,t],r={pipelineStage:hn.Forward};be.create("blinn-phong",[].concat(new zt("Forward",pS,vS,r),e)),be.create("pbr",[].concat(new zt("Forward",vv,SS,r),e)),be.create("pbr-specular",[].concat(new zt("Forward",vv,xS,r),e)),be.create("unlit",[].concat(new zt("Forward",DS,bS,r),e)),be.create("skybox",[new zt("Forward",TS,wS,r)]),be.create("SkyProcedural",[new zt("Forward",_S,dS,r)]),be.create("particle-shader",[new zt("Forward",AS,yS,r)]),be.create("SpriteMask",[new zt("Forward",MS,RS,r)]),be.create("Sprite",[new zt("Forward",BS,PS,r)]),be.create("background-texture",[new zt("Forward",hS,fS,r)])},n}(),IS=function(){function n(){this._cacheHierarchyDepth=1,this._cacheMap=Object.create(null)}var i=n.prototype;return i.get=function(t){var e=this._cacheMap,r=t._length,o=this._cacheHierarchyDepth;r>o&&(this._resizeCacheMapHierarchy(e,0,o,r-o),this._cacheHierarchyDepth=r);for(var s=t._mask,l=t._length-1,u=this._cacheHierarchyDepth-1,c=0;c<u;c++){var d=l<c?0:s[c],_=e[d];_||(e[d]=_=Object.create(null)),e=_}var f=l<u?0:s[u],v=e[f];return v||(this._lastQueryKey=f,this._lastQueryMap=e),v},i.cache=function(t){this._lastQueryMap[this._lastQueryKey]=t},i._resizeCacheMapHierarchy=function(t,e,r,o){if(e==r-1)for(var s in t){for(var l=t[s],u=t,c=0;c<o;c++)u[c==0?s:0]=u=Object.create(null);u[0]=l}else{e++;for(var d in t)this._resizeCacheMapHierarchy(t[d],e,r,o)}},n}(),wa;(function(n){n[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right"})(wa||(wa={}));var Ta;(function(n){n[n.Top=0]="Top",n[n.Center=1]="Center",n[n.Bottom=2]="Bottom"})(Ta||(Ta={}));var cm=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._sprites=new Array,e._spriteNamesToIndex={},e}var a=i.prototype;return a.getSprite=function(e){var r=this._sprites[this._spriteNamesToIndex[e]];return r||console.warn("There is no sprite named "+e+" in the atlas."),r},a.getSprites=function(e,r){r.length=0;var o=this._spriteNamesToIndex[e];if(o!==void 0)for(var s=this._sprites;o>=0;o--){var l=s[o];l.name===e&&r.push(l)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return r},a._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1,e._atlas=this,e.isGCIgnored=!0},a._onDestroy=function(){n.prototype._onDestroy.call(this);for(var e=this,r=e._sprites,o=0,s=r.length;o<s;o++)r[o].destroy();r.length=0,this._sprites=null,this._spriteNamesToIndex=null},q(i,[{key:"sprites",get:function(){return this._sprites}}]),i}(ni),$n;(function(n){n[n.Simple=0]="Simple",n[n.Sliced=1]="Sliced",n[n.Tiled=2]="Tiled"})($n||($n={}));var Ys;(function(n){n[n.Continuous=0]="Continuous",n[n.Adaptive=1]="Adaptive"})(Ys||(Ys={}));var wr=function(n){W(i,n);function i(t,e,r,o,s,l){e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),s===void 0&&(s=null),l===void 0&&(l=null);var u;return u=n.call(this,t)||this,u._automaticWidth=0,u._automaticHeight=0,u._customWidth=void 0,u._customHeight=void 0,u._positions=[new te,new te,new te,new te],u._uvs=[new te,new te,new te,new te],u._bounds=new jt,u._texture=null,u._atlasRotated=!1,u._atlasRegion=new Rr(0,0,1,1),u._atlasRegionOffset=new ue(0,0,0,0),u._region=new Rr(0,0,1,1),u._pivot=new te(.5,.5),u._border=new ue(0,0,0,0),u._dirtyUpdateFlag=7,u._updateFlagManager=new ra,u._texture=e,u._onRegionChange=u._onRegionChange.bind(fe(u)),u._onPivotChange=u._onPivotChange.bind(fe(u)),u._onBorderChange=u._onBorderChange.bind(fe(u)),u._region._onValueChanged=u._onRegionChange,u._pivot._onValueChanged=u._onPivotChange,u._border._onValueChanged=u._onBorderChange,r&&u._region.copyFrom(r),o&&u._pivot.copyFrom(o),s&&u._border.copyFrom(s),u.name=l,u}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this._texture,this._region,this._pivot,this._border,this.name);return e._atlasRotated=this._atlasRotated,e._atlasRegion.copyFrom(this._atlasRegion),e._atlasRegionOffset.copyFrom(this._atlasRegionOffset),e},a._getPositions=function(){return this._dirtyUpdateFlag&1&&this._updatePositions(),this._positions},a._getUVs=function(){return this._dirtyUpdateFlag&2&&this._updateUVs(),this._uvs},a._getBounds=function(){return this._dirtyUpdateFlag&1&&this._updatePositions(),this._bounds},a._addReferCount=function(e){var r;n.prototype._addReferCount.call(this,e),(r=this._atlas)==null||r._addReferCount(e)},a._onDestroy=function(){this._dispatchSpriteChange(Be.destroy),n.prototype._onDestroy.call(this),this._positions.length=0,this._positions=null,this._uvs.length=0,this._uvs=null,this._atlasRegion=null,this._atlasRegionOffset=null,this._region=null,this._pivot=null,this._border=null,this._bounds=null,this._atlas=null,this._texture=null,this._updateFlagManager=null},a._calDefaultSize=function(){if(this._texture){var e=this,r=e._texture,o=e._atlasRegion,s=e._atlasRegionOffset,l=e._region,u=1/$r._pixelsPerUnit;this._automaticWidth=r.width*o.width/(1-s.x-s.z)*l.width*u,this._automaticHeight=r.height*o.height/(1-s.y-s.w)*l.height*u}else this._automaticWidth=this._automaticHeight=0;this._dirtyUpdateFlag&=-5},a._updatePositions=function(){var e=this._atlasRegionOffset,r=this._region,o=r.x,s=r.y,l=r.width,u=r.height,c=1-o-l,d=1-s-u,_=Math.max(e.x-o,0)/l,f=Math.max(e.w-s,0)/u,v=1-Math.max(e.z-c,0)/l,p=1-Math.max(e.y-d,0)/u,g=this._positions;g[0].set(_,f),g[1].set(v,f),g[2].set(_,p),g[3].set(v,p);var m=this._bounds,h=m.min,y=m.max;h.set(_,f,0),y.set(v,p,0),this._dirtyUpdateFlag&=-2},a._updateUVs=function(){var e=this,r=e._uvs,o=e._atlasRegionOffset,s=this._region,l=s.x,u=s.y,c=s.width,d=s.height,_=1-l-c,f=1-u-d,v=this._atlasRegion,p=v.x,g=v.y,m=v.width,h=v.height,y=o.x,A=o.y,S=o.z,x=o.w,C=m/(1-y-S),E=h/(1-A-x),T=Math.max(l-y,0)*C+p,w=Math.max(f-A,0)*E+g,R=m+p-Math.max(_-S,0)*C,b=h+g-Math.max(u-x,0)*E,B=this._border,I=B.x,V=B.y,L=B.z,F=B.w;r[0].set(T,b),r[1].set((l-y+I*c)*C+p,h+g-(u-x+V*d)*E),r[2].set(m+p-(_-S+L*c)*C,(f-A+F*d)*E+g),r[3].set(R,w),this._dirtyUpdateFlag&=-3},a._dispatchSpriteChange=function(e){switch(e){case Be.texture:this._dirtyUpdateFlag|=4;break;case Be.atlasRegionOffset:case Be.region:this._dirtyUpdateFlag|=7;break;case Be.atlasRegion:this._dirtyUpdateFlag|=6;break;case Be.border:this._dirtyUpdateFlag|=2;break}this._updateFlagManager.dispatch(e)},a._onRegionChange=function(){var e=this,r=e._region;r._onValueChanged=null;var o=G.clamp(r.x,0,1),s=G.clamp(r.y,0,1);r.set(o,s,G.clamp(r.width,0,1-o),G.clamp(r.height,0,1-s)),this._dispatchSpriteChange(Be.region),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size),r._onValueChanged=this._onRegionChange},a._onPivotChange=function(){this._dispatchSpriteChange(Be.pivot)},a._onBorderChange=function(){var e=this,r=e._border;r._onValueChanged=null;var o=G.clamp(r.x,0,1),s=G.clamp(r.y,0,1);r.set(o,s,G.clamp(r.z,0,1-o),G.clamp(r.w,0,1-s)),this._dispatchSpriteChange(Be.border),r._onValueChanged=this._onBorderChange},q(i,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._dispatchSpriteChange(Be.texture),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size))}},{key:"width",get:function(){return this._customWidth!==void 0?this._customWidth:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticWidth)},set:function(e){this._customWidth!==e&&(this._customWidth=e,this._dispatchSpriteChange(Be.size))}},{key:"height",get:function(){return this._customHeight!==void 0?this._customHeight:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticHeight)},set:function(e){this._customHeight!==e&&(this._customHeight=e,this._dispatchSpriteChange(Be.size))}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e)}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var r=G.clamp(e.x,0,1),o=G.clamp(e.y,0,1);this._atlasRegion.set(r,o,G.clamp(e.width,0,1-r),G.clamp(e.height,0,1-o)),this._dispatchSpriteChange(Be.atlasRegion),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var r=G.clamp(e.x,0,1),o=G.clamp(e.y,0,1);this._atlasRegionOffset.set(r,o,G.clamp(e.z,0,1-r),G.clamp(e.w,0,1-o)),this._dispatchSpriteChange(Be.atlasRegionOffset),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size)}},{key:"region",get:function(){return this._region},set:function(e){this._region!==e&&this._region.copyFrom(e)}},{key:"pivot",get:function(){return this._pivot},set:function(e){this._pivot!==e&&this._pivot.copyFrom(e)}},{key:"border",get:function(){return this._border},set:function(e){this._border!==e&&this._border.copyFrom(e)}}]),i}(ni),pv;(function(n){n[n.positions=1]="positions",n[n.uvs=2]="uvs",n[n.automaticSize=4]="automaticSize",n[n.all=7]="all"})(pv||(pv={}));var Fl,qs=(Fl=function(){function n(){}return n.resetData=function(a){var t=a._verticesData,e=t.positions,r=t.uvs;t.vertexCount=e.length=r.length=16;for(var o=0;o<16;o++){var s,l,u,c;(s=e)[l=o]||(s[l]=new M),(u=r)[c=o]||(u[c]=new te)}t.triangles=qs._rectangleTriangles},n.updatePositions=function(a){var t=a.width,e=a.height,r=a.sprite,o=a._verticesData,s=o.positions,l=o.uvs,u=r.border,c=r._getUVs(),d=r._getPositions(),_=d[0],f=_.x,v=_.y,p=d[3],g=p.x,m=p.y,h=r.width,y=r.height,A=h*u.x,S=y*u.y,x=h*u.z,C=y*u.w,E,T;if(A+x>t){var w=t/(A+x);E=[h*f*w,A*w,A*w,t-h*(1-g)*w]}else E=[h*f,A,t-x,t-h*(1-g)];if(C+S>e){var R=e/(C+S);T=[y*v*R,S*R,S*R,e-y*(1-m)*R]}else T=[y*v,S,e-C,e-y*(1-m)];var b=a.sprite.pivot,B=b.x,I=b.y,V=a.width*B,L=a.height*I,F=qs._worldMatrix,D=F.elements,N=a.entity.transform.worldMatrix,O=N.elements,k=a.flipX?-1:1,Q=a.flipY?-1:1;D[0]=O[0]*k,D[1]=O[1]*k,D[2]=O[2]*k,D[4]=O[4]*Q,D[5]=O[5]*Q,D[6]=O[6]*Q,D[8]=O[8],D[9]=O[9],D[10]=O[10],D[12]=O[12]-V*D[0]-L*D[4],D[13]=O[13]-V*D[1]-L*D[5],D[14]=O[14]-V*D[2]-L*D[6];for(var H=0;H<4;H++)for(var ee=E[H],ge=c[H].x,le=0;le<4;le++){var re=T[le],Ve=H*4+le;s[Ve].set(D[0]*ee+D[4]*re+D[12],D[1]*ee+D[5]*re+D[13],D[2]*ee+D[6]*re+D[14]),l[Ve].set(ge,c[le].y)}var He=a._bounds,Qe=He.min,Ee=He.max;Qe.set(E[0],T[0],0),Ee.set(E[3],T[3],0),a._bounds.transform(F)},n.updateUVs=function(a){},n}(),function(){Fl._rectangleTriangles=[0,1,4,1,5,4,1,2,5,2,6,5,2,3,6,3,7,6,4,5,8,5,9,8,5,6,9,6,10,9,6,7,10,7,11,10,8,9,12,9,13,12,9,10,13,10,14,13,10,11,14,11,15,14]}(),function(){Fl._worldMatrix=new $}(),Fl);qs=P([In()],qs);var va,Uu=(va=function(){function n(){}return n.resetData=function(a){a._verticesData.triangles=[]},n.updatePositions=function(a){var t=a.width,e=a.height,r=a.sprite,o=a.tileMode,s=a.tiledAdaptiveThreshold,l=a._verticesData,u=l.positions,c=l.uvs,d=l.triangles,_=this,f=_._posRow,v=_._posColumn,p=_._uvRow,g=_._uvColumn;f.length=v.length=p.length=g.length=0,o===Ys.Adaptive?this._calculateAdaptiveDividing(r,t,e,s,f,v,p,g):this._calculateContinuousDividing(r,t,e,f,v,p,g);var m=a.sprite.pivot,h=m.x,y=m.y,A=a.width*h,S=a.height*y,x=Uu._worldMatrix,C=x.elements,E=a.entity.transform.worldMatrix,T=E.elements,w=a.flipX?-1:1,R=a.flipY?-1:1,b,B,I,V,L,F;b=C[0]=T[0]*w,B=C[1]=T[1]*w,I=C[2]=T[2]*w,V=C[4]=T[4]*R,L=C[5]=T[5]*R,F=C[6]=T[6]*R,C[8]=T[8],C[9]=T[9],C[10]=T[10];for(var D=C[12]=T[12]-A*C[0]-S*C[4],N=C[13]=T[13]-A*C[1]-S*C[5],O=C[14]=T[14]-A*C[2]-S*C[6],k=f.length-1,Q=v.length-1,H=0,ee=0,ge=0;ge<Q;ge++)for(var le=2*ge,re=0;re<k;re++){var Ve=p.get(2*re),He=g.get(le),Qe=p.get(2*re+1),Ee=g.get(le+1);if(!(isNaN(Ve)||isNaN(Ve)||isNaN(Qe)||isNaN(Ee))){d[ee++]=H,d[ee++]=H+1,d[ee++]=H+2,d[ee++]=H+2,d[ee++]=H+1,d[ee++]=H+3;var ft=f.get(re),Je=v.get(ge),at=f.get(re+1),se=v.get(ge+1);c[H]?c[H].set(Ve,He):c[H]=new te(Ve,He);var St=u[H];St?St.set(b*ft+V*Je+D,B*ft+L*Je+N,I*ft+F*Je+O):u[H]=new M(b*ft+V*Je+D,B*ft+L*Je+N,I*ft+F*Je+O),H++,c[H]?c[H].set(Qe,He):c[H]=new te(Qe,He),St=u[H],St?St.set(b*at+V*Je+D,B*at+L*Je+N,I*at+F*Je+O):u[H]=new M(b*at+V*Je+D,B*at+L*Je+N,I*at+F*Je+O),H++,c[H]?c[H].set(Ve,Ee):c[H]=new te(Ve,Ee),St=u[H],St?St.set(b*ft+V*se+D,B*ft+L*se+N,I*ft+F*se+O):u[H]=new M(b*ft+V*se+D,B*ft+L*se+N,I*ft+F*se+O),H++,c[H]?c[H].set(Qe,Ee):c[H]=new te(Qe,Ee),St=u[H],St?St.set(b*at+V*se+D,B*at+L*se+N,I*at+F*se+O):u[H]=new M(b*at+V*se+D,B*at+L*se+N,I*at+F*se+O),H++}}a._verticesData.vertexCount=H,d.length=ee;var Fn=a._bounds,ai=Fn.min,yr=Fn.max;ai.set(f.get(0),v.get(0),0),yr.set(f.get(k),v.get(Q),0),a._bounds.transform(x)},n.updateUVs=function(a){},n._calculateAdaptiveDividing=function(a,t,e,r,o,s,l,u){var c=a.border,d=a._getPositions(),_=d[0],f=_.x,v=_.y,p=d[3],g=p.x,m=p.y,h=a._getUVs(),y=h[0],A=h[1],S=h[2],x=h[3],C=a.width,E=a.height,T=C*c.x,w=C*c.z,R=T+w,b=C-R,B=E*c.w,I=E*c.y,V=B+I,L=E-V,F,D,N,O,k,Q,H;if(R>=t?(O=3,D=0):b>G.zeroTolerance?(Q=(t-R)/b,Q=Q%1>=r?Math.ceil(Q):Math.floor(Q),O=4+Q-1,D=2):(O=4,D=1),V>=e?(k=3,N=0):L>G.zeroTolerance?(H=(e-V)/L,H=H%1>=r?Math.ceil(H):Math.floor(H),k=4+H-1,N=2):(k=4,N=1),(O-1)*(k-1)*4>Dr.MAX_VERTEX_COUNT){o.add(t*f),o.add(t*g),s.add(e*v),s.add(e*m),l.add(y.x),l.add(x.x),u.add(y.y),u.add(x.y),ve.warn("The number of vertices exceeds the upper limit("+Dr.MAX_VERTEX_COUNT+").");return}switch(D){case 0:F=t/R,o.add(C*f*F),o.add(T*F),o.add(t-C*(1-g)*F),l.add(y.x),l.add(A.x),l.add(S.x),l.add(x.x);break;case 1:o.add(C*f),o.add(T),o.add(t-w),o.add(t-C*(1-g)),l.add(y.x),l.add(A.x),l.add(NaN),l.add(NaN),l.add(S.x),l.add(x.x);break;case 2:F=t/(R+Q*b),o.add(C*f*F),o.add(T*F),l.add(y.x),l.add(A.x),l.add(A.x);for(var ee=0,ge=Q-1;ee<ge;ee++)o.add(T+(ee+1)*b*F),l.add(S.x),l.add(A.x);o.add(t-w*F),o.add(t-C*(1-g)*F),l.add(S.x),l.add(S.x),l.add(x.x);break}switch(N){case 0:F=e/V,s.add(E*v*F),s.add(I*F),s.add(e-E*(1-m)*F),u.add(y.y),u.add(A.y),u.add(S.y),u.add(x.y);break;case 1:s.add(E*v),s.add(I),s.add(e-B),s.add(e-E*(1-m)),u.add(y.y),u.add(A.y),u.add(NaN),u.add(NaN),u.add(S.y),u.add(x.y);break;case 2:F=e/(V+H*L),s.add(E*v*F),s.add(I*F),u.add(y.y),u.add(A.y),u.add(A.y);for(var le=0,re=H-1;le<re;le++)s.add(I+(le+1)*L*F),u.add(S.y),u.add(A.y);s.add(e-B*F),s.add(e-E*(1-m)*F),u.add(S.y),u.add(S.y),u.add(x.y);break}},n._calculateContinuousDividing=function(a,t,e,r,o,s,l){var u=a.border,c=a._getPositions(),d=c[0],_=d.x,f=d.y,v=c[3],p=v.x,g=v.y,m=a._getUVs(),h=m[0],y=m[1],A=m[2],S=m[3],x=a.width,C=a.height,E=x*u.x,T=x*u.z,w=E+T,R=x-w,b=C*u.w,B=C*u.y,I=b+B,V=C-I,L,F,D,N,O,k;if(w>=t?(D=3,L=0):R>G.zeroTolerance?(O=(t-w)/R,D=4+(O|0),L=2):(D=4,L=1),I>=e?(N=3,F=0):V>G.zeroTolerance?(k=(e-I)/V,N=4+(k|0),F=2):(N=4,F=1),(D-1)*(N-1)*4>Dr.MAX_VERTEX_COUNT){r.add(t*_),r.add(t*p),o.add(e*f),o.add(e*g),s.add(h.x),s.add(S.x),l.add(h.y),l.add(S.y),ve.warn("The number of vertices exceeds the upper limit("+Dr.MAX_VERTEX_COUNT+").");return}switch(L){case 0:var Q=t/w;r.add(x*_*Q),r.add(E*Q),r.add(t-x*(1-p)*Q),s.add(h.x),s.add(y.x),s.add(A.x),s.add(S.x);break;case 1:r.add(x*_),r.add(E),r.add(t-T),r.add(t-x*(1-p)),s.add(h.x),s.add(y.x),s.add(NaN),s.add(NaN),s.add(A.x),s.add(S.x);break;case 2:r.add(x*_),r.add(E),s.add(h.x),s.add(y.x),s.add(y.x);for(var H=O|0,ee=0;ee<H;ee++)r.add(E+(ee+1)*R),s.add(A.x),s.add(y.x);r.add(t-T),r.add(t-x*(1-p)),s.add((A.x-y.x)*(O-H)+y.x),s.add(A.x),s.add(S.x);break}switch(F){case 0:var ge=e/I;o.add(C*f*ge),o.add(B*ge),o.add(e-C*(1-g)*ge),l.add(h.y),l.add(y.y),l.add(A.y),l.add(S.y);break;case 1:o.add(C*f),o.add(B),o.add(e-b),o.add(e-C*(1-g)),l.add(h.y),l.add(y.y),l.add(NaN),l.add(NaN),l.add(A.y),l.add(S.y);break;case 2:o.add(C*f),o.add(B),l.add(h.y),l.add(y.y),l.add(y.y);for(var le=k|0,re=0;re<le;re++)o.add(B+(re+1)*V),l.add(A.y),l.add(y.y);o.add(e-b),o.add(e-C*(1-g)),l.add((A.y-y.y)*(k-le)+y.y),l.add(A.y),l.add(S.y);break}},n}(),function(){va._worldMatrix=new $}(),function(){va._posRow=new rt}(),function(){va._posColumn=new rt}(),function(){va._uvRow=new rt}(),function(){va._uvColumn=new rt}(),va);Uu=P([In()],Uu);var gv;(function(n){n[n.Compressed=0]="Compressed",n[n.WithoutTiled=1]="WithoutTiled",n[n.WithTiled=2]="WithTiled"})(gv||(gv={}));var je=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._tileMode=Ys.Continuous,e._tiledAdaptiveThreshold=.5,e._color=new J(1,1,1,1),e._sprite=null,e._automaticWidth=0,e._automaticHeight=0,e._customWidth=void 0,e._customHeight=void 0,e._flipX=!1,e._flipY=!1,e._maskLayer=Oo.Layer0,e._maskInteraction=wt.None,e._verticesData=new Bf(4,[],[],null,e._color),e.drawMode=$n.Simple,e.setMaterial(e._engine._spriteDefaultMaterial),e._onSpriteChange=e._onSpriteChange.bind(fe(e)),e}var a=i.prototype;return a._cloneTo=function(e,r,o){n.prototype._cloneTo.call(this,e,r,o),e._assembler.resetData(e),e.sprite=this._sprite,e.drawMode=this._drawMode},a._updateShaderData=function(e){this._updateTransformShaderData(e,$._identity)},a._updateBounds=function(e){this.sprite?this._assembler.updatePositions(this):(e.min.set(0,0,0),e.max.set(0,0,0))},a._render=function(e){var r;if(!(!((r=this.sprite)!=null&&r.texture)||!this.width||!this.height)){this._dirtyUpdateFlag&pt.WorldVolume&&(this._assembler.updatePositions(this),this._dirtyUpdateFlag&=~pt.WorldVolume),this._dirtyUpdateFlag&2&&(this._assembler.updateUVs(this),this._dirtyUpdateFlag&=-3);var o=this.getMaterial(),s=this.sprite.texture,l=this._engine._spriteRenderDataPool.getFromPool();l.set(this,o,this._verticesData,s),e.camera._renderPipeline.pushRenderData(e,l)}},a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._sprite;e&&(e._addReferCount(-1),e._updateFlagManager.removeListener(this._onSpriteChange)),this._entity=null,this._color=null,this._sprite=null,this._assembler=null,this._verticesData=null},a._calDefaultSize=function(){var e=this._sprite;e?(this._automaticWidth=e.width,this._automaticHeight=e.height):this._automaticWidth=this._automaticHeight=0,this._dirtyUpdateFlag&=-5},a._updateStencilState=function(e,r){var o=this.getMaterial(),s=this._engine,l=s._spriteDefaultMaterials;if(o===l[e])this.setMaterial(l[r]);else{var u=o.renderState.stencilState;r===wt.None?(u.enabled=!1,u.writeMask=255,u.referenceValue=0,u.compareFunctionFront=u.compareFunctionBack=Me.Always):(u.enabled=!0,u.writeMask=0,u.referenceValue=1,u.compareFunctionFront=u.compareFunctionBack=r===wt.VisibleInsideMask?Me.LessEqual:Me.Greater)}},a._onSpriteChange=function(e){switch(e){case Be.texture:this.shaderData.setTexture(i._textureProperty,this.sprite.texture);break;case Be.size:var r=this,o=r._drawMode;this._dirtyUpdateFlag|=4,this._drawMode===$n.Sliced?this._dirtyUpdateFlag|=pt.WorldVolume:o===$n.Tiled?this._dirtyUpdateFlag|=3:(this._customWidth===void 0||this._customHeight===void 0)&&(this._dirtyUpdateFlag|=pt.WorldVolume);break;case Be.border:this._drawMode===$n.Sliced&&(this._dirtyUpdateFlag|=3);break;case Be.region:case Be.atlasRegionOffset:this._dirtyUpdateFlag|=3;break;case Be.atlasRegion:this._dirtyUpdateFlag|=2;break;case Be.pivot:this._dirtyUpdateFlag|=pt.WorldVolume;break;case Be.destroy:this.sprite=null;break}},q(i,[{key:"drawMode",get:function(){return this._drawMode},set:function(e){if(this._drawMode!==e){switch(this._drawMode=e,e){case $n.Simple:this._assembler=fi;break;case $n.Sliced:this._assembler=qs;break;case $n.Tiled:this._assembler=Uu;break}this._assembler.resetData(this),this._dirtyUpdateFlag|=3}}},{key:"tileMode",get:function(){return this._tileMode},set:function(e){this._tileMode!==e&&(this._tileMode=e,this.drawMode===$n.Tiled&&(this._dirtyUpdateFlag|=3))}},{key:"tiledAdaptiveThreshold",get:function(){return this._tiledAdaptiveThreshold},set:function(e){e!==this._tiledAdaptiveThreshold&&(e=G.clamp(e,0,1),this._tiledAdaptiveThreshold=e,this.drawMode===$n.Tiled&&(this._dirtyUpdateFlag|=3))}},{key:"sprite",get:function(){return this._sprite},set:function(e){var r=this._sprite;r!==e&&(r&&(r._addReferCount(-1),r._updateFlagManager.removeListener(this._onSpriteChange)),this._dirtyUpdateFlag|=7,e?(e._addReferCount(1),e._updateFlagManager.addListener(this._onSpriteChange),this.shaderData.setTexture(i._textureProperty,e.texture)):this.shaderData.setTexture(i._textureProperty,null),this._sprite=e)}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"width",get:function(){return this._customWidth!==void 0?this._customWidth:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticWidth)},set:function(e){this._customWidth!==e&&(this._customWidth=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"height",get:function(){return this._customHeight!==void 0?this._customHeight:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticHeight)},set:function(e){this._customHeight!==e&&(this._customHeight=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyUpdateFlag|=pt.WorldVolume)}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._updateStencilState(this._maskInteraction,e),this._maskInteraction=e)}}]),i}(Ce);(function(){je._textureProperty=U.getByName("renderer_SpriteTexture")})();P([z],je.prototype,"_verticesData",void 0);P([z],je.prototype,"_drawMode",void 0);P([Ie],je.prototype,"_assembler",void 0);P([Ie],je.prototype,"_tileMode",void 0);P([Ie],je.prototype,"_tiledAdaptiveThreshold",void 0);P([K],je.prototype,"_color",void 0);P([z],je.prototype,"_sprite",void 0);P([z],je.prototype,"_automaticWidth",void 0);P([z],je.prototype,"_automaticHeight",void 0);P([Ie],je.prototype,"_customWidth",void 0);P([Ie],je.prototype,"_customHeight",void 0);P([Ie],je.prototype,"_flipX",void 0);P([Ie],je.prototype,"_flipY",void 0);P([Ie],je.prototype,"_maskLayer",void 0);P([Ie],je.prototype,"_maskInteraction",void 0);P([z],je.prototype,"_onSpriteChange",null);var mv;(function(n){n[n.UV=2]="UV",n[n.RenderData=3]="RenderData",n[n.AutomaticSize=4]="AutomaticSize",n[n.All=7]="All"})(mv||(mv={}));var dm=function n(){this.localPositions=new ue;var i=[new M,new M,new M,new M];this.renderData=new Bf(4,i,null,n.triangles,null)};(function(){dm.triangles=[0,2,1,2,0,3]})();var VS=function(){function n(a,t){this._elements=[],this._type=a;for(var e=this._elements,r=0;r<t;++r)e[r]=new a}var i=n.prototype;return i.get=function(){return this._elements.length>0?this._elements.pop():new this._type},i.put=function(t){this._elements.push(t)},n}(),dt=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._subFont=null,e._charRenderDatas=[],e._dirtyFlag=15,e._color=new J(1,1,1,1),e._text="",e._width=0,e._height=0,e._localBounds=new jt,e._font=null,e._fontSize=24,e._fontStyle=ki.None,e._lineSpacing=0,e._horizontalAlignment=wa.Center,e._verticalAlignment=Ta.Center,e._enableWrapping=!1,e._overflowMode=Oa.Overflow,e._maskInteraction=wt.None,e._maskLayer=Oo.Layer0,e._init(),e}var a=i.prototype;return a._init=function(){var e=this.engine;this._font=e._textDefaultFont,this._font._addReferCount(1),this.setMaterial(e._spriteDefaultMaterial)},a._onDestroy=function(){n.prototype._onDestroy.call(this);for(var e=this._charRenderDatas,r=0,o=e.length;r<o;++r)i._charRenderDataPool.put(e[r]);e.length=0,this._font&&(this._font._addReferCount(-1),this._font=null),this._subFont&&(this._subFont=null)},a._cloneTo=function(e,r,o){n.prototype._cloneTo.call(this,e,r,o),e.font=this._font,e._subFont=this._subFont},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._updateShaderData=function(e){this._updateTransformShaderData(e,$._identity)},a._updateBounds=function(e){jt.transform(this._localBounds,this._entity.transform.worldMatrix,e)},a._render=function(e){if(!(this._text===""||this.enableWrapping&&this.width<=0||this.overflowMode===Oa.Truncate&&this.height<=0)){this._isContainDirtyFlag(16)&&(this._updateStencilState(),this._setDirtyFlagFalse(16)),this._isContainDirtyFlag(1)&&(this._resetSubFont(),this._setDirtyFlagFalse(1)),this._isContainDirtyFlag(2)&&(this._updateLocalData(),this._setDirtyFlagFalse(2)),this._isContainDirtyFlag(4)&&(this._updatePosition(),this._setDirtyFlagFalse(4));var r=this._engine._spriteRenderDataPool,o=this._engine._textRenderDataPool.getFromPool(),s=o.charsData,l=this.getMaterial(),u=this._charRenderDatas,c=u.length;o.component=this,o.material=l,s.length=c;for(var d=0;d<c;++d){var _=u[d],f=r.getFromPool();f.set(this,l,_.renderData,_.texture,d),s[d]=f}e.camera._renderPipeline.pushRenderData(e,o)}},a._updateStencilState=function(){var e=this.getInstanceMaterial(),r=e.renderState.stencilState,o=this._maskInteraction;if(o===wt.None)r.enabled=!1,r.writeMask=255,r.referenceValue=0,r.compareFunctionFront=r.compareFunctionBack=Me.Always;else{r.enabled=!0,r.writeMask=0,r.referenceValue=1;var s=o===wt.VisibleInsideMask?Me.LessEqual:Me.Greater;r.compareFunctionFront=s,r.compareFunctionBack=s}},a._resetSubFont=function(){var e=this._font;this._subFont=e._getSubFont(this.fontSize,this.fontStyle),this._subFont.nativeFontString=ur.getNativeFontString(e.name,this.fontSize,this.fontStyle)},a._updatePosition=function(){for(var e=this.entity.transform,r=e.worldMatrix.elements,o=this._charRenderDatas,s=r[0],l=r[1],u=r[2],c=r[4],d=r[5],_=r[6],f=r[12],v=r[13],p=r[14],g=i._tempVec31.set(c,d,_),m=i._tempVec30.set(s,l,u),h=0,y=o.length;h<y;++h){var A=o[h],S=A.localPositions,x=A.renderData.positions,C=S.x,E=S.y,T=x[0];T.x=C*s+E*c+f,T.y=C*l+E*d+v,T.z=C*u+E*_+p;var w=x[1];M.scale(m,S.z-C,w),M.add(T,w,w);var R=x[2];M.scale(g,S.w-E,R),M.add(T,R,x[3]),M.add(w,R,R)}},a._updateLocalData=function(){var e=this,r=e.color,o=e._charRenderDatas,s=e._subFont,l=this._localBounds,u=l.min,c=l.max,d=this.enableWrapping?ur.measureTextWithWrap(this):ur.measureTextWithoutWrap(this),_=d.height,f=d.lines,v=d.lineWidths,p=d.lineHeight,g=d.lineMaxSizes,m=i._charRenderDataPool,h=f.length,y=0;if(h>0){var A=$r._pixelsPerUnit,S=this.horizontalAlignment,x=1/A,C=this.width*A,E=C*.5,T=this.height*A,w=p*.5,R=0,b=p*.5-g[0].ascent,B=p*.5-g[h-1].descent-1;switch(this.verticalAlignment){case Ta.Top:R=T*.5-w+b;break;case Ta.Center:R=_*.5-w-(B-b)*.5;break;case Ta.Bottom:R=_-T*.5-w-B;break}for(var I=-1,V=Number.MAX_SAFE_INTEGER,L=Number.MAX_SAFE_INTEGER,F=Number.MIN_SAFE_INTEGER,D=Number.MIN_SAFE_INTEGER,N=0;N<h;++N){var O=v[N];if(O>0){var k=f[N],Q=0,H=-1;switch(I<0&&(I=N),S){case wa.Left:Q=-E;break;case wa.Center:Q=-O*.5;break;case wa.Right:Q=E-O;break}for(var ee=0,ge=k.length;ee<ge;++ee){var le=k[ee],re=s._getCharInfo(le);if(re.h>0){var Ve,He;H<0&&(H=ee);var Qe=(Ve=o)[He=y++]||(Ve[He]=m.get()),Ee=Qe.renderData,ft=Qe.localPositions;Qe.texture=s._getTextureByIndex(re.index),Ee.color=r,Ee.uvs=re.uvs;var Je=re.w,at=re.ascent,se=re.descent,St=Q*x,Fn=(Q+Je)*x,ai=(R+at)*x,yr=(R-se+1)*x;ft.set(St,ai,Fn,yr),N===I&&(D=Math.max(D,ai)),L=Math.min(L,yr),ee===H&&(V=Math.min(V,St)),F=Math.max(F,Fn)}Q+=re.xAdvance}}R-=p}I<0?(u.set(0,0,0),c.set(0,0,0)):(u.set(V,L,0),c.set(F,D,0))}else u.set(0,0,0),c.set(0,0,0);var Pi=o.length;if(Pi>y){for(var oi=y;oi<Pi;++oi)m.put(o[oi]);o.length=y}s._getLastIndex()>0&&o.sort(function(fa,pl){return fa.texture.instanceId-pl.texture.instanceId})},a._onTransformChanged=function(e){n.prototype._onTransformChanged.call(this,e),this._setDirtyFlagTrue(12)},q(i,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"text",get:function(){return this._text},set:function(e){e=e||"",this._text!==e&&(this._text=e,this._setDirtyFlagTrue(14))}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this._setDirtyFlagTrue(14))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._setDirtyFlagTrue(14))}},{key:"font",get:function(){return this._font},set:function(e){var r=this._font;r!==e&&(r&&r._addReferCount(-1),e&&e._addReferCount(1),this._font=e,this._setDirtyFlagTrue(15))}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._setDirtyFlagTrue(15))}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(e){this.fontStyle!==e&&(this._fontStyle=e,this._setDirtyFlagTrue(15))}},{key:"lineSpacing",get:function(){return this._lineSpacing},set:function(e){this._lineSpacing!==e&&(this._lineSpacing=e,this._setDirtyFlagTrue(14))}},{key:"horizontalAlignment",get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._setDirtyFlagTrue(14))}},{key:"verticalAlignment",get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._setDirtyFlagTrue(14))}},{key:"enableWrapping",get:function(){return this._enableWrapping},set:function(e){this._enableWrapping!==e&&(this._enableWrapping=e,this._setDirtyFlagTrue(14))}},{key:"overflowMode",get:function(){return this._overflowMode},set:function(e){this._overflowMode!==e&&(this._overflowMode=e,this._setDirtyFlagTrue(14))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue(16))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"bounds",get:function(){return this._isContainDirtyFlag(1)&&this._resetSubFont(),this._isContainDirtyFlag(2)&&this._updateLocalData(),this._isContainDirtyFlag(4)&&this._updatePosition(),this._isContainDirtyFlag(8)&&this._updateBounds(this._bounds),this._setDirtyFlagFalse(15),this._bounds}}]),i}(Ce);(function(){dt._charRenderDataPool=new VS(dm,50)})();(function(){dt._tempVec30=new M})();(function(){dt._tempVec31=new M})();P([Ie],dt.prototype,"_subFont",void 0);P([z],dt.prototype,"_charRenderDatas",void 0);P([z],dt.prototype,"_dirtyFlag",void 0);P([K],dt.prototype,"_color",void 0);P([Ie],dt.prototype,"_text",void 0);P([Ie],dt.prototype,"_width",void 0);P([Ie],dt.prototype,"_height",void 0);P([z],dt.prototype,"_localBounds",void 0);P([Ie],dt.prototype,"_font",void 0);P([Ie],dt.prototype,"_fontSize",void 0);P([Ie],dt.prototype,"_fontStyle",void 0);P([Ie],dt.prototype,"_lineSpacing",void 0);P([Ie],dt.prototype,"_horizontalAlignment",void 0);P([Ie],dt.prototype,"_verticalAlignment",void 0);P([Ie],dt.prototype,"_enableWrapping",void 0);P([Ie],dt.prototype,"_overflowMode",void 0);P([Ie],dt.prototype,"_maskInteraction",void 0);P([Ie],dt.prototype,"_maskLayer",void 0);var yv;(function(n){n[n.SubFont=1]="SubFont",n[n.LocalPositionBounds=2]="LocalPositionBounds",n[n.WorldPosition=4]="WorldPosition",n[n.WorldBounds=8]="WorldBounds",n[n.MaskInteraction=16]="MaskInteraction",n[n.Position=14]="Position",n[n.Font=15]="Font"})(yv||(yv={}));LS.init();var $r=function(n){W(i,n);function i(t,e,r){var o;o=n.call(this)||this,o._physicsInitialized=!1,o._physicalObjectsMap={},o._lastRenderState=new Kr,o._renderElementPool=new Aa(Nx),o._renderDataPool=new Aa(Sc),o._spriteRenderDataPool=new Aa(Yx),o._spriteMaskRenderDataPool=new Aa(jx),o._textRenderDataPool=new Aa(qx),o._spriteDefaultMaterials=[],o._renderContext=new yi,o._renderCount=0,o._shaderProgramPools=[],o._canSpriteBatch=!0,o._fontMap={},o._macroCollection=new Dn,o._settings={},o._resourceManager=new zo(fe(o)),o._sceneManager=new im(fe(o)),o._vSyncCount=1,o._targetFrameRate=60,o._time=new yc,o._isPaused=!0,o._vSyncCounter=1,o._targetFrameInterval=1e3/60,o._destroyed=!1,o._frameInProcess=!1,o._waitingDestroy=!1,o._isDeviceLost=!1,o._waitingGC=!1,o._animate=function(){o._vSyncCount?(o._requestId=requestAnimationFrame(o._animate),o._vSyncCounter++%o._vSyncCount===0&&(o.update(),o._vSyncCounter=1)):(o._timeoutId=window.setTimeout(o._animate,o._targetFrameInterval),o.update())},o._hardwareRenderer=e,o._hardwareRenderer.init(t,o._onDeviceLost.bind(fe(o)),o._onDeviceRestored.bind(fe(o))),o._canvas=t,o._spriteMaskManager=new Xx(fe(o));var s=fe(o),l=s._spriteDefaultMaterials;if(o._spriteDefaultMaterial=l[wt.None]=o._createSpriteMaterial(wt.None),l[wt.VisibleInsideMask]=o._createSpriteMaterial(wt.VisibleInsideMask),l[wt.VisibleOutsideMask]=o._createSpriteMaterial(wt.VisibleOutsideMask),o._spriteMaskDefaultMaterial=o._createSpriteMaskMaterial(),o._textDefaultFont=No.createFromOS(fe(o),"Arial"),o._textDefaultFont.isGCIgnored=!0,o.inputManager=new um(fe(o)),o._initMagentaTextures(e),!e.canIUse(Z.depthTexture))o._macroCollection.enable(i._noDepthTextureMacro);else{var u=new fn(fe(o),1,1,X.Depth16,!1);u.isGCIgnored=!0,o._depthTexture2D=u}var c=new Lr(fe(o),be.find("unlit"));c.isGCIgnored=!0,c.shaderData.setColor("material_BaseColor",new av(1,0,1.01,1)),o._meshMagentaMaterial=c;var d=new Lr(fe(o),be.find("particle-shader"));d.isGCIgnored=!0,d.shaderData.setColor("material_BaseColor",new av(1,0,1.01,1)),o._particleMagentaMaterial=d;var _=o._settings,f=r.colorSpace||Qn.Linear;return f===Qn.Gamma&&o._macroCollection.enable(i._gammaMacro),_.colorSpace=f,o._particleBufferUtils=new cS(fe(o)),o}var a=i.prototype;return a.createEntity=function(e){return new Br(this,e)},a.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},a.resume=function(){this._isPaused&&(this._isPaused=!1,this.time._reset(),this._requestId=requestAnimationFrame(this._animate))},a.update=function(){var e=this._time;e._update();var r=e.deltaTime;this._frameInProcess=!0,this._renderElementPool.resetPool(),this._renderDataPool.resetPool(),this._spriteRenderDataPool.resetPool(),this._spriteMaskRenderDataPool.resetPool(),this._textRenderDataPool.resetPool();var o=this,s=o.inputManager,l=o._physicsInitialized;s._update();for(var u=this._sceneManager._scenes.getLoopArray(),c=u.length,d=0;d<c;d++){var _=u[d];!_.isActive||_.destroyed||(_._cameraNeedSorting&&_._sortCameras(),_._componentsManager.callScriptOnStart())}if(l)for(var f=0;f<c;f++){var v=u[f];!v.isActive||v.destroyed||v.physics._update(r)}l&&s._firePointerScript(u);for(var p=0;p<c;p++){var g=u[p];!g.isActive||g.destroyed||g._componentsManager.callScriptOnUpdate(r)}for(var m=0;m<c;m++){var h=u[m];!h.isActive||h.destroyed||h._componentsManager.callAnimationUpdate(r)}for(var y=0;y<c;y++){var A=u[y];!A.isActive||A.destroyed||A._componentsManager.callScriptOnLateUpdate(r)}if(this._isDeviceLost||this._render(u),this._waitingDestroy)this._destroy();else for(var S=0;S<c;S++){var x=u[S];!x.isActive||x.destroyed||x._componentsManager.handlingInvalidScripts()}this._waitingGC&&(this._gc(),this._waitingGC=!1),this._frameInProcess=!1},a.run=function(){this.resume(),this.dispatch("run",this)},a.forceLoseDevice=function(){this._hardwareRenderer.forceLoseDevice()},a.forceRestoreDevice=function(){this._hardwareRenderer.forceRestoreDevice()},a._destroy=function(){this._sceneManager._destroyAllScene(),this._resourceManager._destroy(),this._textDefaultFont=null,this._fontMap=null,this.inputManager._destroy(),this.dispatch("shutdown",this),this.pause(),this._spriteMaskManager.destroy(),this._hardwareRenderer.destroy(),this.removeAllEventListeners(),this._animate=null,this._sceneManager=null,this._resourceManager=null,this._canvas=null,this._time=null,this._waitingDestroy=!1,this._destroyed=!0},a.destroy=function(){this._destroyed||(this._frameInProcess?this._waitingDestroy=!0:this._destroy())},a._getShaderProgramPool=function(e){var r=e._shaderPassId,o=this._shaderProgramPools,s=o[r];if(!s){var l=r+1;l>o.length&&(o.length=l),o[r]=s=new IS}return s},a._render=function(e){for(var r=this.time.deltaTime,o=0,s=e.length;o<s;o++){var l=e[o];!l.isActive||l.destroyed||(l._componentsManager.callRendererOnUpdate(r),l._updateShaderData())}for(var u=0,c=e.length;u<c;u++){var d=e[u];if(!(!d.isActive||d.destroyed)){var _=d._activeCameras,f=_.length;if(f>0)for(var v=0;v<f;v++){var p=_[v],g=d._componentsManager;g.callCameraOnBeginRender(p),p.render(),g.callCameraOnEndRender(p),this._hardwareRenderer._options._forceFlush&&this._hardwareRenderer.flush()}else ve.debug("No active camera in scene.")}}},a._initMagentaTextures=function(e){var r=new Uint8Array([255,255,255,255]),o=new fn(this,1,1,X.R8G8B8A8,!1);o.setPixelBuffer(r),o.isGCIgnored=!0;var s=new Uint8Array([255,0,255,255]),l=new fn(this,1,1,X.R8G8B8A8,!1);l.setPixelBuffer(s),l.isGCIgnored=!0,this.resourceManager.addContentRestorer(new(function(_){W(f,_);function f(){return _.call(this,l)}var v=f.prototype;return v.restoreContent=function(){this.resource.setPixelBuffer(s)},f}(gi)));for(var u=new Tn(this,1,X.R8G8B8A8,!1),c=0;c<6;c++)u.setPixelBuffer(fr.PositiveX+c,s);if(u.isGCIgnored=!0,this.resourceManager.addContentRestorer(new(function(_){W(f,_);function f(){return _.call(this,u)}var v=f.prototype;return v.restoreContent=function(){for(var g=0;g<6;g++)this.resource.setPixelBuffer(fr.PositiveX+g,s)},f}(gi))),this._whiteTexture2D=o,this._magentaTexture2D=l,this._magentaTextureCube=u,e.isWebGL2){var d=new Mf(this,1,1,1,X.R8G8B8A8,!1);d.setPixelBuffer(0,s),d.isGCIgnored=!0,this.resourceManager.addContentRestorer(new(function(_){W(f,_);function f(){return _.call(this,d)}var v=f.prototype;return v.restoreContent=function(){this.resource.setPixelBuffer(0,s)},f}(gi))),this._magentaTexture2DArray=d}},a._pendingGC=function(){this._frameInProcess?this._waitingGC=!0:this._gc()},a._initialize=function(e){var r=this,o=e.shaderLab,s=e.physics;o&&(be._shaderLab=o);var l=new Array;s&&l.push(s.initialize().then(function(){return xn._nativePhysics=s,r._nativePhysicsManager=s.createPhysicsManager(),r._physicsInitialized=!0,r}));var u=zo._loaders;for(var c in u){var d=u[c];d.initialize&&l.push(d.initialize(this,e))}return Promise.all(l).then(function(){return r})},a._createSpriteMaterial=function(e){var r=new Lr(this,be.find("Sprite")),o=r.renderState,s=o.blendState.targetBlendState;if(s.enabled=!0,s.sourceColorBlendFactor=we.SourceAlpha,s.destinationColorBlendFactor=we.OneMinusSourceAlpha,s.sourceAlphaBlendFactor=we.One,s.destinationAlphaBlendFactor=we.OneMinusSourceAlpha,s.colorBlendOperation=s.alphaBlendOperation=dn.Add,e!==wt.None){var l=o.stencilState;l.enabled=!0,l.writeMask=0,l.referenceValue=1;var u=e===wt.VisibleInsideMask?Me.LessEqual:Me.Greater;l.compareFunctionFront=u,l.compareFunctionBack=u}return o.depthState.writeEnabled=!1,o.rasterState.cullMode=Mn.Off,o.renderQueueType=bt.Transparent,r.isGCIgnored=!0,r},a._createSpriteMaskMaterial=function(){var e=new Lr(this,be.find("SpriteMask")),r=e.renderState;return r.blendState.targetBlendState.colorWriteMask=ar.None,r.rasterState.cullMode=Mn.Off,r.stencilState.enabled=!0,r.depthState.enabled=!1,e.isGCIgnored=!0,e},a._onDeviceLost=function(){this._isDeviceLost=!0,this.resourceManager._lostGraphicResources(),console.log("Device lost."),this.dispatch("devicelost",this)},a._onDeviceRestored=function(){var e=this;this._hardwareRenderer.resetState(),this._lastRenderState=new Kr,this._shaderProgramPools.length=0;var r=this.resourceManager;r._restoreGraphicResources(),console.log("Graphic resource restored."),this._particleBufferUtils.setBufferData(),r._restoreResourcesContent().then(function(){console.log(`Graphic resource content restored.

Device restored.`),e.dispatch("devicerestored",e),e._isDeviceLost=!1}).catch(function(o){console.error(o)})},a._gc=function(){this._renderElementPool.garbageCollection(),this._renderDataPool.garbageCollection(),this._spriteRenderDataPool.garbageCollection(),this._spriteMaskRenderDataPool.garbageCollection(),this._textRenderDataPool.garbageCollection()},q(i,[{key:"settings",get:function(){return this._settings}},{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}},{key:"destroyed",get:function(){return this._destroyed}},{key:"physicsManager",get:function(){var e;return(e=this.sceneManager.scenes[0])==null?void 0:e.physics}}]),i}(Pf);(function(){$r._gammaMacro=oe.getByName("ENGINE_IS_COLORSPACE_GAMMA")})();(function(){$r._noDepthTextureMacro=oe.getByName("ENGINE_NO_DEPTH_TEXTURE")})();(function(){$r._pixelsPerUnit=100})();var Ai;(function(n){n[n.SolidColor=0]="SolidColor",n[n.Sky=1]="Sky",n[n.Texture=2]="Texture"})(Ai||(Ai={}));var Gi;(function(n){n[n.AspectFitWidth=0]="AspectFitWidth",n[n.AspectFitHeight=1]="AspectFitHeight",n[n.Fill=2]="Fill"})(Gi||(Gi={}));var Uo=function(){function n(){}var i=n.prototype;return i.destroy=function(){this.mesh=null,this.material=null},i._render=function(t){var e=this,r=e.material,o=e.mesh;if(!r){ve.warn("The material of sky is not defined.");return}if(r.destroyed){ve.warn("The material of sky is destroyed.");return}if(!o){ve.warn("The mesh of sky is not defined.");return}if(o.destroyed){ve.warn("The mesh of sky is destroyed.");return}var s=t.camera,l=s.engine,u=s.scene,c=s.aspectRatio,d=s.fieldOfView,_=s.viewMatrix,f=s.shaderData,v=u.shaderData,p=n._viewProjMatrix,g=n._projectionMatrix,m=l._hardwareRenderer,h=r.shaderData,y=r.shader,A=r.renderState;p.copyFrom(_);var S=p.elements;S[12]=S[13]=S[14]=0;var x=1/Math.tan(G.degreeToRadian(d)/2);g.elements[0]=x/c,g.elements[5]=x,$.multiply(g,p,p);var C=f.getMatrix(yi.vpMatrixProperty);f.setMatrix(yi.vpMatrixProperty,p);var E=be._compileMacros;Dn.unionCollection(t.camera._globalShaderMacro,h._macroCollection,E);var T=y.subShaders[0].passes[0],w=T._getShaderProgram(l,E);w.bind(),w.groupingOtherUniformBlock(),w.uploadAll(w.sceneUniformBlock,v),w.uploadAll(w.cameraUniformBlock,f),w.uploadAll(w.materialUniformBlock,h),w.uploadUnGroupTextures(),A._apply(l,!1,T._renderStateDataMap,h),m.drawPrimitive(o._primitive,o.subMesh,w),f.setMatrix(yi.vpMatrixProperty,C)},q(n,[{key:"material",get:function(){return this._material},set:function(t){if(this._material!==t){var e,r;(e=t)==null||e._addReferCount(1),(r=this._material)==null||r._addReferCount(-1),this._material=t}}},{key:"mesh",get:function(){return this._mesh},set:function(t){if(this._mesh!==t){var e,r;(e=t)==null||e._addReferCount(1),(r=this._mesh)==null||r._addReferCount(-1),this._mesh=t}}}]),n}();(function(){Uo._epsilon=1e-6})();(function(){Uo._viewProjMatrix=new $})();(function(){Uo._projectionMatrix=new $(1,0,0,0,0,1,0,0,0,0,Uo._epsilon-1,-1,0,0,0,0)})();var _m=function(){function n(a){this._engine=a,this.mode=Ai.SolidColor,this.solidColor=new J(.25,.25,.25,1),this.sky=new Uo,this._textureFillMode=Gi.AspectFitHeight,this._texture=null,this._initMesh(a),this._initMaterial(a)}var i=n.prototype;return i.destroy=function(){this.texture=null,this._mesh._addReferCount(-1),this._mesh=null,this._material._addReferCount(-1),this._material=null,this.solidColor=null,this.sky.destroy()},i._resizeBackgroundTexture=function(){var t=this,e=t._texture,r=t._mesh;if(this._texture){var o=this._engine.canvas,s=o.width,l=o.height,u=r.getPositions();switch(this._textureFillMode){case Gi.Fill:u[0].set(-1,-1,1),u[1].set(1,-1,1),u[2].set(-1,1,1),u[3].set(1,1,1);break;case Gi.AspectFitWidth:var c=e.height*s/e.width/l;u[0].set(-1,-c,1),u[1].set(1,-c,1),u[2].set(-1,c,1),u[3].set(1,c,1);break;case Gi.AspectFitHeight:var d=e.width*l/e.height/s;u[0].set(-d,-1,1),u[1].set(d,-1,1),u[2].set(-d,1,1),u[3].set(d,1,1);break}r.setPositions(u),r.uploadData(!1)}},i._initMesh=function(t){this._mesh=this._createPlane(t),this._mesh._addReferCount(1)},i._initMaterial=function(t){var e=this._material=new Lr(t,be.find("background-texture"));e.renderState.depthState.compareFunction=Me.LessEqual,e._addReferCount(1)},i._createPlane=function(t){var e=new Nt(t);e.isGCIgnored=!0;for(var r=new Uint8Array([1,2,0,1,3,2]),o=new Array(4),s=new Array(4),l=0;l<4;++l)o[l]=new M,s[l]=new te(l%2,1-(l*.5|0));return e.setPositions(o),e.setUVs(s),e.setIndices(r),e.uploadData(!1),e.addSubMesh(0,r.length),e},q(n,[{key:"texture",get:function(){return this._texture},set:function(t){if(this._texture!==t){var e,r;(e=t)==null||e._addReferCount(1),(r=this._texture)==null||r._addReferCount(-1),this._texture=t,this._material.shaderData.setTexture("material_BaseTexture",t),this._resizeBackgroundTexture()}}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(t){t!==this._textureFillMode&&(this._textureFillMode=t,this._resizeBackgroundTexture())}}]),n}(),NS=function(){function n(){this._renderers=new rt,this._onStartScripts=new rt,this._onUpdateScripts=new rt,this._onLateUpdateScripts=new rt,this._onPhysicsUpdateScripts=new rt,this._pendingDestroyScripts=[],this._disposeDestroyScripts=[],this._onUpdateAnimations=new rt,this._onUpdateRenderers=new rt,this._componentsContainerPool=[]}var i=n.prototype;return i.addRenderer=function(t){t._rendererIndex=this._renderers.length,this._renderers.add(t)},i.removeRenderer=function(t){var e=this._renderers.deleteByIndex(t._rendererIndex);e&&(e._rendererIndex=t._rendererIndex),t._rendererIndex=-1},i.addOnStartScript=function(t){t._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(t)},i.removeOnStartScript=function(t){var e=this._onStartScripts.deleteByIndex(t._onStartIndex);e&&(e._onStartIndex=t._onStartIndex),t._onStartIndex=-1},i.addOnUpdateScript=function(t){t._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(t)},i.removeOnUpdateScript=function(t){var e=this._onUpdateScripts.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addOnLateUpdateScript=function(t){t._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(t)},i.removeOnLateUpdateScript=function(t){var e=this._onLateUpdateScripts.deleteByIndex(t._onLateUpdateIndex);e&&(e._onLateUpdateIndex=t._onLateUpdateIndex),t._onLateUpdateIndex=-1},i.addOnPhysicsUpdateScript=function(t){t._onPhysicsUpdateIndex=this._onPhysicsUpdateScripts.length,this._onPhysicsUpdateScripts.add(t)},i.removeOnPhysicsUpdateScript=function(t){var e=this._onPhysicsUpdateScripts.deleteByIndex(t._onPhysicsUpdateIndex);e&&(e._onPhysicsUpdateIndex=t._onPhysicsUpdateIndex),t._onPhysicsUpdateIndex=-1},i.addOnUpdateAnimations=function(t){t._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(t)},i.removeOnUpdateAnimations=function(t){var e=this._onUpdateAnimations.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addOnUpdateRenderers=function(t){t._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(t)},i.removeOnUpdateRenderers=function(t){var e=this._onUpdateRenderers.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addPendingDestroyScript=function(t){this._pendingDestroyScripts.push(t)},i.callScriptOnStart=function(){var t=this,e=this._onStartScripts;e.length>0&&e.forEachAndClean(function(r){r._started=!0,t.removeOnStartScript(r),r.onStart()})},i.callScriptOnUpdate=function(t){this._onUpdateScripts.forEach(function(e){e._started&&e.onUpdate(t)},function(e,r){e._onUpdateIndex=r})},i.callScriptOnLateUpdate=function(t){this._onLateUpdateScripts.forEach(function(e){e._started&&e.onLateUpdate(t)},function(e,r){e._onLateUpdateIndex=r})},i.callScriptOnPhysicsUpdate=function(){this._onPhysicsUpdateScripts.forEach(function(t){t._started&&t.onPhysicsUpdate()},function(t,e){t._onPhysicsUpdateIndex=e})},i.callAnimationUpdate=function(t){this._onUpdateAnimations.forEach(function(e){e.engine.time.frameCount>e._playFrameCount&&e.update(t)},function(e,r){e._onUpdateIndex=r})},i.callRendererOnUpdate=function(t){this._onUpdateRenderers.forEach(function(e){e.update(t)},function(e,r){e._onUpdateIndex=r})},i.handlingInvalidScripts=function(){var t=this,e=t._disposeDestroyScripts,r=t._pendingDestroyScripts;this._disposeDestroyScripts=r,this._pendingDestroyScripts=e;var o=r.length;if(o>0){for(var s=o-1;s>=0;s--)r[s].onDestroy();r.length=0}},i.callCameraOnBeginRender=function(t){t.entity._scripts.forEach(function(e){e.onBeginRender(t)},function(e,r){e._entityScriptsIndex=r})},i.callCameraOnEndRender=function(t){t.entity._scripts.forEach(function(e){e.onEndRender(t)},function(e,r){e._entityScriptsIndex=r})},i.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},i.putActiveChangedTempList=function(t){t.length=0,this._componentsContainerPool.push(t)},i._gc=function(){this._renderers.garbageCollection(),this._onStartScripts.garbageCollection(),this._onUpdateScripts.garbageCollection(),this._onLateUpdateScripts.garbageCollection(),this._onPhysicsUpdateScripts.garbageCollection(),this._onUpdateAnimations.garbageCollection(),this._onUpdateRenderers.garbageCollection()},n}(),ku;(function(n){n[n.None=0]="None",n[n.Linear=1]="Linear",n[n.Exponential=2]="Exponential",n[n.ExponentialSquared=3]="ExponentialSquared"})(ku||(ku={}));var Ga;(function(n){n[n.SolidColor=0]="SolidColor",n[n.SphericalHarmonics=1]="SphericalHarmonics"})(Ga||(Ga={}));var vr=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._diffuseSolidColor=new J(.212,.227,.259),e._diffuseIntensity=1,e._specularIntensity=1,e._diffuseMode=Ga.SolidColor,e._shArray=new Float32Array(27),e._scenes=[],e._specularTextureDecodeRGBM=!1,e}var a=i.prototype;return a._addToScene=function(e){this._addReferCount(1),this._scenes.push(e);var r=e.shaderData;r.setColor(i._diffuseColorProperty,this._diffuseSolidColor),r.setFloat(i._diffuseIntensityProperty,this._diffuseIntensity),r.setFloat(i._specularIntensityProperty,this._specularIntensity),r.setFloatArray(i._diffuseSHProperty,this._shArray),this._setDiffuseMode(r),this._setSpecularTextureDecodeRGBM(r),this._setSpecularTexture(r)},a._removeFromScene=function(e){this._addReferCount(-1);var r=this._scenes,o=r.indexOf(e);r.splice(o,1);var s=e.shaderData;s.setTexture(i._specularTextureProperty,null),s.disableMacro(i._specularMacro)},a._setDiffuseMode=function(e){this._diffuseMode===Ga.SphericalHarmonics?e.enableMacro(i._shMacro):e.disableMacro(i._shMacro)},a._setSpecularTexture=function(e){this._specularTexture?(e.setTexture(i._specularTextureProperty,this._specularTexture),e.setFloat(i._mipLevelProperty,this._specularTexture.mipmapCount-1),e.enableMacro(i._specularMacro)):e.disableMacro(i._specularMacro)},a._setSpecularTextureDecodeRGBM=function(e){this._specularTextureDecodeRGBM?e.enableMacro(i._decodeRGBMMacro):e.disableMacro(i._decodeRGBMMacro)},a._preComputeSH=function(e,r){var o=e.coefficients;r[0]=o[0]*.886227,r[1]=o[1]*.886227,r[2]=o[2]*.886227,r[3]=o[3]*-1.023327,r[4]=o[4]*-1.023327,r[5]=o[5]*-1.023327,r[6]=o[6]*1.023327,r[7]=o[7]*1.023327,r[8]=o[8]*1.023327,r[9]=o[9]*-1.023327,r[10]=o[10]*-1.023327,r[11]=o[11]*-1.023327,r[12]=o[12]*.858086,r[13]=o[13]*.858086,r[14]=o[14]*.858086,r[15]=o[15]*-.858086,r[16]=o[16]*-.858086,r[17]=o[17]*-.858086,r[18]=o[18]*.247708,r[19]=o[19]*.247708,r[20]=o[20]*.247708,r[21]=o[21]*-.858086,r[22]=o[22]*-.858086,r[23]=o[23]*-.858086,r[24]=o[24]*.429042,r[25]=o[25]*.429042,r[26]=o[26]*.429042},q(i,[{key:"specularTextureDecodeRGBM",get:function(){return this._specularTextureDecodeRGBM},set:function(e){this._specularTextureDecodeRGBM=e;for(var r=this._scenes,o=0,s=r.length;o<s;o++)this._setSpecularTextureDecodeRGBM(r[o].shaderData)}},{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(e){this._diffuseMode=e;for(var r=this._scenes,o=0,s=r.length;o<s;o++)this._setDiffuseMode(r[o].shaderData)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(e){e!==this._diffuseSolidColor&&this._diffuseSolidColor.copyFrom(e)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(e){if(this._diffuseSphericalHarmonics=e,e){this._preComputeSH(e,this._shArray);for(var r=this._scenes,o=0,s=r.length;o<s;o++)r[o].shaderData.setFloatArray(i._diffuseSHProperty,this._shArray)}}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(e){this._diffuseIntensity=e;for(var r=this._scenes,o=0,s=r.length;o<s;o++)r[o].shaderData.setFloat(i._diffuseIntensityProperty,e)}},{key:"specularTexture",get:function(){return this._specularTexture},set:function(e){this._specularTexture=e;for(var r=this._scenes,o=0,s=r.length;o<s;o++)this._setSpecularTexture(r[o].shaderData)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(e){this._specularIntensity=e;for(var r=0,o=this._scenes.length;r<o;r++)this._scenes[r].shaderData.setFloat(i._specularIntensityProperty,e)}}]),i}(ni);(function(){vr._shMacro=oe.getByName("SCENE_USE_SH")})();(function(){vr._specularMacro=oe.getByName("SCENE_USE_SPECULAR_ENV")})();(function(){vr._decodeRGBMMacro=oe.getByName("SCENE_IS_DECODE_ENV_RGBM")})();(function(){vr._diffuseColorProperty=U.getByName("scene_EnvMapLight.diffuse")})();(function(){vr._diffuseSHProperty=U.getByName("scene_EnvSH")})();(function(){vr._diffuseIntensityProperty=U.getByName("scene_EnvMapLight.diffuseIntensity")})();(function(){vr._specularTextureProperty=U.getByName("scene_EnvSpecularSampler")})();(function(){vr._specularIntensityProperty=U.getByName("scene_EnvMapLight.specularIntensity")})();(function(){vr._mipLevelProperty=U.getByName("scene_EnvMapLight.mipMapLevel")})();var tr;(function(n){n[n.NoCascades=1]="NoCascades",n[n.TwoCascades=2]="TwoCascades",n[n.FourCascades=4]="FourCascades"})(tr||(tr={}));var Hi;(function(n){n[n.Low=0]="Low",n[n.Medium=1]="Medium",n[n.High=2]="High",n[n.VeryHigh=3]="VeryHigh"})(Hi||(Hi={}));var Ti;(function(n){n[n.None=0]="None",n[n.Hard=1]="Hard",n[n.SoftLow=2]="SoftLow",n[n.SoftHigh=3]="SoftHigh"})(Ti||(Ti={}));var ul=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.intensity=1,t.cullingMask=Yn.Everything,t.shadowType=Ti.None,t.shadowBias=1,t.shadowNormalBias=1,t.shadowNearPlane=.1,t.shadowStrength=1,t._lightIndex=-1,t._color=new J(1,1,1,1),t._lightColor=new J,t}var a=i.prototype;return a._getLightIntensityColor=function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor},q(i,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new $),$.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new $),$.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),i}(rn);P([z],ul.prototype,"_lightIndex",void 0);var aa=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._reverseDirection=new M,t}var a=i.prototype;return a._appendData=function(e,r){var o=e*2,s=e*3,l=e*3,u=this._getLightIntensityColor(),c=this.direction,d=this.cullingMask;r.cullingMask[o]=d&65535,r.cullingMask[o+1]=d>>>16&65535,this.engine.settings.colorSpace===Qn.Linear?(r.color[s]=J.gammaToLinearSpace(u.r),r.color[s+1]=J.gammaToLinearSpace(u.g),r.color[s+2]=J.gammaToLinearSpace(u.b)):(r.color[s]=u.r,r.color[s+1]=u.g,r.color[s+2]=u.b),r.direction[l]=c.x,r.direction[l+1]=c.y,r.direction[l+2]=c.z},a._onEnableInScene=function(){this.scene._lightManager._attachDirectLight(this)},a._onDisableInScene=function(){this.scene._lightManager._detachDirectLight(this)},i._updateShaderData=function(e,r){e.setIntArray(i._cullingMaskProperty,r.cullingMask),e.setFloatArray(i._colorProperty,r.color),e.setFloatArray(i._directionProperty,r.direction)},q(i,[{key:"direction",get:function(){return this.entity.transform.worldForward}},{key:"reverseDirection",get:function(){return M.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}},{key:"_shadowProjectionMatrix",get:function(){throw"Unknown!"}}]),i}(ul);(function(){aa._cullingMaskProperty=U.getByName("scene_DirectLightCullingMask")})();(function(){aa._colorProperty=U.getByName("scene_DirectLightColor")})();(function(){aa._directionProperty=U.getByName("scene_DirectLightDirection")})();var da=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.distance=100,t}var a=i.prototype;return a._appendData=function(e,r){var o=e*2,s=e*3,l=e*3,u=e,c=this._getLightIntensityColor(),d=this.position,_=this.cullingMask;r.cullingMask[o]=_&65535,r.cullingMask[o+1]=_>>>16&65535,this.engine.settings.colorSpace===Qn.Linear?(r.color[s]=J.gammaToLinearSpace(c.r),r.color[s+1]=J.gammaToLinearSpace(c.g),r.color[s+2]=J.gammaToLinearSpace(c.b)):(r.color[s]=c.r,r.color[s+1]=c.g,r.color[s+2]=c.b),r.position[l]=d.x,r.position[l+1]=d.y,r.position[l+2]=d.z,r.distance[u]=this.distance},a._onEnableInScene=function(){this.scene._lightManager._attachPointLight(this)},a._onDisableInScene=function(){this.scene._lightManager._detachPointLight(this)},i._updateShaderData=function(e,r){e.setIntArray(i._cullingMaskProperty,r.cullingMask),e.setFloatArray(i._colorProperty,r.color),e.setFloatArray(i._positionProperty,r.position),e.setFloatArray(i._distanceProperty,r.distance)},q(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"_shadowProjectionMatrix",get:function(){throw"Unknown!"}}]),i}(ul);(function(){da._cullingMaskProperty=U.getByName("scene_PointLightCullingMask")})();(function(){da._colorProperty=U.getByName("scene_PointLightColor")})();(function(){da._positionProperty=U.getByName("scene_PointLightPosition")})();(function(){da._distanceProperty=U.getByName("scene_PointLightDistance")})();var hr=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.distance=100,t.angle=Math.PI/6,t.penumbra=Math.PI/12,t._inverseDirection=new M,t._projectMatrix=new $,t}var a=i.prototype;return a._appendData=function(e,r){var o=e*2,s=e*3,l=e*3,u=e*3,c=e,d=e,_=e,f=this._getLightIntensityColor(),v=this.position,p=this.direction,g=this.cullingMask;r.cullingMask[o]=g&65535,r.cullingMask[o+1]=g>>>16&65535,this.engine.settings.colorSpace===Qn.Linear?(r.color[s]=J.gammaToLinearSpace(f.r),r.color[s+1]=J.gammaToLinearSpace(f.g),r.color[s+2]=J.gammaToLinearSpace(f.b)):(r.color[s]=f.r,r.color[s+1]=f.g,r.color[s+2]=f.b),r.position[l]=v.x,r.position[l+1]=v.y,r.position[l+2]=v.z,r.direction[u]=p.x,r.direction[u+1]=p.y,r.direction[u+2]=p.z,r.distance[c]=this.distance,r.angleCos[_]=Math.cos(this.angle),r.penumbraCos[d]=Math.cos(this.angle+this.penumbra)},a._onEnableInScene=function(){this.scene._lightManager._attachSpotLight(this)},a._onDisableInScene=function(){this.scene._lightManager._detachSpotLight(this)},i._updateShaderData=function(e,r){e.setIntArray(i._cullingMaskProperty,r.cullingMask),e.setFloatArray(i._colorProperty,r.color),e.setFloatArray(i._positionProperty,r.position),e.setFloatArray(i._directionProperty,r.direction),e.setFloatArray(i._distanceProperty,r.distance),e.setFloatArray(i._angleCosProperty,r.angleCos),e.setFloatArray(i._penumbraCosProperty,r.penumbraCos)},q(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.worldForward}},{key:"reverseDirection",get:function(){return M.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"_shadowProjectionMatrix",get:function(){var e=this._projectMatrix,r=Math.min(Math.PI/2,this.angle*2*Math.sqrt(2));return $.perspective(r,1,this.shadowNearPlane,this.distance+this.shadowNearPlane,e),e}}]),i}(ul);(function(){hr._cullingMaskProperty=U.getByName("scene_SpotLightCullingMask")})();(function(){hr._colorProperty=U.getByName("scene_SpotLightColor")})();(function(){hr._positionProperty=U.getByName("scene_SpotLightPosition")})();(function(){hr._directionProperty=U.getByName("scene_SpotLightDirection")})();(function(){hr._distanceProperty=U.getByName("scene_SpotLightDistance")})();(function(){hr._angleCosProperty=U.getByName("scene_SpotLightAngleCos")})();(function(){hr._penumbraCosProperty=U.getByName("scene_SpotLightPenumbraCos")})();var fm=function(){function n(){this._spotLights=new rt,this._pointLights=new rt,this._directLights=new rt,this._directData={cullingMask:new Int32Array(n._maxLight*2),color:new Float32Array(n._maxLight*3),direction:new Float32Array(n._maxLight*3)},this._pointData={cullingMask:new Int32Array(n._maxLight*2),color:new Float32Array(n._maxLight*3),position:new Float32Array(n._maxLight*3),distance:new Float32Array(n._maxLight)},this._spotData={cullingMask:new Int32Array(n._maxLight*2),color:new Float32Array(n._maxLight*3),position:new Float32Array(n._maxLight*3),direction:new Float32Array(n._maxLight*3),distance:new Float32Array(n._maxLight),angleCos:new Float32Array(n._maxLight),penumbraCos:new Float32Array(n._maxLight)}}var i=n.prototype;return i._attachSpotLight=function(t){t._lightIndex=this._spotLights.length,this._spotLights.add(t)},i._detachSpotLight=function(t){var e=this._spotLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._attachPointLight=function(t){t._lightIndex=this._pointLights.length,this._pointLights.add(t)},i._detachPointLight=function(t){var e=this._pointLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._attachDirectLight=function(t){t._lightIndex=this._directLights.length,this._directLights.add(t)},i._detachDirectLight=function(t){var e=this._directLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._updateSunLightIndex=function(){var t=this._directLights,e=this._getSunLightIndex();if(e>0){var r=t.get(0),o=t.get(e);t.set(0,o),t.set(e,r),o._lightIndex=0,r._lightIndex=e}},i._updateShaderData=function(t){for(var e=this,r=e._spotLights,o=e._pointLights,s=e._directLights,l=this,u=l._spotData,c=l._pointData,d=l._directData,_=r.length,f=o.length,v=s.length,p=0;p<_;p++)r.get(p)._appendData(p,u);for(var g=0;g<f;g++)o.get(g)._appendData(g,c);for(var m=0;m<v;m++)s.get(m)._appendData(m,d);v?(aa._updateShaderData(t,d),t.enableMacro("SCENE_DIRECT_LIGHT_COUNT",v.toString())):t.disableMacro("SCENE_DIRECT_LIGHT_COUNT"),f?(da._updateShaderData(t,c),t.enableMacro("SCENE_POINT_LIGHT_COUNT",f.toString())):t.disableMacro("SCENE_POINT_LIGHT_COUNT"),_?(hr._updateShaderData(t,u),t.enableMacro("SCENE_SPOT_LIGHT_COUNT",_.toString())):t.disableMacro("SCENE_SPOT_LIGHT_COUNT")},i._gc=function(){this._spotLights.garbageCollection(),this._pointLights.garbageCollection(),this._directLights.garbageCollection()},i._getSunLightIndex=function(){for(var t=this._directLights,e=-1,r=Number.NEGATIVE_INFINITY,o=!1,s=0,l=t.length;s<l;s++){var u=t.get(s);u.shadowType!==Ti.None&&!o&&(r=Number.NEGATIVE_INFINITY,o=!0);var c=u.intensity*u.color.getBrightness();o?u.shadowType!==Ti.None&&r<c&&(r=c,e=s):r<c&&(r=c,e=s)}return e},n}();(function(){fm._maxLight=10})();var ja=function(n){W(i,n);function i(t,e){var r;r=n.call(this,t)||this,r.physics=new xn(fe(r)),r.castShadows=!0,r.shadowResolution=Hi.Medium,r.shadowTwoCascadeSplits=1/3,r.shadowFourCascadeSplits=new M(1/15,3/15,7/15),r.shadowDistance=50,r._cameraNeedSorting=!1,r._lightManager=new fm,r._componentsManager=new NS,r._activeCameras=[],r._isActiveInEngine=!1,r._globalShaderMacro=new Dn,r._rootEntities=[],r._background=new _m(r._engine),r._shaderData=new ri(br.Scene),r._shadowCascades=tr.NoCascades,r._fogMode=ku.None,r._fogColor=new J(.5,.5,.5,1),r._fogStart=0,r._fogEnd=300,r._fogDensity=.01,r._fogParams=new ue,r._isActive=!0,r.name=e||"";var o=r.shaderData;return o._addReferCount(1),r.ambientLight=new vr(t),t.sceneManager._allCreatedScenes.push(fe(r)),o.enableMacro("SCENE_FOG_MODE",r._fogMode.toString()),o.enableMacro("SCENE_SHADOW_CASCADED_COUNT",r.shadowCascades.toString()),o.setColor(i._fogColorProperty,r._fogColor),o.setVector4(i._fogParamsProperty,r._fogParams),r._computeLinearFogParams(r._fogStart,r._fogEnd),r._computeExponentialFogParams(r._fogDensity),r}var a=i.prototype;return a.createRootEntity=function(e){var r=new Br(this._engine,e);return this.addRootEntity(r),r},a.addRootEntity=function(e,r){var o;typeof e=="number"?o=e:(o=void 0,r=e);var s=r._isRoot;s||(r._isRoot=!0,r._removeFromParent());var l=r._scene;l!==this?(l&&s&&l._removeFromEntityList(r),this._addToRootEntityList(o,r)):s||this._addToRootEntityList(o,r);var u=_e.None;r._isActiveInHierarchy&&(this._isActiveInEngine||(u|=_e.Hierarchy)),r._isActiveInScene&&l!==this&&(u|=_e.Scene),u&&r._processInActive(u),l!==this&&Br._traverseSetOwnerScene(r,this);var c=_e.None;r._isActive&&(this._isActiveInEngine&&!r._isActiveInHierarchy&&(c|=_e.Hierarchy),(!r._isActiveInScene||l!==this)&&(c|=_e.Scene)),c&&r._processActive(c)},a.removeRootEntity=function(e){if(e._isRoot&&e._scene==this){this._removeFromEntityList(e),e._isRoot=!1;var r=_e.None;this._isActiveInEngine&&e._isActiveInHierarchy&&(r|=_e.Hierarchy),e._isActiveInScene&&(r|=_e.Scene),r&&e._processInActive(r),Br._traverseSetOwnerScene(e,null)}},a.getRootEntity=function(e){return e===void 0&&(e=0),this._rootEntities[e]},a.findEntityByName=function(e){for(var r=this._rootEntities,o=0,s=r.length;o<s;o++){var l=r[o].findByName(e);if(l)return l}return null},a.findEntityByPath=function(e){for(var r=e.split("/").filter(Boolean),o=0,s=this.rootEntitiesCount;o<s;o++){var l=this.getRootEntity(o);if(l.name==r[0]){for(var u=1,c=r.length;u<c&&(l=Br._findChildByName(l,r[u]),!!l);++u);return l}}return null},a._sortCameras=function(){this._activeCameras.sort(function(e,r){return e.priority-r.priority}),this._cameraNeedSorting=!1},a._attachRenderCamera=function(e){var r=this._activeCameras,o=r.indexOf(e);o===-1?(r.push(e),this._cameraNeedSorting=!0):ve.warn("Camera already attached.")},a._detachRenderCamera=function(e){var r=this._activeCameras,o=r.indexOf(e);o!==-1&&r.splice(o,1)},a._processActive=function(e){this._isActiveInEngine=e;for(var r=this._rootEntities,o=r.length-1;o>=0;o--){var s=r[o];s._isActive&&(e?s._processActive(_e.Hierarchy):s._processInActive(_e.Hierarchy))}},a._updateShaderData=function(){var e=this.shaderData,r=this._engine,o=this._lightManager;if(r.time._updateSceneShaderData(e),o._updateShaderData(this.shaderData),o._updateSunLightIndex(),o._directLights.length>0){var s=o._directLights.get(0);e.setColor(i._sunlightColorProperty,s._getLightIntensityColor()),e.setVector3(i._sunlightDirectionProperty,s.direction),this._sunLight=s}else this._sunLight=null;this.castShadows&&this._sunLight&&this._sunLight.shadowType!==Ti.None?e.enableMacro("SCENE_SHADOW_TYPE",this._sunLight.shadowType.toString()):e.disableMacro("SCENE_SHADOW_TYPE"),Dn.unionCollection(this.engine._macroCollection,e._macroCollection,this._globalShaderMacro)},a._removeFromEntityList=function(e){var r=this._rootEntities,o=e._siblingIndex;r.splice(o,1);for(var s=r.length;o<s;o++)r[o]._siblingIndex--;e._siblingIndex=-1},a._onDestroy=function(){n.prototype._onDestroy.call(this);var e=this._engine.sceneManager;for(e.removeScene(this);this.rootEntitiesCount>0;)this._rootEntities[0].destroy();this._activeCameras.length=0,this.background.destroy(),this._ambientLight&&this._ambientLight._removeFromScene(this),this.shaderData._addReferCount(-1),this._componentsManager.handlingInvalidScripts();var r=e._allCreatedScenes;r.splice(r.indexOf(this),1)},a._addToRootEntityList=function(e,r){var o=this._rootEntities,s=o.length;if(e===void 0)r._siblingIndex=s,o.push(r);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;r._siblingIndex=e,o.splice(e,0,r);for(var l=e+1,u=s+1;l<u;l++)o[l]._siblingIndex++}},a._computeLinearFogParams=function(e,r){var o=r-e,s=this._fogParams;s.x=-1/o,s.y=r/o},a._computeExponentialFogParams=function(e){this._fogParams.z=e/Math.LN2,this._fogParams.w=e/Math.sqrt(Math.LN2)},q(i,[{key:"isActive",get:function(){return this._isActive},set:function(e){this._isActive!==e&&(this._isActive=e,e?this._sceneManager&&this._processActive(!0):this._sceneManager&&this._processActive(!1))}},{key:"shaderData",get:function(){return this._shaderData}},{key:"background",get:function(){return this._background}},{key:"shadowCascades",get:function(){return this._shadowCascades},set:function(e){this._shadowCascades!==e&&(this.shaderData.enableMacro("SCENE_SHADOW_CASCADED_COUNT",e.toString()),this._shadowCascades=e)}},{key:"ambientLight",get:function(){return this._ambientLight},set:function(e){if(!e){ve.warn("The scene must have one ambient light");return}var r=this._ambientLight;r!==e&&(r&&r._removeFromScene(this),e._addToScene(this),this._ambientLight=e)}},{key:"fogMode",get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this.shaderData.enableMacro("SCENE_FOG_MODE",e.toString()),this._fogMode=e)}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor!==e&&this._fogColor.copyFrom(e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart!==e&&(this._computeLinearFogParams(e,this._fogEnd),this._fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd!==e&&(this._computeLinearFogParams(this._fogStart,e),this._fogEnd=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity!==e&&(this._computeExponentialFogParams(e),this._fogDensity=e)}},{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}}]),i}(ti);(function(){ja._fogColorProperty=U.getByName("scene_FogColor")})();(function(){ja._fogParamsProperty=U.getByName("scene_FogParams")})();(function(){ja._sunlightColorProperty=U.getByName("scene_SunlightColor")})();(function(){ja._sunlightDirectionProperty=U.getByName("scene_SunlightDirection")})();var Tt=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._started=!1,t._onStartIndex=-1,t._onUpdateIndex=-1,t._onLateUpdateIndex=-1,t._onPhysicsUpdateIndex=-1,t._onPreRenderIndex=-1,t._onPostRenderIndex=-1,t._entityScriptsIndex=-1,t}var a=i.prototype;return a.onAwake=function(){},a.onEnable=function(){},a.onStart=function(){},a.onUpdate=function(e){},a.onLateUpdate=function(e){},a.onBeginRender=function(e){},a.onEndRender=function(e){},a.onPhysicsUpdate=function(){},a.onTriggerEnter=function(e){},a.onTriggerExit=function(e){},a.onTriggerStay=function(e){},a.onCollisionEnter=function(e){},a.onCollisionExit=function(e){},a.onCollisionStay=function(e){},a.onPointerDown=function(e){},a.onPointerUp=function(e){},a.onPointerClick=function(e){},a.onPointerEnter=function(e){},a.onPointerExit=function(e){},a.onPointerDrag=function(e){},a.onDisable=function(){},a.onDestroy=function(){},a._onAwake=function(){this.onAwake()},a._onEnable=function(){this.onEnable()},a._onDisable=function(){this.onDisable()},a._onEnableInScene=function(){var e=this.scene,r=e._componentsManager,o=i.prototype;this._started||r.addOnStartScript(this),this.onUpdate!==o.onUpdate&&r.addOnUpdateScript(this),this.onLateUpdate!==o.onLateUpdate&&r.addOnLateUpdateScript(this),this.onPhysicsUpdate!==o.onPhysicsUpdate&&r.addOnPhysicsUpdateScript(this),this._entity._addScript(this)},a._onDisableInScene=function(){var e=this.scene._componentsManager,r=i.prototype;this._started||e.removeOnStartScript(this),this.onUpdate!==r.onUpdate&&e.removeOnUpdateScript(this),this.onLateUpdate!==r.onLateUpdate&&e.removeOnLateUpdateScript(this),this.onPhysicsUpdate!==r.onPhysicsUpdate&&e.removeOnPhysicsUpdateScript(this),this._entity._removeScript(this)},a._onDestroy=function(){n.prototype._onDestroy.call(this),this.scene?this.scene._componentsManager.addPendingDestroyScript(this):this.onDestroy()},i}(rn);P([z],Tt.prototype,"_started",void 0);P([z],Tt.prototype,"_onStartIndex",void 0);P([z],Tt.prototype,"_onUpdateIndex",void 0);P([z],Tt.prototype,"_onLateUpdateIndex",void 0);P([z],Tt.prototype,"_onPhysicsUpdateIndex",void 0);P([z],Tt.prototype,"_onPreRenderIndex",void 0);P([z],Tt.prototype,"_onPostRenderIndex",void 0);P([z],Tt.prototype,"_entityScriptsIndex",void 0);var Js;(function(n){n[n.None=0]="None",n[n.PrePass=1]="PrePass"})(Js||(Js={}));var FS=0,_s=function(){function n(a,t,e,r,o){a===void 0&&(a="RENDER_PASS"+FS++),t===void 0&&(t=0),e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),this.name=a,this.enabled=!0,this.priority=t,this.renderTarget=e,this.replaceMaterial=r,this.mask=o||Yn.Everything,this.renderOverride=!1}var i=n.prototype;return i.render=function(t,e,r,o){},i.preRender=function(t,e,r,o){},i.postRender=function(t,e,r,o){},n}(),hm=function(n){W(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new Le("POSITION",0,ie.Vector3,0),e[1]=new Le("TEXCOORD_0",12,ie.Vector2,0),e[2]=new Le("COLOR_0",20,ie.Vector4,0),36},a.canBatch=function(e,r){if(!this._engine._canSpriteBatch||r.shaderPasses[0].getTagValue(Dr._disableBatchTag)===!0)return!1;var o=e.data,s=r.data,l=o.component,u=s.component;return!this.checkBatchWithMask(l,u)||o.texture!==s.texture?!1:o.material===s.material},a.checkBatchWithMask=function(e,r){var o=e.maskInteraction;return o!==r.maskInteraction?!1:o===wt.None?!0:e.maskLayer===r.maskLayer},a.updateVertices=function(e,r,o){for(var s=e.verticesData,l=s.positions,u=s.uvs,c=s.color,d=s.vertexCount,_=0;_<d;_++){var f=l[_],v=u[_];r[o++]=f.x,r[o++]=f.y,r[o++]=f.z,r[o++]=v.x,r[o++]=v.y,r[o++]=c.r,r[o++]=c.g,r[o++]=c.b,r[o++]=c.a}return o},a.drawBatches=function(e){for(var r=this,o=r._engine,s=r._batchedQueue,l=this._meshes[this._flushId],u=l.subMeshes,c=l._primitive,d=o._spriteMaskManager,_=e.scene.shaderData,f=e.shaderData,v=0,p=u.length;v<p;v++){var g=u[v],m=s[v],h=m.data;if(!g||!m)return;var y=h.component,A=h.material;d.preRender(e,y);var S=be._compileMacros;Dn.unionCollection(y._globalShaderMacro,A.shaderData._macroCollection,S);var x=m.shaderPasses[0],C=x._getShaderProgram(o,S);if(!C.isValid)return;y.shaderData.setTexture(i._textureProperty,h.texture),C.bind(),C.groupingOtherUniformBlock(),C.uploadAll(C.sceneUniformBlock,_),C.uploadAll(C.cameraUniformBlock,f),C.uploadAll(C.rendererUniformBlock,y.shaderData),C.uploadAll(C.materialUniformBlock,A.shaderData),A.renderState._apply(o,!1,x._renderStateDataMap,A.shaderData),o._hardwareRenderer.drawPrimitive(c,g,C),d.postRender(y)}},a.destroy=function(){this._batchedQueue=null;for(var e=this,r=e._meshes,o=e._vertexBuffers,s=e._indiceBuffers,l=0,u=r.length;l<u;++l)r[l].destroy();this._meshes=null;for(var c=0,d=o.length;c<d;++c)o[c].destroy();this._vertexBuffers=null;for(var _=0,f=s.length;_<f;++_)s[_].destroy();this._indiceBuffers=null},i}(Dr);(function(){hm._textureProperty=U.getByName("renderer_SpriteTexture")})();var ci=function(){function n(a,t){this.elements=[],this._initSpriteBatcher(a),this._renderQueueType=t}var i=n.prototype;return i.pushRenderElement=function(t){this.elements.push(t)},i.render=function(t,e,r){var o=this.elements;if(o.length!==0){for(var s=t.engine,l=t.scene,u=s._renderCount,c=s._hardwareRenderer,d=l.shaderData,_=t.shaderData,f=yi.pipelineStageKey,v=this._renderQueueType,p=0,g=o.length;p<g;p++){var m=o[p],h=m.data,y=m.shaderPasses,A=h.component.entity.layer;if(A&e)if(h.primitive){this._spriteBatcher.flush(t);var S=be._compileMacros,x=h.primitive,C=h.component,E=h.material,T=C.shaderData,w=E.shaderData,R=E.renderStates;Dn.unionCollection(C._globalShaderMacro,w._macroCollection,S);for(var b=0,B=y.length;b<B;b++){var I=y[b];if(I.getTagValue(f)===r){var V;if(((V=I._renderState)!=null?V:R[b]).renderQueueType===v){var L=I._getShaderProgram(s,S);if(L.isValid){var F=L.bind(),D=u!==L._uploadRenderCount;D?(L.groupingOtherUniformBlock(),L.uploadAll(L.sceneUniformBlock,d),L.uploadAll(L.cameraUniformBlock,_),L.uploadAll(L.rendererUniformBlock,T),L.uploadAll(L.materialUniformBlock,w),L.uploadUnGroupTextures(),L._uploadScene=l,L._uploadCamera=t,L._uploadRenderer=C,L._uploadMaterial=E,L._uploadRenderCount=u):(L._uploadScene!==l?(L.uploadAll(L.sceneUniformBlock,d),L._uploadScene=l):F&&L.uploadTextures(L.sceneUniformBlock,d),L._uploadCamera!==t?(L.uploadAll(L.cameraUniformBlock,_),L._uploadCamera=t):F&&L.uploadTextures(L.cameraUniformBlock,_),L._uploadRenderer!==C?(L.uploadAll(L.rendererUniformBlock,T),L._uploadRenderer=C):F&&L.uploadTextures(L.rendererUniformBlock,T),L._uploadMaterial!==E?(L.uploadAll(L.materialUniformBlock,w),L._uploadMaterial=E):F&&L.uploadTextures(L.materialUniformBlock,w),F&&L.uploadUnGroupTextures());var N,O=(N=I._renderState)!=null?N:R[b];O._apply(s,C.entity.transform._isFrontFaceInvert(),I._renderStateDataMap,E.shaderData),c.drawPrimitive(x,h.subPrimitive,L)}}}}}else this._spriteBatcher.drawElement(m,t)}this._spriteBatcher.flush(t)}},i.clear=function(){this.elements.length=0,this._spriteBatcher.clear()},i.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},i.sort=function(t){this._quickSort(this.elements,0,this.elements.length,t)},i._initSpriteBatcher=function(t){this._spriteBatcher=new hm(t)},i._quickSort=function(t,e,r,o){for(;;){if(r-e<=10){this._insertionSort(t,e,r,o);return}var s=e+r>>1,l=t[e],u=t[r-1],c=t[s],d=o(l,u);if(d>0){var _=l;l=u,u=_}var f=o(l,c);if(f>=0){var v=l;l=c,c=u,u=v}else{var p=o(u,c);if(p>0){var g=u;u=c,c=g}}t[e]=l,t[r-1]=c;var m=u,h=e+1,y=r-1;t[s]=t[h],t[h]=m;e:for(var A=h+1;A<y;A++){var S=t[A],x=o(S,m);if(x<0)t[A]=t[h],t[h]=S,h++;else if(x>0){do{if(y--,y==A)break e;var C=t[y];x=o(C,m)}while(x>0);t[A]=t[y],t[y]=S,x<0&&(S=t[A],t[A]=t[h],t[h]=S,h++)}}r-y<h-e?(this._quickSort(t,y,r,o),r=h):(this._quickSort(t,e,h,o),e=y)}},i._insertionSort=function(t,e,r,o){for(var s=e+1;s<r;s++){var l=void 0,u=t[s];for(l=s-1;l>=e;l--){var c=t[l],d=o(c,u);if(d>0)t[l+1]=c;else break}t[l+1]=u}},n._compareFromNearToFar=function(t,e){return t.data.component.priority-e.data.component.priority||t.data.component._distanceForSort-e.data.component._distanceForSort},n._compareFromFarToNear=function(t,e){return t.data.component.priority-e.data.component.priority||e.data.component._distanceForSort-t.data.component._distanceForSort},n}(),v_=function(){function n(){}return n.recreateTextureIfNeeded=function(a,t,e,r,o,s){if(t)if(t.width!==e||t.height!==r||t.format!==o||t.mipmapCount>1!==s){t.destroy();var l=new fn(a,e,r,o,s);return l.isGCIgnored=!0,l}else return t;else{var u=new fn(a,e,r,o,s);return u.isGCIgnored=!0,u}},n.recreateRenderTargetIfNeeded=function(a,t,e,r,o,s,l){var u,c,d=(u=t)==null?void 0:u.getColorTexture(0),_=(c=t)==null?void 0:c.depthTexture,f=o?n.recreateTextureIfNeeded(a,d,e,r,o,l):null,v=s?n.recreateTextureIfNeeded(a,_,e,r,s,l):null;if(d!==f||_!==v){var p;(p=t)==null||p.destroy(),t=new Iu(a,e,r,f,v),t.isGCIgnored=!0}return t},n}(),vm=function(){this.position=new M,this.isOrthographic=!1,this.viewMatrix=new $,this.projectionMatrix=new $,this.viewProjectionMatrix=new $,this.forward=new M},OS=function(){this.virtualCamera=new vm,this.cullPlanes=[new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M),new Mt(new M)],this.splitBoundSphere=new sl(new M,0)},Av;(function(n){n[n.FarBottomLeft=0]="FarBottomLeft",n[n.FarTopLeft=1]="FarTopLeft",n[n.FarTopRight=2]="FarTopRight",n[n.FarBottomRight=3]="FarBottomRight",n[n.nearBottomLeft=4]="nearBottomLeft",n[n.nearTopLeft=5]="nearTopLeft",n[n.nearTopRight=6]="nearTopRight",n[n.nearBottomRight=7]="nearBottomRight",n[n.unknown=8]="unknown"})(Av||(Av={}));var Pt=function(){function n(){}return n.shadowResolution=function(a){switch(a){case Hi.Low:return 512;case Hi.Medium:return 1024;case Hi.High:return 2048;case Hi.VeryHigh:return 4096}},n.shadowDepthFormat=function(a,t){return t?X.Depth16:X.R8G8B8A8},n.cullingRenderBounds=function(a,t,e){for(var r=a.min,o=a.max,s=0;s<t;s++){var l=e[s],u=l.normal;if(u.x*(u.x>=0?o.x:r.x)+u.y*(u.y>=0?o.y:r.y)+u.z*(u.z>=0?o.z:r.z)<-l.distance)return!1}return!0},n.shadowCullFrustum=function(a,t,e,r){var o=e._entity.layer;a.camera.cullingMask&o&&t.cullingMask&o&&e.castShadows&&n.cullingRenderBounds(e.bounds,r.cullPlaneCount,r.cullPlanes)&&(e._renderFrameCount=e.engine.time.frameCount,e._prepareRender(a))},n.getBoundSphereByFrustum=function(a,t,e,r,o){var s=e.aspectRatio,l=e.fieldOfView,u,c,d=Math.sqrt(1+s*s)*Math.tan(G.degreeToRadian(l)/2),_=d*d,f=t-a,v=t+a;_>f/v?(u=t,c=t*d):(u=.5*v*(1+_),c=.5*Math.sqrt(f*f+2*(t*t+a*a)*_+v*v*_*_));var p=o.splitBoundSphere.center;o.splitBoundSphere.radius=c,M.scale(r,u,p),M.add(e.entity.transform.worldPosition,p,p),o.sphereCenterZ=u},n.getDirectionLightShadowCullPlanes=function(a,t,e,r,o){var s=n._frustumCorners,l=n._backPlaneFaces,u=n._frustumPlaneNeighbors,c=n._frustumTwoPlaneCorners,d=n._edgePlanePoint2,_=o.cullPlanes,f=a.getPlane(Se.Near),v=a.getPlane(Se.Far),p=a.getPlane(Se.Left),g=a.getPlane(Se.Right),m=a.getPlane(Se.Bottom),h=a.getPlane(Se.Top),y=t-e,A=n._adjustNearPlane,S=n._adjustFarPlane;A.normal.copyFrom(f.normal),S.normal.copyFrom(v.normal),A.distance=f.distance-y,S.distance=Math.min(-f.distance+o.sphereCenterZ+o.splitBoundSphere.radius,v.distance),Et.intersectionPointThreePlanes(A,m,g,s[7]),Et.intersectionPointThreePlanes(A,h,g,s[6]),Et.intersectionPointThreePlanes(A,h,p,s[5]),Et.intersectionPointThreePlanes(A,m,p,s[4]),Et.intersectionPointThreePlanes(S,m,g,s[3]),Et.intersectionPointThreePlanes(S,h,g,s[2]),Et.intersectionPointThreePlanes(S,h,p,s[1]),Et.intersectionPointThreePlanes(S,m,p,s[0]);for(var x=0,C=0;C<6;C++){var E=void 0;switch(C){case Se.Near:E=A;break;case Se.Far:E=S;break;default:E=a.getPlane(C);break}M.dot(E.normal,r)<0&&(_[x].copyFrom(E),l[x]=C,x++)}for(var T=x,w=0;w<x;w++)for(var R=l[w],b=u[R],B=0;B<4;B++){for(var I=b[B],V=!0,L=0;L<x;L++)if(I==l[L]){V=!1;break}if(V){var F=c[R][I],D=s[F[0]],N=s[F[1]];M.add(D,r,d),Mt.fromPoints(D,N,d,_[T++])}}o.cullPlaneCount=T},n.getDirectionalLightMatrices=function(a,t,e,r,o,s,l,u){var c=l.splitBoundSphere;l.resolution=s;var d=c.center,_=c.radius,f=s/2,v=_*f/(f-n.atlasBorderSize),p=v*2,g=s/p,m=p/s,h=Math.ceil(M.dot(d,a)*g)*m,y=Math.ceil(M.dot(d,t)*g)*m,A=M.dot(d,e);d.x=a.x*h+t.x*y+e.x*A,d.y=a.y*h+t.y*y+e.y*A,d.z=a.z*h+t.z*y+e.z*A;var S=l.virtualCamera,x=S.position,C=S.viewMatrix,E=S.projectionMatrix;M.scale(e,_+o,x),M.subtract(d,x,x),$.lookAt(x,d,a,C),$.ortho(-v,v,-v,v,0,_*2+o,E);var T=S.viewProjectionMatrix;$.multiply(E,C,T),yt._floatMatrixMultiply(n._shadowMapCoordMatrix,T.elements,0,u,r*16)},n.getMaxTileResolutionInAtlas=function(a,t,e){for(var r=Math.min(a,t),o=Math.floor(a/r)*Math.floor(t/r);o<e;)r=Math.floor(r>>1),o=Math.floor(a/r)*Math.floor(t/r);return r},n.getShadowBias=function(a,t,e,r){var o=2/t.elements[0],s=o/e,l=-a.shadowBias*s,u=-a.shadowNormalBias*s;if(a.shadowType==Ti.SoftHigh){var c=2.5;l*=c,u*=c}r.set(l,u)},n.applySliceTransform=function(a,t,e,r,o,s){var l=n._tempMatrix0,u=l.elements,c=1/t,d=1/e,_=a*c,f=a*d,v=o.x*c,p=o.y*d;u[0]=_,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=f,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=v,u[13]=p,u[14]=0,u[15]=1;var g=r*16;yt._floatMatrixMultiply(l,s,g,s,g)},n}();(function(){Pt._tempMatrix0=new $})();(function(){Pt._shadowMapCoordMatrix=new $(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1)})();(function(){Pt._frustumCorners=[new M,new M,new M,new M,new M,new M,new M,new M]})();(function(){Pt._adjustNearPlane=new Mt(new M)})();(function(){Pt._adjustFarPlane=new Mt(new M)})();(function(){Pt._backPlaneFaces=new Array(5)})();(function(){Pt._edgePlanePoint2=new M})();(function(){Pt._frustumPlaneNeighbors=[[Se.Left,Se.Right,Se.Top,Se.Bottom],[Se.Left,Se.Right,Se.Top,Se.Bottom],[Se.Near,Se.Far,Se.Top,Se.Bottom],[Se.Near,Se.Far,Se.Top,Se.Bottom],[Se.Near,Se.Far,Se.Left,Se.Right],[Se.Near,Se.Far,Se.Left,Se.Right]]})();(function(){Pt._frustumTwoPlaneCorners=[[[8,8],[8,8],[4,5],[6,7],[7,4],[5,6]],[[8,8],[8,8],[1,0],[3,2],[0,3],[2,1]],[[5,4],[0,1],[8,8],[8,8],[4,0],[1,5]],[[7,6],[2,3],[8,8],[8,8],[3,7],[6,2]],[[4,7],[3,0],[0,4],[7,3],[8,8],[8,8]],[[6,5],[1,2],[5,1],[2,6],[8,8],[8,8]]]})();(function(){Pt.atlasBorderSize=4})();var pm=function(i){this._engine=i},pn=function(n){W(i,n);function i(t){var e;return e=n.call(this,t.engine)||this,e._shadowMapSize=new ue,e._shadowBias=new te,e._shadowSliceData=new OS,e._lightUp=new M,e._lightSide=new M,e._existShadowMap=!1,e._splitBoundSpheres=new Float32Array(i._maxCascades*4),e._shadowMatrices=new Float32Array((i._maxCascades+1)*16),e._shadowInfos=new M,e._viewportOffsets=[new te,new te,new te,new te],e._camera=t,e._supportDepthTexture=t.engine._hardwareRenderer.canIUse(Z.depthTexture),e._shadowSliceData.virtualCamera.isOrthographic=!0,e}var a=i.prototype;return a.onRender=function(e){this._updateShadowSettings(),this._existShadowMap=!1,this._renderDirectShadowMap(e),this._existShadowMap&&this._updateReceiversShaderData()},a._renderDirectShadowMap=function(e){var r=this,o=r._engine,s=r._camera,l=r._viewportOffsets,u=r._shadowSliceData,c=r._splitBoundSpheres,d=r._shadowMatrices,_=s._renderPipeline._cullingResults,f=_.opaqueQueue,v=_.alphaTestQueue,p=_.transparentQueue,g=s.scene,m=g._componentsManager,h=o._hardwareRenderer,y=g.shadowCascades,A=i._cascadesSplitDistance,S=u.splitBoundSphere,x=i._tempMatrix0,C=x.elements,E=this._lightUp,T=this._lightSide,w=u.virtualCamera.forward,R=s.scene._sunLight;if(R){var b=Math.min(s.scene.shadowDistance,s.farClipPlane);this._getCascadesSplitDistance(b);var B=this._shadowMapSize,I=B.z,V=B.w,L=this._shadowMapFormat,F,D;this._supportDepthTexture?(F=v_.recreateRenderTargetIfNeeded(o,this._renderTarget,I,V,null,L,!1),D=F.depthTexture):(F=v_.recreateRenderTargetIfNeeded(o,this._renderTarget,I,V,L,null,!1),D=F.getColorTexture(0)),D.wrapModeU=D.wrapModeV=$t.Clamp,o._hardwareRenderer._isWebGL2&&(D.depthCompareFunction=er.Less),this._renderTarget=F,this._depthTexture=D,h.activeRenderTarget(F,i._viewport,0),this._supportDepthTexture?h.clearRenderTarget(o,Xn.Depth,null):h.clearRenderTarget(o,Xn.All,i._clearColor),this._shadowInfos.x=R.shadowStrength,this._shadowInfos.z=0,$.rotationQuaternion(R.entity.transform.worldRotationQuaternion,x),T.set(C[0],C[1],C[2]),E.set(C[4],C[5],C[6]),w.set(-C[8],-C[9],-C[10]);var N=i._tempVector;N.copyFrom(s.entity.transform.worldForward);for(var O=this._shadowTileResolution,k=0;k<y;k++){Pt.getBoundSphereByFrustum(A[k],A[k+1],s,N,u),Pt.getDirectionLightShadowCullPlanes(s._frustum,A[k],s.nearClipPlane,w,u),Pt.getDirectionalLightMatrices(E,T,w,k,R.shadowNearPlane,O,u,d),y>1&&Pt.applySliceTransform(O,I,V,k,this._viewportOffsets[k],d),this._updateSingleShadowCasterShaderData(R,u,e);var Q=S.center,H=S.radius,ee=k*4;c[ee]=Q.x,c[ee+1]=Q.y,c[ee+2]=Q.z,c[ee+3]=H*H,f.clear(),v.clear(),p.clear();for(var ge=m._renderers,le=ge._elements,re=ge.length-1;re>=0;--re)Pt.shadowCullFrustum(e,R,le[re],u);if(f.elements.length||v.elements.length){f.sort(ci._compareFromNearToFar),v.sort(ci._compareFromNearToFar);var Ve=l[k],He=Ve.x,Qe=Ve.y;h.setGlobalDepthBias(1,1),h.viewport(He,Qe,O,O),h.scissor(He+1,Qe+1,O-2,O-2),o._renderCount++,f.render(s,Yn.Everything,hn.ShadowCaster),v.render(s,Yn.Everything,hn.ShadowCaster),h.setGlobalDepthBias(0,0)}}this._existShadowMap=!0}},a._updateReceiversShaderData=function(){var e=this._camera.scene,r=this._splitBoundSpheres,o=this._shadowMatrices,s=e.shadowCascades;if(s>1)for(var l=s*4,u=r.length;l<u;l++)r[l]=0;for(var c=s*16,d=o.length;c<d;c++)o[c]=0;var _=e.shaderData;_.setFloatArray(i._shadowMatricesProperty,this._shadowMatrices),_.setVector3(i._shadowInfosProperty,this._shadowInfos),_.setTexture(i._shadowMapsProperty,this._depthTexture),_.setFloatArray(i._shadowSplitSpheresProperty,this._splitBoundSpheres),_.setVector4(i._shadowMapSize,this._shadowMapSize)},a._getCascadesSplitDistance=function(e){var r=i._cascadesSplitDistance,o=this._camera.scene,s=o.shadowTwoCascadeSplits,l=o.shadowFourCascadeSplits,u=o.shadowCascades,c=this._camera,d=c.nearClipPlane,_=c.aspectRatio,f=c.fieldOfView;r[0]=d;var v=e-d,p=Math.tan(G.degreeToRadian(f)*.5),g=1+p*p*(_*_+1);switch(u){case tr.NoCascades:r[1]=this._getFarWithRadius(e,g);break;case tr.TwoCascades:r[1]=this._getFarWithRadius(d+v*s,g),r[2]=this._getFarWithRadius(e,g);break;case tr.FourCascades:r[1]=this._getFarWithRadius(d+v*l.x,g),r[2]=this._getFarWithRadius(d+v*l.y,g),r[3]=this._getFarWithRadius(d+v*l.z,g),r[4]=this._getFarWithRadius(e,g);break}},a._getFarWithRadius=function(e,r){return Math.sqrt(e*e/r)},a._updateShadowSettings=function(){var e=this._camera.scene,r=Pt.shadowDepthFormat(e.shadowResolution,this._supportDepthTexture),o=Pt.shadowResolution(e.shadowResolution),s=e.shadowCascades;if(r!==this._shadowMapFormat||o!==this._shadowMapResolution||s!==this._shadowCascadeMode){if(this._shadowMapFormat=r,this._shadowMapResolution=o,this._shadowCascadeMode=s,s==tr.NoCascades)this._shadowTileResolution=o,this._shadowMapSize.set(1/o,1/o,o,o);else{var l=Pt.getMaxTileResolutionInAtlas(o,o,s);this._shadowTileResolution=l;var u=l*2,c=s==tr.TwoCascades?l:l*2;this._shadowMapSize.set(1/u,1/c,u,c)}this._renderTarget=null;var d=this._viewportOffsets,_=this._shadowTileResolution;switch(s){case tr.NoCascades:d[0].set(0,0);break;case tr.TwoCascades:d[0].set(0,0),d[1].set(_,0);break;case tr.FourCascades:d[0].set(0,0),d[1].set(_,0),d[2].set(0,_),d[3].set(_,_)}}},a._updateSingleShadowCasterShaderData=function(e,r,o){var s=r.virtualCamera;Pt.getShadowBias(e,s.projectionMatrix,this._shadowTileResolution,this._shadowBias);var l=this._camera.scene.shaderData;l.setVector2(i._lightShadowBiasProperty,this._shadowBias),l.setVector3(i._lightDirectionProperty,e.direction),o.applyVirtualCamera(s)},i}(pm);(function(){pn._lightShadowBiasProperty=U.getByName("scene_ShadowBias")})();(function(){pn._lightDirectionProperty=U.getByName("scene_LightDirection")})();(function(){pn._shadowMatricesProperty=U.getByName("scene_ShadowMatrices")})();(function(){pn._shadowMapSize=U.getByName("scene_ShadowMapSize")})();(function(){pn._shadowInfosProperty=U.getByName("scene_ShadowInfo")})();(function(){pn._shadowMapsProperty=U.getByName("scene_ShadowMap")})();(function(){pn._shadowSplitSpheresProperty=U.getByName("scene_ShadowSplitSpheres")})();(function(){pn._maxCascades=4})();(function(){pn._cascadesSplitDistance=new Array(pn._maxCascades+1)})();(function(){pn._viewport=new ue(0,0,1,1)})();(function(){pn._clearColor=new J(1,1,1,1)})();(function(){pn._tempVector=new M})();(function(){pn._tempMatrix0=new $})();var zS=function(){function n(a){this.opaqueQueue=new ci(a,bt.Opaque),this.transparentQueue=new ci(a,bt.Transparent),this.alphaTestQueue=new ci(a,bt.AlphaTest)}var i=n.prototype;return i.reset=function(){this.opaqueQueue.clear(),this.transparentQueue.clear(),this.alphaTestQueue.clear()},i.sort=function(){this.opaqueQueue.sort(ci._compareFromNearToFar),this.alphaTestQueue.sort(ci._compareFromNearToFar),this.transparentQueue.sort(ci._compareFromFarToNear)},i.destroy=function(){this.opaqueQueue.destroy(),this.transparentQueue.destroy(),this.alphaTestQueue.destroy()},n}(),US=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e._supportDepthTexture=t._hardwareRenderer.canIUse(Z.depthTexture),e}var a=i.prototype;return a.onConfig=function(e){var r=this._engine,o=e.pixelViewport,s=o.width,l=o.height,u=v_.recreateRenderTargetIfNeeded(r,this._renderTarget,s,l,null,X.Depth16,!1),c=u.depthTexture;c.wrapModeU=c.wrapModeV=$t.Clamp,c.filterMode=tn.Point,this._renderTarget=u},a.onRender=function(e,r){var o=this._engine,s=this._renderTarget,l=e.camera,u=o._hardwareRenderer;u.activeRenderTarget(s,l.viewport,0),u.clearRenderTarget(o,Xn.Depth,null),u.viewport(0,0,s.width,s.height),u.scissor(0,0,s.width,s.height),r.opaqueQueue.render(l,Yn.Everything,hn.DepthOnly),r.alphaTestQueue.render(l,Yn.Everything,hn.DepthOnly),l.shaderData.setTexture(et._cameraDepthTextureProperty,this._renderTarget.depthTexture)},i}(pm),gm=function(){function n(a){this._allSpriteMasks=new rt,this._lastCanvasSize=new te,this._camera=a;var t=a.engine;this._cullingResults=new zS(t),this._cascadedShadowCaster=new pn(a),this._depthOnlyPass=new US(t),this._renderPassArray=[],this._defaultPass=new _s("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var i=n.prototype;return i.addRenderPass=function(t,e,r,o,s){if(e===void 0&&(e=null),r===void 0&&(r=null),o===void 0&&(o=null),s===void 0&&(s=null),typeof t=="string"){var l=new _s(t,e,r,o,s);this._renderPassArray.push(l)}else gt(t,_s)&&this._renderPassArray.push(t);this._renderPassArray.sort(function(u,c){return u.priority-c.priority})},i.removeRenderPass=function(t){var e;if(typeof t=="string"?e=this.getRenderPass(t):gt(t,_s)&&(e=t),e){var r=this._renderPassArray.indexOf(e);this._renderPassArray.splice(r,1)}},i.getRenderPass=function(t){for(var e=0,r=this._renderPassArray.length;e<r;e++){var o=this._renderPassArray[e];if(o.name===t)return o}return null},i.destroy=function(){this._cullingResults.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},i.render=function(t,e,r){var o,s=this._camera,l=s.scene,u=this._cullingResults;s.engine._spriteMaskManager.clear(),l.castShadows&&((o=l._sunLight)==null?void 0:o.shadowType)!==Ti.None&&this._cascadedShadowCaster.onRender(t),u.reset(),this._allSpriteMasks.length=0,t.applyVirtualCamera(s._virtualCamera),this._callRender(t),u.sort();var c=this._depthOnlyPass;s.depthTextureMode===Js.PrePass&&c._supportDepthTexture?(c.onConfig(s),c.onRender(t,u)):s.shaderData.setTexture(et._cameraDepthTextureProperty,s.engine._whiteTexture2D);for(var d=0,_=this._renderPassArray.length;d<_;d++)this._drawRenderPass(t,this._renderPassArray[d],s,e,r)},i._drawRenderPass=function(t,e,r,o,s){var l=this._cullingResults,u=l.opaqueQueue,c=l.alphaTestQueue,d=l.transparentQueue;if(e.preRender(r,u,c,d),e.enabled){var _,f,v,p=r.engine,g=r.scene,m=g.background,h=p._hardwareRenderer,y=r.renderTarget||e.renderTarget;h.activeRenderTarget(y,r.viewport,s),(_=y)==null||_._setRenderTargetInfo(o,s);var A,S=(A=e.clearFlags)!=null?A:r.clearFlags,x,C=(x=e.clearColor)!=null?x:m.solidColor;S!==Xn.None&&h.clearRenderTarget(r.engine,S,C),e.renderOverride?e.render(r,u,c,d):(u.render(r,e.mask,hn.Forward),c.render(r,e.mask,hn.Forward),r.clearFlags&Xn.Color&&(m.mode===Ai.Sky?m.sky._render(t):m.mode===Ai.Texture&&m.texture&&this._drawBackgroundTexture(p,m)),l.transparentQueue.render(r,e.mask,hn.Forward)),(f=y)==null||f._blitRenderTarget(),(v=y)==null||v.generateMipmaps()}e.postRender(r,l.opaqueQueue,l.alphaTestQueue,l.transparentQueue)},i.pushRenderData=function(t,e){var r=e.material,o=r.renderStates,s=r.shader.subShaders[0],l=t.replacementShader;if(l){var u=l.subShaders,c=t.replacementTag;if(c)for(var d=0,_=u.length;d<_;d++){var f=u[d];if(f.getTagValue(c)===s.getTagValue(c)){this.pushRenderDataWithShader(t,e,f.passes,o);break}}else this.pushRenderDataWithShader(t,e,u[0].passes,o)}else this.pushRenderDataWithShader(t,e,s.passes,o)},i.pushRenderDataWithShader=function(t,e,r,o){for(var s=this._cullingResults,l=s.opaqueQueue,u=s.alphaTestQueue,c=s.transparentQueue,d=t.camera.engine._renderElementPool,_=0,f=0,v=r.length;f<v;f++){var p,g=((p=r[f]._renderState)!=null?p:o[f]).renderQueueType;if(!(_&1<<g)){var m=d.getFromPool();switch(m.set(e,r),g){case bt.Opaque:l.pushRenderElement(m),_|=1;break;case bt.AlphaTest:u.pushRenderElement(m),_|=2;break;case bt.Transparent:c.pushRenderElement(m),_|=4;break}}}},i._drawBackgroundTexture=function(t,e){var r=t._hardwareRenderer,o=t.canvas,s=e._material,l=e._mesh;(this._lastCanvasSize.x!==o.width||this._lastCanvasSize.y!==o.height)&&e._textureFillMode!==Gi.Fill&&(this._lastCanvasSize.set(o.width,o.height),e._resizeBackgroundTexture());var u=s.shader.subShaders[0].passes[0],c=u._getShaderProgram(t,be._compileMacros);c.bind(),c.uploadAll(c.materialUniformBlock,s.shaderData),c.uploadUnGroupTextures(),(u._renderState||s.renderState)._apply(t,!1,u._renderStateDataMap,s.shaderData),r.drawPrimitive(l._primitive,l.subMesh,c)},i._callRender=function(t){for(var e=t.camera.engine,r=t.camera,o=r.scene._componentsManager._renderers,s=o._elements,l=o.length-1;l>=0;--l){var u=s[l];r.cullingMask&u._entity.layer&&(r.enableFrustumCulling&&!r._frustum.intersectsBox(u.bounds)||(u._renderFrameCount=e.time.frameCount,u._prepareRender(t)))}},q(n,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),n}(),xv;(function(n){n[n.None=0]="None",n[n.Opaque=1]="Opaque",n[n.AlphaTest=2]="AlphaTest",n[n.Transparent=4]="Transparent"})(xv||(xv={}));var Di,Ra=function(){};(function(){Ra.tempVec4=new ue})();(function(){Ra.tempVec3=new M})();(function(){Ra.tempVec2=new te})();var et=(Di=function(n){W(i,n);function i(t){var e;e=n.call(this,t)||this,e.enableFrustumCulling=!0,e.clearFlags=Xn.All,e.cullingMask=Yn.Everything,e.depthTextureMode=Js.None,e._globalShaderMacro=new Dn,e._frustum=new s1,e._virtualCamera=new vm,e._replacementShader=null,e._replacementSubShaderTag=null,e._priority=0,e._shaderData=new ri(br.Camera),e._isProjMatSetting=!1,e._nearClipPlane=.1,e._farClipPlane=100,e._fieldOfView=45,e._orthographicSize=10,e._isProjectionDirty=!0,e._isInvProjMatDirty=!0,e._isFrustumProjectDirty=!0,e._customAspectRatio=void 0,e._renderTarget=null,e._depthBufferParams=new ue,e._viewport=new ue(0,0,1,1),e._pixelViewport=new Rr(0,0,0,0),e._inverseProjectionMatrix=new $,e._lastAspectSize=new te(0,0),e._invViewProjMat=new $;var r=e.entity.transform;return e._transform=r,e._isViewMatrixDirty=r.registerWorldChangeFlag(),e._isInvViewProjDirty=r.registerWorldChangeFlag(),e._frustumViewChangeFlag=r.registerWorldChangeFlag(),e._renderPipeline=new gm(fe(e)),e.shaderData._addReferCount(1),e._updatePixelViewport(),e}var a=i.prototype;return a.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},a.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},a.worldToViewportPoint=function(e,r){var o=Ra.tempVec3,s=Ra.tempVec4;M.transformCoordinate(e,this.viewMatrix,o),M.transformToVec4(o,this.projectionMatrix,s);var l=s.w;return r.set((s.x/l+1)*.5,(1-s.y/l)*.5,-o.z),r},a.viewportToWorldPoint=function(e,r){var o=this,s=o.nearClipPlane,l=o.farClipPlane,u=1/(s-l),c;if(this.isOrthographic)c=-e.z*2*u,c+=(l+s)*u;else{var d=e.z;c=-d*(s+l)*u,c+=2*s*l*u,c=c/d}return this._innerViewportToWorldPoint(e.x,e.y,(c+1)/2,this._getInvViewProjMat(),r),r},a.viewportPointToRay=function(e,r){var o=this._getInvViewProjMat(),s=this._innerViewportToWorldPoint(e.x,e.y,0,o,r.origin),l=this._innerViewportToWorldPoint(e.x,e.y,1-G.zeroTolerance,o,r.direction);return M.subtract(l,s,l),l.normalize(),r},a.screenToViewportPoint=function(e,r){var o=this.engine.canvas,s=this.viewport;return r.x=(e.x/o.width-s.x)/s.z,r.y=(e.y/o.height-s.y)/s.w,e.z!==void 0&&(r.z=e.z),r},a.viewportToScreenPoint=function(e,r){var o=this.engine.canvas,s=this.viewport;return r.x=(s.x+e.x*s.z)*o.width,r.y=(s.y+e.y*s.w)*o.height,e.z!==void 0&&(r.z=e.z),r},a.worldToScreenPoint=function(e,r){return this.worldToViewportPoint(e,r),this.viewportToScreenPoint(r,r)},a.screenToWorldPoint=function(e,r){return this.screenToViewportPoint(e,r),this.viewportToWorldPoint(r,r)},a.screenPointToRay=function(e,r){var o=Ra.tempVec2;return this.screenToViewportPoint(e,o),this.viewportPointToRay(o,r)},a.render=function(e,r){r===void 0&&(r=0);var o=this.engine._renderContext,s=this._virtualCamera,l=this.entity.transform;$.multiply(this.projectionMatrix,this.viewMatrix,s.viewProjectionMatrix),s.position.copyFrom(l.worldPosition),s.isOrthographic&&s.forward.copyFrom(l.worldForward),o.camera=this,o.virtualCamera=s,o.replacementShader=this._replacementShader,o.replacementTag=this._replacementSubShaderTag,this.enableFrustumCulling&&(this._frustumViewChangeFlag.flag||this._isFrustumProjectDirty)&&(this._frustum.calculateFromMatrix(s.viewProjectionMatrix),this._frustumViewChangeFlag.flag=!1,this._isFrustumProjectDirty=!1),this._updateShaderData(),Dn.unionCollection(this.scene._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro),r>0&&!this.engine._hardwareRenderer.isWebGL2&&(r=0,ve.error("mipLevel only take effect in WebGL2.0")),this._renderPipeline.render(o,e,r),this._engine._renderCount++},a.setReplacementShader=function(e,r){this._replacementShader=e,this._replacementSubShaderTag=typeof r=="string"?mi.getByName(r):r},a.resetReplacementShader=function(){this._replacementShader=null,this._replacementSubShaderTag=null},a._onEnableInScene=function(){this.scene._attachRenderCamera(this)},a._onDisableInScene=function(){this.scene._detachRenderCamera(this)},a._onDestroy=function(){var e;n.prototype._onDestroy.call(this),(e=this._renderPipeline)==null||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this.shaderData._addReferCount(-1),this._entity=null,this._globalShaderMacro=null,this._frustum=null,this._renderPipeline=null,this._virtualCamera=null,this._shaderData=null,this._frustumViewChangeFlag=null,this._transform=null,this._isViewMatrixDirty=null,this._isInvViewProjDirty=null,this._viewport=null,this._inverseProjectionMatrix=null,this._lastAspectSize=null,this._invViewProjMat=null},a._updatePixelViewport=function(){var e,r,o=this._viewport,s,l=(s=(e=this._renderTarget)==null?void 0:e.width)!=null?s:this.engine.canvas.width,u,c=(u=(r=this._renderTarget)==null?void 0:r.height)!=null?u:this.engine.canvas.height;this._pixelViewport.set(o.x*l,o.y*c,o.z*l,o.w*c)},a._projMatChange=function(){this._isFrustumProjectDirty=!0,this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},a._innerViewportToWorldPoint=function(e,r,o,s,l){var u=Ra.tempVec3;return u.set(e*2-1,1-r*2,o*2-1),M.transformCoordinate(u,s,l),l},a._updateShaderData=function(){var e=this.shaderData,r=this._transform;e.setMatrix(et._inverseViewMatrixProperty,r.worldMatrix),e.setVector3(et._cameraPositionProperty,r.worldPosition),e.setVector3(et._cameraForwardProperty,r.worldForward),e.setVector3(et._cameraUpProperty,r.worldUp);var o=this._depthBufferParams,s=this._farClipPlane/this._nearClipPlane;o.set(1-s,s,0,0),e.setVector4(et._cameraDepthBufferParamsProperty,o)},a._getInvViewProjMat=function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,$.multiply(this._transform.worldMatrix,this._getInverseProjectionMatrix(),this._invViewProjMat)),this._invViewProjMat},a._getInverseProjectionMatrix=function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,$.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix},q(i,[{key:"shaderData",get:function(){return this._shaderData}},{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e=this._entity.engine.canvas,r;return(r=this._customAspectRatio)!=null?r:e.width*this._viewport.z/(e.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&this._viewport.copyFrom(e),this._projMatChange(),this._updatePixelViewport()}},{key:"pixelViewport",get:function(){return this._pixelViewport}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority!==e&&(this._entity._isActiveInScene&&this.enabled&&(this.scene._cameraNeedSorting=!0),this._priority=e)}},{key:"isOrthographic",get:function(){return this._virtualCamera.isOrthographic},set:function(e){this._virtualCamera.isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"viewMatrix",get:function(){var e=this._virtualCamera.viewMatrix;if(this._isViewMatrixDirty.flag){this._isViewMatrixDirty.flag=!1;var r=this._transform;$.rotationTranslation(r.worldRotationQuaternion,r.worldPosition,e),e.invert()}return e}},{key:"projectionMatrix",get:function(){var e=this._virtualCamera,r=e.projectionMatrix,o=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===o.width&&this._lastAspectSize.y===o.height)return r;this._isProjectionDirty=!1,this._lastAspectSize.x=o.width,this._lastAspectSize.y=o.height;var s=this.aspectRatio;if(!e.isOrthographic)$.perspective(G.degreeToRadian(this._fieldOfView),s,this._nearClipPlane,this._farClipPlane,r);else{var l=this._orthographicSize*s,u=this._orthographicSize;$.ortho(-l,l,-u,u,this._nearClipPlane,this._farClipPlane,r)}return r},set:function(e){this._virtualCamera.projectionMatrix.copyFrom(e),this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){if(this._renderTarget!==e){var r,o;(r=e)==null||r._addReferCount(1),(o=this._renderTarget)==null||o._addReferCount(-1),this._renderTarget=e,this._updatePixelViewport()}}}]),i}(rn),function(){Di._cameraDepthTextureProperty=U.getByName("camera_DepthTexture")}(),function(){Di._inverseViewMatrixProperty=U.getByName("camera_ViewInvMat")}(),function(){Di._cameraPositionProperty=U.getByName("camera_Position")}(),function(){Di._cameraForwardProperty=U.getByName("camera_Forward")}(),function(){Di._cameraUpProperty=U.getByName("camera_Up")}(),function(){Di._cameraDepthBufferParamsProperty=U.getByName("camera_DepthBufferParams")}(),Di);P([K],et.prototype,"_frustum",void 0);P([z],et.prototype,"_renderPipeline",void 0);P([z],et.prototype,"_virtualCamera",void 0);P([z],et.prototype,"_frustumViewChangeFlag",void 0);P([z],et.prototype,"_transform",void 0);P([z],et.prototype,"_isViewMatrixDirty",void 0);P([z],et.prototype,"_isInvViewProjDirty",void 0);P([K],et.prototype,"_viewport",void 0);P([K],et.prototype,"_pixelViewport",void 0);P([K],et.prototype,"_inverseProjectionMatrix",void 0);P([K],et.prototype,"_lastAspectSize",void 0);P([K],et.prototype,"_invViewProjMat",void 0);et=P([ll(ye,za.CheckOnly)],et);var kS={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"},GS=1,HS=1/0,WS=500;function Nr(n,i){return i===void 0&&(i={}),new Oe(function(a,t,e){var r,o=(r=i.retryCount)!=null?r:GS,s,l=(s=i.retryInterval)!=null?s:WS,u;i.timeout=(u=i.timeout)!=null?u:HS;var c;i.type=(c=i.type)!=null?c:jS(n);var d=i.type==="image"?QS:XS,_=new YS(function(){return d(n,i).onProgress(e)},o,l);_.start().onError(t).onComplete(a)})}function QS(n,i){return new Oe(function(a,t){var e=i.timeout,r=new Image,o=function(){t(new Error("request "+n+" fail"))};r.onerror=o,r.onabort=o;var s=-1;e!=1/0&&(s=window.setTimeout(function(){t(new Error("request "+n+" timeout"))},e)),r.onload=function(l){return function(){requestAnimationFrame(function(){a(r),r.onload=null,r.onerror=null,r.onabort=null}),clearTimeout(l)}}(s),r.crossOrigin="anonymous",r.src=n})}function XS(n,i){return new Oe(function(a,t,e){var r=new XMLHttpRequest;r.timeout=i.timeout;var o;i.method=(o=i.method)!=null?o:"get",r.onload=function(){if(r.status<200||r.status>=300){t(new Error("request failed from: "+n));return}var l,u=(l=r.response)!=null?l:r.responseText;a(u)},r.onerror=function(){t(new Error("request failed from: "+n))},r.ontimeout=function(){t(new Error("request timeout from: "+n))},r.onprogress=function(l){e(l.loaded/l.total)},r.open(i.method,n,!0),r.withCredentials=i.credentials==="include",r.responseType=i.type;var s=i.headers;s&&Object.keys(s).forEach(function(l){r.setRequestHeader(l,s[l])}),r.send(i.body)})}function jS(n){var i=n.substring(n.lastIndexOf(".")+1);return kS[i]}var YS=function(){function n(a,t,e){this.execFunc=a,this.totalCount=t,this.interval=e,this._timeoutId=-100,this._currentCount=0,this.exec=this.exec.bind(this)}var i=n.prototype;return i.start=function(){return this.exec(),this},i.onComplete=function(t){return this._onComplete=t,this},i.onError=function(t){return this._onError=t,this},i.cancel=function(){window.clearTimeout(this._timeoutId)},i.exec=function(){var t=this;if(this._currentCount>=this.totalCount){this._onError&&this._onError(this._error);return}this._currentCount++,this.execFunc(this._currentCount).then(function(e){return t._onComplete&&t._onComplete(e)}).catch(function(e){t._error=e,t._timeoutId=window.setTimeout(t.exec,t.interval)})},n}(),ke=function(){function n(i){this.useCache=i,this.request=Nr}return n.registerClass=function(a,t){this._engineObjects[a]=t},n.getClass=function(a){return this._engineObjects[a]},n}();(function(){ke._engineObjects={}})();var Ma;(function(n){n[n.Normal=0]="Normal",n[n.Additive=1]="Additive"})(Ma||(Ma={}));var hi;(function(n){n[n.Front=0]="Front",n[n.Back=1]="Back",n[n.Double=2]="Double"})(hi||(hi={}));var $e=function(n){W(i,n);function i(t,e){var r;return r=n.call(this,t,e)||this,r._renderFace=hi.Front,r._isTransparent=!1,r._blendMode=Ma.Normal,r.shaderData.setFloat(i._alphaCutoffProp,0),r}var a=i.prototype;return a.setIsTransparent=function(e,r){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";var s=o[e];r?(s.blendState.targetBlendState.enabled=!0,s.depthState.writeEnabled=!1,s.renderQueueType=bt.Transparent,this.shaderData.enableMacro(i._transparentMacro)):(s.blendState.targetBlendState.enabled=!1,s.depthState.writeEnabled=!0,s.renderQueueType=this.shaderData.getFloat(i._alphaCutoffProp)?bt.AlphaTest:bt.Opaque,this.shaderData.disableMacro(i._transparentMacro))},a.setBlendMode=function(e,r){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";var s=o[e].blendState,l=s.targetBlendState;switch(r){case Ma.Normal:l.sourceColorBlendFactor=we.SourceAlpha,l.destinationColorBlendFactor=we.OneMinusSourceAlpha,l.sourceAlphaBlendFactor=we.One,l.destinationAlphaBlendFactor=we.OneMinusSourceAlpha,l.colorBlendOperation=l.alphaBlendOperation=dn.Add;break;case Ma.Additive:l.sourceColorBlendFactor=we.SourceAlpha,l.destinationColorBlendFactor=we.One,l.sourceAlphaBlendFactor=we.One,l.destinationAlphaBlendFactor=we.OneMinusSourceAlpha,l.colorBlendOperation=l.alphaBlendOperation=dn.Add;break}},a.setRenderFace=function(e,r){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";switch(r){case hi.Front:o[e].rasterState.cullMode=Mn.Back;break;case hi.Back:o[e].rasterState.cullMode=Mn.Front;break;case hi.Double:o[e].rasterState.cullMode=Mn.Off;break}},a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){n.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},q(i,[{key:"shader",get:function(){return this._shader},set:function(e){this._shader=e;for(var r=this._renderStates,o=r.length,s=0,l=e.subShaders,u=0;u<l.length;u++)s=Math.max(l[u].passes.length,s);if(o<s)for(var c=o;c<s;c++)r.push(new Kr),this.setBlendMode(c,Ma.Normal);else r.length=s}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){e!==this._isTransparent&&(this.setIsTransparent(0,e),this._isTransparent=e)}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){e!==this._blendMode&&(this.setBlendMode(0,e),this._blendMode=e)}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(i._alphaCutoffProp)},set:function(e){var r=this.shaderData;if(r.getFloat(i._alphaCutoffProp)!==e){e?r.enableMacro(i._alphaCutoffMacro):r.disableMacro(i._alphaCutoffMacro);for(var o=this.renderStates,s=0,l=o.length;s<l;s++){var u=o[s];e>0?u.renderQueueType=u.blendState.targetBlendState.enabled?bt.Transparent:bt.AlphaTest:u.renderQueueType=u.blendState.targetBlendState.enabled?bt.Transparent:bt.Opaque}r.setFloat(i._alphaCutoffProp,e)}}},{key:"renderFace",get:function(){return this._renderFace},set:function(e){e!==this._renderFace&&(this.setRenderFace(0,e),this._renderFace=e)}}]),i}(Lr);(function(){$e._baseTextureMacro=oe.getByName("MATERIAL_HAS_BASETEXTURE")})();(function(){$e._normalTextureMacro=oe.getByName("MATERIAL_HAS_NORMALTEXTURE")})();(function(){$e._emissiveTextureMacro=oe.getByName("MATERIAL_HAS_EMISSIVETEXTURE")})();(function(){$e._transparentMacro=oe.getByName("MATERIAL_IS_TRANSPARENT")})();(function(){$e._baseColorProp=U.getByName("material_BaseColor")})();(function(){$e._baseTextureProp=U.getByName("material_BaseTexture")})();(function(){$e._tilingOffsetProp=U.getByName("material_TilingOffset")})();(function(){$e._normalTextureProp=U.getByName("material_NormalTexture")})();(function(){$e._normalIntensityProp=U.getByName("material_NormalIntensity")})();(function(){$e._emissiveColorProp=U.getByName("material_EmissiveColor")})();(function(){$e._emissiveTextureProp=U.getByName("material_EmissiveTexture")})();(function(){$e._alphaCutoffProp=U.getByName("material_AlphaCutoff")})();(function(){$e._alphaCutoffMacro=oe.getByName("MATERIAL_IS_ALPHA_CUTOFF")})();var cl=function(n){W(i,n);function i(t){var e;e=n.call(this,t,be.find("blinn-phong"))||this;var r=e.shaderData;return r.enableMacro("MATERIAL_NEED_WORLD_POS"),r.enableMacro("MATERIAL_NEED_TILING_OFFSET"),r.setColor(i._baseColorProp,new J(1,1,1,1)),r.setColor(i._specularColorProp,new J(1,1,1,1)),r.setColor(i._emissiveColorProp,new J(0,0,0,1)),r.setVector4(i._tilingOffsetProp,new ue(1,1,0,0)),r.setFloat(i._shininessProp,16),r.setFloat(i._normalIntensityProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var r=this.shaderData.getColor(i._baseColorProp);e!==r&&r.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var r=this.shaderData.getColor(i._specularColorProp);e!==r&&r.copyFrom(e)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(i._specularTextureProp)},set:function(e){this.shaderData.setTexture(i._specularTextureProp,e),e?this.shaderData.enableMacro("MATERIAL_HAS_SPECULAR_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(e){var r=this.shaderData.getColor(i._emissiveColorProp);e!==r&&r.copyFrom(e)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(i._emissiveTextureProp,e),e?this.shaderData.enableMacro(i._emissiveTextureMacro):this.shaderData.disableMacro(i._emissiveTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(e){this.shaderData.setTexture(i._normalTextureProp,e),e?this.shaderData.enableMacro(i._normalTextureMacro):this.shaderData.disableMacro(i._normalTextureMacro)}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(e){this.shaderData.setFloat(i._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(i._shininessProp)},set:function(e){this.shaderData.setFloat(i._shininessProp,Math.max(e,1e-4))}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var r=this.shaderData.getVector4(i._tilingOffsetProp);e!==r&&r.copyFrom(e)}}]),i}($e);(function(){cl._specularColorProp=U.getByName("material_SpecularColor")})();(function(){cl._shininessProp=U.getByName("material_Shininess")})();(function(){cl._specularTextureProp=U.getByName("material_SpecularTexture")})();var $i;(function(n){n[n.UV0=0]="UV0",n[n.UV1=1]="UV1",n[n.UV2=2]="UV2",n[n.UV3=3]="UV3",n[n.UV4=4]="UV4",n[n.UV5=5]="UV5",n[n.UV6=6]="UV6",n[n.UV7=7]="UV7"})($i||($i={}));var zr=function(n){W(i,n);function i(a,t){var e;e=n.call(this,a,t)||this;var r=e.shaderData;return r.enableMacro("MATERIAL_NEED_WORLD_POS"),r.enableMacro("MATERIAL_NEED_TILING_OFFSET"),r.setColor(i._baseColorProp,new J(1,1,1,1)),r.setColor(i._emissiveColorProp,new J(0,0,0,1)),r.setVector4(i._tilingOffsetProp,new ue(1,1,0,0)),r.setFloat(i._normalIntensityProp,1),r.setFloat(i._occlusionTextureIntensityProp,1),r.setFloat(i._occlusionTextureCoordProp,$i.UV0),r.setFloat(i._clearCoatProp,0),r.setFloat(i._clearCoatRoughnessProp,0),e}return q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(t){var e=this.shaderData.getColor(i._baseColorProp);t!==e&&e.copyFrom(t)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(t){this.shaderData.setTexture(i._baseTextureProp,t),t?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(t){this.shaderData.setTexture(i._normalTextureProp,t),t?this.shaderData.enableMacro(i._normalTextureMacro):this.shaderData.disableMacro(i._normalTextureMacro)}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(t){this.shaderData.setFloat(i._normalIntensityProp,t)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(t){var e=this.shaderData.getColor(i._emissiveColorProp);t!==e&&e.copyFrom(t)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(t){this.shaderData.setTexture(i._emissiveTextureProp,t),t?this.shaderData.enableMacro(i._emissiveTextureMacro):this.shaderData.disableMacro(i._emissiveTextureMacro)}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(i._occlusionTextureProp)},set:function(t){this.shaderData.setTexture(i._occlusionTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_OCCLUSION_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_OCCLUSION_TEXTURE")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(i._occlusionTextureIntensityProp)},set:function(t){this.shaderData.setFloat(i._occlusionTextureIntensityProp,t)}},{key:"occlusionTextureCoord",get:function(){return this.shaderData.getFloat(i._occlusionTextureCoordProp)},set:function(t){t>$i.UV1&&ve.warn("Occlusion texture uv coordinate must be UV0 or UV1."),this.shaderData.setFloat(i._occlusionTextureCoordProp,t)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(t){var e=this.shaderData.getVector4(i._tilingOffsetProp);t!==e&&e.copyFrom(t)}},{key:"clearCoat",get:function(){return this.shaderData.getFloat(i._clearCoatProp)},set:function(t){!!this.shaderData.getFloat(i._clearCoatProp)!=!!t&&(t===0?this.shaderData.disableMacro("MATERIAL_ENABLE_CLEAR_COAT"):this.shaderData.enableMacro("MATERIAL_ENABLE_CLEAR_COAT")),this.shaderData.setFloat(i._clearCoatProp,t)}},{key:"clearCoatTexture",get:function(){return this.shaderData.getTexture(i._clearCoatTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_CLEAR_COAT_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_CLEAR_COAT_TEXTURE")}},{key:"clearCoatRoughness",get:function(){return this.shaderData.getFloat(i._clearCoatRoughnessProp)},set:function(t){this.shaderData.setFloat(i._clearCoatRoughnessProp,t)}},{key:"clearCoatRoughnessTexture",get:function(){return this.shaderData.getTexture(i._clearCoatRoughnessTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatRoughnessTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE")}},{key:"clearCoatNormalTexture",get:function(){return this.shaderData.getTexture(i._clearCoatNormalTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatNormalTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE")}}]),i}($e);(function(){zr._occlusionTextureIntensityProp=U.getByName("material_OcclusionIntensity")})();(function(){zr._occlusionTextureCoordProp=U.getByName("material_OcclusionTextureCoord")})();(function(){zr._occlusionTextureProp=U.getByName("material_OcclusionTexture")})();(function(){zr._clearCoatProp=U.getByName("material_ClearCoat")})();(function(){zr._clearCoatTextureProp=U.getByName("material_ClearCoatTexture")})();(function(){zr._clearCoatRoughnessProp=U.getByName("material_ClearCoatRoughness")})();(function(){zr._clearCoatRoughnessTextureProp=U.getByName("material_ClearCoatRoughnessTexture")})();(function(){zr._clearCoatNormalTextureProp=U.getByName("material_ClearCoatNormalTexture")})();var ea=function(n){W(i,n);function i(t){var e;return e=n.call(this,t,be.find("pbr"))||this,e.shaderData.setFloat(i._metallicProp,1),e.shaderData.setFloat(i._roughnessProp,1),e.shaderData.setFloat(i._iorProp,1.5),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"ior",get:function(){return this.shaderData.getFloat(i._iorProp)},set:function(e){this.shaderData.setFloat(i._iorProp,Math.max(e,0))}},{key:"metallic",get:function(){return this.shaderData.getFloat(i._metallicProp)},set:function(e){this.shaderData.setFloat(i._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(i._roughnessProp)},set:function(e){this.shaderData.setFloat(i._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(i._roughnessMetallicTextureProp)},set:function(e){this.shaderData.setTexture(i._roughnessMetallicTextureProp,e),e?this.shaderData.enableMacro("MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE")}}]),i}(zr);(function(){ea._metallicProp=U.getByName("material_Metal")})();(function(){ea._roughnessProp=U.getByName("material_Roughness")})();(function(){ea._roughnessMetallicTextureProp=U.getByName("material_RoughnessMetallicTexture")})();(function(){ea._iorProp=be.getPropertyByName("material_IOR")})();var Ya=function(n){W(i,n);function i(t){var e;return e=n.call(this,t,be.find("pbr-specular"))||this,e.shaderData.setColor(i._specularColorProp,new J(1,1,1,1)),e.shaderData.setFloat(i._glossinessProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var r=this.shaderData.getColor(i._specularColorProp);e!==r&&r.copyFrom(e)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(i._glossinessProp)},set:function(e){this.shaderData.setFloat(i._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(i._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(i._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro(i._specularGlossinessTextureMacro):this.shaderData.disableMacro(i._specularGlossinessTextureMacro)}}]),i}(zr);(function(){Ya._specularColorProp=U.getByName("material_PBRSpecularColor")})();(function(){Ya._glossinessProp=U.getByName("material_Glossiness")})();(function(){Ya._specularGlossinessTextureProp=U.getByName("material_SpecularGlossinessTexture")})();(function(){Ya._specularGlossinessTextureMacro=oe.getByName("MATERIAL_HAS_SPECULAR_GLOSSINESS_TEXTURE")})();var Gu=function(n){W(i,n);function i(t){var e;e=n.call(this,t,be.find("unlit"))||this;var r=e.shaderData;return r.enableMacro("MATERIAL_OMIT_NORMAL"),r.enableMacro("MATERIAL_NEED_TILING_OFFSET"),r.setColor(i._baseColorProp,new J(1,1,1,1)),r.setVector4(i._tilingOffsetProp,new ue(1,1,0,0)),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var r=this.shaderData.getColor(i._baseColorProp);e!==r&&r.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var r=this.shaderData.getVector4(i._tilingOffsetProp);e!==r&&r.copyFrom(e)}}]),i}($e),qS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){for(var e=t.component,r=t.property.split("."),o=r.length-1,s=0;s<o;s++)e=e[r[s]];this._mounted=e,this._propertyName=r[o]},i.getTargetValue=function(){return this._mounted[this._propertyName]},i.setTargetValue=function(t){this._mounted[this._propertyName]=t},n}(),Yo=function(){function n(a,t,e,r,o){this.baseEvaluateData={curKeyframeIndex:0,value:null},this.crossEvaluateData={curKeyframeIndex:0,value:null},this.updateMark=0,this.target=a,this.property=r,this.component=e,this.cureType=o,this._isBlendShape=gt(this.component,Lt);var s=n.getAssemblerType(t,r);this._assembler=new s,this._assembler.initialize(this),o._isCopyMode&&(this.referenceTargetValue=this._assembler.getTargetValue())}var i=n.prototype;return i.evaluateValue=function(t,e,r){return r?t._evaluateAdditive(e,this.baseEvaluateData):t._evaluate(e,this.baseEvaluateData)},i.evaluateCrossFadeValue=function(t,e,r,o,s,l){if(!this.cureType._supportInterpolationMode)return this.evaluateValue(e,o,!1);var u=t&&t.keys.length?l?t._evaluateAdditive(r,this.baseEvaluateData):t._evaluate(r,this.baseEvaluateData):l?this.cureType._getZeroValue(this.baseEvaluateData.value):this.defaultValue,c=e&&e.keys.length?l?e._evaluateAdditive(o,this.crossEvaluateData):e._evaluate(o,this.crossEvaluateData):l?this.cureType._getZeroValue(this.crossEvaluateData.value):this.defaultValue;return this._lerpValue(u,c,s)},i.crossFadeFromPoseAndApplyValue=function(t,e,r,o){if(!this.cureType._supportInterpolationMode)return this.evaluateValue(t,e,!1);var s=o?this.cureType._subtractValue(this.fixedPoseValue,this.defaultValue,this.baseEvaluateData.value):this.fixedPoseValue,l=t&&t.keys.length?o?t._evaluateAdditive(e,this.crossEvaluateData):t._evaluate(e,this.crossEvaluateData):o?this.cureType._getZeroValue(this.crossEvaluateData.value):this.defaultValue;return this._lerpValue(s,l,r)},i.revertDefaultValue=function(){this._assembler.setTargetValue(this.defaultValue)},i.getEvaluateValue=function(t){return this.cureType._isCopyMode?(this.cureType._setValue(this.baseEvaluateData.value,t),t):this.baseEvaluateData.value},i.saveDefaultValue=function(){this.cureType._isCopyMode?this.cureType._setValue(this.referenceTargetValue,this.defaultValue):this.defaultValue=this._assembler.getTargetValue()},i.saveFixedPoseValue=function(){this.cureType._isCopyMode?this.cureType._setValue(this.referenceTargetValue,this.fixedPoseValue):this.fixedPoseValue=this._assembler.getTargetValue()},i.applyValue=function(t,e,r){var o=this.cureType;if(r){var s=this._assembler;if(o._isCopyMode){var l=o._additiveValue(t,e,this.referenceTargetValue);this._isBlendShape&&s.setTargetValue(l)}else{var u=s.getTargetValue(),c=o._additiveValue(t,e,u);s.setTargetValue(c)}}else if(e===1)o._isCopyMode?(o._setValue(t,this.referenceTargetValue),this._isBlendShape&&this._assembler.setTargetValue(this.referenceTargetValue)):this._assembler.setTargetValue(t);else if(o._isCopyMode){var d=this.referenceTargetValue;o._lerpValue(d,t,e,d),this._isBlendShape&&this._assembler.setTargetValue(d)}else{var _=this._assembler.getTargetValue(),f=o._lerpValue(_,t,e);this._assembler.setTargetValue(f)}},i._lerpValue=function(t,e,r){return this.cureType._isCopyMode?this.cureType._lerpValue(t,e,r,this.baseEvaluateData.value):(this.baseEvaluateData.value=this.cureType._lerpValue(t,e,r),this.baseEvaluateData.value)},n.registerAssembler=function(t,e,r){var o=n._assemblerMap.get(t);o||(o={},n._assemblerMap.set(t,o)),o[e]=r},n.getAssemblerType=function(t,e){var r=n._assemblerMap.get(t),o=r?r[e]:void 0;return o??qS},n}();(function(){Yo._assemblerMap=new Map})();var JS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.position},i.setTargetValue=function(t){this._transform.position=t},n}();Yo.registerAssembler(ye,"position",JS);var ZS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.rotationQuaternion},i.setTargetValue=function(t){this._transform.rotationQuaternion=t},n}();Yo.registerAssembler(ye,"rotationQuaternion",ZS);var KS=function(){function n(){}var i=n.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.scale},i.setTargetValue=function(t){this._transform.scale=t},n}();Yo.registerAssembler(ye,"scale",KS);var $S=function(){function n(){this._skinnedMeshRenderer=[]}var i=n.prototype;return i.initialize=function(t){t.target.getComponents(Lt,this._skinnedMeshRenderer)},i.getTargetValue=function(){return this._skinnedMeshRenderer[0].blendShapeWeights},i.setTargetValue=function(t){for(var e=this._skinnedMeshRenderer,r=0,o=e.length;r<o;r++)e[r].blendShapeWeights=t},n}();Yo.registerAssembler(Lt,"blendShapeWeights",$S);var eC=function(){function n(){this.crossCurveMark=0}var i=n.prototype;return i.initFinalValue=function(){var t=this.curveOwner,e=t.cureType,r=t.defaultValue;e._isCopyMode?e._setValue(r,this.finalValue):this.finalValue=r},i.saveFinalValue=function(){this.finalValue=this.curveOwner.getEvaluateValue(this.finalValue)},n}(),mm=function(){function n(){this._tempCurveOwner={}}var i=n.prototype;return i._createCurveOwner=function(t,e){var r=this.curve.constructor,o=new Yo(t,this.type,e,this.property,r);return r._initializeOwner(o),o.saveDefaultValue(),o},i._createCurveLayerOwner=function(t){var e=this.curve.constructor,r=new eC;return r.curveOwner=t,e._initializeLayerOwner(r),r.initFinalValue(),r},i._getTempCurveOwner=function(t,e){var r=t.instanceId;return this._tempCurveOwner[r]||(this._tempCurveOwner[r]=this._createCurveOwner(t,e)),this._tempCurveOwner[r]},n}(),Tc=function(){},Vf=function(n){W(i,n);function i(t){var e;return e=n.call(this,null)||this,e.name=t,e._curveBindings=[],e._length=0,e._events=[],e}var a=i.prototype;return a.addEvent=function(e,r,o){var s;if(typeof e=="string"){var l=new Tc;l.functionName=e,l.time=r,l.parameter=o,s=l}else s=e;var u=this._events,c=u.length,d=s.time,_=c?u[c-1].time:0;if(d>=_)u.push(s);else{for(var f=c;--f>=0&&d<u[f].time;);u.splice(f+1,0,s)}},a.clearEvents=function(){this._events.length=0},a.addCurveBinding=function(e,r,o,s){var l=new mm;l.relativePath=e,l.type=r,l.property=o,l.curve=s,s.length>this._length&&(this._length=s.length),this._curveBindings.push(l)},a.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},a._sampleAnimation=function(e,r){for(var o=this,s=o._curveBindings,l=s.length-1;l>=0;l--){var u=s[l],c=e.findByPath(u.relativePath);if(c){var d=c.getComponent(u.type);if(!d)continue;var _=u._getTempCurveOwner(c,d);if(_&&u.curve.keys.length){var f=_.evaluateValue(u.curve,r,!1);_.applyValue(f,1,!1)}}}},q(i,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),i}(ti),Gt;(function(n){n[n.Linear=0]="Linear",n[n.CubicSpine=1]="CubicSpine",n[n.Step=2]="Step",n[n.Hermite=3]="Hermite"})(Gt||(Gt={}));var pr=function(){function n(){this.keys=[],this._evaluateData={curKeyframeIndex:0,value:null},this._length=0;var a=this.constructor;this._interpolation=a._supportInterpolationMode?Gt.Linear:Gt.Step,this._type=a}var i=n.prototype;return i.addKey=function(t){var e=t.time,r=this.keys;if(e>=this._length)r.push(t),this._length=e;else{for(var o=r.length;--o>=0&&e<r[o].time;);r.splice(o+1,0,t)}},i.evaluate=function(t){return this._evaluate(t,this._evaluateData)},i.removeKey=function(t){this.keys.splice(t,1);for(var e=this.keys,r=0,o=e.length-1;o>=0;o--){var s=e[o];s.time>this._length&&(r=s.time)}this._length=r},i._evaluate=function(t,e){var r=this.keys.length;if(!r){console.warn("This curve don't have any keyframes: ",this);return}var o=this,s=o.keys,l=o.interpolation,u=e.curKeyframeIndex;u!==-1&&(u>=r||t<s[u].time)&&(u=-1);for(var c=u+1;c<r&&!(t<s[c].time);)u++,c++;e.curKeyframeIndex=u;var d;if(u===-1)d=this._type._setValue(s[0].value,e.value);else if(c===r)d=this._type._setValue(s[u].value,e.value);else{var _=s[u],f=s[c],v=_.time,p=f.time-v,g=(t-v)/p;switch(l){case Gt.Linear:d=this._type._lerpValue(_.value,f.value,g,e.value);break;case Gt.Step:d=this._type._setValue(_.value,e.value);break;case Gt.CubicSpine:case Gt.Hermite:d=this._type._hermiteInterpolationValue(_,f,g,p,e.value);break}}return e.value=d,d},i._evaluateAdditive=function(t,e){var r=this._evaluate(t,e);return this._type._subtractValue(r,this.keys[0].value,e.value)},q(n,[{key:"interpolation",get:function(){return this._interpolation},set:function(t){!this._type._supportInterpolationMode&&t!==Gt.Step?(this._interpolation=Gt.Step,console.warn("The interpolation type must be `InterpolationType.Step`.")):this._interpolation=t}},{key:"length",get:function(){return this._length}}]),n}(),Ol,Hu=(Ol=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=[],a}return i._initializeOwner=function(t){t.defaultValue=[],t.fixedPoseValue=[],t.baseEvaluateData.value=[],t.crossEvaluateData.value=[]},i._initializeLayerOwner=function(t){t.finalValue=[]},i._lerpValue=function(t,e,r,o){for(var s=0,l=o.length;s<l;++s){var u=t[s];o[s]=u+(e[s]-u)*r}return o},i._subtractValue=function(t,e,r){for(var o=0,s=t.length;o<s;o++)r[o]=t[o]-e[o];return r},i._getZeroValue=function(t){for(var e=0,r=t.length;e<r;e++)t[e]=0;return t},i._additiveValue=function(t,e,r){for(var o=0,s=r.length;o<s;++o)r[o]+=t[o]*e;return r},i._setValue=function(t,e){for(var r=0,o=e.length;r<o;++r)e[r]=t[r];return e},i._hermiteInterpolationValue=function(t,e,r,o,s){for(var l=t.outTangent,u=e.inTangent,c=t.value,d=e.value,_=r*r,f=_*r,v=2*f-3*_+1,p=f-2*_+r,g=f-_,m=-2*f+3*_,h=0,y=c.length;h<y;++h)Number.isFinite(l[h])&&Number.isFinite(u[h])?s[h]=v*c[h]+p*l[h]*o+g*u[h]*o+m*d[h]:s[h]=t.value[h];return s},i}(pr),function(){Ol._isCopyMode=!0}(),function(){Ol._supportInterpolationMode=!0}(),Ol);Hu=P([In()],Hu);var zl,p_=(zl=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=!1,a}return i._initializeOwner=function(t){t.defaultValue=!1,t.fixedPoseValue=!1,t.baseEvaluateData.value=!1,t.crossEvaluateData.value=!1},i._initializeLayerOwner=function(t){t.finalValue=!1},i._lerpValue=function(t,e){return t},i._subtractValue=function(t,e,r){return t},i._getZeroValue=function(){return!1},i._additiveValue=function(t,e,r){return t},i._setValue=function(t){return t},i._hermiteInterpolationValue=function(t){return t.value},i}(pr),function(){zl._isCopyMode=!1}(),function(){zl._supportInterpolationMode=!1}(),zl);p_=P([In()],p_);var Ul,Wu=(Ul=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new J,a}return i._initializeOwner=function(t){t.defaultValue=new J,t.fixedPoseValue=new J,t.baseEvaluateData.value=new J,t.crossEvaluateData.value=new J},i._initializeLayerOwner=function(t){t.finalValue=new J},i._lerpValue=function(t,e,r,o){return J.lerp(t,e,r,o),o},i._subtractValue=function(t,e,r){return J.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0,0,0),t},i._additiveValue=function(t,e,r){return J.scale(t,e,t),J.add(r,t,r),r},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,f=_*r,v=2*f-3*_+1,p=f-2*_+r,g=f-_,m=-2*f+3*_,h=u.x,y=d.x;return Number.isFinite(h)&&Number.isFinite(y)?s.r=v*l.r+p*h*o+g*y*o+m*c.r:s.r=l.r,h=u.y,y=d.y,Number.isFinite(h)&&Number.isFinite(y)?s.g=v*l.g+p*h*o+g*y*o+m*c.g:s.g=l.g,h=u.z,y=d.z,Number.isFinite(h)&&Number.isFinite(y)?s.b=v*l.b+p*h*o+g*y*o+m*c.b:s.b=l.b,h=u.w,y=d.w,Number.isFinite(h)&&Number.isFinite(y)?s.a=v*l.a+p*h*o+g*y*o+m*c.a:s.a=l.a,s},i}(pr),function(){Ul._isCopyMode=!0}(),function(){Ul._supportInterpolationMode=!0}(),Ul);Wu=P([In()],Wu);var kl,Zs=(kl=function(n){W(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.addKey=function(e){n.prototype.addKey.call(this,e);var r=this._evaluateData;if(!r.value||r.value.length!==e.value.length){var o=e.value.length;r.value=new Float32Array(o)}},i._initializeOwner=function(e){var r=e.referenceTargetValue.length;e.defaultValue=new Float32Array(r),e.fixedPoseValue=new Float32Array(r),e.baseEvaluateData.value=new Float32Array(r),e.crossEvaluateData.value=new Float32Array(r)},i._initializeLayerOwner=function(e){var r=e.curveOwner.referenceTargetValue.length;e.finalValue=new Float32Array(r)},i._lerpValue=function(e,r,o,s){for(var l=0,u=s.length;l<u;++l){var c=e[l];s[l]=c+(r[l]-c)*o}return s},i._subtractValue=function(e,r,o){for(var s=0,l=e.length;s<l;s++)o[s]=e[s]-r[s];return o},i._getZeroValue=function(e){for(var r=0,o=e.length;r<o;r++)e[r]=0;return e},i._additiveValue=function(e,r,o){for(var s=0,l=o.length;s<l;++s)o[s]+=e[s]*r;return o},i._setValue=function(e,r){for(var o=0,s=r.length;o<s;++o)r[o]=e[o];return r},i._hermiteInterpolationValue=function(e,r,o,s,l){for(var u=e.outTangent,c=r.inTangent,d=e.value,_=r.value,f=o*o,v=f*o,p=2*v-3*f+1,g=v-2*f+o,m=v-f,h=-2*v+3*f,y=0,A=d.length;y<A;++y)Number.isFinite(u[y])&&Number.isFinite(c[y])?l[y]=p*d[y]+g*u[y]*s+m*c[y]*s+h*_[y]:l[y]=e.value[y];return l},i}(pr),function(){kl._isCopyMode=!0}(),function(){kl._supportInterpolationMode=!0}(),kl);Zs=P([In()],Zs);var Gl,Qu=(Gl=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=0,a}return i._initializeOwner=function(t){t.defaultValue=0,t.fixedPoseValue=0,t.baseEvaluateData.value=0,t.crossEvaluateData.value=0},i._initializeLayerOwner=function(t){t.finalValue=0},i._lerpValue=function(t,e,r){return t+(e-t)*r},i._additiveValue=function(t,e,r){return r+=t*e},i._subtractValue=function(t,e){return t-e},i._getZeroValue=function(){return 0},i._setValue=function(t){return t},i._hermiteInterpolationValue=function(t,e,r,o){var s=t.outTangent,l=e.inTangent;if(Number.isFinite(s)&&Number.isFinite(l)){var u=r*r,c=u*r,d=2*c-3*u+1,_=c-2*u+r,f=c-u,v=-2*c+3*u;return d*t.value+_*s*o+f*l*o+v*e.value}else return t.value},i}(pr),function(){Gl._isCopyMode=!1}(),function(){Gl._supportInterpolationMode=!0}(),Gl);Qu=P([In()],Qu);var as,ko=(as=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new xe,a}return i._initializeOwner=function(t){t.defaultValue=new xe,t.fixedPoseValue=new xe,t.baseEvaluateData.value=new xe,t.crossEvaluateData.value=new xe},i._initializeLayerOwner=function(t){t.finalValue=new xe},i._lerpValue=function(t,e,r,o){return xe.slerp(t,e,r,o),o},i._additiveValue=function(t,e,r){return t.x=t.x*e,t.y=t.y*e,t.z=t.z*e,t.normalize(),r.multiply(t),r},i._subtractValue=function(t,e,r){var o=ko._tempConjugateQuat;return xe.conjugate(e,o),xe.multiply(o,t,r),r},i._getZeroValue=function(t){return t.set(0,0,0,1),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,f=_*r,v=2*f-3*_+1,p=f-2*_+r,g=f-_,m=-2*f+3*_,h=u.x,y=d.x;return Number.isFinite(h)&&Number.isFinite(y)?s.x=v*l.x+p*h*o+g*y*o+m*c.x:s.x=l.x,h=u.y,y=d.y,Number.isFinite(h)&&Number.isFinite(y)?s.y=v*l.y+p*h*o+g*y*o+m*c.y:s.y=l.y,h=u.z,y=d.z,Number.isFinite(h)&&Number.isFinite(y)?s.z=v*l.z+p*h*o+g*y*o+m*c.z:s.z=l.z,h=u.w,y=d.w,Number.isFinite(h)&&Number.isFinite(y)?s.w=v*l.w+p*h*o+g*y*o+m*c.w:s.w=l.w,s},i}(pr),function(){as._supportInterpolationMode=!0}(),function(){as._isCopyMode=!0}(),function(){as._tempConjugateQuat=new xe}(),as);ko=P([In()],ko);var Hl,Xu=(Hl=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new te,a}return i._initializeOwner=function(t){t.defaultValue=new te,t.fixedPoseValue=new te,t.baseEvaluateData.value=new te,t.crossEvaluateData.value=new te},i._initializeLayerOwner=function(t){t.finalValue=new te},i._lerpValue=function(t,e,r,o){return te.lerp(t,e,r,o),o},i._additiveValue=function(t,e,r){return te.scale(t,e,t),te.add(r,t,r),r},i._subtractValue=function(t,e,r){return te.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,f=_*r,v=2*f-3*_+1,p=f-2*_+r,g=f-_,m=-2*f+3*_,h=u.x,y=d.x;return Number.isFinite(h)&&Number.isFinite(y)?s.x=v*l.x+p*h*o+g*y*o+m*c.x:s.x=l.x,h=u.y,y=d.y,Number.isFinite(h)&&Number.isFinite(y)?s.y=v*l.y+p*h*o+g*y*o+m*c.y:s.y=l.y,s},i}(pr),function(){Hl._isCopyMode=!0}(),function(){Hl._supportInterpolationMode=!0}(),Hl);Xu=P([In()],Xu);var Wl,Ks=(Wl=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new M,a}return i._initializeOwner=function(t){t.defaultValue=new M,t.fixedPoseValue=new M,t.baseEvaluateData.value=new M,t.crossEvaluateData.value=new M},i._initializeLayerOwner=function(t){t.finalValue=new M},i._lerpValue=function(t,e,r,o){return M.lerp(t,e,r,o),o},i._relativeBaseValue=function(t,e){return M.subtract(e,t,e),e},i._additiveValue=function(t,e,r){return M.scale(t,e,t),M.add(r,t,r),r},i._subtractValue=function(t,e,r){return M.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0,0),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,f=_*r,v=2*f-3*_+1,p=f-2*_+r,g=f-_,m=-2*f+3*_,h=u.x,y=d.x;return Number.isFinite(h)&&Number.isFinite(y)?s.x=v*l.x+p*h*o+g*y*o+m*c.x:s.x=l.x,h=u.y,y=d.y,Number.isFinite(h)&&Number.isFinite(y)?s.y=v*l.y+p*h*o+g*y*o+m*c.y:s.y=l.y,h=u.z,y=d.z,Number.isFinite(h)&&Number.isFinite(y)?s.z=v*l.z+p*h*o+g*y*o+m*c.z:s.z=l.z,s},i}(pr),function(){Wl._isCopyMode=!0}(),function(){Wl._supportInterpolationMode=!0}(),Wl);Ks=P([In()],Ks);var Ql,ju=(Ql=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new ue,a}return i._initializeOwner=function(t){t.defaultValue=new ue,t.fixedPoseValue=new ue,t.baseEvaluateData.value=new ue,t.crossEvaluateData.value=new ue},i._initializeLayerOwner=function(t){t.finalValue=new ue},i._lerpValue=function(t,e,r,o){return ue.lerp(t,e,r,o),o},i._additiveValue=function(t,e,r){return ue.scale(t,e,t),ue.add(r,t,r),r},i._subtractValue=function(t,e,r){return ue.subtract(t,e,r),r},i._getZeroValue=function(t){return t.set(0,0,0,0),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,r,o,s){var l=t.value,u=t.outTangent,c=e.value,d=e.inTangent,_=r*r,f=_*r,v=2*f-3*_+1,p=f-2*_+r,g=f-_,m=-2*f+3*_,h=u.x,y=d.x;return Number.isFinite(h)&&Number.isFinite(y)?s.x=v*l.x+p*h*o+g*y*o+m*c.x:s.x=l.x,h=u.y,y=d.y,Number.isFinite(h)&&Number.isFinite(y)?s.y=v*l.y+p*h*o+g*y*o+m*c.y:s.y=l.y,h=u.z,y=d.z,Number.isFinite(h)&&Number.isFinite(y)?s.z=v*l.z+p*h*o+g*y*o+m*c.z:s.z=l.z,h=u.w,y=d.w,Number.isFinite(h)&&Number.isFinite(y)?s.w=v*l.w+p*h*o+g*y*o+m*c.w:s.w=l.w,s},i}(pr),function(){Ql._isCopyMode=!0}(),function(){Ql._supportInterpolationMode=!0}(),Ql);ju=P([In()],ju);var Xl,Yu=(Xl=function(n){W(i,n);function i(){return n.call(this)}return i._initializeOwner=function(t){},i._initializeLayerOwner=function(t){},i._setValue=function(t){return t},i}(pr),function(){Xl._isCopyMode=!1}(),function(){Xl._supportInterpolationMode=!1}(),Xl);Yu=P([In()],Yu);var jl,g_=(jl=function(n){W(i,n);function i(){var a;return a=n.call(this)||this,a._evaluateData.value=new Rr,a}return i._initializeOwner=function(t){t.defaultValue=new Rr,t.fixedPoseValue=new Rr,t.baseEvaluateData.value=new Rr,t.crossEvaluateData.value=new Rr},i._initializeLayerOwner=function(t){t.finalValue=new Rr},i._setValue=function(t,e){return e.copyFrom(t),e},i}(pr),function(){jl._isCopyMode=!0}(),function(){jl._supportInterpolationMode=!1}(),jl);g_=P([In()],g_);var $s;(function(n){n[n.None=0]="None",n[n.Complete=1]="Complete"})($s||($s={}));var el;(function(n){n[n.Override=0]="Override",n[n.Additive=1]="Additive"})(el||(el={}));var It;(function(n){n[n.UnStarted=0]="UnStarted",n[n.Playing=1]="Playing",n[n.Finished=2]="Finished"})(It||(It={}));var ot;(function(n){n[n.Standby=0]="Standby",n[n.Playing=1]="Playing",n[n.CrossFading=2]="CrossFading",n[n.FixedCrossFading=3]="FixedCrossFading",n[n.Finished=4]="Finished"})(ot||(ot={}));var tC=function(){function n(){this.handlers=[]}var i=n.prototype;return i.dispose=function(){},n}(),Nf=function(){this.duration=0,this.offset=0,this.exitTime=1},tl;(function(n){n[n.Once=0]="Once",n[n.Loop=1]="Loop"})(tl||(tl={}));var Sv=function(){function n(){}var i=n.prototype;return i.reset=function(t,e,r){this.state=t,this.frameTime=r,this.stateData=e,this.playState=It.UnStarted,this.clipTime=t.clipStartTime*t.clip.length,this.currentEventIndex=0,this.currentTransitionIndex=0},i.update=function(t){var e=this.state,r=this.frameTime,o=e._getDuration();this.playState=It.Playing,e.wrapMode===tl.Loop?r=o?r%o:0:Math.abs(r)>o&&(r=r<0?-o:o,this.playState=It.Finished),t&&r===0?this.clipTime=e.clipEndTime*e.clip.length:(r<0&&(r+=o),this.clipTime=r+e.clipStartTime*e.clip.length)},n}(),nC=function(){function n(){this.curveOwnerPool=Object.create(null),this.animatorStateDataMap={},this.srcPlayData=new Sv,this.destPlayData=new Sv,this.layerState=ot.Standby,this.crossCurveMark=0,this.manuallyTransition=new Nf,this.crossLayerOwnerCollection=[]}var i=n.prototype;return i.switchPlayData=function(){var t=this.destPlayData,e=this.srcPlayData;this.srcPlayData=t,this.destPlayData=e},n}(),rC=function(){this.curveLayerOwner=[],this.eventHandlers=[]},Ur=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e.cullingMode=$s.None,e.speed=1,e._playFrameCount=-1,e._onUpdateIndex=-1,e._updateMark=0,e._animatorLayersData=[],e._curveOwnerPool=Object.create(null),e._animationEventHandlerPool=new Aa(tC),e._tempAnimatorStateInfo={layerIndex:-1,state:null},e._controlledRenderers=[],e}var a=i.prototype;return a.play=function(e,r,o){r===void 0&&(r=-1),o===void 0&&(o=0);var s;(s=this._controllerUpdateFlag)!=null&&s.flag&&this._reset(),this._playFrameCount=this.engine.time.frameCount;var l=this._getAnimatorStateInfo(e,r),u=l.state,c=l.layerIndex;if(u){if(!u.clip){ve.warn("The state named "+e+" has no AnimationClip data.");return}var d=this._getAnimatorLayerData(c),_=this._getAnimatorStateData(e,u,d,c);this._preparePlay(d,u),d.layerState=ot.Playing,d.srcPlayData.reset(u,_,u._getDuration()*o),this.update(0)}},a.crossFade=function(e,r,o,s){o===void 0&&(o=-1),s===void 0&&(s=0);var l;(l=this._controllerUpdateFlag)!=null&&l.flag&&this._reset(),this._playFrameCount=this.engine.time.frameCount;var u=this._getAnimatorStateInfo(e,o),c=u.state,d=u.layerIndex,_=this._getAnimatorLayerData(d).manuallyTransition;_.duration=r,_.offset=s,_.destinationState=c,this._crossFadeByTransition(_,d)&&this.update(0)},a.update=function(e){var r,o;if(this.cullingMode===$s.Complete){o=!1;for(var s=this._controlledRenderers,l=0,u=s.length;l<u;l++)if(!s[l].isCulled){o=!0;break}}else o=!0;var c=this,d=c._animatorController;if(d){if((r=this._controllerUpdateFlag)!=null&&r.flag){this._checkAutoPlay();return}this._updateMark++;for(var _=0,f=d.layers.length;_<f;_++){var v=this._getAnimatorLayerData(_);v.layerState!==ot.Standby&&this._updateLayer(_,_===0,e,o)}}},a.getCurrentAnimatorState=function(e){var r,o;return(o=this._animatorLayersData[e])==null||(r=o.srcPlayData)==null?void 0:r.state},a.findAnimatorState=function(e,r){return r===void 0&&(r=-1),this._getAnimatorStateInfo(e,r).state},a._onEnable=function(){this.animatorController&&this._checkAutoPlay(),this._entity.getComponentsIncludeChildren(Ce,this._controlledRenderers)},a._onEnableInScene=function(){this.scene._componentsManager.addOnUpdateAnimations(this)},a._onDisableInScene=function(){this.scene._componentsManager.removeOnUpdateAnimations(this)},a._reset=function(){var e=this,r=e._curveOwnerPool;for(var o in r){var s=r[o];for(var l in s){var u=s[l];u.revertDefaultValue()}}this._animatorLayersData.length=0,this._curveOwnerPool={},this._animationEventHandlerPool.resetPool(),this._controllerUpdateFlag&&(this._controllerUpdateFlag.flag=!1)},a._getAnimatorStateInfo=function(e,r){var o=this,s=o._animatorController,l=o._tempAnimatorStateInfo,u=null;if(s){var c=s.layers;if(r===-1){for(var d=0,_=c.length;d<_;d++)if(u=c[d].stateMachine.findStateByName(e),u){r=d;break}}else u=c[r].stateMachine.findStateByName(e)}return l.layerIndex=r,l.state=u,l},a._getAnimatorStateData=function(e,r,o,s){var l=o.animatorStateDataMap,u=l[e];return u||(u=new rC,l[e]=u,this._saveAnimatorStateData(r,u,o,s),this._saveAnimatorEventHandlers(r,u)),u},a._saveAnimatorStateData=function(e,r,o,s){for(var l=this,u=l.entity,c=l._curveOwnerPool,d=r.curveLayerOwner,_=e.clip,f=_._curveBindings,v=o.curveOwnerPool,p=f.length-1;p>=0;p--){var g=f[p],m=g.relativePath===""?u:u.findByPath(g.relativePath);if(m){var h,y,A,S,x,C,E,T,w=m.getComponent(g.type);if(!w)continue;var R=g.property,b=m.instanceId,B=(h=c)[y=b]||(h[y]=Object.create(null)),I=(A=B)[S=R]||(A[S]=g._createCurveOwner(m,w)),V=(x=v)[C=b]||(x[C]=Object.create(null)),L=(E=V)[T=R]||(E[T]=g._createCurveLayerOwner(I));d[p]=L}else d[p]=null,ve.warn("The entity don't have the child entity which path is "+g.relativePath+".")}},a._saveAnimatorEventHandlers=function(e,r){var o=this._animationEventHandlerPool,s=[];this._entity.getComponents(Tt,s);var l=s.length,u=r.eventHandlers,c=e.clip.events;u.length=0;for(var d=0,_=c.length;d<_;d++){var f=c[d],v=o.getFromPool(),p=f.functionName,g=v.handlers;v.event=f,g.length=0;for(var m=l-1;m>=0;m--){var h=s[m][p];h&&g.push(h)}u.push(v)}},a._clearCrossData=function(e){e.crossCurveMark++,e.crossLayerOwnerCollection.length=0},a._addCrossOwner=function(e,r,o,s){r.crossSrcCurveIndex=o,r.crossDestCurveIndex=s,e.crossLayerOwnerCollection.push(r)},a._prepareCrossFading=function(e){this._prepareSrcCrossData(e,!1),this._prepareDestCrossData(e,!1)},a._prepareStandbyCrossFading=function(e){e.srcPlayData.state&&this._prepareSrcCrossData(e,!0),this._prepareDestCrossData(e,!0)},a._prepareFixedPoseCrossFading=function(e){for(var r=e.crossLayerOwnerCollection,o=r.length-1;o>=0;o--){var s=r[o];s&&(s.curveOwner.saveFixedPoseValue(),s.crossDestCurveIndex=-1)}this._prepareDestCrossData(e,!0)},a._prepareSrcCrossData=function(e,r){for(var o=e.srcPlayData.stateData.curveLayerOwner,s=o.length-1;s>=0;s--){var l=o[s];l&&(l.crossCurveMark=e.crossCurveMark,r&&l.curveOwner.saveFixedPoseValue(),this._addCrossOwner(e,l,s,-1))}},a._prepareDestCrossData=function(e,r){for(var o=e.destPlayData.stateData.curveLayerOwner,s=o.length-1;s>=0;s--){var l=o[s];if(l)if(l.crossCurveMark===e.crossCurveMark)l.crossDestCurveIndex=s;else{var u=l.curveOwner;r&&u.saveFixedPoseValue(),l.crossCurveMark=e.crossCurveMark,this._addCrossOwner(e,l,-1,s)}}},a._getAnimatorLayerData=function(e){var r=this._animatorLayersData[e];return r||(this._animatorLayersData[e]=r=new nC),r},a._updateLayer=function(e,r,o,s){var l=this._animatorController.layers[e],u=l.blendingMode,c=l.weight,d=this._animatorLayersData[e],_=d.srcPlayData,f=d.destPlayData,v=u===el.Additive;switch(r&&(c=1),d.layerState){case ot.Playing:this._updatePlayingState(_,d,e,c,o,v,s);break;case ot.FixedCrossFading:this._updateCrossFadeFromPose(f,d,e,c,o,v,s);break;case ot.CrossFading:this._updateCrossFade(_,f,d,e,c,o,v,s);break;case ot.Finished:this._updateFinishedState(_,c,v,s);break}},a._updatePlayingState=function(e,r,o,s,l,u,c){var d=e.stateData,_=d.curveLayerOwner,f=d.eventHandlers,v=e.state,p=e.playState,g=e.clipTime,m=v.transitions,h=v.clip,y=h._curveBindings,A=v.speed*this.speed;e.frameTime+=A*l,e.update(A<0);var S=e.clipTime,x=e.playState,C=x===It.Finished;if(c||C)for(var E=y.length-1;E>=0;E--){var T,w=_[E],R=(T=w)==null?void 0:T.curveOwner;if(R){var b=y[E].curve;if(b.keys.length){this._checkRevertOwner(R,u);var B=R.evaluateValue(b,S,u);c&&R.applyValue(B,s,u),C&&w.saveFinalValue()}}}if(x===It.Finished&&(r.layerState=ot.Finished),f.length&&this._fireAnimationEvents(e,f,g,S),p===It.UnStarted&&this._callAnimatorScriptOnEnter(v,o),x===It.Finished?this._callAnimatorScriptOnExit(v,o):this._callAnimatorScriptOnUpdate(v,o),m.length){var I=r.layerState;I!==ot.CrossFading&&I!==ot.FixedCrossFading&&this._checkTransition(e,m,o,g,S)}},a._updateCrossFade=function(e,r,o,s,l,u,c,d){var _=this.speed,f=o.crossLayerOwnerCollection,v=e.state.clip,p=v._curveBindings,g=e.state,m=e.stateData,h=e.playState,y=m.eventHandlers,A=r.state,S=r.stateData,x=r.playState,C=S.eventHandlers,E=A.clip,T=E._curveBindings,w=e.clipTime,R=r.clipTime,b=A._getDuration()*o.crossFadeTransition.duration,B=Math.abs(r.frameTime)/b;(B>=1||b===0)&&(B=1);var I=g.speed*_,V=A.speed*_;e.frameTime+=I*u,r.frameTime+=V*u,e.update(I<0),r.update(V<0);var L=e.clipTime,F=e.playState,D=r.clipTime,N=r.playState,O=r.playState===It.Finished;if(d||O)for(var k=f.length-1;k>=0;k--){var Q,H=f[k],ee=(Q=H)==null?void 0:Q.curveOwner;if(ee){var ge=H.crossSrcCurveIndex,le=H.crossDestCurveIndex;this._checkRevertOwner(ee,c);var re=ee.evaluateCrossFadeValue(ge>=0?p[ge].curve:null,le>=0?T[le].curve:null,L,D,B,c);d&&ee.applyValue(re,l,c),O&&H.saveFinalValue()}}this._updateCrossFadeData(o,B),y.length&&this._fireAnimationEvents(e,y,w,L),C.length&&this._fireAnimationEvents(r,C,R,D),h===It.UnStarted&&this._callAnimatorScriptOnEnter(g,s),B===1||F===It.Finished?this._callAnimatorScriptOnExit(g,s):this._callAnimatorScriptOnUpdate(g,s),x===It.UnStarted&&this._callAnimatorScriptOnEnter(A,s),N===It.Finished?this._callAnimatorScriptOnExit(A,s):this._callAnimatorScriptOnUpdate(A,s)},a._updateCrossFadeFromPose=function(e,r,o,s,l,u,c){var d=r.crossLayerOwnerCollection,_=e.state,f=e.stateData,v=e.playState,p=f.eventHandlers,g=_.clip,m=g._curveBindings,h=e.clipTime,y=_._getDuration()*r.crossFadeTransition.duration,A=Math.abs(e.frameTime)/y;(A>=1||y===0)&&(A=1);var S=_.speed*this.speed;e.frameTime+=S*l,e.update(S<0);var x=e.clipTime,C=e.playState,E=C===It.Finished;if(c||E)for(var T=d.length-1;T>=0;T--){var w,R=d[T],b=(w=R)==null?void 0:w.curveOwner;if(b){var B=R.crossDestCurveIndex;this._checkRevertOwner(b,u);var I=R.curveOwner.crossFadeFromPoseAndApplyValue(B>=0?m[B].curve:null,x,A,u);c&&b.applyValue(I,s,u),E&&R.saveFinalValue()}}this._updateCrossFadeData(r,A),p.length&&this._fireAnimationEvents(e,p,h,x),v===It.UnStarted&&this._callAnimatorScriptOnEnter(_,o),C===It.Finished?this._callAnimatorScriptOnExit(_,o):this._callAnimatorScriptOnUpdate(_,o)},a._updateFinishedState=function(e,r,o,s){if(s)for(var l=e.stateData.curveLayerOwner,u=e.state.clip,c=u._curveBindings,d=c.length-1;d>=0;d--){var _,f=l[d],v=(_=f)==null?void 0:_.curveOwner;v&&(this._checkRevertOwner(v,o),v.applyValue(f.finalValue,r,o))}},a._updateCrossFadeData=function(e,r){var o=e.destPlayData;r===1&&(o.playState===It.Finished?e.layerState=ot.Finished:e.layerState=ot.Playing,e.switchPlayData(),e.crossFadeTransition=null)},a._preparePlay=function(e,r){if(e.layerState===ot.Playing){var o=e.srcPlayData;if(o.state!==r)for(var s=o.stateData.curveLayerOwner,l=s.length-1;l>=0;l--){var u;(u=s[l])==null||u.curveOwner.revertDefaultValue()}}else for(var c=e.crossLayerOwnerCollection,d=c.length-1;d>=0;d--)c[d].curveOwner.revertDefaultValue()},a._checkTransition=function(e,r,o,s,l){var u=e.state,c=u.clip.length;this.speed*u.speed>=0?l<s?(this._checkSubTransition(e,r,o,s,u.clipEndTime*c),e.currentTransitionIndex=0,this._checkSubTransition(e,r,o,u.clipStartTime*c,l)):this._checkSubTransition(e,r,o,s,l):l>s?(this._checkBackwardsSubTransition(e,r,o,s,u.clipStartTime*c),e.currentTransitionIndex=r.length-1,this._checkBackwardsSubTransition(e,r,o,l,u.clipEndTime*c)):this._checkBackwardsSubTransition(e,r,o,s,l)},a._checkSubTransition=function(e,r,o,s,l){for(var u=e.currentTransitionIndex,c=e.state._getDuration(),d=r.length;u<d;u++){var _=r[u],f=_.exitTime*c;if(f>l)break;f>=s&&(this._crossFadeByTransition(_,o),e.currentTransitionIndex=Math.min(u+1,d-1))}},a._checkBackwardsSubTransition=function(e,r,o,s,l){for(var u=e.currentTransitionIndex,c=e.state._getDuration();u>=0;u--){var d=r[u],_=d.exitTime*c;if(_<l)break;_<=s&&(this._crossFadeByTransition(d,o),e.currentTransitionIndex=Math.max(u-1,0))}},a._crossFadeByTransition=function(e,r){var o=e.destinationState;if(!o)return!1;if(!o.clip)return ve.warn("The state named "+name+" has no AnimationClip data."),!1;var s=this._getAnimatorLayerData(r),l=s.layerState,u=s.destPlayData,c=this._getAnimatorStateData(o.name,o,s,r),d=o._getDuration(),_=d*e.offset;switch(u.reset(o,c,_),l){case ot.Standby:case ot.Finished:s.layerState=ot.FixedCrossFading,this._clearCrossData(s),this._prepareStandbyCrossFading(s);break;case ot.Playing:s.layerState=ot.CrossFading,this._clearCrossData(s),this._prepareCrossFading(s);break;case ot.CrossFading:s.layerState=ot.FixedCrossFading,this._prepareFixedPoseCrossFading(s);break;case ot.FixedCrossFading:this._prepareFixedPoseCrossFading(s);break}return s.crossFadeTransition=e,!0},a._fireAnimationEvents=function(e,r,o,s){var l=e.state,u=l.clip.length;this.speed*l.speed>=0?s<o?(this._fireSubAnimationEvents(e,r,o,l.clipEndTime*u),e.currentEventIndex=0,this._fireSubAnimationEvents(e,r,l.clipStartTime*u,s)):this._fireSubAnimationEvents(e,r,o,s):s>o?(this._fireBackwardSubAnimationEvents(e,r,o,l.clipStartTime*u),e.currentEventIndex=r.length-1,this._fireBackwardSubAnimationEvents(e,r,l.clipEndTime*u,s)):this._fireBackwardSubAnimationEvents(e,r,o,s)},a._fireSubAnimationEvents=function(e,r,o,s){for(var l=e.currentEventIndex,u=r.length;l<u;l++){var c=r[l],d=c.event,_=d.time,f=d.parameter;if(_>s)break;var v=c.handlers;if(_>=o){for(var p=v.length-1;p>=0;p--)v[p](f);e.currentEventIndex=Math.min(l+1,u-1)}}},a._fireBackwardSubAnimationEvents=function(e,r,o,s){for(var l=e.currentEventIndex;l>=0;l--){var u=r[l],c=u.event,d=c.time,_=c.parameter;if(d<s)break;if(d<=o){for(var f=u.handlers,v=f.length-1;v>=0;v--)f[v](_);e.currentEventIndex=Math.max(l-1,0)}}},a._callAnimatorScriptOnEnter=function(e,r){for(var o=e._onStateEnterScripts,s=0,l=o.length;s<l;s++)o[s].onStateEnter(this,e,r)},a._callAnimatorScriptOnUpdate=function(e,r){for(var o=e._onStateUpdateScripts,s=0,l=o.length;s<l;s++)o[s].onStateUpdate(this,e,r)},a._callAnimatorScriptOnExit=function(e,r){for(var o=e._onStateExitScripts,s=0,l=o.length;s<l;s++)o[s].onStateExit(this,e,r)},a._checkAutoPlay=function(){for(var e=this._animatorController.layers,r=0,o=e.length;r<o;++r){var s,l=e[r].stateMachine;(s=l)!=null&&s.defaultState&&this.play(l.defaultState.name,r)}},a._checkRevertOwner=function(e,r){r&&e.updateMark!==this._updateMark&&e.revertDefaultValue(),e.updateMark=this._updateMark},q(i,[{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._reset(),this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),i}(rn);P([Ie],Ur.prototype,"speed",void 0);P([z],Ur.prototype,"_controllerUpdateFlag",void 0);P([z],Ur.prototype,"_updateMark",void 0);P([z],Ur.prototype,"_animatorLayersData",void 0);P([z],Ur.prototype,"_curveOwnerPool",void 0);P([z],Ur.prototype,"_animationEventHandlerPool",void 0);P([z],Ur.prototype,"_tempAnimatorStateInfo",void 0);P([z],Ur.prototype,"_controlledRenderers",void 0);var Ff=function(){function n(){this._updateFlagManager=new ra,this._layers=[],this._layersMap={}}var i=n.prototype;return i.findLayerByName=function(t){return this._layersMap[t]},i.addLayer=function(t){this._layers.push(t),this._layersMap[t.name]=t,this._updateFlagManager.dispatch()},i.removeLayer=function(t){var e=this.layers[t];this._layers.splice(t,1),delete this._layersMap[e.name],this._updateFlagManager.dispatch()},i.clearLayers=function(){this._layers.length=0;for(var t in this._layersMap)delete this._layersMap[t];this._updateFlagManager.dispatch()},i._registerChangeFlag=function(){return this._updateFlagManager.createFlag(Ac)},q(n,[{key:"layers",get:function(){return this._layers}}]),n}(),Of=function(i){this.name=i,this.weight=1,this.blendingMode=el.Override},m_=function(){function n(){this._destroyed=!1}var i=n.prototype;return i.onStateEnter=function(t,e,r){},i.onStateUpdate=function(t,e,r){},i.onStateExit=function(t,e,r){},i.destroy=function(){this._destroyed||(this._state._removeStateMachineScript(this),this._destroyed=!0)},n}(),ym=function(){function n(a){this.name=a,this.speed=1,this.wrapMode=tl.Loop,this._onStateEnterScripts=[],this._onStateUpdateScripts=[],this._onStateExitScripts=[],this._clipStartTime=0,this._clipEndTime=1,this._transitions=[]}var i=n.prototype;return i.addTransition=function(t){var e=this._transitions,r=e.length,o=t.exitTime,s=r?e[r-1].exitTime:0;if(o>=s)e.push(t);else{for(var l=r;--l>=0&&o<e[l].exitTime;);e.splice(l+1,0,t)}},i.removeTransition=function(t){var e=this._transitions.indexOf(t);e!==-1&&this._transitions.splice(e,1)},i.addStateMachineScript=function(t){var e=new t;e._state=this;var r=m_.prototype;return e.onStateEnter!==r.onStateEnter&&this._onStateEnterScripts.push(e),e.onStateUpdate!==r.onStateUpdate&&this._onStateUpdateScripts.push(e),e.onStateExit!==r.onStateExit&&this._onStateExitScripts.push(e),e},i.clearTransitions=function(){this._transitions.length=0},i._getDuration=function(){return this.clip?(this._clipEndTime-this._clipStartTime)*this.clip.length:null},i._removeStateMachineScript=function(t){var e=m_.prototype;if(t.onStateEnter!==e.onStateEnter){var r=this._onStateEnterScripts.indexOf(t);r!==-1&&this._onStateEnterScripts.splice(r,1)}if(t.onStateUpdate!==e.onStateUpdate){var o=this._onStateUpdateScripts.indexOf(t);o!==-1&&this._onStateUpdateScripts.splice(o,1)}if(t.onStateExit!==e.onStateExit){var s=this._onStateExitScripts.indexOf(t);s!==-1&&this._onStateExitScripts.splice(s,1)}},q(n,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip=t,this._clipEndTime=Math.min(this._clipEndTime,1)}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(t){this._clipStartTime=Math.max(t,0)}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(t){this._clipEndTime=Math.min(t,1)}}]),n}(),zf=function(){function n(){this.states=[],this._statesMap={}}var i=n.prototype;return i.addState=function(t){var e=this.findStateByName(t);return e?console.warn("The state named "+t+" has existed."):(e=new ym(t),this.states.push(e),this._statesMap[t]=e),e},i.removeState=function(t){var e=t.name,r=this.states.indexOf(t);r>-1&&this.states.splice(r,1),delete this._statesMap[e]},i.findStateByName=function(t){return this._statesMap[t]},i.makeUniqueStateName=function(t){for(var e=this._statesMap,r=t,o=0;e[t];)t=r+" "+o,o++;return t},n}(),y_;(function(n){n[n.If=0]="If",n[n.IfNot=1]="IfNot",n[n.Greater=2]="Greater",n[n.Less=3]="Less",n[n.Equals=4]="Equals",n[n.NotEquals=5]="NotEquals"})(y_||(y_={}));var Un=function(){},qo=function(n){W(i,n);function i(t){var e;return e=n.call(this,t,be.find("skybox"))||this,e._textureDecodeRGBM=!1,e._tintColor=new J(1,1,1,1),e.renderState.rasterState.cullMode=Mn.Off,e.renderState.depthState.compareFunction=Me.LessEqual,e.shaderData.setFloat(i._rotationProp,0),e.shaderData.setFloat(i._exposureProp,1),e.shaderData.setColor(i._tintColorProp,e._tintColor),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"textureDecodeRGBM",get:function(){return this._textureDecodeRGBM},set:function(e){this._textureDecodeRGBM=e,e?this.shaderData.enableMacro(i._decodeSkyRGBMMacro):this.shaderData.disableMacro(i._decodeSkyRGBMMacro)}},{key:"texture",get:function(){return this.shaderData.getTexture(i._textureCubeProp)},set:function(e){this.shaderData.setTexture(i._textureCubeProp,e)}},{key:"rotation",get:function(){return this.shaderData.getFloat(i._rotationProp)},set:function(e){this.shaderData.setFloat(i._rotationProp,e)}},{key:"exposure",get:function(){return this.shaderData.getFloat(i._exposureProp)},set:function(e){this.shaderData.setFloat(i._exposureProp,e)}},{key:"tintColor",get:function(){return this._tintColor},set:function(e){this._tintColor!=e&&this._tintColor.copyFrom(e)}}]),i}(Lr);(function(){qo._tintColorProp=U.getByName("material_TintColor")})();(function(){qo._textureCubeProp=U.getByName("material_CubeTexture")})();(function(){qo._rotationProp=U.getByName("material_Rotation")})();(function(){qo._exposureProp=U.getByName("material_Exposure")})();(function(){qo._decodeSkyRGBMMacro=oe.getByName("MATERIAL_IS_DECODE_SKY_RGBM")})();var A_;(function(n){n[n.None=0]="None",n[n.Simple=1]="Simple",n[n.HighQuality=2]="HighQuality"})(A_||(A_={}));var Mi=function(n){W(i,n);function i(t){var e;return e=n.call(this,t,be.find("SkyProcedural"))||this,e.sunMode=2,e.sunSize=.04,e.sunSizeConvergence=5,e.atmosphereThickness=1,e.skyTint=new J(.5,.5,.5,1),e.groundTint=new J(.369,.349,.341,1),e.exposure=1.3,e.renderState.rasterState.cullMode=Mn.Off,e.renderState.depthState.compareFunction=Me.LessEqual,e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"sunMode",get:function(){return this._sunDisk},set:function(e){var r=this.shaderData;switch(e){case 2:r.disableMacro(i._sunSimpleMacro),r.enableMacro(i._sunHighQualityMacro);break;case 1:r.disableMacro(i._sunHighQualityMacro),r.enableMacro(i._sunSimpleMacro);break;case 0:r.disableMacro(i._sunHighQualityMacro),r.disableMacro(i._sunSimpleMacro);break;default:throw"SkyBoxProceduralMaterial: unknown sun value."}this._sunDisk=e}},{key:"sunSize",get:function(){return this.shaderData.getFloat(i._sunSizeProp)},set:function(e){this.shaderData.setFloat(i._sunSizeProp,Math.min(Math.max(0,e),1))}},{key:"sunSizeConvergence",get:function(){return this.shaderData.getFloat(i._sunSizeConvergenceProp)},set:function(e){this.shaderData.setFloat(i._sunSizeConvergenceProp,Math.min(Math.max(0,e),20))}},{key:"atmosphereThickness",get:function(){return this.shaderData.getFloat(i._atmosphereThicknessProp)},set:function(e){this.shaderData.setFloat(i._atmosphereThicknessProp,Math.min(Math.max(0,e),5))}},{key:"skyTint",get:function(){return this.shaderData.getColor(i._skyTintProp)},set:function(e){this.shaderData.setColor(i._skyTintProp,e)}},{key:"groundTint",get:function(){return this.shaderData.getColor(i._groundTintProp)},set:function(e){this.shaderData.setColor(i._groundTintProp,e)}},{key:"exposure",get:function(){return this.shaderData.getFloat(i._exposureProp)},set:function(e){this.shaderData.setFloat(i._exposureProp,Math.min(Math.max(0,e),8))}}]),i}(Lr);(function(){Mi._sunSizeProp=U.getByName("material_SunSize")})();(function(){Mi._sunSizeConvergenceProp=U.getByName("material_SunSizeConvergence")})();(function(){Mi._atmosphereThicknessProp=U.getByName("material_AtmosphereThickness")})();(function(){Mi._skyTintProp=U.getByName("material_SkyTint")})();(function(){Mi._groundTintProp=U.getByName("material_GroundTint")})();(function(){Mi._exposureProp=U.getByName("material_Exposure")})();(function(){Mi._sunHighQualityMacro=oe.getByName("MATERIAL_SUN_HIGH_QUALITY")})();(function(){Mi._sunSimpleMacro=oe.getByName("MATERIAL_SUN_SIMPLE")})();var iC=function(){},nr;(function(n){n[n.Billboard=0]="Billboard",n[n.StretchBillboard=1]="StretchBillboard",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh",n[n.None=5]="None"})(nr||(nr={}));var Go;(function(n){n[n.StopEmittingAndClear=0]="StopEmittingAndClear",n[n.StopEmitting=1]="StopEmitting"})(Go||(Go={}));var gn=function(n){W(i,n);function i(t){var e;return e=n.call(this,t)||this,e.generator=new Ge(fe(e)),e.velocityScale=0,e.lengthScale=2,e.pivot=new M,e._currentRenderModeMacro=i._billboardModeMacro,e.shaderData.enableMacro(i._billboardModeMacro),e._supportInstancedArrays=e.engine._hardwareRenderer.canIUse(Z.instancedArrays),e}var a=i.prototype;return a._onEnable=function(){this.generator.main.playOnEnabled&&this.generator.play(!1)},a._onDisable=function(){this.generator.stop(!1,Go.StopEmittingAndClear)},a._prepareRender=function(e){if(this._supportInstancedArrays){var r=this.generator;r._update(this.engine.time.deltaTime),r._firstActiveElement!==r._firstFreeElement&&n.prototype._prepareRender.call(this,e)}},a._updateBounds=function(e){e.min.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),e.max.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a._updateShaderData=function(e){var r=this.shaderData;r.setFloat(i._lengthScale,this.lengthScale),r.setFloat(i._speedScale,this.velocityScale),r.setFloat(i._currentTime,this.generator._playTime),r.setVector3(i._pivotOffsetProperty,this.pivot),this.generator._updateShaderData(r)},a._render=function(e){var r=this.generator;r._primitive.instanceCount=r._getAliveParticleCount();var o=this.getMaterial();if(o){o.destroyed&&(o=this.engine._particleMagentaMaterial);var s=this._engine._renderDataPool.getFromPool();s.setX(this,o,r._primitive,r._subPrimitive),e.camera._renderPipeline.pushRenderData(e,s)}},a._onDestroy=function(){n.prototype._onDestroy.call(this),this.generator._destroy()},q(i,[{key:"renderMode",get:function(){return this._renderMode},set:function(e){if(this._renderMode!==e){var r=this._renderMode;this._renderMode=e;var o=null,s=this.shaderData;switch(e){case nr.Billboard:o=i._billboardModeMacro;break;case nr.StretchBillboard:o=i._stretchedBillboardModeMacro;break;case nr.HorizontalBillboard:throw"Not implemented";case nr.VerticalBillboard:throw"Not implemented";case nr.Mesh:throw"Not implemented"}this._currentRenderModeMacro!==o&&(this._currentRenderModeMacro&&s.disableMacro(this._currentRenderModeMacro),o&&s.enableMacro(o),this._currentRenderModeMacro=o),r!==nr.Mesh!=(e===nr.Mesh)&&this.generator._reorganizeGeometryBuffers()}}},{key:"mesh",get:function(){return this._mesh},set:function(e){var r=this._mesh;if(r!==e){var o,s;this._mesh=e,(o=r)==null||o._addReferCount(-1),(s=e)==null||s._addReferCount(1),this.renderMode===nr.Mesh&&this.generator._reorganizeGeometryBuffers()}}}]),i}(Ce);(function(){gn._billboardModeMacro=oe.getByName("RENDERER_MODE_SPHERE_BILLBOARD")})();(function(){gn._stretchedBillboardModeMacro=oe.getByName("RENDERER_MODE_STRETCHED_BILLBOARD")})();(function(){gn._horizontalBillboardModeMacro=oe.getByName("RENDERER_MODE_HORIZONTAL_BILLBOARD")})();(function(){gn._verticalBillboardModeMacro=oe.getByName("RENDERER_MODE_VERTICAL_BILLBOARD")})();(function(){gn._renderModeMeshMacro=oe.getByName("RENDERER_MODE_MESH")})();(function(){gn._pivotOffsetProperty=U.getByName("renderer_PivotOffset")})();(function(){gn._lengthScale=U.getByName("renderer_StretchedBillboardLengthScale")})();(function(){gn._speedScale=U.getByName("renderer_StretchedBillboardSpeedScale")})();(function(){gn._currentTime=U.getByName("renderer_CurrentTime")})();P([K],gn.prototype,"generator",void 0);P([Rf],gn.prototype,"pivot",void 0);var he;(function(n){n[n.Constant=0]="Constant",n[n.TwoConstants=1]="TwoConstants",n[n.Curve=2]="Curve",n[n.TwoCurves=3]="TwoCurves"})(he||(he={}));var En;(function(n){n[n.Constant=0]="Constant",n[n.TwoConstants=1]="TwoConstants",n[n.Gradient=2]="Gradient",n[n.TwoGradients=3]="TwoGradients"})(En||(En={}));var xi;(function(n){n[n.Local=0]="Local",n[n.World=1]="World"})(xi||(xi={}));var nt;(function(n){n[n.Burst=592910910]="Burst",n[n.StartDelay=322376503]="StartDelay",n[n.StartColor=306581307]="StartColor",n[n.StartSize=1793934638]="StartSize",n[n.StartRotation=3737431713]="StartRotation",n[n.randomizeRotationDirection=2527743459]="randomizeRotationDirection",n[n.StartLifetime=2368504881]="StartLifetime",n[n.StartSpeed=4085612399]="StartSpeed",n[n.VelocityOverLifetime=3774601268]="VelocityOverLifetime",n[n.ColorOverLifetime=326370691]="ColorOverLifetime",n[n.SizeOverLifetime=1494990940]="SizeOverLifetime",n[n.RotationOverLifetime=1089181156]="RotationOverLifetime",n[n.TextureSheetAnimation=197469413]="TextureSheetAnimation",n[n.Shape=2941263940]="Shape"})(nt||(nt={}));var oa=function(){function n(a,t){if(a===void 0&&(a=null),t===void 0&&(t=null),this._colorKeys=[],this._alphaKeys=[],this._colorTypeArrayDirty=!1,this._alphaTypeArrayDirty=!1,a)for(var e=0,r=a.length;e<r;e++){var o=a[e];this.addColorKey(o)}if(t)for(var s=0,l=t.length;s<l;s++){var u=t[s];this.addAlphaKey(u)}}var i=n.prototype;return i.addColorKey=function(t,e){var r=this._colorKeys;if(r.length===4)throw new Error("Gradient can only have 4 color keys");var o=typeof t=="number"?new qu(t,e):t;o._onValueChanged=this._setColorTypeArrayDirty.bind(this),this._addKey(r,o),this._colorTypeArrayDirty=!0},i.addAlphaKey=function(t,e){var r=this._alphaKeys;if(r.length===4)throw new Error("Gradient can only have 4 alpha keys");var o=typeof t=="number"?new Ju(t,e):t;o._onValueChanged=this._setAlphaTypeArrayDirty.bind(this),this._addKey(r,o),this._alphaTypeArrayDirty=!0},i.removeColorKey=function(t){this._colorKeys[t]._onValueChanged=null,this._removeKey(this._colorKeys,t),this._colorTypeArrayDirty=!0},i.removeAlphaKey=function(t){this._alphaKeys[t]._onValueChanged=null,this._removeKey(this._alphaKeys,t),this._alphaTypeArrayDirty=!0},i.setKeys=function(t,e){for(var r=this._colorKeys,o=this._alphaKeys,s=0,l=r.length;s<l;s++)r[s]._onValueChanged=null;for(var u=0,c=o.length;u<c;u++)o[u]._onValueChanged=null;r.length=0,o.length=0;for(var d=0,_=t.length;d<_;d++)this._addKey(r,t[d]);for(var f=0,v=e.length;f<v;f++)this._addKey(o,e[f]);this._alphaTypeArrayDirty=!0,this._colorTypeArrayDirty=!0},i._getColorTypeArray=function(t){var e=this._colorTypeArray||(this._colorTypeArray=new Float32Array(16));if(this._colorTypeArrayDirty){for(var r=this._colorKeys,o=0,s=Math.min(r.length,4);o<s;o++){var l=o*4,u=r[o];e[l]=u.time;var c=u.color;t===Qn.Linear?(e[l+1]=J.gammaToLinearSpace(c.r),e[l+2]=J.gammaToLinearSpace(c.g),e[l+3]=J.gammaToLinearSpace(c.b)):(e[l+1]=c.r,e[l+2]=c.g,e[l+3]=c.b)}this._colorTypeArrayDirty=!1}return e},i._getAlphaTypeArray=function(){var t=this._alphaTypeArray||(this._alphaTypeArray=new Float32Array(8));if(this._alphaTypeArrayDirty){for(var e=this._alphaKeys,r=0,o=Math.min(e.length,4);r<o;r++){var s=r*2,l=e[r];t[s]=l.time,t[s+1]=l.alpha}this._alphaTypeArrayDirty=!1}return t},i._addKey=function(t,e){var r=e.time,o=t.length,s=o?t[o-1].time:0;if(r>=s)t.push(e);else{for(var l=o;--l>=0&&r<t[l].time;);t.splice(l+1,0,e)}},i._removeKey=function(t,e){t.splice(e,1)},i._setColorTypeArrayDirty=function(){this._colorTypeArrayDirty=!0},i._setAlphaTypeArrayDirty=function(){this._alphaTypeArrayDirty=!0},q(n,[{key:"colorKeys",get:function(){return this._colorKeys}},{key:"alphaKeys",get:function(){return this._alphaKeys}}]),n}();P([K],oa.prototype,"_colorKeys",void 0);P([K],oa.prototype,"_alphaKeys",void 0);P([z],oa.prototype,"_colorTypeArray",void 0);P([z],oa.prototype,"_alphaTypeArray",void 0);var qu=function(){function n(i,a){this._onValueChanged=null,this._color=new J,this._time=i,a&&this._color.copyFrom(a),this._color._onValueChanged=this._onValueChanged}return q(n,[{key:"time",get:function(){return this._time},set:function(a){this._time=a,this._onValueChanged&&this._onValueChanged()}},{key:"color",get:function(){return this._color},set:function(a){this._color!==a&&this._color.copyFrom(a)}}]),n}(),Ju=function(){function n(i,a){this._onValueChanged=null,this._time=i,this._alpha=a}return q(n,[{key:"time",get:function(){return this._time},set:function(a){this._time=a,this._onValueChanged&&this._onValueChanged()}},{key:"alpha",get:function(){return this._alpha},set:function(a){this._alpha=a,this._onValueChanged&&this._onValueChanged()}}]),n}(),qa=function(){function n(a,t){this.mode=En.Constant,this.constantMin=new J,this.constantMax=new J,this.gradientMin=new oa,this.gradientMax=new oa,a.constructor===J?t?(this.constantMin.copyFrom(a),this.constantMax.copyFrom(t),this.mode=En.TwoConstants):(this.constant.copyFrom(a),this.mode=En.Constant):t?(this.gradientMin=a,this.gradientMax=t,this.mode=En.TwoGradients):(this.gradient=a,this.mode=En.Gradient)}var i=n.prototype;return i.evaluate=function(t,e,r){switch(this.mode){case En.Constant:r.copyFrom(this.constant);break;case En.TwoConstants:J.lerp(this.constantMin,this.constantMax,e,r);break}},q(n,[{key:"constant",get:function(){return this.constantMax},set:function(t){this.constantMax=t}},{key:"gradient",get:function(){return this.gradientMax},set:function(t){this.gradientMax=t}}]),n}();P([K],qa.prototype,"constantMin",void 0);P([K],qa.prototype,"constantMax",void 0);P([K],qa.prototype,"gradientMin",void 0);P([K],qa.prototype,"gradientMax",void 0);var Ja=function(){function n(a){this.enabled=!1,this._generator=a}var i=n.prototype;return i._enableMacro=function(t,e,r){return e!==r&&(e&&t.disableMacro(e),r&&t.enableMacro(r)),r},n}();P([z],Ja.prototype,"_generator",void 0);var Kn=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.color=new qa(new oa([new qu(0,new J(1,1,1)),new qu(1,new J(1,1,1))],[new Ju(0,1),new Ju(1,1)])),t._colorGradientRand=new Pr(0,nt.ColorOverLifetime),t._gradientKeysCount=new ue(0,0,0,0),t}var a=i.prototype;return a._updateShaderData=function(e){var r=null;if(this.enabled){var o=this.color.mode;if(o!==En.Gradient&&o!==En.TwoGradients)throw new Error("Invalid color mode, only gradient and two gradients are supported in color over lifetime.");var s=this.color,l=this._generator._renderer.engine.settings.colorSpace;e.setFloatArray(i._maxGradientColor,s.gradientMax._getColorTypeArray(l)),e.setFloatArray(i._maxGradientAlpha,s.gradientMax._getAlphaTypeArray()),o===En.Gradient?r=i._gradientMacro:(e.setFloatArray(i._minGradientColor,s.gradientMin._getColorTypeArray(l)),e.setFloatArray(i._minGradientAlpha,s.gradientMin._getAlphaTypeArray()),r=i._randomGradientsMacro);var u=s.gradientMin.colorKeys,c=s.gradientMin.alphaKeys,d=s.gradientMax.colorKeys,_=s.gradientMax.alphaKeys;this._gradientKeysCount.set(u.length?u[u.length-1].time:0,c.length?c[c.length-1].time:0,d.length?d[d.length-1].time:0,_.length?_[_.length-1].time:0),e.setVector4(i._gradientKeysCount,this._gradientKeysCount)}this._colorMacro=this._enableMacro(e,this._colorMacro,r)},a._resetRandomSeed=function(e){this._colorGradientRand.reset(e,nt.ColorOverLifetime)},i}(Ja);(function(){Kn._gradientMacro=oe.getByName("RENDERER_COL_GRADIENT")})();(function(){Kn._randomGradientsMacro=oe.getByName("RENDERER_COL_RANDOM_GRADIENTS")})();(function(){Kn._minGradientColor=U.getByName("renderer_COLMinGradientColor")})();(function(){Kn._minGradientAlpha=U.getByName("renderer_COLMinGradientAlpha")})();(function(){Kn._maxGradientColor=U.getByName("renderer_COLMaxGradientColor")})();(function(){Kn._maxGradientAlpha=U.getByName("renderer_COLMaxGradientAlpha")})();(function(){Kn._gradientKeysCount=U.getByName("renderer_COLGradientKeysMaxTime")})();P([K],Kn.prototype,"color",void 0);P([z],Kn.prototype,"_colorGradientRand",void 0);P([z],Kn.prototype,"_gradientKeysCount",void 0);P([z],Kn.prototype,"_colorMacro",void 0);var Xe=function(){function n(a,t){this.mode=he.Constant,this.constantMin=0,this.constantMax=0,typeof a=="number"?t?(this.constantMin=a,this.constantMax=t,this.mode=he.TwoConstants):(this.constant=a,this.mode=he.Constant):t?(this.curveMin=a,this.curveMax=t,this.mode=he.TwoCurves):(this.curve=a,this.mode=he.Curve)}var i=n.prototype;return i.evaluate=function(t,e){switch(this.mode){case he.Constant:return this.constant;case he.TwoConstants:return this.constantMin+(this.constantMax-this.constantMin)*e}},q(n,[{key:"constant",get:function(){return this.constantMax},set:function(t){this.constantMax=t}},{key:"curve",get:function(){return this.curveMax},set:function(t){this.curveMax=t}}]),n}();P([K],Xe.prototype,"curveMin",void 0);P([K],Xe.prototype,"curveMax",void 0);var _a=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.rateOverTime=new Xe(10),t.rateOverDistance=new Xe(0),t._shapeRand=new Pr(0,nt.Shape),t._frameRateTime=0,t._bursts=[],t._currentBurstIndex=0,t._burstRand=new Pr(0,nt.Burst),t}var a=i.prototype;return a.addBurst=function(e){for(var r=this._bursts,o=r.length;--o>=0&&e.time<r[o].time;);r.splice(o+1,0,e)},a.removeBurst=function(e){var r=this._bursts.indexOf(e);r!==-1&&this._bursts.splice(r,1)},a.removeBurstByIndex=function(e){this._bursts.splice(e,1)},a.clearBurst=function(){this._bursts.length=0},a._emit=function(e,r){this._emitByRateOverTime(r),this._emitByBurst(e,r)},a._resetRandomSeed=function(e){this._burstRand.reset(e,nt.Burst),this._shapeRand.reset(e,nt.Shape)},a._reset=function(){this._frameRateTime=0,this._currentBurstIndex=0},a._emitByRateOverTime=function(e){var r=this.rateOverTime.evaluate(void 0,void 0);if(r>0)for(var o=this._generator,s=1/r,l=e-this._frameRateTime;l>=s;)l-=s,this._frameRateTime+=s,o._emit(this._frameRateTime,1)},a._emitByBurst=function(e,r){var o=this._generator.main,s=o.duration,l=Math.floor((r-e)/s);if(o.isLoop&&(l>0||r%s<e%s)){var u=Math.ceil(e/s)*s;this._emitBySubBurst(e,u,s),this._currentBurstIndex=0;for(var c=0;c<l;c++){var d=u;u+=s,this._emitBySubBurst(d,u,s),this._currentBurstIndex=0}this._emitBySubBurst(u,r,s)}else this._emitBySubBurst(e,r,s)},a._emitBySubBurst=function(e,r,o){for(var s=this._generator,l=this._burstRand,u=this.bursts,c=Math.floor(e/o)*o,d=e%o,_=d+(r-e),f=this._currentBurstIndex,v=u.length;f<v;f++){var p=u[f],g=p.time;if(g>_)break;if(g>=d){var m=p.count.evaluate(void 0,l.random());s._emit(c+g,m)}}this._currentBurstIndex=f},q(i,[{key:"bursts",get:function(){return this._bursts}}]),i}(Ja);P([K],_a.prototype,"rateOverTime",void 0);P([K],_a.prototype,"rateOverDistance",void 0);P([K],_a.prototype,"shape",void 0);P([z],_a.prototype,"_shapeRand",void 0);P([K],_a.prototype,"_bursts",void 0);P([z],_a.prototype,"_burstRand",void 0);var Qr;(function(n){n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.World=2]="World"})(Qr||(Qr={}));var ze=function(){function n(a){this.duration=5,this.isLoop=!0,this.startDelay=new Xe(0),this.startLifetime=new Xe(5),this.startSpeed=new Xe(5),this.startSize3D=!1,this.startSizeX=new Xe(1),this.startSizeY=new Xe(1),this.startSizeZ=new Xe(1),this.startRotation3D=!1,this.startRotationX=new Xe(0),this.startRotationY=new Xe(0),this.startRotationZ=new Xe(0),this.flipRotation=0,this.startColor=new qa(new J(1,1,1,1)),this.gravityModifier=new Xe(0),this.simulationSpace=xi.Local,this.simulationSpeed=1,this.scalingMode=Qr.Local,this.playOnEnabled=!0,this._maxParticleBuffer=1e3,this._startSpeedRand=new Pr(0,nt.StartSpeed),this._startLifeTimeRand=new Pr(0,nt.StartLifetime),this._startColorRand=new Pr(0,nt.StartColor),this._startSizeRand=new Pr(0,nt.StartSize),this._startRotationRand=new Pr(0,nt.StartRotation),this._gravity=new M,this._generator=a}var i=n.prototype;return i._resetRandomSeed=function(t){this._startSpeedRand.reset(t,nt.StartSpeed),this._startLifeTimeRand.reset(t,nt.StartLifetime),this._startColorRand.reset(t,nt.StartColor),this._startSizeRand.reset(t,nt.StartSize),this._startRotationRand.reset(t,nt.StartRotation)},i._getPositionScale=function(){var t=this._generator._renderer.entity.transform;switch(this.scalingMode){case Qr.Hierarchy:case Qr.World:return t.lossyWorldScale;case Qr.Local:return t.scale}},i._updateShaderData=function(t){var e=this._generator._renderer,r=e.entity.transform;switch(this.simulationSpace){case xi.Local:t.setVector3(n._worldPosition,r.worldPosition);var o=r.worldRotationQuaternion,s=n._tempVector40;s.copyFrom(o),t.setVector4(n._worldRotation,s);break;case xi.World:break;default:throw new Error("ParticleRenderer: SimulationSpace value is invalid.")}switch(this.scalingMode){case Qr.Hierarchy:var l=r.lossyWorldScale;t.setVector3(n._positionScale,l),t.setVector3(n._sizeScale,l);break;case Qr.Local:var l=r.scale;t.setVector3(n._positionScale,l),t.setVector3(n._sizeScale,l);break;case Qr.World:t.setVector3(n._positionScale,r.lossyWorldScale),t.setVector3(n._sizeScale,n._vector3One);break}var u=this._gravity,c=this.gravityModifier.evaluate(void 0,void 0);M.scale(e.scene.physics.gravity,c,u),t.setVector3(n._gravity,u),t.setInt(n._simulationSpace,this.simulationSpace),t.setFloat(n._startRotation3D,+this.startRotation3D),t.setInt(n._scaleMode,this.scalingMode)},i._cloneTo=function(t){t.maxParticles=this.maxParticles},q(n,[{key:"maxParticles",get:function(){return this._maxParticleBuffer-1},set:function(t){this._maxParticleBuffer=t+1}},{key:"startSize",get:function(){return this.startSizeX},set:function(t){this.startSizeX=t}}]),n}();(function(){ze._tempVector40=new ue})();(function(){ze._vector3One=new M(1,1,1)})();(function(){ze._positionScale=U.getByName("renderer_PositionScale")})();(function(){ze._sizeScale=U.getByName("renderer_SizeScale")})();(function(){ze._worldPosition=U.getByName("renderer_WorldPosition")})();(function(){ze._worldRotation=U.getByName("renderer_WorldRotation")})();(function(){ze._gravity=U.getByName("renderer_Gravity")})();(function(){ze._simulationSpace=U.getByName("renderer_SimulationSpace")})();(function(){ze._startRotation3D=U.getByName("renderer_ThreeDStartRotation")})();(function(){ze._scaleMode=U.getByName("renderer_ScalingMode")})();P([K],ze.prototype,"startDelay",void 0);P([K],ze.prototype,"startLifetime",void 0);P([K],ze.prototype,"startSpeed",void 0);P([K],ze.prototype,"startSizeX",void 0);P([K],ze.prototype,"startSizeY",void 0);P([K],ze.prototype,"startSizeZ",void 0);P([K],ze.prototype,"startRotationX",void 0);P([K],ze.prototype,"startRotationY",void 0);P([K],ze.prototype,"startRotationZ",void 0);P([K],ze.prototype,"startColor",void 0);P([K],ze.prototype,"gravityModifier",void 0);P([z],ze.prototype,"_maxParticleBuffer",void 0);P([z],ze.prototype,"_startSpeedRand",void 0);P([z],ze.prototype,"_startLifeTimeRand",void 0);P([z],ze.prototype,"_startColorRand",void 0);P([z],ze.prototype,"_startSizeRand",void 0);P([z],ze.prototype,"_startRotationRand",void 0);P([z],ze.prototype,"_generator",void 0);P([z],ze.prototype,"_gravity",void 0);var _t=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.separateAxes=!1,t.rotationX=new Xe(0),t.rotationY=new Xe(0),t.rotationZ=new Xe(45),t._rotationRand=new Pr(0,nt.RotationOverLifetime),t._rotationMinConstant=new M,t._rotationMaxConstant=new M,t}var a=i.prototype;return a._updateShaderData=function(e){var r=null,o=null,s=null;if(this.enabled){var l=this.rotationX,u=this.rotationY,c=this.rotationZ,d=this.separateAxes,_=d?l.mode===he.TwoCurves&&u.mode===he.TwoCurves&&c.mode===he.TwoCurves:c.mode===he.TwoCurves,f=_||d?l.mode===he.Curve&&u.mode===he.Curve&&c.mode===he.Curve:c.mode===he.Curve;if(f)e.setFloatArray(i._maxCurveZProperty,c.curveMax._getTypeArray()),d&&(e.setFloatArray(i._maxCurveXProperty,l.curveMax._getTypeArray()),e.setFloatArray(i._maxCurveYProperty,u.curveMax._getTypeArray())),_&&(e.setFloatArray(i._minCurveZProperty,c.curveMin._getTypeArray()),d&&(e.setFloatArray(i._minCurveXProperty,l.curveMin._getTypeArray()),e.setFloatArray(i._minCurveYProperty,u.curveMin._getTypeArray())),s=i._isRandomTwoMacro),o=i._curveModeMacro;else{var v=this._rotationMaxConstant;if(v.set(G.degreeToRadian(l.constantMax),G.degreeToRadian(u.constantMax),G.degreeToRadian(c.constantMax)),e.setVector3(i._maxConstantProperty,v),d?l.mode===he.TwoConstants&&u.mode===he.TwoConstants&&c.mode===he.TwoConstants:c.mode===he.TwoConstants){var p=this._rotationMinConstant;p.set(G.degreeToRadian(l.constantMin),G.degreeToRadian(u.constantMin),G.degreeToRadian(c.constantMin)),e.setVector3(i._minConstantProperty,p),s=i._isRandomTwoMacro}o=i._constantModeMacro}d&&(r=i._isSeparateMacro)}this._enableSeparateMacro=this._enableMacro(e,this._enableSeparateMacro,r),this._isCurveMacro=this._enableMacro(e,this._isCurveMacro,o),this._isRandomTwoMacro=this._enableMacro(e,this._isRandomTwoMacro,s)},a._resetRandomSeed=function(e){this._rotationRand.reset(e,nt.RotationOverLifetime)},i}(Ja);(function(){_t._constantModeMacro=oe.getByName("RENDERER_ROL_CONSTANT_MODE")})();(function(){_t._curveModeMacro=oe.getByName("RENDERER_ROL_CURVE_MODE")})();(function(){_t._isSeparateMacro=oe.getByName("RENDERER_ROL_IS_SEPARATE")})();(function(){_t._isRandomTwoMacro=oe.getByName("RENDERER_ROL_IS_RANDOM_TWO")})();(function(){_t._minConstantProperty=U.getByName("renderer_ROLMinConst")})();(function(){_t._minCurveXProperty=U.getByName("renderer_ROLMinCurveX")})();(function(){_t._minCurveYProperty=U.getByName("renderer_ROLMinCurveY")})();(function(){_t._minCurveZProperty=U.getByName("renderer_ROLMinCurveZ")})();(function(){_t._maxConstantProperty=U.getByName("renderer_ROLMaxConst")})();(function(){_t._maxCurveXProperty=U.getByName("renderer_ROLMaxCurveX")})();(function(){_t._maxCurveYProperty=U.getByName("renderer_ROLMaxCurveY")})();(function(){_t._maxCurveZProperty=U.getByName("renderer_ROLMaxCurveZ")})();P([K],_t.prototype,"rotationX",void 0);P([K],_t.prototype,"rotationY",void 0);P([K],_t.prototype,"rotationZ",void 0);P([z],_t.prototype,"_rotationRand",void 0);P([z],_t.prototype,"_rotationMinConstant",void 0);P([z],_t.prototype,"_rotationMaxConstant",void 0);P([z],_t.prototype,"_enableSeparateMacro",void 0);P([z],_t.prototype,"_isCurveMacro",void 0);P([z],_t.prototype,"_isRandomTwoMacro",void 0);var Da=function(){function n(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];this._keys=[],this._typeArrayDirty=!1;for(var r=0,o=t.length;r<o;r++){var s=t[r];this.addKey(s)}}var i=n.prototype;return i.addKey=function(t,e){var r=this._keys;if(r.length===4)throw new Error("Curve can only have 4 keys");var o=typeof t=="number"?new jr(t,e):t;this._addKey(r,o),this._typeArrayDirty=!0},i.removeKey=function(t){this._keys.splice(t,1),this._typeArrayDirty=!0},i.setKeys=function(t){this._keys.length=0;for(var e=0,r=t.length;e<r;e++)this.addKey(t[e]);this._typeArrayDirty=!0},i._getTypeArray=function(){var t=this._typeArray||(this._typeArray=new Float32Array(8));if(this._typeArrayDirty){for(var e=this._keys,r=0,o=Math.min(e.length,4);r<o;r++){var s=r*2,l=e[r];t[s]=l.time,t[s+1]=l.value}this._typeArrayDirty=!1}return t},i._addKey=function(t,e){var r=t.length,o=e.time,s=r?t[r-1].time:0;if(o>=s)t.push(e);else{for(var l=r;--l>=0&&o<t[l].time;);t.splice(l+1,0,e)}},q(n,[{key:"keys",get:function(){return this._keys}}]),n}();P([K],Da.prototype,"_keys",void 0);P([z],Da.prototype,"_typeArray",void 0);var jr=function(i,a){this.time=i,this.value=a},Yt=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.separateAxes=!1,t.sizeX=new Xe(new Da(new jr(0,0),new jr(1,1))),t.sizeY=new Xe(new Da(new jr(0,0),new jr(1,1))),t.sizeZ=new Xe(new Da(new jr(0,0),new jr(1,1))),t}var a=i.prototype;return a._updateShaderData=function(e){var r=null,o=null,s=null;if(this.enabled){var l=this.sizeX,u=this.sizeY,c=this.sizeZ,d=this.separateAxes,_=d?l.mode===he.TwoCurves&&u.mode===he.TwoCurves&&c.mode===he.TwoCurves:l.mode===he.TwoCurves,f=_||d?l.mode===he.Curve&&u.mode===he.Curve&&c.mode===he.Curve:l.mode===he.Curve;f&&(e.setFloatArray(i._maxCurveXProperty,l.curveMax._getTypeArray()),d&&(e.setFloatArray(i._maxCurveYProperty,u.curveMax._getTypeArray()),e.setFloatArray(i._maxCurveZProperty,c.curveMax._getTypeArray())),_&&(e.setFloatArray(i._minCurveXProperty,l.curveMin._getTypeArray()),d&&(e.setFloatArray(i._minCurveYProperty,u.curveMin._getTypeArray()),e.setFloatArray(i._minCurveZProperty,c.curveMin._getTypeArray())),s=i._isRandomTwoMacro),o=i._curveModeMacro),d&&(r=i._isSeparateMacro)}this._enableSeparateMacro=this._enableMacro(e,this._enableSeparateMacro,r),this._isCurveMacro=this._enableMacro(e,this._isCurveMacro,o),this._isRandomTwoMacro=this._enableMacro(e,this._isRandomTwoMacro,s)},q(i,[{key:"size",get:function(){return this.sizeX},set:function(e){this.sizeX=e}}]),i}(Ja);(function(){Yt._curveModeMacro=oe.getByName("RENDERER_SOL_CURVE_MODE")})();(function(){Yt._isSeparateMacro=oe.getByName("RENDERER_SOL_IS_SEPARATE")})();(function(){Yt._isRandomTwoMacro=oe.getByName("RENDERER_SOL_IS_RANDOM_TWO")})();(function(){Yt._minCurveXProperty=U.getByName("renderer_SOLMinCurveX")})();(function(){Yt._minCurveYProperty=U.getByName("renderer_SOLMinCurveY")})();(function(){Yt._minCurveZProperty=U.getByName("renderer_SOLMinCurveZ")})();(function(){Yt._maxCurveXProperty=U.getByName("renderer_SOLMaxCurveX")})();(function(){Yt._maxCurveYProperty=U.getByName("renderer_SOLMaxCurveY")})();(function(){Yt._maxCurveZProperty=U.getByName("renderer_SOLMaxCurveZ")})();P([K],Yt.prototype,"sizeX",void 0);P([K],Yt.prototype,"sizeY",void 0);P([K],Yt.prototype,"sizeZ",void 0);P([z],Yt.prototype,"_enableSeparateMacro",void 0);P([z],Yt.prototype,"_isCurveMacro",void 0);P([z],Yt.prototype,"_isRandomTwoMacro",void 0);var Nn=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.startFrame=new Xe(0),t.frameOverTime=new Xe(new Da(new jr(0,0),new jr(1,1))),t.type=0,t.cycleCount=1,t._tillingInfo=new M(1,1,1),t._frameOverTimeRand=new Pr(0,nt.TextureSheetAnimation),t._tiling=new te(1,1),t}var a=i.prototype;return a._updateShaderData=function(e){var r=null;if(this.enabled){var o=this.frameOverTime.mode;if(o===he.Curve||o===he.TwoCurves){var s=this.frameOverTime;e.setFloatArray(i._frameMaxCurveProperty,s.curveMax._getTypeArray()),o===he.Curve?r=i._frameCurveMacro:(e.setFloatArray(i._frameMinCurveProperty,s.curveMin._getTypeArray()),r=i._frameRandomCurvesMacro),e.setFloat(i._cycleCountProperty,this.cycleCount),e.setVector3(i._tillingParamsProperty,this._tillingInfo)}}this._textureSheetMacro=this._enableMacro(e,this._textureSheetMacro,r)},a._resetRandomSeed=function(e){this._frameOverTimeRand.reset(e,nt.TextureSheetAnimation)},q(i,[{key:"tiling",get:function(){return this._tiling},set:function(e){this._tiling=e,this._tillingInfo.set(1/e.x,1/e.y,e.x*e.y)}}]),i}(Ja);(function(){Nn._frameCurveMacro=oe.getByName("RENDERER_TSA_FRAME_CURVE")})();(function(){Nn._frameRandomCurvesMacro=oe.getByName("RENDERER_TSA_FRAME_RANDOM_CURVES")})();(function(){Nn._cycleCountProperty=U.getByName("renderer_TSACycles")})();(function(){Nn._tillingParamsProperty=U.getByName("renderer_TSATillingParams")})();(function(){Nn._frameMinCurveProperty=U.getByName("renderer_TSAFrameMinCurve")})();(function(){Nn._frameMaxCurveProperty=U.getByName("renderer_TSAFrameMaxCurve")})();P([K],Nn.prototype,"startFrame",void 0);P([K],Nn.prototype,"frameOverTime",void 0);P([Rf],Nn.prototype,"_tillingInfo",void 0);P([z],Nn.prototype,"_frameOverTimeRand",void 0);P([K],Nn.prototype,"_tiling",void 0);P([z],Nn.prototype,"_textureSheetMacro",void 0);var Cv;(function(n){n[n.WholeSheet=0]="WholeSheet",n[n.SingleRow=1]="SingleRow"})(Cv||(Cv={}));var At=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.velocityX=new Xe(0),t.velocityY=new Xe(0),t.velocityZ=new Xe(0),t.space=xi.Local,t._velocityRand=new Pr(0,nt.VelocityOverLifetime),t._velocityMinConstant=new M,t._velocityMaxConstant=new M,t}var a=i.prototype;return a._updateShaderData=function(e){var r=null;if(this.enabled){var o=this.velocityX,s=this.velocityY,l=this.velocityZ,u=o.mode===he.TwoCurves&&s.mode===he.TwoCurves&&l.mode===he.TwoCurves;if(u||o.mode===he.Curve&&s.mode===he.Curve&&l.mode===he.Curve)e.setFloatArray(i._maxGradientXProperty,o.curveMax._getTypeArray()),e.setFloatArray(i._maxGradientYProperty,s.curveMax._getTypeArray()),e.setFloatArray(i._maxGradientZProperty,l.curveMax._getTypeArray()),u?(e.setFloatArray(i._minGradientXProperty,o.curveMin._getTypeArray()),e.setFloatArray(i._minGradientYProperty,s.curveMin._getTypeArray()),e.setFloatArray(i._minGradientZProperty,l.curveMin._getTypeArray()),r=i._randomCurveMacro):r=i._curveMacro;else{var c=this._velocityMaxConstant;if(c.set(o.constantMax,s.constantMax,l.constantMax),e.setVector3(i._maxConstantProperty,c),o.mode===he.TwoConstants&&s.mode===he.TwoConstants&&l.mode===he.TwoConstants){var d=this._velocityMinConstant;d.set(o.constantMin,s.constantMin,l.constantMin),e.setVector3(i._minConstantProperty,d),r=i._randomConstantMacro}else r=i._constantMacro}e.setInt(i._spaceProperty,this.space)}this._velocityMacro=this._enableMacro(e,this._velocityMacro,r)},a._resetRandomSeed=function(e){this._velocityRand.reset(e,nt.VelocityOverLifetime)},i}(Ja);(function(){At._constantMacro=oe.getByName("RENDERER_VOL_CONSTANT")})();(function(){At._curveMacro=oe.getByName("RENDERER_VOL_CURVE")})();(function(){At._randomConstantMacro=oe.getByName("RENDERER_VOL_RANDOM_CONSTANT")})();(function(){At._randomCurveMacro=oe.getByName("RENDERER_VOL_RANDOM_CURVE")})();(function(){At._minConstantProperty=U.getByName("renderer_VOLMinConst")})();(function(){At._maxConstantProperty=U.getByName("renderer_VOLMaxConst")})();(function(){At._minGradientXProperty=U.getByName("renderer_VOLMinGradientX")})();(function(){At._minGradientYProperty=U.getByName("renderer_VOLMinGradientY")})();(function(){At._minGradientZProperty=U.getByName("renderer_VOLMinGradientZ")})();(function(){At._maxGradientXProperty=U.getByName("renderer_VOLMaxGradientX")})();(function(){At._maxGradientYProperty=U.getByName("renderer_VOLMaxGradientY")})();(function(){At._maxGradientZProperty=U.getByName("renderer_VOLMaxGradientZ")})();(function(){At._spaceProperty=U.getByName("renderer_VOLSpace")})();P([K],At.prototype,"velocityX",void 0);P([K],At.prototype,"velocityY",void 0);P([K],At.prototype,"velocityZ",void 0);P([z],At.prototype,"_velocityRand",void 0);P([z],At.prototype,"_velocityMinConstant",void 0);P([z],At.prototype,"_velocityMaxConstant",void 0);P([z],At.prototype,"_velocityMacro",void 0);var Ge=function(){function n(a){this.useAutoRandomSeed=!0,this.main=new ze(this),this.emission=new _a(this),this.velocityOverLifetime=new At(this),this.sizeOverLifetime=new Yt(this),this.rotationOverLifetime=new _t(this),this.colorOverLifetime=new Kn(this),this.textureSheetAnimation=new Nn(this),this._currentParticleCount=0,this._playTime=0,this._firstNewElement=0,this._firstActiveElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._vertexBufferBindings=new Array,this._subPrimitive=new Cc(0,0,ia.Triangles),this._isPlaying=!1,this._instanceBufferResized=!1,this._waitProcessRetiredElementCount=0,this._randomSeed=0,this._renderer=a;var t=new iC;t.start=0,this._primitive=new bf(a.engine),this._reorganizeGeometryBuffers(),this._resizeInstanceBuffer(!0,n._particleIncreaseCount),this.emission.enabled=!0}var i=n.prototype;return i.play=function(t){if(t===void 0&&(t=!0),t)for(var e=this._renderer.entity.getComponentsIncludeChildren(gn,n._tempParticleRenderers),r=0,o=e.length;r<o;r++){var s=e[r];s.generator.play(!1)}else this._isPlaying=!0,this.useAutoRandomSeed&&this._resetGlobalRandSeed(Math.floor(Math.random()*4294967295))},i.stop=function(t,e){if(t===void 0&&(t=!0),e===void 0&&(e=Go.StopEmitting),t)for(var r=this._renderer.entity.getComponentsIncludeChildren(gn,n._tempParticleRenderers),o=0,s=r.length;o<s;o++){var l=r[o];l.generator.stop(!1,e)}else if(this._isPlaying=!1,e===Go.StopEmittingAndClear){var u=this._firstFreeElement;this._firstRetiredElement=u,this._firstActiveElement=u,this._firstNewElement=u,this._playTime=0,this.emission._reset()}},i.emit=function(t){this._emit(this._playTime,t)},i._emit=function(t,e){if(this.emission.enabled){if(this.main._maxParticleBuffer<this._currentParticleCount)return;for(var r=n._tempVector30,o=n._tempVector31,s=this._renderer.entity.transform,l=this.emission.shape,u=0;u<e;u++){if(l){l._generatePositionAndDirection(this.emission._shapeRand,t,r,o);var c=this.main._getPositionScale();r.multiply(c),o.normalize().multiply(c)}else r.set(0,0,0),o.set(0,0,-1);this._addNewParticle(r,o,s,t)}}},i._update=function(t){var e=this,r=e.main,o=e.emission,s=r.duration,l=this._playTime;if(this._playTime+=t*r.simulationSpeed,this._retireActiveParticles(),this._freeRetiredParticles(),o.enabled&&this._isPlaying){if(this._currentParticleCount>r._maxParticleBuffer){var u=this._getNotRetiredParticleCount();u<r._maxParticleBuffer&&this._resizeInstanceBuffer(!1)}o._emit(l,this._playTime),!r.isLoop&&this._playTime>s&&(this._isPlaying=!1)}if(!this.isAlive){var c=Math.min(o._frameRateTime,Math.floor(this._playTime/s)*s);this._playTime-=c,o._frameRateTime-=c}(this._firstNewElement!=this._firstFreeElement||this._waitProcessRetiredElementCount>0||this._instanceBufferResized||this._instanceVertexBufferBinding._buffer.isContentLost)&&this._addActiveParticlesToVertexBuffer()},i._reorganizeGeometryBuffers=function(){var t=this._renderer,e=t.engine._particleBufferUtils,r=this._primitive,o=this._vertexBufferBindings;if(r.clearVertexElements(),o.length=0,t.renderMode===nr.Mesh){var s=t.mesh;if(!s)return;var l=s.getVertexElement(j.Position),u=s.getVertexElement(j.Color),c=s.getVertexElement(j.UV),d=l?s.vertexBufferBindings[l.bindingIndex]:null,_=u?s.vertexBufferBindings[u.bindingIndex]:null,f=c?s.vertexBufferBindings[c.bindingIndex]:null;if(d){var v=this._addVertexBufferBindingsFilterDuplicate(d,o);r.addVertexElement(new Le(j.Position,l.offset,l.format,v))}if(_){var p=this._addVertexBufferBindingsFilterDuplicate(_,o);r.addVertexElement(new Le(j.Color,u.offset,u.format,p))}if(f){var g=this._addVertexBufferBindingsFilterDuplicate(f,o);r.addVertexElement(new Le(j.UV,c.offset,c.format,g))}var m=s._primitive.indexBufferBinding;r.setIndexBufferBinding(m),this._subPrimitive.count=m.buffer.byteLength/r._glIndexByteCount}else r.addVertexElement(e.billboardVertexElement),o.push(e.billboardVertexBufferBinding),r.setIndexBufferBinding(e.billboardIndexBufferBinding),this._subPrimitive.count=e.billboardIndexCount;r.setVertexBufferBindings(o);for(var h=e.instanceVertexElements,y=o.length,A=0,S=h.length;A<S;A++){var x=h[A];r.addVertexElement(new Le(x.attribute,x.offset,x.format,y,x.instanceStepRate))}},i._resizeInstanceBuffer=function(t,e){var r;(r=this._instanceVertexBufferBinding)==null||r.buffer.destroy();var o=this._renderer.engine._particleBufferUtils,s=o.instanceVertexStride,l=t?this._currentParticleCount+e:this.main._maxParticleBuffer,u=s*l,c=this._renderer.engine,d=new qn(c,vn.VertexBuffer,u,mt.Dynamic,!1);d.isGCIgnored=!0;var _=this._primitive.vertexBufferBindings,f=new ka(d,s),v=new Float32Array(u/4),p=this._instanceVertices;if(p){var g=o.instanceVertexFloatStride,m=this._firstFreeElement,h=this._firstRetiredElement;if(t){var y=this._firstFreeElement*g;v.set(new Float32Array(p.buffer,0,y));var A=(this._firstFreeElement+e)*g;v.set(new Float32Array(p.buffer,y*4),A),this._firstNewElement>m&&(this._firstNewElement+=e),this._firstActiveElement>m&&(this._firstActiveElement+=e),h>m&&(this._firstRetiredElement+=e)}else{var S,x;h<=m?(S=m-h,x=0,this._firstFreeElement-=h,this._firstNewElement-=h,this._firstActiveElement-=h,this._firstRetiredElement=0):(S=this._currentParticleCount-h,x=m,this._firstNewElement>m&&(this._firstNewElement-=m),this._firstActiveElement>m&&(this._firstActiveElement-=m),h>m&&(this._firstRetiredElement-=m)),v.set(new Float32Array(p.buffer,h*g*4,S*g),x*g)}this._instanceBufferResized=!0}this._primitive.setVertexBufferBinding(p?_.length-1:_.length,f),this._instanceVertices=v,this._instanceVertexBufferBinding=f,this._currentParticleCount=l},i._updateShaderData=function(t){this.main._updateShaderData(t),this.velocityOverLifetime._updateShaderData(t),this.textureSheetAnimation._updateShaderData(t),this.sizeOverLifetime._updateShaderData(t),this.rotationOverLifetime._updateShaderData(t),this.colorOverLifetime._updateShaderData(t)},i._resetGlobalRandSeed=function(t){this._randomSeed=t,this.main._resetRandomSeed(t),this.emission._resetRandomSeed(t),this.textureSheetAnimation._resetRandomSeed(t),this.velocityOverLifetime._resetRandomSeed(t),this.rotationOverLifetime._resetRandomSeed(t),this.colorOverLifetime._resetRandomSeed(t)},i._getAliveParticleCount=function(){if(this._firstActiveElement<=this._firstFreeElement)return this._firstFreeElement-this._firstActiveElement;var t=this._currentParticleCount-this._firstActiveElement;return this._firstFreeElement>0&&(t+=this._firstFreeElement),t},i._getNotRetiredParticleCount=function(){if(this._firstRetiredElement<=this._firstFreeElement)return this._firstFreeElement-this._firstRetiredElement;var t=this._currentParticleCount-this._firstRetiredElement;return this._firstFreeElement>0&&(t+=this._firstFreeElement),t},i._destroy=function(){this._instanceVertexBufferBinding.buffer.destroy(),this._primitive.destroy()},i._addNewParticle=function(t,e,r,o){var s=this._firstFreeElement,l=s+1;l>=this._currentParticleCount&&(l=0);var u=this.main;if(l===this._firstRetiredElement){var c=Math.min(n._particleIncreaseCount,u._maxParticleBuffer-this._currentParticleCount);if(c===0)return;this._resizeInstanceBuffer(!0,c),l=s+1}var d,_;u.simulationSpace===xi.World&&(d=r.worldPosition,_=r.worldRotationQuaternion);var f=this._renderer.engine._particleBufferUtils,v=u.startSpeed.evaluate(void 0,u._startSpeedRand.random()),p=this._instanceVertices,g=s*f.instanceVertexFloatStride;p[g]=t.x,p[g+1]=t.y,p[g+2]=t.z,p[g+f.startLifeTimeOffset]=u.startLifetime.evaluate(void 0,u._startLifeTimeRand.random()),p[g+4]=e.x,p[g+5]=e.y,p[g+6]=e.z,p[g+f.timeOffset]=o;var m=n._tempColor0;u.startColor.evaluate(void 0,u._startColorRand.random(),m),this._renderer.engine.settings.colorSpace===Qn.Linear&&m.toLinear(m),p[g+8]=m.r,p[g+9]=m.g,p[g+10]=m.b,p[g+11]=m.a;var h=u._startSizeRand;if(u.startSize3D)p[g+12]=u.startSizeX.evaluate(void 0,h.random()),p[g+13]=u.startSizeY.evaluate(void 0,h.random()),p[g+14]=u.startSizeZ.evaluate(void 0,h.random());else{var y=u.startSize.evaluate(void 0,h.random());p[g+12]=y,p[g+13]=y,p[g+14]=y}var A=u._startRotationRand;u.startRotation3D?(p[g+15]=G.degreeToRadian(u.startRotationX.evaluate(void 0,A.random())),p[g+16]=G.degreeToRadian(u.startRotationY.evaluate(void 0,A.random())),p[g+17]=G.degreeToRadian(u.startRotationZ.evaluate(void 0,A.random()))):p[g+15]=G.degreeToRadian(u.startRotationZ.evaluate(void 0,A.random())),p[g+18]=v;var S=this.colorOverLifetime;S.enabled&&S.color.mode===En.TwoGradients&&(p[g+20]=S._colorGradientRand.random());var x=this.rotationOverLifetime;x.enabled&&x.rotationZ.mode===he.TwoConstants&&(p[g+22]=x._rotationRand.random());var C=this.textureSheetAnimation;C.enabled&&C.frameOverTime.mode===he.TwoCurves&&(p[g+23]=C._frameOverTimeRand.random());var E=this.velocityOverLifetime;if(E.enabled&&E.velocityX.mode===he.TwoConstants&&E.velocityY.mode===he.TwoConstants&&E.velocityZ.mode===he.TwoConstants){var T=E._velocityRand;p[g+24]=T.random(),p[g+25]=T.random(),p[g+26]=T.random()}if(this.main.simulationSpace===xi.World&&(p[g+27]=d.x,p[g+28]=d.y,p[g+29]=d.z,p[g+30]=_.x,p[g+31]=_.y,p[g+32]=_.z,p[g+33]=_.w),this.textureSheetAnimation.enabled){var w=this.textureSheetAnimation._tillingInfo;p[g+f.simulationUVOffset]=w.x,p[g+35]=w.y,p[g+36]=0,p[g+37]=0}else p[g+f.simulationUVOffset]=1,p[g+35]=1,p[g+36]=0,p[g+37]=0;this._firstFreeElement=l},i._retireActiveParticles=function(){for(var t=this._renderer.engine,e=t._particleBufferUtils,r=t.time.frameCount,o=this._instanceVertices;this._firstActiveElement!==this._firstNewElement;){var s=this._firstActiveElement*e.instanceVertexFloatStride,l=s+e.timeOffset,u=this._playTime-o[l];if(Math.fround(u)<o[s+e.startLifeTimeOffset])break;o[l]=r,++this._firstActiveElement>=this._currentParticleCount&&(this._firstActiveElement=0),this._waitProcessRetiredElementCount++}},i._freeRetiredParticles=function(){for(var t=this._renderer.engine._particleBufferUtils,e=this._renderer.engine.time.frameCount;this._firstRetiredElement!==this._firstActiveElement;){var r=this._firstRetiredElement*t.instanceVertexFloatStride+t.startLifeTimeOffset,o=e-this._instanceVertices[r];if(o<0)break;++this._firstRetiredElement>=this._currentParticleCount&&(this._firstRetiredElement=0)}},i._addActiveParticlesToVertexBuffer=function(){var t=this._firstActiveElement,e=this._firstFreeElement;if(t!==e){var r=this._renderer.engine._particleBufferUtils.instanceVertexStride,o=t*r,s=this._instanceVertexBufferBinding.buffer,l=this._instanceVertices.buffer;if(t<e)s.setData(l,0,o,(e-t)*r,Ua.Discard);else{var u=(this._currentParticleCount-t)*r;s.setData(l,0,o,u,Ua.Discard),e>0&&s.setData(l,u,0,e*r)}this._firstNewElement=e,this._waitProcessRetiredElementCount=0,this._instanceBufferResized=!1}},i._addVertexBufferBindingsFilterDuplicate=function(t,e){for(var r=0,o=e.length;r<o;r++)if(e[r]===t)return r;return e.push(t),r},q(n,[{key:"isAlive",get:function(){return this._isPlaying?!0:this._firstActiveElement!==this._firstFreeElement}},{key:"randomSeed",get:function(){return this._randomSeed},set:function(t){this._resetGlobalRandSeed(t),this.useAutoRandomSeed=!1}}]),n}();(function(){Ge._tempVector30=new M})();(function(){Ge._tempVector31=new M})();(function(){Ge._tempColor0=new J})();(function(){Ge._tempParticleRenderers=new Array})();(function(){Ge._particleIncreaseCount=128})();P([K],Ge.prototype,"main",void 0);P([K],Ge.prototype,"emission",void 0);P([K],Ge.prototype,"velocityOverLifetime",void 0);P([K],Ge.prototype,"sizeOverLifetime",void 0);P([K],Ge.prototype,"rotationOverLifetime",void 0);P([K],Ge.prototype,"colorOverLifetime",void 0);P([K],Ge.prototype,"textureSheetAnimation",void 0);P([z],Ge.prototype,"_playTime",void 0);P([z],Ge.prototype,"_firstNewElement",void 0);P([z],Ge.prototype,"_firstActiveElement",void 0);P([z],Ge.prototype,"_firstFreeElement",void 0);P([z],Ge.prototype,"_firstRetiredElement",void 0);P([z],Ge.prototype,"_primitive",void 0);P([z],Ge.prototype,"_vertexBufferBindings",void 0);P([z],Ge.prototype,"_subPrimitive",void 0);P([z],Ge.prototype,"_renderer",void 0);P([z],Ge.prototype,"_isPlaying",void 0);P([z],Ge.prototype,"_instanceBufferResized",void 0);P([z],Ge.prototype,"_waitProcessRetiredElementCount",void 0);P([z],Ge.prototype,"_instanceVertexBufferBinding",void 0);P([z],Ge.prototype,"_instanceVertices",void 0);var aC=function(n){W(i,n);function i(t){var e;e=n.call(this,t,be.find("particle-shader"))||this;var r=e.shaderData;return r.setColor($e._baseColorProp,new J(1,1,1,1)),e.isTransparent=!0,e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor($e._baseColorProp)},set:function(e){var r=this.shaderData.getColor($e._baseColorProp);e!==r&&r.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture($e._baseTextureProp)},set:function(e){this.shaderData.setTexture($e._baseTextureProp,e),e?this.shaderData.enableMacro($e._baseTextureMacro):this.shaderData.disableMacro($e._baseTextureMacro)}}]),i}($e),Am=function(i,a){this.time=i,this.count=a};P([K],Am.prototype,"count",void 0);var dl=function(){function n(){this.enable=!0,this.randomDirectionAmount=0}var i=n.prototype;return i._generatePositionAndDirection=function(t,e,r,o){throw new Error("BaseShape: must override it.")},n}(),sr=function(){function n(){}return n.randomPointUnitArcCircle=function(a,t,e){var r=e.random()*a;t.x=Math.cos(r),t.y=Math.sin(r)},n.randomPointInsideUnitArcCircle=function(a,t,e){n.randomPointUnitArcCircle(a,t,e);var r=Math.sqrt(e.random());t.x=t.x*r,t.y=t.y*r},n.randomPointUnitCircle=function(a,t){var e=t.random()*Math.PI*2;a.x=Math.cos(e),a.y=Math.sin(e)},n.randomPointInsideUnitCircle=function(a,t){n.randomPointUnitCircle(a,t);var e=Math.sqrt(t.random());a.x=a.x*e,a.y=a.y*e},n._randomPointUnitSphere=function(a,t){var e=t.random()*2-1,r=t.random()*Math.PI*2,o=Math.sqrt(1-e*e);a.x=o*Math.cos(r),a.y=o*Math.sin(r),a.z=e},n._randomPointInsideUnitSphere=function(a,t){n._randomPointUnitSphere(a,t);var e=Math.pow(t.random(),1/3);a.x=a.x*e,a.y=a.y*e,a.z=a.z*e},n._randomPointInsideHalfUnitBox=function(a,t){t===void 0&&(t=null),a.x=t.random()-.5,a.y=t.random()-.5,a.z=t.random()-.5},n}(),Ha;(function(n){n[n.Box=0]="Box",n[n.Circle=1]="Circle",n[n.Cone=2]="Cone",n[n.Hemisphere=3]="Hemisphere",n[n.Sphere=4]="Sphere"})(Ha||(Ha={}));var Uf=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.size=new M(1,1,1),t.shapeType=Ha.Box,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,r,o,s){sr._randomPointInsideHalfUnitBox(o,e),o.multiply(this.size);var l=i._tempVector30;l.set(0,0,-1),sr._randomPointUnitSphere(s,e),M.lerp(l,s,this.randomDirectionAmount,s)},i}(dl);(function(){Uf._tempVector30=new M})();P([K],Uf.prototype,"size",void 0);var Eo;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop"})(Eo||(Eo={}));var xm=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.radius=1,t.arc=360,t.arcMode=Eo.Random,t.arcSpeed=1,t.shapeType=Ha.Circle,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,r,o,s){var l=i._tempPositionPoint;switch(this.arcMode){case Eo.Loop:var u=r*this.arcSpeed*(360/this.arc)%1,c=G.degreeToRadian(this.arc*u);l.set(Math.cos(c),Math.sin(c)),l.scale(e.random());break;case Eo.Random:sr.randomPointInsideUnitArcCircle(G.degreeToRadian(this.arc),l,e);break}o.set(l.x,l.y,0),o.scale(this.radius),sr._randomPointUnitSphere(s,e),M.lerp(o,s,this.randomDirectionAmount,s)},i}(dl);(function(){xm._tempPositionPoint=new te})();var _l=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.angle=25,t.radius=1,t.length=5,t.emitType=0,t.shapeType=Ha.Cone,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,r,o,s){var l=i._tempVector20,u=G.degreeToRadian(this.angle),c=Math.sin(u),d=Math.cos(u);switch(this.emitType){case 0:sr.randomPointInsideUnitCircle(l,e),o.set(l.x*this.radius,l.y*this.radius,0);var _=i._tempVector21;sr.randomPointInsideUnitCircle(_,e),te.lerp(l,_,this.randomDirectionAmount,_),s.set(_.x*c,_.y*c,-d);break;case 1:sr.randomPointInsideUnitCircle(l,e),o.set(l.x*this.radius,l.y*this.radius,0),s.set(l.x*c,l.y*c,-d),s.normalize();var f=i._tempVector30;M.scale(s,this.length*e.random(),f),o.add(f);var v=i._tempVector31;sr._randomPointUnitSphere(v,e),M.lerp(s,v,this.randomDirectionAmount,s);break}},i}(dl);(function(){_l._tempVector20=new te})();(function(){_l._tempVector21=new te})();(function(){_l._tempVector30=new M})();(function(){_l._tempVector31=new M})();var x_;(function(n){n[n.Base=0]="Base",n[n.Volume=1]="Volume"})(x_||(x_={}));var oC=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.radius=1,t.shapeType=Ha.Hemisphere,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,r,o,s){sr._randomPointInsideUnitSphere(o,e),o.scale(this.radius);var l=o.z;l>0&&(o.z=-l),sr._randomPointUnitSphere(s,e),M.lerp(o,s,this.randomDirectionAmount,s)},i}(dl),sC=function(n){W(i,n);function i(){var t;return t=n.call(this)||this,t.radius=1,t.shapeType=Ha.Sphere,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,r,o,s){sr._randomPointInsideUnitSphere(o,e),o.scale(this.radius),sr._randomPointUnitSphere(s,e),M.lerp(o,s,this.randomDirectionAmount,s)},i}(dl),lC=`#define GLSLIFY 1
varying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}`,uC=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 camera_ProjMat;uniform mat4 camera_ViewMat;void main(){gl_Position=camera_ProjMat*camera_ViewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`;be.create("trail",uC,lC);var Sm=function(n){W(i,n);function i(a){var t;t=n.call(this,a,be.find("trail"))||this;var e=t.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=we.SourceAlpha,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=we.One,t.renderState.depthState.writeEnabled=!1,t}return i}(Lr),Ev=new M,cC=function(n){W(i,n);function i(t,e){var r;r=n.call(this,t)||this,r._stroke=e.stroke||.2,r._minSeg=e.minSeg||.02,r._lifetime=e.lifetime||1e3,r._maxPointNum=r._lifetime/1e3*t.engine.targetFrameRate,r._points=[],r._pointStates=[],r._strapPoints=[];for(var o=0;o<r._maxPointNum;o++)r._points.push(new M),r._pointStates.push(r._lifetime),r._strapPoints.push(new M),r._strapPoints.push(new M);r._curPointNum=0;var s=e.material||new Sm(r.engine);return r.setMaterial(s),r.setTexture(e.texture),r._initGeometry(),r}var a=i.prototype;return a.update=function(e){for(var r=0,o=0,s=0;s<this._curPointNum;s++)this._pointStates[s]-=e,this._pointStates[s]<0?r++:r>0&&(o=s-r,this._pointStates[o]=this._pointStates[s],this._points[o].copyFrom(this._points[s]));this._curPointNum-=r;var l=!0;if(this._curPointNum===this._maxPointNum)l=!1;else if(this._curPointNum>0){var u=this._points[this._points.length-1];M.distance(this.entity.transform.worldPosition,u)<this._minSeg&&(l=!1)}l&&(this._pointStates[this._curPointNum]=this._lifetime,this._points[this._curPointNum].copyFrom(this.entity.transform.worldPosition),this._curPointNum++)},a.setTexture=function(e){e&&this.getMaterial().shaderData.setTexture("u_texture",e)},a._render=function(e){this._updateStrapVertices(e.camera,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),n.prototype._render.call(this,e)},a._initGeometry=function(){var e=new If(this._entity.engine),r=20,o=this._maxPointNum*2,s=o*r,l=new Float32Array(s),u=[new Le("POSITION",0,ie.Vector3,0),new Le("TEXCOORD_0",12,ie.Vector2,0)],c=new qn(this.engine,s*4,mt.Dynamic);e.setVertexBufferBinding(c,r),e.setVertexElements(u),e.addSubMesh(0,o,ia.TriangleStrip),this._vertexBuffer=c,this._vertexStride=r,this._vertices=l,this.mesh=e},a._updateStrapVertices=function(e,r){var o=e.viewMatrix,s=o.elements,l=new M(s[0],s[4],s[8]),u=new M(s[1],s[5],s[9]),c=new M(s[2],s[6],s[10]),d=this._stroke;u.scale(d);var _=new M,f=new M,v=new xe;M.transformByQuat(l,v,l),M.transformByQuat(u,v,u);var p=new M,g=new M,m=new M;l.normalize();for(var h=this._vertices,y=0;y<this._maxPointNum;y++){if(y<this._curPointNum){var A=r[y];y===this._curPointNum-1&&y!==0?M.subtract(A,r[y-1],m):M.subtract(r[y+1],A,m),this._projectOnPlane(m,c,m),m.normalize();var S=Math.acos(M.dot(l,m));M.cross(l,m,g),M.dot(g,c)<=0&&(S=Math.PI*2-S),xe.rotationAxisAngle(c,S,v),M.transformByQuat(u,v,p),M.add(A,p,_),M.subtract(A,p,f)}var x=y*2*this._vertexStride/4,C=(y*2+1)*this._vertexStride/4;h[x]=_.x,h[x+1]=_.y,h[x+2]=_.z,h[C]=f.x,h[C+1]=f.y,h[C+2]=f.z}},a._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,r=1/e,o=this._vertices,s=0;s<e;s++){var l=1-s*r,u=s*2*this._vertexStride/4,c=(s*2+1)*this._vertexStride/4;o[u]=0,o[u+1]=l,o[c]=1,o[c+1]=l}}},a._projectOnVector=function(e,r,o){var s=r.clone();M.normalize(s,s);var l=M.dot(e,s);o.x=s.x*l,o.y=s.y*l,o.z=s.z*l},a._projectOnPlane=function(e,r,o){this._projectOnVector(e,r,Ev),M.subtract(e,Ev,o)},i}(en),Cm=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.probeLayer=Yn.Everything,t.width=1024,t.height=1024,t.antiAliasing=1,t._isCube=!1,t}var a=i.prototype;return a.onTextureChange=function(e){},a.onBeginRender=function(e){this.enabled&&(this._camera=e,this._oriCameraCullingMask=e.cullingMask,e.cullingMask=this.probeLayer,(!this._activeRenderTarget||this._activeRenderTarget.width!==this.width||this._activeRenderTarget.height!==this.height||this._activeRenderTarget.antiAliasing!==this.antiAliasing)&&(this._renderTarget=new Iu(this.engine,this.width,this.height,this._isCube?new Tn(this.engine,this.width):new fn(this.engine,this.width,this.height),kt.Depth,this.antiAliasing),this._renderTargetSwap=new Iu(this.engine,this.width,this.height,this._isCube?new Tn(this.engine,this.width):new fn(this.engine,this.width,this.height),kt.Depth,this.antiAliasing),this._activeRenderTarget=this._renderTarget),this._oriCameraRenderTarget=e.renderTarget,e.renderTarget=this._activeRenderTarget)},a.onEndRender=function(e){this.enabled&&(this.onTextureChange&&this.onTextureChange(this._texture),this._activeRenderTarget=this._activeRenderTarget===this._renderTarget?this._renderTargetSwap:this._renderTarget)},a._reset=function(){this.enabled&&(this._camera.renderTarget=this._oriCameraRenderTarget,this._camera.cullingMask=this._oriCameraCullingMask)},q(i,[{key:"_texture",get:function(){var e;return(e=this._activeRenderTarget)==null?void 0:e.getColorTexture()}}]),i}(Tt),wv=new M,pa=new M,ga=new M,dC=function(n){W(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.position=new M(0,0,0),t._isCube=!0,t.oriViewMatrix=new $,t}var a=i.prototype;return a.onBeginRender=function(e){if(this.enabled){n.prototype.onBeginRender.call(this,e),this._storeCamera(e);for(var r=0;r<6;r++)this._setCamera(r,e),e.render(fr.PositiveX+r);this._restoreCamera(e),n.prototype._reset.call(this)}},a._storeCamera=function(e){this.oriViewMatrix.copyFrom(e.viewMatrix),this._oriFieldOfView=e.fieldOfView},a._restoreCamera=function(e){e.viewMatrix.copyFrom(this.oriViewMatrix),e.fieldOfView=this._oriFieldOfView},a._setCamera=function(e,r){switch(e){case 0:pa.set(0,-1,0),ga.set(1,0,0);break;case 1:pa.set(0,-1,0),ga.set(-1,0,0);break;case 2:pa.set(0,0,1),ga.set(0,1,0);break;case 3:pa.set(0,0,-1),ga.set(0,-1,0);break;case 4:pa.set(0,-1,0),ga.set(0,0,1);break;case 5:pa.set(0,-1,0),ga.set(0,0,-1);break}M.add(this.position,ga,wv),$.lookAt(this.position,wv,pa,r.viewMatrix),r.fieldOfView=90},i}(Cm);const Tv=Object.freeze(Object.defineProperty({__proto__:null,AmbientLight:vr,get AnimationArrayCurve(){return Hu},get AnimationBoolCurve(){return p_},AnimationClip:Vf,AnimationClipCurveBinding:mm,get AnimationColorCurve(){return Wu},AnimationCurve:pr,AnimationEvent:Tc,get AnimationFloatArrayCurve(){return Zs},get AnimationFloatCurve(){return Qu},get AnimationQuaternionCurve(){return ko},get AnimationRectCurve(){return g_},get AnimationRefCurve(){return Yu},get AnimationVector2Curve(){return Xu},get AnimationVector3Curve(){return Ks},get AnimationVector4Curve(){return ju},Animator:Ur,get AnimatorConditionMode(){return y_},AnimatorController:Ff,AnimatorControllerLayer:Of,get AnimatorCullingMode(){return $s},get AnimatorLayerBlendingMode(){return el},AnimatorState:ym,AnimatorStateMachine:zf,AnimatorStateTransition:Nf,AssetPromise:Oe,get AssetType(){return De},Background:_m,get BackgroundMode(){return Ai},get BackgroundTextureFillMode(){return Gi},BaseMaterial:$e,Basic2DBatcher:Dr,BasicRenderPipeline:gm,get BlendFactor(){return we},get BlendMode(){return Ma},get BlendOperation(){return dn},BlendShape:Lf,BlendShapeFrame:nm,BlendState:xc,BlinnPhongMaterial:cl,BoolUpdateFlag:Ac,BoxColliderShape:zu,BoxShape:Uf,Buffer:qn,get BufferBindFlag(){return vn},BufferMesh:If,get BufferUsage(){return mt},BufferUtil:Vu,Burst:Am,get Camera(){return et},get CameraClearFlags(){return Xn},CapsuleColliderShape:Ec,CharacterController:rS,CircleShape:xm,CloneManager:_r,get Collider(){return Ln},ColliderShape:Vn,get ColliderShapeUpAxis(){return Ou},get CollisionDetectionMode(){return c_},ColorOverLifetimeModule:Kn,get ColorSpace(){return Qn},get ColorWriteMask(){return ar},get CompareFunction(){return Me},Component:rn,get ConeEmitType(){return x_},ConeShape:_l,ContentRestorer:gi,get ControllerCollisionFlag(){return f_},get ControllerNonWalkableMode(){return Fu},CubeProbe:dC,get CullMode(){return Mn},CurveKey:jr,get DataType(){return We},get DependentMode(){return za},DepthState:$0,get DepthTextureMode(){return Js},get DiffuseMode(){return Ga},DirectLight:aa,DynamicCollider:Sn,get DynamicColliderConstraints(){return d_},EmissionModule:_a,Engine:$r,EngineObject:ti,Entity:Br,EventDispatcher:Pf,FixedJoint:iS,get FogMode(){return ku},Font:No,get FontStyle(){return ki},get GLCapabilityType(){return Z},GradientAlphaKey:Ju,GradientColorKey:qu,HemisphereShape:oC,HingeJoint:jo,HitResult:om,IndexBufferBinding:Xs,get IndexFormat(){return Ht},InputManager:um,get InterpolationType(){return Gt},get Joint(){return Or},JointLimits:oS,JointMotor:sS,Keyframe:Un,get Keys(){return ba},get Layer(){return Yn},Light:ul,Loader:ke,Logger:ve,MainModule:ze,Material:Lr,Mesh:Df,MeshRenderer:en,get MeshTopology(){return ia},ModelMesh:Nt,get OverflowMode(){return Oa},PBRBaseMaterial:zr,PBRMaterial:ea,PBRSpecularMaterial:Ya,ParticleCompositeCurve:Xe,ParticleCompositeGradient:qa,ParticleCurve:Da,get ParticleCurveMode(){return he},ParticleGenerator:Ge,ParticleGradient:oa,get ParticleGradientMode(){return En},ParticleMaterial:aC,get ParticleRenderMode(){return nr},ParticleRenderer:gn,get ParticleScaleMode(){return Qr},get ParticleShapeArcMode(){return Eo},get ParticleSimulationSpace(){return xi},get ParticleStopMode(){return Go},PhysicsMaterial:sm,get PhysicsMaterialCombineMode(){return js},PhysicsScene:xn,get PipelineStage(){return hn},PlaneColliderShape:lS,get Platform(){return cn},PointLight:da,Pointer:am,get PointerButton(){return Co},get PointerPhase(){return zn},Primitive:bf,PrimitiveMesh:Er,Probe:Cm,RasterState:em,ReferResource:ni,get RenderBufferDepthFormat(){return kt},get RenderFace(){return hi},RenderPass:_s,RenderQueue:ci,get RenderQueueType(){return bt},RenderState:Kr,get RenderStateDataKey(){return ae},RenderTarget:Iu,RenderTargetBlendState:K0,get Renderer(){return Ce},ResourceManager:zo,RotationOverLifetimeModule:_t,Scene:ja,SceneManager:im,Script:Tt,get SetDataOptions(){return Ua},Shader:be,ShaderData:ri,ShaderFactory:Ni,ShaderMacro:oe,ShaderMacroCollection:Dn,ShaderPass:zt,ShaderProperty:U,get ShaderPropertyType(){return ln},ShaderTagKey:mi,get ShadowCascadesMode(){return tr},get ShadowResolution(){return Hi},get ShadowType(){return Ti},SizeOverLifetimeModule:Yt,Skin:rm,SkinnedMeshRenderer:Lt,Sky:Uo,SkyBoxMaterial:qo,SkyProceduralMaterial:Mi,SphereColliderShape:lm,SphereShape:sC,SpotLight:hr,SpringJoint:aS,Sprite:wr,SpriteAtlas:cm,get SpriteDrawMode(){return $n},SpriteMask:an,get SpriteMaskInteraction(){return wt},get SpriteMaskLayer(){return Oo},SpriteRenderer:je,get SpriteTileMode(){return Ys},StateMachineScript:m_,StaticCollider:__,get StencilOperation(){return Ke},StencilState:tm,SubMesh:Cc,SubShader:lu,get SunMode(){return A_},SystemInfo:Ki,get TextHorizontalAlignment(){return wa},TextRenderer:dt,TextUtils:ur,get TextVerticalAlignment(){return Ta},Texture:Zr,Texture2D:fn,Texture2DArray:Mf,get TextureCoordinate(){return $i},TextureCube:Tn,get TextureCubeFace(){return fr},get TextureDepthCompareFunction(){return er},get TextureFilterMode(){return tn},get TextureFormat(){return X},TextureSheetAnimationModule:Nn,get TextureUsage(){return Vo},get TextureWrapMode(){return $t},Time:yc,TrailMaterial:Sm,TrailRenderer:cC,Transform:ye,UnlitMaterial:Gu,Utils:yt,VelocityOverLifetimeModule:At,get VertexAttribute(){return j},VertexBufferBinding:ka,VertexElement:Le,get VertexElementFormat(){return ie},get WrapMode(){return tl},assignmentClone:Ie,deepClone:K,dependentComponents:ll,ignoreClone:z,request:Nr,resourceLoader:ct,shallowClone:Rf},Symbol.toStringTag,{value:"Module"}));var ce;(function(n){n[n.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",n[n.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",n[n.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",n[n.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",n[n.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",n[n.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",n[n.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",n[n.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",n[n.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",n[n.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",n[n.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",n[n.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",n[n.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",n[n.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",n[n.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",n[n.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",n[n.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",n[n.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",n[n.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",n[n.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",n[n.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",n[n.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",n[n.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",n[n.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",n[n.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",n[n.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",n[n.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",n[n.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",n[n.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",n[n.R11_EAC=37488]="R11_EAC",n[n.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",n[n.RG11_EAC=37490]="RG11_EAC",n[n.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",n[n.RGB8_ETC2=37492]="RGB8_ETC2",n[n.SRGB8_ETC2=37493]="SRGB8_ETC2",n[n.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",n[n.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",n[n.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",n[n.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",n[n.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",n[n.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",n[n.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",n[n.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",n[n.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",n[n.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT",n[n.RGBA_BPTC_UNORM_EXT=36492]="RGBA_BPTC_UNORM_EXT",n[n.SRGB_ALPHA_BPTC_UNORM_EXT=36493]="SRGB_ALPHA_BPTC_UNORM_EXT",n[n.RGB_BPTC_SIGNED_FLOAT_EXT=36494]="RGB_BPTC_SIGNED_FLOAT_EXT",n[n.RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="RGB_BPTC_UNSIGNED_FLOAT_EXT"})(ce||(ce={}));function Rv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function fl(n,i,a){return i&&Rv(n.prototype,i),a&&Rv(n,a),n}function Gn(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var _C=function(){function n(a){this._scale=new te;var t=a.width,e=a.height;this._webCanvas=a,this._width=t,this._height=e}var i=n.prototype;return i.resizeByClientSize=function(t){t===void 0&&(t=window.devicePixelRatio);var e=this._webCanvas;(typeof OffscreenCanvas>"u"||!Gn(e,OffscreenCanvas))&&(this.width=e.clientWidth*t,this.height=e.clientHeight*t)},i.setScale=function(t,e){this._scale.set(t,e),this.scale=this._scale},fl(n,[{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._webCanvas.width=t,this._width=t)}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(this._webCanvas.height=t,this._height=t)}},{key:"scale",get:function(){var t=this._webCanvas;return(typeof OffscreenCanvas>"u"||!Gn(t,OffscreenCanvas))&&this._scale.set(t.clientWidth*devicePixelRatio/t.width,t.clientHeight*devicePixelRatio/t.height),this._scale},set:function(t){var e=this._webCanvas;(typeof OffscreenCanvas>"u"||!Gn(e,OffscreenCanvas))&&(e.style.transformOrigin="left top",e.style.transform="scale("+t.x+", "+t.y+")")}}]),n}();function S_(n,i){return S_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},S_(n,i)}function Rc(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&S_(n,i)}var fC=function(n){Rc(i,n);function i(){return n.apply(this,arguments)}return i.create=function(t){var e=t.canvas,r=new _C(typeof e=="string"?document.getElementById(e):e),o=new CC(t.graphicDeviceOptions),s=new i(r,o,t),l=s._initialize(t);return l.then(function(){return s.sceneManager.addScene(new ja(s,"DefaultScene")),s})},fl(i,[{key:"canvas",get:function(){return this._canvas}}]),i}($r);function Zu(){return Zu=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},Zu.apply(this,arguments)}var hC=function(){function n(a,t,e,r,o){r===void 0&&(r=mt.Static);var s=a.gl,l=s.createBuffer(),u=this._getGLBufferUsage(s,r),c=t===vn.VertexBuffer?s.ARRAY_BUFFER:s.ELEMENT_ARRAY_BUFFER;this._gl=s,this._glBuffer=l,this._glBufferUsage=u,this._glBindTarget=c,this._isWebGL2=a.isWebGL2,this.bind(),o?s.bufferData(c,o,u):s.bufferData(c,e,u),s.bindBuffer(c,null)}var i=n.prototype;return i.bind=function(){this._gl.bindBuffer(this._glBindTarget,this._glBuffer)},i.setData=function(t,e,r,o,s,l){var u=this._gl,c=this._glBindTarget;this.bind(),l===Ua.Discard&&u.bufferData(c,t,this._glBufferUsage);var d=e.BYTES_PER_ELEMENT||1,_=s?d*s:e.byteLength;if(o!==0||_<e.byteLength){var f=e.byteOffset!==void 0;if(this._isWebGL2&&f)u.bufferSubData(c,r,e,o,_/d);else{var v=new Uint8Array(f?e.buffer:e,o*d,_);u.bufferSubData(c,r,v)}}else u.bufferSubData(c,r,e);u.bindBuffer(c,null)},i.getData=function(t,e,r,o){if(this._isWebGL2){var s=this._gl;this.bind(),s.getBufferSubData(this._glBindTarget,e,t,r,o)}else throw"Buffer is write-only on WebGL1.0 platforms."},i.destroy=function(){this._gl.deleteBuffer(this._glBuffer),this._gl=null,this._glBuffer=null},i._getGLBufferUsage=function(t,e){switch(e){case mt.Static:return t.STATIC_DRAW;case mt.Dynamic:return t.DYNAMIC_DRAW;case mt.Stream:return t.STREAM_DRAW}},n}(),vC=function(){function n(a){this._rhi=a,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var i=n.prototype;return i.canIUse=function(t){return this.capabilityList.get(t)},i.canIUseCompressedTextureInternalFormat=function(t){var e=ce.RGBA_ASTC_4X4_KHR,r=ce.RGBA_ASTC_12X12_KHR,o=ce.SRGB8_ALPHA8_ASTC_4X4_KHR,s=ce.SRGB8_ALPHA8_ASTC_12X12_KHR,l=ce.RGB_ETC1_WEBGL,u=ce.R11_EAC,c=ce.SRGB8_ALPHA8_ETC2_EAC,d=ce.RGB_PVRTC_4BPPV1_IMG,_=ce.RGBA_PVRTC_2BPPV1_IMG,f=ce.RGB_S3TC_DXT1_EXT,v=ce.RGBA_S3TC_DXT5_EXT,p=ce.RGBA_BPTC_UNORM_EXT,g=ce.RGB_BPTC_UNSIGNED_FLOAT_EXT;return t>=e&&r<=r||t>=o&&t<=s?this.canIUse(Z.astc):t===l?this.canIUse(Z.etc1):t>=u&&t<=c?this.canIUse(Z.etc):t>=d&&t<=_?this.canIUse(Z.pvrtc):t>=f&&t<=v?this.canIUse(Z.s3tc):t>=p&&t<=g?this.canIUse(Z.bptc):!1},i._init=function(){var t=this.capabilityList,e=this.rhi.isWebGL2,r=this.rhi.requireExtension.bind(this.rhi),o=Z.shaderVertexID,s=Z.standardDerivatives,l=Z.shaderTextureLod,u=Z.elementIndexUint,c=Z.depthTexture,d=Z.vertexArrayObject,_=Z.instancedArrays,f=Z.multipleSample,v=Z.drawBuffers,p=Z.astc,g=Z.astc_webkit,m=Z.etc,h=Z.etc_webkit,y=Z.etc1,A=Z.etc1_webkit,S=Z.pvrtc,x=Z.pvrtc_webkit,C=Z.s3tc,E=Z.s3tc_webkit,T=Z.bptc,w=Z.textureFloat,R=Z.textureHalfFloat,b=Z.textureFloatLinear,B=Z.textureHalfFloatLinear,I=Z.WEBGL_colorBufferFloat,V=Z.colorBufferFloat,L=Z.colorBufferHalfFloat,F=Z.textureFilterAnisotropic;t.set(o,e),t.set(s,e||!!r(s)),t.set(l,e||!!r(l)),t.set(u,e||!!r(u)),t.set(c,e||!!r(c)),t.set(d,e||!!r(d)),t.set(_,e||!!r(_)),t.set(f,e),t.set(v,e||!!r(v)),t.set(w,e||!!r(w)),t.set(R,e||!!r(R)),t.set(b,!!r(b)),t.set(B,e||!!r(B)),t.set(V,e&&!!r(V)||!!r(I)),t.set(L,e&&!!r(V)||!!r(L)),t.set(F,!!r(F)),t.set(p,!!(r(p)||r(g))),t.set(m,!!(r(m)||r(h))),t.set(y,!!(r(y)||r(A))),t.set(S,!!(r(S)||r(x))),t.set(C,!!(r(C)||r(E))),t.set(T,!!r(T))},i._compatibleInterface=function(t,e){var r=this.rhi,o=r.gl,s=null;if(s=r.requireExtension(t))for(var l in e){var u,c=e[l],d=s[c];(u=d)!=null&&u.bind?o[l]=d.bind(s):o[l]=d}},i._compatibleAllInterface=function(){var t=Z.depthTexture,e=Z.vertexArrayObject,r=Z.instancedArrays,o=Z.drawBuffers,s=Z.textureFilterAnisotropic,l=Z.textureHalfFloat,u=Z.colorBufferHalfFloat,c=Z.WEBGL_colorBufferFloat,d=this.rhi.isWebGL2;if(!d){this._compatibleInterface(t,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(e,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(r,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(o,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var _={};if(this.canIUse(Z.drawBuffers)){for(var f=this.maxDrawBuffers,v=0;v<f;v++)v!=0&&(_["COLOR_ATTACHMENT"+v]="COLOR_ATTACHMENT"+v+"_WEBGL"),_["DRAW_BUFFER"+v]="DRAW_BUFFER"+v+"_WEBGL";this._compatibleInterface(o,Zu({drawBuffers:"drawBuffersWEBGL"},_))}this._compatibleInterface(l,{HALF_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(u,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(c,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(s,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},fl(n,[{key:"maxTextureSize",get:function(){return this.rhi.renderStates.getParameter(this.rhi.gl.MAX_TEXTURE_SIZE)}},{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(Z.shaderVertexID)&&this.canIUse(Z.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(Z.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(Z.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var t=this._rhi.requireExtension(Z.textureFilterAnisotropic);this._maxAnisoLevel=t?this._rhi.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var t=this._rhi.gl,e=this.canIUse(Z.multipleSample);this._maxAntiAliasing=e?t.getParameter(t.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),n}(),pC=function(){function n(a){this.rhi=a,this._requireResult={}}var i=n.prototype;return i.requireExtension=function(t){return this._requireResult[t]!==void 0?this._requireResult[t]:(this._requireResult[t]=this.rhi.gl.getExtension(t),this._requireResult[t])},n}(),gC=function(){function n(a,t){this._attribLocArray=[],this._vaoMap=new Map,this._primitive=t,this._canUseInstancedArrays=a.canIUse(Z.instancedArrays),this._isSupportVAO=a.canIUse(Z.vertexArrayObject),this._gl=a.gl}var i=n.prototype;return i.draw=function(t,e){var r=this._gl,o=this._primitive,s=this._isSupportVAO&&o.enableVAO;if(s){o._bufferStructChanged&&this._clearVAO(),this._vaoMap.has(t.id)||this._registerVAO(t);var l=this._vaoMap.get(t.id);r.bindVertexArray(l)}else this._bindBufferAndAttrib(t);var u=o.indexBufferBinding,c=o.instanceCount,d=o._glIndexType,_=o._glIndexByteCount,f=e.topology,v=e.start,p=e.count;if(c)if(this._canUseInstancedArrays)if(u)if(s)r.drawElementsInstanced(f,p,d,v*_,c);else{var m=u.buffer._platformBuffer._glBuffer;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,m),r.drawElementsInstanced(f,p,d,v*_,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}else r.drawArraysInstanced(f,v,p,c);else ve.error("ANGLE_instanced_arrays extension is not supported");else if(u)if(s)r.drawElements(f,p,d,v*_);else{var g=u.buffer._platformBuffer._glBuffer;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,g),r.drawElements(f,p,d,v*_),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}else r.drawArrays(f,v,p);s?r.bindVertexArray(null):this._disableAttrib()},i.destroy=function(){this._isSupportVAO&&this._clearVAO()},i._bindBufferAndAttrib=function(t){var e=this._gl,r=this._primitive,o=r.vertexBufferBindings;this._attribLocArray.length=0;var s=t.attributeLocation,l=r._vertexElementMap,u,c;for(var d in s){var _=s[d];if(_!==-1){var f=l[d];if(f){var v=o[f.bindingIndex],p=v.buffer,g=v.stride;u=p._platformBuffer._glBuffer,c!==u&&(c=u,e.bindBuffer(e.ARRAY_BUFFER,u)),e.enableVertexAttribArray(_);var m=f._formatMetaInfo;e.vertexAttribPointer(_,m.size,m.type,m.normalized,g,f.offset),this._canUseInstancedArrays&&e.vertexAttribDivisor(_,f.instanceStepRate),this._attribLocArray.push(_)}else ve.warn("vertex attribute not found: "+d)}}e.bindBuffer(e.ARRAY_BUFFER,null)},i._disableAttrib=function(){for(var t=this._gl,e=0,r=this._attribLocArray.length;e<r;e++)t.disableVertexAttribArray(this._attribLocArray[e])},i._registerVAO=function(t){var e=this._gl,r=e.createVertexArray();e.bindVertexArray(r);var o=this._primitive.indexBufferBinding;o&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffer._platformBuffer._glBuffer),this._bindBufferAndAttrib(t),e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this._disableAttrib(),this._vaoMap.set(t.id,r)},i._clearVAO=function(){var t=this._gl;this._vaoMap.forEach(function(e){t.deleteVertexArray(e)}),this._vaoMap.clear()},n}(),mC=function(){function n(a){this._parameters={},this._gl=a,this._parameters={},this._parameters[a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_VERTEX_UNIFORM_VECTORS]=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[a.MAX_VERTEX_ATTRIBS]=a.getParameter(a.MAX_VERTEX_ATTRIBS),this._parameters[a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_TEXTURE_SIZE]=a.getParameter(a.MAX_TEXTURE_SIZE),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.colorMask(!0,!0,!0,!0),a.blendColor(0,0,0,0),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS),a.depthMask(!0),a.disable(a.STENCIL_TEST),a.stencilFuncSeparate(a.FRONT,a.ALWAYS,0,255),a.stencilFuncSeparate(a.BACK,a.ALWAYS,0,255),a.stencilOpSeparate(a.FRONT,a.KEEP,a.KEEP,a.KEEP),a.stencilOpSeparate(a.BACK,a.KEEP,a.KEEP,a.KEEP),a.stencilMask(255),a.enable(a.CULL_FACE),a.cullFace(a.BACK),a.disable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,0)}var i=n.prototype;return i.getParameter=function(t){return this._parameters[t]},n}(),Wt=function(){function n(a,t,e){this._texture=t,this._rhi=a,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=e,this._glTexture=this._gl.createTexture()}var i=n.prototype;return i.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},i.setUseDepthCompareMode=function(t){var e=this._gl;e.texParameteri(this._target,e.TEXTURE_COMPARE_MODE,t?e.COMPARE_REF_TO_TEXTURE:e.NONE)},i.generateMipmaps=function(){(this._texture.width!==1||this._texture.height!==1)&&(this._bind(),this._gl.generateMipmap(this._target))},i._bind=function(){this._rhi.bindTexture(this)},i._init=function(t){var e=this._gl,r=this._isWebGL2,o=this._formatDetail,s=o.internalFormat,l=o.baseFormat,u=o.dataType,c=this._texture,d=c.mipmapCount,_=c.width,f=c.height,v=c.usage,p=c._isDepthTexture;if(this._bind(),r&&!(l===e.LUMINANCE_ALPHA||l===e.ALPHA)&&v!==Vo.Dynamic)e.texStorage2D(this._target,d,s,_,f);else if(t)for(var y=0;y<d;y++)for(var A=Math.max(1,_>>y),S=0;S<6;S++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+S,y,s,A,A,0,l,u,null);else if(p)e.texImage2D(this._target,0,s,_,f,0,l,u,null);else for(var g=0;g<d;g++){var m=Math.max(1,_>>g),h=Math.max(1,f>>g);e.texImage2D(this._target,g,s,m,h,0,l,u,null)}},i._getPixelBuffer=function(t,e,r,o,s,l,u){var c=this._gl,d=this._formatDetail,_=d.baseFormat,f=d.dataType;c.bindFramebuffer(c.FRAMEBUFFER,this._getReadFrameBuffer()),l>0&&!this._isWebGL2&&(l=0,ve.error("mipLevel only take effect in WebGL2.0")),t!=null?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+t,this._glTexture,l):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this._glTexture,l),c.readPixels(e,r,o,s,_,f,u),c.bindFramebuffer(c.FRAMEBUFFER,null)},i._setWrapMode=function(t,e){var r=this._gl,o=this._isWebGL2,s=this._target,l=this._texture,u=l.width,c=l.height;switch(!o&&t!==$t.Clamp&&(!n._isPowerOf2(u)||!n._isPowerOf2(c))&&(ve.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),t=$t.Clamp),t){case $t.Clamp:r.texParameteri(s,e,r.CLAMP_TO_EDGE);break;case $t.Repeat:r.texParameteri(s,e,r.REPEAT);break;case $t.Mirror:r.texParameteri(s,e,r.MIRRORED_REPEAT);break}},i._getReadFrameBuffer=function(){var t=this._rhi._readFrameBuffer;return t||(this._rhi._readFrameBuffer=t=this._gl.createFramebuffer()),t},n._isPowerOf2=function(t){return(t&t-1)===0},n._getFormatDetail=function(t,e,r){switch(t){case X.R8G8B8:return{internalFormat:r?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case X.R8G8B8A8:return{internalFormat:r?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case X.R4G4B4A4:return{internalFormat:r?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case X.R5G5B5A1:return{internalFormat:r?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case X.R5G6B5:return{internalFormat:r?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case X.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case X.LuminanceAlpha:return{internalFormat:e.LUMINANCE_ALPHA,baseFormat:e.LUMINANCE_ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case X.R16G16B16A16:return{internalFormat:r?e.RGBA16F:e.RGBA,baseFormat:e.RGBA,dataType:e.HALF_FLOAT,isCompressed:!1};case X.R32G32B32A32:return{internalFormat:r?e.RGBA32F:e.RGBA,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};case X.BC1:return{internalFormat:ce.RGB_S3TC_DXT1_EXT,isCompressed:!0};case X.BC3:return{internalFormat:ce.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case X.BC7:return{internalFormat:ce.RGBA_BPTC_UNORM_EXT,isCompressed:!0};case X.ETC1_RGB:return{internalFormat:ce.RGB_ETC1_WEBGL,isCompressed:!0};case X.ETC2_RGB:return{internalFormat:ce.RGB8_ETC2,isCompressed:!0};case X.ETC2_RGBA5:return{internalFormat:ce.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case X.ETC2_RGBA8:return{internalFormat:ce.RGBA8_ETC2_EAC,isCompressed:!0};case X.PVRTC_RGB2:return{internalFormat:ce.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case X.PVRTC_RGBA2:return{internalFormat:ce.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case X.PVRTC_RGB4:return{internalFormat:ce.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case X.PVRTC_RGBA4:return{internalFormat:ce.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case X.ASTC_4x4:return{internalFormat:ce.RGBA_ASTC_4X4_KHR,isCompressed:!0};case X.ASTC_5x5:return{internalFormat:ce.RGBA_ASTC_5X5_KHR,isCompressed:!0};case X.ASTC_6x6:return{internalFormat:ce.RGBA_ASTC_6X6_KHR,isCompressed:!0};case X.ASTC_8x8:return{internalFormat:ce.RGBA_ASTC_8X8_KHR,isCompressed:!0};case X.ASTC_10x10:return{internalFormat:ce.RGBA_ASTC_10X10_KHR,isCompressed:!0};case X.ASTC_12x12:return{internalFormat:ce.RGBA_ASTC_12X12_KHR,isCompressed:!0};case X.Depth:return{internalFormat:r?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT,baseFormat:e.DEPTH_COMPONENT,dataType:r?e.FLOAT:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case X.DepthStencil:return{internalFormat:r?e.DEPTH32F_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:r?e.FLOAT_32_UNSIGNED_INT_24_8_REV:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case X.Depth16:return{internalFormat:r?e.DEPTH_COMPONENT16:e.DEPTH_COMPONENT,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case X.Depth24Stencil8:return{internalFormat:r?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case X.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case X.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case X.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Galacean Engine: "+t)}},n._getRenderBufferDepthFormatDetail=function(t,e,r){switch(t){case kt.Depth:return{internalFormat:r?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:r?e.FLOAT:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case kt.DepthStencil:return{internalFormat:r?e.DEPTH32F_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:r?e.FLOAT_32_UNSIGNED_INT_24_8_REV:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case kt.Stencil:return{internalFormat:e.STENCIL_INDEX8,baseFormat:e.STENCIL_ATTACHMENT,dataType:e.UNSIGNED_BYTE,isCompressed:!1,attachment:e.STENCIL_ATTACHMENT};case kt.Depth16:return{internalFormat:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case kt.Depth24Stencil8:return{internalFormat:r?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case kt.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case kt.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case kt.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Galacean Engine: "+t)}},n._supportTextureFormat=function(t,e){switch(t){case X.R16G16B16A16:if(!e.canIUse(Z.textureHalfFloat))return!1;break;case X.R32G32B32A32:if(!e.canIUse(Z.textureFloat))return!1;break;case X.Depth16:case X.Depth24Stencil8:case X.Depth:case X.DepthStencil:if(!e.canIUse(Z.depthTexture))return!1;break;case X.Depth24:case X.Depth32:case X.Depth32Stencil8:return e.isWebGL2}return!0},n._supportRenderBufferColorFormat=function(t,e){var r=!0;switch(t){case X.R16G16B16A16:(!e.canIUse(Z.colorBufferHalfFloat)||!e.canIUse(Z.textureHalfFloat))&&(r=!1);break;case X.R32G32B32A32:(!e.canIUse(Z.colorBufferFloat)||!e.canIUse(Z.textureFloat))&&(r=!1);break}return r},n._supportRenderBufferDepthFormat=function(t,e){if(!e.isWebGL2)switch(t){case kt.Depth24:case kt.Depth32:case kt.Depth32Stencil8:return!1}return!0},fl(n,[{key:"wrapModeU",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(t){var e=this._gl,r=this._target,o=this._texture._mipmap;switch(this._bind(),t){case tn.Point:e.texParameteri(r,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST);break;case tn.Bilinear:e.texParameteri(r,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR);break;case tn.Trilinear:e.texParameteri(r,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);break}}},{key:"anisoLevel",set:function(t){var e=this._gl;this._bind(),e.texParameterf(this._target,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},{key:"depthCompareFunction",set:function(t){this._bind();var e=this._gl;switch(t){case er.Never:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.NEVER);break;case er.Less:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.LESS);break;case er.Equal:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.EQUAL);break;case er.LessEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);break;case er.Greater:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.GREATER);break;case er.NotEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.NOTEQUAL);break;case er.GreaterEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.GEQUAL);break;case er.Always:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.ALWAYS);break}}}]),n}(),yC=function(){function n(a,t){this._MSAAColorRenderBuffers=[],this._curMipLevel=0,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=t;for(var e=t._colorTextures,r=t._depth,o=t.width,s=t.height,l=Gn(r,Zr),u=0,c=e.length;u<c;u++){var d=e[u]._format;if(!Wt._supportRenderBufferColorFormat(d,a))throw new Error("TextureFormat is not supported:"+X[d]+" in RenderTarget")}if(!l&&!Wt._supportRenderBufferDepthFormat(r,a))throw new Error("TextureFormat is not supported:"+X[r]+" in RenderTarget");if(e.length>1&&!a.canIUse(Z.drawBuffers))throw new Error("MRT is not supported");if(e.some(function(f){return f.width!==o||f.height!==s}))throw new Error("ColorTexture's size must as same as RenderTarget");if(l&&(r.width!==o||r.height!==s))throw new Error("DepthTexture's size must as same as RenderTarget");if(e.length>1&&e.some(function(f){return Gn(f,Tn)}))throw new Error("MRT+Cube+[,MSAA] is not supported");var _=a.capability.maxAntiAliasing;t.antiAliasing>_&&(ve.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+_),t._antiAliasing=_),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),t.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var i=n.prototype;return i.setRenderTargetInfo=function(t,e){var r=this,o=r._gl,s=r._target,l=s.depthTexture,u=s.getColorTexture(0),c=e!==this._curMipLevel;if(o.bindFramebuffer(o.FRAMEBUFFER,this._frameBuffer),u){var d=Gn(u,Tn);(c||d)&&o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,d?o.TEXTURE_CUBE_MAP_POSITIVE_X+t:o.TEXTURE_2D,u._platformTexture._glTexture,e)}if(l){var _=Gn(l,Tn);if(c||_){var f=l._platformTexture;o.framebufferTexture2D(o.FRAMEBUFFER,f._formatDetail.attachment,_?o.TEXTURE_CUBE_MAP_POSITIVE_X+t:o.TEXTURE_2D,f._glTexture,e)}}else if(c){var v=Wt._getRenderBufferDepthFormatDetail(s._depth,o,this._isWebGL2).internalFormat;o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,v,s.width>>e,s.height>>e)}this._curMipLevel=e,this._activeRenderTarget()},i.blitRenderTarget=function(){if(this._MSAAFrameBuffer){var t=this._gl,e=t.COLOR_BUFFER_BIT|(this._target.depthTexture?t.DEPTH_BUFFER_BIT:0),r=this._target,o=r.colorTextureCount,s=r.width,l=r.height;t.bindFramebuffer(t.READ_FRAMEBUFFER,this._MSAAFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this._frameBuffer);for(var u=0;u<o;u++){var c=t.COLOR_ATTACHMENT0+u;this._blitDrawBuffers[u]=c,t.readBuffer(c),t.drawBuffers(this._blitDrawBuffers),t.blitFramebuffer(0,0,s,l,0,0,s,l,e,t.NEAREST),this._blitDrawBuffers[u]=t.NONE}t.bindFramebuffer(t.FRAMEBUFFER,null)}},i.destroy=function(){var t=this._gl;this._frameBuffer&&t.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&t.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&t.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var e=0;e<this._MSAAColorRenderBuffers.length;e++)t.deleteRenderbuffer(this._MSAAColorRenderBuffers[e]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},i._activeRenderTarget=function(){var t=this._gl;this._MSAAFrameBuffer?t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer)},i._bindMainFBO=function(){var t=this._gl,e=this._isWebGL2,r=this._target,o=r._depth,s=r.colorTextureCount,l=r.width,u=r.height,c=new Array(s);t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);for(var d=0;d<s;d++){var _=this._target.getColorTexture(d),f=t.COLOR_ATTACHMENT0+d;c[d]=f,Gn(_,Tn)||t.framebufferTexture2D(t.FRAMEBUFFER,f,t.TEXTURE_2D,_._platformTexture._glTexture,0)}if(s>1&&t.drawBuffers(c),this._oriDrawBuffers=c,o!==null){if(Gn(o,Zr)&&!Gn(o,Tn)){var v=o._platformTexture;t.framebufferTexture2D(t.FRAMEBUFFER,v._formatDetail.attachment,t.TEXTURE_2D,v._glTexture,0)}else if(this._target.antiAliasing<=1){var p=Wt._getRenderBufferDepthFormatDetail(o,t,e),g=p.internalFormat,m=p.attachment,h=t.createRenderbuffer();this._depthRenderBuffer=h,t.bindRenderbuffer(t.RENDERBUFFER,h),t.renderbufferStorage(t.RENDERBUFFER,g,l,u),t.framebufferRenderbuffer(t.FRAMEBUFFER,m,t.RENDERBUFFER,h)}}t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},i._bindMSAAFBO=function(){var t=this._gl,e=this._isWebGL2,r=t.createRenderbuffer(),o=this._target,s=o._depth,l=o.colorTextureCount,u=o.antiAliasing,c=o.width,d=o.height;this._blitDrawBuffers=new Array(l),this._MSAADepthRenderBuffer=r,t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer);for(var _=0;_<l;_++){var f=t.createRenderbuffer();this._MSAAColorRenderBuffers[_]=f,this._blitDrawBuffers[_]=t.NONE,t.bindRenderbuffer(t.RENDERBUFFER,f),t.renderbufferStorageMultisample(t.RENDERBUFFER,u,this._target.getColorTexture(_)._platformTexture._formatDetail.internalFormat,c,d),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+_,t.RENDERBUFFER,f)}if(t.drawBuffers(this._oriDrawBuffers),s!==null){var v=Gn(s,Zr)?s._platformTexture._formatDetail:Wt._getRenderBufferDepthFormatDetail(s,t,e),p=v.internalFormat,g=v.attachment;t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorageMultisample(t.RENDERBUFFER,u,p,c,d),t.framebufferRenderbuffer(t.FRAMEBUFFER,g,t.RENDERBUFFER,r)}this._checkFrameBuffer(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},i._checkFrameBuffer=function(){var t=this._gl,e=this._isWebGL2,r=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(r){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(e&&r===t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},n}(),AC=function(n){Rc(i,n);function i(t,e){var r;r=n.call(this,t,e,t.gl.TEXTURE_2D)||this,r._compressedMipFilled=0;var o=e.format,s=e._mipmap,l=e.width,u=e.height,c=r._isWebGL2;if(!Wt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+X[o]);return s&&!c&&(!Wt._isPowerOf2(l)||!Wt._isPowerOf2(u))&&(ve.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),r._formatDetail=Wt._getFormatDetail(o,r._gl,c),r._formatDetail.isCompressed&&!c||r._init(!1),r}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u){r===void 0&&(r=0);var c=this._gl,d=this._isWebGL2,_=this._formatDetail,f=_.internalFormat,v=_.baseFormat,p=_.dataType,g=_.isCompressed,m=Math.max(1,this._texture.width>>r),h=Math.max(1,this._texture.height>>r);if(l=l||m-o,u=u||h-s,this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,0),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g){var y=1<<r;d||this._compressedMipFilled&y?c.compressedTexSubImage2D(this._target,r,o,s,l,u,f,e):(c.compressedTexImage2D(this._target,r,f,l,u,0,e),this._compressedMipFilled|=y)}else c.texSubImage2D(this._target,r,o,s,l,u,v,p,e)},a.setImageSource=function(e,r,o,s,l,u){var c=this._gl,d=this._formatDetail,_=d.internalFormat,f=d.baseFormat,v=d.dataType;this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,+o),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+s),this._texture.usage===Vo.Dynamic?c.texImage2D(this._target,r,_,f,v,e):c.texSubImage2D(this._target,r,l||0,u||0,f,v,e)},a.getPixelBuffer=function(e,r,o,s,l,u){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");n.prototype._getPixelBuffer.call(this,null,e,r,o,s,l,u)},i}(Wt),xC=function(n){Rc(i,n);function i(t,e){var r;r=n.call(this,t,e,t.gl.TEXTURE_2D_ARRAY)||this;var o=e.format,s=e.width,l=e.height,u=e.length,c=e.mipmapCount;if(!r._isWebGL2)throw new Error("Texture2D Array is not supported in WebGL1.0");if(!Wt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+X[o]);return r._bind(),r._formatDetail=Wt._getFormatDetail(o,r._gl,!0),r._gl.texStorage3D(r._target,c,r._formatDetail.internalFormat,s,l,u),r}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c,d){var _=this,f=_._target,v=_._gl,p=this._formatDetail,g=p.internalFormat,m=p.baseFormat,h=p.dataType,y=p.isCompressed;u=u||Math.max(1,this._texture.width>>o)-s,c=c||Math.max(1,this._texture.height>>o)-l,d=d||this._texture.length,this._bind(),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,0),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),y?v.compressedTexSubImage3D(f,o,s,l,e,u,c,d,g,r):v.texSubImage3D(f,o,s,l,e,u,c,d,m,h,r)},a.setImageSource=function(e,r,o,s,l,u,c){var d=this._gl,_=this._formatDetail,f=_.baseFormat,v=_.dataType;this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,+s),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l);var p,g;d.texSubImage3D(this._target,o,u,c,e,(p=r.width)!=null?p:r.codedWidth,(g=r.height)!=null?g:r.codedHeight,1,f,v,r)},a.getPixelBuffer=function(e,r,o,s,l,u,c){var d=this,_=d._gl,f=d._formatDetail;if(f.isCompressed)throw new Error("Unable to read compressed texture");_.bindFramebuffer(_.FRAMEBUFFER,this._getReadFrameBuffer()),_.framebufferTextureLayer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,this._glTexture,u,e),_.readPixels(r,o,s,l,f.baseFormat,f.dataType,c),_.bindFramebuffer(_.FRAMEBUFFER,null)},i}(Wt),SC=function(n){Rc(i,n);function i(t,e){var r;r=n.call(this,t,e,t.gl.TEXTURE_CUBE_MAP)||this,r._compressedFaceFilled=[0,0,0,0,0,0];var o=e.format,s=e._mipmap,l=e.width,u=r._isWebGL2;if(!Wt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+X[o]);return s&&!u&&!Wt._isPowerOf2(l)&&(ve.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),r._formatDetail=Wt._getFormatDetail(o,r._gl,u),r._formatDetail.isCompressed&&!u||r._init(!0),r}var a=i.prototype;return a.setPixelBuffer=function(e,r,o,s,l,u,c){var d=this._gl,_=this._isWebGL2,f=this._formatDetail,v=f.internalFormat,p=f.baseFormat,g=f.dataType,m=f.isCompressed,h=Math.max(1,this._texture.width>>o);if(u=u||h-s,c=c||h-l,this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,0),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),m){var y=1<<o;_||this._compressedFaceFilled[e]&y?d.compressedTexSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,v,r):(d.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,v,u,c,0,r),this._compressedFaceFilled[e]|=y)}else d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,p,g,r)},a.setImageSource=function(e,r,o,s,l,u,c){var d=this._gl,_=this._formatDetail,f=_.baseFormat,v=_.dataType;this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,+s),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,u||0,c||0,f,v,r)},a.getPixelBuffer=function(e,r,o,s,l,u,c){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");n.prototype._getPixelBuffer.call(this,e,r,o,s,l,u,c)},i}(Wt),Mv;(function(n){n[n.Auto=0]="Auto",n[n.WebGL2=1]="WebGL2",n[n.WebGL1=2]="WebGL1"})(Mv||(Mv={}));var CC=function(){function n(a){a===void 0&&(a={}),this._readFrameBuffer=null,this._enableGlobalDepthBias=!1,this._activeTextures=new Array(32),this._lastViewport=new ue(null,null,null,null),this._lastScissor=new ue(null,null,null,null),this._lastClearColor=new J(null,null,null,null),this._scissorEnable=!1;var t=Zu({webGLMode:0,stencil:!0,_forceFlush:!1,_maxAllowSkinUniformVectorCount:256},a);if(Ki.platform===cn.IPhone||Ki.platform===cn.IPad){var e=Ki.operatingSystem.match(/(\d+).?(\d+)?.?(\d+)?/);if(e){var r=parseInt(e[1]),o=parseInt(e[2]);r===15&&o>=0&&o<=4&&(t._forceFlush=!0)}}this._options=t,this._onWebGLContextLost=this._onWebGLContextLost.bind(this),this._onWebGLContextRestored=this._onWebGLContextRestored.bind(this)}var i=n.prototype;return i.init=function(t,e,r){var o=this._options,s=t._webCanvas,l=o.webGLMode;this._onDeviceLost=e,this._onDeviceRestored=r,s.addEventListener("webglcontextlost",this._onWebGLContextLost,!1),s.addEventListener("webglcontextrestored",this._onWebGLContextRestored,!1),s.addEventListener("webglcontextcreationerror",this._onContextCreationError,!1),this._webCanvas=s;var u;if((l==0||l==1)&&(u=s.getContext("webgl2",o),!u&&(typeof OffscreenCanvas>"u"||!Gn(s,OffscreenCanvas))&&(u=s.getContext("experimental-webgl2",o)),this._isWebGL2=!0,u&&!u.deleteQuery&&(this._isWebGL2=!1)),u||(l==0||l==2)&&(u=s.getContext("webgl",o),!u&&(typeof OffscreenCanvas>"u"||!Gn(s,OffscreenCanvas))&&(u=s.getContext("experimental-webgl",o)),this._isWebGL2=!1),!u)throw new Error("Get GL Context FAILED.");this._gl=u,this._initGLState(u)},i.createPlatformPrimitive=function(t){return new gC(this,t)},i.createPlatformTexture2D=function(t){return new AC(this,t)},i.createPlatformTexture2DArray=function(t){return new xC(this,t)},i.createPlatformTextureCube=function(t){return new SC(this,t)},i.createPlatformRenderTarget=function(t){return new yC(this,t)},i.createPlatformBuffer=function(t,e,r,o){return r===void 0&&(r=mt.Static),new hC(this,t,e,r,o)},i.requireExtension=function(t){return this._extensions.requireExtension(t)},i.canIUse=function(t){return this.capability.canIUse(t)},i.canIUseCompressedTextureInternalFormat=function(t){return this.capability.canIUseCompressedTextureInternalFormat(t)},i.viewport=function(t,e,r,o){var s=this,l=s._gl,u=s._lastViewport;(t!==u.x||e!==u.y||r!==u.z||o!==u.w)&&(l.viewport(t,e,r,o),u.set(t,e,r,o))},i.scissor=function(t,e,r,o){var s=this,l=s._gl,u=s._lastScissor;if(t!==u.x||e!==u.y||r!==u.z||o!==u.w){var c=this,d=c._webCanvas;t===0&&e===0&&r===d.width&&o===d.height?this._scissorEnable&&(l.disable(l.SCISSOR_TEST),this._scissorEnable=!1):(this._scissorEnable||(l.enable(l.SCISSOR_TEST),this._scissorEnable=!0),l.scissor(t,e,r,o)),u.set(t,e,r,o)}},i.colorMask=function(t,e,r,o){this._gl.colorMask(t,e,r,o)},i.clearRenderTarget=function(t,e,r){var o=this._gl,s=t._lastRenderState,l=s.blendState.targetBlendState,u=s.depthState,c=s.stencilState,d=0;if(e&Xn.Color){d|=o.COLOR_BUFFER_BIT;var _=this._lastClearColor,f=r.r,v=r.g,p=r.b,g=r.a;r&&(f!==_.r||v!==_.g||p!==_.b||g!==_.a)&&(o.clearColor(f,v,p,g),_.set(f,v,p,g)),l.colorWriteMask!==ar.All&&(o.colorMask(!0,!0,!0,!0),l.colorWriteMask=ar.All)}e&Xn.Depth&&(d|=o.DEPTH_BUFFER_BIT,u.writeEnabled!==!0&&(o.depthMask(!0),u.writeEnabled=!0)),e&Xn.Stencil&&(d|=o.STENCIL_BUFFER_BIT,c.writeMask!==255&&(o.stencilMask(255),c.writeMask=255)),o.clear(d)},i.drawPrimitive=function(t,e,r){t?t.draw(r,e):ve.error("draw primitive failed.")},i.activeRenderTarget=function(t,e,r){var o=this._gl,s,l;if(t){var u;(u=t._platformRenderTarget)==null||u._activeRenderTarget(),s=t.width>>r,l=t.height>>r}else o.bindFramebuffer(o.FRAMEBUFFER,null),s=o.drawingBufferWidth,l=o.drawingBufferHeight;var c=s*e.z,d=l*e.w,_=e.x*s,f=l-e.y*l-d;this.viewport(_,f,c,d),this.scissor(_,f,c,d)},i.activeTexture=function(t){this._activeTextureID!==t&&(this._gl.activeTexture(t),this._activeTextureID=t)},i.bindTexture=function(t){var e=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[e]!==t&&(this._gl.bindTexture(t._target,t._glTexture),this._activeTextures[e]=t)},i.setGlobalDepthBias=function(t,e){var r=this._gl,o=t!==0||e!==0;o?(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(e,t)):r.disable(r.POLYGON_OFFSET_FILL),this._enableGlobalDepthBias=o},i.flush=function(){this._gl.flush()},i.forceLoseDevice=function(){var t=this.requireExtension(Z.WEBGL_lose_context);t.loseContext()},i.forceRestoreDevice=function(){var t=this.requireExtension(Z.WEBGL_lose_context);t.restoreContext()},i.resetState=function(){this._readFrameBuffer=null,this._enableGlobalDepthBias=!1,this._currentBindShaderProgram=null;for(var t=this._activeTextures,e=0,r=t.length;e<r;e++)t[e]=null;this._lastViewport.set(null,null,null,null),this._lastScissor.set(null,null,null,null),this._lastClearColor.set(null,null,null,null),this._scissorEnable=!1,this._initGLState(this._gl)},i._initGLState=function(t){this._activeTextureID=t.TEXTURE0,this._renderStates=new mC(t),this._extensions=new pC(this),this._capability=new vC(this),t.activeTexture(t.TEXTURE0);var e=t.getExtension("WEBGL_debug_renderer_info");e!=null&&(this._renderer=t.getParameter(e.UNMASKED_RENDERER_WEBGL))},i.destroy=function(){var t=this._webCanvas;t.removeEventListener("webglcontextcreationerror",this._onContextCreationError,!1),t.removeEventListener("webglcontextlost",this._onWebGLContextLost,!1),t.removeEventListener("webglcontextrestored",this._onWebGLContextRestored,!1)},i._onContextCreationError=function(t){console.error("WebGLRenderer: WebGL context could not be created. Reason: ",t.statusMessage)},i._onWebGLContextLost=function(t){t.preventDefault(),this._onDeviceLost()},i._onWebGLContextRestored=function(t){this._onDeviceRestored()},fl(n,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"renderer",get:function(){return this._renderer}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),n}();function Pv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function EC(n,i,a){return i&&Pv(n.prototype,i),a&&Pv(n,a),n}var wC=function(){function n(a,t){var e=this;this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(a),this._worker.onmessage=function(r){var o=r.data;switch(o.type){case"decode":e._callbacks[o.id].resolve(o.geometry);break;case"error":e._callbacks[o.id].reject(o);break;default:ve.error('DRACOWorker: Unexpected message, "'+o.type+'"')}},t?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:t}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var i=n.prototype;return i.setCosts=function(t,e){this._costs[t]=e},i.addCurrentLoad=function(t){this._currentLoad+=t},i.setCallback=function(t,e,r){this._callbacks[t]={resolve:e,reject:r}},i.decode=function(t,e,r){this._worker.postMessage({type:"decode",id:t,taskConfig:e,buffer:r},[r])},i.releaseTask=function(t){this._currentLoad-=this._costs[t],delete this._callbacks[t],delete this._costs[t]},EC(n,[{key:"currentLoad",get:function(){return this._currentLoad}}]),n}(),Bv=`let decoderPending;
let decoderConfig;

onmessage = function(e) {
  const message = e.data;

  switch (message.type) {
    case "init":
      decoderConfig = message.decoderConfig;
      decoderPending = new Promise(function(resolve /*, reject*/) {
        decoderConfig.onModuleLoaded = function(draco) {
          // Module is Promise-like. Wrap before resolving to avoid loop.
          resolve({ draco: draco });
        };
        DracoDecoderModule(decoderConfig);
      });
      break;

    case "decode":
      const buffer = message.buffer;
      const taskConfig = message.taskConfig;
      decoderPending.then(module => {
        const draco = module.draco;
        const decoder = new draco.Decoder();
        const decoderBuffer = new draco.DecoderBuffer();
        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);
        try {
          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);
          const buffers = geometry.attributes.map(attr => attr.array.buffer);
          if (geometry.index) buffers.push(geometry.index.array.buffer);
          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);
        } catch (error) {
          console.error(error);
          self.postMessage({ type: "error", id: message.id, error: error.message });
        } finally {
          draco.destroy(decoderBuffer);
          draco.destroy(decoder);
        }
      });
      break;
  }
};

function decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {
  const attributeIDs = taskConfig.attributeIDs;
  const attributeTypes = taskConfig.attributeTypes;

  let dracoGeometry;
  let decodingStatus;

  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);
  if (geometryType === draco.TRIANGULAR_MESH) {
    dracoGeometry = new draco.Mesh();
    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);
  } else {
    throw new Error("DRACODecoder worker: Unexpected geometry type.");
  }

  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {
    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());
  }

  const geometry = { index: null, attributes: [] };

  // Gather all vertex attributes.
  for (let attributeName in attributeIDs) {
    const attributeType = self[attributeTypes[attributeName]];

    let attribute;
    let attributeID;

    // A Draco file may be created with default vertex attributes, whose attribute IDs
    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
    // a Draco file may contain a custom set of attributes, identified by known unique
    // IDs. glTF files always do the latter, and .drc files typically do the former.
    if (taskConfig.useUniqueIDs) {
      attributeID = attributeIDs[attributeName];
      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);
    } else {
      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);
      if (attributeID === -1) continue;
      attribute = decoder.GetAttribute(dracoGeometry, attributeID);
    }
    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));
  }
  // Add index.
  if (geometryType === draco.TRIANGULAR_MESH) {
    // Generate mesh faces.
    const numFaces = dracoGeometry.num_faces();
    const numIndices = numFaces * 3;
    let dataSize;
    let ptr;
    let index;
    const indexType = self[taskConfig.indexType];

    switch (indexType) {
      case Uint16Array:
        dataSize = numIndices * 2;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);
        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      case Uint32Array:
        dataSize = numIndices * 4;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);
        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      default:
        throw new Error("DRACODecoder: Unexpected index type.");
    }
    geometry.index = { array: index, itemSize: 1 };
  }
  draco.destroy(dracoGeometry);
  return geometry;
}

function decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {
  const numComponents = attribute.num_components();
  const numPoints = dracoGeometry.num_points();
  const numValues = numPoints * numComponents;
  let ptr;
  let array;
  let dataSize;
  switch (attributeType) {
    case Float32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);
      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);
      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);
      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);
      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);
      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);
      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);
      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    default:
      throw new Error("DRACODecoder: Unexpected attribute type.");
  }

  return {
    name: attributeName,
    array: array,
    itemSize: numComponents
  };
}
`,ld="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",TC="draco_decoder_gltf.js",RC="draco_decoder_gltf.r3bin",MC="draco_wasm_wrapper_gltf.js",PC=function(){function n(a){if(a===void 0&&(a={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.currentTaskId=1,this.taskCache=new WeakMap,a.workerLimit>this.workerLimit)ve.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+a.workerLimit);else{var t;this.workerLimit=(t=a.workerLimit)!=null?t:4}this.useJS=typeof WebAssembly!="object"||a.type==="js",this.loadLibPromise=this.preloadLib()}var i=n.prototype;return i.preloadLib=function(){var t=this;return this.loadLibPromise?this.loadLibPromise:new Promise(function(e,r){t.useJS?Nr(""+ld+TC,{type:"text"}).then(function(o){var s=[o,Bv].join(`
`),l=URL.createObjectURL(new Blob([s]));e({workerSourceURL:l,decoderWASMBinary:null})}).catch(function(o){r(o)}):Promise.all([Nr(""+ld+MC,{type:"text"}),Nr(""+ld+RC,{type:"arraybuffer"})]).then(function(o){var s=o[0],l=o[1],u=[s,Bv].join(`
`),c=URL.createObjectURL(new Blob([u]));e({workerSourceURL:c,decoderWASMBinary:l})}).catch(function(o){r(o)})})},i.getWorker=function(){var t=this;return this.preloadLib().then(function(e){if(t.pool.length<t.workerLimit){var r=new wC(e.workerSourceURL,e.decoderWASMBinary);t.pool.push(r)}else t.pool.sort(function(o,s){return o.currentLoad>s.currentLoad?-1:1});return t.pool[t.pool.length-1]})},i.decode=function(t,e){var r=this,o=JSON.stringify(e);if(this.taskCache.has(t)){var s=this.taskCache.get(t);if(s.key===o)return s.promise;if(t.byteLength===0)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.currentTaskId++,u=t.byteLength,c,d=new Promise(function(_,f){r.getWorker().then(function(v){c=v,v.setCosts(l,u),v.addCurrentLoad(u),v.setCallback(l,_,f),v.decode(l,e,t)}).catch(function(v){f(v)})});return d.finally(function(){c&&l&&c.releaseTask(l)}),this.taskCache.set(t,{key:o,promise:d}),d},n}();function mn(){return mn=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},mn.apply(this,arguments)}function Ku(n,i){return Ku=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ku(n,i)}function de(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&Ku(n,i)}function pe(n,i,a,t){var e=arguments.length,r=e<3?i:t===null?t=Object.getOwnPropertyDescriptor(i,a):t,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,i,a,t);else for(var s=n.length-1;s>=0;s--)(o=n[s])&&(r=(e<3?o(r):e>3?o(i,a,r):o(i,a))||r);return e>3&&r&&Object.defineProperty(i,a,r),r}function Mc(n,i){var a={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},t,e,r,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(t=1,e&&(r=u[0]&2?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,e=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){a=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(u[0]===6&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=i.call(n,a)}catch(c){u=[6,c],e=0}finally{t=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function bv(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function kf(n,i,a){return i&&bv(n.prototype,i),a&&bv(n,a),n}var $a=function(){function n(a,t,e,r){t===void 0&&(t=0),r===void 0&&(r=!0),this.data=a,this._dataView=new DataView(a.buffer,a.byteOffset+t,e??a.byteLength-t),this._littleEndian=r,this._position=0,this._baseOffset=t}var i=n.prototype;return i.nextUint8=function(){var t=this._dataView.getUint8(this._position);return this._position+=1,t},i.nextUint16=function(){var t=this._dataView.getUint16(this._position,this._littleEndian);return this._position+=2,t},i.nextUint32=function(){var t=this._dataView.getUint32(this._position,this._littleEndian);return this._position+=4,t},i.nextInt32=function(){var t=this._dataView.getInt32(this._position,this._littleEndian);return this._position+=4,t},i.nextInt32Array=function(t){var e=new Int32Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=4*t,e},i.nextFloat32=function(){var t=this._dataView.getFloat32(this._position,this._littleEndian);return this._position+=4,t},i.nextFloat32Array=function(t){var e=new Float32Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=4*t,e},i.nextUint32Array=function(t){var e=new Uint32Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=4*t,e},i.nextUint8Array=function(t){var e=new Uint8Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=t,e},i.nextUint64=function(){var t=this._dataView.getUint32(this._position,this._littleEndian),e=this._dataView.getUint32(this._position+4,this._littleEndian),r=t+Math.pow(2,32)*e;return this._position+=8,r},i.nextStr=function(){var t=this.nextUint16(),e=new Uint8Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=t,yt.decodeText(e)},i.nextImageData=function(t){return new Uint8Array(this.data.buffer,this.data.byteOffset+this._position)},i.nextImagesData=function(t){for(var e=new Array(t),r=0;r<t;r++){var o=this._dataView.getUint32(this._position,this._littleEndian);e[r]=o,this._position+=4}for(var s=[],l=0;l<t;l++){var u=e[l],c=new Uint8Array(this.data.buffer,this._dataView.byteOffset+this._position,u);this._position+=u,s.push(c)}return s},i.skip=function(t){return this._position+=t,this},i.scan=function(t,e){e===void 0&&(e=0);for(var r=this._position,o=0;this._dataView.getUint8(this._position)!==e&&o<t;)o++,this._position++;return o<t&&this._position++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,o)},kf(n,[{key:"position",get:function(){return this._position}},{key:"offset",get:function(){return this._position+this._baseOffset}}]),n}(),Em={};function Gf(n){return function(i){Em[n]=i}}var BC=function(){function n(){this.totalLength=0,this.version=0,this.type="",this.name="",this.headerLength=0}return n.decode=function(a){var t=new DataView(a),e=t.getUint32(0,!0),r=t.getUint8(4),o=t.getUint16(5,!0),s=new Uint8Array(a,7,o),l=t.getUint16(7+o,!0),u=new Uint8Array(a,9+o,l),c=yt.decodeText(u),d=yt.decodeText(s),_=new n;return _.totalLength=e,_.name=c,_.type=d,_.version=r,_.headerLength=u.byteLength+s.byteLength+9,_},kf(n,[{key:"dataLength",get:function(){return this.totalLength-this.headerLength}}]),n}(),Dv=function(){function n(){}return n.decode=function(a,t){return new Promise(function(e){var r=new Nt(a),o=t.nextStr(),s=JSON.parse(o);s.bounds&&r.bounds.copyFrom(s.bounds);var l=Math.ceil(t.offset/4)*4+t.data.byteOffset,u=t.data.buffer,c=new Float32Array(u,s.positions.start+l,(s.positions.end-s.positions.start)/4),d=c.length/3,_=Yl(c,d);if(r.setPositions(_),s.normals){var f=new Float32Array(u,s.normals.start+l,(s.normals.end-s.normals.start)/4),v=Yl(f,d);r.setNormals(v)}if(s.uvs){var p=new Float32Array(u,s.uvs.start+l,(s.uvs.end-s.uvs.start)/4);r.setUVs(Li(p,d))}if(s.uv1){var g=new Float32Array(u,s.uv1.start+l,(s.uv1.end-s.uv1.start)/4);r.setUVs(Li(g,d),1)}if(s.uv2){var m=new Float32Array(u,s.uv2.start+l,(s.uv2.end-s.uv2.start)/4);r.setUVs(Li(m,d),2)}if(s.uv3){var h=new Float32Array(u,s.uv3.start+l,(s.uv3.end-s.uv3.start)/4);r.setUVs(Li(h,d),3)}if(s.uv4){var y=new Float32Array(u,s.uv4.start+l,(s.uv4.end-s.uv4.start)/4);r.setUVs(Li(y,d),4)}if(s.uv5){var A=new Float32Array(u,s.uv5.start+l,(s.uv5.end-s.uv5.start)/4);r.setUVs(Li(A,d),5)}if(s.uv6){var S=new Float32Array(u,s.uv6.start+l,(s.uv6.end-s.uv6.start)/4);r.setUVs(Li(S,d),6)}if(s.uv7){var x=new Float32Array(u,s.uv7.start+l,(s.uv7.end-s.uv7.start)/4);r.setUVs(Li(x,d),7)}if(s.colors){var C=new Float32Array(u,s.colors.start+l,(s.colors.end-s.colors.start)/4);r.setColors(bC(C,d))}if(s.boneWeights){var E=new Float32Array(u,s.boneWeights.start+l,(s.boneWeights.end-s.boneWeights.start)/4);r.setBoneWeights(ud(E,d))}if(s.boneIndices){var T=new Float32Array(u,s.boneIndices.start+l,(s.boneIndices.end-s.boneIndices.start)/4);r.setBoneIndices(ud(T,d))}if(s.blendShapes&&s.blendShapes.forEach(function(R){var b=new Lf(R.name);R.frames.forEach(function(B){var I=new Float32Array(u,B.deltaPosition.start+l,(B.deltaPosition.end-B.deltaPosition.start)/4),V=I.length/3,L=Yl(I,V);if(B.deltaNormals){var F=new Float32Array(u,B.deltaNormals.start+l,(B.deltaNormals.end-B.deltaNormals.start)/4);Yl(F,V)}if(B.deltaTangents){var D=new Float32Array(u,B.deltaTangents.start+l,(B.deltaTangents.end-B.deltaTangents.start)/4);ud(D,V)}b.addFrame(B.weight,L)}),r.addBlendShape(b)}),s.indices){var w=null;s.indices.type===0?w=new Uint16Array(u,s.indices.start+l,(s.indices.end-s.indices.start)/2):w=new Uint32Array(u,s.indices.start+l,(s.indices.end-s.indices.start)/4),r.setIndices(w)}s.subMeshes.forEach(function(R){return r.addSubMesh(R)}),r.uploadData(!1),e(r)})},n}();Dv=pe([Gf("Mesh")],Dv);function bC(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new J(n[t*4],n[t*4+1],n[t*4+2],n[t*4+3]);return a}function ud(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new ue(n[t*4],n[t*4+1],n[t*4+2],n[t*4+3]);return a}function Yl(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new M(n[t*3],n[t*3+1],n[t*3+2]);return a}function Li(n,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new te(n[t*2],n[t*2+1]);return a}var Lv=function(){function n(){}return n.decode=function(a,t){return new Promise(function(e,r){var o=t.nextStr(),s=!!t.nextUint8(),l=t.nextUint8(),u=t.nextUint8(),c=t.nextUint8(),d=t.nextUint8(),_=t.nextUint8(),f=t.nextUint16(),v=t.nextUint16(),p=t.nextUint8(),g=t.nextUint8(),m=t.nextImagesData(g),h=new fn(a,f,v,_,s);if(h.filterMode=l,h.anisoLevel=u,h.wrapModeU=c,h.wrapModeV=d,p){var y=m[0];if(h.setPixelBuffer(y),s){h.generateMipmaps();for(var A=1;A<g;A++){var S=m[A];h.setPixelBuffer(S,A)}}a.resourceManager._objectPool[o]=h,e(h)}else{var x=new window.Blob([m[0]]),C=new Image;C.onload=function(){h.setImageSource(C);var E=0,T=function(){E++,E>=g&&e(h)};if(T(),s){var w=function(b){var B=new window.Blob([m[b]]),I=new Image;I.onload=function(){h.setImageSource(I,b),T()},I.src=URL.createObjectURL(B)};h.generateMipmaps();for(var R=1;R<g;R++)w(R)}},C.src=URL.createObjectURL(x)}})},n}();Lv=pe([Gf("Texture2D")],Lv);function DC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function uu(n,i,a){return DC()?uu=Reflect.construct:uu=function(e,r,o){var s=[null];s.push.apply(s,r);var l=Function.bind.apply(e,s),u=new l;return o&&Ku(u,o.prototype),u},uu.apply(null,arguments)}var Hf=function(){function n(a){this._context=a}var i=n.prototype;return i.parseEntity=function(t){return this._getEntityByConfig(t).then(function(e){var r;e.isActive=(r=t.isActive)!=null?r:!0;var o=t.position,s=t.rotation,l=t.scale;return o&&e.transform.position.copyFrom(o),s&&e.transform.rotation.copyFrom(s),l&&e.transform.scale.copyFrom(l),e})},i.parseClassObject=function(t){var e=this,r=ke.getClass(t.class),o,s=(o=t.constructParams)!=null?o:[];return Promise.all(s.map(function(l){return e.parseBasicType(l)})).then(function(l){return uu(r,[].concat(l))}).then(function(l){return e.parsePropsAndMethods(l,t)})},i.parsePropsAndMethods=function(t,e){var r=[];if(e.methods)for(var o in e.methods)for(var s=e.methods[o],l=0,u=s.length;l<u;l++)r.push(this.parseMethod(t,o,s[l]));if(e.props){var c=this,d=function(f){var v=e.props[f],p=c.parseBasicType(v,t[f]).then(function(g){return t[f]=g});r.push(p)};for(var _ in e.props)d(_)}return Promise.all(r).then(function(){var f=n.customParseComponentHandles[t.constructor.name];return f?f(t,e):t})},i.parseMethod=function(t,e,r){var o=this;return Promise.all(r.map(function(s){return o.parseBasicType(s)})).then(function(s){var l;return(l=t)[e].apply(l,[].concat(s))})},i.parseBasicType=function(t,e){var r=this;if(Array.isArray(t))return Promise.all(t.map(function(c){return r.parseBasicType(c)}));if(typeof t=="object"&&t!=null){if(n._isClass(t))return this.parseClassObject(t);if(n._isAssetRef(t))return this._context.resourceManager.getResourceByRef(t);if(n._isEntityRef(t))return Promise.resolve(this._context.entityMap.get(t.entityId));if(e){var o=this,s=function(c){if(c==="methods"){var d=t[c];for(var _ in d)for(var f=d[_],v=0,p=f.length;v<p;v++){var g=f[v],m=o.parseMethod(e,_,g);l.push(m)}}else l.push(o.parseBasicType(t[c],e[c]).then(function(h){return e[c]=h}))},l=[];for(var u in t)s(u);return Promise.all(l).then(function(){return e})}}return Promise.resolve(t)},i._getEntityByConfig=function(t){var e=t.assetRefId,r=this._context.engine;if(e)return r.resourceManager.getResourceByRef({refId:e,key:t.key,isClone:t.isClone}).then(function(s){return s.name=t.name,s});var o=new Br(r,t.name);return Promise.resolve(o)},n.registerCustomParseComponent=function(t,e){this.customParseComponentHandles[t]=e},n._isClass=function(t){return t.class!=null},n._isAssetRef=function(t){return t.refId!=null},n._isEntityRef=function(t){return t.entityId!=null},n}();(function(){Hf.customParseComponentHandles=new Map})();var LC=function(){function n(){}return n.parseChildren=function(a,t,e){var r=a.get(e).children;if(r&&r.length>0)for(var o=t.get(e),s=0;s<r.length;s++){var l=r[s],u=t.get(l);o.addChild(u),this.parseChildren(a,t,l)}},n}(),IC={Transform:ye,Animator:Ur,DirectLight:aa,Camera:et,MeshRenderer:en,ParticleRenderer:gn,PointLight:da,SpotLight:hr,Script:Tt,SpriteMask:an,SpriteRenderer:je,TextRenderer:dt},Iv;(function(n){n[n.Float=0]="Float",n[n.FloatArray=1]="FloatArray",n[n.Vector2=2]="Vector2",n[n.Vector3=3]="Vector3",n[n.Vector4=4]="Vector4",n[n.Quaternion=5]="Quaternion",n[n.Color=6]="Color",n[n.Array=7]="Array",n[n.Boolean=8]="Boolean",n[n.Rect=9]="Rect",n[n.ReferResource=10]="ReferResource"})(Iv||(Iv={}));var Vv=function(){function n(){}return n.decode=function(a,t){return new Promise(function(e){for(var r=t.nextStr(),o=new Vf(r),s=t.nextUint16(),l=0;l<s;++l){var u=new Tc;u.time=t.nextFloat32(),u.functionName=t.nextStr(),u.parameter=JSON.parse(t.nextStr()).val,o.addEvent(u)}for(var c=t.nextUint16(),d=0;d<c;++d){var _=t.nextStr(),f=t.nextStr(),v=IC[f],p=t.nextStr(),g=void 0,m=t.nextUint8(),h=t.nextUint16(),y=t.nextStr();switch(y){case"AnimationFloatCurve":{g=new Qu,g.interpolation=m;for(var A=0;A<h;++A){var S=new Un;S.time=t.nextFloat32(),S.value=t.nextFloat32(),S.inTangent=t.nextFloat32(),S.outTangent=t.nextFloat32(),g.addKey(S)}break}case"AnimationArrayCurve":{g=new Hu,g.interpolation=m;for(var x=0;x<h;++x){var C=new Un;C.time=t.nextFloat32();var E=t.nextUint16();C.value=Array.from(t.nextFloat32Array(E)),C.inTangent=Array.from(t.nextFloat32Array(E)),C.outTangent=Array.from(t.nextFloat32Array(E)),g.addKey(C)}break}case"AnimationFloatArrayCurve":{g=new Zs,g.interpolation=m;for(var T=0;T<h;++T){var w=new Un;w.time=t.nextFloat32();var R=t.nextUint16();w.value=t.nextFloat32Array(R),w.inTangent=Array.from(t.nextFloat32Array(R)),w.outTangent=Array.from(t.nextFloat32Array(R)),g.addKey(w)}break}case"AnimationVector2Curve":{g=new Xu,g.interpolation=m;for(var b=0;b<h;++b){var B=new Un;B.time=t.nextFloat32(),B.value=new te(t.nextFloat32(),t.nextFloat32()),B.inTangent=new te(t.nextFloat32(),t.nextFloat32()),B.outTangent=new te(t.nextFloat32(),t.nextFloat32()),g.addKey(B)}break}case"AnimationVector3Curve":{g=new Ks,g.interpolation=m;for(var I=0;I<h;++I){var V=new Un;V.time=t.nextFloat32(),V.value=new M(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),V.inTangent=new M(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),V.outTangent=new M(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),g.addKey(V)}break}case"AnimationVector4Curve":{g=new ju,g.interpolation=m;var L=new Un;L.time=t.nextFloat32(),L.value=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),L.inTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),L.outTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),g.addKey(L);break}case"AnimationColorCurve":{g=new Wu,g.interpolation=m;for(var F=0;F<h;++F){var D=new Un;D.time=t.nextFloat32(),D.value=new J(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),D.inTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),D.outTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),g.addKey(D)}break}case"AnimationQuaternionCurve":{g=new ko,g.interpolation=m;for(var N=0;N<h;++N){var O=new Un;O.time=t.nextFloat32(),O.value=new xe(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),O.inTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),O.outTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),g.addKey(O)}break}case"AnimationRefCurve":{g=new Yu,g.interpolation=m;for(var k=0;k<h;++k){var Q=new Un;Q.time=t.nextFloat32(),Q.value=JSON.parse(t.nextStr()),g.addKey(Q)}break}}o.addCurveBinding(_,v,p,g)}e(o)})},n}();Vv=pe([Gf("AnimationClip")],Vv);var Nv;(function(n){n.Sky="Sky",n.Custom="Custom"})(Nv||(Nv={}));function Fv(n,i){(i==null||i>n.length)&&(i=n.length);for(var a=0,t=new Array(i);a<i;a++)t[a]=n[a];return t}function VC(n,i){if(n){if(typeof n=="string")return Fv(n,i);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fv(n,i)}}function Cs(n,i){var a=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(a)return(a=a.call(n)).next.bind(a);if(Array.isArray(n)||(a=VC(n))||i&&n&&typeof n.length=="number"){a&&(n=a);var t=0;return function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var NC=function(){function n(a,t){this.originalData=a,this.scene=t,this.entityMap=new Map,this.components=new Map,this.assets=new Map,this.entityConfigMap=new Map,this.rootIds=[],this.engine=t.engine,this.resourceManager=t.engine.resourceManager}var i=n.prototype;return i.destroy=function(){this.entityMap.clear(),this.components.clear(),this.assets.clear(),this.entityConfigMap.clear(),this.rootIds.length=0},n}(),FC=function(){function n(a){var t=this;this.context=a,this._engine=a.scene.engine,this._organizeEntities=this._organizeEntities.bind(this),this._parseComponents=this._parseComponents.bind(this),this._clearAndResolveScene=this._clearAndResolveScene.bind(this),this.promise=new Promise(function(e,r){t._reject=r,t._resolve=e}),this._reflectionParser=new Hf(a)}var i=n.prototype;return i.start=function(){this._parseEntities().then(this._organizeEntities).then(this._parseComponents).then(this._clearAndResolveScene).then(this._resolve).catch(this._reject)},i._parseEntities=function(){var t=this,e=this.context.originalData.entities,r=this.context.entityConfigMap,o=this.context.entityMap,s=this.context.rootIds;this._engine;var l=e.map(function(u){return r.set(u.id,u),u.parent||s.push(u.id),t._reflectionParser.parseEntity(u)});return Promise.all(l).then(function(u){for(var c=0,d=u.length;c<d;c++)o.set(e[c].id,u[c]);return u})},i._organizeEntities=function(){for(var t=this.context,e=t.entityConfigMap,r=t.entityMap,o=t.scene,s=t.rootIds,l=Cs(s),u;!(u=l()).done;){var c=u.value;LC.parseChildren(e,r,c)}for(var d=s.map(function(f){return r.get(f)}),_=0;_<d.length;_++)o.addRootEntity(d[_])},i._parseComponents=function(){for(var t=this.context.originalData.entities,e=this.context.entityMap,r=[],o=0,s=t.length;o<s;o++)for(var l=t[o],u=e.get(l.id),c=0;c<l.components.length;c++){var d=l.components[c],_=d.refId?d.refId:d.class,f=void 0;_==="Animator"&&(f=u.getComponent(ke.getClass(_))),f=f||u.addComponent(ke.getClass(_));var v=this._reflectionParser.parsePropsAndMethods(f,d);r.push(v)}return Promise.all(r)},i._clearAndResolveScene=function(){var t=this.context.scene;return this.context.destroy(),t},n.parse=function(t,e){var r=new ja(t),o=new NC(e,r),s=new n(o);return s.start(),s.promise},n}(),Ov=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){Pc(u,r.engine).then(function(c){s(c)})}).catch(l)})},i}(ke);Ov=pe([ct("Mesh",["prefab"],!0)],Ov);var zv=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){Pc(u,r.engine).then(function(c){s(c)})}).catch(l)})},i}(ke);zv=pe([ct("EditorTexture2D",["prefab"],!0)],zv);function Pc(n,i){var a=BC.decode(n),t=new $a(new Uint8Array(n),a.headerLength,a.dataLength);return Em[a.type].decode(i,t).then(function(e){return e.name=a.name,e})}var Uv=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,mn({},e,{type:"arraybuffer"})).then(function(u){return Pc(u,r.engine).then(function(c){var d=c.curveBindings.map(function(_){var f=_.curve,v=f.keys.map(function(p){var g=p.value;if(typeof g=="object"&&g.refId)return new Promise(function(m){r.getResourceByRef(g).then(function(h){p.value=h,m(p)}).catch(l)})});return Promise.all(v)});return Promise.all(d).then(function(){s(c)})})}).catch(l)})},i}(ke);Uv=pe([ct(De.AnimationClip,["ani"])],Uv);var kv=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,mn({},e,{type:"json"})).then(function(u){var c=new Ff,d=u.layers,_=[];d.forEach(function(f,v){var p=f.name,g=f.blendingMode,m=f.weight,h=f.stateMachine,y=new Of(p);if(y.blendingMode=g,y.weight=m,h){var A=h.states,S=y.stateMachine=new zf;A.forEach(function(x,C){var E,T=x.name,w=x.speed,R=x.wrapMode,b=x.clipStartNormalizedTime,B=x.clipEndNormalizedTime,I=x.isDefaultState,V=x.clip,L=x.scripts,F=S.addState(T);I&&(S.defaultState=F),F.speed=w,F.wrapMode=R,F.clipStartTime=b,F.clipEndTime=B;var D=JSON.parse(L);(E=D)==null||E.forEach(function(N){F.addStateMachineScript(ke.getClass(N))}),V&&_.push(new Promise(function(N){r.getResourceByRef(V).then(function(O){N({layerIndex:v,stateIndex:C,clip:O})})}))}),A.forEach(function(x){var C=x.name,E=x.transitions;E.forEach(function(T){var w=T.targetStateName,R=T.duration,b=T.offset,B=T.exitTime,I=S.findStateByName(C),V=S.findStateByName(w),L=new Nf;L.destinationState=V,L.duration=R,L.exitTime=B,L.offset=b,I.addTransition(L)})})}c.addLayer(y)}),Promise.all(_).then(function(f){f.forEach(function(v){var p=v.layerIndex,g=v.stateIndex,m=v.clip;c.layers[p].stateMachine.states[g].clip=m}),s(c)})}).catch(l)})},i}(ke);kv=pe([ct(De.AnimatorController,["json"],!1)],kv);function OC(n){return/^data:(.+?);base64,/.test(n)}var Gv=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e){var r=e.url;return OC(r)?new Oe(function(o){var s=r.slice(13+RegExp.$1.length),l=Uint8Array.from(atob(s),function(u){return u.charCodeAt(0)});o(l.buffer)}):this.request(r,mn({},e,{type:"arraybuffer"}))},i}(ke);Gv=pe([ct(De.Buffer,["bin","r3bin"],!1)],Gv);var Hv=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){var c,d=new Float32Array(u,0,27),_=27*4,f=(c=new Uint16Array(u,_,1))==null?void 0:c[0],v=r.engine,p=new Tn(v,f);p.filterMode=tn.Trilinear;for(var g=p.mipmapCount,m=_+2,h=0;h<g;h++)for(var y=f>>h,A=0;A<6;A++){var S=y*y*4,x=new Uint8Array(u,m,S);m+=S,p.setPixelBuffer(fr.PositiveX+A,x,h)}var C=new vr(v),E=new l1;C.diffuseMode=Ga.SphericalHarmonics,E.copyFromArray(d),C.diffuseSphericalHarmonics=E,C.specularTexture=p,C.specularTextureDecodeRGBM=!0,s(C)}).catch(function(u){l(u)})})},i}(ke);Hv=pe([ct(De.Env,["env"])],Hv);function Wv(n,i,a,t,e,r,o){try{var s=n[r](o),l=s.value}catch(u){a(u);return}s.done?i(l):Promise.resolve(l).then(t,e)}function Bc(n){return function(){var i=this,a=arguments;return new Promise(function(t,e){var r=n.apply(i,a);function o(l){Wv(r,t,e,o,s,"next",l)}function s(l){Wv(r,t,e,o,s,"throw",l)}o(void 0)})}}var Qv=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,{type:"json"}).then(function(u){var c=u.fontName,d=u.fontUrl;if(d)o._registerFont(c,d).then(function(){var f=new No(r.engine,c);s(f)}).catch(function(f){l("load font "+d+" fail")});else{var _=new No(r.engine,c);s(_)}}).catch(function(u){l(u)})})},a._registerFont=function(e,r){return Bc(function(){var o;return Mc(this,function(s){switch(s.label){case 0:return o=new FontFace(e,"url("+r+")"),[4,o.load()];case 1:return s.sent(),document.fonts.add(o),[2]}})})()},i}(ke);Qv=pe([ct(De.Font,["font"],!1)],Qv);var zC=function(n){de(i,n);function i(a,t){var e;return e=n.call(this,a)||this,e.url=t,e}return i}(ni),Ct;(function(n){n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT"})(Ct||(Ct={}));var Xr;(function(n){n.SCALAR="SCALAR",n.VEC2="VEC2",n.VEC3="VEC3",n.VEC4="VEC4",n.MAT2="MAT2",n.MAT3="MAT3",n.MAT4="MAT4"})(Xr||(Xr={}));var Wr;(function(n){n.TRANSLATION="translation",n.ROTATION="rotation",n.SCALE="scale",n.WEIGHTS="weights"})(Wr||(Wr={}));var fo;(function(n){n.Linear="LINEAR",n.Step="STEP",n.CubicSpine="CUBICSPLINE"})(fo||(fo={}));var $u;(function(n){n.PERSPECTIVE="perspective",n.ORTHOGRAPHIC="orthographic"})($u||($u={}));var Xv;(function(n){n.JPEG="image/jpeg",n.PNG="image/png"})(Xv||(Xv={}));var Es;(function(n){n.OPAQUE="OPAQUE",n.MASK="MASK",n.BLEND="BLEND"})(Es||(Es={}));var C_;(function(n){n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR"})(C_||(C_={}));var ec;(function(n){n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(ec||(ec={}));var ws;(function(n){n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.REPEAT=10497]="REPEAT"})(ws||(ws={}));var Wf=function(){function n(a,t,e){this.glTFResource=a,this.resourceManager=t,this.params=e,this.accessorBufferCache={},this._resourceCache=new Map,this.contentRestorer=new YC(a)}var i=n.prototype;return i.get=function(t,e){var r=this,o=n._parsers[t];if(!o)return Promise.resolve(null);var s=this._resourceCache,l=t===0||t===1,u=l||e===void 0?""+t:t+":"+e,c=s.get(u);if(c)return c;if(l)c=o.parse(this);else{var d=this.glTF[UC[t]];d&&(e===void 0||d[e])?e===void 0?c=t===7?d.map(function(_,f){return r.get(t,f)}):Promise.all(d.map(function(_,f){return r.get(t,f)})):(c=o.parse(this,e),this._handleSubAsset(c,t,e)):c=Promise.resolve(null)}return s.set(u,c),c},i.parse=function(){var t=this;return this.get(0).then(function(e){return t.glTF=e,Promise.all([t.get(1),t.get(4),t.get(5),t.get(6),t.get(8),t.get(9),t.get(2)]).then(function(){var r=t.glTFResource;return(r.skins||r.animations)&&t._createAnimator(t,r.animations),t.resourceManager.addContentRestorer(t.contentRestorer),r})})},i._createAnimator=function(t,e){var r=t.glTFResource.defaultSceneRoot,o=r.addComponent(Ur),s=new Ff,l=new Of("layer"),u=new zf;if(s.addLayer(l),o.animatorController=s,l.stateMachine=u,e)for(var c=0;c<e.length;c++){var d=e[c],_=d.name,f=u.makeUniqueStateName(_);f!==_&&console.warn("AnimatorState name is existed, name: "+_+" reset to "+f);var v=u.addState(f);v.clip=d}},i._handleSubAsset=function(t,e,r){var o=this,s=kC[e];if(s)if(e===7){var l,u;((l=this.glTFResource)[u=s]||(l[u]=[]))[r]=t}else{var c=this.glTFResource.url;t.then(function(d){var _,f;if(((_=o.glTFResource)[f=s]||(_[f]=[]))[r]=d,e===6)for(var v=0,p=d.length;v<p;v++){var g=d[v];o.resourceManager._onSubAssetSuccess(c+"?q="+s+"["+r+"]["+v+"]",g)}else{o.resourceManager._onSubAssetSuccess(c+"?q="+s+"["+r+"]",d);var m;e===2&&((m=o.glTF.scene)!=null?m:0)===r&&o.resourceManager._onSubAssetSuccess(""+c+"?q=defaultSceneRoot",d)}})}},n.addParser=function(t,e){this._parsers[t]=e},n}();(function(){Wf._parsers={}})();var jv=function(i,a,t){this.data=i,this.interleaved=a,this.stride=t,this.vertexBindingInfos={}},Te;(function(n){n[n.Schema=0]="Schema",n[n.Validator=1]="Validator",n[n.Scene=2]="Scene",n[n.Buffer=3]="Buffer",n[n.Texture=4]="Texture",n[n.Material=5]="Material",n[n.Mesh=6]="Mesh",n[n.Entity=7]="Entity",n[n.Skin=8]="Skin",n[n.Animation=9]="Animation"})(Te||(Te={}));var Gr,UC=(Gr={},Gr[2]="scenes",Gr[3]="buffers",Gr[4]="textures",Gr[5]="materials",Gr[6]="meshes",Gr[7]="nodes",Gr[8]="skins",Gr[9]="animations",Gr),si,kC=(si={},si[2]="sceneRoots",si[4]="textures",si[5]="materials",si[6]="meshes",si[7]="entities",si[8]="skins",si[9]="animations",si);function ii(n){return function(i){var a=new i;Wf.addParser(n,a)}}var Ae=function(){function n(){}return n.floatBufferToVector2Array=function(a){for(var t=a.length,e=new Array(t/2),r=0;r<t;r+=2)e[r/2]=new te(a[r],a[r+1]);return e},n.floatBufferToVector3Array=function(a){for(var t=a.length,e=new Array(t/3),r=0;r<t;r+=3)e[r/3]=new M(a[r],a[r+1],a[r+2]);return e},n.floatBufferToVector4Array=function(a){for(var t=a.length,e=new Array(t/4),r=0;r<t;r+=4)e[r/4]=new ue(a[r],a[r+1],a[r+2],a[r+3]);return e},n.floatBufferToColorArray=function(a,t){var e=a.length,r=new Array(e/(t?3:4));if(t)for(var o=0;o<e;o+=3)r[o/3]=new J(a[o],a[o+1],a[o+2],1);else for(var s=0;s<e;s+=4)r[s/4]=new J(a[s],a[s+1],a[s+2],a[s+3]);return r},n.getAccessorTypeSize=function(a){switch(a){case Xr.SCALAR:return 1;case Xr.VEC2:return 2;case Xr.VEC3:return 3;case Xr.VEC4:return 4;case Xr.MAT2:return 4;case Xr.MAT3:return 9;case Xr.MAT4:return 16}},n.getComponentType=function(a){switch(a){case Ct.BYTE:return Int8Array;case Ct.UNSIGNED_BYTE:return Uint8Array;case Ct.SHORT:return Int16Array;case Ct.UNSIGNED_SHORT:return Uint16Array;case Ct.UNSIGNED_INT:return Uint32Array;case Ct.FLOAT:return Float32Array}},n.getNormalizedComponentScale=function(a){switch(a){case Ct.BYTE:return 1/127;case Ct.UNSIGNED_BYTE:return 1/255;case Ct.SHORT:return 1/32767;case Ct.UNSIGNED_SHORT:return 1/65535;default:throw new Error("Galacean.GLTFLoader: Unsupported normalized accessor component type.")}},n.getAccessorBuffer=function(a,t,e){var r=e.componentType,o=t[e.bufferView];return a.get(Te.Buffer).then(function(s){var l=o.buffer,u=s[l],c,d=(c=o.byteOffset)!=null?c:0,_,f=(_=e.byteOffset)!=null?_:0,v=n.getComponentType(r),p=n.getAccessorTypeSize(e.type),g=v.BYTES_PER_ELEMENT,m=p*g,h=e.count,y=o.byteStride,A;if(y!==void 0&&y!==m){var S=Math.floor(f/y),x=e.bufferView+":"+r+":"+S+":"+h,C=a.accessorBufferCache;if(A=C[x],!A){var E=d+S*y,T=h*(y/g),w=new v(u,E,T);C[x]=A=new jv(w,!0,y),A.restoreInfo=new $v(new ql(l,v,E,T))}}else{var R=d+f,b=h*p,B=new v(u,R,b);A=new jv(B,!1,m),A.restoreInfo=new $v(new ql(l,v,R,b))}return e.sparse&&n.processingSparseData(t,e,s,A),A})},n.bufferToVector3Array=function(a,t,e,r){for(var o=a.BYTES_PER_ELEMENT,s=e%t/o,l=t/o,u=new Array(r),c=0;c<r;c++){var d=s+c*l;u[c]=new M(a[d],a[d+1],a[d+2])}return u},n.getAccessorData=function(a,t,e){var r=a.bufferViews,o=r[t.bufferView],s=e[o.buffer],l=t.hasOwnProperty("byteOffset")?t.byteOffset:0,u=o.hasOwnProperty("byteOffset")?o.byteOffset:0,c=l+u,d=n.getAccessorTypeSize(t.type),_=d*t.count,f,v=(f=o.byteStride)!=null?f:0,p=n.getComponentType(t.componentType),g;if(v){var m=d*p.BYTES_PER_ELEMENT;g=new Uint8Array(t.count*m);for(var h=new Uint8Array(s,u,o.byteLength),y=0;y<t.count;y++)for(var A=0;A<m;A++)g[y*m+A]=h[y*v+l+A]}else g=new Uint8Array(s.slice(c,c+_*p.BYTES_PER_ELEMENT));var S=new p(g.buffer);if(t.sparse)for(var x=t.sparse,C=x.count,E=x.indices,T=x.values,w=r[E.bufferView],R=r[T.bufferView],b=e[w.buffer],B=e[R.buffer],I,V,L=((I=E.byteOffset)!=null?I:0)+((V=w.byteOffset)!=null?V:0),F=w.byteLength,D,N,O=((D=T.byteOffset)!=null?D:0)+((N=R.byteOffset)!=null?N:0),k=R.byteLength,Q=n.getComponentType(E.componentType),H=new Q(b,L,F/Q.BYTES_PER_ELEMENT),ee=new p(B,O,k/p.BYTES_PER_ELEMENT),ge=0;ge<C;ge++)for(var le=H[ge],re=0;re<d;re++)S[le*d+re]=ee[ge*d+re];return S},n.getBufferViewData=function(a,t){var e=a.byteOffset,r=e===void 0?0:e,o=t[a.buffer];return o.slice(r,r+a.byteLength)},n.processingSparseData=function(a,t,e,r){var o=r.restoreInfo,s=n.getAccessorTypeSize(t.type),l=n.getComponentType(t.componentType),u=r.data.slice(),c=t.sparse,d=c.count,_=c.indices,f=c.values,v=a[_.bufferView],p=a[f.bufferView],g=v.buffer,m=p.buffer,h=e[g],y=e[m],A,S,x=((A=_.byteOffset)!=null?A:0)+((S=v.byteOffset)!=null?S:0),C=v.byteLength,E,T,w=((E=f.byteOffset)!=null?E:0)+((T=p.byteOffset)!=null?T:0),R=p.byteLength;o.typeSize=s,o.sparseCount=d;var b=n.getComponentType(_.componentType),B=C/b.BYTES_PER_ELEMENT,I=new b(h,x,B);o.sparseIndices=new ql(g,b,x,B);var V=R/l.BYTES_PER_ELEMENT,L=new l(y,w,V);o.sparseValues=new ql(m,l,w,V);for(var F=0;F<d;F++)for(var D=I[F],N=0;N<s;N++)u[D*s+N]=L[F*s+N];r.data=u},n.getIndexFormat=function(a){switch(a){case Ct.UNSIGNED_BYTE:return Ht.UInt8;case Ct.UNSIGNED_SHORT:return Ht.UInt16;case Ct.UNSIGNED_INT:return Ht.UInt32}},n.getElementFormat=function(a,t,e){if(e===void 0&&(e=!1),a==Ct.FLOAT)switch(t){case 1:return ie.Float;case 2:return ie.Vector2;case 3:return ie.Vector3;case 4:return ie.Vector4}if(a==Ct.SHORT)switch(t){case 2:return e?ie.NormalizedShort2:ie.Short2;case 3:case 4:return e?ie.NormalizedShort4:ie.Short4}if(a==Ct.UNSIGNED_SHORT)switch(t){case 2:return e?ie.NormalizedUShort2:ie.UShort2;case 3:case 4:return e?ie.NormalizedUShort4:ie.UShort4}if(a==Ct.BYTE)switch(t){case 2:case 3:case 4:return e?ie.NormalizedByte4:ie.Byte4}if(a==Ct.UNSIGNED_BYTE)switch(t){case 2:case 3:case 4:return e?ie.NormalizedUByte4:ie.UByte4}},n.loadImageBuffer=function(a,t){return new Promise(function(e,r){var o=new window.Blob([a],{type:t}),s=new Image;s.onerror=function(){r(new Error("Failed to load image buffer"))},s.onload=function(){requestAnimationFrame(function(){e(s),s.onload=null,s.onerror=null,s.onabort=null})},s.crossOrigin="anonymous",s.src=URL.createObjectURL(o)})},n.parseGLB=function(a,t){var e=4,r=1179937895,o=12,s={JSON:1313821514,BIN:5130562},l=new DataView(t),u={magic:l.getUint32(0,!0),version:l.getUint32(e,!0),length:l.getUint32(2*e,!0)};if(u.magic!==r)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+u.magic.toString(16)),null;var c=l.getUint32(o,!0),d=l.getUint32(o+e,!0);if(d!==s.JSON)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+d.toString(16)),null;for(var _=new Uint8Array(t,o+2*e,c),f=JSON.parse(yt.decodeText(_)),v=[],p=o+2*e+c,g=a.contentRestorer.glbBufferSlices;p<u.length;){if(c=l.getUint32(p,!0),d=l.getUint32(p+e,!0),d!==s.BIN)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+d.toString(16)),null;var m=p+2*e,h=t.slice(m,m+c);v.push(h),g.push(new te(m,c)),p+=c+2*e}return{glTF:f,buffers:v}},n.parseSampler=function(a,t){var e=t.filterMode,r=t.wrapModeU,o=t.wrapModeV;e!==void 0&&(a.filterMode=e),r!==void 0&&(a.wrapModeU=r),o!==void 0&&(a.wrapModeV=o)},n.getSamplerInfo=function(a){var t=a.minFilter,e=a.magFilter,r=a.wrapS,o=a.wrapT,s={};return(t||e)&&(s.mipmap=t>=ec.NEAREST_MIPMAP_NEAREST,e===C_.NEAREST?s.filterMode=tn.Point:t<=ec.LINEAR_MIPMAP_NEAREST?s.filterMode=tn.Bilinear:s.filterMode=tn.Trilinear),r&&(s.wrapModeU=tc._wrapMap[r]),o&&(s.wrapModeV=tc._wrapMap[o]),s},n}(),Yv;(function(n){n[n.linear=1]="linear",n[n.sRGB=2]="sRGB"})(Yv||(Yv={}));var qv;(function(n){n[n.ETC1S=163]="ETC1S",n[n.UASTC=166]="UASTC"})(qv||(qv={}));var E_;(function(n){n[n.None=0]="None",n[n.BasisLZ=1]="BasisLZ",n[n.Zstd=2]="Zstd",n[n.ZLib=3]="ZLib"})(E_||(E_={}));var GC=function(){function n(a){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.keyValue={},this.globalData=null,this.parse(a)}var i=n.prototype;return i.parse=function(t){var e=t.buffer,r=t.byteOffset,o=new $a(t,12);this.vkFormat=o.nextUint32(),this.typeSize=o.nextUint32(),this.pixelWidth=o.nextUint32(),this.pixelHeight=o.nextUint32(),this.pixelDepth=o.nextUint32(),this.layerCount=o.nextUint32(),this.faceCount=o.nextUint32();var s=Math.max(1,o.nextUint32());this.supercompressionScheme=o.nextUint32();var l=o.nextUint32(),u=o.nextUint32(),c=o.nextUint32(),d=o.nextUint32(),_=o.nextUint64(),f=o.nextUint64(),v=new Array(s),p=s*3*8,g=new $a(t,o.offset,p);this.levels=v;for(var m=0;m<s;m++)v[m]={levelData:new Uint8Array(e,r+g.nextUint64(),g.nextUint64()),uncompressedByteLength:g.nextUint64()};var h=new $a(t,l,u),y={vendorId:h.skip(4).nextUint16(),descriptorType:h.nextUint16(),versionNumber:h.nextUint16(),descriptorBlockSize:h.nextUint16(),colorModel:h.nextUint8(),colorPrimaries:h.nextUint8(),transferFunction:h.nextUint8(),flags:h.nextUint8(),texelBlockDimension:[h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8()],bytesPlane:[h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8()],samples:[]};this.dataFormatDescriptor=y;for(var A=6,S=4,x=(y.descriptorBlockSize/4-A)/S,C=0;C<x;C++){var E={bitOffset:h.nextUint16(),bitLength:h.nextUint8(),channelType:h.nextUint8(),samplePosition:[h.nextUint8(),h.nextUint8(),h.nextUint8(),h.nextUint8()],sampleLower:-1/0,sampleUpper:1/0};E.channelType&64?(E.sampleLower=h.nextInt32(),E.sampleUpper=h.nextInt32()):(E.sampleLower=h.nextUint32(),E.sampleUpper=h.nextUint32()),y.samples[C]=E}for(var T=new $a(t,c,d,!0);T.position<d;){var w=T.nextUint32(),R=T.scan(w),b=yt.decodeText(R),B=T.nextUint8Array(w-R.byteLength-1);this.keyValue[b]=b.match(/^ktx/i)?yt.decodeText(B).replace(/^(.*)\x00$/,"$1"):B;var I=w%4?4-w%4:0;T.skip(I)}if(f<=0)return this;for(var V=new $a(t,_,f,!0),L=V.nextUint16(),F=V.nextUint16(),D=V.nextUint32(),N=V.nextUint32(),O=V.nextUint32(),k=V.nextUint32(),Q=new Array(s),H=0;H<s;H++)Q[H]={imageFlags:V.nextUint32(),rgbSliceByteOffset:V.nextUint32(),rgbSliceByteLength:V.nextUint32(),alphaSliceByteOffset:V.nextUint32(),alphaSliceByteLength:V.nextUint32()};var ee=_+V.position,ge=ee+D,le=ge+N,re=le+O,Ve=new Uint8Array(e,r+ee,D),He=new Uint8Array(e,r+ge,N),Qe=new Uint8Array(e,r+le,O),Ee=new Uint8Array(e,r+re,k);this.globalData={endpointCount:L,selectorCount:F,imageDescs:Q,endpointsData:Ve,selectorsData:He,tablesData:Qe,extendedData:Ee}},kf(n,[{key:"isSRGB",get:function(){return this.dataFormatDescriptor.transferFunction===2}},{key:"isUASTC",get:function(){return this.dataFormatDescriptor.colorModel===166}}]),n}(),Fe;(function(n){n[n.ASTC=0]="ASTC",n[n.BC7=1]="BC7",n[n.BC1_BC3=2]="BC1_BC3",n[n.PVRTC=3]="PVRTC",n[n.ETC=4]="ETC",n[n.R8=5]="R8",n[n.R8G8=6]="R8G8",n[n.R8G8B8A8=7]="R8G8B8A8"})(Fe||(Fe={}));var HC=function(){function n(a,t){a===void 0&&(a=4),this.limitedCount=a,this._workerCreator=t,this._taskQueue=[],this._workerStatus=0,this._workerItems=new Array(a)}var i=n.prototype;return i.prepareWorker=function(){for(var t=this.limitedCount,e=new Array(t),r=0;r<t;r++)e.push(this._initWorker(r));return Promise.all(e)},i.postMessage=function(t){var e=this;return new Promise(function(r,o){var s=e._getIdleWorkerId();if(s!==-1){e._workerStatus|=1<<s;var l=e._workerItems,u;Promise.resolve((u=l[s])!=null?u:e._initWorker(s)).then(function(){var c=l[s];c.resolve=r,c.reject=o,c.worker.postMessage(t)}).catch(o)}else e._taskQueue.push({resolve:r,reject:o,message:t})})},i.destroy=function(){for(var t=this._workerItems,e=0,r=t.length;e<r;e++){var o=t[e];o.worker.terminate(),o.reject=null,o.resolve=null}t.length=0,this._taskQueue.length=0,this._workerStatus=0},i._initWorker=function(t){var e=this;return Promise.resolve(this._workerCreator()).then(function(r){return r.addEventListener("message",e._onMessage.bind(e,t)),e._workerItems[t]={worker:r,resolve:null,reject:null},r})},i._getIdleWorkerId=function(){for(var t=0,e=this.limitedCount;t<e;t++)if(!(this._workerStatus&1<<t))return t;return-1},i._onMessage=function(t,e){var r=e.data.error;r?this._workerItems[t].reject(r):this._workerItems[t].resolve(e.data),this._nextTask(t)},i._nextTask=function(t){if(this._taskQueue.length){var e=this._taskQueue.shift(),r=this._workerItems[t];r.resolve=e.resolve,r.reject=e.reject,r.worker.postMessage(e.message)}else this._workerStatus^=1<<t},n}(),wm=function(){function n(a){this.workerLimitCount=a}var i=n.prototype;return i.init=function(){return this._initPromise||(this._initPromise=this._initTranscodeWorkerPool()),this._initPromise},i.destroy=function(){this._transcodeWorkerPool.destroy()},i._createTranscodePool=function(t,e){return this._transcodeWorkerPool=new HC(this.workerLimitCount,function(){return new Promise(function(r,o){var s=function(d){d.data.error?o(d.data.error):r(l)},l=new Worker(t),u={type:"init",transcoderWasm:e};l.addEventListener("message",s),l.postMessage(u)})}),this._transcodeWorkerPool.prepareWorker()},n}();function WC(){var n,i=function(t){return n||(n=new Promise(function(e,r){var o={wasmBinary:t,onRuntimeInitialized:function(){return e(o)},onAbort:r};self.BASIS(o)}).then(function(e){return e.initializeBasis(),e.KTX2File})),n};self.onmessage=function(t){var e=t.data;switch(e.type){case"init":i(e.transcoderWasm).then(function(){self.postMessage("init-completed")}).catch(function(r){return self.postMessage({error:r})});break;case"transcode":i().then(function(r){var o=w_(e.buffer,e.format,r);o.type="transcoded",self.postMessage(o)}).catch(function(r){return self.postMessage({error:r})});break}}}var QC=function(){var i;return function(t){return i||(i=new Promise(function(e,r){var o={wasmBinary:t,onRuntimeInitialized:function(){return e(o)},onAbort:r};self.BASIS(o)}).then(function(e){return e.initializeBasis(),e.KTX2File})),i}},Jv=QC();function w_(n,i,a){var t=function(B,I){switch(B){case 2:return I?3:2;case 4:return I?1:0;case 3:return I?9:8;case 7:return 13;case 0:return 10;case 1:return 7}},e=function(B){if(B.length===1)return B[0];for(var I=0,V=0;V<B.length;V++)I+=B[V].byteLength;for(var L=new Uint8Array(I),F=0,D=0;D<B.length;D++)L.set(B[D],F),F+=B[D].byteLength;return L},r=function(){l.close(),l.delete()},o;(function(b){b[b.ETC1=0]="ETC1",b[b.ETC2=1]="ETC2",b[b.BC1=2]="BC1",b[b.BC3=3]="BC3",b[b.BC4=4]="BC4",b[b.BC5=5]="BC5",b[b.BC7=7]="BC7",b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",b[b.ASTC_4x4=10]="ASTC_4x4",b[b.RGBA8=13]="RGBA8"})(o||(o={}));var s;(function(b){b[b.ASTC=0]="ASTC",b[b.BC7=1]="BC7",b[b.BC1_BC3=2]="BC1_BC3",b[b.PVRTC=3]="PVRTC",b[b.ETC=4]="ETC",b[b.R8=5]="R8",b[b.RG8=6]="RG8",b[b.RGBA8=7]="RGBA8"})(s||(s={}));var l=new a(new Uint8Array(n));if(!l.isValid())throw r(),new Error("Invalid or unsupported .ktx2 file");if(!l.startTranscoding())throw r(),new Error("KTX2 startTranscoding failed");for(var u=l.getWidth(),c=l.getHeight(),d=l.getLayers()||1,_=l.getLevels(),f=l.getHasAlpha(),v=l.getFaces(),p=t(i,f),g=new Array(v),m=p===2||p===3||p===7,h=0;h<v;h++){for(var y=new Array(_),A=0;A<_;A++){for(var S=new Array(d),x=void 0,C=void 0,E=0;E<d;E++){var T=l.getImageLevelInfo(A,E,h);m&&A===0&&(u!==T.width||c!==T.height)?(u=x=T.width,c=C=T.height,console.warn("KTX2 transcode to BC will resize to width: "+u+", height: "+c+". You'd better use an image whose size if multiple of 4.")):(x=T.origWidth,C=T.origHeight);var w=new Uint8Array(l.getImageTranscodedSizeInBytes(A,E,0,p)),R=l.transcodeImage(w,A,E,h,p,0,-1,-1);if(!R)throw r(),new Error("transcodeImage failed.");S[E]=w}y[A]={data:e(S),width:x,height:C}}g[h]=y}return r(),{faces:g,width:u,height:c,hasAlpha:f,faceCount:v,format:p}}var XC=function(n){de(i,n);function i(t){return n.call(this,t)}var a=i.prototype;return a._initTranscodeWorkerPool=function(){var e=this;return Promise.all([fetch("https://mdn.alipayobjects.com/rms/afts/file/A*nG8SR6vCgXgAAAAAAAAAAAAAARQnAQ/basis_transcoder.js").then(function(r){return r.text()}),fetch("https://mdn.alipayobjects.com/rms/afts/file/A*qEUfQ7317KsAAAAAAAAAAAAAARQnAQ/basis_transcoder.wasm").then(function(r){return r.arrayBuffer()})]).then(function(r){var o=r[0],s=r[1];if(e.workerLimitCount===0)return new Promise(function(_,f){var v=document.createElement("script");v.src=URL.createObjectURL(new Blob([o],{type:"application/javascript"})),document.body.appendChild(v),v.onload=function(){Jv(s).then(function(){_(null)})},v.onerror=function(){f()}});var l=WC.toString(),u=l.substring(l.indexOf("{"),l.lastIndexOf("}")+1),c=`
        `+o+`
        `+w_.toString()+`
        `+u+`
        `,d=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));return e._createTranscodePool(d,s)})},a.transcode=function(e,r){return this.workerLimitCount===0?Jv().then(function(o){return w_(e,r,o)}):this._transcodeWorkerPool.postMessage({buffer:e,format:r,type:"transcode"})},i}(wm);function jC(){var n=function(s,l,u,c){var d=(u+3>>2)*(c+3>>2),_=d*16+65535>>16,f=s.memory,v=_+1-(f.buffer.byteLength>>16);v>0&&f.grow(v);var p=new Uint8Array(f.buffer,65536,d*16);return p.set(l),s.transcode(d)===0?p:null},i=function(s){return t=WebAssembly.instantiate(s,{env:{memory:new WebAssembly.Memory({initial:16})}}).then(function(l){return l.instance.exports}),t},a=function(s,l,u){var c=s.length,d=new Array(c),_=Promise.resolve();return l&&(r.init(),_=r._initPromise),_.then(function(){for(var f=0;f<c;f++){for(var v=s[f].length,p=new Array(v),g=0;g<v;g++){var m=s[f][g],h=m.buffer,y=m.levelHeight,A=m.levelWidth,S=m.uncompressedByteLength;l&&(h=r.decode(h.slice(),S));var x=h.byteLength/c,C=h.byteOffset,E=n(u,new Uint8Array(h.buffer,C+f*x,x),A,y);if(E)p[g]={data:E.slice(),width:A,height:y};else throw"buffer decoded error"}d[f]=p}return d})},t,e=function(){function o(){}var s=o.prototype;return s.init=function(){return this._initPromise||(this._initPromise=fetch(o.WasmModuleURL).then(function(u){if(u.ok)return u.arrayBuffer();throw new Error("Could not fetch the wasm component for the Zstandard decompression lib: "+u.status+" - "+u.statusText)}).then(function(u){return WebAssembly.instantiate(u,o.IMPORT_OBJECT)}).then(this._init)),this._initPromise},s._init=function(u){o.instance=u.instance,o.IMPORT_OBJECT.env.emscripten_notify_memory_growth()},s.decode=function(u,c){if(c===void 0&&(c=0),!o.instance)throw new Error("ZSTDDecoder: Await .init() before decoding.");var d=o.instance.exports,_=u.byteLength,f=d.malloc(_);o.heap.set(u,f),c=c||Number(d.ZSTD_findDecompressedSize(f,_));var v=d.malloc(c),p=d.ZSTD_decompress(v,c,f,_),g=o.heap.slice(v,v+p);return d.free(f),d.free(v),g},o}();(function(){e.IMPORT_OBJECT={env:{emscripten_notify_memory_growth:function(){e.heap=new Uint8Array(e.instance.exports.memory.buffer)}}}})(),function(){e.WasmModuleURL="https://mdn.alipayobjects.com/rms/afts/file/A*awNJR7KqIAEAAAAAAAAAAAAAARQnAQ/zstddec.wasm"}();var r=new e;self.onmessage=function(s){var l=s.data;switch(l.type){case"init":i(l.transcoderWasm).then(function(){self.postMessage("init-completed")}).catch(function(u){self.postMessage({error:u})});break;case"transcode":t.then(function(u){a(l.data,l.needZstd,u).then(function(c){self.postMessage(c)}).catch(function(c){return self.postMessage({error:c})})});break}}}var T_=function(n){de(i,n);function i(t,e){var r;return r=n.call(this,t)||this,r.type=e,r}var a=i.prototype;return a._initTranscodeWorkerPool=function(){var e=this;return fetch(i.transcoderMap[this.type]).then(function(r){return r.arrayBuffer()}).then(function(r){var o=jC.toString(),s=URL.createObjectURL(new Blob([o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))],{type:"application/javascript"}));return e._createTranscodePool(s,r)})},a.transcode=function(e){for(var r=e.supercompressionScheme===E_.Zstd,o=e.levels.length,s=e.faceCount,l={width:e.pixelWidth,height:e.pixelHeight,mipmaps:null},u={type:"transcode",format:0,needZstd:r,data:new Array(s)},c=u.data,d=0;d<s;d++){for(var _=new Array(o),f=0;f<o;f++){var v=e.levels[f],p=Math.floor(e.pixelWidth/(1<<f))||1,g=Math.floor(e.pixelHeight/(1<<f))||1,m=v.levelData.buffer,h=v.levelData.byteOffset,y=v.levelData.byteLength;_[f]={buffer:new Uint8Array(m,h,y),levelWidth:p,levelHeight:g,uncompressedByteLength:v.uncompressedByteLength}}c[d]=_}return this._transcodeWorkerPool.postMessage(u).then(function(A){return l.faces=A,l.hasAlpha=!0,l})},i}(wm);(function(){var n;T_.transcoderMap=(n={},n[Fe.ASTC]="https://mdn.alipayobjects.com/rms/afts/file/A*0jiKRK6D1-kAAAAAAAAAAAAAARQnAQ/uastc_astc.wasm",n)})();var os,Ut=(os=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.initialize=function(e,r){if(r.ktx2Loader){var o=r.ktx2Loader;return o.priorityFormats&&(Ut._priorityFormats.etc1s=o.priorityFormats,Ut._priorityFormats.uastc=o.priorityFormats),o.transcoder===1?Ut._getKhronosTranscoder(o.workerCount).init():Ut._getBinomialLLCTranscoder(o.workerCount).init()}},a.load=function(e,r){return this.request(e.url,{type:"arraybuffer"}).then(function(o){return Ut._parseBuffer(new Uint8Array(o),r.engine,e.params).then(function(s){var l=s.engine,u=s.result,c=s.targetFormat,d=s.params;return Ut._createTextureByBuffer(l,u,c,d)})})},i.destroy=function(){this._binomialLLCTranscoder&&this._binomialLLCTranscoder.destroy(),this._khronosTranscoder&&this._khronosTranscoder.destroy(),this._binomialLLCTranscoder=null,this._khronosTranscoder=null,this._isBinomialInit=!1},i._parseBuffer=function(e,r,o){var s,l=new GC(e),u,c=(u=(s=o)==null?void 0:s.priorityFormats)!=null?u:Ut._priorityFormats[l.isUASTC?"uastc":"etc1s"],d=Ut._decideTargetFormat(r,l,c),_;if(Ut._isBinomialInit||!T_.transcoderMap[d]||!l.isUASTC){var f=Ut._getBinomialLLCTranscoder();_=f.init().then(function(){return f.transcode(e,d)})}else{var v=Ut._getKhronosTranscoder();_=v.init().then(function(){return v.transcode(l)})}return _.then(function(p){return{engine:r,result:p,targetFormat:d,params:l.keyValue.GalaceanTextureParams}})},i._createTextureByBuffer=function(e,r,o,s){var l=r.width,u=r.height,c=r.faces,d=c.length,_=c[0],f=_.length>1,v=this._getEngineTextureFormat(o,r),p;if(d!==6){p=new fn(e,l,u,v,f);for(var g=0;g<_.length;g++){var m=_[g].data;p.setPixelBuffer(m,g)}}else{p=new Tn(e,u,v,f);for(var h=0;h<c.length;h++)for(var y=c[h],A=0;A<_.length;A++)p.setPixelBuffer(fr.PositiveX+h,y[A].data,A)}return s&&(p.wrapModeU=s[0],p.wrapModeV=s[1],p.filterMode=s[2],p.anisoLevel=s[3]),p},i._decideTargetFormat=function(e,r,o){var s=e._hardwareRenderer,l=this._detectSupportedFormat(s,o);return l===Fe.PVRTC&&(!G.isPowerOf2(r.pixelWidth)||!G.isPowerOf2(r.pixelHeight)||r.pixelWidth!==r.pixelHeight)?(ve.warn("PVRTC image need power of 2 and width===height, downgrade to RGBA8"),Fe.R8G8B8A8):l===null?(ve.warn("Can't support any compressed texture, downgrade to RGBA8"),Fe.R8G8B8A8):l},i._detectSupportedFormat=function(e,r){for(var o=0;o<r.length;o++){var s=r[o],l=this._supportedMap[s];if(l){for(var u=0;u<l.length;u++)if(e.canIUse(l[u]))return s}else switch(r[o]){case Fe.R8G8B8A8:return s;case Fe.R8:case Fe.R8G8:if(e.isWebGL2)return s}}return null},i._getBinomialLLCTranscoder=function(e){e===void 0&&(e=4),Ut._isBinomialInit=!0;var r;return(r=this._binomialLLCTranscoder)!=null?r:this._binomialLLCTranscoder=new XC(e)},i._getKhronosTranscoder=function(e){e===void 0&&(e=4);var r;return(r=this._khronosTranscoder)!=null?r:this._khronosTranscoder=new T_(e,Fe.ASTC)},i._getEngineTextureFormat=function(e,r){var o=r.hasAlpha;switch(e){case Fe.ASTC:return X.ASTC_4x4;case Fe.ETC:return o?X.ETC2_RGBA8:X.ETC2_RGB;case Fe.BC7:return X.BC7;case Fe.BC1_BC3:return o?X.BC3:X.BC1;case Fe.PVRTC:return o?X.PVRTC_RGBA4:X.PVRTC_RGB4;case Fe.R8G8B8A8:return X.R8G8B8A8}},i}(ke),function(){os._isBinomialInit=!1}(),function(){os._priorityFormats={etc1s:[Fe.ETC,Fe.BC7,Fe.ASTC,Fe.BC1_BC3,Fe.PVRTC],uastc:[Fe.ASTC,Fe.BC7,Fe.ETC,Fe.BC1_BC3,Fe.PVRTC]}}(),function(){var n;os._supportedMap=(n={},n[Fe.ASTC]=[Z.astc],n[Fe.ETC]=[Z.etc],n[Fe.BC7]=[Z.bptc],n[Fe.BC1_BC3]=[Z.s3tc],n[Fe.PVRTC]=[Z.pvrtc,Z.pvrtc_webkit],n)}(),os);Ut=pe([ct(De.KTX2,["ktx2"])],Ut);var Zv;(function(n){n[n.BinomialLLC=0]="BinomialLLC",n[n.Khronos=1]="Khronos"})(Zv||(Zv={}));var YC=function(n){de(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t.bufferRequests=[],t.glbBufferSlices=[],t.bufferTextures=[],t.meshes=[],t}var a=i.prototype;return a.restoreContent=function(){var e=this;return new Oe(function(r,o){Promise.all(e.bufferRequests.map(function(s){return Nr(s.url,s.config)})).then(function(s){if(e.isGLB){var l=e.glbBufferSlices,u=s[0],c=l.length;s.length=c;for(var d=0;d<c;d++){var _=l[d];s[d]=u.slice(_.x,_.x+_.y)}}Oe.all(e.bufferTextures.map(function(f){var v=f.bufferView,p=s[v.buffer],g,m=new Uint8Array(p,(g=v.byteOffset)!=null?g:0,v.byteLength),h=f.texture;return f.mimeType==="image/ktx2"?Ut._parseBuffer(m,h.engine).then(function(y){for(var A=y.result,S=A.faces,x=S[0],C=0;C<x.length;C++)h.setPixelBuffer(x[C].data,C)}):Ae.loadImageBuffer(m,f.mimeType).then(function(y){h.setImageSource(y),h.generateMipmaps()})})).then(function(){for(var f=Cs(e.meshes),v;!(v=f()).done;){for(var p=v.value,g=p.mesh,m=Cs(p.vertexBuffers),h;!(h=m()).done;){var y=h.value,A=e._getBufferData(s,y.data);y.buffer.setData(A)}if(p.indexBuffer){var S=e._getBufferData(s,p.indexBuffer);g.setIndices(S)}for(var x=Cs(p.blendShapes),C;!(C=x()).done;){var E=C.value,T=E.blendShape.frames[0],w=E.position,R=e._getBufferData(s,w.buffer);if(T.deltaPositions=Ae.bufferToVector3Array(R,w.stride,w.byteOffset,w.count),E.normal){var b=E.normal,B=e._getBufferData(s,b.buffer);T.deltaNormals=Ae.bufferToVector3Array(B,b.stride,b.byteOffset,b.count)}if(E.tangent){var I=E.tangent,V=e._getBufferData(s,I.buffer);T.deltaTangents=Ae.bufferToVector3Array(V,I.stride,I.byteOffset,I.count)}}g.uploadData(!0)}r(e.resource)}).catch(o)}).catch(o)})},a._getBufferData=function(e,r){var o=r.main,s=e[o.bufferIndex],l=new o.TypedArray(s,o.byteOffset,o.length),u=r.sparseCount;if(u)for(var c=r.sparseIndices,d=e[c.bufferIndex],_=new c.TypedArray(d,c.byteOffset,c.length),f=r.sparseValues,v=e[f.bufferIndex],p=new f.TypedArray(v,f.byteOffset,f.length),g=r.typeSize,m=0;m<u;m++)for(var h=_[m],y=0;y<g;y++)l[h*g+y]=p[m*g+y];return l},i}(gi),Tm=function(i,a){this.url=i,this.config=a},Rm=function(i,a,t){this.texture=i,this.bufferView=a,this.mimeType=t},qC=function(){this.vertexBuffers=[],this.blendShapes=[]},Kv=function(i,a){this.buffer=i,this.data=a},$v=function(i,a,t,e,r){this.main=i,this.typeSize=a,this.sparseCount=t,this.sparseIndices=e,this.sparseValues=r},ql=function(i,a,t,e){this.bufferIndex=i,this.TypedArray=a,this.byteOffset=t,this.length=e},JC=function(i,a,t,e){this.blendShape=i,this.position=a,this.normal=t,this.tangent=e},cd=function(i,a,t,e){this.buffer=i,this.stride=a,this.byteOffset=t,this.count=e},gr=function(){function n(){}var i=n.prototype;return i.createAndParse=function(t,e,r){for(var o=arguments.length,s=new Array(o>3?o-3:0),l=3;l<o;l++)s[l-3]=arguments[l];throw"Not implemented."},i.additiveParse=function(t,e,r,o){for(var s=arguments.length,l=new Array(s>4?s-4:0),u=4;u<s;u++)l[u-4]=arguments[u];throw"Not implemented."},n}(),on;(function(n){n[n.CreateAndParse=0]="CreateAndParse",n[n.AdditiveParse=1]="AdditiveParse"})(on||(on={}));var qe=function(){function n(){}return n.executeExtensionsCreateAndParse=function(a,t,e){a===void 0&&(a={});for(var r=arguments.length,o=new Array(r>3?r-3:0),s=3;s<r;s++)o[s-3]=arguments[s];for(var l=null,u=Object.keys(a),c=u.length-1;c>=0;--c){var d,_=u[c],f=a[_];if(l=(d=n)._createAndParse.apply(d,[].concat(_,t,f,e,o)),l)return l}},n.executeExtensionsAdditiveAndParse=function(a,t,e,r){for(var o=arguments.length,s=new Array(o>4?o-4:0),l=4;l<o;l++)s[l-4]=arguments[l];for(var u in a){var c,d=a[u];(c=n)._additiveParse.apply(c,[].concat(u,t,e,d,r,s))}},n.hasExtensionParser=function(a){var t;return!!((t=n._extensionParsers[a])!=null&&t.length)},n.getExtensionParser=function(a,t){var e,r=n._extensionParsers[a],o=(e=r)==null?void 0:e.length;if(o)for(var s=o-1;s>=0;--s){var l=r[s];if(l._mode===t)return l}},n._addExtensionParser=function(a,t){n._extensionParsers[a]||(n._extensionParsers[a]=[]),n._extensionParsers[a].push(t)},n._createAndParse=function(a,t,e,r){for(var o=arguments.length,s=new Array(o>4?o-4:0),l=4;l<o;l++)s[l-4]=arguments[l];var u=n.getExtensionParser(a,on.CreateAndParse);if(u){var c;return(c=u).createAndParse.apply(c,[].concat(t,e,r,s))}},n._additiveParse=function(a,t,e,r,o){for(var s=arguments.length,l=new Array(s>5?s-5:0),u=5;u<s;u++)l[u-5]=arguments[u];var c=n.getExtensionParser(a,on.AdditiveParse);if(c){var d;(d=c).additiveParse.apply(d,[].concat(t,e,r,o,l))}},n}();(function(){qe._extensionParsers={}})();function mr(n,i){return function(a){var t=new a;t._mode=i,qe._addExtensionParser(n,t)}}var ep=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.glTFResource,o=e.contentRestorer,s=r.url,l=o.bufferRequests,u={type:"arraybuffer"},c=this._isGLB(s);o.isGLB=c;var d=c?Nr(s,u).then(function(_){return l.push(new Tm(s,u)),Ae.parseGLB(e,_)}).then(function(_){var f=_.glTF,v=_.buffers;return e.buffers=v,f}):Nr(s,{type:"json"});return d},a._isGLB=function(e){var r=e.lastIndexOf(".");return e.substring(r+1,r+4)==="glb"},i}(qe);ep=pe([ii(Te.Schema)],ep);var R_=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=e.glTF.animations[r],s=o.name,l=s===void 0?"AnimationClip"+r:s,u=qe.executeExtensionsCreateAndParse(o.extensions,e,o)||R_._parseStandardProperty(e,new Vf(l),o);return Promise.resolve(u).then(function(c){return qe.executeExtensionsAdditiveAndParse(o.extensions,e,c,o),c})},i._parseStandardProperty=function(e,r,o){for(var s=function(y,A){var S=f[y],x=c[S.input],C=c[S.output],E=Promise.all([Ae.getAccessorBuffer(e,d,x),Ae.getAccessorBuffer(e,d,C)]).then(function(T){var w=T[0].data,R=T[1].data;if(C.normalized){for(var b=Ae.getNormalizedComponentScale(C.componentType),B=new Float32Array(R.length),I=0,V=R.length;I<V;I++)B[I]=R[I]*b;R=B}var L=R.length/w.length,F,D=(F=S.interpolation)!=null?F:fo.Linear,N;switch(D){case fo.CubicSpine:N=Gt.CubicSpine;break;case fo.Step:N=Gt.Step;break;case fo.Linear:N=Gt.Linear;break}w[w.length-1],v.push({type:C.type,interpolation:N,input:w,output:R,outputSize:L})});g.push(E)},l=this,u=e.glTF,c=u.accessors,d=u.bufferViews,_=o.channels,f=o.samplers,v=new Array,p=e.get(Te.Entity),g=new Array,m=0,h=f.length;m<h;m++)s(m);return g.push(e.get(Te.Scene)),Promise.all(g).then(function(){for(var y=0,A=_.length;y<A;y++){for(var S=_[y],x=S.target,C=p[x.node],E="",T=C;T.parent;)E=E===""?""+T.name:T.name+"/"+E,T=T.parent;if(e.glTFResource.sceneRoots.indexOf(T)!==-1){var w=void 0,R=void 0;switch(x.path){case Wr.TRANSLATION:w=ye,R="position";break;case Wr.ROTATION:w=ye,R="rotationQuaternion";break;case Wr.SCALE:w=ye,R="scale";break;case Wr.WEIGHTS:w=Lt,R="blendShapeWeights";break}var b=l._addCurve(x.path,S,v);r.addCurveBinding(E,w,R,b)}}return r})},i._addCurve=function(e,r,o){var s=o[r.sampler],l=s.input,u=s.output,c=s.outputSize;switch(e){case Wr.TRANSLATION:case Wr.SCALE:{for(var d=new Ks,_=d.interpolation=s.interpolation,f=0,v=0,p=l.length;v<p;v++){var g=new Un;g.time=l[v],_===Gt.CubicSpine?(g.inTangent=new M(u[f++],u[f++],u[f++]),g.value=new M(u[f++],u[f++],u[f++]),g.outTangent=new M(u[f++],u[f++],u[f++])):g.value=new M(u[f++],u[f++],u[f++]),d.addKey(g)}return d}case Wr.ROTATION:{for(var m=new ko,h=m.interpolation=s.interpolation,y=0,A=0,S=l.length;A<S;A++){var x=new Un;x.time=l[A],h===Gt.CubicSpine?(x.inTangent=new ue(u[y++],u[y++],u[y++],u[y++]),x.value=new xe(u[y++],u[y++],u[y++],u[y++]),x.outTangent=new ue(u[y++],u[y++],u[y++],u[y++])):x.value=new xe(u[y++],u[y++],u[y++],u[y++]),m.addKey(x)}return m}case Wr.WEIGHTS:{var C=new Zs;C.interpolation=s.interpolation;for(var E=0,T=0,w=l.length;T<w;T++){var R=new Un;R.time=l[T],C.interpolation===Gt.CubicSpine?(R.inTangent=Array.from(u.subarray(E,E+c)),E+=c,R.value=u.slice(E,E+c),E+=c,R.outTangent=Array.from(u.subarray(E,E+c)),E+=c):(R.value=u.slice(E,E+c),E+=c),C.addKey(R)}return C}}},i}(qe);R_=pe([ii(Te.Animation)],R_);var tp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=e.glTF.buffers;return e.buffers?Promise.resolve(e.buffers[r]):this._parseSingleBuffer(e,o[r])},a._parseSingleBuffer=function(e,r){var o=e.glTFResource,s=e.contentRestorer,l=o.url,u=s.bufferRequests,c={type:"arraybuffer"},d=yt.resolveAbsoluteUrl(l,r.uri);return u.push(new Tm(d,c)),Nr(d,c)},i}(qe);tp=pe([ii(Te.Buffer)],tp);var np=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=e.glTF.nodes[r],s=e.glTFResource.engine,l=o.matrix,u=o.translation,c=o.rotation,d=o.scale,_=o.extensions,f=new Br(s,o.name||"_GLTF_ENTITY_"+r),v=f.transform;if(l){var p=v.localMatrix;p.copyFromArray(l),v.localMatrix=p}else u&&v.setPosition(u[0],u[1],u[2]),c&&v.setRotationQuaternion(c[0],c[1],c[2],c[3]),d&&v.setScale(d[0],d[1],d[2]);var g=o.children;if(g)for(var m=0;m<g.length;m++){var h=g[m],y=e.get(Te.Entity,h);f.addChild(y)}return qe.executeExtensionsAdditiveAndParse(_,e,f,o),f},i}(qe);np=pe([ii(Te.Entity)],np);var Zt=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=e.glTF.materials[r],s=e.glTFResource.engine,l=qe.executeExtensionsCreateAndParse(o.extensions,e,o);return l||(l=new ea(s),l.name=o.name,Zt._parseStandardProperty(e,l,o)),Promise.resolve(l).then(function(u){return u||(u=Zt._getDefaultMaterial(e.glTFResource.engine)),qe.executeExtensionsAdditiveAndParse(o.extensions,e,u,o),u})},i._getDefaultMaterial=function(e){var r;return(r=Zt)._defaultMaterial||(r._defaultMaterial=new cl(e))},i._checkOtherTextureTransform=function(e,r){var o;(o=e.extensions)!=null&&o.KHR_texture_transform&&ve.warn(""+r+" texture always use the KHR_texture_transform of the base texture.")},i._parseStandardProperty=function(e,r,o){var s=o.pbrMetallicRoughness,l=o.normalTexture,u=o.occlusionTexture,c=o.emissiveTexture,d=o.emissiveFactor,_=o.alphaMode,f=o.alphaCutoff,v=o.doubleSided;if(s){var p=s.baseColorFactor,g=s.baseColorTexture,m=s.metallicFactor,h=s.roughnessFactor,y=s.metallicRoughnessTexture;p&&(r.baseColor=new J(J.linearToGammaSpace(p[0]),J.linearToGammaSpace(p[1]),J.linearToGammaSpace(p[2]),p[3])),g&&e.get(Te.Texture,g.index).then(function(T){r.baseTexture=T,qe.executeExtensionsAdditiveAndParse(g.extensions,e,r,g)}),r.constructor===ea&&(r.metallic=m??1,r.roughness=h??1,y&&(Zt._checkOtherTextureTransform(y,"Roughness metallic"),e.get(Te.Texture,y.index).then(function(T){r.roughnessMetallicTexture=T})))}if(r.constructor===ea||r.constructor===Ya){if(c&&(Zt._checkOtherTextureTransform(c,"Emissive"),e.get(Te.Texture,c.index).then(function(T){r.emissiveTexture=T})),d&&(r.emissiveColor=new J(J.linearToGammaSpace(d[0]),J.linearToGammaSpace(d[1]),J.linearToGammaSpace(d[2]))),l){var A=l.index,S=l.scale;Zt._checkOtherTextureTransform(l,"Normal"),e.get(Te.Texture,A).then(function(T){r.normalTexture=T}),S!==void 0&&(r.normalTextureIntensity=S)}if(u){var x=u.index,C=u.strength,E=u.texCoord;Zt._checkOtherTextureTransform(u,"Occlusion"),e.get(Te.Texture,x).then(function(T){r.occlusionTexture=T}),C!==void 0&&(r.occlusionTextureIntensity=C),E===$i.UV1?r.occlusionTextureCoord=$i.UV1:E>$i.UV1&&ve.warn("Occlusion texture uv coordinate must be UV0 or UV1.")}}switch(v?r.renderFace=hi.Double:r.renderFace=hi.Front,_){case Es.OPAQUE:r.isTransparent=!1;break;case Es.BLEND:r.isTransparent=!0;break;case Es.MASK:r.alphaCutoff=f??.5;break}},i}(qe);Zt=pe([ii(Te.Material)],Zt);function M_(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var dd,wo=(dd=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){for(var o=function(f,v){var p=s.primitives[f];c[f]=new Promise(function(g){var m=qe.executeExtensionsCreateAndParse(p.extensions,e,p,s);if(m)M_(m,Nt)?g(m):m.then(function(A){return g(A)});else{var h=new Nt(u,s.name||f+""),y=new qC;y.mesh=h,e.contentRestorer.meshes.push(y),wo._parseMeshFromGLTFPrimitive(e,h,y,s,p,l,function(A){return null},function(A,S){var x=p.targets[S],C=x[A];if(C){var E=l.accessors[C];return Ae.getAccessorBuffer(e,e.glTF.bufferViews,E)}else return null},function(){var A=l.accessors[p.indices];return e.get(Te.Buffer).then(function(S){return Ae.getAccessorData(l,A,S)})},e.params.keepMeshData).then(g)}})},s=e.glTF.meshes[r],l=e.glTF,u=e.glTFResource.engine,c=new Array,d=0,_=s.primitives.length;d<_;d++)o(d);return Promise.all(c)},i._parseMeshFromGLTFPrimitive=function(e,r,o,s,l,u,c,d,_,f){var v=function(w){var R=p[g[w]],b=Ae.getAccessorBuffer(e,u.bufferViews,R).then(function(B){var I=Ae.getAccessorTypeSize(R.type),V=R.count,L=B.data,F,D=r.instanceId,N=B.vertexBindingInfos,O=R.normalized,k=Ae.getElementFormat(R.componentType,I,O),Q;O&&(Q=Ae.getNormalizedComponentScale(R.componentType));var H;if(B.interleaved){var ee=R.byteOffset||0,ge=B.stride;if(H=ee%ge,N[D]===void 0){F=new Le(w,H,k,C);var le=B.vertexBuffer;le||(le=new qn(A,vn.VertexBuffer,L,mt.Static,f),B.vertexBuffer=le,o.vertexBuffers.push(new Kv(le,B.restoreInfo))),r.setVertexBufferBinding(le,ge,C),N[D]=C++}else F=new Le(w,H,k,N[D])}else{H=0,F=new Le(w,H,k,C);var re=B.vertexBuffer;re||(re=new qn(A,vn.VertexBuffer,L,mt.Static,f),o.vertexBuffers.push(new Kv(re,B.restoreInfo))),r.setVertexBufferBinding(re,B.stride,C),N[D]=C++}if(S.push(F),w==="POSITION"){x=V;var Ve=r.bounds,He=Ve.min,Qe=Ve.max;if(R.min&&R.max)He.copyFromArray(R.min),Qe.copyFromArray(R.max);else{var Ee=wo._tempVector3;He.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Qe.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var ft=H/L.BYTES_PER_ELEMENT,Je=L.length/V,at=0;at<V;at++){var se=ft+at*Je;Ee.copyFromArray(L,se),M.min(He,Ee,He),M.max(Qe,Ee,Qe)}}O&&(He.scale(Q),Qe.scale(Q))}});E.push(b)},p=u.accessors,g=l.attributes,m=l.targets,h=l.indices,y=l.mode,A=r.engine,S=new Array,x,C=0,E=new Array;for(var T in g)v(T);return Promise.all(E).then(function(){if(r.setVertexElements(S),h!==void 0){var w=u.accessors[h],R=Ae.getAccessorBuffer(e,u.bufferViews,w).then(function(b){r.setIndices(b.data),r.addSubMesh(0,w.count,y),o.indexBuffer=b.restoreInfo});E.push(R)}else r.addSubMesh(0,x,y);return m&&E.push(wo._createBlendShape(r,o,s,p,m,d)),Promise.all(E).then(function(){return r.uploadData(!f),Promise.resolve(r)})})},i._createBlendShape=function(e,r,o,s,l,u){for(var c=function(p,g){var m=d?d[p]:"blendShape"+p,h=Promise.all([u("POSITION",p),u("NORMAL",p),u("TANGENT",p)]).then(function(y){var A=y[0],S=y[1],x=y[2],C=l[p],E,T,w,R=null;if(A){E=s[C.POSITION];var b;R=Ae.bufferToVector3Array(A.data,A.stride,(b=E.byteOffset)!=null?b:0,E.count)}var B=null;if(S){T=s[C.NORMAL];var I;B=Ae.bufferToVector3Array(S.data,S.stride,(I=T.byteOffset)!=null?I:0,T.count)}var V=null;if(x){w=s[C.NORMAL];var L;V=Ae.bufferToVector3Array(x.data,x.stride,(L=w.byteOffset)!=null?L:0,w.count)}var F=new Lf(m);F.addFrame(1,R,B,V),e.addBlendShape(F);var D,N,O;r.blendShapes.push(new JC(F,new cd(A.restoreInfo,A.stride,(D=E.byteOffset)!=null?D:0,E.count),S?new cd(S.restoreInfo,S.stride,(N=T.byteOffset)!=null?N:0,T.count):null,x?new cd(x.restoreInfo,x.stride,(O=w.byteOffset)!=null?O:0,w.count):null))});_.push(h)},d=o.extras?o.extras.targetNames:null,_=new Array,f=0,v=l.length;f<v;f++)c(f);return Promise.all(_)},i}(qe),function(){dd._tempVector3=new M}(),dd);wo=pe([ii(Te.Mesh)],wo);var rp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=e.glTF,s=o.scenes,l=o.scene,u=l===void 0?0:l,c=e.glTFResource,d=s[r],_=d.extensions,f=c.engine,v=u===r,p=d.nodes,g;if(p.length===1)g=e.get(Te.Entity,p[0]);else{g=new Br(f,"GLTF_ROOT");for(var m=0;m<p.length;m++){var h=e.get(Te.Entity,p[m]);g.addChild(h)}}g._hookResource=c,c._addReferCount(1),v&&(c.defaultSceneRoot=g);for(var y=new Array,A=0;A<p.length;A++)y.push(this._parseEntityComponent(e,p[A]));return Promise.all(y).then(function(){return qe.executeExtensionsAdditiveAndParse(_,e,g,d),g})},a._parseEntityComponent=function(e,r){var o=this,s=e.glTF,l=e.glTFResource,u=s.nodes[r],c=u.camera,d=u.mesh,_=e.get(Te.Entity,r),f;return c!==void 0&&this._createCamera(l,s.cameras[c],_),d!==void 0&&(f=this._createRenderer(e,u,_)),Promise.resolve(f).then(function(){var v=[],p=u.children;if(p)for(var g=0;g<p.length;g++)v.push(o._parseEntityComponent(e,p[g]));return Promise.all(v)})},a._createCamera=function(e,r,o){var s,l=r.orthographic,u=r.perspective,c=r.type,d=o.addComponent(et);if(c===$u.ORTHOGRAPHIC){var _=l.xmag,f=l.ymag,v=l.zfar,p=l.znear;d.isOrthographic=!0,p!==void 0&&(d.nearClipPlane=p),v!==void 0&&(d.farClipPlane=v),d.orthographicSize=Math.max(f??0,_??0)/2}else if(c===$u.PERSPECTIVE){var g=u.aspectRatio,m=u.yfov,h=u.zfar,y=u.znear;g!==void 0&&(d.aspectRatio=g),m!==void 0&&(d.fieldOfView=m*180/Math.PI),h!==void 0&&(d.farClipPlane=h),y!==void 0&&(d.nearClipPlane=y)}(s=e).cameras||(s.cameras=[]),e.cameras.push(d),d.enabled=!1},a._createRenderer=function(e,r,o){for(var s=function(m){var h=f[m],y=h.material;p.push(Promise.all([e.get(Te.Mesh,c),d!==void 0&&e.get(Te.Skin,d),y!==void 0&&e.get(Te.Material,y)]).then(function(A){var S=A[0],x=A[1],C=A[2],E=S[m],T;if(C||(C=Zt._getDefaultMaterial(e.glTFResource.engine)),x||v){var w=o.addComponent(Lt);w.mesh=E,x&&(w.rootBone=x._rootBone,w.bones=x._bones,l._computeLocalBounds(w,E,x._bones,x._rootBone,x.inverseBindMatrices),w.skin=x),v&&(w.blendShapeWeights=new Float32Array(v)),T=w}else T=o.addComponent(en),T.mesh=E;T.setMaterial(C),E.vertexElements.forEach(function(R){R.semantic==="COLOR_0"&&(T.enableVertexColor=!0)}),qe.executeExtensionsAdditiveAndParse(h.extensions,e,T,h)}))},l=this,u=e.glTF.meshes,c=r.mesh,d=r.skin,_=u[c],f=_.primitives,v=r.weights||_.weights,p=new Array,g=0;g<f.length;g++)s(g);return Promise.all(p)},a._computeLocalBounds=function(e,r,o,s,l){var u=o.indexOf(s);if(u!==-1)jt.transform(r.bounds,l[u],e.localBounds);else{var c=new $(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),d=this._computeApproximateBindMatrix(o,l,s,c);d!==0?($.multiplyScalar(c,1/d,c),jt.transform(r.bounds,c,e.localBounds)):e.localBounds.copyFrom(r.bounds)}},a._computeApproximateBindMatrix=function(e,r,o,s){for(var l=0,u=o.children,c=0,d=u.length;c<d;c++){var _=u[c],f=e.indexOf(_);f!==-1?($.add(s,r[f],s),l++):l+=this._computeApproximateBindMatrix(e,r,_,s)}return l},i}(qe);rp=pe([ii(Te.Scene)],rp);var ip=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=this,s=e.glTF,l=s.skins[r],u=l.inverseBindMatrices,c=l.skeleton,d=l.joints,_=l.name,f=_===void 0?"SKIN_"+r:_,v=d.length,p=new rm(f);p.inverseBindMatrices.length=v,p._bones.length=v;var g=s.accessors[u],m=Ae.getAccessorBuffer(e,s.bufferViews,g).then(function(h){for(var y=e.get(Te.Entity),A=h.data,S=0;S<v;S++){var x=new $;x.copyFromArray(A,S*16),p.inverseBindMatrices[S]=x;var C=y[d[S]];if(p._bones[S]=C,p.joints[S]=C.name,c!==void 0){var E=y[c];p._rootBone=E,p.skeleton=E.name}else{var T=o._findSkeletonRootBone(d,y);if(T)p._rootBone=T,p.skeleton=T.name;else throw"Failed to find skeleton root bone."}}return p});return Promise.resolve(m)},a._findSkeletonRootBone=function(e,r){for(var o={},s=Cs(e),l;!(l=s()).done;){for(var u=l.value,c=new Array,d=r[u];d;)c.unshift(d),d=d.parent;o[u]=c}for(var _=null,f=0;;f++){var v=o[e[0]];if(f>=v.length)return _;for(var p=v[f],g=1,m=e.length;g<m;g++)if(v=o[e[g]],f>=v.length||p!==v[f])return _;_=p}},i}(qe);ip=pe([ii(Te.Skin)],ip);var _d,tc=(_d=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,r){var o=e.glTF.textures[r],s=e.glTFResource,l=e.glTF,u=s.engine,c=s.url,d=o.sampler,_=o.source,f=_===void 0?0:_,v=o.name,p=o.extensions,g=l.images[f],m=g.uri,h=g.bufferView,y=g.mimeType,A=g.name,S=qe.executeExtensionsCreateAndParse(p,e,o);if(!S){var x=d!==void 0,C=d!==void 0&&Ae.getSamplerInfo(l.samplers[d]);if(m){var E,T=m.lastIndexOf("."),w=m.substring(T+1),R=w.startsWith("ktx")?De.KTX:De.Texture2D;S=u.resourceManager.load({url:yt.resolveAbsoluteUrl(c,m),type:R,params:{mipmap:(E=C)==null?void 0:E.mipmap}}).then(function(B){return B.name=v||A||B.name||"texture_"+r,x&&Ae.parseSampler(B,C),B})}else{var b=l.bufferViews[h];S=e.get(Te.Buffer).then(function(B){var I=B[b.buffer],V=new Uint8Array(I,b.byteOffset,b.byteLength);return Ae.loadImageBuffer(V,y).then(function(L){var F,D=new fn(u,L.width,L.height,void 0,(F=C)==null?void 0:F.mipmap);D.setImageSource(L),D.generateMipmaps(),D.name=v||A||"texture_"+r,x&&Ae.parseSampler(D,C);var N=new Rm(D,b,y);return e.contentRestorer.bufferTextures.push(N),D})})}}return Promise.resolve(S).then(function(B){return qe.executeExtensionsAdditiveAndParse(p,e,B,o),B})},i}(qe),function(){var n;_d._wrapMap=(n={},n[ws.CLAMP_TO_EDGE]=$t.Clamp,n[ws.MIRRORED_REPEAT]=$t.Mirror,n[ws.REPEAT]=$t.Repeat,n)}(),_d);tc=pe([ii(Te.Texture)],tc);var ap=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var r=e.glTF,o=r.asset.version,s=r.extensionsUsed,l=r.extensionsRequired,u=Number(o);if(!(u>=2&&u<3))throw"Only support glTF 2.x.";if(s){ve.info("extensionsUsed: ",s);for(var c=0;c<s.length;c++){var d=s[c];qe.hasExtensionParser(d)||ve.warn("Extension "+d+" is not implemented, you can customize this extension in gltf.")}}if(l){ve.info("extensionsRequired: "+l);for(var _=0;_<l.length;_++){var f=l[_];qe.hasExtensionParser(f)||ve.error("GLTF parser has not supported required extension "+f+".")}}return Promise.resolve(null)},i}(qe);ap=pe([ii(Te.Validator)],ap);var op=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=e.url,s=e.params,l=new zC(r.engine,o),u=new Wf(l,r,mn({keepMeshData:!1},s));return u.parse()},i}(ke);op=pe([ct(De.GLTF,["gltf","glb"])],op);var me,Ka=Math.PI,Ts=(me=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){var u=r.engine;o.request(e.url,{type:"arraybuffer"}).then(function(c){for(var d=new Uint8Array(c),_=Ts._parseHeader(d),f=_.width,v=_.height,p=_.dataPosition,g=Ts._readPixels(d.subarray(p),f,v),m=v>>1,h=Ts._convertToCubemap(g,f,v,m),y=new Tn(u,m),A=0;A<6;A++)y.setPixelBuffer(fr.PositiveX+A,h[A],0);y.generateMipmaps(),s(y)}).catch(l)})},i._convertToCubemap=function(e,r,o,s){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=r*o*4)throw"ConvertPanoramaToCubemap: input size is wrong";var l=this._createCubemapData(s,this._faceRight,e,r,o),u=this._createCubemapData(s,this._faceLeft,e,r,o),c=this._createCubemapData(s,this._faceUp,e,r,o),d=this._createCubemapData(s,this._faceBottom,e,r,o),_=this._createCubemapData(s,this._faceFront,e,r,o),f=this._createCubemapData(s,this._faceBack,e,r,o);return[l,u,c,d,_,f]},i._createCubemapData=function(e,r,o,s,l){for(var u=new Uint8ClampedArray(e*e*4),c=this._tempVector3.set(0,0,0).add(r[1]).subtract(r[0]).scale(1/e),d=this._temp2Vector3.set(0,0,0).add(r[3]).subtract(r[2]).scale(1/e),_=1/e,f=0,v=0;v<e;v++){for(var p=this._temp3Vector3.set(0,0,0).add(r[0]),g=this._temp4Vector3.set(0,0,0).add(r[2]),m=0;m<e;m++){var h=this._temp5Vector3.set(0,0,0).add(g).subtract(p).scale(f).add(p);h.normalize();var y=this._calcProjectionSpherical(h,o,s,l);this._RGBEToLinear(y),this._linearToRGBM(y,5);var A=v*e*4+m*4;u[A]=y.r,u[A+1]=y.g,u[A+2]=y.b,u[A+3]=y.a,p.add(c),g.add(d)}f+=_}return u},i._calcProjectionSpherical=function(e,r,o,s){for(var l=Math.atan2(e.z,e.x),u=Math.acos(e.y);l<-Ka;)l+=2*Ka;for(;l>Ka;)l-=2*Ka;var c=l/Ka,d=u/Ka;c=c*.5+.5;var _=Math.round(c*o);_<0?_=0:_>=o&&(_=o-1);var f=Math.round(d*s);f<0?f=0:f>=s&&(f=s-1);var v=s-f-1,p=v*o*4+_*4,g=r[p],m=r[p+1],h=r[p+2],y=r[p+3];return new J(g,m,h,y)},i._readStringLine=function(e,r){for(var o="",s="",l=r;l<e.length-r&&(s=String.fromCharCode(e[l]),s!=`
`);l++)o+=s;return o},i._parseHeader=function(e){var r=0,o=0,s=this._readStringLine(e,0);if(s[0]!="#"||s[1]!="?")throw"Bad HDR Format.";var l=!1,u=!1,c=0;do c+=s.length+1,s=this._readStringLine(e,c),s=="FORMAT=32-bit_rle_rgbe"?u=!0:s.length==0&&(l=!0);while(!l);if(!u)throw"HDR Bad header format, unsupported FORMAT";c+=s.length+1,s=this._readStringLine(e,c);var d=/^\-Y (.*) \+X (.*)$/g,_=d.exec(s);if(!_||_.length<3)throw"HDR Bad header format, no size";if(o=parseInt(_[2]),r=parseInt(_[1]),o<8||o>32767)throw"HDR Bad header format, unsupported size";return c+=s.length+1,{height:r,width:o,dataPosition:c}},i._readPixels=function(e,r,o){for(var s=r,l=e.byteLength,u=new Uint8Array(4*r*o),c=0,d=0,_=4*s,f=new Uint8Array(4),v=new Uint8Array(_),p=o;p>0&&d<l;){if(f[0]=e[d++],f[1]=e[d++],f[2]=e[d++],f[3]=e[d++],f[0]!=2||f[1]!=2||(f[2]<<8|f[3])!=s)throw"HDR Bad header format, wrong scan line width";for(var g=0,m=void 0;g<_&&d<l;){m=e[d++];var h=m>128;if(h&&(m-=128),m===0||g+m>_)throw"HDR Bad Format, bad scanline data (run)";if(h)for(var y=e[d++],A=0;A<m;A++)v[g++]=y;else v.set(e.subarray(d,d+m),g),g+=m,d+=m}for(var S=s,x=0;x<S;x++){var C=0;u[c]=v[x+C],C+=s,u[c+1]=v[x+C],C+=s,u[c+2]=v[x+C],C+=s,u[c+3]=v[x+C],c+=4}p--}return u},i._RGBEToLinear=function(e){var r=Math.pow(2,e.a-128)/255;e.r*=r,e.g*=r,e.b*=r,e.a=1},i._linearToRGBM=function(e,r){var o=Math.max(e.r,Math.max(e.g,e.b)),s=Math.min(o/r,1);s=Math.ceil(s*255);var l=65025/(s*r);e.r*=l,e.g*=l,e.b*=l,e.a*=s},i}(ke),function(){me._rightBottomBack=new M(1,-1,-1)}(),function(){me._rightBottomFront=new M(1,-1,1)}(),function(){me._rightUpBack=new M(1,1,-1)}(),function(){me._rightUpFront=new M(1,1,1)}(),function(){me._leftBottomBack=new M(-1,-1,-1)}(),function(){me._leftBottomFront=new M(-1,-1,1)}(),function(){me._leftUpBack=new M(-1,1,-1)}(),function(){me._leftUpFront=new M(-1,1,1)}(),function(){me._faceRight=[me._rightBottomBack,me._rightBottomFront,me._rightUpBack,me._rightUpFront]}(),function(){me._faceLeft=[me._leftBottomFront,me._leftBottomBack,me._leftUpFront,me._leftUpBack]}(),function(){me._faceUp=[me._leftBottomFront,me._rightBottomFront,me._leftBottomBack,me._rightBottomBack]}(),function(){me._faceBottom=[me._leftUpBack,me._rightUpBack,me._leftUpFront,me._rightUpFront]}(),function(){me._faceFront=[me._leftBottomBack,me._rightBottomBack,me._leftUpBack,me._rightUpBack]}(),function(){me._faceBack=[me._rightBottomFront,me._leftBottomFront,me._rightUpFront,me._leftUpFront]}(),function(){me._tempVector3=new M}(),function(){me._temp2Vector3=new M}(),function(){me._temp3Vector3=new M}(),function(){me._temp4Vector3=new M}(),function(){me._temp5Vector3=new M}(),me);Ts=pe([ct(De.HDR,["hdr"])],Ts);var sp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e){return this.request(e.url,mn({},e,{type:"json"}))},i}(ke);sp=pe([ct(De.JSON,["json"],!1)],sp);var ZC=12+13*4,KC=0;function $C(n,i){for(var a=[],t=ZC+n.bytesOfKeyValueData,e=n.pixelWidth,r=n.pixelHeight,o=i?n.numberOfMipmapLevels:1,s=0;s<o;s++){var l=new Int32Array(n.buffer,t,1)[0];t+=4;for(var u=0;u<n.numberOfFaces;u++){var c=new Uint8Array(n.buffer,t,l);a.push({data:c,width:e,height:r}),t+=l,t+=3-(l+3)%4}e=Math.max(1,e*.5),r=Math.max(1,r*.5)}return a}function eE(n){if(n.byteLength>=12){var i=new Uint8Array(n,0,12);if(i[0]===171&&i[1]===75&&i[2]===84&&i[3]===88&&i[4]===32&&i[5]===49&&i[6]===49&&i[7]===187&&i[8]===13&&i[9]===10&&i[10]===26&&i[11]===10)return!0}return!1}function tE(n){switch(n){case ce.RGB_S3TC_DXT1_EXT:return X.BC1;case ce.RGBA_S3TC_DXT5_EXT:return X.BC3;case ce.RGBA_BPTC_UNORM_EXT:return X.BC7;case ce.RGB_ETC1_WEBGL:return X.ETC1_RGB;case ce.RGB8_ETC2:return X.ETC2_RGB;case ce.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return X.ETC2_RGBA5;case ce.RGBA8_ETC2_EAC:return X.ETC2_RGBA8;case ce.RGB_PVRTC_2BPPV1_IMG:return X.PVRTC_RGB2;case ce.RGBA_PVRTC_2BPPV1_IMG:return X.PVRTC_RGBA2;case ce.RGB_PVRTC_4BPPV1_IMG:return X.PVRTC_RGB4;case ce.RGBA_PVRTC_4BPPV1_IMG:return X.PVRTC_RGBA4;case ce.RGBA_ASTC_4X4_KHR:return X.ASTC_4x4;case ce.RGBA_ASTC_5X5_KHR:return X.ASTC_5x5;case ce.RGBA_ASTC_6X6_KHR:return X.ASTC_6x6;case ce.RGBA_ASTC_8X8_KHR:return X.ASTC_8x8;case ce.RGBA_ASTC_10X10_KHR:return X.ASTC_10x10;case ce.RGBA_ASTC_12X12_KHR:return X.ASTC_12x12;default:var i=ce[n];throw new Error("this format is not supported in Galacean Engine: "+i)}}var Mm={parse:function(i,a,t,e){if(e===void 0&&(e=!1),!eE(i))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var r=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(i,12,13*r),s=o.getUint32(0,!0),l=s===67305985,u={buffer:i,glType:o.getUint32(1*r,l),glTypeSize:o.getUint32(2*r,l),glFormat:o.getUint32(3*r,l),glInternalFormat:o.getUint32(4*r,l),glBaseInternalFormat:o.getUint32(5*r,l),pixelWidth:o.getUint32(6*r,l),pixelHeight:o.getUint32(7*r,l),pixelDepth:o.getUint32(8*r,l),numberOfArrayElements:o.getUint32(9*r,l),numberOfFaces:o.getUint32(10*r,l),numberOfMipmapLevels:o.getUint32(11*r,l),bytesOfKeyValueData:o.getUint32(12*r,l),loadType:KC};if(u.glType!==0)throw new Error("only compressed formats currently supported");if(u.numberOfMipmapLevels=Math.max(1,u.numberOfMipmapLevels),u.pixelHeight===0||u.pixelDepth!==0)throw new Error("only 2D textures currently supported");if(u.numberOfArrayElements!==0)throw new Error("texture arrays not currently supported");if(u.numberOfFaces!==a)throw new Error("number of faces expected"+a+", but found "+u.numberOfFaces);return t&&(u.mipmaps=$C(u,!0)),e&&(u.engineFormat=tE(u.glInternalFormat)),u}};function nE(n){var i=Mm.parse(n,1,!0,!0);return{mipmaps:i.mipmaps,engineFormat:i.engineFormat,internalFormat:i.glInternalFormat,width:i.pixelWidth,height:i.pixelHeight}}function rE(n){for(var i=[],a,t,e,r,o=0;o<n.length;o++){var s=Mm.parse(n[o],1,!0,!0);i.push(s.mipmaps),o===0&&(e=s.pixelWidth,r=s.pixelHeight,a=s.glInternalFormat,t=s.engineFormat)}return{mipmapsFaces:i,engineFormat:t,internalFormat:a,width:e,height:r}}var lp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,mn({},e,{type:"arraybuffer"}))})).then(function(u){for(var c=rE(u),d=c.width,_=c.mipmapsFaces,f=c.engineFormat,v=_[0].length>1,p=new Tn(r.engine,d,f,v),g=0;g<6;g++)for(var m=_[g].length,h=0;h<m;h++){var y=_[g][h],A=y.data,S=y.width,x=y.height;p.setPixelBuffer(fr.PositiveX+g,A,h,0,0,S,x)}s(p)}).catch(function(u){l(u)})})},i}(ke);lp=pe([ct(De.KTXCube,[])],lp);var up=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,mn({},e,{type:"arraybuffer"})).then(function(u){for(var c=nE(u),d=c.width,_=c.height,f=c.mipmaps,v=c.engineFormat,p=f.length>1,g=new fn(r.engine,d,_,v,p),m=0;m<f.length;m++){var h=f[m],y=h.width,A=h.height,S=h.data;g.setPixelBuffer(S,m,0,0,y,A)}s(g)}).catch(function(u){l(u)})})},i}(ke);up=pe([ct(De.KTX,["ktx"])],up);function Pm(n,i,a){if(typeof a=="object")for(var t in a)Pm(n[i],t,a[t]);else n[i]=a}var cp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,mn({},e,{type:"json"})).then(function(u){var c=function(w){var R=v[w],b=R.type,B=R.value;switch(b){case"Vector2":y.setVector2(w,new te(B.x,B.y));break;case"Vector3":y.setVector3(w,new M(B.x,B.y,B.z));break;case"Vector4":y.setVector4(w,new ue(B.x,B.y,B.z,B.w));break;case"Color":y.setColor(w,new J(B.r,B.g,B.b,B.a));break;case"Float":y.setFloat(w,B);break;case"Texture":h.push(r.getResourceByRef(B).then(function(I){y.setTexture(w,I)}));break;case"Boolean":y.setInt(w,B?1:0);break;case"Integer":y.setInt(w,Number(B));break}},d=r.engine,_=u.name,f=u.shader,v=u.shaderData,p=u.macros,g=u.renderState,m=new Lr(d,be.find(f));m.name=_;var h=new Array,y=m.shaderData;for(var A in v)c(A);for(var S=0,x=p.length;S<x;S++){var C=p[S],E=C.name,T=C.value;T==null?y.enableMacro(E):y.enableMacro(E,T)}return Pm(m,"renderState",g),Promise.all(h).then(function(){s(m)})}).catch(l)})},i}(ke);cp=pe([ct(De.Material,["json"])],cp);var dp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,mn({},e,{type:"arraybuffer"})).then(function(u){return Pc(u,r.engine)}).then(function(u){s(u)}).catch(l)})},i}(ke);dp=pe([ct(De.Mesh,["mesh"])],dp);var _p=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){var u=e.url;o._registerFont(u,u).then(function(){var c=new No(r.engine,u);s(c)}).catch(function(c){l("load font "+u+" fail")})})},a._registerFont=function(e,r){return Bc(function(){var o;return Mc(this,function(s){switch(s.label){case 0:return o=new FontFace(e,"url("+r+")"),[4,o.load()];case 1:return s.sent(),document.fonts.add(o),[2]}})})()},i}(ke);_p=pe([ct(De.SourceFont,["ttf","otf","woff"],!1)],_p);var fp=function(n){de(i,n);function i(){var t;return t=n.apply(this,arguments)||this,t._tempRect=new Rr,t._tempVec2=new te,t._tempVec4=new ue,t}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l,u,c){var d=[];c(function(){for(var f=0;f<d.length;f++)d[f].cancel()});var _=o.request(e.url,mn({},e,{type:"json"}));d.push(_),_.then(function(f){var v=function(w){var R=p[w];if(R.img){var b;d.push(r.load({url:yt.resolveAbsoluteUrl(e.url,R.img),type:(b=R.type)!=null?b:De.Texture2D,params:{format:S,mipmap:g}}).then(function(I){m&&(I.anisoLevel=m),h!==void 0&&(I.filterMode=h),y!==void 0&&(I.wrapModeU=y),A!==void 0&&(I.wrapModeV=A);for(var V=0;V<R.sprites.length;V++)E._addSprite(o._makeSprite(C,R.sprites[V],I))}).catch(l))}else for(var B=0;B<R.sprites.length;B++)E._addSprite(o._makeSprite(C,R.sprites[B]))},p=f.atlasItems,g=f.mipmap,m=f.anisoLevel,h=f.filterMode,y=f.wrapModeU,A=f.wrapModeV,S=f.format,x=p?p.length:0,C=r.engine,E=new cm(C);if(x<0){s(E);return}d.length=0;for(var T=0;T<p.length;T++)v(T);Oe.all(d).then(function(){s(E)}).catch(l)}).catch(l)})},a._makeSprite=function(e,r,o){var s=r.region,l=r.atlasRegionOffset,u=r.atlasRegion,c=r.pivot,d=r.border,_=new wr(e,o,s?this._tempRect.set(s.x,s.y,s.w,s.h):void 0,c?this._tempVec2.set(c.x,c.y):void 0,d?this._tempVec4.set(d.x,d.y,d.z,d.w):void 0,r.name);if(o){var f=1/o.width,v=1/o.height;if(_.atlasRegion.set(u.x*f,u.y*v,u.w*f,u.h*v),l){var p=l.x,g=l.y,m=l.z,h=l.w;_.atlasRegionOffset.set(p*f,g*v,m*f,h*v)}r.atlasRotated&&(_.atlasRotated=!0)}return _},i}(ke);fp=pe([ct(De.SpriteAtlas,["atlas"],!1)],fp);var hp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){o.request(e.url,mn({},e,{type:"json"})).then(function(u){u.belongToAtlas?r.getResourceByRef(u.belongToAtlas).then(function(c){s(c.getSprite(u.fullPath))}).catch(l):u.texture?r.getResourceByRef(u.texture).then(function(c){s(new wr(r.engine,c,u.region,u.pivot,u.border))}).catch(l):s(new wr(r.engine,null,u.region,u.pivot,u.border))}).catch(l)})},i}(ke);hp=pe([ct(De.Sprite,["sprite"],!1)],hp);var iE=function(n){de(i,n);function i(t,e,r){var o;return o=n.call(this,t)||this,o.url=e,o.requestConfig=r,o}var a=i.prototype;return a.restoreContent=function(){var e=this;return Nr(this.url,this.requestConfig).then(function(r){var o=e.resource;return o.setImageSource(r),o.generateMipmaps(),o})},i}(gi),vp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){var u=e.url,c=mn({},e,{type:"image"});o.request(u,c).then(function(d){var _,f=(_=e.params)!=null?_:{},v=f.format,p=f.mipmap,g=f.anisoLevel,m=f.wrapModeU,h=f.wrapModeV,y=f.filterMode,A=new fn(r.engine,d.width,d.height,v,p);if(A.anisoLevel=g??A.anisoLevel,A.filterMode=y??A.filterMode,A.wrapModeU=m??A.wrapModeU,A.wrapModeV=h??A.wrapModeV,A.setImageSource(d),A.generateMipmaps(),u.indexOf("data:")!==0){var S=u.lastIndexOf("/");A.name=u.substring(S+1)}r.addContentRestorer(new iE(A,u,c)),s(A)}).catch(function(d){l(d)})})},i}(ke);vp=pe([ct(De.Texture2D,["png","jpg","webp","jpeg"])],vp);var aE=function(n){de(i,n);function i(t,e,r){var o;return o=n.call(this,t)||this,o.urls=e,o.requestConfig=r,o}var a=i.prototype;return a.restoreContent=function(){var e=this;return new Oe(function(r,o){Promise.all(e.urls.map(function(s){return Nr(s,e.requestConfig)})).then(function(s){for(var l=e.resource,u=0;u<6;u++)l.setImageSource(fr.PositiveX+u,s[u],0);l.generateMipmaps(),r(l)}).catch(function(s){o(s)})})},i}(gi),pp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this;return new Oe(function(s,l){var u=e.urls,c=mn({},e,{type:"image"});Promise.all(u.map(function(d){return o.request(d,c)})).then(function(d){var _=d[0],f=_.width,v=_.height;if(f!==v){console.error("The cube texture must have the same width and height");return}for(var p=new Tn(r.engine,f),g=0;g<6;g++)p.setImageSource(fr.PositiveX+g,d[g],0);p.generateMipmaps(),r.addContentRestorer(new aE(p,u,c)),s(p)}).catch(function(d){l(d)})})},i}(ke);pp=pe([ct(De.TextureCube,[""])],pp);var gp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this,s=r.engine;return new Oe(function(l,u){o.request(e.url,{type:"json"}).then(function(c){return s.resourceManager.initVirtualResources(c.files),r.load({type:De.Scene,url:c.scene}).then(function(d){s.sceneManager.activeScene=d,l()})}).catch(u)})},i}(ke);gp=pe([ct(De.Project,["proj"],!1)],gp);var mp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.load=function(e,r){var o=this,s=r.engine;return new Oe(function(l,u){o.request(e.url,{type:"json"}).then(function(c){return FC.parse(s,c).then(function(d){var _=[],f=c.scene.ambient;if(f){var v=f.specularMode==="Custom",p=f.diffuseMode===Ga.SphericalHarmonics;d.ambientLight.diffuseIntensity=f.diffuseIntensity,d.ambientLight.specularIntensity=f.specularIntensity,d.ambientLight.diffuseMode=f.diffuseMode,d.ambientLight.diffuseSolidColor.copyFrom(f.diffuseSolidColor),d.ambientLight.specularTextureDecodeRGBM=!0,v&&f.customAmbientLight&&_.push(r.getResourceByRef(f.customAmbientLight).then(function(S){var x;d.ambientLight.specularTexture=(x=S)==null?void 0:x.specularTexture})),f.ambientLight&&(!v||p)&&_.push(r.getResourceByRef(f.ambientLight).then(function(S){if(!v){var x;d.ambientLight.specularTexture=(x=S)==null?void 0:x.specularTexture}if(p){var C;d.ambientLight.diffuseSphericalHarmonics=(C=S)==null?void 0:C.diffuseSphericalHarmonics}}))}var g=c.scene.background;switch(d.background.mode=g.mode,d.background.mode){case Ai.SolidColor:d.background.solidColor.copyFrom(g.color);break;case Ai.Sky:if(g.skyMesh&&g.skyMaterial){var m=r.getResourceByRef(g.skyMesh).then(function(S){d.background.sky.mesh=S}),h=r.getResourceByRef(g.skyMaterial).then(function(S){d.background.sky.material=S});_.push(m,h)}else ve.warn("Sky background mode requires skyMesh and skyMaterial");break;case Ai.Texture:if(g.texture){var y=r.getResourceByRef(g.texture).then(function(S){d.background.texture=S});_.push(y)}break}var A=c.scene.shadow;return A&&(A.castShadows!=null&&(d.castShadows=A.castShadows),A.shadowResolution!=null&&(d.shadowResolution=A.shadowResolution),A.shadowDistance!=null&&(d.shadowDistance=A.shadowDistance),A.shadowCascades!=null&&(d.shadowCascades=A.shadowCascades)),Promise.all(_).then(function(){l(d)})})}).catch(u)})},i}(ke);mp=pe([ct(De.Scene,["scene"],!0)],mp);Hf.registerCustomParseComponent("TextRenderer",Bc(function(n,i){var a;return Mc(this,function(t){return a=i.props,a.font||(n.font=No.createFromOS(n.engine,a.fontFamily||"Arial")),[2,n]})}));var fd,ho=(fd=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,r,o,s){var l=this;this._initialize();var u=e.glTF,c=e.glTFResource.engine,d=u.bufferViews,_=u.accessors,f=r.bufferView,v=r.attributes,p={},g={};for(var m in v)p[m]=v[m];for(var h in o.attributes)if(v[h]!==void 0){var y=_[o.attributes[h]];g[h]=Ae.getComponentType(y.componentType).name}var A=_[o.indices],S=Ae.getComponentType(A.componentType).name,x={attributeIDs:p,attributeTypes:g,useUniqueIDs:!0,indexType:S};return e.get(Te.Buffer).then(function(C){var E=Ae.getBufferViewData(d[f],C);return ho._decoder.decode(E,x).then(function(T){var w=new Nt(c,s.name);return l._parseMeshFromGLTFPrimitiveDraco(w,s,o,u,function(R){for(var b=0;b<T.attributes.length;b++)if(T.attributes[b].name===R)return T.attributes[b].array;return null},function(R,b){throw"BlendShape animation is not supported when using draco."},function(){return T.index.array},e.params.keepMeshData)})})},a._initialize=function(){ho._decoder||(ho._decoder=new PC)},a._parseMeshFromGLTFPrimitiveDraco=function(e,r,o,s,l,u,c,d){var _=o.attributes,f=o.targets,v=o.indices,p=o.mode,g,m=s.accessors,h=m[_.POSITION],y=l("POSITION"),A=Ae.floatBufferToVector3Array(y);e.setPositions(A);var S=e.bounds;if(g=h.count,h.min&&h.max)S.min.copyFromArray(h.min),S.max.copyFromArray(h.max);else{var x=ho._tempVector3,C=S.min,E=S.max;C.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var T=y.length/g,w=0;w<g;w++){var R=w*T;x.copyFromArray(y,R),M.min(C,x,C),M.max(E,x,E)}}for(var b in _)if(b!=="POSITION"){var B=l(b);switch(b){case"NORMAL":var I=Ae.floatBufferToVector3Array(B);e.setNormals(I);break;case"TEXCOORD_0":var V=Ae.floatBufferToVector2Array(B);e.setUVs(V,0);break;case"TEXCOORD_1":var L=Ae.floatBufferToVector2Array(B);e.setUVs(L,1);break;case"TEXCOORD_2":var F=Ae.floatBufferToVector2Array(B);e.setUVs(F,2);break;case"TEXCOORD_3":var D=Ae.floatBufferToVector2Array(B);e.setUVs(D,3);break;case"TEXCOORD_4":var N=Ae.floatBufferToVector2Array(B);e.setUVs(N,4);break;case"TEXCOORD_5":var O=Ae.floatBufferToVector2Array(B);e.setUVs(O,5);break;case"TEXCOORD_6":var k=Ae.floatBufferToVector2Array(B);e.setUVs(k,6);break;case"TEXCOORD_7":var Q=Ae.floatBufferToVector2Array(B);e.setUVs(Q,7);break;case"COLOR_0":var H=Ae.floatBufferToColorArray(B,m[_.COLOR_0].type===Xr.VEC3);e.setColors(H);break;case"TANGENT":var ee=Ae.floatBufferToVector4Array(B);e.setTangents(ee);break;case"JOINTS_0":var ge=Ae.floatBufferToVector4Array(B);e.setBoneIndices(ge);break;case"WEIGHTS_0":var le=Ae.floatBufferToVector4Array(B);e.setBoneWeights(le);break}}if(v!==void 0){var re=s.accessors[v],Ve=c();e.setIndices(Ve),e.addSubMesh(0,re.count,p)}else e.addSubMesh(0,g,p);return f&&wo._createBlendShape(e,null,r,m,f,u),e.uploadData(!d),Promise.resolve(e)},i}(gr),function(){fd._tempVector3=new M}(),fd);ho=pe([mr("KHR_draco_mesh_compression",on.CreateAndParse)],ho);var yp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,r,o){var s,l=e.glTF.extensions.KHR_lights_punctual.lights,u=l[o.light],c=u.color,d=u.intensity,_=d===void 0?1:d,f=u.type,v=u.range,p=u.spot,g=e.glTFResource,m;if(f==="directional"?m=r.addComponent(aa):f==="point"?m=r.addComponent(da):f==="spot"&&(m=r.addComponent(hr)),c&&m.color.set(c[0],c[1],c[2],1),m.intensity=_,v&&!M_(m,aa)&&(m.distance=v),p&&M_(m,hr)){var h=p.innerConeAngle,y=h===void 0?0:h,A=p.outerConeAngle,S=A===void 0?Math.PI/4:A;m.angle=y,m.penumbra=S-y}(s=g).lights||(s.lights=[]),g.lights.push(m)},i}(gr);yp=pe([mr("KHR_lights_punctual",on.AdditiveParse)],yp);var Ap=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,r,o){var s=o.clearcoatFactor,l=s===void 0?0:s,u=o.clearcoatTexture,c=o.clearcoatRoughnessFactor,d=c===void 0?0:c,_=o.clearcoatRoughnessTexture,f=o.clearcoatNormalTexture;r.clearCoat=l,r.clearCoatRoughness=d,u&&(Zt._checkOtherTextureTransform(u,"Clear coat"),e.get(Te.Texture,u.index).then(function(v){r.clearCoatTexture=v})),_&&(Zt._checkOtherTextureTransform(_,"Clear coat roughness"),e.get(Te.Texture,_.index).then(function(v){r.clearCoatRoughnessTexture=v})),f&&(Zt._checkOtherTextureTransform(f,"Clear coat normal"),e.get(Te.Texture,f.index).then(function(v){r.clearCoatNormalTexture=v}))},i}(gr);Ap=pe([mr("KHR_materials_clearcoat",on.AdditiveParse)],Ap);var xp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,r,o){var s=o.ior,l=s===void 0?1.5:s;r.ior=l},i}(gr);xp=pe([mr("KHR_materials_ior",on.AdditiveParse)],xp);var Sp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,r,o){var s=e.glTFResource.engine,l=new Ya(s),u=r.diffuseFactor,c=r.diffuseTexture,d=r.specularFactor,_=r.glossinessFactor,f=r.specularGlossinessTexture;return u&&(l.baseColor=new J(J.linearToGammaSpace(u[0]),J.linearToGammaSpace(u[1]),J.linearToGammaSpace(u[2]),u[3])),c&&e.get(Te.Texture,c.index).then(function(v){l.baseTexture=v,qe.executeExtensionsAdditiveAndParse(c.extensions,e,l,c)}),d&&(l.specularColor=new J(J.linearToGammaSpace(d[0]),J.linearToGammaSpace(d[1]),J.linearToGammaSpace(d[2]))),_!==void 0&&(l.glossiness=_),f&&(Zt._checkOtherTextureTransform(f,"Specular glossiness"),e.get(Te.Texture,f.index).then(function(v){l.specularGlossinessTexture=v})),l.name=o.name,Zt._parseStandardProperty(e,l,o),l},i}(gr);Sp=pe([mr("KHR_materials_pbrSpecularGlossiness",on.CreateAndParse)],Sp);var Cp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,r,o){var s=e.glTFResource.engine,l=new Gu(s);return l.name=o.name,Zt._parseStandardProperty(e,l,o),l},i}(gr);Cp=pe([mr("KHR_materials_unlit",on.CreateAndParse)],Cp);var Ep=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,r,o){var s=function(m){var h=v[m],y=h.material,A=h.variants;e.get(Te.Material,y).then(function(S){p.push({renderer:r,material:S,variants:A.map(function(x){return _[x].name})})})},l,u=e.glTF,c=u.extensions,d=c.KHR_materials_variants,_=d.variants,f=e.glTFResource,v=o.mappings;(l=f).extensionsData||(l.extensionsData={});var p=[];f.extensionsData.variants=p;for(var g=0;g<v.length;g++)s(g)},i}(gr);Ep=pe([mr("KHR_materials_variants",on.AdditiveParse)],Ep);var wp=function(n){de(i,n);function i(){return n.apply(this,arguments)}return i}(gr);wp=pe([mr("KHR_mesh_quantization",on.AdditiveParse)],wp);var Tp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,r,o){return Bc(function(){var s,l,u,c,d,_,f,v,p,g,m,h,y,A,S;return Mc(this,function(x){return s=e.glTF,l=e.glTFResource,u=l.engine,c=l.url,d=o.sampler,_=o.name,f=r.source,v=s.images[f],p=v.uri,g=v.bufferView,m=v.mimeType,h=v.name,y=d!==void 0&&Ae.getSamplerInfo(s.samplers[d]),p?(A=p.lastIndexOf("."),[2,u.resourceManager.load({url:yt.resolveAbsoluteUrl(c,p),type:De.KTX2}).then(function(C){return C.name||(C.name=_||h||"texture_"+A),d!==void 0&&Ae.parseSampler(C,y),C})]):(S=s.bufferViews[g],[2,e.get(Te.Buffer,S.buffer).then(function(C){var E=new Uint8Array(C,S.byteOffset,S.byteLength);return Ut._parseBuffer(E,u).then(function(T){var w=T.engine,R=T.result,b=T.targetFormat,B=T.params;return Ut._createTextureByBuffer(w,R,b,B)}).then(function(T){T.name=_||h||"texture_"+g,d!==void 0&&Ae.parseSampler(T,y);var w=new Rm(T,S,m);return e.contentRestorer.bufferTextures.push(w),T})})])})})()},i}(gr);Tp=pe([mr("KHR_texture_basisu",on.CreateAndParse)],Tp);var Rp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,r,o){var s=o.offset,l=o.rotation,u=o.scale,c=o.texCoord;s&&(r.tilingOffset.z=s[0],r.tilingOffset.w=s[1]),u&&(r.tilingOffset.x=u[0],r.tilingOffset.y=u[1]),l&&ve.warn("rotation in KHR_texture_transform is not supported now"),c&&ve.warn("texCoord in KHR_texture_transform is not supported now")},i}(gr);Rp=pe([mr("KHR_texture_transform",on.AdditiveParse)],Rp);var Mp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,r){var o=e.glTFResource.engine;return o.resourceManager.getResourceByRef(r)},i}(gr);Mp=pe([mr("GALACEAN_materials_remap",on.CreateAndParse)],Mp);var Pp=function(n){de(i,n);function i(){return n.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,r,o){e.glTFResource.engine;var s=o.events;s.map(function(l){var u=new Tc;u.functionName=l.functionName,u.time=l.time,u.parameter=l.parameter,r.addEvent(u)})},i}(gr);Pp=pe([mr("GALACEAN_animation_event",on.AdditiveParse)],Pp);var oE="1.1.0-beta.27";console.log("Galacean engine version: "+oE);for(var Bp in Tv)ke.registerClass(Bp,Tv[Bp]);var To=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return this.None(n)},Out:function(n){return this.None(n)},InOut:function(n){return this.None(n)}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var i=1.70158;return n===1?1:n*n*((i+1)*n-i)},Out:function(n){var i=1.70158;return n===0?0:--n*n*((i+1)*n+i)+1},InOut:function(n){var i=2.5949095;return(n*=2)<1?.5*(n*n*((i+1)*n-i)):.5*((n-=2)*n*((i+1)*n+i)+2)}}),Bounce:Object.freeze({In:function(n){return 1-To.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?To.Bounce.In(n*2)*.5:To.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(i){return Math.pow(i,n)},Out:function(i){return 1-Math.pow(1-i,n)},InOut:function(i){return i<.5?Math.pow(i*2,n)/2:(1-Math.pow(2-i*2,n))/2+.5}}}}),fs=function(){return performance.now()},sE=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var i=this;return Object.keys(this._tweens).map(function(a){return i._tweens[a]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(i){this._tweens[i.getId()]=i,this._tweensAddedDuringUpdate[i.getId()]=i},n.prototype.remove=function(i){delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]},n.prototype.update=function(i,a){i===void 0&&(i=fs()),a===void 0&&(a=!1);var t=Object.keys(this._tweens);if(t.length===0)return!1;for(;t.length>0;){this._tweensAddedDuringUpdate={};for(var e=0;e<t.length;e++){var r=this._tweens[t[e]],o=!a;r&&r.update(i,o)===!1&&!a&&delete this._tweens[t[e]]}t=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),vo={Linear:function(n,i){var a=n.length-1,t=a*i,e=Math.floor(t),r=vo.Utils.Linear;return i<0?r(n[0],n[1],t):i>1?r(n[a],n[a-1],a-t):r(n[e],n[e+1>a?a:e+1],t-e)},Bezier:function(n,i){for(var a=0,t=n.length-1,e=Math.pow,r=vo.Utils.Bernstein,o=0;o<=t;o++)a+=e(1-i,t-o)*e(i,o)*n[o]*r(t,o);return a},CatmullRom:function(n,i){var a=n.length-1,t=a*i,e=Math.floor(t),r=vo.Utils.CatmullRom;return n[0]===n[a]?(i<0&&(e=Math.floor(t=a*(1+i))),r(n[(e-1+a)%a],n[e],n[(e+1)%a],n[(e+2)%a],t-e)):i<0?n[0]-(r(n[0],n[0],n[1],n[1],-t)-n[0]):i>1?n[a]-(r(n[a],n[a],n[a-1],n[a-1],t-a)-n[a]):r(n[e?e-1:0],n[e],n[a<e+1?a:e+1],n[a<e+2?a:e+2],t-e)},Utils:{Linear:function(n,i,a){return(i-n)*a+n},Bernstein:function(n,i){var a=vo.Utils.Factorial;return a(n)/a(i)/a(n-i)},Factorial:function(){var n=[1];return function(i){var a=1;if(n[i])return n[i];for(var t=i;t>1;t--)a*=t;return n[i]=a,a}}(),CatmullRom:function(n,i,a,t,e){var r=(a-n)*.5,o=(t-i)*.5,s=e*e,l=e*s;return(2*i-2*a+r+o)*l+(-3*i+3*a-2*r-o)*s+r*e+i}}},lE=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),P_=new sE,ss=function(){function n(i,a){a===void 0&&(a=P_),this._object=i,this._group=a,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=To.Linear.None,this._interpolationFunction=vo.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=lE.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.to=function(i,a){if(a===void 0&&(a=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=i,this._propertiesAreSetUp=!1,this._duration=a,this},n.prototype.duration=function(i){return i===void 0&&(i=1e3),this._duration=i,this},n.prototype.dynamic=function(i){return i===void 0&&(i=!1),this._isDynamic=i,this},n.prototype.start=function(i,a){if(i===void 0&&(i=fs()),a===void 0&&(a=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var t in this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=i,this._startTime+=this._delayTime,!this._propertiesAreSetUp||a){if(this._propertiesAreSetUp=!0,!this._isDynamic){var e={};for(var r in this._valuesEnd)e[r]=this._valuesEnd[r];this._valuesEnd=e}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,a)}return this},n.prototype.startFromCurrentValues=function(i){return this.start(i,!0)},n.prototype._setupProperties=function(i,a,t,e,r){for(var o in t){var s=i[o],l=Array.isArray(s),u=l?"array":typeof s,c=!l&&Array.isArray(t[o]);if(!(u==="undefined"||u==="function")){if(c){var d=t[o];if(d.length===0)continue;for(var _=[s],f=0,v=d.length;f<v;f+=1){var p=this._handleRelativeValue(s,d[f]);if(isNaN(p)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}_.push(p)}c&&(t[o]=_)}if((u==="object"||l)&&s&&!c){a[o]=l?[]:{};var g=s;for(var m in g)a[o][m]=g[m];e[o]=l?[]:{};var d=t[o];if(!this._isDynamic){var h={};for(var m in d)h[m]=d[m];t[o]=d=h}this._setupProperties(g,a[o],d,e[o],r)}else(typeof a[o]>"u"||r)&&(a[o]=s),l||(a[o]*=1),c?e[o]=t[o].slice().reverse():e[o]=a[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(i){return i===void 0&&(i=fs()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=i,this._group&&this._group.remove(this),this)},n.prototype.resume=function(i){return i===void 0&&(i=fs()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=i-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var i=0,a=this._chainedTweens.length;i<a;i++)this._chainedTweens[i].stop();return this},n.prototype.group=function(i){return i===void 0&&(i=P_),this._group=i,this},n.prototype.delay=function(i){return i===void 0&&(i=0),this._delayTime=i,this},n.prototype.repeat=function(i){return i===void 0&&(i=0),this._initialRepeat=i,this._repeat=i,this},n.prototype.repeatDelay=function(i){return this._repeatDelayTime=i,this},n.prototype.yoyo=function(i){return i===void 0&&(i=!1),this._yoyo=i,this},n.prototype.easing=function(i){return i===void 0&&(i=To.Linear.None),this._easingFunction=i,this},n.prototype.interpolation=function(i){return i===void 0&&(i=vo.Linear),this._interpolationFunction=i,this},n.prototype.chain=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];return this._chainedTweens=i,this},n.prototype.onStart=function(i){return this._onStartCallback=i,this},n.prototype.onEveryStart=function(i){return this._onEveryStartCallback=i,this},n.prototype.onUpdate=function(i){return this._onUpdateCallback=i,this},n.prototype.onRepeat=function(i){return this._onRepeatCallback=i,this},n.prototype.onComplete=function(i){return this._onCompleteCallback=i,this},n.prototype.onStop=function(i){return this._onStopCallback=i,this},n.prototype.update=function(i,a){if(i===void 0&&(i=fs()),a===void 0&&(a=!0),this._isPaused)return!0;var t,e,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(i>r)return!1;a&&this.start(i,!0)}if(this._goToEnd=!1,i<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),e=(i-this._startTime)/this._duration,e=this._duration===0||e>1?1:e;var o=this._easingFunction(e);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,e),e===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[t]=="string"&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=i+this._repeatDelayTime:this._startTime=i+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(i,a,t,e){for(var r in t)if(a[r]!==void 0){var o=a[r]||0,s=t[r],l=Array.isArray(i[r]),u=Array.isArray(s),c=!l&&u;c?i[r]=this._interpolationFunction(s,e):typeof s=="object"&&s?this._updateProperties(i[r],o,s,e):(s=this._handleRelativeValue(o,s),typeof s=="number"&&(i[r]=o+(s-o)*e))}},n.prototype._handleRelativeValue=function(i,a){return typeof a!="string"?a:a.charAt(0)==="+"||a.charAt(0)==="-"?i+parseFloat(a):parseFloat(a)},n.prototype._swapEndStartRepeatValues=function(i){var a=this._valuesStartRepeat[i],t=this._valuesEnd[i];typeof t=="string"?this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(t):this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=a},n}(),ei=P_;ei.getAll.bind(ei);ei.removeAll.bind(ei);ei.add.bind(ei);ei.remove.bind(ei);var uE=ei.update.bind(ei);function B_(n,i){return B_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},B_(n,i)}function bc(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i&&B_(n,i)}function bp(n,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Bm(n,i,a){return i&&bp(n.prototype,i),a&&bp(n,a),n}function Mr(n,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](n):n instanceof i}var cE=function(){function n(a){a===void 0&&(a=[]),this._flags=a,this.flag=!0,this._flags.push(this)}var i=n.prototype;return i.destroy=function(){yt.removeFromArray(this._flags,this),this._flags=null},n}(),dE=function(){function n(){this._updateFlags=[]}var i=n.prototype;return i.register=function(){return new cE(this._updateFlags)},i.distribute=function(){for(var t=this._updateFlags,e=t.length-1;e>=0;e--)t[e].flag=!0},n}(),hl=function(){function n(){this._position=new M,this._worldScale=new M(1,1,1),this._transform=new Dc,this._invModelMatrix=new $,this._transform.owner=this,this._inverseWorldMatFlag=this._transform.registerWorldChangeFlag()}var i=n.prototype;return i.setRotation=function(t){console.log("Physics-lite don't support setRotation. Use Physics-PhysX instead!")},i.setPosition=function(t){t!==this._position&&this._position.copyFrom(t),this._setLocalPose()},i.setWorldScale=function(t){t!==this._worldScale&&this._worldScale.copyFrom(t),this._setLocalPose()},i.setContactOffset=function(t){console.log("Physics-lite don't support setContactOffset. Use Physics-PhysX instead!")},i.setMaterial=function(t){console.log("Physics-lite don't support setMaterial. Use Physics-PhysX instead!")},i.setUniqueID=function(t){this._id=t},i.setIsTrigger=function(t){console.log("Physics-lite don't support setIsTrigger. Use Physics-PhysX instead!")},i.destroy=function(){},i._updateHitResult=function(t,e,r,o,s){s===void 0&&(s=!1);var l=n._tempPoint;t.getPoint(e,l),s||M.transformCoordinate(l,this._transform.worldMatrix,l);var u=M.distance(o,l);u<r.distance&&(r.point.copyFrom(l),r.distance=u,r.shapeID=this._id)},i._getLocalRay=function(t){var e=this._getInvModelMatrix(),r=n._ray;return M.transformCoordinate(t.origin,e,r.origin),M.transformNormal(t.direction,e,r.direction),r.direction.normalize(),r},i._getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&($.invert(this._transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},i._setLocalPose=function(){var t=n._tempPoint;M.multiply(this._position,this._worldScale,t),this._transform.position=t},n}();(function(){hl._ray=new q0})();(function(){hl._tempPoint=new M})();var Dc=function(){function n(){this._position=new M,this._rotation=new M,this._rotationQuaternion=new xe,this._scale=new M(1,1,1),this._worldRotationQuaternion=new xe,this._localMatrix=new $,this._worldMatrix=new $,this._updateFlagManager=new dE,this._isParentDirty=!0,this._parentTransformCache=null,this._dirtyFlag=188}var i=n.prototype;return i.setPosition=function(t,e,r){this._position.set(t,e,r),this.position=this._position},i.setRotationQuaternion=function(t,e,r,o){this._rotationQuaternion.set(t,e,r,o),this.rotationQuaternion=this._rotationQuaternion},i.setScale=function(t,e,r){this._scale.set(t,e,r),this.scale=this._scale},i.registerWorldChangeFlag=function(){return this._updateFlagManager.register()},i._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(132)&&(this._worldAssociatedChange(132),Mr(this._owner,po)))for(var t=this._owner._shapes,e=0,r=t.length;e<r;e++)t[e]._transform._updateWorldPositionFlag()},i._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(152)&&(this._worldAssociatedChange(152),Mr(this._owner,po)))for(var t=this._owner._shapes,e=0,r=t.length;e<r;e++)t[e]._transform._updateWorldRotationFlag()},i._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(160)&&(this._worldAssociatedChange(160),Mr(this._owner,po)))for(var t=this._owner._shapes,e=0,r=t.length;e<r;e++)t[e]._transform._updateWorldScaleFlag()},i._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(188)&&(this._worldAssociatedChange(188),Mr(this._owner,po)))for(var t=this._owner._shapes,e=0,r=t.length;e<r;e++)t[e]._transform._updateAllWorldFlag()},i._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;var t=null;if(Mr(this._owner,hl)){var e=this._owner._collider;t=e._transform}return this._parentTransformCache=t,this._isParentDirty=!1,t},i._isContainDirtyFlags=function(t){return(this._dirtyFlag&t)===t},i._isContainDirtyFlag=function(t){return(this._dirtyFlag&t)!=0},i._setDirtyFlagTrue=function(t){this._dirtyFlag|=t},i._setDirtyFlagFalse=function(t){this._dirtyFlag&=~t},i._worldAssociatedChange=function(t){this._dirtyFlag|=t,this._updateFlagManager.distribute()},Bm(n,[{key:"owner",set:function(t){this._owner=t}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t),this._setDirtyFlagTrue(64),this._updateWorldPositionFlag()}},{key:"rotationQuaternion",get:function(){return this._isContainDirtyFlag(2)&&(xe.rotationEuler(G.degreeToRadian(this._rotation.x),G.degreeToRadian(this._rotation.y),G.degreeToRadian(this._rotation.z),this._rotationQuaternion),this._setDirtyFlagFalse(2)),this._rotationQuaternion},set:function(t){this._rotationQuaternion!==t&&this._rotationQuaternion.copyFrom(t),this._setDirtyFlagTrue(65),this._setDirtyFlagFalse(2),this._updateWorldRotationFlag()}},{key:"worldRotationQuaternion",get:function(){if(this._isContainDirtyFlag(16)){var t=this._getParentTransform();t!=null?xe.multiply(t.worldRotationQuaternion,this.rotationQuaternion,this._worldRotationQuaternion):this._worldRotationQuaternion.copyFrom(this.rotationQuaternion),this._setDirtyFlagFalse(16)}return this._worldRotationQuaternion},set:function(t){this._worldRotationQuaternion!==t&&this._worldRotationQuaternion.copyFrom(t);var e=this._getParentTransform();e?(xe.invert(e.worldRotationQuaternion,n._tempQuat0),xe.multiply(t,n._tempQuat0,this._rotationQuaternion)):this._rotationQuaternion.copyFrom(t),this.rotationQuaternion=this._rotationQuaternion,this._setDirtyFlagFalse(16)}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale!==t&&this._scale.copyFrom(t),this._setDirtyFlagTrue(64),this._updateWorldScaleFlag()}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(64)&&($.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(64)),this._localMatrix},set:function(t){this._localMatrix!==t&&this._localMatrix.copyFrom(t),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(1),this._setDirtyFlagFalse(64),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(128)){var t=this._getParentTransform();t?$.multiply(t.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(128)}return this._worldMatrix},set:function(t){this._worldMatrix!==t&&this._worldMatrix.copyFrom(t);var e=this._getParentTransform();e?($.invert(e.worldMatrix,n._tempMat42),$.multiply(n._tempMat42,t,this._localMatrix)):this._localMatrix.copyFrom(t),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(128)}}]),n}();(function(){Dc._tempQuat0=new xe})();(function(){Dc._tempMat42=new $})();var Dp;(function(n){n[n.LocalEuler=1]="LocalEuler",n[n.LocalQuat=2]="LocalQuat",n[n.WorldPosition=4]="WorldPosition",n[n.WorldEuler=8]="WorldEuler",n[n.WorldQuat=16]="WorldQuat",n[n.WorldScale=32]="WorldScale",n[n.LocalMatrix=64]="LocalMatrix",n[n.WorldMatrix=128]="WorldMatrix",n[n.WmWp=132]="WmWp",n[n.WmWeWq=152]="WmWeWq",n[n.WmWpWeWq=156]="WmWpWeWq",n[n.WmWs=160]="WmWs",n[n.WmWpWs=164]="WmWpWs",n[n.WmWpWeWqWs=188]="WmWpWeWqWs"})(Dp||(Dp={}));var po=function(){function n(){this._shapes=[],this._transform=new Dc,this._transform.owner=this}var i=n.prototype;return i.addShape=function(t){var e=t._collider;e!==this&&(e&&e.removeShape(t),this._shapes.push(t),t._collider=this)},i.removeShape=function(t){var e=this._shapes.indexOf(t);e!==-1&&(this._shapes.splice(e,1),t._collider=null)},i.setWorldTransform=function(t,e){this._transform.setPosition(t.x,t.y,t.z),this._transform.setRotationQuaternion(e.x,e.y,e.z,e.w)},i.getWorldTransform=function(t,e){var r=this._transform,o=r.position,s=r.rotationQuaternion;t.set(o.x,o.y,o.z),e.set(s.x,s.y,s.z,s.w)},i.destroy=function(){},i._raycast=function(t,e,r){r.distance=Number.MAX_VALUE;for(var o=this._shapes,s=0,l=o.length;s<l;s++){var u=o[s];e(u._id)&&u._raycast(t,r)}return r.distance!=Number.MAX_VALUE},n}(),_E=function(n){bc(i,n);function i(t,e){var r;return r=n.call(this)||this,r._transform.setPosition(t.x,t.y,t.z),r._transform.setRotationQuaternion(e.x,e.y,e.z,e.w),r}var a=i.prototype;return a.addForce=function(e){throw"Physics-lite don't support addForce. Use Physics-PhysX instead!"},a.addTorque=function(e){throw"Physics-lite don't support addTorque. Use Physics-PhysX instead!"},a.move=function(e,r){throw"Physics-lite don't support move. Use Physics-PhysX instead!"},a.sleep=function(){throw"Physics-lite don't support putToSleep. Use Physics-PhysX instead!"},a.setAngularDamping=function(e){throw"Physics-lite don't support setAngularDamping. Use Physics-PhysX instead!"},a.setAngularVelocity=function(e){throw"Physics-lite don't support setAngularVelocity. Use Physics-PhysX instead!"},a.setCenterOfMass=function(e){throw"Physics-lite don't support setCenterOfMass. Use Physics-PhysX instead!"},a.setCollisionDetectionMode=function(e){throw"Physics-lite don't support setCollisionDetectionMode. Use Physics-PhysX instead!"},a.setConstraints=function(e){throw"Physics-lite don't support setConstraints. Use Physics-PhysX instead!"},a.setInertiaTensor=function(e){throw"Physics-lite don't support setInertiaTensor. Use Physics-PhysX instead!"},a.setIsKinematic=function(e){throw"Physics-lite don't support setIsKinematic. Use Physics-PhysX instead!"},a.setLinearDamping=function(e){throw"Physics-lite don't support setLinearDamping. Use Physics-PhysX instead!"},a.setLinearVelocity=function(e){throw"Physics-lite don't support setLinearVelocity. Use Physics-PhysX instead!"},a.setMass=function(e){throw"Physics-lite don't support setMass. Use Physics-PhysX instead!"},a.setMaxAngularVelocity=function(e){throw"Physics-lite don't support setMaxAngularVelocity. Use Physics-PhysX instead!"},a.setMaxDepenetrationVelocity=function(e){throw"Physics-lite don't support setMaxDepenetrationVelocity. Use Physics-PhysX instead!"},a.setSleepThreshold=function(e){throw"Physics-lite don't support setSleepThreshold. Use Physics-PhysX instead!"},a.setSolverIterations=function(e){throw"Physics-lite don't support setSolverIterations. Use Physics-PhysX instead!"},a.wakeUp=function(){throw"Physics-lite don't support wakeUp. Use Physics-PhysX instead!"},i}(po),fE=function(){function n(a,t,e,r,o){}var i=n.prototype;return i.setBounciness=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setDynamicFriction=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setStaticFriction=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setBounceCombine=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setFrictionCombine=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.destroy=function(){},n}(),hE=function(){function n(a){a===void 0&&(a=0),this.length=0,this._elements=new Array(a)}var i=n.prototype;return i.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},i.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},i.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},i.deleteByIndex=function(t){var e=this._elements,r=null,o=this.length-1;return t!==o&&(r=e[o],e[t]=r),this.length--,r},i.garbageCollection=function(){this._elements.length=this.length},n}(),bm=function(){this.shapeID=-1,this.distance=0,this.point=new M,this.normal=new M},Rs=function(n){bc(i,n);function i(t,e,r){var o;return o=n.call(this)||this,o._halfSize=new M,o._boxMin=new M(-.5,-.5,-.5),o._boxMax=new M(.5,.5,.5),o._id=t,o._halfSize.set(e.x*.5,e.y*.5,e.z*.5),o._setBondingBox(),o}var a=i.prototype;return a.setPosition=function(e){n.prototype.setPosition.call(this,e),this._setBondingBox()},a.setWorldScale=function(e){n.prototype.setWorldScale.call(this,e),this._setBondingBox()},a.setSize=function(e){this._halfSize.set(e.x*.5,e.y*.5,e.z*.5),this._setBondingBox()},a._raycast=function(e,r){var o=this._getLocalRay(e),s=i._tempBox;s.min.set(-this._halfSize.x*this._worldScale.x,-this._halfSize.y*this._worldScale.y,-this._halfSize.z*this._worldScale.z),s.max.set(this._halfSize.x*this._worldScale.x,this._halfSize.y*this._worldScale.y,this._halfSize.z*this._worldScale.z);var l=o.intersectBox(s);return l!==-1?(this._updateHitResult(o,l,r,e.origin),!0):!1},a._setBondingBox=function(){var e=this._transform.position,r=this._worldScale,o=this._halfSize;this._boxMin.set(-o.x*r.x+e.x,-o.y*r.y+e.y,-o.z*r.z+e.z),this._boxMax.set(o.x*r.x+e.x,o.y*r.y+e.y,o.z*r.z+e.z)},i}(hl);(function(){Rs._tempBox=new jt})();var Ms=function(n){bc(i,n);function i(t,e,r){var o;return o=n.call(this)||this,o._radius=1,o._maxScale=1,o._radius=e,o._id=t,o}var a=i.prototype;return a.setRadius=function(e){this._radius=e},a.setWorldScale=function(e){n.prototype.setWorldScale.call(this,e),this._maxScale=Math.max(e.x,e.y,e.z)},a._raycast=function(e,r){var o=i._tempSphere;M.transformCoordinate(this._transform.position,this._collider._transform.worldMatrix,o.center),o.radius=this.worldRadius;var s=e.intersectSphere(o);return s!==-1?(this._updateHitResult(e,s,r,e.origin,!0),!0):!1},Bm(i,[{key:"worldRadius",get:function(){return this._radius*this._maxScale}}]),i}(hl);(function(){Ms._tempSphere=new sl})();var vl=function(){function n(a,t,e,r,o,s){this._colliders=[],this._sphere=new sl,this._box=new jt,this._currentEvents=new hE,this._eventMap={},this._eventPool=[],this._onContactEnter=a,this._onContactExit=t,this._onContactStay=e,this._onTriggerEnter=r,this._onTriggerExit=o,this._onTriggerStay=s}var i=n.prototype;return i.setGravity=function(t){console.log("Physics-lite don't support gravity. Use Physics-PhysX instead!")},i.addColliderShape=function(t){this._eventMap[t._id]={}},i.removeColliderShape=function(t){for(var e=this,r=e._eventPool,o=e._currentEvents,s=t._id,l=o.length-1;l>=0;l--){var u=o.get(l);(u.index1==s||u.index2==s)&&(o.deleteByIndex(l),r.push(u))}delete this._eventMap[s]},i.addCollider=function(t){this._colliders.push(t)},i.removeCollider=function(t){var e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1)},i.update=function(t){for(var e=this._colliders,r=0,o=e.length;r<o;r++)this._collisionDetection(t,e[r]);this._fireEvent()},i.raycast=function(t,e,r,o){var s=this._colliders,l;o&&(l=n._hitResult);for(var u=!1,c=n._currentHit,d=0,_=s.length;d<_;d++){var f=s[d];if(f._raycast(t,r,c)&&(u=!0,c.distance<e)){if(l)l.normal.copyFrom(c.normal),l.point.copyFrom(c.point),l.distance=c.distance,l.shapeID=c.shapeID;else return!0;e=c.distance}}return!u&&l?(l.shapeID=-1,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0)):u&&l&&o(l.shapeID,l.distance,l.point,l.normal),u},i.addCharacterController=function(t){throw"Physics-lite don't support addCharacterController. Use Physics-PhysX instead!"},i.removeCharacterController=function(t){throw"Physics-lite don't support removeCharacterController. Use Physics-PhysX instead!"},i._getTrigger=function(t,e){var r;return this._eventPool.length?(r=this._eventPool.pop(),r.index1=t,r.index2=e):r=new vE(t,e),this._eventMap[t][e]=r,r},i._collisionDetection=function(t,e){for(var r=this._colliders,o=e._shapes,s=0,l=o.length;s<l;s++){var u=o[s];if(Mr(u,Rs)){n._updateWorldBox(u,this._box);for(var c=0,d=r.length;c<d;c++)for(var _=r[c]._shapes,f=0,v=_.length;f<v;f++){var p=_[f],g=p._id,m=u._id,h=g<m?this._eventMap[g][m]:this._eventMap[m][g];if(!(h!==void 0&&!h.alreadyInvoked)&&p!=u&&this._boxCollision(p))if(h===void 0){var y=g<m?this._getTrigger(g,m):this._getTrigger(m,g);y.state=0,y.alreadyInvoked=!1,this._currentEvents.add(y)}else h.state===0?(h.state=1,h.alreadyInvoked=!1):h.state===1&&(h.alreadyInvoked=!1)}}else if(Mr(u,Ms)){n._upWorldSphere(u,this._sphere);for(var A=0,S=r.length;A<S;A++)for(var x=r[A]._shapes,C=0,E=x.length;C<E;C++){var T=x[C],w=T._id,R=u._id,b=w<R?this._eventMap[w][R]:this._eventMap[R][w];if(!(b!==void 0&&!b.alreadyInvoked)&&T!=u&&this._sphereCollision(T))if(b===void 0){var B=w<R?this._getTrigger(w,R):this._getTrigger(R,w);B.state=0,B.alreadyInvoked=!1,this._currentEvents.add(B)}else b.state===0?(b.state=1,b.alreadyInvoked=!1):b.state===1&&(b.alreadyInvoked=!1)}}}},i._fireEvent=function(){for(var t=this,e=t._eventPool,r=t._currentEvents,o=r.length-1;o>=0;o--){var s=r.get(o);s.alreadyInvoked?(s.state=2,this._eventMap[s.index1][s.index2]=void 0,this._onTriggerExit(s.index1,s.index2),r.deleteByIndex(o),e.push(s)):s.state==0?(this._onTriggerEnter(s.index1,s.index2),s.alreadyInvoked=!0):s.state==1&&(this._onTriggerStay(s.index1,s.index2),s.alreadyInvoked=!0)}},i._boxCollision=function(t){if(Mr(t,Rs)){var e=n._tempBox;return n._updateWorldBox(t,e),Et.intersectsBoxAndBox(e,this._box)}else if(Mr(t,Ms)){var r=n._tempSphere;return n._upWorldSphere(t,r),Et.intersectsSphereAndBox(r,this._box)}return!1},i._sphereCollision=function(t){if(Mr(t,Rs)){var e=n._tempBox;return n._updateWorldBox(t,e),Et.intersectsSphereAndBox(this._sphere,e)}else if(Mr(t,Ms)){var r=n._tempSphere;return n._upWorldSphere(t,r),Et.intersectsSphereAndSphere(r,this._sphere)}return!1},n._updateWorldBox=function(t,e){var r=t._transform.worldMatrix;e.min.copyFrom(t._boxMin),e.max.copyFrom(t._boxMax),jt.transform(e,r,e)},n._upWorldSphere=function(t,e){M.transformCoordinate(t._transform.position,t._transform.worldMatrix,e.center),e.radius=t.worldRadius},n}();(function(){vl._tempSphere=new sl})();(function(){vl._tempBox=new jt})();(function(){vl._currentHit=new bm})();(function(){vl._hitResult=new bm})();var Lp;(function(n){n[n.Enter=0]="Enter",n[n.Stay=1]="Stay",n[n.Exit=2]="Exit"})(Lp||(Lp={}));var vE=function(i,a){this.alreadyInvoked=!1,this.index1=i,this.index2=a},pE=function(n){bc(i,n);function i(a,t){var e;return e=n.call(this)||this,e._transform.setPosition(a.x,a.y,a.z),e._transform.setRotationQuaternion(t.x,t.y,t.z,t.w),e}return i}(po),gE=function(){function n(){}var i=n.prototype;return i.initialize=function(){return Promise.resolve()},i.createPhysicsManager=function(){return null},i.createPhysicsScene=function(t,e,r,o,s,l,u){return new vl(e,r,o,s,l,u)},i.createStaticCollider=function(t,e){return new pE(t,e)},i.createDynamicCollider=function(t,e){return new _E(t,e)},i.createCharacterController=function(){throw"Physics-lite don't support createCharacterController. Use Physics-PhysX instead!"},i.createPhysicsMaterial=function(t,e,r,o,s){return new fE(t,e,r,o,s)},i.createBoxColliderShape=function(t,e,r){return new Rs(t,e,r)},i.createSphereColliderShape=function(t,e,r){return new Ms(t,e,r)},i.createPlaneColliderShape=function(t,e){throw"Physics-lite don't support PlaneColliderShape. Use Physics-PhysX instead!"},i.createCapsuleColliderShape=function(t,e,r,o){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createFixedJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createHingeJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createSpringJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},n}(),mE="1.1.0-beta.27";console.log("Galacean PhysicsLite version: "+mE);const yE=""+new URL("background-mi8UMpPT.png",import.meta.url).href,AE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIoAAAMZCAYAAADfnawUAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExODE0NUY0MkQ5OEE1OTg3NiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3Mzg1MThFNjg5NDgxMUUzOTkzRkJDMEM4MDJDNEY2OCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3Mzg1MThFNTg5NDgxMUUzOTkzRkJDMEM4MDJDNEY2OCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDQ4MDExNzQwNzIwNjgxMTgxNDVGNDJEOThBNTk4NzYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDE4MDExNzQwNzIwNjgxMTgxNDVGNDJEOThBNTk4NzYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5S8yE6AAAIiUlEQVR42uzdy24bVQCA4XPGuUI3SCAQVTdIFVXZAAtAArFCVN0j8TQ8Du/ARWJBWcECsgmqIItWAikLVk3iOKnn4MuMY3vG6Ti3OvH3SeklHdfTyZ9zjifpTPzqkwcpwAtkDgFCQSgIhQW0ErNhKyml/g8h28jDnW92Q8h774zFW8+7d++PHhTj8J1fvvn+yfvKDZfID7t/jH6dwvA1wUZrNXz++nuV4/L97u+jX5fbXqXHf22f7GsaPv/TR/uDvZmWfnonhKPW6SNKXPMiaLkUo0Eq3tqrIax2TT2cceqpDaxMaGzqGfxRVk49Y6VlcWmnnvFjMv37uuMSX/anZTaaJ8d2eGoGialhKC8apcJkPEvax+x/fzzluMQbNKJkvexHC9d48lnw4K0PKgu0H3e3Kou5eRZTdQvkWdsuqrq92wpbjbY7r6eP9ipP0FqP4fZHr1bifPLLs+rOxOY7VhkMW62WCRmLWS5qMTs+DcTJhSs3zBzzoREFoSAUhIJQEApCgbAyOk+SQvANBswcUaa+QAymHoSCUBAKQkEoCAWEglAQCkJhgfX/I9jYfwYTCkYUhIJQEApCQSggFITCBZrrikvlBXTGLzdVXkCnyZUOy4vijF8cZ/pxoysn1my7iNIFbzf385fHp/wphdnHLZ19Z4woCAWhIBSEglAQCggFoXCZoTw/6joqVMSvP304OKGb52l42nfjecg+/jeEV46LLYbne2fdPaPpTYpmnYqPNVc8XvTT9gul7lDFhtvVOVwJ6bfbIRysFo+Lph6aq/2iYOqNLiFPEyPKZd3ezOhxRaOMxSwvZ0TJe3PSf5sh7K1NjCgsif5NJ7tZg1B6G6Y/33DAlnrqiqYeLnAxW1cUy82IQrMRZfPW5nANW5xw67912p3hS+QxrbUY4up0ZTG0pu7R2n9UN+Wj12hzL4UHr8zzsQcWJ/yyrHpyrreveX6ObwS9TsuG/OT7Yct/av/Q190iN+82fKncnzm6k8e0f4zXN9d7f2+sTD2VeWZwT+0sGzxL+YH44tvXQip2IBb3p3z49oe1z//z7nY46HaK/ZzvA9j/u3d2/g7Hx0dFC8PH37t3/+T5i2Ae72z3jkqY2O6m6t+RtG5BcOezW6MPWl+3k8I/v+43D/C7u1OfeynUNVHp8ajdMc4uucODw9PXKJ2aDVhO7b12fSiH+21Hh5mxDEI5eHbgqHBqLJlIaBKL8yg0IhSEglAQCkJBKAgFhIJQEApC4XqFEn1/NUYUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKCy8lYXcqxhCiHNsu8zijJ+NKCz+iNK02nhJZV/yZw1GFISCUBAKQkEoCAWEwnk54YYRBaGw0FPPVfHV47NPx756zLUZUa5qLRutZa1REAqmniuee877/BhREApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglBAKAgFoSAUhIJQEAoIBaEgFISCUBAKQgGhIBSEglAQCkJBKCAUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglBAKAgFoSAUhIJQEAoIBaEgFISCUBAKQgGhIBSEglAQCkJBKCAUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglBAKAgFoSAUhIJQEAoIBaEgFISCUBAKQgGhIBSEglAQCkJBKCAUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglAcAoSCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQHAKEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhIJQEApCAaEgFISCUBAKQkEoIBSEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhIJQEApCAaEgFISCUBAKQkEoIBSEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhIJQEApCAaEgFISCUBAKQkEoIBSEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhMK1878AAwDAUxw9p1dTiwAAAABJRU5ErkJggg==",xE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwkAAACACAYAAABAzCUBAAALhUlEQVR4Xu3dvWudBRQH4PdtPrpZB61WUUQHEUFXVycXcVKhm4vg5iDdxbWTgwiiu3+Ae50dXBURRdRarR8NbcGkSSu3lHKTe2N/vb3H3CNPhhbqyenpc859058hzfjGm6dvDN4IECBAgAABAgQIECBwS2B89YWXhATnQIAAAQIECBAgQIDAbQEhwTEQIECAAAECBAgQILBPQEhwEAQIECBAgAABAgQICAlugAABAgQIECBAgACBwwXGjz58y9ckuBACBAgQIECAAAECBG4LjD/tnRUSHAQBAgQIECBAgAABAkKCGyBAgAABAgQIECBAYL6AzyS4DAIECBAgQIAAAQIE9gkICQ6CAAECBAgQIECAAIH9IeGLP8/MfE3C5ubxYW19bWGqnZ2dYW93d+H3n/eOZso4OXHKBLIq98QpE8iq3BOnTCCrck+cMoGsyj3NOo1nPn9+JiScevjR4cR992eqc6p++fXnYWvr0sLvP+8dzZRxcuKUCWRV7olTJpBVuSdOmUBW5Z44ZQJZlXuaExLeOffcTEh4ZBISTiweEs5fWH5IMFN25Jw4ZQJZlXvilAlkVe6JUyaQVbknTplAVuWehITsUsIqB5VBceKUCWRV7olTJpBVuSdOmUBW5Z44ZQJZ1VHf0+gzCdmi5lUd9fLMZHfTAj6Dl90DJ07TAp7j2T1w4pQJZFXuqYeTkJDtaW6VI8/wOHHKBLIq98QpE8iq3BOnTCCrck+cMoGs6qjvaXz/21dmvibh+ObxYX19/Y5/gt3d3eG3ixeGyc/Tb9s72zO/dsdmUwWPP/bETLmZZgU5ZVfFiZPn0+E34Dnu493B6/DM9Mz0zPTMnAiMH58/PRMSspfHMFy7dm344cfvb/68zLdnnn524XZmyug4cToo4HWX3QQnTplAVuWeOGUCWZV74pQJZFVCQuY0eOFlUJw4ZQJZlXvilAlkVe6JUyaQVbknTplAVrWK9yQkZLsTEjiFAlnZKj4MzGR3mUBW5Z44ZQJZlXvilAlkVe4pcxISMichgVMokJV5QHHKBLIq98QpE8iq3BOnTCCrck99neKQsL3993D5yuV9f9Lr168Pl7b+Gvb29jKBA1XHjh27+Z2d19bW9v2XBx84GfUzE6fpQ3FP0ctm4MRpWsBzfPYefGzxscXHluw5yen/7RSHhK2tS8Pk3xdf5tvGxsYw+VcUNjc2F2prpoyNE6dpAa+77B44ccoEsir3xCkTyKrcE6dMIKs67J6EhAN+Xnj3dlDZew+D4JJJceIk4GU3wInTRMAzM7sDTpySZ6aQICRkrxROnG4J+OCSnQInTskH4UzJX3457RfwPzSzi+B0b05Cgr/8ZhfEiZOQcFc3ICRkXJw4CVPZDXDi9F9/tmw8++XL0TdTu3r1yvD7HxfvfkP/8h6T7+r80MlT0Xd3ntfGTNk6OHGaFvC6y+6BE6dMIKtyT5wygazKPXHKBLKqw+5pfP29p6KQMNwYhhuTH5b4Nk56jTd/XOzNTJkbJ05TAl532Tlw4pQJZFXuiVMmkFW5J06ZQFZ12D2Nr7375HL/5p/No4oAAQIECBAgQIAAgRUVEBJWdDHGIkCAAAECBAgQIHBUAkLCUcn7fQkQIECAAAECBAisqICQsKKLMRYBAgQIECBAgACBoxIYP/vkRV+TcFT6fl8CBAgQIECAAAECKygwfvVp9k+gruDsRiJAgAABAgQIECBAoEBASChA1ZIAAQIECBAgQIBAZwEhofP2zE6AAAECBAgQIECgQEBIKEDVkgABAgQIECBAgEBngfGbc2/7wuXOGzQ7AQIECBAgQIAAgSULjN99/YGQsGRU7QgQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgT+AXfxnAHod9PuAAAAAElFTkSuQmCC",SE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARQAAABACAYAAADbGIgsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpENUU3ODRGODg5MTcxMUUzQkM4MUMwODVFQjk3NkM0MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpENUU3ODRGOTg5MTcxMUUzQkM4MUMwODVFQjk3NkM0MyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQ1RTc4NEY2ODkxNzExRTNCQzgxQzA4NUVCOTc2QzQzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQ1RTc4NEY3ODkxNzExRTNCQzgxQzA4NUVCOTc2QzQzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+B/b3DwAAAu1JREFUeNrs3b9KHFEUB+CZIELeIE1IYZfKVrAXe8kzZLGwyhLTiE2U7SzEPIOkl7RBSBlfwELS+AaBNBsTEMQ5153xzsz++77yuuPO/HY53DlzvZbj8biYtp2NrWmeRBkNfv3xrVhU8pZ3V3m/KAAUFEBBARQUgEnKrpqyTRpRo/PdrPcavjutjH25PKt17PvNQTKbxwOz3DiUt7xnIW8zFMAtD6CgAAoKgIIC9KiVpzxRx7tJZ/v39bDW6w7234TjdTveTSS64zPxJELe8p7VvM1QALc8gIICKCgAk600eXFquXHUoKrbiGrD9eWvytja5utax6aWJkeNsLvXjoNMOttvQt7d5Z27R0m0HP7w6Gbp8zZDAdzyAAoKoKAATJZsykZNq1TTqc+G4KKSd7/Z5u5REokatU99jmYoAAoKoKAACgqgoABkWZmnk011yw8+fq6MfTj+VBmLlit3sddEW1L7Y/SV7bLlnSv15KjuMv1FyNsMBVBQAAUFUFAAJktuUp27X0QTXSxN7rOhmcr28cD9HhJ9LQVP6WIvj3nLO7rel2ujrBNI/UlElM2i5m2GArjlARQUQEEBmOz/Stl5b1pFx5+9+jPVYAe3q1FTu2ySTVd5F0VeQ28O8y6Dawi+88PWc2n6XZ73vM1QALc8gIICKCgACgrQo+R+KLlPGCKpLvjJ9lV18Ht1aO9iPTw+6ngPblenGuzdOZVP/LjWU4eiOM08C3mnHB7d1PwM6gtzTWQbWYS8zVAAtzyAggIoKACTtbJJdbTEO2rAJptWNaWOHwTNrL6WJrfVHGvSJMzNcdnyvt8X5aGdja3sHORthgK45QEUFEBBAXiOXjep7qu59U9q1WHbUisGo2ZW1Bx8kHeTtx3LOy/vhp+BvGvmbYYCuOUBFBRAQQFQUIAeJZfej853y5xfHC3H39tf7+3fm55sX1XOf/Xn25n9IJosD4+uLbJ3Ie+urk3eZiiAggIoKICCAvBcfwUYAPqPfQLD+W0zAAAAAElFTkSuQmCC",CE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANYAAABLCAIAAACDee7kAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNTc1RDdFODg5Q0IxMUUzOTkzRkJDMEM4MDJDNEY2OCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyNTc1RDdFOTg5Q0IxMUUzOTkzRkJDMEM4MDJDNEY2OCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjI1NzVEN0U2ODlDQjExRTM5OTNGQkMwQzgwMkM0RjY4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjI1NzVEN0U3ODlDQjExRTM5OTNGQkMwQzgwMkM0RjY4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+jkUoGQAACkVJREFUeNrsXWtsHFcVnjuzM97d2t6sndSOndIoLeBIwA+CUJGAUlGgDxR+ILVqKhURKvgRKK+//dG4P4qEaoESCcQjAqGolRBCNGkSJAqoRfTlJMV2okRK48jONnYefqxd21nP3MvcO/uYuTNz74x3vLbX59PKsnfOnDn3u+eee8+9Z9fo8T2aAgCsHVSgAAAuCAAXBADABQGbFinu76PvLAEpgFXFk59NQxQEwEQMAIALAsAFAQBwQcA6zIj9mPvtU3iqQH8jFvAFiAXUtq39wJ/rdUFzfMi6flkhBFwQEHuSzfcmEAWZ81VeAEAsRPCZKC6IafyDKAhYiQvKfQbSEQBkxABwQQAAXBAALggAgAsCNidSCepCelrfuUcxsgqif8lvWL69fGWQlBYUunkUsIGk5randnyCqUZRDMAzE2ZhmO0FBG9H1RRG04lnrpmFEaVsHbEbmNq5B9kNjHY7WV4yr5yO1MAQhWbhPJ4phLWo8faI+Vl7F1RbO9u/9Wvtznuo9Uj+wTxrujD94kPW9fep9UEbSEbf/bnvHGF0qPQlw9LbL8/+fj9jxAwUsBW27f9dLIVzR5522LadALV2tj31K+3OXREbiKcLMwMP07Ol8AaK7Zn704Gl//yRtcjy93Hj7RHzAxMxYNNPxLXRQwelGklYIlDRE21QyueO2ArVuhuI6rJH3qLG2hO3Bze8CyoxGYmyAK1TodO0xBootSfaoGqcPfEJb7QLcutfjOkRc+hVS1E1RU2xA2jkvCWQL98SvuagVwOHhKvDiGVGp9iv0H6HaqBdTpgarx5C3Lew30l99iDKT7mzCX1haxUJt+1324MQbaDLzzj9BFvr3QWvvjIwdfpk2XTfajqVbd+596DR3kG7gs04H54auD18gq1uA+SXZ29cOvLT0lSBMhVEdGbxeo6RUuUs+9UfGZ96mC16KZWzo0Oj/Y86VEfJ4DKLN7aUFRLHgIu/3G+l0vYbTg/e9Y2f5Pc8UvZFBU0P/XP8Ly+w9tryWLNKnVPjmsukuPb03Lc39+PjTL+tAJXOv7bw6s/KCXIQA4VXfjF15kQY4Xqm/e69z+ltHRWDlYVTA6Xhk1XCbftHn3uIJbf2GFOM9m27vv2i0dlDO4jJc/o5ftajCy5OvD974b8snwtI6Fo6etXtu/XuXWy00YROffOoILZjszR/+Yytkws2tUFpkFzW8xQ7Pdfv/Rzrcls/whPjxYtvSaOFK0UkW1wKCTXg7DJWqjsQpfufdEfl5eKN4oU3q/pTqpJvtTR15fZ0feEJ/Z77aB9rVN66NVbhh4QRXjYgmPAetbvPQ3jOQ7g9xorXblW1t3T24tIibSAK0e/lZz26YK3KMHCU07ah2ivK2kJcvBjwZkUz/cleVXuibCKQIJvd75GQW8pGKgnYw8nLLK6XcLcZASZ59SdRQrrqLuiEq4BVEb1osQWHVtvWkiWAdCnGloPBUZD4OK1p1pwurNgTKQoGKCQWcUVBwvVBrb3YmYwJqcseNiG65KXrV/uhIsIxERNO7ce11tlsc0q8+gP4gX1BwKbfF/Si1UBbM2yU4ICxomdQSq3MMFFszbb3fv0Zc37KGdB+Ae3aMBr+aznRY7j1zjGzMF6byBD6yGPPCh5Reu+4OXa2qsHQPKbZKUE+jSxXXEinPHGkRVPK7bWDH6EpBG1g+OM4eb8Ap79OwlMywltSytYsEshz+jl+1qML3qErasZJJQKuamlFi9MCLdPW87XvCTLZpbdfLo78ze2CU2dOzb719+rMsu3zj3/swG8CNlMqmFu8unTzf8zggLWU7VJb0ryLcC7VmamsEYl8beuX97tgvDGv2yyFEq7KCLftMTIiebF+mIgBMBEHpH+iMLCCGO7sTsW4irE7e7Cjo7MZERYF7feRrEXiJqD4FCnJUlSfNiSTRxvLBVfBqeMy4NsZqe5xIKQAmj4Kprb3GbsfcKJRwGIn3TY3OqRMjtFzKja6THbyEaYNL9+ev3wWs3K3wD03PHaOu91eL2d1l/vNTc4M/4t5YMgGh9Gm931JYZsl9k+rOGl9cL4SRZP/GLWa6yrzQ4KLndQtPbGGiiYknNiEX7EJH2dk0+ZbQsKbwQWzX3km++D3w67enioMHXxkceJydTutO4tzRuhe03Lx5sXDTwtOR9oNsj2L3bfnMyjvWl8XL/373POvC7zpo9891PXNfqVyGpFIPZwARt8Dxse/KF55xKpGyT74A+XLB8IJ/2C4/9GlyIQ3BpCOAJp6ImaTiCoY4oSmC7i2KS+LNJw8f9V3O589eHf/g1aOrvIwBSVSD7dyflaw9pURrsQkfOO7oCJe9avlio9a3Yf0jBh75XkPiqRBlnXXXLABE1TCXi4mHMUmfKO7oLR8Daka0lLl43MWpsSbnry8L6ryt3vXUvR0VBOO+2rBHHVnlEg9nORxwkeEbR41jPAN74LiekEt075zXz8rXyuPXfMfA9ZIaL2gntvW98M/WKVFp/P8j7MuvGaeeoHdXu5Xrj6vDSudpsjgW+8eG3m+VsCXSD2cAFx9oV+Aq0eUKhTXC9qE373vYKqV1Qsyz7YJx+dOhm5ZNIELSusFszt2Z1zla3ODRxfDiVZTRuuuT4sO6IrjRe/tXH2ebj9UyPP1N14qF/AlVw8nAFdf6Bfg6hGjEC6oFzQ6erI7+tJdNcLnB48urfVcvNHqBRGKeZWrz4tms5JkPVzUxwVXQMZWF49w1OxrQWm9ID0QU7XqoJQyIjmgQ4GfNnLX58krEhOvh4vGT0i9YNwxIKwXpI9A8QhvAGBfENBEUdBcKF49fohk8tXzHzI2uDWNw7ZLEJmbePWQeke+ujehXxrUCK4u/z+8MjT90sHo06g2MawTz+kIXy8oDSJjp90GS+vhOP3axIjhGBASvTh5szBSeRwJNG/h7LGxm0xeDdBvLRQLxw+TbI1Azn4/4ZMnDqtZ1kFM3vASzqd3Pv1i+RVuI3H/Etv/P+imn/0k/c6NCF/0a2JlbF5zf7qnS3j+Y8uPe+W586JiCV1bUKOviPwHdBML6mwJRdfgN1jsgpx+vwFS+W6h/KRQf+KESzs07oGemu/t+Pko9yb8DzpA807Ezoactz5PESS6yCfPT1/V1XrUtbjfHm+9YISEMlpmHqxf/okon7zkcVL9yRIu69DV2CFIPCPmqqhQvfKxG42E+uPeHre9Ug2JyydNeL3ya+qC9go7k6If2KlCV+uSty+5q/2kaPF9vxlXLyiFHnNhwulv0RoqnzjhdcqvvQtqSOluRdGHjFTeZv8uHdUTxLh6wcRjoF8/aqB84oTXKb8yQDoCaK50BCUtjxprz5q3d7X5QeuMQIiCgA0RBblvpAMAYoQ4LQEXzPe/B0wCYCIGgAsCAOCCAHBBAABcENB04DPifZ8x1AiJNACwMmCMkffbyyAKAtZZFGTf9GABL4BVAnH+pYnABZX18T0jAEhHAIA1mogxUAJobNiDKAiAiRgALggAgAsCNi/+L8AAvUzdK5D3AAMAAAAASUVORK5CYII=",EE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABdwAAADbCAYAAAB3CFN7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3VpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDc5LjE2NDQ4OCwgMjAyMC8wNy8xMC0yMjowNjo1MyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxNTIxNGY4YS04N2Y0LTRjYjAtYWVjNy0zNjk1Y2JlNTRmOWIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTgxOUI0N0FCNjVDMTFFQkFGQzBGMTlENDFEOTJDRjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTgxOUI0NzlCNjVDMTFFQkFGQzBGMTlENDFEOTJDRjEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjAgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozYWM0MWM3YS02ZmMzLTQ0YTEtODY5My0yZWNlOTJiNGNiODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MTUyMTRmOGEtODdmNC00Y2IwLWFlYzctMzY5NWNiZTU0ZjliIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+QQh77QAAC2VJREFUeNrs3b1OG1kYBuA5K9+Au/QuIqUiPQVpQpVrsGsq6KhScAV0aU1HT5cqkehJmnRpuABkCQkJmrOzKKvVSnFihReYn+eRjtI4w/g7n745foVMqbU2AAAAAADAw/ylBAAAAAAA8HACdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQMBk0xeWUvaVa3Q+1Fpvh/SG9PEvfW73+8J+Y27pKf7T9tOxWfVHvrXrY+A6b9v1yqzSW3gOYl6ht/QVnoP05fNgaf/jpk1VlXl0pm1/rIb0hvTxLx08RbBkv+nz3NJTozxgFbPqj5y0axG4zrJdc7NKb+E5iHmF3tJXeA7Sl8+DvlIGAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQMAkfcH9/X1V7bgPHz40t7e3CjGSPv78+XNzcXFhU80tc0tP0fNnYRf66tu3b83Hjx83em2t9cE/r5Sy0evevn3bvHr1Sl+ZWWaWnsK8Qm/pK32lp/it4+PjR71+2fTDUPuBZ6MXJj5c8bim02mzWq02emm7n6shvfcx9vHBwcGmg+Sgfd/H9htzS0/pqf/tZXnse+lTX52cnDSLxWKjl7b3uwjUZtn+M//d65bLZTOfz3vTV091xjKzPAf1FOYVY+4tfaWv9BS/2Mtmw738o8+DvlIGAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQMBkiG/q7Oysef/+fefu6+joqHn37p2u64HXr18/+BovX75sTk9PFXMk+z1U5pae0lPAmM/vXXF9fa0IekpP6S1nLH2lr9BTPTHIwP3q6qr58uVLJ++Lfuhi/2C/zS09paeAIc8GsxM9hd5yxtJX+go9NQS+UgYAAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAwGTk7/+sXe8D1zlq1zvt1AuvA9d42a5TpRzNfg+VuaWn9BQw5vP7UF0rgZ7SU4PrLWcs9BV6qmfGHrhf1Vq/PPQipZQrrdQPof1WyBHt91CZW3pKTwFjPr+DnqIvveWMhb5CT/WPr5QBAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAwUQJgqEopVRXQUwCDMm9n8VwZ1prWWlfKoKf0FJhZoKeej99wBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgICJEgBjV2tVBPQUwDOaz+f3i5+bTqfNarVSCD2lp8DMAj3VA37DHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAETJQAAAAC67uvXr89+D5eXlzYCgF8SuAMAAACdt7W1pQgAdJ6vlAEAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQMFECAADCXpRSdhLXUUqAUfg6wPd0aVsBxkngDgBA2u6PBQC/VWvdUgUAhsJXygAAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIGCiBADP7/v37835+blCrHF3d9er+z05ObFpa2xvbzez2UwhwMwysxjl2UpPAWaWs5Wz1fB7SuAO0AH/HK4Wi4VCDIS9XG+5XDq0g5llZjHas5WeAswsZytnK4E7AADce/HiRbOzs9PJ+wIAAOgCgTsAABvZ3d29XwAAAPycP5oKAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAICAiRIA9Mr3dp0rw1p3j3z9EyVea7tdM2WATjGzzCye7mylpwAzy9nK2Yp7AneAfjmvtS6U4Xmo/XqllKUDFphZZhZjPVvpKcDMcrZyttJT//KVMgAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAiYjf//bpZRl4jpaCejZ3BqqvVrrzWNdXO09C6FPzCwzC58JATPLzHK2crZ6emMP3Gc/FoC5NQz77bp5xOvPlRjoETMLnK0AMwtnK56Yr5QBAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAEDARAkAALrvzZs3irDG4eFhs7u7qxAAAMCzE7gDAPTAp0+fFGGNxWKhCAAAQCcMMnDf3t5ulstlJ+8LoE9zqyv29vaam5ub3tyvvfQshD4xs8wsZys9BZhZZpazlZ7KGWTgPpvN7heAuTUM+/v7vQrc5/O5TQPMLHC2AjCznK0YIX80FQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAARMlAAB4Vm+UYK3Ddu0qAwAA0BcCdwCAZ1Rr/aQKP1dKWagCAADQJ75SBgAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQECptW72wlKqco3OtO2P1aAavpTEZbbadTHA/T5o9/t4YPttbplbeooHafupPPbPCD2bhmrZrrlZZWbhOcjg55VKexaaWXgOMpjPg37DHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAJKrVUVAAAAAADggfyGOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAT8LcAAEvrEkg6x8I0AAAAASUVORK5CYII=";async function wE(){let n;(_=>{_[_.Alive=0]="Alive",_[_.Dead=1]="Dead"})(n||(n={}));let i;(_=>{_[_.Idel=0]="Idel",_[_.Start=1]="Start",_[_.End=2]="End"})(i||(i={}));const a=-3.1,t={fly:"fly",stateChange:"stateChange",showGui:"showGui",checkHitGui:"checkHitGui",checkHit:"checkHit",gameOver:"gameOver",addScore:"addScore",reStartGame:"reStartGame"};let e;const r=768,o=896,s=r/o,l=document.getElementById("canvas"),u=l.parentElement;let{clientWidth:c,clientHeight:d}=u;c/d>s?(c=d*s,l.style.width=c+"px",l.style.marginLeft=(u.clientWidth-c)/2+"px"):(d=c/s,l.style.height=d+"px",l.style.marginTop=(u.clientHeight-d)/2+"px"),fC.create({canvas:"canvas",physics:new gE}).then(_=>{_.canvas.resizeByClientSize(o/d);const v=_.sceneManager.activeScene.createRootEntity(),p=v.createChild("camera");p.transform.setPosition(.3,0,5);const g=p.addComponent(et);g.isOrthographic=!0,g.orthographicSize=_.canvas.height/$r._pixelsPerUnit/2,_.resourceManager.load([{url:yE,type:De.Texture2D},{url:AE,type:De.Texture2D},{url:xE,type:De.Texture2D},{url:SE,type:De.Texture2D},{url:CE,type:De.Texture2D},{url:EE,type:De.Texture2D}]).then(E=>{e=E;const T=v.createChild("nodeBg");T.transform.setPosition(.3,0,-10),T.addComponent(je).sprite=new wr(_,E[0]);const w=v.createChild("nodePipe");w.transform.setPosition(0,0,-3),w.addComponent(m);const R=v.createChild("nodeGround");R.transform.setPosition(.3,-4.125,-2),R.transform.setRotation(90,0,0);const b=R.addComponent(en);b.mesh=Er.createPlane(_,7.68,1.28);const B=new Gu(_);b.setMaterial(B),B.baseTexture=E[2],B.tilingOffset.set(21,1,0,0),R.addComponent(y);const I=v.createChild("nodeBird");I.transform.setPosition(-1,1.15,0),I.addComponent(je).sprite=new wr(_,E[3]),I.addComponent(x);const V=v.createChild("nodeEff");V.transform.setPosition(0,0,-1),V.transform.setRotation(90,0,0);const L=V.addComponent(en);L.mesh=Er.createPlane(_,20,20);const F=new Gu(_);L.setMaterial(F),F.isTransparent=!0,F.baseColor.set(0,0,0,0),V.addComponent(C);const D=v.createChild("nodeGui");D.transform.setPosition(.3,0,1);const N=D.createChild("nodeRestart");N.addComponent(je).sprite=new wr(_,E[4]);const O=D.createChild("nodeScore");O.transform.setPosition(0,3.2,0),O.transform.setScale(.3,.3,.3),O.addComponent(h),D.addComponent(S),v.addComponent(A)}),_.run();class m extends Tt{constructor(){super(...arguments);Re(this,"_originPipe");Re(this,"_nowPipeArr",[]);Re(this,"_pipePool",[]);Re(this,"_curStartTimeStamp");Re(this,"_pipeHideX",4.6);Re(this,"_pipeVerticalDis",10.8);Re(this,"_pipeHorizontalDis",4);Re(this,"_pipeRandomPosY",3.5);Re(this,"_pipeDebutTime",3);Re(this,"_pipeHorizontalV",3)}onAwake(){const w=this._originPipe=new Br(_),R=w.createChild("node1"),b=w.createChild("node2"),B=this._pipeVerticalDis;R.transform.setPosition(0,-B/2,0),b.transform.setPosition(0,B/2,0),b.transform.setScale(1,-1,1),R.addComponent(je).sprite=new wr(_,e[1]),b.addComponent(je).sprite=new wr(_,e[1]),this._pipePool.push(w),_.on(t.stateChange,I=>{switch(I){case 0:this.enabled=!1,this._destroyPipe();break;case 1:this.enabled=!0,this._curStartTimeStamp=_.time.actualElapsedTime;break;case 2:this.enabled=!1;break}}),_.on(t.checkHit,I=>{for(var V=this._nowPipeArr.length,L=0;L<V;L++){var F=this._nowPipeArr[L].transform.position;if(Math.abs(F.x)<.9){Math.abs(F.y-I)>1.2&&_.dispatch(t.gameOver);break}}})}onUpdate(w){const R=this._pipeDebutTime;if(_.time.actualElapsedTime-this._curStartTimeStamp>=R){let b=!1;const B=w*this._pipeHorizontalV,I=this._nowPipeArr.length,{_pipeHorizontalDis:V,_pipeRandomPosY:L,_pipeHideX:F}=this;if(I>0)for(let D=I-1;D>=0;D--){const O=this._nowPipeArr[D].transform,k=O.position;k.x<-F?this._destroyPipe(D):(!b&&k.x>-1&&k.x-B<=-1&&(_.dispatch(t.addScore),b=!0),O.setPosition(k.x-B,k.y,k.z)),D==I-1&&k.x<=F-V&&this._createPipe(F,L*Math.random()-L/2+.8,0)}else this._createPipe(F,L*Math.random()-L/2+.8,0)}}_createPipe(w,R,b){const B=this._pipePool,I=B.length>0?B.pop():this._originPipe.clone();I.transform.setPosition(w,R,b),this.entity.addChild(I),this._nowPipeArr.push(I)}_destroyPipe(w=-1){const{entity:R,_pipePool:b,_nowPipeArr:B}=this,I=V=>{R.removeChild(V),b.push(V)};if(w>=0)I(B[w]),B.splice(w,1);else{for(let V=B.length-1;V>=0;V--)I(B[V]);B.length=0}}}class h extends Tt{constructor(){super(...arguments);Re(this,"_spriteArray",[]);Re(this,"_numInv",2);Re(this,"_scoreEntitys",[]);Re(this,"_scoreRenderer",[]);Re(this,"_myScore",0)}onAwake(){const w=this._spriteArray;for(var R=0;R<10;R++)w.push(new wr(_,e[5],new Rr(R*.1,0,.1,1)));_.on(t.addScore,()=>{++this._myScore,this._showScore(""+this._myScore)}),_.on(t.stateChange,b=>{switch(b){case 0:this.entity.isActive=!1;break;case 1:this.entity.isActive=!0,this._myScore=0,this._showScore("0");break}})}_showScore(w){const R=w.length,{entity:b,_numInv:B,_scoreEntitys:I,_spriteArray:V,_scoreRenderer:L}=this;var F=I.length;let D,N;if(R>F)for(let k=F;k<R;k++)D=new Br(_),N=D.addComponent(je),L.push(N),I.push(D),b.addChild(D);F=I.length;const O=(1-R)*B/2;for(let k=0;k<F;k++)D=I[k],k>=R?D.isActive=!1:(D.isActive=!0,D.transform.setPosition(O+k*B,0,0),L[k].sprite=V[parseInt(w[k])])}}class y extends Tt{constructor(){super(...arguments);Re(this,"_groundMaterial");Re(this,"_groundHorizontalV",8.2)}onAwake(){this._groundMaterial=this.entity.getComponent(en).getMaterial(),_.on(t.stateChange,w=>{switch(w){case 0:case 1:this.enabled=!0;break;case 2:this.enabled=!1;break}}),_.on(t.checkHit,w=>{w<a&&_.dispatch(t.gameOver)})}onUpdate(w){this._groundMaterial.tilingOffset.z+=w*this._groundHorizontalV}}class A extends Tt{constructor(){super(...arguments);Re(this,"_gameState")}onAwake(){_.on(t.reStartGame,()=>{this._setGameState(0)}),_.on(t.gameOver,()=>{this._setGameState(2)});const w=this.entity.addComponent(__),R=new zu;R.size.set(10,10,.001),w.addShape(R)}onStart(){this._setGameState(0)}onUpdate(){uE(),_.inputManager.isKeyDown(ba.Space)&&this._dispatchFly()}onPointerDown(){this._dispatchFly()}_dispatchFly(){switch(this._gameState){case 0:this._setGameState(1),_.dispatch(t.fly);break;case 1:_.dispatch(t.fly);break}}_setGameState(w){this._gameState!=w&&(this._gameState=w,_.dispatch(t.stateChange,w))}}class S extends Tt{onAwake(){const{entity:T}=this,w=T.findByName("nodeRestart"),R=w.addComponent(__),b=new zu;b.size.set(2.14,.75,.001),R.addShape(b),w.addComponent(Tt).onPointerClick=()=>{_.dispatch(t.reStartGame)},_.on(t.stateChange,B=>{switch(B){case 0:case 1:w.isActive=!1;break}}),_.on(t.showGui,()=>{w.isActive=!0})}}class x extends Tt{constructor(){super(...arguments);Re(this,"_regions",[new te(0,0),new te(1/3,0),new te(2/3,0)]);Re(this,"_reciprocalSliceWidth",1/3);Re(this,"_reciprocalSliceHeight",1);Re(this,"_frameInterval",.15);Re(this,"_totalFrames",3);Re(this,"_maxDropV",-8);Re(this,"_gravity",-35);Re(this,"_startFlyV",10);Re(this,"_cumulativeTime",0);Re(this,"_birdState",0);Re(this,"_sprite");Re(this,"_curFrameIndex");Re(this,"_startY");Re(this,"_flyStartTime");Re(this,"_gameState");Re(this,"_yoyoTween");Re(this,"_dropTween")}onAwake(){this._initDataAndUI(),this._initTween(),this._initListener()}onUpdate(w){switch(this._birdState){case 0:const{_frameInterval:R,_totalFrames:b}=this;if(this._cumulativeTime+=w,this._cumulativeTime>=R){const B=Math.floor(this._cumulativeTime/R);this._cumulativeTime-=B*R,this._setFrameIndex((this._curFrameIndex+B)%b)}if(this._gameState==1){let B;const{_maxDropV:I,_startFlyV:V,_gravity:L}=this,F=this.entity.transform,D=F.position,N=_.time.actualElapsedTime-this._flyStartTime,O=(I-V)/L;N<=O?B=(V+(V+N*L))*N/2+this._startY:B=(I+V)*O/2+I*(N-O)+this._startY,F.setPosition(D.x,B,D.z)}break;case 1:this._setFrameIndex(0);break}}onLateUpdate(){_.dispatch(t.checkHit,this.entity.transform.position.y)}_initDataAndUI(){const{entity:w}=this,R=w.getComponent(je);R.sprite=this._sprite=new wr(_,e[3]),this._setFrameIndex(0)}_initTween(){const w=this.entity.transform,R=w.rotation,b=w.position;this._yoyoTween=new ss(b).to({y:.25},380).repeat(1/0).onUpdate(B=>{w.position=B}).yoyo(!0).easing(To.Sinusoidal.InOut),this._dropTween=new ss(R).to({z:-90},380).onUpdate(B=>{w.rotation=B}).delay(520)}_initListener(){const w=this.entity.transform;_.on(t.fly,()=>{this._startY=w.position.y,this._flyStartTime=_.time.actualElapsedTime,this._yoyoTween.stop(),this._dropTween.stop(),w.setRotation(w.rotation.x,w.rotation.y,20),this._dropTween.start()}),_.on(t.stateChange,R=>{switch(this._gameState=R,R){case 0:w.setPosition(0,0,0),w.rotation=new M(0,0,0),this._birdState=0,this._yoyoTween.start();break;case 1:break;case 2:this._birdState=1,setTimeout(()=>{const{position:b,rotation:B}=w,I=b.y;I>a?(this._yoyoTween.stop(),this._dropTween.stop(),new ss(B).duration((I-a)*40).to({z:-90}).onUpdate(V=>{w.rotation=V}).start(),new ss(b).duration((I-a)*120).to({y:a}).onUpdate(V=>{w.position=V}).onComplete(()=>{_.dispatch(t.showGui)}).start()):_.dispatch(t.showGui)},300);break}})}_setFrameIndex(w){if(this._curFrameIndex!==w){this._curFrameIndex=w;const R=this._regions[w],b=this._sprite.region;b.set(R.x,R.y,this._reciprocalSliceWidth,this._reciprocalSliceHeight),this._sprite.region=b}}}class C extends Tt{onAwake(){const b=this.entity.getComponent(en).getMaterial().baseColor,B=new ss(b).to({a:1},80).repeat(1).yoyo(!0).delay(20);_.on(t.stateChange,I=>{switch(I){case 2:B.start();break}})}}})}function TE(){return Hp.useEffect(()=>{wE()},[]),hd.jsx("canvas",{id:"canvas",style:{width:"100vw",height:"100vh"}})}Y0(document.getElementById("root")).render(hd.jsx(Hp.StrictMode,{children:hd.jsx(TE,{})}));
