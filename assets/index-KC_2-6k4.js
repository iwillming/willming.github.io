var km=Object.defineProperty;var Um=(r,i,a)=>i in r?km(r,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[i]=a;var we=(r,i,a)=>(Um(r,typeof i!="symbol"?i+"":i,a),a);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();function Gm(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var zv={exports:{}},su={},kv={exports:{}},Pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tl=Symbol.for("react.element"),Hm=Symbol.for("react.portal"),Wm=Symbol.for("react.fragment"),Qm=Symbol.for("react.strict_mode"),jm=Symbol.for("react.profiler"),Xm=Symbol.for("react.provider"),Ym=Symbol.for("react.context"),qm=Symbol.for("react.forward_ref"),Km=Symbol.for("react.suspense"),Jm=Symbol.for("react.memo"),Zm=Symbol.for("react.lazy"),qh=Symbol.iterator;function $m(r){return r===null||typeof r!="object"?null:(r=qh&&r[qh]||r["@@iterator"],typeof r=="function"?r:null)}var Uv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Gv=Object.assign,Hv={};function Uo(r,i,a){this.props=r,this.context=i,this.refs=Hv,this.updater=a||Uv}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(r,i){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,i,"setState")};Uo.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Wv(){}Wv.prototype=Uo.prototype;function If(r,i,a){this.props=r,this.context=i,this.refs=Hv,this.updater=a||Uv}var Ff=If.prototype=new Wv;Ff.constructor=If;Gv(Ff,Uo.prototype);Ff.isPureReactComponent=!0;var Kh=Array.isArray,Qv=Object.prototype.hasOwnProperty,Nf={current:null},jv={key:!0,ref:!0,__self:!0,__source:!0};function Xv(r,i,a){var t,e={},n=null,o=null;if(i!=null)for(t in i.ref!==void 0&&(o=i.ref),i.key!==void 0&&(n=""+i.key),i)Qv.call(i,t)&&!jv.hasOwnProperty(t)&&(e[t]=i[t]);var s=arguments.length-2;if(s===1)e.children=a;else if(1<s){for(var l=Array(s),c=0;c<s;c++)l[c]=arguments[c+2];e.children=l}if(r&&r.defaultProps)for(t in s=r.defaultProps,s)e[t]===void 0&&(e[t]=s[t]);return{$$typeof:tl,type:r,key:n,ref:o,props:e,_owner:Nf.current}}function ey(r,i){return{$$typeof:tl,type:r.type,key:i,ref:r.ref,props:r.props,_owner:r._owner}}function Vf(r){return typeof r=="object"&&r!==null&&r.$$typeof===tl}function ty(r){var i={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(a){return i[a]})}var Jh=/\/+/g;function ku(r,i){return typeof r=="object"&&r!==null&&r.key!=null?ty(""+r.key):i.toString(36)}function Zl(r,i,a,t,e){var n=typeof r;(n==="undefined"||n==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(n){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case tl:case Hm:o=!0}}if(o)return o=r,e=e(o),r=t===""?"."+ku(o,0):t,Kh(e)?(a="",r!=null&&(a=r.replace(Jh,"$&/")+"/"),Zl(e,i,a,"",function(c){return c})):e!=null&&(Vf(e)&&(e=ey(e,a+(!e.key||o&&o.key===e.key?"":(""+e.key).replace(Jh,"$&/")+"/")+r)),i.push(e)),1;if(o=0,t=t===""?".":t+":",Kh(r))for(var s=0;s<r.length;s++){n=r[s];var l=t+ku(n,s);o+=Zl(n,i,a,l,e)}else if(l=$m(r),typeof l=="function")for(r=l.call(r),s=0;!(n=r.next()).done;)n=n.value,l=t+ku(n,s++),o+=Zl(n,i,a,l,e);else if(n==="object")throw i=String(r),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return o}function Al(r,i,a){if(r==null)return r;var t=[],e=0;return Zl(r,t,"","",function(n){return i.call(a,n,e++)}),t}function ry(r){if(r._status===-1){var i=r._result;i=i(),i.then(function(a){(r._status===0||r._status===-1)&&(r._status=1,r._result=a)},function(a){(r._status===0||r._status===-1)&&(r._status=2,r._result=a)}),r._status===-1&&(r._status=0,r._result=i)}if(r._status===1)return r._result.default;throw r._result}var Ar={current:null},$l={transition:null},ny={ReactCurrentDispatcher:Ar,ReactCurrentBatchConfig:$l,ReactCurrentOwner:Nf};Pe.Children={map:Al,forEach:function(r,i,a){Al(r,function(){i.apply(this,arguments)},a)},count:function(r){var i=0;return Al(r,function(){i++}),i},toArray:function(r){return Al(r,function(i){return i})||[]},only:function(r){if(!Vf(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Pe.Component=Uo;Pe.Fragment=Wm;Pe.Profiler=jm;Pe.PureComponent=If;Pe.StrictMode=Qm;Pe.Suspense=Km;Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ny;Pe.cloneElement=function(r,i,a){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var t=Gv({},r.props),e=r.key,n=r.ref,o=r._owner;if(i!=null){if(i.ref!==void 0&&(n=i.ref,o=Nf.current),i.key!==void 0&&(e=""+i.key),r.type&&r.type.defaultProps)var s=r.type.defaultProps;for(l in i)Qv.call(i,l)&&!jv.hasOwnProperty(l)&&(t[l]=i[l]===void 0&&s!==void 0?s[l]:i[l])}var l=arguments.length-2;if(l===1)t.children=a;else if(1<l){s=Array(l);for(var c=0;c<l;c++)s[c]=arguments[c+2];t.children=s}return{$$typeof:tl,type:r.type,key:e,ref:n,props:t,_owner:o}};Pe.createContext=function(r){return r={$$typeof:Ym,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Xm,_context:r},r.Consumer=r};Pe.createElement=Xv;Pe.createFactory=function(r){var i=Xv.bind(null,r);return i.type=r,i};Pe.createRef=function(){return{current:null}};Pe.forwardRef=function(r){return{$$typeof:qm,render:r}};Pe.isValidElement=Vf;Pe.lazy=function(r){return{$$typeof:Zm,_payload:{_status:-1,_result:r},_init:ry}};Pe.memo=function(r,i){return{$$typeof:Jm,type:r,compare:i===void 0?null:i}};Pe.startTransition=function(r){var i=$l.transition;$l.transition={};try{r()}finally{$l.transition=i}};Pe.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Pe.useCallback=function(r,i){return Ar.current.useCallback(r,i)};Pe.useContext=function(r){return Ar.current.useContext(r)};Pe.useDebugValue=function(){};Pe.useDeferredValue=function(r){return Ar.current.useDeferredValue(r)};Pe.useEffect=function(r,i){return Ar.current.useEffect(r,i)};Pe.useId=function(){return Ar.current.useId()};Pe.useImperativeHandle=function(r,i,a){return Ar.current.useImperativeHandle(r,i,a)};Pe.useInsertionEffect=function(r,i){return Ar.current.useInsertionEffect(r,i)};Pe.useLayoutEffect=function(r,i){return Ar.current.useLayoutEffect(r,i)};Pe.useMemo=function(r,i){return Ar.current.useMemo(r,i)};Pe.useReducer=function(r,i,a){return Ar.current.useReducer(r,i,a)};Pe.useRef=function(r){return Ar.current.useRef(r)};Pe.useState=function(r){return Ar.current.useState(r)};Pe.useSyncExternalStore=function(r,i,a){return Ar.current.useSyncExternalStore(r,i,a)};Pe.useTransition=function(){return Ar.current.useTransition()};Pe.version="18.2.0";kv.exports=Pe;var Of=kv.exports;const Yv=Gm(Of);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iy=Of,ay=Symbol.for("react.element"),oy=Symbol.for("react.fragment"),sy=Object.prototype.hasOwnProperty,ly=iy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,cy={key:!0,ref:!0,__self:!0,__source:!0};function qv(r,i,a){var t,e={},n=null,o=null;a!==void 0&&(n=""+a),i.key!==void 0&&(n=""+i.key),i.ref!==void 0&&(o=i.ref);for(t in i)sy.call(i,t)&&!cy.hasOwnProperty(t)&&(e[t]=i[t]);if(r&&r.defaultProps)for(t in i=r.defaultProps,i)e[t]===void 0&&(e[t]=i[t]);return{$$typeof:ay,type:r,key:n,ref:o,props:e,_owner:ly.current}}su.Fragment=oy;su.jsx=qv;su.jsxs=qv;zv.exports=su;var gd=zv.exports,Kv={exports:{}},Jr={},Jv={exports:{}},Zv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function i(D,N){var O=D.length;D.push(N);e:for(;0<O;){var G=O-1>>>1,Q=D[G];if(0<e(Q,N))D[G]=N,D[O]=Q,O=G;else break e}}function a(D){return D.length===0?null:D[0]}function t(D){if(D.length===0)return null;var N=D[0],O=D.pop();if(O!==N){D[0]=O;e:for(var G=0,Q=D.length,H=Q>>>1;G<H;){var ee=2*(G+1)-1,ve=D[ee],oe=ee+1,ne=D[oe];if(0>e(ve,O))oe<Q&&0>e(ne,ve)?(D[G]=ne,D[oe]=O,G=oe):(D[G]=ve,D[ee]=O,G=ee);else if(oe<Q&&0>e(ne,O))D[G]=ne,D[oe]=O,G=oe;else break e}}return N}function e(D,N){var O=D.sortIndex-N.sortIndex;return O!==0?O:D.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;r.unstable_now=function(){return n.now()}}else{var o=Date,s=o.now();r.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,f=3,h=!1,_=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(D){for(var N=a(c);N!==null;){if(N.callback===null)t(c);else if(N.startTime<=D)t(c),N.sortIndex=N.expirationTime,i(l,N);else break;N=a(c)}}function A(D){if(g=!1,m(D),!_)if(a(l)!==null)_=!0,L(S);else{var N=a(c);N!==null&&V(A,N.startTime-D)}}function S(D,N){_=!1,g&&(g=!1,v(C),C=-1),h=!0;var O=f;try{for(m(N),d=a(l);d!==null&&(!(d.expirationTime>N)||D&&!T());){var G=d.callback;if(typeof G=="function"){d.callback=null,f=d.priorityLevel;var Q=G(d.expirationTime<=N);N=r.unstable_now(),typeof Q=="function"?d.callback=Q:d===a(l)&&t(l),m(N)}else t(l);d=a(l)}if(d!==null)var H=!0;else{var ee=a(c);ee!==null&&V(A,ee.startTime-N),H=!1}return H}finally{d=null,f=O,h=!1}}var x=!1,b=null,C=-1,w=5,E=-1;function T(){return!(r.unstable_now()-E<w)}function M(){if(b!==null){var D=r.unstable_now();E=D;var N=!0;try{N=b(!0,D)}finally{N?B():(x=!1,b=null)}}else x=!1}var B;if(typeof p=="function")B=function(){p(M)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,F=I.port2;I.port1.onmessage=M,B=function(){F.postMessage(null)}}else B=function(){y(M,0)};function L(D){b=D,x||(x=!0,B())}function V(D,N){C=y(function(){D(r.unstable_now())},N)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(D){D.callback=null},r.unstable_continueExecution=function(){_||h||(_=!0,L(S))},r.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<D?Math.floor(1e3/D):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return a(l)},r.unstable_next=function(D){switch(f){case 1:case 2:case 3:var N=3;break;default:N=f}var O=f;f=N;try{return D()}finally{f=O}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(D,N){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var O=f;f=D;try{return N()}finally{f=O}},r.unstable_scheduleCallback=function(D,N,O){var G=r.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?G+O:G):O=G,D){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=O+Q,D={id:u++,callback:N,priorityLevel:D,startTime:O,expirationTime:Q,sortIndex:-1},O>G?(D.sortIndex=O,i(c,D),a(l)===null&&D===a(c)&&(g?(v(C),C=-1):g=!0,V(A,O-G))):(D.sortIndex=Q,i(l,D),_||h||(_=!0,L(S))),D},r.unstable_shouldYield=T,r.unstable_wrapCallback=function(D){var N=f;return function(){var O=f;f=N;try{return D.apply(this,arguments)}finally{f=O}}}})(Zv);Jv.exports=Zv;var uy=Jv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $v=Of,Yr=uy;function Y(r){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+r,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+r+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var eg=new Set,Ts={};function Qa(r,i){Eo(r,i),Eo(r+"Capture",i)}function Eo(r,i){for(Ts[r]=i,r=0;r<i.length;r++)eg.add(i[r])}var bi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),md=Object.prototype.hasOwnProperty,dy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zh={},$h={};function fy(r){return md.call($h,r)?!0:md.call(Zh,r)?!1:dy.test(r)?$h[r]=!0:(Zh[r]=!0,!1)}function hy(r,i,a,t){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return t?!1:a!==null?!a.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function _y(r,i,a,t){if(i===null||typeof i>"u"||hy(r,i,a,t))return!0;if(t)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function xr(r,i,a,t,e,n,o){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=t,this.attributeNamespace=e,this.mustUseProperty=a,this.propertyName=r,this.type=i,this.sanitizeURL=n,this.removeEmptyString=o}var Yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Yt[r]=new xr(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var i=r[0];Yt[i]=new xr(i,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Yt[r]=new xr(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Yt[r]=new xr(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Yt[r]=new xr(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Yt[r]=new xr(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Yt[r]=new xr(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Yt[r]=new xr(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Yt[r]=new xr(r,5,!1,r.toLowerCase(),null,!1,!1)});var zf=/[\-:]([a-z])/g;function kf(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var i=r.replace(zf,kf);Yt[i]=new xr(i,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var i=r.replace(zf,kf);Yt[i]=new xr(i,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var i=r.replace(zf,kf);Yt[i]=new xr(i,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Yt[r]=new xr(r,1,!1,r.toLowerCase(),null,!1,!1)});Yt.xlinkHref=new xr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Yt[r]=new xr(r,1,!1,r.toLowerCase(),null,!0,!0)});function Uf(r,i,a,t){var e=Yt.hasOwnProperty(i)?Yt[i]:null;(e!==null?e.type!==0:t||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(_y(i,a,e,t)&&(a=null),t||e===null?fy(i)&&(a===null?r.removeAttribute(i):r.setAttribute(i,""+a)):e.mustUseProperty?r[e.propertyName]=a===null?e.type===3?!1:"":a:(i=e.attributeName,t=e.attributeNamespace,a===null?r.removeAttribute(i):(e=e.type,a=e===3||e===4&&a===!0?"":""+a,t?r.setAttributeNS(t,i,a):r.setAttribute(i,a))))}var Mi=$v.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xl=Symbol.for("react.element"),eo=Symbol.for("react.portal"),to=Symbol.for("react.fragment"),Gf=Symbol.for("react.strict_mode"),yd=Symbol.for("react.profiler"),tg=Symbol.for("react.provider"),rg=Symbol.for("react.context"),Hf=Symbol.for("react.forward_ref"),Ad=Symbol.for("react.suspense"),xd=Symbol.for("react.suspense_list"),Wf=Symbol.for("react.memo"),zi=Symbol.for("react.lazy"),ng=Symbol.for("react.offscreen"),e_=Symbol.iterator;function Xo(r){return r===null||typeof r!="object"?null:(r=e_&&r[e_]||r["@@iterator"],typeof r=="function"?r:null)}var ft=Object.assign,Uu;function as(r){if(Uu===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);Uu=i&&i[1]||""}return`
`+Uu+r}var Gu=!1;function Hu(r,i){if(!r||Gu)return"";Gu=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(c){var t=c}Reflect.construct(r,[],i)}else{try{i.call()}catch(c){t=c}r.call(i.prototype)}else{try{throw Error()}catch(c){t=c}r()}}catch(c){if(c&&t&&typeof c.stack=="string"){for(var e=c.stack.split(`
`),n=t.stack.split(`
`),o=e.length-1,s=n.length-1;1<=o&&0<=s&&e[o]!==n[s];)s--;for(;1<=o&&0<=s;o--,s--)if(e[o]!==n[s]){if(o!==1||s!==1)do if(o--,s--,0>s||e[o]!==n[s]){var l=`
`+e[o].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=o&&0<=s);break}}}finally{Gu=!1,Error.prepareStackTrace=a}return(r=r?r.displayName||r.name:"")?as(r):""}function py(r){switch(r.tag){case 5:return as(r.type);case 16:return as("Lazy");case 13:return as("Suspense");case 19:return as("SuspenseList");case 0:case 2:case 15:return r=Hu(r.type,!1),r;case 11:return r=Hu(r.type.render,!1),r;case 1:return r=Hu(r.type,!0),r;default:return""}}function Sd(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case to:return"Fragment";case eo:return"Portal";case yd:return"Profiler";case Gf:return"StrictMode";case Ad:return"Suspense";case xd:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case rg:return(r.displayName||"Context")+".Consumer";case tg:return(r._context.displayName||"Context")+".Provider";case Hf:var i=r.render;return r=r.displayName,r||(r=i.displayName||i.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Wf:return i=r.displayName||null,i!==null?i:Sd(r.type)||"Memo";case zi:i=r._payload,r=r._init;try{return Sd(r(i))}catch{}}return null}function vy(r){var i=r.type;switch(r.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=i.render,r=r.displayName||r.name||"",i.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Sd(i);case 8:return i===Gf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function ia(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function ig(r){var i=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function gy(r){var i=ig(r)?"checked":"value",a=Object.getOwnPropertyDescriptor(r.constructor.prototype,i),t=""+r[i];if(!r.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var e=a.get,n=a.set;return Object.defineProperty(r,i,{configurable:!0,get:function(){return e.call(this)},set:function(o){t=""+o,n.call(this,o)}}),Object.defineProperty(r,i,{enumerable:a.enumerable}),{getValue:function(){return t},setValue:function(o){t=""+o},stopTracking:function(){r._valueTracker=null,delete r[i]}}}}function Sl(r){r._valueTracker||(r._valueTracker=gy(r))}function ag(r){if(!r)return!1;var i=r._valueTracker;if(!i)return!0;var a=i.getValue(),t="";return r&&(t=ig(r)?r.checked?"true":"false":r.value),r=t,r!==a?(i.setValue(r),!0):!1}function hc(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Cd(r,i){var a=i.checked;return ft({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??r._wrapperState.initialChecked})}function t_(r,i){var a=i.defaultValue==null?"":i.defaultValue,t=i.checked!=null?i.checked:i.defaultChecked;a=ia(i.value!=null?i.value:a),r._wrapperState={initialChecked:t,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function og(r,i){i=i.checked,i!=null&&Uf(r,"checked",i,!1)}function bd(r,i){og(r,i);var a=ia(i.value),t=i.type;if(a!=null)t==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+a):r.value!==""+a&&(r.value=""+a);else if(t==="submit"||t==="reset"){r.removeAttribute("value");return}i.hasOwnProperty("value")?Ed(r,i.type,a):i.hasOwnProperty("defaultValue")&&Ed(r,i.type,ia(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(r.defaultChecked=!!i.defaultChecked)}function r_(r,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var t=i.type;if(!(t!=="submit"&&t!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+r._wrapperState.initialValue,a||i===r.value||(r.value=i),r.defaultValue=i}a=r.name,a!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,a!==""&&(r.name=a)}function Ed(r,i,a){(i!=="number"||hc(r.ownerDocument)!==r)&&(a==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+a&&(r.defaultValue=""+a))}var os=Array.isArray;function vo(r,i,a,t){if(r=r.options,i){i={};for(var e=0;e<a.length;e++)i["$"+a[e]]=!0;for(a=0;a<r.length;a++)e=i.hasOwnProperty("$"+r[a].value),r[a].selected!==e&&(r[a].selected=e),e&&t&&(r[a].defaultSelected=!0)}else{for(a=""+ia(a),i=null,e=0;e<r.length;e++){if(r[e].value===a){r[e].selected=!0,t&&(r[e].defaultSelected=!0);return}i!==null||r[e].disabled||(i=r[e])}i!==null&&(i.selected=!0)}}function wd(r,i){if(i.dangerouslySetInnerHTML!=null)throw Error(Y(91));return ft({},i,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function n_(r,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(Y(92));if(os(a)){if(1<a.length)throw Error(Y(93));a=a[0]}i=a}i==null&&(i=""),a=i}r._wrapperState={initialValue:ia(a)}}function sg(r,i){var a=ia(i.value),t=ia(i.defaultValue);a!=null&&(a=""+a,a!==r.value&&(r.value=a),i.defaultValue==null&&r.defaultValue!==a&&(r.defaultValue=a)),t!=null&&(r.defaultValue=""+t)}function i_(r){var i=r.textContent;i===r._wrapperState.initialValue&&i!==""&&i!==null&&(r.value=i)}function lg(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Td(r,i){return r==null||r==="http://www.w3.org/1999/xhtml"?lg(i):r==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Cl,cg=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,t,e){MSApp.execUnsafeLocalFunction(function(){return r(i,a,t,e)})}:r}(function(r,i){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=i;else{for(Cl=Cl||document.createElement("div"),Cl.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Cl.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;i.firstChild;)r.appendChild(i.firstChild)}});function Rs(r,i){if(i){var a=r.firstChild;if(a&&a===r.lastChild&&a.nodeType===3){a.nodeValue=i;return}}r.textContent=i}var ds={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},my=["Webkit","ms","Moz","O"];Object.keys(ds).forEach(function(r){my.forEach(function(i){i=i+r.charAt(0).toUpperCase()+r.substring(1),ds[i]=ds[r]})});function ug(r,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||ds.hasOwnProperty(r)&&ds[r]?(""+i).trim():i+"px"}function dg(r,i){r=r.style;for(var a in i)if(i.hasOwnProperty(a)){var t=a.indexOf("--")===0,e=ug(a,i[a],t);a==="float"&&(a="cssFloat"),t?r.setProperty(a,e):r[a]=e}}var yy=ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Rd(r,i){if(i){if(yy[r]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(Y(137,r));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(Y(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(Y(61))}if(i.style!=null&&typeof i.style!="object")throw Error(Y(62))}}function Pd(r,i){if(r.indexOf("-")===-1)return typeof i.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Md=null;function Qf(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Bd=null,go=null,mo=null;function a_(r){if(r=il(r)){if(typeof Bd!="function")throw Error(Y(280));var i=r.stateNode;i&&(i=fu(i),Bd(r.stateNode,r.type,i))}}function fg(r){go?mo?mo.push(r):mo=[r]:go=r}function hg(){if(go){var r=go,i=mo;if(mo=go=null,a_(r),i)for(r=0;r<i.length;r++)a_(i[r])}}function _g(r,i){return r(i)}function pg(){}var Wu=!1;function vg(r,i,a){if(Wu)return r(i,a);Wu=!0;try{return _g(r,i,a)}finally{Wu=!1,(go!==null||mo!==null)&&(pg(),hg())}}function Ps(r,i){var a=r.stateNode;if(a===null)return null;var t=fu(a);if(t===null)return null;a=t[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(t=!t.disabled)||(r=r.type,t=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!t;break e;default:r=!1}if(r)return null;if(a&&typeof a!="function")throw Error(Y(231,i,typeof a));return a}var Dd=!1;if(bi)try{var Yo={};Object.defineProperty(Yo,"passive",{get:function(){Dd=!0}}),window.addEventListener("test",Yo,Yo),window.removeEventListener("test",Yo,Yo)}catch{Dd=!1}function Ay(r,i,a,t,e,n,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{i.apply(a,c)}catch(u){this.onError(u)}}var fs=!1,_c=null,pc=!1,Ld=null,xy={onError:function(r){fs=!0,_c=r}};function Sy(r,i,a,t,e,n,o,s,l){fs=!1,_c=null,Ay.apply(xy,arguments)}function Cy(r,i,a,t,e,n,o,s,l){if(Sy.apply(this,arguments),fs){if(fs){var c=_c;fs=!1,_c=null}else throw Error(Y(198));pc||(pc=!0,Ld=c)}}function ja(r){var i=r,a=r;if(r.alternate)for(;i.return;)i=i.return;else{r=i;do i=r,i.flags&4098&&(a=i.return),r=i.return;while(r)}return i.tag===3?a:null}function gg(r){if(r.tag===13){var i=r.memoizedState;if(i===null&&(r=r.alternate,r!==null&&(i=r.memoizedState)),i!==null)return i.dehydrated}return null}function o_(r){if(ja(r)!==r)throw Error(Y(188))}function by(r){var i=r.alternate;if(!i){if(i=ja(r),i===null)throw Error(Y(188));return i!==r?null:r}for(var a=r,t=i;;){var e=a.return;if(e===null)break;var n=e.alternate;if(n===null){if(t=e.return,t!==null){a=t;continue}break}if(e.child===n.child){for(n=e.child;n;){if(n===a)return o_(e),r;if(n===t)return o_(e),i;n=n.sibling}throw Error(Y(188))}if(a.return!==t.return)a=e,t=n;else{for(var o=!1,s=e.child;s;){if(s===a){o=!0,a=e,t=n;break}if(s===t){o=!0,t=e,a=n;break}s=s.sibling}if(!o){for(s=n.child;s;){if(s===a){o=!0,a=n,t=e;break}if(s===t){o=!0,t=n,a=e;break}s=s.sibling}if(!o)throw Error(Y(189))}}if(a.alternate!==t)throw Error(Y(190))}if(a.tag!==3)throw Error(Y(188));return a.stateNode.current===a?r:i}function mg(r){return r=by(r),r!==null?yg(r):null}function yg(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var i=yg(r);if(i!==null)return i;r=r.sibling}return null}var Ag=Yr.unstable_scheduleCallback,s_=Yr.unstable_cancelCallback,Ey=Yr.unstable_shouldYield,wy=Yr.unstable_requestPaint,St=Yr.unstable_now,Ty=Yr.unstable_getCurrentPriorityLevel,jf=Yr.unstable_ImmediatePriority,xg=Yr.unstable_UserBlockingPriority,vc=Yr.unstable_NormalPriority,Ry=Yr.unstable_LowPriority,Sg=Yr.unstable_IdlePriority,lu=null,Yn=null;function Py(r){if(Yn&&typeof Yn.onCommitFiberRoot=="function")try{Yn.onCommitFiberRoot(lu,r,void 0,(r.current.flags&128)===128)}catch{}}var Fn=Math.clz32?Math.clz32:Dy,My=Math.log,By=Math.LN2;function Dy(r){return r>>>=0,r===0?32:31-(My(r)/By|0)|0}var bl=64,El=4194304;function ss(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function gc(r,i){var a=r.pendingLanes;if(a===0)return 0;var t=0,e=r.suspendedLanes,n=r.pingedLanes,o=a&268435455;if(o!==0){var s=o&~e;s!==0?t=ss(s):(n&=o,n!==0&&(t=ss(n)))}else o=a&~e,o!==0?t=ss(o):n!==0&&(t=ss(n));if(t===0)return 0;if(i!==0&&i!==t&&!(i&e)&&(e=t&-t,n=i&-i,e>=n||e===16&&(n&4194240)!==0))return i;if(t&4&&(t|=a&16),i=r.entangledLanes,i!==0)for(r=r.entanglements,i&=t;0<i;)a=31-Fn(i),e=1<<a,t|=r[a],i&=~e;return t}function Ly(r,i){switch(r){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Iy(r,i){for(var a=r.suspendedLanes,t=r.pingedLanes,e=r.expirationTimes,n=r.pendingLanes;0<n;){var o=31-Fn(n),s=1<<o,l=e[o];l===-1?(!(s&a)||s&t)&&(e[o]=Ly(s,i)):l<=i&&(r.expiredLanes|=s),n&=~s}}function Id(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function Cg(){var r=bl;return bl<<=1,!(bl&4194240)&&(bl=64),r}function Qu(r){for(var i=[],a=0;31>a;a++)i.push(r);return i}function rl(r,i,a){r.pendingLanes|=i,i!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,i=31-Fn(i),r[i]=a}function Fy(r,i){var a=r.pendingLanes&~i;r.pendingLanes=i,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=i,r.mutableReadLanes&=i,r.entangledLanes&=i,i=r.entanglements;var t=r.eventTimes;for(r=r.expirationTimes;0<a;){var e=31-Fn(a),n=1<<e;i[e]=0,t[e]=-1,r[e]=-1,a&=~n}}function Xf(r,i){var a=r.entangledLanes|=i;for(r=r.entanglements;a;){var t=31-Fn(a),e=1<<t;e&i|r[t]&i&&(r[t]|=i),a&=~e}}var ke=0;function bg(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var Eg,Yf,wg,Tg,Rg,Fd=!1,wl=[],qi=null,Ki=null,Ji=null,Ms=new Map,Bs=new Map,Gi=[],Ny="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function l_(r,i){switch(r){case"focusin":case"focusout":qi=null;break;case"dragenter":case"dragleave":Ki=null;break;case"mouseover":case"mouseout":Ji=null;break;case"pointerover":case"pointerout":Ms.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bs.delete(i.pointerId)}}function qo(r,i,a,t,e,n){return r===null||r.nativeEvent!==n?(r={blockedOn:i,domEventName:a,eventSystemFlags:t,nativeEvent:n,targetContainers:[e]},i!==null&&(i=il(i),i!==null&&Yf(i)),r):(r.eventSystemFlags|=t,i=r.targetContainers,e!==null&&i.indexOf(e)===-1&&i.push(e),r)}function Vy(r,i,a,t,e){switch(i){case"focusin":return qi=qo(qi,r,i,a,t,e),!0;case"dragenter":return Ki=qo(Ki,r,i,a,t,e),!0;case"mouseover":return Ji=qo(Ji,r,i,a,t,e),!0;case"pointerover":var n=e.pointerId;return Ms.set(n,qo(Ms.get(n)||null,r,i,a,t,e)),!0;case"gotpointercapture":return n=e.pointerId,Bs.set(n,qo(Bs.get(n)||null,r,i,a,t,e)),!0}return!1}function Pg(r){var i=Ca(r.target);if(i!==null){var a=ja(i);if(a!==null){if(i=a.tag,i===13){if(i=gg(a),i!==null){r.blockedOn=i,Rg(r.priority,function(){wg(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){r.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}r.blockedOn=null}function ec(r){if(r.blockedOn!==null)return!1;for(var i=r.targetContainers;0<i.length;){var a=Nd(r.domEventName,r.eventSystemFlags,i[0],r.nativeEvent);if(a===null){a=r.nativeEvent;var t=new a.constructor(a.type,a);Md=t,a.target.dispatchEvent(t),Md=null}else return i=il(a),i!==null&&Yf(i),r.blockedOn=a,!1;i.shift()}return!0}function c_(r,i,a){ec(r)&&a.delete(i)}function Oy(){Fd=!1,qi!==null&&ec(qi)&&(qi=null),Ki!==null&&ec(Ki)&&(Ki=null),Ji!==null&&ec(Ji)&&(Ji=null),Ms.forEach(c_),Bs.forEach(c_)}function Ko(r,i){r.blockedOn===i&&(r.blockedOn=null,Fd||(Fd=!0,Yr.unstable_scheduleCallback(Yr.unstable_NormalPriority,Oy)))}function Ds(r){function i(e){return Ko(e,r)}if(0<wl.length){Ko(wl[0],r);for(var a=1;a<wl.length;a++){var t=wl[a];t.blockedOn===r&&(t.blockedOn=null)}}for(qi!==null&&Ko(qi,r),Ki!==null&&Ko(Ki,r),Ji!==null&&Ko(Ji,r),Ms.forEach(i),Bs.forEach(i),a=0;a<Gi.length;a++)t=Gi[a],t.blockedOn===r&&(t.blockedOn=null);for(;0<Gi.length&&(a=Gi[0],a.blockedOn===null);)Pg(a),a.blockedOn===null&&Gi.shift()}var yo=Mi.ReactCurrentBatchConfig,mc=!0;function zy(r,i,a,t){var e=ke,n=yo.transition;yo.transition=null;try{ke=1,qf(r,i,a,t)}finally{ke=e,yo.transition=n}}function ky(r,i,a,t){var e=ke,n=yo.transition;yo.transition=null;try{ke=4,qf(r,i,a,t)}finally{ke=e,yo.transition=n}}function qf(r,i,a,t){if(mc){var e=Nd(r,i,a,t);if(e===null)td(r,i,t,yc,a),l_(r,t);else if(Vy(e,r,i,a,t))t.stopPropagation();else if(l_(r,t),i&4&&-1<Ny.indexOf(r)){for(;e!==null;){var n=il(e);if(n!==null&&Eg(n),n=Nd(r,i,a,t),n===null&&td(r,i,t,yc,a),n===e)break;e=n}e!==null&&t.stopPropagation()}else td(r,i,t,null,a)}}var yc=null;function Nd(r,i,a,t){if(yc=null,r=Qf(t),r=Ca(r),r!==null)if(i=ja(r),i===null)r=null;else if(a=i.tag,a===13){if(r=gg(i),r!==null)return r;r=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null);return yc=r,null}function Mg(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ty()){case jf:return 1;case xg:return 4;case vc:case Ry:return 16;case Sg:return 536870912;default:return 16}default:return 16}}var Wi=null,Kf=null,tc=null;function Bg(){if(tc)return tc;var r,i=Kf,a=i.length,t,e="value"in Wi?Wi.value:Wi.textContent,n=e.length;for(r=0;r<a&&i[r]===e[r];r++);var o=a-r;for(t=1;t<=o&&i[a-t]===e[n-t];t++);return tc=e.slice(r,1<t?1-t:void 0)}function rc(r){var i=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&i===13&&(r=13)):r=i,r===10&&(r=13),32<=r||r===13?r:0}function Tl(){return!0}function u_(){return!1}function Zr(r){function i(a,t,e,n,o){this._reactName=a,this._targetInst=e,this.type=t,this.nativeEvent=n,this.target=o,this.currentTarget=null;for(var s in r)r.hasOwnProperty(s)&&(a=r[s],this[s]=a?a(n):n[s]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?Tl:u_,this.isPropagationStopped=u_,this}return ft(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Tl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Tl)},persist:function(){},isPersistent:Tl}),i}var Go={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jf=Zr(Go),nl=ft({},Go,{view:0,detail:0}),Uy=Zr(nl),ju,Xu,Jo,cu=ft({},nl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zf,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Jo&&(Jo&&r.type==="mousemove"?(ju=r.screenX-Jo.screenX,Xu=r.screenY-Jo.screenY):Xu=ju=0,Jo=r),ju)},movementY:function(r){return"movementY"in r?r.movementY:Xu}}),d_=Zr(cu),Gy=ft({},cu,{dataTransfer:0}),Hy=Zr(Gy),Wy=ft({},nl,{relatedTarget:0}),Yu=Zr(Wy),Qy=ft({},Go,{animationName:0,elapsedTime:0,pseudoElement:0}),jy=Zr(Qy),Xy=ft({},Go,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Yy=Zr(Xy),qy=ft({},Go,{data:0}),f_=Zr(qy),Ky={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $y(r){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(r):(r=Zy[r])?!!i[r]:!1}function Zf(){return $y}var eA=ft({},nl,{key:function(r){if(r.key){var i=Ky[r.key]||r.key;if(i!=="Unidentified")return i}return r.type==="keypress"?(r=rc(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Jy[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zf,charCode:function(r){return r.type==="keypress"?rc(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?rc(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),tA=Zr(eA),rA=ft({},cu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),h_=Zr(rA),nA=ft({},nl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zf}),iA=Zr(nA),aA=ft({},Go,{propertyName:0,elapsedTime:0,pseudoElement:0}),oA=Zr(aA),sA=ft({},cu,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),lA=Zr(sA),cA=[9,13,27,32],$f=bi&&"CompositionEvent"in window,hs=null;bi&&"documentMode"in document&&(hs=document.documentMode);var uA=bi&&"TextEvent"in window&&!hs,Dg=bi&&(!$f||hs&&8<hs&&11>=hs),__=" ",p_=!1;function Lg(r,i){switch(r){case"keyup":return cA.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ig(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ro=!1;function dA(r,i){switch(r){case"compositionend":return Ig(i);case"keypress":return i.which!==32?null:(p_=!0,__);case"textInput":return r=i.data,r===__&&p_?null:r;default:return null}}function fA(r,i){if(ro)return r==="compositionend"||!$f&&Lg(r,i)?(r=Bg(),tc=Kf=Wi=null,ro=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Dg&&i.locale!=="ko"?null:i.data;default:return null}}var hA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function v_(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i==="input"?!!hA[r.type]:i==="textarea"}function Fg(r,i,a,t){fg(t),i=Ac(i,"onChange"),0<i.length&&(a=new Jf("onChange","change",null,a,t),r.push({event:a,listeners:i}))}var _s=null,Ls=null;function _A(r){jg(r,0)}function uu(r){var i=ao(r);if(ag(i))return r}function pA(r,i){if(r==="change")return i}var Ng=!1;if(bi){var qu;if(bi){var Ku="oninput"in document;if(!Ku){var g_=document.createElement("div");g_.setAttribute("oninput","return;"),Ku=typeof g_.oninput=="function"}qu=Ku}else qu=!1;Ng=qu&&(!document.documentMode||9<document.documentMode)}function m_(){_s&&(_s.detachEvent("onpropertychange",Vg),Ls=_s=null)}function Vg(r){if(r.propertyName==="value"&&uu(Ls)){var i=[];Fg(i,Ls,r,Qf(r)),vg(_A,i)}}function vA(r,i,a){r==="focusin"?(m_(),_s=i,Ls=a,_s.attachEvent("onpropertychange",Vg)):r==="focusout"&&m_()}function gA(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return uu(Ls)}function mA(r,i){if(r==="click")return uu(i)}function yA(r,i){if(r==="input"||r==="change")return uu(i)}function AA(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var Vn=typeof Object.is=="function"?Object.is:AA;function Is(r,i){if(Vn(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;var a=Object.keys(r),t=Object.keys(i);if(a.length!==t.length)return!1;for(t=0;t<a.length;t++){var e=a[t];if(!md.call(i,e)||!Vn(r[e],i[e]))return!1}return!0}function y_(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function A_(r,i){var a=y_(r);r=0;for(var t;a;){if(a.nodeType===3){if(t=r+a.textContent.length,r<=i&&t>=i)return{node:a,offset:i-r};r=t}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=y_(a)}}function Og(r,i){return r&&i?r===i?!0:r&&r.nodeType===3?!1:i&&i.nodeType===3?Og(r,i.parentNode):"contains"in r?r.contains(i):r.compareDocumentPosition?!!(r.compareDocumentPosition(i)&16):!1:!1}function zg(){for(var r=window,i=hc();i instanceof r.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)r=i.contentWindow;else break;i=hc(r.document)}return i}function eh(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i&&(i==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||i==="textarea"||r.contentEditable==="true")}function xA(r){var i=zg(),a=r.focusedElem,t=r.selectionRange;if(i!==a&&a&&a.ownerDocument&&Og(a.ownerDocument.documentElement,a)){if(t!==null&&eh(a)){if(i=t.start,r=t.end,r===void 0&&(r=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(r,a.value.length);else if(r=(i=a.ownerDocument||document)&&i.defaultView||window,r.getSelection){r=r.getSelection();var e=a.textContent.length,n=Math.min(t.start,e);t=t.end===void 0?n:Math.min(t.end,e),!r.extend&&n>t&&(e=t,t=n,n=e),e=A_(a,n);var o=A_(a,t);e&&o&&(r.rangeCount!==1||r.anchorNode!==e.node||r.anchorOffset!==e.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(i=i.createRange(),i.setStart(e.node,e.offset),r.removeAllRanges(),n>t?(r.addRange(i),r.extend(o.node,o.offset)):(i.setEnd(o.node,o.offset),r.addRange(i)))}}for(i=[],r=a;r=r.parentNode;)r.nodeType===1&&i.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)r=i[a],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var SA=bi&&"documentMode"in document&&11>=document.documentMode,no=null,Vd=null,ps=null,Od=!1;function x_(r,i,a){var t=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Od||no==null||no!==hc(t)||(t=no,"selectionStart"in t&&eh(t)?t={start:t.selectionStart,end:t.selectionEnd}:(t=(t.ownerDocument&&t.ownerDocument.defaultView||window).getSelection(),t={anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}),ps&&Is(ps,t)||(ps=t,t=Ac(Vd,"onSelect"),0<t.length&&(i=new Jf("onSelect","select",null,i,a),r.push({event:i,listeners:t}),i.target=no)))}function Rl(r,i){var a={};return a[r.toLowerCase()]=i.toLowerCase(),a["Webkit"+r]="webkit"+i,a["Moz"+r]="moz"+i,a}var io={animationend:Rl("Animation","AnimationEnd"),animationiteration:Rl("Animation","AnimationIteration"),animationstart:Rl("Animation","AnimationStart"),transitionend:Rl("Transition","TransitionEnd")},Ju={},kg={};bi&&(kg=document.createElement("div").style,"AnimationEvent"in window||(delete io.animationend.animation,delete io.animationiteration.animation,delete io.animationstart.animation),"TransitionEvent"in window||delete io.transitionend.transition);function du(r){if(Ju[r])return Ju[r];if(!io[r])return r;var i=io[r],a;for(a in i)if(i.hasOwnProperty(a)&&a in kg)return Ju[r]=i[a];return r}var Ug=du("animationend"),Gg=du("animationiteration"),Hg=du("animationstart"),Wg=du("transitionend"),Qg=new Map,S_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ua(r,i){Qg.set(r,i),Qa(i,[r])}for(var Zu=0;Zu<S_.length;Zu++){var $u=S_[Zu],CA=$u.toLowerCase(),bA=$u[0].toUpperCase()+$u.slice(1);ua(CA,"on"+bA)}ua(Ug,"onAnimationEnd");ua(Gg,"onAnimationIteration");ua(Hg,"onAnimationStart");ua("dblclick","onDoubleClick");ua("focusin","onFocus");ua("focusout","onBlur");ua(Wg,"onTransitionEnd");Eo("onMouseEnter",["mouseout","mouseover"]);Eo("onMouseLeave",["mouseout","mouseover"]);Eo("onPointerEnter",["pointerout","pointerover"]);Eo("onPointerLeave",["pointerout","pointerover"]);Qa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ls="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),EA=new Set("cancel close invalid load scroll toggle".split(" ").concat(ls));function C_(r,i,a){var t=r.type||"unknown-event";r.currentTarget=a,Cy(t,i,void 0,r),r.currentTarget=null}function jg(r,i){i=(i&4)!==0;for(var a=0;a<r.length;a++){var t=r[a],e=t.event;t=t.listeners;e:{var n=void 0;if(i)for(var o=t.length-1;0<=o;o--){var s=t[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==n&&e.isPropagationStopped())break e;C_(e,s,c),n=l}else for(o=0;o<t.length;o++){if(s=t[o],l=s.instance,c=s.currentTarget,s=s.listener,l!==n&&e.isPropagationStopped())break e;C_(e,s,c),n=l}}}if(pc)throw r=Ld,pc=!1,Ld=null,r}function Ke(r,i){var a=i[Hd];a===void 0&&(a=i[Hd]=new Set);var t=r+"__bubble";a.has(t)||(Xg(i,r,2,!1),a.add(t))}function ed(r,i,a){var t=0;i&&(t|=4),Xg(a,r,t,i)}var Pl="_reactListening"+Math.random().toString(36).slice(2);function Fs(r){if(!r[Pl]){r[Pl]=!0,eg.forEach(function(a){a!=="selectionchange"&&(EA.has(a)||ed(a,!1,r),ed(a,!0,r))});var i=r.nodeType===9?r:r.ownerDocument;i===null||i[Pl]||(i[Pl]=!0,ed("selectionchange",!1,i))}}function Xg(r,i,a,t){switch(Mg(i)){case 1:var e=zy;break;case 4:e=ky;break;default:e=qf}a=e.bind(null,i,a,r),e=void 0,!Dd||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(e=!0),t?e!==void 0?r.addEventListener(i,a,{capture:!0,passive:e}):r.addEventListener(i,a,!0):e!==void 0?r.addEventListener(i,a,{passive:e}):r.addEventListener(i,a,!1)}function td(r,i,a,t,e){var n=t;if(!(i&1)&&!(i&2)&&t!==null)e:for(;;){if(t===null)return;var o=t.tag;if(o===3||o===4){var s=t.stateNode.containerInfo;if(s===e||s.nodeType===8&&s.parentNode===e)break;if(o===4)for(o=t.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===e||l.nodeType===8&&l.parentNode===e))return;o=o.return}for(;s!==null;){if(o=Ca(s),o===null)return;if(l=o.tag,l===5||l===6){t=n=o;continue e}s=s.parentNode}}t=t.return}vg(function(){var c=n,u=Qf(a),d=[];e:{var f=Qg.get(r);if(f!==void 0){var h=Jf,_=r;switch(r){case"keypress":if(rc(a)===0)break e;case"keydown":case"keyup":h=tA;break;case"focusin":_="focus",h=Yu;break;case"focusout":_="blur",h=Yu;break;case"beforeblur":case"afterblur":h=Yu;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=d_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Hy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=iA;break;case Ug:case Gg:case Hg:h=jy;break;case Wg:h=oA;break;case"scroll":h=Uy;break;case"wheel":h=lA;break;case"copy":case"cut":case"paste":h=Yy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=h_}var g=(i&4)!==0,y=!g&&r==="scroll",v=g?f!==null?f+"Capture":null:f;g=[];for(var p=c,m;p!==null;){m=p;var A=m.stateNode;if(m.tag===5&&A!==null&&(m=A,v!==null&&(A=Ps(p,v),A!=null&&g.push(Ns(p,A,m)))),y)break;p=p.return}0<g.length&&(f=new h(f,_,null,a,u),d.push({event:f,listeners:g}))}}if(!(i&7)){e:{if(f=r==="mouseover"||r==="pointerover",h=r==="mouseout"||r==="pointerout",f&&a!==Md&&(_=a.relatedTarget||a.fromElement)&&(Ca(_)||_[Ei]))break e;if((h||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,h?(_=a.relatedTarget||a.toElement,h=c,_=_?Ca(_):null,_!==null&&(y=ja(_),_!==y||_.tag!==5&&_.tag!==6)&&(_=null)):(h=null,_=c),h!==_)){if(g=d_,A="onMouseLeave",v="onMouseEnter",p="mouse",(r==="pointerout"||r==="pointerover")&&(g=h_,A="onPointerLeave",v="onPointerEnter",p="pointer"),y=h==null?f:ao(h),m=_==null?f:ao(_),f=new g(A,p+"leave",h,a,u),f.target=y,f.relatedTarget=m,A=null,Ca(u)===c&&(g=new g(v,p+"enter",_,a,u),g.target=m,g.relatedTarget=y,A=g),y=A,h&&_)t:{for(g=h,v=_,p=0,m=g;m;m=Ja(m))p++;for(m=0,A=v;A;A=Ja(A))m++;for(;0<p-m;)g=Ja(g),p--;for(;0<m-p;)v=Ja(v),m--;for(;p--;){if(g===v||v!==null&&g===v.alternate)break t;g=Ja(g),v=Ja(v)}g=null}else g=null;h!==null&&b_(d,f,h,g,!1),_!==null&&y!==null&&b_(d,y,_,g,!0)}}e:{if(f=c?ao(c):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var S=pA;else if(v_(f))if(Ng)S=yA;else{S=gA;var x=vA}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=mA);if(S&&(S=S(r,c))){Fg(d,S,a,u);break e}x&&x(r,f,c),r==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&Ed(f,"number",f.value)}switch(x=c?ao(c):window,r){case"focusin":(v_(x)||x.contentEditable==="true")&&(no=x,Vd=c,ps=null);break;case"focusout":ps=Vd=no=null;break;case"mousedown":Od=!0;break;case"contextmenu":case"mouseup":case"dragend":Od=!1,x_(d,a,u);break;case"selectionchange":if(SA)break;case"keydown":case"keyup":x_(d,a,u)}var b;if($f)e:{switch(r){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else ro?Lg(r,a)&&(C="onCompositionEnd"):r==="keydown"&&a.keyCode===229&&(C="onCompositionStart");C&&(Dg&&a.locale!=="ko"&&(ro||C!=="onCompositionStart"?C==="onCompositionEnd"&&ro&&(b=Bg()):(Wi=u,Kf="value"in Wi?Wi.value:Wi.textContent,ro=!0)),x=Ac(c,C),0<x.length&&(C=new f_(C,r,null,a,u),d.push({event:C,listeners:x}),b?C.data=b:(b=Ig(a),b!==null&&(C.data=b)))),(b=uA?dA(r,a):fA(r,a))&&(c=Ac(c,"onBeforeInput"),0<c.length&&(u=new f_("onBeforeInput","beforeinput",null,a,u),d.push({event:u,listeners:c}),u.data=b))}jg(d,i)})}function Ns(r,i,a){return{instance:r,listener:i,currentTarget:a}}function Ac(r,i){for(var a=i+"Capture",t=[];r!==null;){var e=r,n=e.stateNode;e.tag===5&&n!==null&&(e=n,n=Ps(r,a),n!=null&&t.unshift(Ns(r,n,e)),n=Ps(r,i),n!=null&&t.push(Ns(r,n,e))),r=r.return}return t}function Ja(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function b_(r,i,a,t,e){for(var n=i._reactName,o=[];a!==null&&a!==t;){var s=a,l=s.alternate,c=s.stateNode;if(l!==null&&l===t)break;s.tag===5&&c!==null&&(s=c,e?(l=Ps(a,n),l!=null&&o.unshift(Ns(a,l,s))):e||(l=Ps(a,n),l!=null&&o.push(Ns(a,l,s)))),a=a.return}o.length!==0&&r.push({event:i,listeners:o})}var wA=/\r\n?/g,TA=/\u0000|\uFFFD/g;function E_(r){return(typeof r=="string"?r:""+r).replace(wA,`
`).replace(TA,"")}function Ml(r,i,a){if(i=E_(i),E_(r)!==i&&a)throw Error(Y(425))}function xc(){}var zd=null,kd=null;function Ud(r,i){return r==="textarea"||r==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Gd=typeof setTimeout=="function"?setTimeout:void 0,RA=typeof clearTimeout=="function"?clearTimeout:void 0,w_=typeof Promise=="function"?Promise:void 0,PA=typeof queueMicrotask=="function"?queueMicrotask:typeof w_<"u"?function(r){return w_.resolve(null).then(r).catch(MA)}:Gd;function MA(r){setTimeout(function(){throw r})}function rd(r,i){var a=i,t=0;do{var e=a.nextSibling;if(r.removeChild(a),e&&e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){r.removeChild(e),Ds(i);return}t--}else a!=="$"&&a!=="$?"&&a!=="$!"||t++;a=e}while(a);Ds(i)}function Zi(r){for(;r!=null;r=r.nextSibling){var i=r.nodeType;if(i===1||i===3)break;if(i===8){if(i=r.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return r}function T_(r){r=r.previousSibling;for(var i=0;r;){if(r.nodeType===8){var a=r.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return r;i--}else a==="/$"&&i++}r=r.previousSibling}return null}var Ho=Math.random().toString(36).slice(2),Xn="__reactFiber$"+Ho,Vs="__reactProps$"+Ho,Ei="__reactContainer$"+Ho,Hd="__reactEvents$"+Ho,BA="__reactListeners$"+Ho,DA="__reactHandles$"+Ho;function Ca(r){var i=r[Xn];if(i)return i;for(var a=r.parentNode;a;){if(i=a[Ei]||a[Xn]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(r=T_(r);r!==null;){if(a=r[Xn])return a;r=T_(r)}return i}r=a,a=r.parentNode}return null}function il(r){return r=r[Xn]||r[Ei],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function ao(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Y(33))}function fu(r){return r[Vs]||null}var Wd=[],oo=-1;function da(r){return{current:r}}function nt(r){0>oo||(r.current=Wd[oo],Wd[oo]=null,oo--)}function Xe(r,i){oo++,Wd[oo]=r.current,r.current=i}var aa={},nr=da(aa),Br=da(!1),Fa=aa;function wo(r,i){var a=r.type.contextTypes;if(!a)return aa;var t=r.stateNode;if(t&&t.__reactInternalMemoizedUnmaskedChildContext===i)return t.__reactInternalMemoizedMaskedChildContext;var e={},n;for(n in a)e[n]=i[n];return t&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=e),e}function Dr(r){return r=r.childContextTypes,r!=null}function Sc(){nt(Br),nt(nr)}function R_(r,i,a){if(nr.current!==aa)throw Error(Y(168));Xe(nr,i),Xe(Br,a)}function Yg(r,i,a){var t=r.stateNode;if(i=i.childContextTypes,typeof t.getChildContext!="function")return a;t=t.getChildContext();for(var e in t)if(!(e in i))throw Error(Y(108,vy(r)||"Unknown",e));return ft({},a,t)}function Cc(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||aa,Fa=nr.current,Xe(nr,r),Xe(Br,Br.current),!0}function P_(r,i,a){var t=r.stateNode;if(!t)throw Error(Y(169));a?(r=Yg(r,i,Fa),t.__reactInternalMemoizedMergedChildContext=r,nt(Br),nt(nr),Xe(nr,r)):nt(Br),Xe(Br,a)}var di=null,hu=!1,nd=!1;function qg(r){di===null?di=[r]:di.push(r)}function LA(r){hu=!0,qg(r)}function fa(){if(!nd&&di!==null){nd=!0;var r=0,i=ke;try{var a=di;for(ke=1;r<a.length;r++){var t=a[r];do t=t(!0);while(t!==null)}di=null,hu=!1}catch(e){throw di!==null&&(di=di.slice(r+1)),Ag(jf,fa),e}finally{ke=i,nd=!1}}return null}var so=[],lo=0,bc=null,Ec=0,ln=[],cn=0,Na=null,hi=1,_i="";function Aa(r,i){so[lo++]=Ec,so[lo++]=bc,bc=r,Ec=i}function Kg(r,i,a){ln[cn++]=hi,ln[cn++]=_i,ln[cn++]=Na,Na=r;var t=hi;r=_i;var e=32-Fn(t)-1;t&=~(1<<e),a+=1;var n=32-Fn(i)+e;if(30<n){var o=e-e%5;n=(t&(1<<o)-1).toString(32),t>>=o,e-=o,hi=1<<32-Fn(i)+e|a<<e|t,_i=n+r}else hi=1<<n|a<<e|t,_i=r}function th(r){r.return!==null&&(Aa(r,1),Kg(r,1,0))}function rh(r){for(;r===bc;)bc=so[--lo],so[lo]=null,Ec=so[--lo],so[lo]=null;for(;r===Na;)Na=ln[--cn],ln[cn]=null,_i=ln[--cn],ln[cn]=null,hi=ln[--cn],ln[cn]=null}var Qr=null,Wr=null,it=!1,Pn=null;function Jg(r,i){var a=fn(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=r,i=r.deletions,i===null?(r.deletions=[a],r.flags|=16):i.push(a)}function M_(r,i){switch(r.tag){case 5:var a=r.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(r.stateNode=i,Qr=r,Wr=Zi(i.firstChild),!0):!1;case 6:return i=r.pendingProps===""||i.nodeType!==3?null:i,i!==null?(r.stateNode=i,Qr=r,Wr=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=Na!==null?{id:hi,overflow:_i}:null,r.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=fn(18,null,null,0),a.stateNode=i,a.return=r,r.child=a,Qr=r,Wr=null,!0):!1;default:return!1}}function Qd(r){return(r.mode&1)!==0&&(r.flags&128)===0}function jd(r){if(it){var i=Wr;if(i){var a=i;if(!M_(r,i)){if(Qd(r))throw Error(Y(418));i=Zi(a.nextSibling);var t=Qr;i&&M_(r,i)?Jg(t,a):(r.flags=r.flags&-4097|2,it=!1,Qr=r)}}else{if(Qd(r))throw Error(Y(418));r.flags=r.flags&-4097|2,it=!1,Qr=r}}}function B_(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Qr=r}function Bl(r){if(r!==Qr)return!1;if(!it)return B_(r),it=!0,!1;var i;if((i=r.tag!==3)&&!(i=r.tag!==5)&&(i=r.type,i=i!=="head"&&i!=="body"&&!Ud(r.type,r.memoizedProps)),i&&(i=Wr)){if(Qd(r))throw Zg(),Error(Y(418));for(;i;)Jg(r,i),i=Zi(i.nextSibling)}if(B_(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Y(317));e:{for(r=r.nextSibling,i=0;r;){if(r.nodeType===8){var a=r.data;if(a==="/$"){if(i===0){Wr=Zi(r.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}r=r.nextSibling}Wr=null}}else Wr=Qr?Zi(r.stateNode.nextSibling):null;return!0}function Zg(){for(var r=Wr;r;)r=Zi(r.nextSibling)}function To(){Wr=Qr=null,it=!1}function nh(r){Pn===null?Pn=[r]:Pn.push(r)}var IA=Mi.ReactCurrentBatchConfig;function wn(r,i){if(r&&r.defaultProps){i=ft({},i),r=r.defaultProps;for(var a in r)i[a]===void 0&&(i[a]=r[a]);return i}return i}var wc=da(null),Tc=null,co=null,ih=null;function ah(){ih=co=Tc=null}function oh(r){var i=wc.current;nt(wc),r._currentValue=i}function Xd(r,i,a){for(;r!==null;){var t=r.alternate;if((r.childLanes&i)!==i?(r.childLanes|=i,t!==null&&(t.childLanes|=i)):t!==null&&(t.childLanes&i)!==i&&(t.childLanes|=i),r===a)break;r=r.return}}function Ao(r,i){Tc=r,ih=co=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&i&&(Pr=!0),r.firstContext=null)}function vn(r){var i=r._currentValue;if(ih!==r)if(r={context:r,memoizedValue:i,next:null},co===null){if(Tc===null)throw Error(Y(308));co=r,Tc.dependencies={lanes:0,firstContext:r}}else co=co.next=r;return i}var ba=null;function sh(r){ba===null?ba=[r]:ba.push(r)}function $g(r,i,a,t){var e=i.interleaved;return e===null?(a.next=a,sh(i)):(a.next=e.next,e.next=a),i.interleaved=a,wi(r,t)}function wi(r,i){r.lanes|=i;var a=r.alternate;for(a!==null&&(a.lanes|=i),a=r,r=r.return;r!==null;)r.childLanes|=i,a=r.alternate,a!==null&&(a.childLanes|=i),a=r,r=r.return;return a.tag===3?a.stateNode:null}var ki=!1;function lh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function e0(r,i){r=r.updateQueue,i.updateQueue===r&&(i.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function gi(r,i){return{eventTime:r,lane:i,tag:0,payload:null,callback:null,next:null}}function $i(r,i,a){var t=r.updateQueue;if(t===null)return null;if(t=t.shared,Fe&2){var e=t.pending;return e===null?i.next=i:(i.next=e.next,e.next=i),t.pending=i,wi(r,a)}return e=t.interleaved,e===null?(i.next=i,sh(t)):(i.next=e.next,e.next=i),t.interleaved=i,wi(r,a)}function nc(r,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var t=i.lanes;t&=r.pendingLanes,a|=t,i.lanes=a,Xf(r,a)}}function D_(r,i){var a=r.updateQueue,t=r.alternate;if(t!==null&&(t=t.updateQueue,a===t)){var e=null,n=null;if(a=a.firstBaseUpdate,a!==null){do{var o={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};n===null?e=n=o:n=n.next=o,a=a.next}while(a!==null);n===null?e=n=i:n=n.next=i}else e=n=i;a={baseState:t.baseState,firstBaseUpdate:e,lastBaseUpdate:n,shared:t.shared,effects:t.effects},r.updateQueue=a;return}r=a.lastBaseUpdate,r===null?a.firstBaseUpdate=i:r.next=i,a.lastBaseUpdate=i}function Rc(r,i,a,t){var e=r.updateQueue;ki=!1;var n=e.firstBaseUpdate,o=e.lastBaseUpdate,s=e.shared.pending;if(s!==null){e.shared.pending=null;var l=s,c=l.next;l.next=null,o===null?n=c:o.next=c,o=l;var u=r.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==o&&(s===null?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(n!==null){var d=e.baseState;o=0,u=c=l=null,s=n;do{var f=s.lane,h=s.eventTime;if((t&f)===f){u!==null&&(u=u.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var _=r,g=s;switch(f=i,h=a,g.tag){case 1:if(_=g.payload,typeof _=="function"){d=_.call(h,d,f);break e}d=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=g.payload,f=typeof _=="function"?_.call(h,d,f):_,f==null)break e;d=ft({},d,f);break e;case 2:ki=!0}}s.callback!==null&&s.lane!==0&&(r.flags|=64,f=e.effects,f===null?e.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(c=u=h,l=d):u=u.next=h,o|=f;if(s=s.next,s===null){if(s=e.shared.pending,s===null)break;f=s,s=f.next,f.next=null,e.lastBaseUpdate=f,e.shared.pending=null}}while(!0);if(u===null&&(l=d),e.baseState=l,e.firstBaseUpdate=c,e.lastBaseUpdate=u,i=e.shared.interleaved,i!==null){e=i;do o|=e.lane,e=e.next;while(e!==i)}else n===null&&(e.shared.lanes=0);Oa|=o,r.lanes=o,r.memoizedState=d}}function L_(r,i,a){if(r=i.effects,i.effects=null,r!==null)for(i=0;i<r.length;i++){var t=r[i],e=t.callback;if(e!==null){if(t.callback=null,t=a,typeof e!="function")throw Error(Y(191,e));e.call(t)}}}var t0=new $v.Component().refs;function Yd(r,i,a,t){i=r.memoizedState,a=a(t,i),a=a==null?i:ft({},i,a),r.memoizedState=a,r.lanes===0&&(r.updateQueue.baseState=a)}var _u={isMounted:function(r){return(r=r._reactInternals)?ja(r)===r:!1},enqueueSetState:function(r,i,a){r=r._reactInternals;var t=_r(),e=ta(r),n=gi(t,e);n.payload=i,a!=null&&(n.callback=a),i=$i(r,n,e),i!==null&&(Nn(i,r,e,t),nc(i,r,e))},enqueueReplaceState:function(r,i,a){r=r._reactInternals;var t=_r(),e=ta(r),n=gi(t,e);n.tag=1,n.payload=i,a!=null&&(n.callback=a),i=$i(r,n,e),i!==null&&(Nn(i,r,e,t),nc(i,r,e))},enqueueForceUpdate:function(r,i){r=r._reactInternals;var a=_r(),t=ta(r),e=gi(a,t);e.tag=2,i!=null&&(e.callback=i),i=$i(r,e,t),i!==null&&(Nn(i,r,t,a),nc(i,r,t))}};function I_(r,i,a,t,e,n,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(t,n,o):i.prototype&&i.prototype.isPureReactComponent?!Is(a,t)||!Is(e,n):!0}function r0(r,i,a){var t=!1,e=aa,n=i.contextType;return typeof n=="object"&&n!==null?n=vn(n):(e=Dr(i)?Fa:nr.current,t=i.contextTypes,n=(t=t!=null)?wo(r,e):aa),i=new i(a,n),r.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=_u,r.stateNode=i,i._reactInternals=r,t&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=n),i}function F_(r,i,a,t){r=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,t),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,t),i.state!==r&&_u.enqueueReplaceState(i,i.state,null)}function qd(r,i,a,t){var e=r.stateNode;e.props=a,e.state=r.memoizedState,e.refs=t0,lh(r);var n=i.contextType;typeof n=="object"&&n!==null?e.context=vn(n):(n=Dr(i)?Fa:nr.current,e.context=wo(r,n)),e.state=r.memoizedState,n=i.getDerivedStateFromProps,typeof n=="function"&&(Yd(r,i,n,a),e.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof e.getSnapshotBeforeUpdate=="function"||typeof e.UNSAFE_componentWillMount!="function"&&typeof e.componentWillMount!="function"||(i=e.state,typeof e.componentWillMount=="function"&&e.componentWillMount(),typeof e.UNSAFE_componentWillMount=="function"&&e.UNSAFE_componentWillMount(),i!==e.state&&_u.enqueueReplaceState(e,e.state,null),Rc(r,a,e,t),e.state=r.memoizedState),typeof e.componentDidMount=="function"&&(r.flags|=4194308)}function Zo(r,i,a){if(r=a.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Y(309));var t=a.stateNode}if(!t)throw Error(Y(147,r));var e=t,n=""+r;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===n?i.ref:(i=function(o){var s=e.refs;s===t0&&(s=e.refs={}),o===null?delete s[n]:s[n]=o},i._stringRef=n,i)}if(typeof r!="string")throw Error(Y(284));if(!a._owner)throw Error(Y(290,r))}return r}function Dl(r,i){throw r=Object.prototype.toString.call(i),Error(Y(31,r==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":r))}function N_(r){var i=r._init;return i(r._payload)}function n0(r){function i(v,p){if(r){var m=v.deletions;m===null?(v.deletions=[p],v.flags|=16):m.push(p)}}function a(v,p){if(!r)return null;for(;p!==null;)i(v,p),p=p.sibling;return null}function t(v,p){for(v=new Map;p!==null;)p.key!==null?v.set(p.key,p):v.set(p.index,p),p=p.sibling;return v}function e(v,p){return v=ra(v,p),v.index=0,v.sibling=null,v}function n(v,p,m){return v.index=m,r?(m=v.alternate,m!==null?(m=m.index,m<p?(v.flags|=2,p):m):(v.flags|=2,p)):(v.flags|=1048576,p)}function o(v){return r&&v.alternate===null&&(v.flags|=2),v}function s(v,p,m,A){return p===null||p.tag!==6?(p=ud(m,v.mode,A),p.return=v,p):(p=e(p,m),p.return=v,p)}function l(v,p,m,A){var S=m.type;return S===to?u(v,p,m.props.children,A,m.key):p!==null&&(p.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===zi&&N_(S)===p.type)?(A=e(p,m.props),A.ref=Zo(v,p,m),A.return=v,A):(A=cc(m.type,m.key,m.props,null,v.mode,A),A.ref=Zo(v,p,m),A.return=v,A)}function c(v,p,m,A){return p===null||p.tag!==4||p.stateNode.containerInfo!==m.containerInfo||p.stateNode.implementation!==m.implementation?(p=dd(m,v.mode,A),p.return=v,p):(p=e(p,m.children||[]),p.return=v,p)}function u(v,p,m,A,S){return p===null||p.tag!==7?(p=Da(m,v.mode,A,S),p.return=v,p):(p=e(p,m),p.return=v,p)}function d(v,p,m){if(typeof p=="string"&&p!==""||typeof p=="number")return p=ud(""+p,v.mode,m),p.return=v,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case xl:return m=cc(p.type,p.key,p.props,null,v.mode,m),m.ref=Zo(v,null,p),m.return=v,m;case eo:return p=dd(p,v.mode,m),p.return=v,p;case zi:var A=p._init;return d(v,A(p._payload),m)}if(os(p)||Xo(p))return p=Da(p,v.mode,m,null),p.return=v,p;Dl(v,p)}return null}function f(v,p,m,A){var S=p!==null?p.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return S!==null?null:s(v,p,""+m,A);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case xl:return m.key===S?l(v,p,m,A):null;case eo:return m.key===S?c(v,p,m,A):null;case zi:return S=m._init,f(v,p,S(m._payload),A)}if(os(m)||Xo(m))return S!==null?null:u(v,p,m,A,null);Dl(v,m)}return null}function h(v,p,m,A,S){if(typeof A=="string"&&A!==""||typeof A=="number")return v=v.get(m)||null,s(p,v,""+A,S);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case xl:return v=v.get(A.key===null?m:A.key)||null,l(p,v,A,S);case eo:return v=v.get(A.key===null?m:A.key)||null,c(p,v,A,S);case zi:var x=A._init;return h(v,p,m,x(A._payload),S)}if(os(A)||Xo(A))return v=v.get(m)||null,u(p,v,A,S,null);Dl(p,A)}return null}function _(v,p,m,A){for(var S=null,x=null,b=p,C=p=0,w=null;b!==null&&C<m.length;C++){b.index>C?(w=b,b=null):w=b.sibling;var E=f(v,b,m[C],A);if(E===null){b===null&&(b=w);break}r&&b&&E.alternate===null&&i(v,b),p=n(E,p,C),x===null?S=E:x.sibling=E,x=E,b=w}if(C===m.length)return a(v,b),it&&Aa(v,C),S;if(b===null){for(;C<m.length;C++)b=d(v,m[C],A),b!==null&&(p=n(b,p,C),x===null?S=b:x.sibling=b,x=b);return it&&Aa(v,C),S}for(b=t(v,b);C<m.length;C++)w=h(b,v,C,m[C],A),w!==null&&(r&&w.alternate!==null&&b.delete(w.key===null?C:w.key),p=n(w,p,C),x===null?S=w:x.sibling=w,x=w);return r&&b.forEach(function(T){return i(v,T)}),it&&Aa(v,C),S}function g(v,p,m,A){var S=Xo(m);if(typeof S!="function")throw Error(Y(150));if(m=S.call(m),m==null)throw Error(Y(151));for(var x=S=null,b=p,C=p=0,w=null,E=m.next();b!==null&&!E.done;C++,E=m.next()){b.index>C?(w=b,b=null):w=b.sibling;var T=f(v,b,E.value,A);if(T===null){b===null&&(b=w);break}r&&b&&T.alternate===null&&i(v,b),p=n(T,p,C),x===null?S=T:x.sibling=T,x=T,b=w}if(E.done)return a(v,b),it&&Aa(v,C),S;if(b===null){for(;!E.done;C++,E=m.next())E=d(v,E.value,A),E!==null&&(p=n(E,p,C),x===null?S=E:x.sibling=E,x=E);return it&&Aa(v,C),S}for(b=t(v,b);!E.done;C++,E=m.next())E=h(b,v,C,E.value,A),E!==null&&(r&&E.alternate!==null&&b.delete(E.key===null?C:E.key),p=n(E,p,C),x===null?S=E:x.sibling=E,x=E);return r&&b.forEach(function(M){return i(v,M)}),it&&Aa(v,C),S}function y(v,p,m,A){if(typeof m=="object"&&m!==null&&m.type===to&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case xl:e:{for(var S=m.key,x=p;x!==null;){if(x.key===S){if(S=m.type,S===to){if(x.tag===7){a(v,x.sibling),p=e(x,m.props.children),p.return=v,v=p;break e}}else if(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===zi&&N_(S)===x.type){a(v,x.sibling),p=e(x,m.props),p.ref=Zo(v,x,m),p.return=v,v=p;break e}a(v,x);break}else i(v,x);x=x.sibling}m.type===to?(p=Da(m.props.children,v.mode,A,m.key),p.return=v,v=p):(A=cc(m.type,m.key,m.props,null,v.mode,A),A.ref=Zo(v,p,m),A.return=v,v=A)}return o(v);case eo:e:{for(x=m.key;p!==null;){if(p.key===x)if(p.tag===4&&p.stateNode.containerInfo===m.containerInfo&&p.stateNode.implementation===m.implementation){a(v,p.sibling),p=e(p,m.children||[]),p.return=v,v=p;break e}else{a(v,p);break}else i(v,p);p=p.sibling}p=dd(m,v.mode,A),p.return=v,v=p}return o(v);case zi:return x=m._init,y(v,p,x(m._payload),A)}if(os(m))return _(v,p,m,A);if(Xo(m))return g(v,p,m,A);Dl(v,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,p!==null&&p.tag===6?(a(v,p.sibling),p=e(p,m),p.return=v,v=p):(a(v,p),p=ud(m,v.mode,A),p.return=v,v=p),o(v)):a(v,p)}return y}var Ro=n0(!0),i0=n0(!1),al={},qn=da(al),Os=da(al),zs=da(al);function Ea(r){if(r===al)throw Error(Y(174));return r}function ch(r,i){switch(Xe(zs,i),Xe(Os,r),Xe(qn,al),r=i.nodeType,r){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Td(null,"");break;default:r=r===8?i.parentNode:i,i=r.namespaceURI||null,r=r.tagName,i=Td(i,r)}nt(qn),Xe(qn,i)}function Po(){nt(qn),nt(Os),nt(zs)}function a0(r){Ea(zs.current);var i=Ea(qn.current),a=Td(i,r.type);i!==a&&(Xe(Os,r),Xe(qn,a))}function uh(r){Os.current===r&&(nt(qn),nt(Os))}var ct=da(0);function Pc(r){for(var i=r;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var id=[];function dh(){for(var r=0;r<id.length;r++)id[r]._workInProgressVersionPrimary=null;id.length=0}var ic=Mi.ReactCurrentDispatcher,ad=Mi.ReactCurrentBatchConfig,Va=0,dt=null,Mt=null,Ft=null,Mc=!1,vs=!1,ks=0,FA=0;function $t(){throw Error(Y(321))}function fh(r,i){if(i===null)return!1;for(var a=0;a<i.length&&a<r.length;a++)if(!Vn(r[a],i[a]))return!1;return!0}function hh(r,i,a,t,e,n){if(Va=n,dt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,ic.current=r===null||r.memoizedState===null?zA:kA,r=a(t,e),vs){n=0;do{if(vs=!1,ks=0,25<=n)throw Error(Y(301));n+=1,Ft=Mt=null,i.updateQueue=null,ic.current=UA,r=a(t,e)}while(vs)}if(ic.current=Bc,i=Mt!==null&&Mt.next!==null,Va=0,Ft=Mt=dt=null,Mc=!1,i)throw Error(Y(300));return r}function _h(){var r=ks!==0;return ks=0,r}function Wn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?dt.memoizedState=Ft=r:Ft=Ft.next=r,Ft}function gn(){if(Mt===null){var r=dt.alternate;r=r!==null?r.memoizedState:null}else r=Mt.next;var i=Ft===null?dt.memoizedState:Ft.next;if(i!==null)Ft=i,Mt=r;else{if(r===null)throw Error(Y(310));Mt=r,r={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},Ft===null?dt.memoizedState=Ft=r:Ft=Ft.next=r}return Ft}function Us(r,i){return typeof i=="function"?i(r):i}function od(r){var i=gn(),a=i.queue;if(a===null)throw Error(Y(311));a.lastRenderedReducer=r;var t=Mt,e=t.baseQueue,n=a.pending;if(n!==null){if(e!==null){var o=e.next;e.next=n.next,n.next=o}t.baseQueue=e=n,a.pending=null}if(e!==null){n=e.next,t=t.baseState;var s=o=null,l=null,c=n;do{var u=c.lane;if((Va&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),t=c.hasEagerState?c.eagerState:r(t,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(s=l=d,o=t):l=l.next=d,dt.lanes|=u,Oa|=u}c=c.next}while(c!==null&&c!==n);l===null?o=t:l.next=s,Vn(t,i.memoizedState)||(Pr=!0),i.memoizedState=t,i.baseState=o,i.baseQueue=l,a.lastRenderedState=t}if(r=a.interleaved,r!==null){e=r;do n=e.lane,dt.lanes|=n,Oa|=n,e=e.next;while(e!==r)}else e===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function sd(r){var i=gn(),a=i.queue;if(a===null)throw Error(Y(311));a.lastRenderedReducer=r;var t=a.dispatch,e=a.pending,n=i.memoizedState;if(e!==null){a.pending=null;var o=e=e.next;do n=r(n,o.action),o=o.next;while(o!==e);Vn(n,i.memoizedState)||(Pr=!0),i.memoizedState=n,i.baseQueue===null&&(i.baseState=n),a.lastRenderedState=n}return[n,t]}function o0(){}function s0(r,i){var a=dt,t=gn(),e=i(),n=!Vn(t.memoizedState,e);if(n&&(t.memoizedState=e,Pr=!0),t=t.queue,ph(u0.bind(null,a,t,r),[r]),t.getSnapshot!==i||n||Ft!==null&&Ft.memoizedState.tag&1){if(a.flags|=2048,Gs(9,c0.bind(null,a,t,e,i),void 0,null),Vt===null)throw Error(Y(349));Va&30||l0(a,i,e)}return e}function l0(r,i,a){r.flags|=16384,r={getSnapshot:i,value:a},i=dt.updateQueue,i===null?(i={lastEffect:null,stores:null},dt.updateQueue=i,i.stores=[r]):(a=i.stores,a===null?i.stores=[r]:a.push(r))}function c0(r,i,a,t){i.value=a,i.getSnapshot=t,d0(i)&&f0(r)}function u0(r,i,a){return a(function(){d0(i)&&f0(r)})}function d0(r){var i=r.getSnapshot;r=r.value;try{var a=i();return!Vn(r,a)}catch{return!0}}function f0(r){var i=wi(r,1);i!==null&&Nn(i,r,1,-1)}function V_(r){var i=Wn();return typeof r=="function"&&(r=r()),i.memoizedState=i.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Us,lastRenderedState:r},i.queue=r,r=r.dispatch=OA.bind(null,dt,r),[i.memoizedState,r]}function Gs(r,i,a,t){return r={tag:r,create:i,destroy:a,deps:t,next:null},i=dt.updateQueue,i===null?(i={lastEffect:null,stores:null},dt.updateQueue=i,i.lastEffect=r.next=r):(a=i.lastEffect,a===null?i.lastEffect=r.next=r:(t=a.next,a.next=r,r.next=t,i.lastEffect=r)),r}function h0(){return gn().memoizedState}function ac(r,i,a,t){var e=Wn();dt.flags|=r,e.memoizedState=Gs(1|i,a,void 0,t===void 0?null:t)}function pu(r,i,a,t){var e=gn();t=t===void 0?null:t;var n=void 0;if(Mt!==null){var o=Mt.memoizedState;if(n=o.destroy,t!==null&&fh(t,o.deps)){e.memoizedState=Gs(i,a,n,t);return}}dt.flags|=r,e.memoizedState=Gs(1|i,a,n,t)}function O_(r,i){return ac(8390656,8,r,i)}function ph(r,i){return pu(2048,8,r,i)}function _0(r,i){return pu(4,2,r,i)}function p0(r,i){return pu(4,4,r,i)}function v0(r,i){if(typeof i=="function")return r=r(),i(r),function(){i(null)};if(i!=null)return r=r(),i.current=r,function(){i.current=null}}function g0(r,i,a){return a=a!=null?a.concat([r]):null,pu(4,4,v0.bind(null,i,r),a)}function vh(){}function m0(r,i){var a=gn();i=i===void 0?null:i;var t=a.memoizedState;return t!==null&&i!==null&&fh(i,t[1])?t[0]:(a.memoizedState=[r,i],r)}function y0(r,i){var a=gn();i=i===void 0?null:i;var t=a.memoizedState;return t!==null&&i!==null&&fh(i,t[1])?t[0]:(r=r(),a.memoizedState=[r,i],r)}function A0(r,i,a){return Va&21?(Vn(a,i)||(a=Cg(),dt.lanes|=a,Oa|=a,r.baseState=!0),i):(r.baseState&&(r.baseState=!1,Pr=!0),r.memoizedState=a)}function NA(r,i){var a=ke;ke=a!==0&&4>a?a:4,r(!0);var t=ad.transition;ad.transition={};try{r(!1),i()}finally{ke=a,ad.transition=t}}function x0(){return gn().memoizedState}function VA(r,i,a){var t=ta(r);if(a={lane:t,action:a,hasEagerState:!1,eagerState:null,next:null},S0(r))C0(i,a);else if(a=$g(r,i,a,t),a!==null){var e=_r();Nn(a,r,t,e),b0(a,i,t)}}function OA(r,i,a){var t=ta(r),e={lane:t,action:a,hasEagerState:!1,eagerState:null,next:null};if(S0(r))C0(i,e);else{var n=r.alternate;if(r.lanes===0&&(n===null||n.lanes===0)&&(n=i.lastRenderedReducer,n!==null))try{var o=i.lastRenderedState,s=n(o,a);if(e.hasEagerState=!0,e.eagerState=s,Vn(s,o)){var l=i.interleaved;l===null?(e.next=e,sh(i)):(e.next=l.next,l.next=e),i.interleaved=e;return}}catch{}finally{}a=$g(r,i,e,t),a!==null&&(e=_r(),Nn(a,r,t,e),b0(a,i,t))}}function S0(r){var i=r.alternate;return r===dt||i!==null&&i===dt}function C0(r,i){vs=Mc=!0;var a=r.pending;a===null?i.next=i:(i.next=a.next,a.next=i),r.pending=i}function b0(r,i,a){if(a&4194240){var t=i.lanes;t&=r.pendingLanes,a|=t,i.lanes=a,Xf(r,a)}}var Bc={readContext:vn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},zA={readContext:vn,useCallback:function(r,i){return Wn().memoizedState=[r,i===void 0?null:i],r},useContext:vn,useEffect:O_,useImperativeHandle:function(r,i,a){return a=a!=null?a.concat([r]):null,ac(4194308,4,v0.bind(null,i,r),a)},useLayoutEffect:function(r,i){return ac(4194308,4,r,i)},useInsertionEffect:function(r,i){return ac(4,2,r,i)},useMemo:function(r,i){var a=Wn();return i=i===void 0?null:i,r=r(),a.memoizedState=[r,i],r},useReducer:function(r,i,a){var t=Wn();return i=a!==void 0?a(i):i,t.memoizedState=t.baseState=i,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:i},t.queue=r,r=r.dispatch=VA.bind(null,dt,r),[t.memoizedState,r]},useRef:function(r){var i=Wn();return r={current:r},i.memoizedState=r},useState:V_,useDebugValue:vh,useDeferredValue:function(r){return Wn().memoizedState=r},useTransition:function(){var r=V_(!1),i=r[0];return r=NA.bind(null,r[1]),Wn().memoizedState=r,[i,r]},useMutableSource:function(){},useSyncExternalStore:function(r,i,a){var t=dt,e=Wn();if(it){if(a===void 0)throw Error(Y(407));a=a()}else{if(a=i(),Vt===null)throw Error(Y(349));Va&30||l0(t,i,a)}e.memoizedState=a;var n={value:a,getSnapshot:i};return e.queue=n,O_(u0.bind(null,t,n,r),[r]),t.flags|=2048,Gs(9,c0.bind(null,t,n,a,i),void 0,null),a},useId:function(){var r=Wn(),i=Vt.identifierPrefix;if(it){var a=_i,t=hi;a=(t&~(1<<32-Fn(t)-1)).toString(32)+a,i=":"+i+"R"+a,a=ks++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=FA++,i=":"+i+"r"+a.toString(32)+":";return r.memoizedState=i},unstable_isNewReconciler:!1},kA={readContext:vn,useCallback:m0,useContext:vn,useEffect:ph,useImperativeHandle:g0,useInsertionEffect:_0,useLayoutEffect:p0,useMemo:y0,useReducer:od,useRef:h0,useState:function(){return od(Us)},useDebugValue:vh,useDeferredValue:function(r){var i=gn();return A0(i,Mt.memoizedState,r)},useTransition:function(){var r=od(Us)[0],i=gn().memoizedState;return[r,i]},useMutableSource:o0,useSyncExternalStore:s0,useId:x0,unstable_isNewReconciler:!1},UA={readContext:vn,useCallback:m0,useContext:vn,useEffect:ph,useImperativeHandle:g0,useInsertionEffect:_0,useLayoutEffect:p0,useMemo:y0,useReducer:sd,useRef:h0,useState:function(){return sd(Us)},useDebugValue:vh,useDeferredValue:function(r){var i=gn();return Mt===null?i.memoizedState=r:A0(i,Mt.memoizedState,r)},useTransition:function(){var r=sd(Us)[0],i=gn().memoizedState;return[r,i]},useMutableSource:o0,useSyncExternalStore:s0,useId:x0,unstable_isNewReconciler:!1};function Mo(r,i){try{var a="",t=i;do a+=py(t),t=t.return;while(t);var e=a}catch(n){e=`
Error generating stack: `+n.message+`
`+n.stack}return{value:r,source:i,stack:e,digest:null}}function ld(r,i,a){return{value:r,source:null,stack:a??null,digest:i??null}}function Kd(r,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var GA=typeof WeakMap=="function"?WeakMap:Map;function E0(r,i,a){a=gi(-1,a),a.tag=3,a.payload={element:null};var t=i.value;return a.callback=function(){Lc||(Lc=!0,sf=t),Kd(r,i)},a}function w0(r,i,a){a=gi(-1,a),a.tag=3;var t=r.type.getDerivedStateFromError;if(typeof t=="function"){var e=i.value;a.payload=function(){return t(e)},a.callback=function(){Kd(r,i)}}var n=r.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(a.callback=function(){Kd(r,i),typeof t!="function"&&(ea===null?ea=new Set([this]):ea.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})}),a}function z_(r,i,a){var t=r.pingCache;if(t===null){t=r.pingCache=new GA;var e=new Set;t.set(i,e)}else e=t.get(i),e===void 0&&(e=new Set,t.set(i,e));e.has(a)||(e.add(a),r=r1.bind(null,r,i,a),i.then(r,r))}function k_(r){do{var i;if((i=r.tag===13)&&(i=r.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return r;r=r.return}while(r!==null);return null}function U_(r,i,a,t,e){return r.mode&1?(r.flags|=65536,r.lanes=e,r):(r===i?r.flags|=65536:(r.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=gi(-1,1),i.tag=2,$i(a,i,1))),a.lanes|=1),r)}var HA=Mi.ReactCurrentOwner,Pr=!1;function ur(r,i,a,t){i.child=r===null?i0(i,null,a,t):Ro(i,r.child,a,t)}function G_(r,i,a,t,e){a=a.render;var n=i.ref;return Ao(i,e),t=hh(r,i,a,t,n,e),a=_h(),r!==null&&!Pr?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~e,Ti(r,i,e)):(it&&a&&th(i),i.flags|=1,ur(r,i,t,e),i.child)}function H_(r,i,a,t,e){if(r===null){var n=a.type;return typeof n=="function"&&!bh(n)&&n.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=n,T0(r,i,n,t,e)):(r=cc(a.type,null,t,i,i.mode,e),r.ref=i.ref,r.return=i,i.child=r)}if(n=r.child,!(r.lanes&e)){var o=n.memoizedProps;if(a=a.compare,a=a!==null?a:Is,a(o,t)&&r.ref===i.ref)return Ti(r,i,e)}return i.flags|=1,r=ra(n,t),r.ref=i.ref,r.return=i,i.child=r}function T0(r,i,a,t,e){if(r!==null){var n=r.memoizedProps;if(Is(n,t)&&r.ref===i.ref)if(Pr=!1,i.pendingProps=t=n,(r.lanes&e)!==0)r.flags&131072&&(Pr=!0);else return i.lanes=r.lanes,Ti(r,i,e)}return Jd(r,i,a,t,e)}function R0(r,i,a){var t=i.pendingProps,e=t.children,n=r!==null?r.memoizedState:null;if(t.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Xe(fo,Gr),Gr|=a;else{if(!(a&1073741824))return r=n!==null?n.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:r,cachePool:null,transitions:null},i.updateQueue=null,Xe(fo,Gr),Gr|=r,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},t=n!==null?n.baseLanes:a,Xe(fo,Gr),Gr|=t}else n!==null?(t=n.baseLanes|a,i.memoizedState=null):t=a,Xe(fo,Gr),Gr|=t;return ur(r,i,e,a),i.child}function P0(r,i){var a=i.ref;(r===null&&a!==null||r!==null&&r.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function Jd(r,i,a,t,e){var n=Dr(a)?Fa:nr.current;return n=wo(i,n),Ao(i,e),a=hh(r,i,a,t,n,e),t=_h(),r!==null&&!Pr?(i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~e,Ti(r,i,e)):(it&&t&&th(i),i.flags|=1,ur(r,i,a,e),i.child)}function W_(r,i,a,t,e){if(Dr(a)){var n=!0;Cc(i)}else n=!1;if(Ao(i,e),i.stateNode===null)oc(r,i),r0(i,a,t),qd(i,a,t,e),t=!0;else if(r===null){var o=i.stateNode,s=i.memoizedProps;o.props=s;var l=o.context,c=a.contextType;typeof c=="object"&&c!==null?c=vn(c):(c=Dr(a)?Fa:nr.current,c=wo(i,c));var u=a.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==t||l!==c)&&F_(i,o,t,c),ki=!1;var f=i.memoizedState;o.state=f,Rc(i,t,o,e),l=i.memoizedState,s!==t||f!==l||Br.current||ki?(typeof u=="function"&&(Yd(i,a,u,t),l=i.memoizedState),(s=ki||I_(i,a,s,t,f,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(i.flags|=4194308)):(typeof o.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=t,i.memoizedState=l),o.props=t,o.state=l,o.context=c,t=s):(typeof o.componentDidMount=="function"&&(i.flags|=4194308),t=!1)}else{o=i.stateNode,e0(r,i),s=i.memoizedProps,c=i.type===i.elementType?s:wn(i.type,s),o.props=c,d=i.pendingProps,f=o.context,l=a.contextType,typeof l=="object"&&l!==null?l=vn(l):(l=Dr(a)?Fa:nr.current,l=wo(i,l));var h=a.getDerivedStateFromProps;(u=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==l)&&F_(i,o,t,l),ki=!1,f=i.memoizedState,o.state=f,Rc(i,t,o,e);var _=i.memoizedState;s!==d||f!==_||Br.current||ki?(typeof h=="function"&&(Yd(i,a,h,t),_=i.memoizedState),(c=ki||I_(i,a,c,t,f,_,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(t,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(t,_,l)),typeof o.componentDidUpdate=="function"&&(i.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===r.memoizedProps&&f===r.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===r.memoizedProps&&f===r.memoizedState||(i.flags|=1024),i.memoizedProps=t,i.memoizedState=_),o.props=t,o.state=_,o.context=l,t=c):(typeof o.componentDidUpdate!="function"||s===r.memoizedProps&&f===r.memoizedState||(i.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===r.memoizedProps&&f===r.memoizedState||(i.flags|=1024),t=!1)}return Zd(r,i,a,t,n,e)}function Zd(r,i,a,t,e,n){P0(r,i);var o=(i.flags&128)!==0;if(!t&&!o)return e&&P_(i,a,!1),Ti(r,i,n);t=i.stateNode,HA.current=i;var s=o&&typeof a.getDerivedStateFromError!="function"?null:t.render();return i.flags|=1,r!==null&&o?(i.child=Ro(i,r.child,null,n),i.child=Ro(i,null,s,n)):ur(r,i,s,n),i.memoizedState=t.state,e&&P_(i,a,!0),i.child}function M0(r){var i=r.stateNode;i.pendingContext?R_(r,i.pendingContext,i.pendingContext!==i.context):i.context&&R_(r,i.context,!1),ch(r,i.containerInfo)}function Q_(r,i,a,t,e){return To(),nh(e),i.flags|=256,ur(r,i,a,t),i.child}var $d={dehydrated:null,treeContext:null,retryLane:0};function ef(r){return{baseLanes:r,cachePool:null,transitions:null}}function B0(r,i,a){var t=i.pendingProps,e=ct.current,n=!1,o=(i.flags&128)!==0,s;if((s=o)||(s=r!==null&&r.memoizedState===null?!1:(e&2)!==0),s?(n=!0,i.flags&=-129):(r===null||r.memoizedState!==null)&&(e|=1),Xe(ct,e&1),r===null)return jd(i),r=i.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(i.mode&1?r.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(o=t.children,r=t.fallback,n?(t=i.mode,n=i.child,o={mode:"hidden",children:o},!(t&1)&&n!==null?(n.childLanes=0,n.pendingProps=o):n=mu(o,t,0,null),r=Da(r,t,a,null),n.return=i,r.return=i,n.sibling=r,i.child=n,i.child.memoizedState=ef(a),i.memoizedState=$d,r):gh(i,o));if(e=r.memoizedState,e!==null&&(s=e.dehydrated,s!==null))return WA(r,i,o,t,s,e,a);if(n){n=t.fallback,o=i.mode,e=r.child,s=e.sibling;var l={mode:"hidden",children:t.children};return!(o&1)&&i.child!==e?(t=i.child,t.childLanes=0,t.pendingProps=l,i.deletions=null):(t=ra(e,l),t.subtreeFlags=e.subtreeFlags&14680064),s!==null?n=ra(s,n):(n=Da(n,o,a,null),n.flags|=2),n.return=i,t.return=i,t.sibling=n,i.child=t,t=n,n=i.child,o=r.child.memoizedState,o=o===null?ef(a):{baseLanes:o.baseLanes|a,cachePool:null,transitions:o.transitions},n.memoizedState=o,n.childLanes=r.childLanes&~a,i.memoizedState=$d,t}return n=r.child,r=n.sibling,t=ra(n,{mode:"visible",children:t.children}),!(i.mode&1)&&(t.lanes=a),t.return=i,t.sibling=null,r!==null&&(a=i.deletions,a===null?(i.deletions=[r],i.flags|=16):a.push(r)),i.child=t,i.memoizedState=null,t}function gh(r,i){return i=mu({mode:"visible",children:i},r.mode,0,null),i.return=r,r.child=i}function Ll(r,i,a,t){return t!==null&&nh(t),Ro(i,r.child,null,a),r=gh(i,i.pendingProps.children),r.flags|=2,i.memoizedState=null,r}function WA(r,i,a,t,e,n,o){if(a)return i.flags&256?(i.flags&=-257,t=ld(Error(Y(422))),Ll(r,i,o,t)):i.memoizedState!==null?(i.child=r.child,i.flags|=128,null):(n=t.fallback,e=i.mode,t=mu({mode:"visible",children:t.children},e,0,null),n=Da(n,e,o,null),n.flags|=2,t.return=i,n.return=i,t.sibling=n,i.child=t,i.mode&1&&Ro(i,r.child,null,o),i.child.memoizedState=ef(o),i.memoizedState=$d,n);if(!(i.mode&1))return Ll(r,i,o,null);if(e.data==="$!"){if(t=e.nextSibling&&e.nextSibling.dataset,t)var s=t.dgst;return t=s,n=Error(Y(419)),t=ld(n,t,void 0),Ll(r,i,o,t)}if(s=(o&r.childLanes)!==0,Pr||s){if(t=Vt,t!==null){switch(o&-o){case 4:e=2;break;case 16:e=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:e=32;break;case 536870912:e=268435456;break;default:e=0}e=e&(t.suspendedLanes|o)?0:e,e!==0&&e!==n.retryLane&&(n.retryLane=e,wi(r,e),Nn(t,r,e,-1))}return Ch(),t=ld(Error(Y(421))),Ll(r,i,o,t)}return e.data==="$?"?(i.flags|=128,i.child=r.child,i=n1.bind(null,r),e._reactRetry=i,null):(r=n.treeContext,Wr=Zi(e.nextSibling),Qr=i,it=!0,Pn=null,r!==null&&(ln[cn++]=hi,ln[cn++]=_i,ln[cn++]=Na,hi=r.id,_i=r.overflow,Na=i),i=gh(i,t.children),i.flags|=4096,i)}function j_(r,i,a){r.lanes|=i;var t=r.alternate;t!==null&&(t.lanes|=i),Xd(r.return,i,a)}function cd(r,i,a,t,e){var n=r.memoizedState;n===null?r.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:t,tail:a,tailMode:e}:(n.isBackwards=i,n.rendering=null,n.renderingStartTime=0,n.last=t,n.tail=a,n.tailMode=e)}function D0(r,i,a){var t=i.pendingProps,e=t.revealOrder,n=t.tail;if(ur(r,i,t.children,a),t=ct.current,t&2)t=t&1|2,i.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=i.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&j_(r,a,i);else if(r.tag===19)j_(r,a,i);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break e;for(;r.sibling===null;){if(r.return===null||r.return===i)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t&=1}if(Xe(ct,t),!(i.mode&1))i.memoizedState=null;else switch(e){case"forwards":for(a=i.child,e=null;a!==null;)r=a.alternate,r!==null&&Pc(r)===null&&(e=a),a=a.sibling;a=e,a===null?(e=i.child,i.child=null):(e=a.sibling,a.sibling=null),cd(i,!1,e,a,n);break;case"backwards":for(a=null,e=i.child,i.child=null;e!==null;){if(r=e.alternate,r!==null&&Pc(r)===null){i.child=e;break}r=e.sibling,e.sibling=a,a=e,e=r}cd(i,!0,a,null,n);break;case"together":cd(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function oc(r,i){!(i.mode&1)&&r!==null&&(r.alternate=null,i.alternate=null,i.flags|=2)}function Ti(r,i,a){if(r!==null&&(i.dependencies=r.dependencies),Oa|=i.lanes,!(a&i.childLanes))return null;if(r!==null&&i.child!==r.child)throw Error(Y(153));if(i.child!==null){for(r=i.child,a=ra(r,r.pendingProps),i.child=a,a.return=i;r.sibling!==null;)r=r.sibling,a=a.sibling=ra(r,r.pendingProps),a.return=i;a.sibling=null}return i.child}function QA(r,i,a){switch(i.tag){case 3:M0(i),To();break;case 5:a0(i);break;case 1:Dr(i.type)&&Cc(i);break;case 4:ch(i,i.stateNode.containerInfo);break;case 10:var t=i.type._context,e=i.memoizedProps.value;Xe(wc,t._currentValue),t._currentValue=e;break;case 13:if(t=i.memoizedState,t!==null)return t.dehydrated!==null?(Xe(ct,ct.current&1),i.flags|=128,null):a&i.child.childLanes?B0(r,i,a):(Xe(ct,ct.current&1),r=Ti(r,i,a),r!==null?r.sibling:null);Xe(ct,ct.current&1);break;case 19:if(t=(a&i.childLanes)!==0,r.flags&128){if(t)return D0(r,i,a);i.flags|=128}if(e=i.memoizedState,e!==null&&(e.rendering=null,e.tail=null,e.lastEffect=null),Xe(ct,ct.current),t)break;return null;case 22:case 23:return i.lanes=0,R0(r,i,a)}return Ti(r,i,a)}var L0,tf,I0,F0;L0=function(r,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};tf=function(){};I0=function(r,i,a,t){var e=r.memoizedProps;if(e!==t){r=i.stateNode,Ea(qn.current);var n=null;switch(a){case"input":e=Cd(r,e),t=Cd(r,t),n=[];break;case"select":e=ft({},e,{value:void 0}),t=ft({},t,{value:void 0}),n=[];break;case"textarea":e=wd(r,e),t=wd(r,t),n=[];break;default:typeof e.onClick!="function"&&typeof t.onClick=="function"&&(r.onclick=xc)}Rd(a,t);var o;a=null;for(c in e)if(!t.hasOwnProperty(c)&&e.hasOwnProperty(c)&&e[c]!=null)if(c==="style"){var s=e[c];for(o in s)s.hasOwnProperty(o)&&(a||(a={}),a[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ts.hasOwnProperty(c)?n||(n=[]):(n=n||[]).push(c,null));for(c in t){var l=t[c];if(s=e!=null?e[c]:void 0,t.hasOwnProperty(c)&&l!==s&&(l!=null||s!=null))if(c==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(a||(a={}),a[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(a||(a={}),a[o]=l[o])}else a||(n||(n=[]),n.push(c,a)),a=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(n=n||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ts.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ke("scroll",r),n||s===l||(n=[])):(n=n||[]).push(c,l))}a&&(n=n||[]).push("style",a);var c=n;(i.updateQueue=c)&&(i.flags|=4)}};F0=function(r,i,a,t){a!==t&&(i.flags|=4)};function $o(r,i){if(!it)switch(r.tailMode){case"hidden":i=r.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?r.tail=null:a.sibling=null;break;case"collapsed":a=r.tail;for(var t=null;a!==null;)a.alternate!==null&&(t=a),a=a.sibling;t===null?i||r.tail===null?r.tail=null:r.tail.sibling=null:t.sibling=null}}function er(r){var i=r.alternate!==null&&r.alternate.child===r.child,a=0,t=0;if(i)for(var e=r.child;e!==null;)a|=e.lanes|e.childLanes,t|=e.subtreeFlags&14680064,t|=e.flags&14680064,e.return=r,e=e.sibling;else for(e=r.child;e!==null;)a|=e.lanes|e.childLanes,t|=e.subtreeFlags,t|=e.flags,e.return=r,e=e.sibling;return r.subtreeFlags|=t,r.childLanes=a,i}function jA(r,i,a){var t=i.pendingProps;switch(rh(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return er(i),null;case 1:return Dr(i.type)&&Sc(),er(i),null;case 3:return t=i.stateNode,Po(),nt(Br),nt(nr),dh(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(r===null||r.child===null)&&(Bl(i)?i.flags|=4:r===null||r.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Pn!==null&&(uf(Pn),Pn=null))),tf(r,i),er(i),null;case 5:uh(i);var e=Ea(zs.current);if(a=i.type,r!==null&&i.stateNode!=null)I0(r,i,a,t,e),r.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!t){if(i.stateNode===null)throw Error(Y(166));return er(i),null}if(r=Ea(qn.current),Bl(i)){t=i.stateNode,a=i.type;var n=i.memoizedProps;switch(t[Xn]=i,t[Vs]=n,r=(i.mode&1)!==0,a){case"dialog":Ke("cancel",t),Ke("close",t);break;case"iframe":case"object":case"embed":Ke("load",t);break;case"video":case"audio":for(e=0;e<ls.length;e++)Ke(ls[e],t);break;case"source":Ke("error",t);break;case"img":case"image":case"link":Ke("error",t),Ke("load",t);break;case"details":Ke("toggle",t);break;case"input":t_(t,n),Ke("invalid",t);break;case"select":t._wrapperState={wasMultiple:!!n.multiple},Ke("invalid",t);break;case"textarea":n_(t,n),Ke("invalid",t)}Rd(a,n),e=null;for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];o==="children"?typeof s=="string"?t.textContent!==s&&(n.suppressHydrationWarning!==!0&&Ml(t.textContent,s,r),e=["children",s]):typeof s=="number"&&t.textContent!==""+s&&(n.suppressHydrationWarning!==!0&&Ml(t.textContent,s,r),e=["children",""+s]):Ts.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Ke("scroll",t)}switch(a){case"input":Sl(t),r_(t,n,!0);break;case"textarea":Sl(t),i_(t);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(t.onclick=xc)}t=e,i.updateQueue=t,t!==null&&(i.flags|=4)}else{o=e.nodeType===9?e:e.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=lg(a)),r==="http://www.w3.org/1999/xhtml"?a==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof t.is=="string"?r=o.createElement(a,{is:t.is}):(r=o.createElement(a),a==="select"&&(o=r,t.multiple?o.multiple=!0:t.size&&(o.size=t.size))):r=o.createElementNS(r,a),r[Xn]=i,r[Vs]=t,L0(r,i,!1,!1),i.stateNode=r;e:{switch(o=Pd(a,t),a){case"dialog":Ke("cancel",r),Ke("close",r),e=t;break;case"iframe":case"object":case"embed":Ke("load",r),e=t;break;case"video":case"audio":for(e=0;e<ls.length;e++)Ke(ls[e],r);e=t;break;case"source":Ke("error",r),e=t;break;case"img":case"image":case"link":Ke("error",r),Ke("load",r),e=t;break;case"details":Ke("toggle",r),e=t;break;case"input":t_(r,t),e=Cd(r,t),Ke("invalid",r);break;case"option":e=t;break;case"select":r._wrapperState={wasMultiple:!!t.multiple},e=ft({},t,{value:void 0}),Ke("invalid",r);break;case"textarea":n_(r,t),e=wd(r,t),Ke("invalid",r);break;default:e=t}Rd(a,e),s=e;for(n in s)if(s.hasOwnProperty(n)){var l=s[n];n==="style"?dg(r,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&cg(r,l)):n==="children"?typeof l=="string"?(a!=="textarea"||l!=="")&&Rs(r,l):typeof l=="number"&&Rs(r,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(Ts.hasOwnProperty(n)?l!=null&&n==="onScroll"&&Ke("scroll",r):l!=null&&Uf(r,n,l,o))}switch(a){case"input":Sl(r),r_(r,t,!1);break;case"textarea":Sl(r),i_(r);break;case"option":t.value!=null&&r.setAttribute("value",""+ia(t.value));break;case"select":r.multiple=!!t.multiple,n=t.value,n!=null?vo(r,!!t.multiple,n,!1):t.defaultValue!=null&&vo(r,!!t.multiple,t.defaultValue,!0);break;default:typeof e.onClick=="function"&&(r.onclick=xc)}switch(a){case"button":case"input":case"select":case"textarea":t=!!t.autoFocus;break e;case"img":t=!0;break e;default:t=!1}}t&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return er(i),null;case 6:if(r&&i.stateNode!=null)F0(r,i,r.memoizedProps,t);else{if(typeof t!="string"&&i.stateNode===null)throw Error(Y(166));if(a=Ea(zs.current),Ea(qn.current),Bl(i)){if(t=i.stateNode,a=i.memoizedProps,t[Xn]=i,(n=t.nodeValue!==a)&&(r=Qr,r!==null))switch(r.tag){case 3:Ml(t.nodeValue,a,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Ml(t.nodeValue,a,(r.mode&1)!==0)}n&&(i.flags|=4)}else t=(a.nodeType===9?a:a.ownerDocument).createTextNode(t),t[Xn]=i,i.stateNode=t}return er(i),null;case 13:if(nt(ct),t=i.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(it&&Wr!==null&&i.mode&1&&!(i.flags&128))Zg(),To(),i.flags|=98560,n=!1;else if(n=Bl(i),t!==null&&t.dehydrated!==null){if(r===null){if(!n)throw Error(Y(318));if(n=i.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Y(317));n[Xn]=i}else To(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;er(i),n=!1}else Pn!==null&&(uf(Pn),Pn=null),n=!0;if(!n)return i.flags&65536?i:null}return i.flags&128?(i.lanes=a,i):(t=t!==null,t!==(r!==null&&r.memoizedState!==null)&&t&&(i.child.flags|=8192,i.mode&1&&(r===null||ct.current&1?Lt===0&&(Lt=3):Ch())),i.updateQueue!==null&&(i.flags|=4),er(i),null);case 4:return Po(),tf(r,i),r===null&&Fs(i.stateNode.containerInfo),er(i),null;case 10:return oh(i.type._context),er(i),null;case 17:return Dr(i.type)&&Sc(),er(i),null;case 19:if(nt(ct),n=i.memoizedState,n===null)return er(i),null;if(t=(i.flags&128)!==0,o=n.rendering,o===null)if(t)$o(n,!1);else{if(Lt!==0||r!==null&&r.flags&128)for(r=i.child;r!==null;){if(o=Pc(r),o!==null){for(i.flags|=128,$o(n,!1),t=o.updateQueue,t!==null&&(i.updateQueue=t,i.flags|=4),i.subtreeFlags=0,t=a,a=i.child;a!==null;)n=a,r=t,n.flags&=14680066,o=n.alternate,o===null?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,r=o.dependencies,n.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a=a.sibling;return Xe(ct,ct.current&1|2),i.child}r=r.sibling}n.tail!==null&&St()>Bo&&(i.flags|=128,t=!0,$o(n,!1),i.lanes=4194304)}else{if(!t)if(r=Pc(o),r!==null){if(i.flags|=128,t=!0,a=r.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),$o(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!it)return er(i),null}else 2*St()-n.renderingStartTime>Bo&&a!==1073741824&&(i.flags|=128,t=!0,$o(n,!1),i.lanes=4194304);n.isBackwards?(o.sibling=i.child,i.child=o):(a=n.last,a!==null?a.sibling=o:i.child=o,n.last=o)}return n.tail!==null?(i=n.tail,n.rendering=i,n.tail=i.sibling,n.renderingStartTime=St(),i.sibling=null,a=ct.current,Xe(ct,t?a&1|2:a&1),i):(er(i),null);case 22:case 23:return Sh(),t=i.memoizedState!==null,r!==null&&r.memoizedState!==null!==t&&(i.flags|=8192),t&&i.mode&1?Gr&1073741824&&(er(i),i.subtreeFlags&6&&(i.flags|=8192)):er(i),null;case 24:return null;case 25:return null}throw Error(Y(156,i.tag))}function XA(r,i){switch(rh(i),i.tag){case 1:return Dr(i.type)&&Sc(),r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 3:return Po(),nt(Br),nt(nr),dh(),r=i.flags,r&65536&&!(r&128)?(i.flags=r&-65537|128,i):null;case 5:return uh(i),null;case 13:if(nt(ct),r=i.memoizedState,r!==null&&r.dehydrated!==null){if(i.alternate===null)throw Error(Y(340));To()}return r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 19:return nt(ct),null;case 4:return Po(),null;case 10:return oh(i.type._context),null;case 22:case 23:return Sh(),null;case 24:return null;default:return null}}var Il=!1,tr=!1,YA=typeof WeakSet=="function"?WeakSet:Set,re=null;function uo(r,i){var a=r.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(t){vt(r,i,t)}else a.current=null}function rf(r,i,a){try{a()}catch(t){vt(r,i,t)}}var X_=!1;function qA(r,i){if(zd=mc,r=zg(),eh(r)){if("selectionStart"in r)var a={start:r.selectionStart,end:r.selectionEnd};else e:{a=(a=r.ownerDocument)&&a.defaultView||window;var t=a.getSelection&&a.getSelection();if(t&&t.rangeCount!==0){a=t.anchorNode;var e=t.anchorOffset,n=t.focusNode;t=t.focusOffset;try{a.nodeType,n.nodeType}catch{a=null;break e}var o=0,s=-1,l=-1,c=0,u=0,d=r,f=null;t:for(;;){for(var h;d!==a||e!==0&&d.nodeType!==3||(s=o+e),d!==n||t!==0&&d.nodeType!==3||(l=o+t),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===r)break t;if(f===a&&++c===e&&(s=o),f===n&&++u===t&&(l=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}a=s===-1||l===-1?null:{start:s,end:l}}else a=null}a=a||{start:0,end:0}}else a=null;for(kd={focusedElem:r,selectionRange:a},mc=!1,re=i;re!==null;)if(i=re,r=i.child,(i.subtreeFlags&1028)!==0&&r!==null)r.return=i,re=r;else for(;re!==null;){i=re;try{var _=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var g=_.memoizedProps,y=_.memoizedState,v=i.stateNode,p=v.getSnapshotBeforeUpdate(i.elementType===i.type?g:wn(i.type,g),y);v.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var m=i.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(A){vt(i,i.return,A)}if(r=i.sibling,r!==null){r.return=i.return,re=r;break}re=i.return}return _=X_,X_=!1,_}function gs(r,i,a){var t=i.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&r)===r){var n=e.destroy;e.destroy=void 0,n!==void 0&&rf(i,a,n)}e=e.next}while(e!==t)}}function vu(r,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&r)===r){var t=a.create;a.destroy=t()}a=a.next}while(a!==i)}}function nf(r){var i=r.ref;if(i!==null){var a=r.stateNode;switch(r.tag){case 5:r=a;break;default:r=a}typeof i=="function"?i(r):i.current=r}}function N0(r){var i=r.alternate;i!==null&&(r.alternate=null,N0(i)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(i=r.stateNode,i!==null&&(delete i[Xn],delete i[Vs],delete i[Hd],delete i[BA],delete i[DA])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function V0(r){return r.tag===5||r.tag===3||r.tag===4}function Y_(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||V0(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function af(r,i,a){var t=r.tag;if(t===5||t===6)r=r.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(r,i):a.insertBefore(r,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(r,a)):(i=a,i.appendChild(r)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=xc));else if(t!==4&&(r=r.child,r!==null))for(af(r,i,a),r=r.sibling;r!==null;)af(r,i,a),r=r.sibling}function of(r,i,a){var t=r.tag;if(t===5||t===6)r=r.stateNode,i?a.insertBefore(r,i):a.appendChild(r);else if(t!==4&&(r=r.child,r!==null))for(of(r,i,a),r=r.sibling;r!==null;)of(r,i,a),r=r.sibling}var Ot=null,Tn=!1;function Ii(r,i,a){for(a=a.child;a!==null;)O0(r,i,a),a=a.sibling}function O0(r,i,a){if(Yn&&typeof Yn.onCommitFiberUnmount=="function")try{Yn.onCommitFiberUnmount(lu,a)}catch{}switch(a.tag){case 5:tr||uo(a,i);case 6:var t=Ot,e=Tn;Ot=null,Ii(r,i,a),Ot=t,Tn=e,Ot!==null&&(Tn?(r=Ot,a=a.stateNode,r.nodeType===8?r.parentNode.removeChild(a):r.removeChild(a)):Ot.removeChild(a.stateNode));break;case 18:Ot!==null&&(Tn?(r=Ot,a=a.stateNode,r.nodeType===8?rd(r.parentNode,a):r.nodeType===1&&rd(r,a),Ds(r)):rd(Ot,a.stateNode));break;case 4:t=Ot,e=Tn,Ot=a.stateNode.containerInfo,Tn=!0,Ii(r,i,a),Ot=t,Tn=e;break;case 0:case 11:case 14:case 15:if(!tr&&(t=a.updateQueue,t!==null&&(t=t.lastEffect,t!==null))){e=t=t.next;do{var n=e,o=n.destroy;n=n.tag,o!==void 0&&(n&2||n&4)&&rf(a,i,o),e=e.next}while(e!==t)}Ii(r,i,a);break;case 1:if(!tr&&(uo(a,i),t=a.stateNode,typeof t.componentWillUnmount=="function"))try{t.props=a.memoizedProps,t.state=a.memoizedState,t.componentWillUnmount()}catch(s){vt(a,i,s)}Ii(r,i,a);break;case 21:Ii(r,i,a);break;case 22:a.mode&1?(tr=(t=tr)||a.memoizedState!==null,Ii(r,i,a),tr=t):Ii(r,i,a);break;default:Ii(r,i,a)}}function q_(r){var i=r.updateQueue;if(i!==null){r.updateQueue=null;var a=r.stateNode;a===null&&(a=r.stateNode=new YA),i.forEach(function(t){var e=i1.bind(null,r,t);a.has(t)||(a.add(t),t.then(e,e))})}}function Sn(r,i){var a=i.deletions;if(a!==null)for(var t=0;t<a.length;t++){var e=a[t];try{var n=r,o=i,s=o;e:for(;s!==null;){switch(s.tag){case 5:Ot=s.stateNode,Tn=!1;break e;case 3:Ot=s.stateNode.containerInfo,Tn=!0;break e;case 4:Ot=s.stateNode.containerInfo,Tn=!0;break e}s=s.return}if(Ot===null)throw Error(Y(160));O0(n,o,e),Ot=null,Tn=!1;var l=e.alternate;l!==null&&(l.return=null),e.return=null}catch(c){vt(e,i,c)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)z0(i,r),i=i.sibling}function z0(r,i){var a=r.alternate,t=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Sn(i,r),Hn(r),t&4){try{gs(3,r,r.return),vu(3,r)}catch(g){vt(r,r.return,g)}try{gs(5,r,r.return)}catch(g){vt(r,r.return,g)}}break;case 1:Sn(i,r),Hn(r),t&512&&a!==null&&uo(a,a.return);break;case 5:if(Sn(i,r),Hn(r),t&512&&a!==null&&uo(a,a.return),r.flags&32){var e=r.stateNode;try{Rs(e,"")}catch(g){vt(r,r.return,g)}}if(t&4&&(e=r.stateNode,e!=null)){var n=r.memoizedProps,o=a!==null?a.memoizedProps:n,s=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{s==="input"&&n.type==="radio"&&n.name!=null&&og(e,n),Pd(s,o);var c=Pd(s,n);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?dg(e,d):u==="dangerouslySetInnerHTML"?cg(e,d):u==="children"?Rs(e,d):Uf(e,u,d,c)}switch(s){case"input":bd(e,n);break;case"textarea":sg(e,n);break;case"select":var f=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=!!n.multiple;var h=n.value;h!=null?vo(e,!!n.multiple,h,!1):f!==!!n.multiple&&(n.defaultValue!=null?vo(e,!!n.multiple,n.defaultValue,!0):vo(e,!!n.multiple,n.multiple?[]:"",!1))}e[Vs]=n}catch(g){vt(r,r.return,g)}}break;case 6:if(Sn(i,r),Hn(r),t&4){if(r.stateNode===null)throw Error(Y(162));e=r.stateNode,n=r.memoizedProps;try{e.nodeValue=n}catch(g){vt(r,r.return,g)}}break;case 3:if(Sn(i,r),Hn(r),t&4&&a!==null&&a.memoizedState.isDehydrated)try{Ds(i.containerInfo)}catch(g){vt(r,r.return,g)}break;case 4:Sn(i,r),Hn(r);break;case 13:Sn(i,r),Hn(r),e=r.child,e.flags&8192&&(n=e.memoizedState!==null,e.stateNode.isHidden=n,!n||e.alternate!==null&&e.alternate.memoizedState!==null||(Ah=St())),t&4&&q_(r);break;case 22:if(u=a!==null&&a.memoizedState!==null,r.mode&1?(tr=(c=tr)||u,Sn(i,r),tr=c):Sn(i,r),Hn(r),t&8192){if(c=r.memoizedState!==null,(r.stateNode.isHidden=c)&&!u&&r.mode&1)for(re=r,u=r.child;u!==null;){for(d=re=u;re!==null;){switch(f=re,h=f.child,f.tag){case 0:case 11:case 14:case 15:gs(4,f,f.return);break;case 1:uo(f,f.return);var _=f.stateNode;if(typeof _.componentWillUnmount=="function"){t=f,a=f.return;try{i=t,_.props=i.memoizedProps,_.state=i.memoizedState,_.componentWillUnmount()}catch(g){vt(t,a,g)}}break;case 5:uo(f,f.return);break;case 22:if(f.memoizedState!==null){J_(d);continue}}h!==null?(h.return=f,re=h):J_(d)}u=u.sibling}e:for(u=null,d=r;;){if(d.tag===5){if(u===null){u=d;try{e=d.stateNode,c?(n=e.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(s=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=ug("display",o))}catch(g){vt(r,r.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){vt(r,r.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Sn(i,r),Hn(r),t&4&&q_(r);break;case 21:break;default:Sn(i,r),Hn(r)}}function Hn(r){var i=r.flags;if(i&2){try{e:{for(var a=r.return;a!==null;){if(V0(a)){var t=a;break e}a=a.return}throw Error(Y(160))}switch(t.tag){case 5:var e=t.stateNode;t.flags&32&&(Rs(e,""),t.flags&=-33);var n=Y_(r);of(r,n,e);break;case 3:case 4:var o=t.stateNode.containerInfo,s=Y_(r);af(r,s,o);break;default:throw Error(Y(161))}}catch(l){vt(r,r.return,l)}r.flags&=-3}i&4096&&(r.flags&=-4097)}function KA(r,i,a){re=r,k0(r)}function k0(r,i,a){for(var t=(r.mode&1)!==0;re!==null;){var e=re,n=e.child;if(e.tag===22&&t){var o=e.memoizedState!==null||Il;if(!o){var s=e.alternate,l=s!==null&&s.memoizedState!==null||tr;s=Il;var c=tr;if(Il=o,(tr=l)&&!c)for(re=e;re!==null;)o=re,l=o.child,o.tag===22&&o.memoizedState!==null?Z_(e):l!==null?(l.return=o,re=l):Z_(e);for(;n!==null;)re=n,k0(n),n=n.sibling;re=e,Il=s,tr=c}K_(r)}else e.subtreeFlags&8772&&n!==null?(n.return=e,re=n):K_(r)}}function K_(r){for(;re!==null;){var i=re;if(i.flags&8772){var a=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:tr||vu(5,i);break;case 1:var t=i.stateNode;if(i.flags&4&&!tr)if(a===null)t.componentDidMount();else{var e=i.elementType===i.type?a.memoizedProps:wn(i.type,a.memoizedProps);t.componentDidUpdate(e,a.memoizedState,t.__reactInternalSnapshotBeforeUpdate)}var n=i.updateQueue;n!==null&&L_(i,n,t);break;case 3:var o=i.updateQueue;if(o!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}L_(i,o,a)}break;case 5:var s=i.stateNode;if(a===null&&i.flags&4){a=s;var l=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&a.focus();break;case"img":l.src&&(a.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var c=i.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Ds(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}tr||i.flags&512&&nf(i)}catch(f){vt(i,i.return,f)}}if(i===r){re=null;break}if(a=i.sibling,a!==null){a.return=i.return,re=a;break}re=i.return}}function J_(r){for(;re!==null;){var i=re;if(i===r){re=null;break}var a=i.sibling;if(a!==null){a.return=i.return,re=a;break}re=i.return}}function Z_(r){for(;re!==null;){var i=re;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{vu(4,i)}catch(l){vt(i,a,l)}break;case 1:var t=i.stateNode;if(typeof t.componentDidMount=="function"){var e=i.return;try{t.componentDidMount()}catch(l){vt(i,e,l)}}var n=i.return;try{nf(i)}catch(l){vt(i,n,l)}break;case 5:var o=i.return;try{nf(i)}catch(l){vt(i,o,l)}}}catch(l){vt(i,i.return,l)}if(i===r){re=null;break}var s=i.sibling;if(s!==null){s.return=i.return,re=s;break}re=i.return}}var JA=Math.ceil,Dc=Mi.ReactCurrentDispatcher,mh=Mi.ReactCurrentOwner,pn=Mi.ReactCurrentBatchConfig,Fe=0,Vt=null,Rt=null,jt=0,Gr=0,fo=da(0),Lt=0,Hs=null,Oa=0,gu=0,yh=0,ms=null,Tr=null,Ah=0,Bo=1/0,ci=null,Lc=!1,sf=null,ea=null,Fl=!1,Qi=null,Ic=0,ys=0,lf=null,sc=-1,lc=0;function _r(){return Fe&6?St():sc!==-1?sc:sc=St()}function ta(r){return r.mode&1?Fe&2&&jt!==0?jt&-jt:IA.transition!==null?(lc===0&&(lc=Cg()),lc):(r=ke,r!==0||(r=window.event,r=r===void 0?16:Mg(r.type)),r):1}function Nn(r,i,a,t){if(50<ys)throw ys=0,lf=null,Error(Y(185));rl(r,a,t),(!(Fe&2)||r!==Vt)&&(r===Vt&&(!(Fe&2)&&(gu|=a),Lt===4&&Hi(r,jt)),Lr(r,t),a===1&&Fe===0&&!(i.mode&1)&&(Bo=St()+500,hu&&fa()))}function Lr(r,i){var a=r.callbackNode;Iy(r,i);var t=gc(r,r===Vt?jt:0);if(t===0)a!==null&&s_(a),r.callbackNode=null,r.callbackPriority=0;else if(i=t&-t,r.callbackPriority!==i){if(a!=null&&s_(a),i===1)r.tag===0?LA($_.bind(null,r)):qg($_.bind(null,r)),PA(function(){!(Fe&6)&&fa()}),a=null;else{switch(bg(t)){case 1:a=jf;break;case 4:a=xg;break;case 16:a=vc;break;case 536870912:a=Sg;break;default:a=vc}a=Y0(a,U0.bind(null,r))}r.callbackPriority=i,r.callbackNode=a}}function U0(r,i){if(sc=-1,lc=0,Fe&6)throw Error(Y(327));var a=r.callbackNode;if(xo()&&r.callbackNode!==a)return null;var t=gc(r,r===Vt?jt:0);if(t===0)return null;if(t&30||t&r.expiredLanes||i)i=Fc(r,t);else{i=t;var e=Fe;Fe|=2;var n=H0();(Vt!==r||jt!==i)&&(ci=null,Bo=St()+500,Ba(r,i));do try{e1();break}catch(s){G0(r,s)}while(!0);ah(),Dc.current=n,Fe=e,Rt!==null?i=0:(Vt=null,jt=0,i=Lt)}if(i!==0){if(i===2&&(e=Id(r),e!==0&&(t=e,i=cf(r,e))),i===1)throw a=Hs,Ba(r,0),Hi(r,t),Lr(r,St()),a;if(i===6)Hi(r,t);else{if(e=r.current.alternate,!(t&30)&&!ZA(e)&&(i=Fc(r,t),i===2&&(n=Id(r),n!==0&&(t=n,i=cf(r,n))),i===1))throw a=Hs,Ba(r,0),Hi(r,t),Lr(r,St()),a;switch(r.finishedWork=e,r.finishedLanes=t,i){case 0:case 1:throw Error(Y(345));case 2:xa(r,Tr,ci);break;case 3:if(Hi(r,t),(t&130023424)===t&&(i=Ah+500-St(),10<i)){if(gc(r,0)!==0)break;if(e=r.suspendedLanes,(e&t)!==t){_r(),r.pingedLanes|=r.suspendedLanes&e;break}r.timeoutHandle=Gd(xa.bind(null,r,Tr,ci),i);break}xa(r,Tr,ci);break;case 4:if(Hi(r,t),(t&4194240)===t)break;for(i=r.eventTimes,e=-1;0<t;){var o=31-Fn(t);n=1<<o,o=i[o],o>e&&(e=o),t&=~n}if(t=e,t=St()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*JA(t/1960))-t,10<t){r.timeoutHandle=Gd(xa.bind(null,r,Tr,ci),t);break}xa(r,Tr,ci);break;case 5:xa(r,Tr,ci);break;default:throw Error(Y(329))}}}return Lr(r,St()),r.callbackNode===a?U0.bind(null,r):null}function cf(r,i){var a=ms;return r.current.memoizedState.isDehydrated&&(Ba(r,i).flags|=256),r=Fc(r,i),r!==2&&(i=Tr,Tr=a,i!==null&&uf(i)),r}function uf(r){Tr===null?Tr=r:Tr.push.apply(Tr,r)}function ZA(r){for(var i=r;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var t=0;t<a.length;t++){var e=a[t],n=e.getSnapshot;e=e.value;try{if(!Vn(n(),e))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Hi(r,i){for(i&=~yh,i&=~gu,r.suspendedLanes|=i,r.pingedLanes&=~i,r=r.expirationTimes;0<i;){var a=31-Fn(i),t=1<<a;r[a]=-1,i&=~t}}function $_(r){if(Fe&6)throw Error(Y(327));xo();var i=gc(r,0);if(!(i&1))return Lr(r,St()),null;var a=Fc(r,i);if(r.tag!==0&&a===2){var t=Id(r);t!==0&&(i=t,a=cf(r,t))}if(a===1)throw a=Hs,Ba(r,0),Hi(r,i),Lr(r,St()),a;if(a===6)throw Error(Y(345));return r.finishedWork=r.current.alternate,r.finishedLanes=i,xa(r,Tr,ci),Lr(r,St()),null}function xh(r,i){var a=Fe;Fe|=1;try{return r(i)}finally{Fe=a,Fe===0&&(Bo=St()+500,hu&&fa())}}function za(r){Qi!==null&&Qi.tag===0&&!(Fe&6)&&xo();var i=Fe;Fe|=1;var a=pn.transition,t=ke;try{if(pn.transition=null,ke=1,r)return r()}finally{ke=t,pn.transition=a,Fe=i,!(Fe&6)&&fa()}}function Sh(){Gr=fo.current,nt(fo)}function Ba(r,i){r.finishedWork=null,r.finishedLanes=0;var a=r.timeoutHandle;if(a!==-1&&(r.timeoutHandle=-1,RA(a)),Rt!==null)for(a=Rt.return;a!==null;){var t=a;switch(rh(t),t.tag){case 1:t=t.type.childContextTypes,t!=null&&Sc();break;case 3:Po(),nt(Br),nt(nr),dh();break;case 5:uh(t);break;case 4:Po();break;case 13:nt(ct);break;case 19:nt(ct);break;case 10:oh(t.type._context);break;case 22:case 23:Sh()}a=a.return}if(Vt=r,Rt=r=ra(r.current,null),jt=Gr=i,Lt=0,Hs=null,yh=gu=Oa=0,Tr=ms=null,ba!==null){for(i=0;i<ba.length;i++)if(a=ba[i],t=a.interleaved,t!==null){a.interleaved=null;var e=t.next,n=a.pending;if(n!==null){var o=n.next;n.next=e,t.next=o}a.pending=t}ba=null}return r}function G0(r,i){do{var a=Rt;try{if(ah(),ic.current=Bc,Mc){for(var t=dt.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}Mc=!1}if(Va=0,Ft=Mt=dt=null,vs=!1,ks=0,mh.current=null,a===null||a.return===null){Lt=1,Hs=i,Rt=null;break}e:{var n=r,o=a.return,s=a,l=i;if(i=jt,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=s,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var h=k_(o);if(h!==null){h.flags&=-257,U_(h,o,s,n,i),h.mode&1&&z_(n,c,i),i=h,l=c;var _=i.updateQueue;if(_===null){var g=new Set;g.add(l),i.updateQueue=g}else _.add(l);break e}else{if(!(i&1)){z_(n,c,i),Ch();break e}l=Error(Y(426))}}else if(it&&s.mode&1){var y=k_(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),U_(y,o,s,n,i),nh(Mo(l,s));break e}}n=l=Mo(l,s),Lt!==4&&(Lt=2),ms===null?ms=[n]:ms.push(n),n=o;do{switch(n.tag){case 3:n.flags|=65536,i&=-i,n.lanes|=i;var v=E0(n,l,i);D_(n,v);break e;case 1:s=l;var p=n.type,m=n.stateNode;if(!(n.flags&128)&&(typeof p.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(ea===null||!ea.has(m)))){n.flags|=65536,i&=-i,n.lanes|=i;var A=w0(n,s,i);D_(n,A);break e}}n=n.return}while(n!==null)}Q0(a)}catch(S){i=S,Rt===a&&a!==null&&(Rt=a=a.return);continue}break}while(!0)}function H0(){var r=Dc.current;return Dc.current=Bc,r===null?Bc:r}function Ch(){(Lt===0||Lt===3||Lt===2)&&(Lt=4),Vt===null||!(Oa&268435455)&&!(gu&268435455)||Hi(Vt,jt)}function Fc(r,i){var a=Fe;Fe|=2;var t=H0();(Vt!==r||jt!==i)&&(ci=null,Ba(r,i));do try{$A();break}catch(e){G0(r,e)}while(!0);if(ah(),Fe=a,Dc.current=t,Rt!==null)throw Error(Y(261));return Vt=null,jt=0,Lt}function $A(){for(;Rt!==null;)W0(Rt)}function e1(){for(;Rt!==null&&!Ey();)W0(Rt)}function W0(r){var i=X0(r.alternate,r,Gr);r.memoizedProps=r.pendingProps,i===null?Q0(r):Rt=i,mh.current=null}function Q0(r){var i=r;do{var a=i.alternate;if(r=i.return,i.flags&32768){if(a=XA(a,i),a!==null){a.flags&=32767,Rt=a;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Lt=6,Rt=null;return}}else if(a=jA(a,i,Gr),a!==null){Rt=a;return}if(i=i.sibling,i!==null){Rt=i;return}Rt=i=r}while(i!==null);Lt===0&&(Lt=5)}function xa(r,i,a){var t=ke,e=pn.transition;try{pn.transition=null,ke=1,t1(r,i,a,t)}finally{pn.transition=e,ke=t}return null}function t1(r,i,a,t){do xo();while(Qi!==null);if(Fe&6)throw Error(Y(327));a=r.finishedWork;var e=r.finishedLanes;if(a===null)return null;if(r.finishedWork=null,r.finishedLanes=0,a===r.current)throw Error(Y(177));r.callbackNode=null,r.callbackPriority=0;var n=a.lanes|a.childLanes;if(Fy(r,n),r===Vt&&(Rt=Vt=null,jt=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Fl||(Fl=!0,Y0(vc,function(){return xo(),null})),n=(a.flags&15990)!==0,a.subtreeFlags&15990||n){n=pn.transition,pn.transition=null;var o=ke;ke=1;var s=Fe;Fe|=4,mh.current=null,qA(r,a),z0(a,r),xA(kd),mc=!!zd,kd=zd=null,r.current=a,KA(a),wy(),Fe=s,ke=o,pn.transition=n}else r.current=a;if(Fl&&(Fl=!1,Qi=r,Ic=e),n=r.pendingLanes,n===0&&(ea=null),Py(a.stateNode),Lr(r,St()),i!==null)for(t=r.onRecoverableError,a=0;a<i.length;a++)e=i[a],t(e.value,{componentStack:e.stack,digest:e.digest});if(Lc)throw Lc=!1,r=sf,sf=null,r;return Ic&1&&r.tag!==0&&xo(),n=r.pendingLanes,n&1?r===lf?ys++:(ys=0,lf=r):ys=0,fa(),null}function xo(){if(Qi!==null){var r=bg(Ic),i=pn.transition,a=ke;try{if(pn.transition=null,ke=16>r?16:r,Qi===null)var t=!1;else{if(r=Qi,Qi=null,Ic=0,Fe&6)throw Error(Y(331));var e=Fe;for(Fe|=4,re=r.current;re!==null;){var n=re,o=n.child;if(re.flags&16){var s=n.deletions;if(s!==null){for(var l=0;l<s.length;l++){var c=s[l];for(re=c;re!==null;){var u=re;switch(u.tag){case 0:case 11:case 15:gs(8,u,n)}var d=u.child;if(d!==null)d.return=u,re=d;else for(;re!==null;){u=re;var f=u.sibling,h=u.return;if(N0(u),u===c){re=null;break}if(f!==null){f.return=h,re=f;break}re=h}}}var _=n.alternate;if(_!==null){var g=_.child;if(g!==null){_.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}re=n}}if(n.subtreeFlags&2064&&o!==null)o.return=n,re=o;else e:for(;re!==null;){if(n=re,n.flags&2048)switch(n.tag){case 0:case 11:case 15:gs(9,n,n.return)}var v=n.sibling;if(v!==null){v.return=n.return,re=v;break e}re=n.return}}var p=r.current;for(re=p;re!==null;){o=re;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,re=m;else e:for(o=p;re!==null;){if(s=re,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:vu(9,s)}}catch(S){vt(s,s.return,S)}if(s===o){re=null;break e}var A=s.sibling;if(A!==null){A.return=s.return,re=A;break e}re=s.return}}if(Fe=e,fa(),Yn&&typeof Yn.onPostCommitFiberRoot=="function")try{Yn.onPostCommitFiberRoot(lu,r)}catch{}t=!0}return t}finally{ke=a,pn.transition=i}}return!1}function ep(r,i,a){i=Mo(a,i),i=E0(r,i,1),r=$i(r,i,1),i=_r(),r!==null&&(rl(r,1,i),Lr(r,i))}function vt(r,i,a){if(r.tag===3)ep(r,r,a);else for(;i!==null;){if(i.tag===3){ep(i,r,a);break}else if(i.tag===1){var t=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof t.componentDidCatch=="function"&&(ea===null||!ea.has(t))){r=Mo(a,r),r=w0(i,r,1),i=$i(i,r,1),r=_r(),i!==null&&(rl(i,1,r),Lr(i,r));break}}i=i.return}}function r1(r,i,a){var t=r.pingCache;t!==null&&t.delete(i),i=_r(),r.pingedLanes|=r.suspendedLanes&a,Vt===r&&(jt&a)===a&&(Lt===4||Lt===3&&(jt&130023424)===jt&&500>St()-Ah?Ba(r,0):yh|=a),Lr(r,i)}function j0(r,i){i===0&&(r.mode&1?(i=El,El<<=1,!(El&130023424)&&(El=4194304)):i=1);var a=_r();r=wi(r,i),r!==null&&(rl(r,i,a),Lr(r,a))}function n1(r){var i=r.memoizedState,a=0;i!==null&&(a=i.retryLane),j0(r,a)}function i1(r,i){var a=0;switch(r.tag){case 13:var t=r.stateNode,e=r.memoizedState;e!==null&&(a=e.retryLane);break;case 19:t=r.stateNode;break;default:throw Error(Y(314))}t!==null&&t.delete(i),j0(r,a)}var X0;X0=function(r,i,a){if(r!==null)if(r.memoizedProps!==i.pendingProps||Br.current)Pr=!0;else{if(!(r.lanes&a)&&!(i.flags&128))return Pr=!1,QA(r,i,a);Pr=!!(r.flags&131072)}else Pr=!1,it&&i.flags&1048576&&Kg(i,Ec,i.index);switch(i.lanes=0,i.tag){case 2:var t=i.type;oc(r,i),r=i.pendingProps;var e=wo(i,nr.current);Ao(i,a),e=hh(null,i,t,r,e,a);var n=_h();return i.flags|=1,typeof e=="object"&&e!==null&&typeof e.render=="function"&&e.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Dr(t)?(n=!0,Cc(i)):n=!1,i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,lh(i),e.updater=_u,i.stateNode=e,e._reactInternals=i,qd(i,t,r,a),i=Zd(null,i,t,!0,n,a)):(i.tag=0,it&&n&&th(i),ur(null,i,e,a),i=i.child),i;case 16:t=i.elementType;e:{switch(oc(r,i),r=i.pendingProps,e=t._init,t=e(t._payload),i.type=t,e=i.tag=o1(t),r=wn(t,r),e){case 0:i=Jd(null,i,t,r,a);break e;case 1:i=W_(null,i,t,r,a);break e;case 11:i=G_(null,i,t,r,a);break e;case 14:i=H_(null,i,t,wn(t.type,r),a);break e}throw Error(Y(306,t,""))}return i;case 0:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:wn(t,e),Jd(r,i,t,e,a);case 1:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:wn(t,e),W_(r,i,t,e,a);case 3:e:{if(M0(i),r===null)throw Error(Y(387));t=i.pendingProps,n=i.memoizedState,e=n.element,e0(r,i),Rc(i,t,null,a);var o=i.memoizedState;if(t=o.element,n.isDehydrated)if(n={element:t,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},i.updateQueue.baseState=n,i.memoizedState=n,i.flags&256){e=Mo(Error(Y(423)),i),i=Q_(r,i,t,a,e);break e}else if(t!==e){e=Mo(Error(Y(424)),i),i=Q_(r,i,t,a,e);break e}else for(Wr=Zi(i.stateNode.containerInfo.firstChild),Qr=i,it=!0,Pn=null,a=i0(i,null,t,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(To(),t===e){i=Ti(r,i,a);break e}ur(r,i,t,a)}i=i.child}return i;case 5:return a0(i),r===null&&jd(i),t=i.type,e=i.pendingProps,n=r!==null?r.memoizedProps:null,o=e.children,Ud(t,e)?o=null:n!==null&&Ud(t,n)&&(i.flags|=32),P0(r,i),ur(r,i,o,a),i.child;case 6:return r===null&&jd(i),null;case 13:return B0(r,i,a);case 4:return ch(i,i.stateNode.containerInfo),t=i.pendingProps,r===null?i.child=Ro(i,null,t,a):ur(r,i,t,a),i.child;case 11:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:wn(t,e),G_(r,i,t,e,a);case 7:return ur(r,i,i.pendingProps,a),i.child;case 8:return ur(r,i,i.pendingProps.children,a),i.child;case 12:return ur(r,i,i.pendingProps.children,a),i.child;case 10:e:{if(t=i.type._context,e=i.pendingProps,n=i.memoizedProps,o=e.value,Xe(wc,t._currentValue),t._currentValue=o,n!==null)if(Vn(n.value,o)){if(n.children===e.children&&!Br.current){i=Ti(r,i,a);break e}}else for(n=i.child,n!==null&&(n.return=i);n!==null;){var s=n.dependencies;if(s!==null){o=n.child;for(var l=s.firstContext;l!==null;){if(l.context===t){if(n.tag===1){l=gi(-1,a&-a),l.tag=2;var c=n.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}n.lanes|=a,l=n.alternate,l!==null&&(l.lanes|=a),Xd(n.return,a,i),s.lanes|=a;break}l=l.next}}else if(n.tag===10)o=n.type===i.type?null:n.child;else if(n.tag===18){if(o=n.return,o===null)throw Error(Y(341));o.lanes|=a,s=o.alternate,s!==null&&(s.lanes|=a),Xd(o,a,i),o=n.sibling}else o=n.child;if(o!==null)o.return=n;else for(o=n;o!==null;){if(o===i){o=null;break}if(n=o.sibling,n!==null){n.return=o.return,o=n;break}o=o.return}n=o}ur(r,i,e.children,a),i=i.child}return i;case 9:return e=i.type,t=i.pendingProps.children,Ao(i,a),e=vn(e),t=t(e),i.flags|=1,ur(r,i,t,a),i.child;case 14:return t=i.type,e=wn(t,i.pendingProps),e=wn(t.type,e),H_(r,i,t,e,a);case 15:return T0(r,i,i.type,i.pendingProps,a);case 17:return t=i.type,e=i.pendingProps,e=i.elementType===t?e:wn(t,e),oc(r,i),i.tag=1,Dr(t)?(r=!0,Cc(i)):r=!1,Ao(i,a),r0(i,t,e),qd(i,t,e,a),Zd(null,i,t,!0,r,a);case 19:return D0(r,i,a);case 22:return R0(r,i,a)}throw Error(Y(156,i.tag))};function Y0(r,i){return Ag(r,i)}function a1(r,i,a,t){this.tag=r,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=t,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(r,i,a,t){return new a1(r,i,a,t)}function bh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function o1(r){if(typeof r=="function")return bh(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Hf)return 11;if(r===Wf)return 14}return 2}function ra(r,i){var a=r.alternate;return a===null?(a=fn(r.tag,i,r.key,r.mode),a.elementType=r.elementType,a.type=r.type,a.stateNode=r.stateNode,a.alternate=r,r.alternate=a):(a.pendingProps=i,a.type=r.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=r.flags&14680064,a.childLanes=r.childLanes,a.lanes=r.lanes,a.child=r.child,a.memoizedProps=r.memoizedProps,a.memoizedState=r.memoizedState,a.updateQueue=r.updateQueue,i=r.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=r.sibling,a.index=r.index,a.ref=r.ref,a}function cc(r,i,a,t,e,n){var o=2;if(t=r,typeof r=="function")bh(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case to:return Da(a.children,e,n,i);case Gf:o=8,e|=8;break;case yd:return r=fn(12,a,i,e|2),r.elementType=yd,r.lanes=n,r;case Ad:return r=fn(13,a,i,e),r.elementType=Ad,r.lanes=n,r;case xd:return r=fn(19,a,i,e),r.elementType=xd,r.lanes=n,r;case ng:return mu(a,e,n,i);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case tg:o=10;break e;case rg:o=9;break e;case Hf:o=11;break e;case Wf:o=14;break e;case zi:o=16,t=null;break e}throw Error(Y(130,r==null?r:typeof r,""))}return i=fn(o,a,i,e),i.elementType=r,i.type=t,i.lanes=n,i}function Da(r,i,a,t){return r=fn(7,r,t,i),r.lanes=a,r}function mu(r,i,a,t){return r=fn(22,r,t,i),r.elementType=ng,r.lanes=a,r.stateNode={isHidden:!1},r}function ud(r,i,a){return r=fn(6,r,null,i),r.lanes=a,r}function dd(r,i,a){return i=fn(4,r.children!==null?r.children:[],r.key,i),i.lanes=a,i.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},i}function s1(r,i,a,t,e){this.tag=i,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qu(0),this.expirationTimes=Qu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qu(0),this.identifierPrefix=t,this.onRecoverableError=e,this.mutableSourceEagerHydrationData=null}function Eh(r,i,a,t,e,n,o,s,l){return r=new s1(r,i,a,s,l),i===1?(i=1,n===!0&&(i|=8)):i=0,n=fn(3,null,null,i),r.current=n,n.stateNode=r,n.memoizedState={element:t,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},lh(n),r}function l1(r,i,a){var t=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:eo,key:t==null?null:""+t,children:r,containerInfo:i,implementation:a}}function q0(r){if(!r)return aa;r=r._reactInternals;e:{if(ja(r)!==r||r.tag!==1)throw Error(Y(170));var i=r;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Dr(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(Y(171))}if(r.tag===1){var a=r.type;if(Dr(a))return Yg(r,a,i)}return i}function K0(r,i,a,t,e,n,o,s,l){return r=Eh(a,t,!0,r,e,n,o,s,l),r.context=q0(null),a=r.current,t=_r(),e=ta(a),n=gi(t,e),n.callback=i??null,$i(a,n,e),r.current.lanes=e,rl(r,e,t),Lr(r,t),r}function yu(r,i,a,t){var e=i.current,n=_r(),o=ta(e);return a=q0(a),i.context===null?i.context=a:i.pendingContext=a,i=gi(n,o),i.payload={element:r},t=t===void 0?null:t,t!==null&&(i.callback=t),r=$i(e,i,o),r!==null&&(Nn(r,e,o,n),nc(r,e,o)),o}function Nc(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function tp(r,i){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var a=r.retryLane;r.retryLane=a!==0&&a<i?a:i}}function wh(r,i){tp(r,i),(r=r.alternate)&&tp(r,i)}function c1(){return null}var J0=typeof reportError=="function"?reportError:function(r){console.error(r)};function Th(r){this._internalRoot=r}Au.prototype.render=Th.prototype.render=function(r){var i=this._internalRoot;if(i===null)throw Error(Y(409));yu(r,i,null,null)};Au.prototype.unmount=Th.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var i=r.containerInfo;za(function(){yu(null,r,null,null)}),i[Ei]=null}};function Au(r){this._internalRoot=r}Au.prototype.unstable_scheduleHydration=function(r){if(r){var i=Tg();r={blockedOn:null,target:r,priority:i};for(var a=0;a<Gi.length&&i!==0&&i<Gi[a].priority;a++);Gi.splice(a,0,r),a===0&&Pg(r)}};function Rh(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function xu(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function rp(){}function u1(r,i,a,t,e){if(e){if(typeof t=="function"){var n=t;t=function(){var c=Nc(o);n.call(c)}}var o=K0(i,t,r,0,null,!1,!1,"",rp);return r._reactRootContainer=o,r[Ei]=o.current,Fs(r.nodeType===8?r.parentNode:r),za(),o}for(;e=r.lastChild;)r.removeChild(e);if(typeof t=="function"){var s=t;t=function(){var c=Nc(l);s.call(c)}}var l=Eh(r,0,!1,null,null,!1,!1,"",rp);return r._reactRootContainer=l,r[Ei]=l.current,Fs(r.nodeType===8?r.parentNode:r),za(function(){yu(i,l,a,t)}),l}function Su(r,i,a,t,e){var n=a._reactRootContainer;if(n){var o=n;if(typeof e=="function"){var s=e;e=function(){var l=Nc(o);s.call(l)}}yu(i,o,r,e)}else o=u1(a,i,r,e,t);return Nc(o)}Eg=function(r){switch(r.tag){case 3:var i=r.stateNode;if(i.current.memoizedState.isDehydrated){var a=ss(i.pendingLanes);a!==0&&(Xf(i,a|1),Lr(i,St()),!(Fe&6)&&(Bo=St()+500,fa()))}break;case 13:za(function(){var t=wi(r,1);if(t!==null){var e=_r();Nn(t,r,1,e)}}),wh(r,1)}};Yf=function(r){if(r.tag===13){var i=wi(r,134217728);if(i!==null){var a=_r();Nn(i,r,134217728,a)}wh(r,134217728)}};wg=function(r){if(r.tag===13){var i=ta(r),a=wi(r,i);if(a!==null){var t=_r();Nn(a,r,i,t)}wh(r,i)}};Tg=function(){return ke};Rg=function(r,i){var a=ke;try{return ke=r,i()}finally{ke=a}};Bd=function(r,i,a){switch(i){case"input":if(bd(r,a),i=a.name,a.type==="radio"&&i!=null){for(a=r;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var t=a[i];if(t!==r&&t.form===r.form){var e=fu(t);if(!e)throw Error(Y(90));ag(t),bd(t,e)}}}break;case"textarea":sg(r,a);break;case"select":i=a.value,i!=null&&vo(r,!!a.multiple,i,!1)}};_g=xh;pg=za;var d1={usingClientEntryPoint:!1,Events:[il,ao,fu,fg,hg,xh]},es={findFiberByHostInstance:Ca,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},f1={bundleType:es.bundleType,version:es.version,rendererPackageName:es.rendererPackageName,rendererConfig:es.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mi.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=mg(r),r===null?null:r.stateNode},findFiberByHostInstance:es.findFiberByHostInstance||c1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nl.isDisabled&&Nl.supportsFiber)try{lu=Nl.inject(f1),Yn=Nl}catch{}}Jr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d1;Jr.createPortal=function(r,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rh(i))throw Error(Y(200));return l1(r,i,null,a)};Jr.createRoot=function(r,i){if(!Rh(r))throw Error(Y(299));var a=!1,t="",e=J0;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(t=i.identifierPrefix),i.onRecoverableError!==void 0&&(e=i.onRecoverableError)),i=Eh(r,1,!1,null,null,a,!1,t,e),r[Ei]=i.current,Fs(r.nodeType===8?r.parentNode:r),new Th(i)};Jr.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var i=r._reactInternals;if(i===void 0)throw typeof r.render=="function"?Error(Y(188)):(r=Object.keys(r).join(","),Error(Y(268,r)));return r=mg(i),r=r===null?null:r.stateNode,r};Jr.flushSync=function(r){return za(r)};Jr.hydrate=function(r,i,a){if(!xu(i))throw Error(Y(200));return Su(null,r,i,!0,a)};Jr.hydrateRoot=function(r,i,a){if(!Rh(r))throw Error(Y(405));var t=a!=null&&a.hydratedSources||null,e=!1,n="",o=J0;if(a!=null&&(a.unstable_strictMode===!0&&(e=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onRecoverableError!==void 0&&(o=a.onRecoverableError)),i=K0(i,null,r,1,a??null,e,!1,n,o),r[Ei]=i.current,Fs(r),t)for(r=0;r<t.length;r++)a=t[r],e=a._getVersion,e=e(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,e]:i.mutableSourceEagerHydrationData.push(a,e);return new Au(i)};Jr.render=function(r,i,a){if(!xu(i))throw Error(Y(200));return Su(null,r,i,!1,a)};Jr.unmountComponentAtNode=function(r){if(!xu(r))throw Error(Y(40));return r._reactRootContainer?(za(function(){Su(null,null,r,!1,function(){r._reactRootContainer=null,r[Ei]=null})}),!0):!1};Jr.unstable_batchedUpdates=xh;Jr.unstable_renderSubtreeIntoContainer=function(r,i,a,t){if(!xu(a))throw Error(Y(200));if(r==null||r._reactInternals===void 0)throw Error(Y(38));return Su(r,i,a,!1,t)};Jr.version="18.2.0-next-9e3b772b8-20220608";function Z0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Z0)}catch(r){console.error(r)}}Z0(),Kv.exports=Jr;var h1=Kv.exports,$0,np=h1;$0=np.createRoot,np.hydrateRoot;var pt;(function(r){r[r.Disjoint=0]="Disjoint",r[r.Contains=1]="Contains",r[r.Intersects=2]="Intersects"})(pt||(pt={}));var sr;(function(r){r[r.Back=0]="Back",r[r.Front=1]="Front",r[r.Intersecting=2]="Intersecting"})(sr||(sr={}));var Se;(function(r){r[r.Near=0]="Near",r[r.Far=1]="Far",r[r.Left=2]="Left",r[r.Right=3]="Right",r[r.Bottom=4]="Bottom",r[r.Top=5]="Top"})(Se||(Se={}));function ip(r,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Wo(r,i,a){return i&&ip(r.prototype,i),a&&ip(r,a),r}var U=function(){function r(){}return r.clamp=function(a,t,e){return Math.max(t,Math.min(e,a))},r.equals=function(a,t){return Math.abs(a-t)<=r.zeroTolerance},r.isPowerOf2=function(a){return(a&a-1)===0},r.radianToDegree=function(a){return a*r.radToDegreeFactor},r.degreeToRadian=function(a){return a*r.degreeToRadFactor},r}();(function(){U.zeroTolerance=1e-6})();(function(){U.radToDegreeFactor=180/Math.PI})();(function(){U.degreeToRadFactor=Math.PI/180})();var P=function(){function r(a,t,e){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),this._onValueChanged=null,this._x=a,this._y=t,this._z=e}var i=r.prototype;return i.set=function(t,e,n){return this._x=t,this._y=e,this._z=n,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,n=t._y,o=t._z;return Math.sqrt(e*e+n*n+o*o)},i.lengthSquared=function(){var t=this,e=t._x,n=t._y,o=t._z;return e*e+n*n+o*o},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return r.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._onValueChanged&&this._onValueChanged(),this},i.transformNormal=function(t){return r.transformNormal(this,t,this),this},i.transformToVec3=function(t){return r.transformToVec3(this,t,this),this},i.transformCoordinate=function(t){return r.transformCoordinate(this,t,this),this},i.transformByQuat=function(t){return r.transformByQuat(this,t,this),this},i.clone=function(){return new r(this._x,this._y,this._z)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z},i.toJSON=function(){return{x:this._x,y:this._y,z:this._z}},r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._z=t._z+e._z,n._onValueChanged&&n._onValueChanged()},r.subtract=function(t,e,n){n._x=t._x-e._x,n._y=t._y-e._y,n._z=t._z-e._z,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){n._x=t._x*e._x,n._y=t._y*e._y,n._z=t._z*e._z,n._onValueChanged&&n._onValueChanged()},r.divide=function(t,e,n){n._x=t._x/e._x,n._y=t._y/e._y,n._z=t._z/e._z,n._onValueChanged&&n._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z},r.cross=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=e._x,u=e._y,d=e._z;n.set(s*d-l*u,l*c-o*d,o*u-s*c)},r.distance=function(t,e){var n=e._x-t._x,o=e._y-t._y,s=e._z-t._z;return Math.sqrt(n*n+o*o+s*s)},r.distanceSquared=function(t,e){var n=e._x-t._x,o=e._y-t._y,s=e._z-t._z;return n*n+o*o+s*s},r.equals=function(t,e){return U.equals(t._x,e._x)&&U.equals(t._y,e._y)&&U.equals(t._z,e._z)},r.lerp=function(t,e,n,o){var s=t._x,l=t._y,c=t._z;o._x=s+(e._x-s)*n,o._y=l+(e._y-l)*n,o._z=c+(e._z-c)*n,o._onValueChanged&&o._onValueChanged()},r.max=function(t,e,n){n._x=Math.max(t._x,e._x),n._y=Math.max(t._y,e._y),n._z=Math.max(t._z,e._z),n._onValueChanged&&n._onValueChanged()},r.min=function(t,e,n){n._x=Math.min(t._x,e._x),n._y=Math.min(t._y,e._y),n._z=Math.min(t._z,e._z),n._onValueChanged&&n._onValueChanged()},r.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._onValueChanged&&e._onValueChanged()},r.normalize=function(t,e){var n=t._x,o=t._y,s=t._z,l=Math.sqrt(n*n+o*o+s*s);l>U.zeroTolerance&&(l=1/l,e.set(n*l,o*l,s*l))},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._z=t._z*e,n._onValueChanged&&n._onValueChanged()},r.transformNormal=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=e.elements;n._x=o*c[0]+s*c[4]+l*c[8],n._y=o*c[1]+s*c[5]+l*c[9],n._z=o*c[2]+s*c[6]+l*c[10],n._onValueChanged&&n._onValueChanged()},r.transformToVec3=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=e.elements;n._x=o*c[0]+s*c[4]+l*c[8]+c[12],n._y=o*c[1]+s*c[5]+l*c[9]+c[13],n._z=o*c[2]+s*c[6]+l*c[10]+c[14],n._onValueChanged&&n._onValueChanged()},r.transformToVec4=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=e.elements;n._x=o*c[0]+s*c[4]+l*c[8]+c[12],n._y=o*c[1]+s*c[5]+l*c[9]+c[13],n._z=o*c[2]+s*c[6]+l*c[10]+c[14],n._w=o*c[3]+s*c[7]+l*c[11]+c[15],n._onValueChanged&&n._onValueChanged()},r.transformCoordinate=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=e.elements,u=o*c[3]+s*c[7]+l*c[11]+c[15];u=1/u,n._x=(o*c[0]+s*c[4]+l*c[8]+c[12])*u,n._y=(o*c[1]+s*c[5]+l*c[9]+c[13])*u,n._z=(o*c[2]+s*c[6]+l*c[10]+c[14])*u,n._onValueChanged&&n._onValueChanged()},r.transformByQuat=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=e._x,u=e._y,d=e._z,f=e._w,h=f*o+u*l-d*s,_=f*s+d*o-c*l,g=f*l+c*s-u*o,y=-c*o-u*s-d*l;n._x=h*f-y*c-_*d+g*u,n._y=_*f-y*u-g*c+h*d,n._z=g*f-y*d-h*u+_*c,n._onValueChanged&&n._onValueChanged()},Wo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}}]),r}();(function(){P._zero=new P(0,0,0)})();(function(){P._one=new P(1,1,1)})();var ol=function(){function r(a,t){a===void 0&&(a=null),t===void 0&&(t=0),this.center=new P,this.radius=0,a&&this.center.copyFrom(a),this.radius=t}var i=r.prototype;return i.clone=function(){return new r(this.center,this.radius)},i.copyFrom=function(t){return this.center.copyFrom(t.center),this.radius=t.radius,this},r.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var n=t.length,o=r._tempVec30;o.x=o.y=o.z=0;for(var s=0;s<n;++s)P.add(t[s],o,o);P.scale(o,1/n,e.center);for(var l=0,c=0;c<n;++c){var u=P.distanceSquared(o,t[c]);u>l&&(l=u)}e.radius=Math.sqrt(l)},r.fromBox=function(t,e){var n=e.center,o=t.min,s=t.max;n.x=(o.x+s.x)*.5,n.y=(o.y+s.y)*.5,n.z=(o.z+s.z)*.5,e.radius=P.distance(n,s)},r}();(function(){ol._tempVec30=new P})();var qt=function(){function r(a,t){a===void 0&&(a=null),t===void 0&&(t=null),this.min=new P,this.max=new P,a&&this.min.copyFrom(a),t&&this.max.copyFrom(t)}var i=r.prototype;return i.getCenter=function(t){var e=this,n=e.min,o=e.max,s=o._x+n._x,l=o._y+n._y,c=o._z+n._z;return t.set(isNaN(s)?0:s*.5,isNaN(l)?0:l*.5,isNaN(c)?0:c*.5),t},i.getExtent=function(t){var e=this,n=e.min,o=e.max,s=o._x-n._x,l=o._y-n._y,c=o._z-n._z;return t.set(isNaN(s)?0:s*.5,isNaN(l)?0:l*.5,isNaN(c)?0:c*.5),t},i.getCorners=function(t){t===void 0&&(t=[]);var e=this,n=e.min,o=e.max,s=n.x,l=n.y,c=n.z,u=o.x,d=o.y,f=o.z,h=t.length;if(h<8)for(var _=0,g=8-h;_<g;++_)t[h+_]=new P;return t[0].set(s,d,f),t[1].set(u,d,f),t[2].set(u,l,f),t[3].set(s,l,f),t[4].set(s,d,c),t[5].set(u,d,c),t[6].set(u,l,c),t[7].set(s,l,c),t},i.transform=function(t){return r.transform(this,t,this),this},i.clone=function(){return new r(this.min,this.max)},i.copyFrom=function(t){return this.min.copyFrom(t.min),this.max.copyFrom(t.max),this},r.fromCenterAndExtent=function(t,e,n){P.subtract(t,e,n.min),P.add(t,e,n.max)},r.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var n=e.min,o=e.max;n.x=n.y=n.z=Number.MAX_VALUE,o.x=o.y=o.z=-Number.MAX_VALUE;for(var s=0,l=t.length;s<l;++s){var c=t[s];P.min(n,c,n),P.max(o,c,o)}},r.fromSphere=function(t,e){var n=t.center,o=t.radius,s=e.min,l=e.max;s.x=n.x-o,s.y=n.y-o,s.z=n.z-o,l.x=n.x+o,l.y=n.y+o,l.z=n.z+o},r.transform=function(t,e,n){var o=r._tempVec30,s=r._tempVec31;t.getCenter(o),t.getExtent(s),P.transformCoordinate(o,e,o);var l=s.x,c=s.y,u=s.z,d=e.elements,f=d[0],h=d[1],_=d[2],g=d[4],y=d[5],v=d[6],p=d[8],m=d[9],A=d[10];s.set((f===0?0:Math.abs(l*f))+(g===0?0:Math.abs(c*g))+(p===0?0:Math.abs(u*p)),(h===0?0:Math.abs(l*h))+(y===0?0:Math.abs(c*y))+(m===0?0:Math.abs(u*m)),(_===0?0:Math.abs(l*_))+(v===0?0:Math.abs(c*v))+(A===0?0:Math.abs(u*A))),P.subtract(o,s,n.min),P.add(o,s,n.max)},r.merge=function(t,e,n){return P.min(t.min,e.min,n.min),P.max(t.max,e.max,n.max),n},r}();(function(){qt._tempVec30=new P})();(function(){qt._tempVec31=new P})();var wt=function(){function r(){}return r.intersectionPointThreePlanes=function(a,t,e,n){var o=a.normal,s=t.normal,l=e.normal;P.cross(s,l,r._tempVec30),P.cross(l,o,r._tempVec31),P.cross(o,s,r._tempVec32);var c=-P.dot(o,r._tempVec30),u=-P.dot(s,r._tempVec31),d=-P.dot(l,r._tempVec32);P.scale(r._tempVec30,a.distance/c,r._tempVec30),P.scale(r._tempVec31,t.distance/u,r._tempVec31),P.scale(r._tempVec32,e.distance/d,r._tempVec32),P.add(r._tempVec30,r._tempVec31,n),P.add(n,r._tempVec32,n)},r.distancePlaneAndPoint=function(a,t){return P.dot(a.normal,t)+a.distance},r.intersectsPlaneAndPoint=function(a,t){var e=r.distancePlaneAndPoint(a,t);return e>0?sr.Front:e<0?sr.Back:sr.Intersecting},r.intersectsPlaneAndBox=function(a,t){var e=t.min,n=t.max,o=a.normal,s=r._tempVec30,l=r._tempVec31;return o.x>=0?(s.x=n.x,l.x=e.x):(s.x=e.x,l.x=n.x),o.y>=0?(s.y=n.y,l.y=e.y):(s.y=e.y,l.y=n.y),o.z>=0?(s.z=n.z,l.z=e.z):(s.z=e.z,l.z=n.z),r.distancePlaneAndPoint(a,s)<0?sr.Back:r.distancePlaneAndPoint(a,l)>0?sr.Front:sr.Intersecting},r.intersectsPlaneAndSphere=function(a,t){var e=t.center,n=t.radius,o=r.distancePlaneAndPoint(a,e);return o>n?sr.Front:o<-n?sr.Back:sr.Intersecting},r.intersectsRayAndPlane=function(a,t){var e=t.normal,n=U.zeroTolerance,o=P.dot(e,a.direction);if(Math.abs(o)<n)return-1;var s=P.dot(e,a.origin),l=(-t.distance-s)/o;if(l<0){if(l<-n)return-1;l=0}return l},r.intersectsRayAndBox=function(a,t){var e=U.zeroTolerance,n=a.origin,o=a.direction,s=t.min,l=t.max,c=o.x,u=o.y,d=o.z,f=n.x,h=n.y,_=n.z,g=0,y=Number.MAX_VALUE;if(Math.abs(c)<e){if(f<s.x||f>l.x)return-1}else{var v=1/c,p=(s.x-f)*v,m=(l.x-f)*v;if(p>m){var A=p;p=m,m=A}if(g=Math.max(p,g),y=Math.min(m,y),g>y)return-1}if(Math.abs(u)<e){if(h<s.y||h>l.y)return-1}else{var S=1/u,x=(s.y-h)*S,b=(l.y-h)*S;if(x>b){var C=x;x=b,b=C}if(g=Math.max(x,g),y=Math.min(b,y),g>y)return-1}if(Math.abs(d)<e){if(_<s.z||_>l.z)return-1}else{var w=1/d,E=(s.z-_)*w,T=(l.z-_)*w;if(E>T){var M=E;E=T,T=M}if(g=Math.max(E,g),y=Math.min(T,y),g>y)return-1}return g},r.intersectsRayAndSphere=function(a,t){var e=a.origin,n=a.direction,o=t.center,s=t.radius,l=r._tempVec30;P.subtract(e,o,l);var c=P.dot(l,n),u=P.dot(l,l)-s*s;if(c>0&&u>0)return-1;var d=c*c-u;if(d<0)return-1;var f=-c-Math.sqrt(d);return f<0&&(f=0),f},r.intersectsBoxAndBox=function(a,t){return a.min.x>t.max.x||t.min.x>a.max.x||a.min.y>t.max.y||t.min.y>a.max.y?!1:!(a.min.z>t.max.z||t.min.z>a.max.z)},r.intersectsSphereAndSphere=function(a,t){var e=a.radius+t.radius;return P.distanceSquared(a.center,t.center)<e*e},r.intersectsSphereAndBox=function(a,t){var e=a.center,n=t.max,o=t.min,s=r._tempVec30;s.set(Math.max(o.x,Math.min(e.x,n.x)),Math.max(o.y,Math.min(e.y,n.y)),Math.max(o.z,Math.min(e.z,n.z)));var l=P.distanceSquared(e,s);return l<=a.radius*a.radius},r.intersectsFrustumAndBox=function(a,t){for(var e=t.min,n=t.max,o=r._tempVec30,s=0;s<6;++s){var l=a.getPlane(s),c=l.normal;if(o.set(c.x>=0?n.x:e.x,c.y>=0?n.y:e.y,c.z>=0?n.z:e.z),P.dot(c,o)<-l.distance)return!1}return!0},r.frustumContainsPoint=function(a,t){var e=r.distancePlaneAndPoint(a.near,t);return Math.abs(e)<U.zeroTolerance?pt.Intersects:e<0?pt.Disjoint:(e=r.distancePlaneAndPoint(a.far,t),Math.abs(e)<U.zeroTolerance?pt.Intersects:e<0?pt.Disjoint:(e=r.distancePlaneAndPoint(a.left,t),Math.abs(e)<U.zeroTolerance?pt.Intersects:e<0?pt.Disjoint:(e=r.distancePlaneAndPoint(a.right,t),Math.abs(e)<U.zeroTolerance?pt.Intersects:e<0?pt.Disjoint:(e=r.distancePlaneAndPoint(a.top,t),Math.abs(e)<U.zeroTolerance?pt.Intersects:e<0?pt.Disjoint:(e=r.distancePlaneAndPoint(a.bottom,t),Math.abs(e)<U.zeroTolerance?pt.Intersects:e<0?pt.Disjoint:pt.Contains)))))},r.frustumContainsBox=function(a,t){for(var e=t.min,n=t.max,o=r._tempVec30,s=r._tempVec31,l=pt.Contains,c=0;c<6;++c){var u=a.getPlane(c),d=u.normal;if(d.x>=0?(o.x=n.x,s.x=e.x):(o.x=e.x,s.x=n.x),d.y>=0?(o.y=n.y,s.y=e.y):(o.y=e.y,s.y=n.y),d.z>=0?(o.z=n.z,s.z=e.z):(o.z=e.z,s.z=n.z),r.intersectsPlaneAndPoint(u,o)===sr.Back)return pt.Disjoint;r.intersectsPlaneAndPoint(u,s)===sr.Back&&(l=pt.Intersects)}return l},r.frustumContainsSphere=function(a,t){for(var e=pt.Contains,n=0;n<6;++n){var o=a.getPlane(n),s=r.intersectsPlaneAndSphere(o,t);if(s===sr.Back)return pt.Disjoint;if(s===sr.Intersecting){e=pt.Intersects;break}}return e},r}();(function(){wt._tempVec30=new P})();(function(){wt._tempVec31=new P})();(function(){wt._tempVec32=new P})();var Pt=function(){function r(a,t){a===void 0&&(a=null),t===void 0&&(t=0),this.normal=new P,this.distance=0,a&&this.normal.copyFrom(a),this.distance=t}var i=r.prototype;return i.normalize=function(){return r.normalize(this,this),this},i.clone=function(){var t=new r;return t.copyFrom(this),t},i.copyFrom=function(t){return this.normal.copyFrom(t.normal),this.distance=t.distance,this},r.normalize=function(t,e){var n=t.normal,o=1/n.length();P.scale(n,o,e.normal),e.distance=t.distance*o},r.fromPoints=function(t,e,n,o){var s=t.x,l=t.y,c=t.z,u=e.x-s,d=e.y-l,f=e.z-c,h=n.x-s,_=n.y-l,g=n.z-c,y=d*g-f*_,v=f*h-u*g,p=u*_-d*h,m=1/Math.sqrt(y*y+v*v+p*p),A=y*m,S=v*m,x=p*m,b=o.normal;b.x=A,b.y=S,b.z=x,o.distance=-(A*s+S*l+x*c)},r}(),_1=function(){function r(a){a===void 0&&(a=null),this.near=new Pt,this.far=new Pt,this.left=new Pt,this.right=new Pt,this.top=new Pt,this.bottom=new Pt,a&&this.calculateFromMatrix(a)}var i=r.prototype;return i.getPlane=function(t){switch(t){case Se.Near:return this.near;case Se.Far:return this.far;case Se.Left:return this.left;case Se.Right:return this.right;case Se.Bottom:return this.bottom;case Se.Top:return this.top;default:return null}},i.calculateFromMatrix=function(t){var e=t.elements,n=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],d=e[6],f=e[7],h=e[8],_=e[9],g=e[10],y=e[11],v=e[12],p=e[13],m=e[14],A=e[15],S=this.near.normal;S.set(l+s,f+d,y+g),this.near.distance=A+m,this.near.normalize();var x=this.far.normal;x.set(l-s,f-d,y-g),this.far.distance=A-m,this.far.normalize();var b=this.left.normal;b.set(l+n,f+c,y+h),this.left.distance=A+v,this.left.normalize();var C=this.right.normal;C.set(l-n,f-c,y-h),this.right.distance=A-v,this.right.normalize();var w=this.bottom.normal;w.set(l+o,f+u,y+_),this.bottom.distance=A+p,this.bottom.normalize();var E=this.top.normal;E.set(l-o,f-u,y-_),this.top.distance=A-p,this.top.normalize()},i.intersectsBox=function(t){return wt.intersectsFrustumAndBox(this,t)},i.intersectsSphere=function(t){return wt.frustumContainsSphere(this,t)!==pt.Disjoint},i.clone=function(){var t=new r;return t.copyFrom(this),t},i.copyFrom=function(t){return this.near.copyFrom(t.near),this.far.copyFrom(t.far),this.left.copyFrom(t.left),this.right.copyFrom(t.right),this.bottom.copyFrom(t.bottom),this.top.copyFrom(t.top),this},r}(),Do=function(){function r(a,t,e,n,o,s,l,c,u){a===void 0&&(a=1),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=1),s===void 0&&(s=0),l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=1),this.elements=new Float32Array(9);var d=this.elements;d[0]=a,d[1]=t,d[2]=e,d[3]=n,d[4]=o,d[5]=s,d[6]=l,d[7]=c,d[8]=u}var i=r.prototype;return i.set=function(t,e,n,o,s,l,c,u,d){var f=this.elements;return f[0]=t,f[1]=e,f[2]=n,f[3]=o,f[4]=s,f[5]=l,f[6]=c,f[7]=u,f[8]=d,this},i.add=function(t){return r.add(this,t,this),this},i.subtract=function(t){return r.subtract(this,t,this),this},i.multiply=function(t){return r.multiply(this,t,this),this},i.determinant=function(){var t=this.elements,e=t[0],n=t[1],o=t[2],s=t[3],l=t[4],c=t[5],u=t[6],d=t[7],f=t[8],h=f*l-c*d,_=-f*s+c*u,g=d*s-l*u;return e*h+n*_+o*g},i.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},i.invert=function(){return r.invert(this,this),this},i.rotate=function(t){return r.rotate(this,t,this),this},i.scale=function(t){return r.scale(this,t,this),this},i.translate=function(t){return r.translate(this,t,this),this},i.transpose=function(){return r.transpose(this,this),this},i.clone=function(){var t=this.elements,e=new r(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);return e},i.copyFrom=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},i.copyFromArray=function(t,e){e===void 0&&(e=0);for(var n=this.elements,o=0;o<12;o++)n[o]=t[o+e];return this},i.copyToArray=function(t,e){e===void 0&&(e=0);var n=this.elements;t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8]},i.copyFromMatrix=function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],this},r.add=function(t,e,n){var o=t.elements,s=e.elements,l=n.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8]},r.subtract=function(t,e,n){var o=t.elements,s=e.elements,l=n.elements;l[0]=o[0]-s[0],l[1]=o[1]-s[1],l[2]=o[2]-s[2],l[3]=o[3]-s[3],l[4]=o[4]-s[4],l[5]=o[5]-s[5],l[6]=o[6]-s[6],l[7]=o[7]-s[7],l[8]=o[8]-s[8]},r.multiply=function(t,e,n){var o=t.elements,s=e.elements,l=n.elements,c=o[0],u=o[1],d=o[2],f=o[3],h=o[4],_=o[5],g=o[6],y=o[7],v=o[8],p=s[0],m=s[1],A=s[2],S=s[3],x=s[4],b=s[5],C=s[6],w=s[7],E=s[8];l[0]=c*p+f*m+g*A,l[1]=u*p+h*m+y*A,l[2]=d*p+_*m+v*A,l[3]=c*S+f*x+g*b,l[4]=u*S+h*x+y*b,l[5]=d*S+_*x+v*b,l[6]=c*C+f*w+g*E,l[7]=u*C+h*w+y*E,l[8]=d*C+_*w+v*E},r.equals=function(t,e){var n=t.elements,o=e.elements;return U.equals(n[0],o[0])&&U.equals(n[1],o[1])&&U.equals(n[2],o[2])&&U.equals(n[3],o[3])&&U.equals(n[4],o[4])&&U.equals(n[5],o[5])&&U.equals(n[6],o[6])&&U.equals(n[7],o[7])&&U.equals(n[8],o[8])},r.lerp=function(t,e,n,o){var s=t.elements,l=e.elements,c=o.elements,u=1-n;c[0]=s[0]*u+l[0]*n,c[1]=s[1]*u+l[1]*n,c[2]=s[2]*u+l[2]*n,c[3]=s[3]*u+l[3]*n,c[4]=s[4]*u+l[4]*n,c[5]=s[5]*u+l[5]*n,c[6]=s[6]*u+l[6]*n,c[7]=s[7]*u+l[7]*n,c[8]=s[8]*u+l[8]*n},r.rotationQuaternion=function(t,e){var n=e.elements,o=t._x,s=t._y,l=t._z,c=t._w,u=o+o,d=s+s,f=l+l,h=o*u,_=s*u,g=s*d,y=l*u,v=l*d,p=l*f,m=c*u,A=c*d,S=c*f;n[0]=1-g-p,n[3]=_-S,n[6]=y+A,n[1]=_+S,n[4]=1-h-p,n[7]=v-m,n[2]=y-A,n[5]=v+m,n[8]=1-h-g},r.scaling=function(t,e){var n=e.elements;n[0]=t._x,n[1]=0,n[2]=0,n[3]=0,n[4]=t._y,n[5]=0,n[6]=0,n[7]=0,n[8]=1},r.translation=function(a,t){var e=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=a._x,e[7]=a._y,e[8]=1},r.invert=function(t,e){var n=t.elements,o=e.elements,s=n[0],l=n[1],c=n[2],u=n[3],d=n[4],f=n[5],h=n[6],_=n[7],g=n[8],y=g*d-f*_,v=-g*u+f*h,p=_*u-d*h,m=s*y+l*v+c*p;m&&(m=1/m,o[0]=y*m,o[1]=(-g*l+c*_)*m,o[2]=(f*l-c*d)*m,o[3]=v*m,o[4]=(g*s-c*h)*m,o[5]=(-f*s+c*u)*m,o[6]=p*m,o[7]=(-_*s+l*h)*m,o[8]=(d*s-l*u)*m)},r.normalMatrix=function(t,e){var n=t.elements,o=e.elements,s=n[0],l=n[1],c=n[2],u=n[3],d=n[4],f=n[5],h=n[6],_=n[7],g=n[8],y=n[9],v=n[10],p=n[11],m=n[12],A=n[13],S=n[14],x=n[15],b=s*f-l*d,C=s*h-c*d,w=s*_-u*d,E=l*h-c*f,T=l*_-u*f,M=c*_-u*h,B=g*A-y*m,I=g*S-v*m,F=g*x-p*m,L=y*S-v*A,V=y*x-p*A,D=v*x-p*S,N=b*D-C*V+w*L+E*F-T*I+M*B;if(!N)return null;N=1/N,o[0]=(f*D-h*V+_*L)*N,o[1]=(h*F-d*D-_*I)*N,o[2]=(d*V-f*F+_*B)*N,o[3]=(c*V-l*D-u*L)*N,o[4]=(s*D-c*F+u*I)*N,o[5]=(l*F-s*V-u*B)*N,o[6]=(A*M-S*T+x*E)*N,o[7]=(S*w-m*M-x*C)*N,o[8]=(m*T-A*w+x*b)*N},r.rotate=function(t,e,n){var o=t.elements,s=n.elements,l=Math.sin(e),c=Math.cos(e),u=o[0],d=o[1],f=o[2],h=o[3],_=o[4],g=o[5],y=o[6],v=o[7],p=o[8];s[0]=c*u+l*h,s[1]=c*d+l*_,s[2]=c*f+l*g,s[3]=c*h-l*u,s[4]=c*_-l*d,s[5]=c*g-l*f,s[6]=y,s[7]=v,s[8]=p},r.scale=function(t,e,n){var o=e._x,s=e._y,l=t.elements,c=n.elements;c[0]=o*l[0],c[1]=o*l[1],c[2]=o*l[2],c[3]=s*l[3],c[4]=s*l[4],c[5]=s*l[5],c[6]=l[6],c[7]=l[7],c[8]=l[8]},r.translate=function(t,e,n){var o=e._x,s=e._y,l=t.elements,c=n.elements,u=l[0],d=l[1],f=l[2],h=l[3],_=l[4],g=l[5],y=l[6],v=l[7],p=l[8];c[0]=u,c[1]=d,c[2]=f,c[3]=h,c[4]=_,c[5]=g,c[6]=o*u+s*h+y,c[7]=o*d+s*_+v,c[8]=o*f+s*g+p},r.transpose=function(t,e){var n=t.elements,o=e.elements;if(e===t){var s=n[1],l=n[2],c=n[5];o[1]=n[3],o[2]=n[6],o[3]=s,o[5]=n[7],o[6]=l,o[7]=c}else o[0]=n[0],o[1]=n[3],o[2]=n[6],o[3]=n[1],o[4]=n[4],o[5]=n[7],o[6]=n[2],o[7]=n[5],o[8]=n[8]},r}(),xe=function(){function r(a,t,e,n){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=1),this._onValueChanged=null,this._x=a,this._y=t,this._z=e,this._w=n}var i=r.prototype;return i.set=function(t,e,n,o){return this._x=t,this._y=e,this._z=n,this._w=o,this._onValueChanged&&this._onValueChanged(),this},i.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onValueChanged&&this._onValueChanged(),this},i.getAxisAngle=function(t){var e=this,n=e._x,o=e._y,s=e._z,l=n*n+o*o+s*s;if(l<U.zeroTolerance)return t._x=1,t._y=0,t._z=0,0;var c=1/l;return t._x=this._x*c,t._y=this._y*c,t._z=this._z*c,Math.acos(this._w)*2},i.identity=function(){return this._x=0,this._y=0,this._z=0,this._w=1,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,n=t._y,o=t._z,s=t._w;return Math.sqrt(e*e+n*n+o*o+s*s)},i.lengthSquared=function(){var t=this,e=t._x,n=t._y,o=t._z,s=t._w;return e*e+n*n+o*o+s*s},i.normalize=function(){return r.normalize(this,this),this},i.toEuler=function(t){this._toYawPitchRoll(t);var e=t._x;return t._x=t._y,t._y=e,t._onValueChanged&&t._onValueChanged(),t},i.toYawPitchRoll=function(t){return this._toYawPitchRoll(t),t._onValueChanged&&t._onValueChanged(),t},i.rotateX=function(t){return r.rotateX(this,t,this),this},i.rotateY=function(t){return r.rotateY(this,t,this),this},i.rotateZ=function(t){return r.rotateZ(this,t,this),this},i.rotationAxisAngle=function(t,e){return r.rotationAxisAngle(t,e,this),this},i.multiply=function(t){return r.multiply(this,t,this),this},i.invert=function(){return r.invert(this,this),this},i.dot=function(t){return r.dot(this,t)},i.lerp=function(t,e){return r.lerp(this,t,e,this),this},i.rotateAxisAngle=function(t,e){return r._tempQuat1.rotationAxisAngle(t,e),this.multiply(r._tempQuat1),this},i.clone=function(){return new r(this._x,this._y,this._z,this._w)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},i.toJSON=function(){return{x:this._x,y:this._y,z:this._z,w:this._w}},i._toYawPitchRoll=function(t){var e=this,n=e._x,o=e._y,s=e._z,l=e._w,c=n*n,u=o*o,d=s*s,f=l*l,h=c+u+d+f,_=2*(n*l-o*s);_>(1-U.zeroTolerance)*h?(t._x=Math.atan2(2*(l*o-n*s),d+f-u-d),t._y=Math.PI/2,t._z=0):_<-(1-U.zeroTolerance)*h?(t._x=Math.atan2(2*(l*o-n*s),d+f-u-d),t._y=-Math.PI/2,t._z=0):(t._x=Math.atan2(2*(s*n+o*l),d+f-u-c),t._y=Math.asin(_/h),t._z=Math.atan2(2*(n*o+s*l),u+f-d-c))},r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._z=t._z+e._z,n._w=t._w+e._w,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=t._w,u=e._x,d=e._y,f=e._z,h=e._w;n._x=o*h+c*u+s*f-l*d,n._y=s*h+c*d+l*u-o*f,n._z=l*h+c*f+o*d-s*u,n._w=c*h-o*u-s*d-l*f,n._onValueChanged&&n._onValueChanged()},r.conjugate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=t._w,e._onValueChanged&&e._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},r.equals=function(t,e){return U.equals(t._x,e._x)&&U.equals(t._y,e._y)&&U.equals(t._z,e._z)&&U.equals(t._w,e._w)},r.rotationAxisAngle=function(t,e,n){var o=r._tempVector3;P.normalize(t,o),e*=.5;var s=Math.sin(e);n._x=o._x*s,n._y=o._y*s,n._z=o._z*s,n._w=Math.cos(e),n._onValueChanged&&n._onValueChanged()},r.rotationEuler=function(t,e,n,o){r.rotationYawPitchRoll(e,t,n,o)},r.rotationYawPitchRoll=function(t,e,n,o){var s=n*.5,l=e*.5,c=t*.5,u=Math.sin(s),d=Math.cos(s),f=Math.sin(l),h=Math.cos(l),_=Math.sin(c),g=Math.cos(c),y=g*h,v=_*f;o._x=g*f*d+_*h*u,o._y=_*h*d-g*f*u,o._z=y*u-v*d,o._w=y*d+v*u,o._onValueChanged&&o._onValueChanged()},r.rotationMatrix3x3=function(t,e){var n=t.elements,o=n[0],s=n[1],l=n[2],c=n[3],u=n[4],d=n[5],f=n[6],h=n[7],_=n[8],g=o+u+_,y,v;g>0?(y=Math.sqrt(g+1),e._w=y*.5,y=.5/y,e._x=(d-h)*y,e._y=(f-l)*y,e._z=(s-c)*y):o>=u&&o>=_?(y=Math.sqrt(1+o-u-_),v=.5/y,e._x=.5*y,e._y=(s+c)*v,e._z=(l+f)*v,e._w=(d-h)*v):u>_?(y=Math.sqrt(1+u-o-_),v=.5/y,e._x=(c+s)*v,e._y=.5*y,e._z=(h+d)*v,e._w=(f-l)*v):(y=Math.sqrt(1+_-o-u),v=.5/y,e._x=(l+f)*v,e._y=(d+h)*v,e._z=.5*y,e._w=(s-c)*v),e._onValueChanged&&e._onValueChanged()},r.invert=function(t,e){var n=t._x,o=t._y,s=t._z,l=t._w,c=n*n+o*o+s*s+l*l;if(c>U.zeroTolerance){var u=1/c;e._x=-n*u,e._y=-o*u,e._z=-s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged()}},r.lerp=function(t,e,n,o){var s=1-n;r.dot(t,e)>=0?(o._x=t._x*s+e._x*n,o._y=t._y*s+e._y*n,o._z=t._z*s+e._z*n,o._w=t._w*s+e._w*n):(o._x=t._x*s-e._x*n,o._y=t._y*s-e._y*n,o._z=t._z*s-e._z*n,o._w=t._w*s-e._w*n),o.normalize()},r.slerp=function(t,e,n,o){var s,l,c=r.dot(t,e);if(Math.abs(c)>1-U.zeroTolerance)l=1-n,s=n*Math.sign(c);else{var u=Math.acos(Math.abs(c)),d=1/Math.sin(u);l=Math.sin((1-n)*u)*d,s=Math.sin(n*u)*d*Math.sign(c)}o.x=l*t.x+s*e.x,o.y=l*t.y+s*e.y,o.z=l*t.z+s*e.z,o.w=l*t.w+s*e.w,o._onValueChanged&&o._onValueChanged()},r.normalize=function(t,e){var n=t._x,o=t._y,s=t._z,l=t._w,c=Math.sqrt(n*n+o*o+s*s+l*l);c>U.zeroTolerance&&(c=1/c,e._x=n*c,e._y=o*c,e._z=s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged())},r.rotationX=function(t,e){t*=.5;var n=Math.sin(t),o=Math.cos(t);e._x=n,e._y=0,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},r.rotationY=function(t,e){t*=.5;var n=Math.sin(t),o=Math.cos(t);e._x=0,e._y=n,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},r.rotationZ=function(t,e){t*=.5;var n=Math.sin(t),o=Math.cos(t);e._x=0,e._y=0,e._z=n,e._w=o,e._onValueChanged&&e._onValueChanged()},r.rotateX=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=t._w;e*=.5;var u=Math.sin(e),d=Math.cos(e);n._x=o*d+c*u,n._y=s*d+l*u,n._z=l*d-s*u,n._w=c*d-o*u,n._onValueChanged&&n._onValueChanged()},r.rotateY=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=t._w;e*=.5;var u=Math.sin(e),d=Math.cos(e);n._x=o*d-l*u,n._y=s*d+c*u,n._z=l*d+o*u,n._w=c*d-s*u,n._onValueChanged&&n._onValueChanged()},r.rotateZ=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=t._w;e*=.5;var u=Math.sin(e),d=Math.cos(e);n._x=o*d+s*u,n._y=s*d-o*u,n._z=l*d+c*u,n._w=c*d-l*u,n._onValueChanged&&n._onValueChanged()},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._z=t._z*e,n._w=t._w*e,n._onValueChanged&&n._onValueChanged()},Wo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"normalized",get:function(){return Math.abs(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w-1)<U.zeroTolerance}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),r}();(function(){xe._tempVector3=new P})();(function(){xe._tempQuat1=new xe})();var $=function(){function r(a,t,e,n,o,s,l,c,u,d,f,h,_,g,y,v){a===void 0&&(a=1),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=1),l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=0),d===void 0&&(d=0),f===void 0&&(f=1),h===void 0&&(h=0),_===void 0&&(_=0),g===void 0&&(g=0),y===void 0&&(y=0),v===void 0&&(v=1),this.elements=new Float32Array(16);var p=this.elements;p[0]=a,p[1]=t,p[2]=e,p[3]=n,p[4]=o,p[5]=s,p[6]=l,p[7]=c,p[8]=u,p[9]=d,p[10]=f,p[11]=h,p[12]=_,p[13]=g,p[14]=y,p[15]=v}var i=r.prototype;return i.set=function(t,e,n,o,s,l,c,u,d,f,h,_,g,y,v,p){var m=this.elements;return m[0]=t,m[1]=e,m[2]=n,m[3]=o,m[4]=s,m[5]=l,m[6]=c,m[7]=u,m[8]=d,m[9]=f,m[10]=h,m[11]=_,m[12]=g,m[13]=y,m[14]=v,m[15]=p,this},i.multiply=function(t){return r.multiply(this,t,this),this},i.determinant=function(){var t=this.elements,e=t[0],n=t[1],o=t[2],s=t[3],l=t[4],c=t[5],u=t[6],d=t[7],f=t[8],h=t[9],_=t[10],g=t[11],y=t[12],v=t[13],p=t[14],m=t[15],A=e*c-n*l,S=e*u-o*l,x=e*d-s*l,b=n*u-o*c,C=n*d-s*c,w=o*d-s*u,E=f*v-h*y,T=f*p-_*y,M=f*m-g*y,B=h*p-_*v,I=h*m-g*v,F=_*m-g*p;return A*F-S*I+x*B+b*M-C*T+w*E},i.decompose=function(t,e,n){var o=r._tempMat30,s=this.elements,l=o.elements,c=s[0],u=s[1],d=s[2],f=s[4],h=s[5],_=s[6],g=s[8],y=s[9],v=s[10];t.set(s[12],s[13],s[14]);var p=Math.sqrt(c*c+u*u+d*d),m=Math.sqrt(f*f+h*h+_*_),A=Math.sqrt(g*g+y*y+v*v);if(this.determinant()<0&&(p=-p),n.set(p,m,A),Math.abs(p)<U.zeroTolerance||Math.abs(m)<U.zeroTolerance||Math.abs(A)<U.zeroTolerance)return e.identity(),!1;var S=1/p,x=1/m,b=1/A;return l[0]=c*S,l[1]=u*S,l[2]=d*S,l[3]=f*x,l[4]=h*x,l[5]=_*x,l[6]=g*b,l[7]=y*b,l[8]=v*b,xe.rotationMatrix3x3(o,e),!0},i.getRotation=function(t){var e=this.elements,n=e[0]+e[5]+e[10];if(n>U.zeroTolerance){var o=Math.sqrt(n+1)*2;t._w=.25*o,t._x=(e[6]-e[9])/o,t._y=(e[8]-e[2])/o,t._z=(e[1]-e[4])/o}else if(e[0]>e[5]&&e[0]>e[10]){var s=Math.sqrt(1+e[0]-e[5]-e[10])*2;t._w=(e[6]-e[9])/s,t._x=.25*s,t._y=(e[1]+e[4])/s,t._z=(e[8]+e[2])/s}else if(e[5]>e[10]){var l=Math.sqrt(1+e[5]-e[0]-e[10])*2;t._w=(e[8]-e[2])/l,t._x=(e[1]+e[4])/l,t._y=.25*l,t._z=(e[6]+e[9])/l}else{var c=Math.sqrt(1+e[10]-e[0]-e[5])*2;t._w=(e[1]-e[4])/c,t._x=(e[8]+e[2])/c,t._y=(e[6]+e[9])/c,t._z=.25*c}return t._onValueChanged&&t._onValueChanged(),t},i.getScaling=function(t){var e=this.elements,n=e[0],o=e[1],s=e[2],l=e[4],c=e[5],u=e[6],d=e[8],f=e[9],h=e[10];return t.set(Math.sqrt(n*n+o*o+s*s),Math.sqrt(l*l+c*c+u*u),Math.sqrt(d*d+f*f+h*h)),t},i.getTranslation=function(t){var e=this.elements;return t.set(e[12],e[13],e[14]),t},i.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.invert=function(){return r.invert(this,this),this},i.rotateAxisAngle=function(t,e){return r.rotateAxisAngle(this,t,e,this),this},i.scale=function(t){return r.scale(this,t,this),this},i.translate=function(t){return r.translate(this,t,this),this},i.transpose=function(){return r.transpose(this,this),this},i.clone=function(){var t=this.elements,e=new r(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);return e},i.copyFrom=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},i.copyFromArray=function(t,e){e===void 0&&(e=0);for(var n=this.elements,o=0;o<16;o++)n[o]=t[o+e];return this},i.copyToArray=function(t,e){e===void 0&&(e=0);var n=this.elements;t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15]},r.multiply=function(t,e,n){var o=t.elements,s=e.elements,l=n.elements,c=o[0],u=o[1],d=o[2],f=o[3],h=o[4],_=o[5],g=o[6],y=o[7],v=o[8],p=o[9],m=o[10],A=o[11],S=o[12],x=o[13],b=o[14],C=o[15],w=s[0],E=s[1],T=s[2],M=s[3],B=s[4],I=s[5],F=s[6],L=s[7],V=s[8],D=s[9],N=s[10],O=s[11],G=s[12],Q=s[13],H=s[14],ee=s[15];l[0]=c*w+h*E+v*T+S*M,l[1]=u*w+_*E+p*T+x*M,l[2]=d*w+g*E+m*T+b*M,l[3]=f*w+y*E+A*T+C*M,l[4]=c*B+h*I+v*F+S*L,l[5]=u*B+_*I+p*F+x*L,l[6]=d*B+g*I+m*F+b*L,l[7]=f*B+y*I+A*F+C*L,l[8]=c*V+h*D+v*N+S*O,l[9]=u*V+_*D+p*N+x*O,l[10]=d*V+g*D+m*N+b*O,l[11]=f*V+y*D+A*N+C*O,l[12]=c*G+h*Q+v*H+S*ee,l[13]=u*G+_*Q+p*H+x*ee,l[14]=d*G+g*Q+m*H+b*ee,l[15]=f*G+y*Q+A*H+C*ee},r.equals=function(t,e){var n=t.elements,o=e.elements;return U.equals(n[0],o[0])&&U.equals(n[1],o[1])&&U.equals(n[2],o[2])&&U.equals(n[3],o[3])&&U.equals(n[4],o[4])&&U.equals(n[5],o[5])&&U.equals(n[6],o[6])&&U.equals(n[7],o[7])&&U.equals(n[8],o[8])&&U.equals(n[9],o[9])&&U.equals(n[10],o[10])&&U.equals(n[11],o[11])&&U.equals(n[12],o[12])&&U.equals(n[13],o[13])&&U.equals(n[14],o[14])&&U.equals(n[15],o[15])},r.lerp=function(t,e,n,o){var s=t.elements,l=e.elements,c=o.elements,u=1-n;c[0]=s[0]*u+l[0]*n,c[1]=s[1]*u+l[1]*n,c[2]=s[2]*u+l[2]*n,c[3]=s[3]*u+l[3]*n,c[4]=s[4]*u+l[4]*n,c[5]=s[5]*u+l[5]*n,c[6]=s[6]*u+l[6]*n,c[7]=s[7]*u+l[7]*n,c[8]=s[8]*u+l[8]*n,c[9]=s[9]*u+l[9]*n,c[10]=s[10]*u+l[10]*n,c[11]=s[11]*u+l[11]*n,c[12]=s[12]*u+l[12]*n,c[13]=s[13]*u+l[13]*n,c[14]=s[14]*u+l[14]*n,c[15]=s[15]*u+l[15]*n},r.add=function(t,e,n){var o=t.elements,s=e.elements,l=n.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8],l[9]=o[9]+s[9],l[10]=o[10]+s[10],l[11]=o[11]+s[11],l[12]=o[12]+s[12],l[13]=o[13]+s[13],l[14]=o[14]+s[14],l[15]=o[15]+s[15]},r.multiplyScalar=function(t,e,n){var o=t.elements,s=n.elements;s[0]=o[0]*e,s[1]=o[1]*e,s[2]=o[2]*e,s[3]=o[3]*e,s[4]=o[4]*e,s[5]=o[5]*e,s[6]=o[6]*e,s[7]=o[7]*e,s[8]=o[8]*e,s[9]=o[9]*e,s[10]=o[10]*e,s[11]=o[11]*e,s[12]=o[12]*e,s[13]=o[13]*e,s[14]=o[14]*e,s[15]=o[15]*e},r.rotationQuaternion=function(t,e){var n=e.elements,o=t._x,s=t._y,l=t._z,c=t._w,u=o+o,d=s+s,f=l+l,h=o*u,_=s*u,g=s*d,y=l*u,v=l*d,p=l*f,m=c*u,A=c*d,S=c*f;n[0]=1-g-p,n[1]=_+S,n[2]=y-A,n[3]=0,n[4]=_-S,n[5]=1-h-p,n[6]=v+m,n[7]=0,n[8]=y+A,n[9]=v-m,n[10]=1-h-g,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},r.rotationAxisAngle=function(t,e,n){var o=n.elements,s=t._x,l=t._y,c=t._z,u=Math.sqrt(s*s+l*l+c*c),d,f,h;Math.abs(u)<U.zeroTolerance||(u=1/u,s*=u,l*=u,c*=u,d=Math.sin(e),f=Math.cos(e),h=1-f,o[0]=s*s*h+f,o[1]=l*s*h+c*d,o[2]=c*s*h-l*d,o[3]=0,o[4]=s*l*h-c*d,o[5]=l*l*h+f,o[6]=c*l*h+s*d,o[7]=0,o[8]=s*c*h+l*d,o[9]=l*c*h-s*d,o[10]=c*c*h+f,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1)},r.rotationTranslation=function(t,e,n){r.rotationQuaternion(t,n);var o=n.elements;o[12]=e._x,o[13]=e._y,o[14]=e._z},r.affineTransformation=function(t,e,n,o){var s=o.elements,l=e._x,c=e._y,u=e._z,d=e._w,f=l+l,h=c+c,_=u+u,g=l*f,y=l*h,v=l*_,p=c*h,m=c*_,A=u*_,S=d*f,x=d*h,b=d*_,C=t._x,w=t._y,E=t._z;s[0]=(1-(p+A))*C,s[1]=(y+b)*C,s[2]=(v-x)*C,s[3]=0,s[4]=(y-b)*w,s[5]=(1-(g+A))*w,s[6]=(m+S)*w,s[7]=0,s[8]=(v+x)*E,s[9]=(m-S)*E,s[10]=(1-(g+p))*E,s[11]=0,s[12]=n._x,s[13]=n._y,s[14]=n._z,s[15]=1},r.scaling=function(t,e){var n=e.elements;n[0]=t._x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t._y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t._z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},r.translation=function(a,t){var e=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a._x,e[13]=a._y,e[14]=a._z,e[15]=1},r.invert=function(t,e){var n=t.elements,o=e.elements,s=n[0],l=n[1],c=n[2],u=n[3],d=n[4],f=n[5],h=n[6],_=n[7],g=n[8],y=n[9],v=n[10],p=n[11],m=n[12],A=n[13],S=n[14],x=n[15],b=s*f-l*d,C=s*h-c*d,w=s*_-u*d,E=l*h-c*f,T=l*_-u*f,M=c*_-u*h,B=g*A-y*m,I=g*S-v*m,F=g*x-p*m,L=y*S-v*A,V=y*x-p*A,D=v*x-p*S,N=b*D-C*V+w*L+E*F-T*I+M*B;if(!N)return null;N=1/N,o[0]=(f*D-h*V+_*L)*N,o[1]=(c*V-l*D-u*L)*N,o[2]=(A*M-S*T+x*E)*N,o[3]=(v*T-y*M-p*E)*N,o[4]=(h*F-d*D-_*I)*N,o[5]=(s*D-c*F+u*I)*N,o[6]=(S*w-m*M-x*C)*N,o[7]=(g*M-v*w+p*C)*N,o[8]=(d*V-f*F+_*B)*N,o[9]=(l*F-s*V-u*B)*N,o[10]=(m*T-A*w+x*b)*N,o[11]=(y*w-g*T-p*b)*N,o[12]=(f*I-d*L-h*B)*N,o[13]=(s*L-l*I+c*B)*N,o[14]=(A*C-m*E-S*b)*N,o[15]=(g*E-y*C+v*b)*N},r.lookAt=function(t,e,n,o){var s=o.elements,l=r._tempVec30,c=r._tempVec31,u=r._tempVec32;P.subtract(t,e,u),u.normalize(),P.cross(n,u,l),l.normalize(),P.cross(u,l,c),s[0]=l._x,s[1]=c._x,s[2]=u._x,s[3]=0,s[4]=l._y,s[5]=c._y,s[6]=u._y,s[7]=0,s[8]=l._z,s[9]=c._z,s[10]=u._z,s[11]=0,s[12]=-P.dot(l,t),s[13]=-P.dot(c,t),s[14]=-P.dot(u,t),s[15]=1},r.ortho=function(t,e,n,o,s,l,c){var u=c.elements,d=1/(t-e),f=1/(n-o),h=1/(s-l);u[0]=-2*d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*f,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*h,u[11]=0,u[12]=(t+e)*d,u[13]=(o+n)*f,u[14]=(l+s)*h,u[15]=1},r.perspective=function(t,e,n,o,s){var l=s.elements,c=1/Math.tan(t/2),u=1/(n-o);l[0]=c/e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=c,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=(o+n)*u,l[11]=-1,l[12]=0,l[13]=0,l[14]=2*o*n*u,l[15]=0},r.rotateAxisAngle=function(t,e,n,o){var s=e._x,l=e._y,c=e._z,u=Math.sqrt(s*s+l*l+c*c);if(!(Math.abs(u)<U.zeroTolerance)){var d=t.elements,f=o.elements,h,_,g;u=1/u,s*=u,l*=u,c*=u,h=Math.sin(n),_=Math.cos(n),g=1-_;var y=d[0],v=d[1],p=d[2],m=d[3],A=d[4],S=d[5],x=d[6],b=d[7],C=d[8],w=d[9],E=d[10],T=d[11],M=s*s*g+_,B=l*s*g+c*h,I=c*s*g-l*h,F=s*l*g-c*h,L=l*l*g+_,V=c*l*g+s*h,D=s*c*g+l*h,N=l*c*g-s*h,O=c*c*g+_;f[0]=y*M+A*B+C*I,f[1]=v*M+S*B+w*I,f[2]=p*M+x*B+E*I,f[3]=m*M+b*B+T*I,f[4]=y*F+A*L+C*V,f[5]=v*F+S*L+w*V,f[6]=p*F+x*L+E*V,f[7]=m*F+b*L+T*V,f[8]=y*D+A*N+C*O,f[9]=v*D+S*N+w*O,f[10]=p*D+x*N+E*O,f[11]=m*D+b*N+T*O,t!==o&&(f[12]=d[12],f[13]=d[13],f[14]=d[14],f[15]=d[15])}},r.scale=function(t,e,n){var o=t.elements,s=n.elements,l=e._x,c=e._y,u=e._z;s[0]=o[0]*l,s[1]=o[1]*l,s[2]=o[2]*l,s[3]=o[3]*l,s[4]=o[4]*c,s[5]=o[5]*c,s[6]=o[6]*c,s[7]=o[7]*c,s[8]=o[8]*u,s[9]=o[9]*u,s[10]=o[10]*u,s[11]=o[11]*u,s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15]},r.translate=function(t,e,n){var o=t.elements,s=n.elements,l=e._x,c=e._y,u=e._z;if(t===n)s[12]=o[0]*l+o[4]*c+o[8]*u+o[12],s[13]=o[1]*l+o[5]*c+o[9]*u+o[13],s[14]=o[2]*l+o[6]*c+o[10]*u+o[14],s[15]=o[3]*l+o[7]*c+o[11]*u+o[15];else{var d=o[0],f=o[1],h=o[2],_=o[3],g=o[4],y=o[5],v=o[6],p=o[7],m=o[8],A=o[9],S=o[10],x=o[11];s[0]=d,s[1]=f,s[2]=h,s[3]=_,s[4]=g,s[5]=y,s[6]=v,s[7]=p,s[8]=m,s[9]=A,s[10]=S,s[11]=x,s[12]=d*l+g*c+m*u+o[12],s[13]=f*l+y*c+A*u+o[13],s[14]=h*l+v*c+S*u+o[14],s[15]=_*l+p*c+x*u+o[15]}},r.transpose=function(t,e){var n=t.elements,o=e.elements;if(e===t){var s=n[1],l=n[2],c=n[3],u=n[6],d=n[7],f=n[11];o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=s,o[6]=n[9],o[7]=n[13],o[8]=l,o[9]=u,o[11]=n[14],o[12]=c,o[13]=d,o[14]=f}else o[0]=n[0],o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=n[1],o[5]=n[5],o[6]=n[9],o[7]=n[13],o[8]=n[2],o[9]=n[6],o[10]=n[10],o[11]=n[14],o[12]=n[3],o[13]=n[7],o[14]=n[11],o[15]=n[15]},r}();(function(){$._tempVec30=new P})();(function(){$._tempVec31=new P})();(function(){$._tempVec32=new P})();(function(){$._tempMat30=new Do})();(function(){$._identity=new $(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)})();var em=function(){function r(a,t){a===void 0&&(a=null),t===void 0&&(t=null),this.origin=new P,this.direction=new P,a&&this.origin.copyFrom(a),t&&this.direction.copyFrom(t)}var i=r.prototype;return i.intersectPlane=function(t){return wt.intersectsRayAndPlane(this,t)},i.intersectSphere=function(t){return wt.intersectsRayAndSphere(this,t)},i.intersectBox=function(t){return wt.intersectsRayAndBox(this,t)},i.getPoint=function(t,e){return P.scale(this.direction,t,e),e.add(this.origin)},r}(),te=function(){function r(a,t){a===void 0&&(a=0),t===void 0&&(t=0),this._onValueChanged=null,this._x=a,this._y=t}var i=r.prototype;return i.set=function(t,e){return this._x=t,this._y=e,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,n=t._y;return Math.sqrt(e*e+n*n)},i.lengthSquared=function(){var t=this,e=t._x,n=t._y;return e*e+n*n},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return r.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){return new r(this._x,this._y)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y},i.toJSON=function(){return{x:this._x,y:this._y}},r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._onValueChanged&&n._onValueChanged()},r.subtract=function(t,e,n){n._x=t._x-e._x,n._y=t._y-e._y,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){n._x=t._x*e._x,n._y=t._y*e._y,n._onValueChanged&&n._onValueChanged()},r.divide=function(t,e,n){n._x=t._x/e._x,n._y=t._y/e._y,n._onValueChanged&&n._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y},r.distance=function(t,e){var n=e._x-t._x,o=e._y-t._y;return Math.sqrt(n*n+o*o)},r.distanceSquared=function(t,e){var n=e._x-t._x,o=e._y-t._y;return n*n+o*o},r.equals=function(t,e){return U.equals(t._x,e._x)&&U.equals(t._y,e._y)},r.lerp=function(t,e,n,o){var s=t._x,l=t._y;o._x=s+(e._x-s)*n,o._y=l+(e._y-l)*n,o._onValueChanged&&o._onValueChanged()},r.max=function(t,e,n){n._x=Math.max(t._x,e._x),n._y=Math.max(t._y,e._y),n._onValueChanged&&n._onValueChanged()},r.min=function(t,e,n){n._x=Math.min(t._x,e._x),n._y=Math.min(t._y,e._y),n._onValueChanged&&n._onValueChanged()},r.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._onValueChanged&&e._onValueChanged()},r.normalize=function(t,e){var n=t._x,o=t._y,s=Math.sqrt(n*n+o*o);s>U.zeroTolerance&&(s=1/s,e._x=n*s,e._y=o*s,e._onValueChanged&&e._onValueChanged())},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._onValueChanged&&n._onValueChanged()},Wo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}}]),r}();(function(){te._zero=new te(0,0)})();(function(){te._one=new te(1,1)})();var ue=function(){function r(a,t,e,n){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),this._onValueChanged=null,this._x=a,this._y=t,this._z=e,this._w=n}var i=r.prototype;return i.set=function(t,e,n,o){return this._x=t,this._y=e,this._z=n,this._w=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this._onValueChanged&&this._onValueChanged(),this},i.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._w-=t._w,this._onValueChanged&&this._onValueChanged(),this},i.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._w*=t._w,this._onValueChanged&&this._onValueChanged(),this},i.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._w/=t._w,this._onValueChanged&&this._onValueChanged(),this},i.length=function(){var t=this,e=t._x,n=t._y,o=t._z,s=t._w;return Math.sqrt(e*e+n*n+o*o+s*s)},i.lengthSquared=function(){var t=this,e=t._x,n=t._y,o=t._z,s=t._w;return e*e+n*n+o*o+s*s},i.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onValueChanged&&this._onValueChanged(),this},i.normalize=function(){return r.normalize(this,this),this},i.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new r(this._x,this._y,this._z,this._w);return t},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},i.toJSON=function(){return{x:this._x,y:this._y,z:this._z,w:this._w}},r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._z=t._z+e._z,n._w=t._w+e._w,n._onValueChanged&&n._onValueChanged()},r.subtract=function(t,e,n){n._x=t._x-e._x,n._y=t._y-e._y,n._z=t._z-e._z,n._w=t._w-e._w,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){n._x=t._x*e._x,n._y=t._y*e._y,n._z=t._z*e._z,n._w=t._w*e._w,n._onValueChanged&&n._onValueChanged()},r.divide=function(t,e,n){n._x=t._x/e._x,n._y=t._y/e._y,n._z=t._z/e._z,n._w=t._w/e._w,n._onValueChanged&&n._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},r.distance=function(t,e){var n=e._x-t._x,o=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return Math.sqrt(n*n+o*o+s*s+l*l)},r.distanceSquared=function(t,e){var n=e._x-t._x,o=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return n*n+o*o+s*s+l*l},r.equals=function(t,e){return U.equals(t._x,e._x)&&U.equals(t._y,e._y)&&U.equals(t._z,e._z)&&U.equals(t._w,e._w)},r.lerp=function(t,e,n,o){var s=t._x,l=t._y,c=t._z,u=t._w;o._x=s+(e._x-s)*n,o._y=l+(e._y-l)*n,o._z=c+(e._z-c)*n,o._w=u+(e._w-u)*n,o._onValueChanged&&o._onValueChanged()},r.max=function(t,e,n){n._x=Math.max(t._x,e._x),n._y=Math.max(t._y,e._y),n._z=Math.max(t._z,e._z),n._w=Math.max(t._w,e._w),n._onValueChanged&&n._onValueChanged()},r.min=function(t,e,n){n._x=Math.min(t._x,e._x),n._y=Math.min(t._y,e._y),n._z=Math.min(t._z,e._z),n._w=Math.min(t._w,e._w),n._onValueChanged&&n._onValueChanged()},r.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=-t._w,e._onValueChanged&&e._onValueChanged()},r.normalize=function(t,e){var n=t._x,o=t._y,s=t._z,l=t._w,c=Math.sqrt(n*n+o*o+s*s+l*l);c>U.zeroTolerance&&(c=1/c,e._x=n*c,e._y=o*c,e._z=s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged())},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._z=t._z*e,n._w=t._w*e,n._onValueChanged&&n._onValueChanged()},r.transform=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=t._w,u=e.elements;n._x=o*u[0]+s*u[4]+l*u[8]+c*u[12],n._y=o*u[1]+s*u[5]+l*u[9]+c*u[13],n._z=o*u[2]+s*u[6]+l*u[10]+c*u[14],n._w=o*u[3]+s*u[7]+l*u[11]+c*u[15],n._onValueChanged&&n._onValueChanged()},r.transformByQuat=function(t,e,n){var o=t._x,s=t._y,l=t._z,c=t._w,u=e._x,d=e._y,f=e._z,h=e._w,_=h*o+d*l-f*s,g=h*s+f*o-u*l,y=h*l+u*s-d*o,v=-u*o-d*s-f*l;n._x=_*h-v*u-g*f+y*d,n._y=g*h-v*d-y*u+_*f,n._z=y*h-v*f-_*d+g*u,n._w=c,n._onValueChanged&&n._onValueChanged()},Wo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),r}();(function(){ue._zero=new ue(0,0,0,0)})();(function(){ue._one=new ue(1,1,1,1)})();var K=function(){function r(a,t,e,n){a===void 0&&(a=1),t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),this._onValueChanged=null,this._r=a,this._g=t,this._b=e,this._a=n}var i=r.prototype;return i.set=function(t,e,n,o){return this._r=t,this._g=e,this._b=n,this._a=o,this._onValueChanged&&this._onValueChanged(),this},i.add=function(t){return this._r+=t._r,this._g+=t._g,this._b+=t._b,this._a+=t._a,this._onValueChanged&&this._onValueChanged(),this},i.scale=function(t){return this._r*=t,this._g*=t,this._b*=t,this._a*=t,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){var t=new r(this._r,this._g,this._b,this._a);return t},i.copyFrom=function(t){return this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._onValueChanged&&this._onValueChanged(),this},i.copyFromArray=function(t,e){return e===void 0&&(e=0),this._r=t[e],this._g=t[e+1],this._b=t[e+2],this._a=t[e+3],this._onValueChanged&&this._onValueChanged(),this},i.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._r,t[e+1]=this._g,t[e+2]=this._b,t[e+3]=this._a},i.toLinear=function(t){return t._r=r.gammaToLinearSpace(this._r),t._g=r.gammaToLinearSpace(this._g),t._b=r.gammaToLinearSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.toGamma=function(t){return t._r=r.linearToGammaSpace(this._r),t._g=r.linearToGammaSpace(this._g),t._b=r.linearToGammaSpace(this._b),this._onValueChanged&&this._onValueChanged(),t},i.getBrightness=function(){var t=this.r,e=this.g,n=this.b,o=t,s=t;return e>o&&(o=e),n>o&&(o=n),e<s&&(s=e),n<s&&(s=n),(o+s)/2},i.toJSON=function(){return{r:this._r,g:this._g,b:this._b,a:this._a}},r.gammaToLinearSpace=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},r.linearToGammaSpace=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},r.equals=function(t,e){return U.equals(t._r,e._r)&&U.equals(t._g,e._g)&&U.equals(t._b,e._b)&&U.equals(t._a,e._a)},r.add=function(t,e,n){return n._r=t._r+e._r,n._g=t._g+e._g,n._b=t._b+e._b,n._a=t._a+e._a,n._onValueChanged&&n._onValueChanged(),n},r.subtract=function(t,e,n){n._r=t._r-e._r,n._g=t._g-e._g,n._b=t._b-e._b,n._a=t._a-e._a,n._onValueChanged&&n._onValueChanged()},r.scale=function(t,e,n){return n._r=t._r*e,n._g=t._g*e,n._b=t._b*e,n._a=t._a*e,n._onValueChanged&&n._onValueChanged(),n},r.lerp=function(t,e,n,o){var s=t._r,l=t._g,c=t._b,u=t._a;return o._r=s+(e._r-s)*n,o._g=l+(e._g-l)*n,o._b=c+(e._b-c)*n,o._a=u+(e._a-u)*n,o._onValueChanged&&o._onValueChanged(),o},Wo(r,[{key:"r",get:function(){return this._r},set:function(t){this._r=t,this._onValueChanged&&this._onValueChanged()}},{key:"g",get:function(){return this._g},set:function(t){this._g=t,this._onValueChanged&&this._onValueChanged()}},{key:"b",get:function(){return this._b},set:function(t){this._b=t,this._onValueChanged&&this._onValueChanged()}},{key:"a",get:function(){return this._a},set:function(t){this._a=t,this._onValueChanged&&this._onValueChanged()}}]),r}(),Mn=function(){function r(a,t,e,n){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),this._onValueChanged=null,this._x=a,this._y=t,this._width=e,this._height=n}var i=r.prototype;return i.set=function(t,e,n,o){return this._x=t,this._y=e,this._width=n,this._height=o,this._onValueChanged&&this._onValueChanged(),this},i.clone=function(){return new r(this.x,this.y,this.width,this.height)},i.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this._onValueChanged&&this._onValueChanged(),this},Wo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._onValueChanged&&this._onValueChanged()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._onValueChanged&&this._onValueChanged()}}]),r}(),p1=function(){function r(){this.coefficients=new Float32Array(27)}var i=r.prototype;return i.addLight=function(t,e,n){e.scale(n);var o=this.coefficients,s=t._x,l=t._y,c=t._z,u=e.r,d=e.g,f=e.b,h=.282095,_=-.488603*l,g=.488603*c,y=-.488603*s,v=1.092548*(s*l),p=-1.092548*(l*c),m=.315392*(3*c*c-1),A=-1.092548*(s*c),S=.546274*(s*s-l*l);o[0]+=u*h,o[1]+=d*h,o[2]+=f*h,o[3]+=u*_,o[4]+=d*_,o[5]+=f*_,o[6]+=u*g,o[7]+=d*g,o[8]+=f*g,o[9]+=u*y,o[10]+=d*y,o[11]+=f*y,o[12]+=u*v,o[13]+=d*v,o[14]+=f*v,o[15]+=u*p,o[16]+=d*p,o[17]+=f*p,o[18]+=u*m,o[19]+=d*m,o[20]+=f*m,o[21]+=u*A,o[22]+=d*A,o[23]+=f*A,o[24]+=u*S,o[25]+=d*S,o[26]+=f*S},i.evaluate=function(t,e){var n=this.coefficients,o=t._x,s=t._y,l=t._z,c=.886227,u=-1.023327*s,d=1.023327*l,f=-1.023327*o,h=.858086*s*o,_=-.858086*s*l,g=.247708*(3*l*l-1),y=-.858086*l*o,v=.429042*(o*o-s*s),p=n[0]*c,m=n[1]*c,A=n[2]*c;return p+=n[3]*u+n[6]*d+n[9]*f,m+=n[4]*u+n[7]*d+n[10]*f,A+=n[5]*u+n[8]*d+n[11]*f,p+=n[12]*h+n[15]*_+n[18]*g+n[21]*y+n[24]*v,m+=n[13]*h+n[16]*_+n[19]*g+n[22]*y+n[25]*v,A+=n[14]*h+n[17]*_+n[20]*g+n[23]*y+n[26]*v,e.set(p,m,A,1),e},i.scale=function(t){var e=this.coefficients;e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,e[16]*=t,e[17]*=t,e[18]*=t,e[19]*=t,e[20]*=t,e[21]*=t,e[22]*=t,e[23]*=t,e[24]*=t,e[25]*=t,e[26]*=t},i.clone=function(){var t=new r;return t.copyFrom(this),t},i.copyFrom=function(t){return t.copyToArray(this.coefficients),this},i.copyFromArray=function(t,e){e===void 0&&(e=0);var n=this.coefficients;n[0]=t[e],n[1]=t[1+e],n[2]=t[2+e],n[3]=t[3+e],n[4]=t[4+e],n[5]=t[5+e],n[6]=t[6+e],n[7]=t[7+e],n[8]=t[8+e],n[9]=t[9+e],n[10]=t[10+e],n[11]=t[11+e],n[12]=t[12+e],n[13]=t[13+e],n[14]=t[14+e],n[15]=t[15+e],n[16]=t[16+e],n[17]=t[17+e],n[18]=t[18+e],n[19]=t[19+e],n[20]=t[20+e],n[21]=t[21+e],n[22]=t[22+e],n[23]=t[23+e],n[24]=t[24+e],n[25]=t[25+e],n[26]=t[26+e]},i.copyToArray=function(t,e){e===void 0&&(e=0);var n=this.coefficients;t[0+e]=n[0],t[1+e]=n[1],t[2+e]=n[2],t[3+e]=n[3],t[4+e]=n[4],t[5+e]=n[5],t[6+e]=n[6],t[7+e]=n[7],t[8+e]=n[8],t[9+e]=n[9],t[10+e]=n[10],t[11+e]=n[11],t[12+e]=n[12],t[13+e]=n[13],t[14+e]=n[14],t[15+e]=n[15],t[16+e]=n[16],t[17+e]=n[17],t[18+e]=n[18],t[19+e]=n[19],t[20+e]=n[20],t[21+e]=n[21],t[22+e]=n[22],t[23+e]=n[23],t[24+e]=n[24],t[25+e]=n[25],t[26+e]=n[26]},r}(),un=function(){function r(a,t){this.reset(a,t)}var i=r.prototype;return i.randomInt32=function(){var t=this._state0,e=this._state1;return this._state0=e,t^=t<<23,t^=t>>>17,t^=e^e>>>26,this._state1=t,this._state0+this._state1>>>0},i.random=function(){return this.randomInt32()/4294967295},i.reset=function(t,e){this._state0=t>>>0,this._state1=e>>>0},r}(),dr;(function(r){r[r.Android=0]="Android",r[r.IPhone=1]="IPhone",r[r.IPad=2]="IPad",r[r.Mac=3]="Mac",r[r.Unknown=4]="Unknown"})(dr||(dr={}));function he(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function ap(r,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function q(r,i,a){return i&&ap(r.prototype,i),a&&ap(r,a),r}function df(r,i){return df=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},df(r,i)}function W(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(i&&i.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),i&&df(r,i)}var Tt;(function(r){r[r.None=0]="None",r[r.VisibleInsideMask=1]="VisibleInsideMask",r[r.VisibleOutsideMask=2]="VisibleOutsideMask"})(Tt||(Tt={}));var Lo;(function(r){r[r.Layer0=1]="Layer0",r[r.Layer1=2]="Layer1",r[r.Layer2=4]="Layer2",r[r.Layer3=8]="Layer3",r[r.Layer4=16]="Layer4",r[r.Layer5=32]="Layer5",r[r.Layer6=64]="Layer6",r[r.Layer7=128]="Layer7",r[r.Layer8=256]="Layer8",r[r.Layer9=512]="Layer9",r[r.Layer10=1024]="Layer10",r[r.Layer11=2048]="Layer11",r[r.Layer12=4096]="Layer12",r[r.Layer13=8192]="Layer13",r[r.Layer14=16384]="Layer14",r[r.Layer15=32768]="Layer15",r[r.Layer16=65536]="Layer16",r[r.Layer17=131072]="Layer17",r[r.Layer18=262144]="Layer18",r[r.Layer19=524288]="Layer19",r[r.Layer20=1048576]="Layer20",r[r.Layer21=2097152]="Layer21",r[r.Layer22=4194304]="Layer22",r[r.Layer23=8388608]="Layer23",r[r.Layer24=16777216]="Layer24",r[r.Layer25=33554432]="Layer25",r[r.Layer26=67108864]="Layer26",r[r.Layer27=134217728]="Layer27",r[r.Layer28=268435456]="Layer28",r[r.Layer29=536870912]="Layer29",r[r.Layer30=1073741824]="Layer30",r[r.Layer31=2147483648]="Layer31",r[r.Everything=4294967295]="Everything"})(Lo||(Lo={}));var wa;(function(r){r[r.Left=0]="Left",r[r.Center=1]="Center",r[r.Right=2]="Right"})(wa||(wa={}));var Ta;(function(r){r[r.Top=0]="Top",r[r.Center=1]="Center",r[r.Bottom=2]="Bottom"})(Ta||(Ta={}));var ka;(function(r){r[r.Overflow=0]="Overflow",r[r.Truncate=1]="Truncate"})(ka||(ka={}));var ji;(function(r){r[r.None=0]="None",r[r.Bold=1]="Bold",r[r.Italic=2]="Italic"})(ji||(ji={}));function R(r,i,a,t){var e=arguments.length,n=e<3?i:t===null?t=Object.getOwnPropertyDescriptor(i,a):t,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,i,a,t);else for(var s=r.length-1;s>=0;s--)(o=r[s])&&(n=(e<3?o(n):e>3?o(i,a,n):o(i,a))||n);return e>3&&n&&Object.defineProperty(i,a,n),n}function mt(r,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](r):r instanceof i}var mi;(function(r){r[r.Ignore=0]="Ignore",r[r.Assignment=1]="Assignment",r[r.Shallow=2]="Shallow",r[r.Deep=3]="Deep"})(mi||(mi={}));function z(r,i){mn.registerCloneMode(r,i,mi.Ignore)}function Ie(r,i){mn.registerCloneMode(r,i,mi.Assignment)}function Ph(r,i){mn.registerCloneMode(r,i,mi.Shallow)}function Z(r,i){mn.registerCloneMode(r,i,mi.Deep)}var mn=function(){function r(){}return r.registerCloneMode=function(a,t,e){var n=r._subCloneModeMap.get(a.constructor);n||(n=Object.create(null),r._subCloneModeMap.set(a.constructor,n)),n[t]=e},r.getCloneMode=function(a){var t=r._cloneModeMap.get(a);if(!t){t=Object.create(null),r._cloneModeMap.set(a,t);for(var e=r._objectType,n=r._subCloneModeMap;a!==e;){var o=n.get(a);o&&Object.assign(t,o),a=Object.getPrototypeOf(a)}}return t},r.cloneProperty=function(a,t,e,n){if(n!==mi.Ignore){var o=a[e];if(mt(o,Object)){if(n===void 0||n===mi.Assignment){t[e]=o;return}var s=o.constructor;switch(s){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var l=t[e];l==null||l.length!==o.length?t[e]=o.slice():l.set(o);break;case Array:var c=t[e],u=o.length;c==null?t[e]=c=new Array(u):c.length=u;for(var d=0;d<u;d++)r.cloneProperty(o,c,d,n);break;default:var f,h,_=(f=t)[h=e]||(f[h]=new o.constructor),g=r.getCloneMode(o.constructor);for(var y in o)r.cloneProperty(o,_,y,g[y]);o._cloneTo&&o._cloneTo(_),o.copyFrom&&_.copyFrom(o);break}}else t[e]=o}},r.deepCloneObject=function(a,t){for(var e in a)r.cloneProperty(a,t,e,mi.Deep)},r}();(function(){mn._subCloneModeMap=new Map})();(function(){mn._cloneModeMap=new Map})();(function(){mn._objectType=Object.getPrototypeOf(Object)})();var ri=function(){function r(a){this.instanceId=++r._instanceIdCounter,this._destroyed=!1,this._engine=a}var i=r.prototype;return i.destroy=function(){this._destroyed||(this._onDestroy(),this._destroyed=!0)},i._onDestroy=function(){var t=this._engine.resourceManager;t._deleteAsset(this),t._deleteContentRestorer(this)},q(r,[{key:"engine",get:function(){return this._engine}},{key:"destroyed",get:function(){return this._destroyed}}]),r}();(function(){ri._instanceIdCounter=0})();R([z],ri.prototype,"instanceId",void 0);R([z],ri.prototype,"_engine",void 0);var ni=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e.isGCIgnored=!1,e._refCount=0,e._superResources=null,t.resourceManager._addReferResource(he(e)),e}var a=i.prototype;return a.destroy=function(e,n){if(e===void 0&&(e=!1),!e){var o;if(this._refCount!==0)return!1;var s=this._superResources;if((o=s)!=null&&o.length)if(n){for(var l=0,c=s.length;l<c;l++)if(s[l].refCount>0)return!1}else return!1}return r.prototype.destroy.call(this),!0},a._associationSuperResource=function(e){(this._superResources||(this._superResources=[])).push(e)},a._disassociationSuperResource=function(e){var n=this._superResources,o=n.indexOf(e);n.splice(o,1)},a._getReferCount=function(){return this._refCount},a._addReferCount=function(e){this._refCount+=e},a._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._engine.resourceManager._deleteReferResource(this);var e=this._getReferCount();e>0&&this._addReferCount(-e)},q(i,[{key:"refCount",get:function(){return this._refCount}}]),i}(ri),tm=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._sprites=new Array,e._spriteNamesToIndex={},e}var a=i.prototype;return a.getSprite=function(e){var n=this._sprites[this._spriteNamesToIndex[e]];return n||console.warn("There is no sprite named "+e+" in the atlas."),n},a.getSprites=function(e,n){n.length=0;var o=this._spriteNamesToIndex[e];if(o!==void 0)for(var s=this._sprites;o>=0;o--){var l=s[o];l.name===e&&n.push(l)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return n},a._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1,e._atlas=this,e.isGCIgnored=!0},a._onDestroy=function(){r.prototype._onDestroy.call(this);for(var e=this,n=e._sprites,o=0,s=n.length;o<s;o++)n[o].destroy();n.length=0,this._sprites=null,this._spriteNamesToIndex=null},q(i,[{key:"sprites",get:function(){return this._sprites}}]),i}(ni),nn;(function(r){r[r.Simple=0]="Simple",r[r.Sliced=1]="Sliced",r[r.Tiled=2]="Tiled"})(nn||(nn={}));var Ws;(function(r){r[r.Continuous=0]="Continuous",r[r.Adaptive=1]="Adaptive"})(Ws||(Ws={}));var Ye=function(){function r(){}return r.removeFromArray=function(a,t){var e=a.indexOf(t);if(e<0)return!1;var n=a.length-1;if(e!==n){var o=a[n];a[e]=o}return a.length--,!0},r.decodeText=function(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);for(var t="",e=0,n=a.length;e<n;e++)t+=String.fromCharCode(a[e]);return decodeURIComponent(encodeURIComponent(t))},r.isAbsoluteUrl=function(a){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(a)},r.isBase64Url=function(a){return/^data:.*,.*$/i.test(a)},r.objectValues=function(a){return Object.keys(a).map(function(t){return a[t]})},r.resolveAbsoluteUrl=function(a,t){return r.isAbsoluteUrl(t)||r.isBase64Url(t)?t:t?a.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):a},r._floatMatrixMultiply=function(a,t,e,n,o){var s=a.elements,l=s[0],c=s[1],u=s[2],d=s[3],f=s[4],h=s[5],_=s[6],g=s[7],y=s[8],v=s[9],p=s[10],m=s[11],A=s[12],S=s[13],x=s[14],b=s[15],C=t[e],w=t[e+1],E=t[e+2],T=t[e+3],M=t[e+4],B=t[e+5],I=t[e+6],F=t[e+7],L=t[e+8],V=t[e+9],D=t[e+10],N=t[e+11],O=t[e+12],G=t[e+13],Q=t[e+14],H=t[e+15];n[o]=l*C+f*w+y*E+A*T,n[o+1]=c*C+h*w+v*E+S*T,n[o+2]=u*C+_*w+p*E+x*T,n[o+3]=d*C+g*w+m*E+b*T,n[o+4]=l*M+f*B+y*I+A*F,n[o+5]=c*M+h*B+v*I+S*F,n[o+6]=u*M+_*B+p*I+x*F,n[o+7]=d*M+g*B+m*I+b*F,n[o+8]=l*L+f*V+y*D+A*N,n[o+9]=c*L+h*V+v*D+S*N,n[o+10]=u*L+_*V+p*D+x*N,n[o+11]=d*L+g*V+m*D+b*N,n[o+12]=l*O+f*G+y*Q+A*H,n[o+13]=c*O+h*G+v*Q+S*H,n[o+14]=u*O+_*G+p*Q+x*H,n[o+15]=d*O+g*G+m*Q+b*H},r._reflectGet=function(a,t){for(var e=this._stringToPath(t),n=a,o=0,s=e.length;n!=null&&o<s;)n=n[e[o++]];return o&&o==s?n:void 0},r._quickSort=function(a,t,e,n){for(;;){if(e-t<=10){this._insertionSort(a,t,e,n);return}var o=t+e>>1,s=a[t],l=a[e-1],c=a[o],u=n(s,l);if(u>0){var d=s;s=l,l=d}var f=n(s,c);if(f>=0){var h=s;s=c,c=l,l=h}else{var _=n(l,c);if(_>0){var g=l;l=c,c=g}}a[t]=s,a[e-1]=c;var y=l,v=t+1,p=e-1;a[o]=a[v],a[v]=y;e:for(var m=v+1;m<p;m++){var A=a[m],S=n(A,y);if(S<0)a[m]=a[v],a[v]=A,v++;else if(S>0){do{if(p--,p==m)break e;var x=a[p];S=n(x,y)}while(S>0);a[m]=a[p],a[p]=A,S<0&&(A=a[m],a[m]=a[v],a[v]=A,v++)}}e-p<v-t?(this._quickSort(a,p,e,n),e=v):(this._quickSort(a,t,v,n),t=p)}},r._stringToPath=function(a){var t=[];return a.charCodeAt(0)===v1&&t.push(""),a.replace(m1,function(e,n,o,s){var l=e;o?l=s.replace(g1,"$1"):n&&(l=n.trim()),t.push(l)}),t},r._formatRelativePath=function(a){return a.split("/").filter(Boolean).reduce(function(t,e){return e===".."?t.pop():e!=="."&&t.push(e),t},[]).join("/")},r._insertionSort=function(a,t,e,n){for(var o=t+1;o<e;o++){var s=void 0,l=a[o];for(s=o-1;s>=t;s--){var c=a[s],u=n(c,l);if(u>0)a[s+1]=c;else break}a[s+1]=l}},r}(),v1=46,g1=/\\(\\)?/g,m1=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),On=function(){function r(){this._updateFlags=[],this._listeners=[]}var i=r.prototype;return i.createFlag=function(t){var e=new t;return this.addFlag(e),e},i.addFlag=function(t){this._updateFlags.push(t),t._flagManagers.push(this)},i.removeFlag=function(t){var e=Ye.removeFromArray(this._updateFlags,t);e&&Ye.removeFromArray(t._flagManagers,this)},i.addListener=function(t){this._listeners.push(t)},i.removeListener=function(t){Ye.removeFromArray(this._listeners,t)},i.dispatch=function(t,e){for(var n=this._updateFlags,o=n.length-1;o>=0;o--)n[o].dispatch(t,e);for(var s=this._listeners,l=s.length-1;l>=0;l--)s[l](t,e)},r}(),Be;(function(r){r[r.texture=1]="texture",r[r.size=2]="size",r[r.atlasRotate=4]="atlasRotate",r[r.atlasRegion=8]="atlasRegion",r[r.atlasRegionOffset=16]="atlasRegionOffset",r[r.region=32]="region",r[r.pivot=64]="pivot",r[r.border=128]="border",r[r.destroy=256]="destroy"})(Be||(Be={}));var Rn=function(r){W(i,r);function i(t,e,n,o,s,l){e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),s===void 0&&(s=null),l===void 0&&(l=null);var c;return c=r.call(this,t)||this,c._automaticWidth=0,c._automaticHeight=0,c._customWidth=void 0,c._customHeight=void 0,c._positions=[new te,new te,new te,new te],c._uvs=[new te,new te,new te,new te],c._bounds=new qt,c._texture=null,c._atlasRotated=!1,c._atlasRegion=new Mn(0,0,1,1),c._atlasRegionOffset=new ue(0,0,0,0),c._region=new Mn(0,0,1,1),c._pivot=new te(.5,.5),c._border=new ue(0,0,0,0),c._dirtyUpdateFlag=7,c._updateFlagManager=new On,c._texture=e,c._onRegionChange=c._onRegionChange.bind(he(c)),c._onPivotChange=c._onPivotChange.bind(he(c)),c._onBorderChange=c._onBorderChange.bind(he(c)),c._region._onValueChanged=c._onRegionChange,c._pivot._onValueChanged=c._onPivotChange,c._border._onValueChanged=c._onBorderChange,n&&c._region.copyFrom(n),o&&c._pivot.copyFrom(o),s&&c._border.copyFrom(s),c.name=l,c}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this._texture,this._region,this._pivot,this._border,this.name);return e._atlasRotated=this._atlasRotated,e._atlasRegion.copyFrom(this._atlasRegion),e._atlasRegionOffset.copyFrom(this._atlasRegionOffset),e},a._getPositions=function(){return this._dirtyUpdateFlag&1&&this._updatePositions(),this._positions},a._getUVs=function(){return this._dirtyUpdateFlag&2&&this._updateUVs(),this._uvs},a._getBounds=function(){return this._dirtyUpdateFlag&1&&this._updatePositions(),this._bounds},a._addReferCount=function(e){var n;r.prototype._addReferCount.call(this,e),(n=this._atlas)==null||n._addReferCount(e)},a._onDestroy=function(){this._dispatchSpriteChange(Be.destroy),r.prototype._onDestroy.call(this),this._positions.length=0,this._positions=null,this._uvs.length=0,this._uvs=null,this._atlasRegion=null,this._atlasRegionOffset=null,this._region=null,this._pivot=null,this._border=null,this._bounds=null,this._atlas=null,this._texture=null,this._updateFlagManager=null},a._calDefaultSize=function(){if(this._texture){var e=this,n=e._texture,o=e._atlasRegion,s=e._atlasRegionOffset,l=e._region,c=1/ei._pixelsPerUnit;this._automaticWidth=n.width*o.width/(1-s.x-s.z)*l.width*c,this._automaticHeight=n.height*o.height/(1-s.y-s.w)*l.height*c}else this._automaticWidth=this._automaticHeight=0;this._dirtyUpdateFlag&=-5},a._updatePositions=function(){var e=this._atlasRegionOffset,n=this._region,o=n.x,s=n.y,l=n.width,c=n.height,u=1-o-l,d=1-s-c,f=Math.max(e.x-o,0)/l,h=Math.max(e.w-s,0)/c,_=1-Math.max(e.z-u,0)/l,g=1-Math.max(e.y-d,0)/c,y=this._positions;y[0].set(f,h),y[1].set(_,h),y[2].set(f,g),y[3].set(_,g);var v=this._bounds,p=v.min,m=v.max;p.set(f,h,0),m.set(_,g,0),this._dirtyUpdateFlag&=-2},a._updateUVs=function(){var e=this,n=e._uvs,o=e._atlasRegionOffset,s=this._region,l=s.x,c=s.y,u=s.width,d=s.height,f=1-l-u,h=1-c-d,_=this._atlasRegion,g=_.x,y=_.y,v=_.width,p=_.height,m=o.x,A=o.y,S=o.z,x=o.w,b=v/(1-m-S),C=p/(1-A-x),w=Math.max(l-m,0)*b+g,E=Math.max(h-A,0)*C+y,T=v+g-Math.max(f-S,0)*b,M=p+y-Math.max(c-x,0)*C,B=this._border,I=B.x,F=B.y,L=B.z,V=B.w;n[0].set(w,M),n[1].set((l-m+I*u)*b+g,p+y-(c-x+F*d)*C),n[2].set(v+g-(f-S+L*u)*b,(h-A+V*d)*C+y),n[3].set(T,E),this._dirtyUpdateFlag&=-3},a._dispatchSpriteChange=function(e){switch(e){case Be.texture:this._dirtyUpdateFlag|=4;break;case Be.atlasRegionOffset:case Be.region:this._dirtyUpdateFlag|=7;break;case Be.atlasRegion:this._dirtyUpdateFlag|=6;break;case Be.border:this._dirtyUpdateFlag|=2;break}this._updateFlagManager.dispatch(e)},a._onRegionChange=function(){var e=this,n=e._region;n._onValueChanged=null;var o=U.clamp(n.x,0,1),s=U.clamp(n.y,0,1);n.set(o,s,U.clamp(n.width,0,1-o),U.clamp(n.height,0,1-s)),this._dispatchSpriteChange(Be.region),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size),n._onValueChanged=this._onRegionChange},a._onPivotChange=function(){this._dispatchSpriteChange(Be.pivot)},a._onBorderChange=function(){var e=this,n=e._border;n._onValueChanged=null;var o=U.clamp(n.x,0,1),s=U.clamp(n.y,0,1);n.set(o,s,U.clamp(n.z,0,1-o),U.clamp(n.w,0,1-s)),this._dispatchSpriteChange(Be.border),n._onValueChanged=this._onBorderChange},q(i,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._dispatchSpriteChange(Be.texture),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size))}},{key:"width",get:function(){return this._customWidth!==void 0?this._customWidth:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticWidth)},set:function(e){this._customWidth!==e&&(this._customWidth=e,this._dispatchSpriteChange(Be.size))}},{key:"height",get:function(){return this._customHeight!==void 0?this._customHeight:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticHeight)},set:function(e){this._customHeight!==e&&(this._customHeight=e,this._dispatchSpriteChange(Be.size))}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e)}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var n=U.clamp(e.x,0,1),o=U.clamp(e.y,0,1);this._atlasRegion.set(n,o,U.clamp(e.width,0,1-n),U.clamp(e.height,0,1-o)),this._dispatchSpriteChange(Be.atlasRegion),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var n=U.clamp(e.x,0,1),o=U.clamp(e.y,0,1);this._atlasRegionOffset.set(n,o,U.clamp(e.z,0,1-n),U.clamp(e.w,0,1-o)),this._dispatchSpriteChange(Be.atlasRegionOffset),(this._customWidth===void 0||this._customHeight===void 0)&&this._dispatchSpriteChange(Be.size)}},{key:"region",get:function(){return this._region},set:function(e){this._region!==e&&this._region.copyFrom(e)}},{key:"pivot",get:function(){return this._pivot},set:function(e){this._pivot!==e&&this._pivot.copyFrom(e)}},{key:"border",get:function(){return this._border},set:function(e){this._border!==e&&this._border.copyFrom(e)}}]),i}(ni),op;(function(r){r[r.positions=1]="positions",r[r.uvs=2]="uvs",r[r.automaticSize=4]="automaticSize",r[r.all=7]="all"})(op||(op={}));var Mh=function(){function r(){this._events=Object.create(null),this._eventCount=0}var i=r.prototype;return i.hasEvent=function(t){return this._events[t]!=null},i.eventNames=function(){return this._eventCount===0?[]:Object.keys(this._events)},i.listenerCount=function(t){var e=this._events[t];return e?Array.isArray(e)?e.length:1:0},i.dispatch=function(t,e){if(!this._events[t])return!1;var n=this._events[t];if(Array.isArray(n)){var o=n.length,s=r._dispatchingListenersPool,l=s.length>0?s.pop():[];l.length=o;for(var c=0;c<o;c++)l[c]=n[c];for(var u=0;u<o;u++){var d=l[u];d.destroyed||(d.once&&this.off(t,d.fn),d.fn(e))}l.length=0,s.push(l)}else n.once&&this.off(t,n.fn),n.fn(e);return!0},i.on=function(t,e){return this._addEventListener(t,e)},i.once=function(t,e){return this._addEventListener(t,e,!0)},i.off=function(t,e){if(!this._events[t])return this;if(!e)return this._clearEvent(t),this;var n=this._events[t],o=Array.isArray(n);if(!o&&n.fn===e)this._clearEvent(t);else if(o){for(var s=n.length-1;s>=0;s--)n[s].fn===e&&(n[s].destroyed=!0,n.splice(s,1));n.length===0?this._clearEvent(t):n.length===1&&(this._events[t]=n[0])}return this},i.removeEventListener=function(t,e){return this.off(t,e)},i.removeAllEventListeners=function(t){t?this._events[t]&&this._clearEvent(t):(this._events=Object.create(null),this._eventCount=0)},i._addEventListener=function(t,e,n){var o={fn:e,once:n},s=this._events,l=s[t];return l?Array.isArray(l)?l.push(o):s[t]=[l,o]:(s[t]=o,this._eventCount++),this},i._clearEvent=function(t){--this._eventCount===0?this._events=Object.create(null):delete this._events[t]},r}();(function(){Mh._dispatchingListenersPool=[]})();var Fi=function(r){for(var i=arguments.length,a=new Array(i>1?i-1:0),t=1;t<i;t++)a[t-1]=arguments[t]},y1=console.log.bind(console),A1=console.info.bind(console),x1=console.warn.bind(console),S1=console.error.bind(console),me={debug:Fi,info:Fi,warn:Fi,error:Fi,isEnabled:!1,enable:function(){this.debug=y1,this.info=A1,this.warn=x1,this.error=S1,this.isEnabled=!0},disable:function(){this.debug=Fi,this.info=Fi,this.warn=Fi,this.error=Fi,this.isEnabled=!1}},k=function(){function r(i){this.name=i,this._uniqueId=r._propertyNameCounter++}return r.getByName=function(a){var t=r._propertyNameMap;if(t[a]!=null)return t[a];var e=new r(a);return t[a]=e,r._propertyIdMap[e._uniqueId]=e,e},r._getShaderPropertyGroup=function(a){var t,e=r._propertyNameMap[a];return(t=e)==null?void 0:t._group},q(r,[{key:"type",get:function(){return this._type}}]),r}();(function(){k._propertyIdMap=Object.create(null)})();(function(){k._propertyNameCounter=0})();(function(){k._propertyNameMap=Object.create(null)})();var Cu=function(){function r(){this._frameCount=0,this._deltaTime=0,this._actualDeltaTime=0,this._elapsedTime=0,this._actualElapsedTime=0,this._elapsedTimeValue=new ue,this._deltaTimeValue=new ue,this.maximumDeltaTime=.333333,this.timeScale=1,this._lastSystemTime=performance.now()/1e3}var i=r.prototype;return i._reset=function(){this._lastSystemTime=performance.now()/1e3},i._update=function(){var t=performance.now()/1e3,e=t-this._lastSystemTime;this._actualDeltaTime=e,this._actualElapsedTime+=e;var n=Math.min(e,this.maximumDeltaTime)*this.timeScale;this._deltaTime=n,this._elapsedTime+=n,this._frameCount++,this._lastSystemTime=t},i._updateSceneShaderData=function(t){var e=this,n=e._elapsedTimeValue,o=e._deltaTimeValue,s=this._elapsedTime;n.set(s,Math.sin(s),Math.cos(s),0),t.setVector4(r._elapsedTimeProperty,n),o.set(this._deltaTime,0,0,0),t.setVector4(r._deltaTimeProperty,o)},q(r,[{key:"frameCount",get:function(){return this._frameCount}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"elapsedTime",get:function(){return this._elapsedTime}},{key:"actualDeltaTime",get:function(){return this._actualDeltaTime}},{key:"actualElapsedTime",get:function(){return this._actualElapsedTime}}]),r}();(function(){Cu._elapsedTimeProperty=k.getByName("scene_ElapsedTime")})();(function(){Cu._deltaTimeProperty=k.getByName("scene_DeltaTime")})();var We;(function(r){r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT=5124]="INT",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.FLOAT_ARRAY=35677]="FLOAT_ARRAY",r[r.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",r[r.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",r[r.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",r[r.INT_ARRAY=100003]="INT_ARRAY",r[r.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",r[r.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",r[r.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",r[r.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",r[r.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",r[r.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",r[r.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",r[r.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT"})(We||(We={}));var J;(function(r){r.shaderVertexID="shaderVertexID",r.standardDerivatives="OES_standard_derivatives",r.shaderTextureLod="EXT_shader_texture_lod",r.elementIndexUint="OES_element_index_uint",r.depthTexture="WEBGL_depth_texture",r.drawBuffers="WEBGL_draw_buffers",r.vertexArrayObject="OES_vertex_array_object",r.instancedArrays="ANGLE_instanced_arrays",r.multipleSample="multipleSampleOnlySupportedInWebGL2",r.textureFloat="OES_texture_float",r.textureFloatLinear="OES_texture_float_linear",r.textureHalfFloat="OES_texture_half_float",r.textureHalfFloatLinear="OES_texture_half_float_linear",r.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",r.colorBufferFloat="EXT_color_buffer_float",r.colorBufferHalfFloat="EXT_color_buffer_half_float",r.textureFilterAnisotropic="EXT_texture_filter_anisotropic",r.blendMinMax="EXT_blend_minmax",r.astc="WEBGL_compressed_texture_astc",r.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",r.etc="WEBGL_compressed_texture_etc",r.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",r.etc1="WEBGL_compressed_texture_etc1",r.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",r.pvrtc="WEBGL_compressed_texture_pvrtc",r.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",r.s3tc="WEBGL_compressed_texture_s3tc",r.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc",r.bptc="EXT_texture_compression_bptc",r.WEBGL_lose_context="WEBGL_lose_context"})(J||(J={}));var _e;(function(r){r[r.None=0]="None",r[r.Scene=1]="Scene",r[r.Hierarchy=2]="Hierarchy",r[r.All=3]="All"})(_e||(_e={}));var ir=function(r){W(i,r);function i(t){var e;return e=r.call(this,t.engine)||this,e._awoken=!1,e._phasedActiveInScene=!1,e._phasedActive=!1,e._enabled=!0,e._entity=t,e}var a=i.prototype;return a._onAwake=function(){},a._onEnable=function(){},a._onDisable=function(){},a._onEnableInScene=function(){},a._onDisableInScene=function(){},a._setActive=function(e,n){var o=this._entity;n&_e.Scene&&(e?!this._phasedActiveInScene&&o._isActiveInScene&&this._enabled&&(this._phasedActiveInScene=!0,this._onEnableInScene()):this._phasedActiveInScene&&!(o._isActiveInScene&&this._enabled)&&(this._phasedActiveInScene=!1,this._onDisableInScene())),n&_e.Hierarchy&&(e?(!this._awoken&&o._isActiveInHierarchy&&(this._awoken=!0,this._onAwake()),!this._phasedActive&&o._isActiveInHierarchy&&this._enabled&&(this._phasedActive=!0,this._onEnable())):this._phasedActive&&!(o._isActiveInHierarchy&&this._enabled)&&(this._phasedActive=!1,this._onDisable()))},a._addResourceReferCount=function(e,n){this._entity._isTemplate||e._addReferCount(n)},a._onDestroy=function(){r.prototype._onDestroy.call(this);var e=this._entity;e._removeComponent(this),this._enabled&&(e._isActiveInScene&&this._onDisableInScene(),e._isActiveInHierarchy&&this._onDisable())},q(i,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,this._entity._isActiveInScene&&(e?this._phasedActiveInScene||(this._phasedActiveInScene=!0,this._onEnableInScene()):this._phasedActiveInScene&&(this._phasedActiveInScene=!1,this._onDisableInScene())),this._entity.isActiveInHierarchy&&(e?this._phasedActive||(this._phasedActive=!0,this._onEnable()):this._phasedActive&&(this._phasedActive=!1,this._onDisable())))}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),i}(ri);R([z],ir.prototype,"_entity",void 0);R([z],ir.prototype,"_awoken",void 0);R([z],ir.prototype,"_phasedActiveInScene",void 0);R([z],ir.prototype,"_phasedActive",void 0);R([Ie],ir.prototype,"_enabled",void 0);var Io=function(){function r(){}return r._addCheck=function(a,t){for(;t!==ir;){var e=r._dependenciesMap.get(t);if(e)for(var n=e.components,o=e.mode,s=0,l=n.length;s<l;s++){var c=n[s];if(!a.getComponent(c))if(o===1)a.addComponent(c);else throw"Should add "+c.name+" before adding "+t.name}t=Object.getPrototypeOf(t)}},r._removeCheck=function(a,t){for(;t!==ir;){var e=r._invDependenciesMap.get(t);if(e){for(var n=0,o=e.length;n<o;n++)if(a.getComponent(e[n]))throw"Should remove "+e[n].name+" before adding "+t.name}t=Object.getPrototypeOf(t)}},r._addDependency=function(a,t,e){var n=e.get(a);n?n.includes(t)||n.push(t):e.set(a,[t])},r._addInvDependency=function(a,t){var e=this._invDependenciesMap,n=e.get(a);n?n.includes(t)||n.push(t):e.set(a,[t])},r}();(function(){Io._invDependenciesMap=new Map})();(function(){Io._dependenciesMap=new Map})();function sl(r,i){i===void 0&&(i=0);var a=Array.isArray(r)?r:[r];return function(t){Io._dependenciesMap.set(t,{mode:i,components:a}),a.forEach(function(e){return Io._addInvDependency(e,t)})}}var Ua;(function(r){r[r.CheckOnly=0]="CheckOnly",r[r.AutoAdd=1]="AutoAdd"})(Ua||(Ua={}));var C1=function(){function r(){this._flagManagers=[]}var i=r.prototype;return i.clearFromManagers=function(){this._removeFromManagers(),this._flagManagers.length=0},i.destroy=function(){this._removeFromManagers(),this._flagManagers=null},i._removeFromManagers=function(){for(var t=this._flagManagers,e=0,n=t.length;e<n;e++)Ye.removeFromArray(t[e]._updateFlags,this)},r}(),bu=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.flag=!0,t}var a=i.prototype;return a.dispatch=function(){this.flag=!0},i}(C1),ye=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._position=new P,e._rotation=new P,e._rotationQuaternion=new xe,e._scale=new P(1,1,1),e._worldPosition=new P,e._worldRotation=new P,e._worldRotationQuaternion=new xe,e._lossyWorldScale=new P(1,1,1),e._localMatrix=new $,e._worldMatrix=new $,e._worldForward=null,e._worldRight=null,e._worldUp=null,e._isParentDirty=!0,e._parentTransformCache=null,e._dirtyFlag=188,e._updateFlagManager=new On,e._onPositionChanged=e._onPositionChanged.bind(he(e)),e._onWorldPositionChanged=e._onWorldPositionChanged.bind(he(e)),e._onRotationChanged=e._onRotationChanged.bind(he(e)),e._onWorldRotationChanged=e._onWorldRotationChanged.bind(he(e)),e._onRotationQuaternionChanged=e._onRotationQuaternionChanged.bind(he(e)),e._onWorldRotationQuaternionChanged=e._onWorldRotationQuaternionChanged.bind(he(e)),e._onScaleChanged=e._onScaleChanged.bind(he(e)),e._position._onValueChanged=e._onPositionChanged,e._worldPosition._onValueChanged=e._onWorldPositionChanged,e._rotation._onValueChanged=e._onRotationChanged,e._worldRotation._onValueChanged=e._onWorldRotationChanged,e._rotationQuaternion._onValueChanged=e._onRotationQuaternionChanged,e._worldRotationQuaternion._onValueChanged=e._onWorldRotationQuaternionChanged,e._scale._onValueChanged=e._onScaleChanged,e}var a=i.prototype;return a.setPosition=function(e,n,o){this._position.set(e,n,o)},a.setRotation=function(e,n,o){this._rotation.set(e,n,o)},a.setRotationQuaternion=function(e,n,o,s){this._rotationQuaternion.set(e,n,o,s)},a.setScale=function(e,n,o){this._scale.set(e,n,o)},a.setWorldPosition=function(e,n,o){this._worldPosition.set(e,n,o)},a.setWorldRotation=function(e,n,o){this._worldRotation.set(e,n,o)},a.setWorldRotationQuaternion=function(e,n,o,s){this._worldRotationQuaternion.set(e,n,o,s)},a.translate=function(e,n,o,s){if(typeof e=="number"){var l=i._tempVec30;l.set(e,n,o),this._translate(l,s)}else this._translate(e,n)},a.rotate=function(e,n,o,s){typeof e=="number"?this._rotateXYZ(e,n,o,s):this._rotateXYZ(e.x,e.y,e.z,n)},a.rotateByAxis=function(e,n,o){o===void 0&&(o=!0);var s=n*U.degreeToRadFactor;xe.rotationAxisAngle(e,s,i._tempQuat0),this._rotateByQuat(i._tempQuat0,o)},a.lookAt=function(e,n){var o=i._tempVec30;P.subtract(this.worldPosition,e,o);var s=o.length();if(!(s<=U.zeroTolerance)){o.scale(1/s);var l=i._tempVec31;if(n?P.cross(n,o,l):l.set(o.z,0,-o.x),s=l.length(),!(s<=U.zeroTolerance)){l.scale(1/s);var c=i._tempVec32;P.cross(o,l,c);var u=i._tempMat41,d=u.elements;d[0]=l.x,d[1]=l.y,d[2]=l.z,d[4]=c.x,d[5]=c.y,d[6]=c.z,d[8]=o.x,d[9]=o.y,d[10]=o.z,u.getRotation(this._worldRotationQuaternion)}}},a.registerWorldChangeFlag=function(){return this._updateFlagManager.createFlag(bu)},a._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},a._isFrontFaceInvert=function(){var e=this.lossyWorldScale,n=e.x<0;return e.y<0&&(n=!n),e.z<0&&(n=!n),n},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._worldPosition._onValueChanged=null,this._rotation._onValueChanged=null,this._worldRotation._onValueChanged=null,this._rotationQuaternion._onValueChanged=null,this._worldRotationQuaternion._onValueChanged=null,this._position._onValueChanged=null,this._scale._onValueChanged=null},a._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(132)){this._worldAssociatedChange(132);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)==null||s._updateWorldPositionFlag()}}},a._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(152)){this._worldAssociatedChange(152);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)==null||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(156)){this._worldAssociatedChange(156);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)==null||s._updateWorldPositionAndRotationFlag()}}},a._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(160)){this._worldAssociatedChange(160);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)==null||s._updateWorldPositionAndScaleFlag()}}},a._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(164)){this._worldAssociatedChange(164);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)==null||s._updateWorldPositionAndScaleFlag()}}},a._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(188)){this._worldAssociatedChange(188);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)==null||s._updateAllWorldFlag()}}},a._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,n=this._entity.parent;n;){var o=n.transform;if(o){e=o;break}else n=n.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},a._getScaleMatrix=function(){var e=i._tempQuat0,n=i._tempMat30,o=i._tempMat31,s=i._tempMat32;return o.copyFromMatrix(this.worldMatrix),xe.invert(this.worldRotationQuaternion,e),Do.rotationQuaternion(e,n),Do.multiply(n,o,s),s},a._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.dispatch(128)},a._rotateByQuat=function(e,n){n?xe.multiply(this.rotationQuaternion,e,this._rotationQuaternion):xe.multiply(e,this.worldRotationQuaternion,this._worldRotationQuaternion)},a._translate=function(e,n){if(n===void 0&&(n=!0),n){var o=i._tempVec30;P.transformByQuat(e,this.worldRotationQuaternion,o),this.worldPosition.add(o)}else this.worldPosition.add(e)},a._rotateXYZ=function(e,n,o,s){s===void 0&&(s=!0);var l=U.degreeToRadFactor,c=i._tempQuat0;xe.rotationEuler(e*l,n*l,o*l,c),this._rotateByQuat(c,s)},a._onPositionChanged=function(){this._setDirtyFlagTrue(64),this._updateWorldPositionFlag()},a._onWorldPositionChanged=function(){var e=this._worldPosition,n=this._getParentTransform();n?($.invert(n.worldMatrix,i._tempMat41),P.transformCoordinate(e,i._tempMat41,this._position)):this._position.copyFrom(e),this._setDirtyFlagFalse(4)},a._onRotationChanged=function(){this._setDirtyFlagTrue(66),this._setDirtyFlagFalse(1),this._updateWorldRotationFlag()},a._onWorldRotationChanged=function(){var e=this._worldRotation;xe.rotationEuler(U.degreeToRadian(e.x),U.degreeToRadian(e.y),U.degreeToRadian(e.z),this._worldRotationQuaternion),this._setDirtyFlagFalse(8)},a._onRotationQuaternionChanged=function(){this._setDirtyFlagTrue(65),this._setDirtyFlagFalse(2),this._updateWorldRotationFlag()},a._onWorldRotationQuaternionChanged=function(){var e=this._worldRotationQuaternion,n=this._getParentTransform();if(n){var o=i._tempQuat0;xe.invert(n.worldRotationQuaternion,o),xe.multiply(o,e,this._rotationQuaternion)}else this._rotationQuaternion.copyFrom(e);this._setDirtyFlagFalse(16)},a._onScaleChanged=function(){this._setDirtyFlagTrue(64),this._updateWorldScaleFlag()},q(i,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&this._position.copyFrom(e)}},{key:"worldPosition",get:function(){var e=this._worldPosition;return this._isContainDirtyFlag(4)&&(e._onValueChanged=null,this._getParentTransform()?this.worldMatrix.getTranslation(e):e.copyFrom(this._position),e._onValueChanged=this._onWorldPositionChanged,this._setDirtyFlagFalse(4)),e},set:function(e){this._worldPosition!==e&&this._worldPosition.copyFrom(e)}},{key:"rotation",get:function(){var e=this._rotation;return this._isContainDirtyFlag(1)&&(e._onValueChanged=null,this._rotationQuaternion.toEuler(e),e.scale(U.radToDegreeFactor),e._onValueChanged=this._onRotationChanged,this._setDirtyFlagFalse(1)),e},set:function(e){this._rotation!==e&&this._rotation.copyFrom(e)}},{key:"worldRotation",get:function(){var e=this._worldRotation;return this._isContainDirtyFlag(8)&&(e._onValueChanged=null,this.worldRotationQuaternion.toEuler(e),e.scale(U.radToDegreeFactor),e._onValueChanged=this._onWorldRotationChanged,this._setDirtyFlagFalse(8)),e},set:function(e){this._worldRotation!==e&&this._worldRotation.copyFrom(e)}},{key:"rotationQuaternion",get:function(){var e=this._rotationQuaternion;return this._isContainDirtyFlag(2)&&(e._onValueChanged=null,xe.rotationEuler(U.degreeToRadian(this._rotation.x),U.degreeToRadian(this._rotation.y),U.degreeToRadian(this._rotation.z),e),e._onValueChanged=this._onRotationQuaternionChanged,this._setDirtyFlagFalse(2)),e},set:function(e){this._rotationQuaternion!==e?e.normalized?this._rotationQuaternion.copyFrom(e):xe.normalize(e,this._rotationQuaternion):e.normalized||e.normalize()}},{key:"worldRotationQuaternion",get:function(){var e=this._worldRotationQuaternion;if(this._isContainDirtyFlag(16)){e._onValueChanged=null;var n=this._getParentTransform();n!=null?xe.multiply(n.worldRotationQuaternion,this.rotationQuaternion,e):e.copyFrom(this.rotationQuaternion),e._onValueChanged=this._onWorldRotationQuaternionChanged,this._setDirtyFlagFalse(16)}return e},set:function(e){this._worldRotationQuaternion!==e&&(e.normalized?this._worldRotationQuaternion.copyFrom(e):xe.normalize(e,this._worldRotationQuaternion)),e.normalized||e.normalize()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&this._scale.copyFrom(e)}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(32)){if(this._getParentTransform()){var e=this._getScaleMatrix(),n=e.elements;this._lossyWorldScale.set(n[0],n[4],n[8])}else this._lossyWorldScale.copyFrom(this._scale);this._setDirtyFlagFalse(32)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(64)&&($.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(64)),this._localMatrix},set:function(e){this._localMatrix!==e&&this._localMatrix.copyFrom(e),this._position._onValueChanged=this._rotationQuaternion._onValueChanged=this._scale._onValueChanged=null,this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._position._onValueChanged=this._onPositionChanged,this._rotationQuaternion._onValueChanged=this._onRotationQuaternionChanged,this._scale._onValueChanged=this._onScaleChanged,this._setDirtyFlagTrue(1),this._setDirtyFlagFalse(66),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(128)){var e=this._getParentTransform();e?$.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(128)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e);var n=this._getParentTransform();n?($.invert(n.worldMatrix,i._tempMat42),$.multiply(i._tempMat42,e,this._localMatrix)):this._localMatrix.copyFrom(e),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(128)}},{key:"worldForward",get:function(){var e=this._worldForward||(this._worldForward=new P),n=this.worldMatrix.elements;return e.set(-n[8],-n[9],-n[10]),e.normalize()}},{key:"worldRight",get:function(){var e=this._worldRight||(this._worldRight=new P),n=this.worldMatrix.elements;return e.set(n[0],n[1],n[2]),e.normalize()}},{key:"worldUp",get:function(){var e=this._worldUp||(this._worldUp=new P),n=this.worldMatrix.elements;return e.set(n[4],n[5],n[6]),e.normalize()}}]),i}(ir);(function(){ye._tempQuat0=new xe})();(function(){ye._tempVec30=new P})();(function(){ye._tempVec31=new P})();(function(){ye._tempVec32=new P})();(function(){ye._tempMat30=new Do})();(function(){ye._tempMat31=new Do})();(function(){ye._tempMat32=new Do})();(function(){ye._tempMat41=new $})();(function(){ye._tempMat42=new $})();R([Z],ye.prototype,"_position",void 0);R([Z],ye.prototype,"_rotation",void 0);R([Z],ye.prototype,"_rotationQuaternion",void 0);R([Z],ye.prototype,"_scale",void 0);R([Z],ye.prototype,"_worldPosition",void 0);R([Z],ye.prototype,"_worldRotation",void 0);R([Z],ye.prototype,"_worldRotationQuaternion",void 0);R([Z],ye.prototype,"_lossyWorldScale",void 0);R([Z],ye.prototype,"_localMatrix",void 0);R([Z],ye.prototype,"_worldMatrix",void 0);R([z],ye.prototype,"_worldForward",void 0);R([z],ye.prototype,"_worldRight",void 0);R([z],ye.prototype,"_worldUp",void 0);R([z],ye.prototype,"_isParentDirty",void 0);R([z],ye.prototype,"_parentTransformCache",void 0);R([z],ye.prototype,"_updateFlagManager",void 0);R([z],ye.prototype,"_onPositionChanged",null);R([z],ye.prototype,"_onWorldPositionChanged",null);R([z],ye.prototype,"_onRotationChanged",null);R([z],ye.prototype,"_onWorldRotationChanged",null);R([z],ye.prototype,"_onRotationQuaternionChanged",null);R([z],ye.prototype,"_onWorldRotationQuaternionChanged",null);R([z],ye.prototype,"_onScaleChanged",null);var sp;(function(r){r[r.LocalEuler=1]="LocalEuler",r[r.LocalQuat=2]="LocalQuat",r[r.WorldPosition=4]="WorldPosition",r[r.WorldEuler=8]="WorldEuler",r[r.WorldQuat=16]="WorldQuat",r[r.WorldScale=32]="WorldScale",r[r.LocalMatrix=64]="LocalMatrix",r[r.WorldMatrix=128]="WorldMatrix",r[r.WmWp=132]="WmWp",r[r.WmWeWq=152]="WmWeWq",r[r.WmWpWeWq=156]="WmWpWeWq",r[r.WmWs=160]="WmWs",r[r.WmWpWs=164]="WmWpWs",r[r.WmWpWeWqWs=188]="WmWpWeWqWs"})(sp||(sp={}));var Ee;(function(r){r[r.Zero=0]="Zero",r[r.One=1]="One",r[r.SourceColor=2]="SourceColor",r[r.OneMinusSourceColor=3]="OneMinusSourceColor",r[r.DestinationColor=4]="DestinationColor",r[r.OneMinusDestinationColor=5]="OneMinusDestinationColor",r[r.SourceAlpha=6]="SourceAlpha",r[r.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",r[r.DestinationAlpha=8]="DestinationAlpha",r[r.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",r[r.SourceAlphaSaturate=10]="SourceAlphaSaturate",r[r.BlendColor=11]="BlendColor",r[r.OneMinusBlendColor=12]="OneMinusBlendColor"})(Ee||(Ee={}));var fr;(function(r){r[r.Add=0]="Add",r[r.Subtract=1]="Subtract",r[r.ReverseSubtract=2]="ReverseSubtract",r[r.Min=3]="Min",r[r.Max=4]="Max"})(fr||(fr={}));var dn;(function(r){r[r.None=0]="None",r[r.Red=1]="Red",r[r.Green=2]="Green",r[r.Blue=4]="Blue",r[r.Alpha=8]="Alpha",r[r.All=15]="All"})(dn||(dn={}));var Te;(function(r){r[r.Never=0]="Never",r[r.Less=1]="Less",r[r.Equal=2]="Equal",r[r.LessEqual=3]="LessEqual",r[r.Greater=4]="Greater",r[r.NotEqual=5]="NotEqual",r[r.GreaterEqual=6]="GreaterEqual",r[r.Always=7]="Always"})(Te||(Te={}));var Mr;(function(r){r[r.Off=0]="Off",r[r.Front=1]="Front",r[r.Back=2]="Back"})(Mr||(Mr={}));var ae;(function(r){r[r.BlendStateEnabled0=0]="BlendStateEnabled0",r[r.BlendStateColorBlendOperation0=1]="BlendStateColorBlendOperation0",r[r.BlendStateAlphaBlendOperation0=2]="BlendStateAlphaBlendOperation0",r[r.BlendStateSourceColorBlendFactor0=3]="BlendStateSourceColorBlendFactor0",r[r.BlendStateSourceAlphaBlendFactor0=4]="BlendStateSourceAlphaBlendFactor0",r[r.BlendStateDestinationColorBlendFactor0=5]="BlendStateDestinationColorBlendFactor0",r[r.BlendStateDestinationAlphaBlendFactor0=6]="BlendStateDestinationAlphaBlendFactor0",r[r.BlendStateColorWriteMask0=7]="BlendStateColorWriteMask0",r[r.BlendStateBlendColor=8]="BlendStateBlendColor",r[r.BlendStateAlphaToCoverage=9]="BlendStateAlphaToCoverage",r[r.DepthStateEnabled=10]="DepthStateEnabled",r[r.DepthStateWriteEnabled=11]="DepthStateWriteEnabled",r[r.DepthStateCompareFunction=12]="DepthStateCompareFunction",r[r.StencilStateEnabled=13]="StencilStateEnabled",r[r.StencilStateReferenceValue=14]="StencilStateReferenceValue",r[r.StencilStateMask=15]="StencilStateMask",r[r.StencilStateWriteMask=16]="StencilStateWriteMask",r[r.StencilStateCompareFunctionFront=17]="StencilStateCompareFunctionFront",r[r.StencilStateCompareFunctionBack=18]="StencilStateCompareFunctionBack",r[r.StencilStatePassOperationFront=19]="StencilStatePassOperationFront",r[r.StencilStatePassOperationBack=20]="StencilStatePassOperationBack",r[r.StencilStateFailOperationFront=21]="StencilStateFailOperationFront",r[r.StencilStateFailOperationBack=22]="StencilStateFailOperationBack",r[r.StencilStateZFailOperationFront=23]="StencilStateZFailOperationFront",r[r.StencilStateZFailOperationBack=24]="StencilStateZFailOperationBack",r[r.RasterStateCullMode=25]="RasterStateCullMode",r[r.RasterStateDepthBias=26]="RasterStateDepthBias",r[r.RasterStateSlopeScaledDepthBias=27]="RasterStateSlopeScaledDepthBias",r[r.RenderQueueType=28]="RenderQueueType"})(ae||(ae={}));var Dt;(function(r){r[r.Opaque=0]="Opaque",r[r.AlphaTest=1]="AlphaTest",r[r.Transparent=2]="Transparent"})(Dt||(Dt={}));var lr;(function(r){r[r.Float=0]="Float",r[r.Int=1]="Int",r[r.Vector2=2]="Vector2",r[r.Vector3=3]="Vector3",r[r.Vector4=4]="Vector4",r[r.Matrix=5]="Matrix",r[r.Color=6]="Color",r[r.Texture=7]="Texture",r[r.FloatArray=8]="FloatArray",r[r.IntArray=9]="IntArray",r[r.TextureArray=10]="TextureArray"})(lr||(lr={}));var Je;(function(r){r[r.Keep=0]="Keep",r[r.Zero=1]="Zero",r[r.Replace=2]="Replace",r[r.IncrementSaturate=3]="IncrementSaturate",r[r.DecrementSaturate=4]="DecrementSaturate",r[r.Invert=5]="Invert",r[r.IncrementWrap=6]="IncrementWrap",r[r.DecrementWrap=7]="DecrementWrap"})(Je||(Je={}));var se=function(){function r(i,a,t,e){this.name=i,this._maskIndex=t,this._maskValue=e,this.value=a;var n=r._macroNameIdMap,o=n[i];n[i]===void 0&&(n[i]=o=r._macroNameCounter++),this._nameId=o}return r.getByName=function(a,t){var e=t?a+" "+t:a,n=r._macroMap[e];if(!n){var o=r._macroMaskMap,s=r._macroCounter,l=Math.floor(s/32),c=s%32;n=new r(a,t,l,1<<c),r._macroMap[e]=n,l==o.length&&(o.length++,o[l]=new Array(32)),o[l][c]=e,r._macroCounter++}return n},r._getNamesByMacros=function(a,t){var e=r._macroMaskMap,n=a._mask;t.length=0;for(var o=0,s=a._length;o<s;o++)for(var l=e[o],c=n[o],u=c<0?32:Math.floor(Math.log2(c))+1,d=0;d<u;d++)c&1<<d&&t.push(l[d])},r}();(function(){se._macroMaskMap=[]})();(function(){se._macroNameIdMap=Object.create(null)})();(function(){se._macroNameCounter=0})();(function(){se._macroCounter=0})();(function(){se._macroMap=Object.create(null)})();var Ir=function(){function r(){this._mask=[],this._length=0}var i=r.prototype;return i.enable=function(t){var e=t._maskIndex,n=e+1,o=this._mask,s=this._length;if(s<n){for(o.length<n&&(o.length=n);s<e;s++)o[s]=0;o[e]=t._maskValue,this._length=n}else o[e]|=t._maskValue},i.disable=function(t){var e=t._maskIndex,n=this._mask,o=this._length-1;if(!(e>o)){var s=n[e]&~t._maskValue;e==o&&s===0?this._length--:n[e]=s}},i.unionCollection=function(t){var e=t._mask,n=t._length,o=this._mask,s=this._length;if(s<n){o.length<n&&(o.length=n);for(var l=0;l<s;l++)o[l]|=e[l];for(;l<n;l++)o[l]=e[l];this._length=n}else for(var c=0;c<n;c++)o[c]|=e[c]},i.complementaryCollection=function(t){for(var e=t._mask,n=this._mask,o=this._length-1,s=Math.min(t._length-1,o);s>=0;s--){var l=n[s]&~e[s];s==o&&l===0?(o--,this._length--):n[s]=l}},i.intersectionCollection=function(t){for(var e=t._mask,n=this._mask,o=this._length-1;o>=0;o--){var s=n[o]&e[o];s==0&&o==this._length-1?this._length--:n[o]=s}},i.isEnable=function(t){var e=t._maskIndex;return e>=this._length?!1:(this._mask[e]&t._maskValue)!==0},i.clear=function(){this._length=0},r.unionCollection=function(t,e,n){var o=n._mask,s,l,c,u;t._length<e._length?(s=t._length,l=e._length,c=t._mask,u=e._mask):(s=e._length,l=t._length,c=e._mask,u=t._mask);var d=0;for(o.length<l&&(o.length=l);d<s;d++)o[d]=c[d]|u[d];for(;d<l;d++)o[d]=u[d];n._length=l},r}(),pr;(function(r){r.DepthOnly="DepthOnly",r.ShadowCaster="ShadowCaster",r.Forward="Forward"})(pr||(pr={}));function ff(){return ff=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},ff.apply(this,arguments)}var b1=`#define GLSLIFY 1
uniform vec3 camera_Position;uniform vec3 camera_Forward;`,E1=`#define GLSLIFY 1
#define PI 3.14159265359
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define LOG2 1.442695
#define saturate( a ) clamp( a, 0.0, 1.0 )
float pow2(float x){return x*x;}vec4 RGBMToLinear(vec4 value,float maxRange){return vec4(value.rgb*value.a*maxRange,1.0);}vec4 gammaToLinear(vec4 srgbIn){return vec4(pow(srgbIn.rgb,vec3(2.2)),srgbIn.a);}vec4 linearToGamma(vec4 linearIn){return vec4(pow(linearIn.rgb,vec3(1.0/2.2)),linearIn.a);}uniform vec4 camera_DepthBufferParams;float remapDepthBufferLinear01(float z){return 1.0/(camera_DepthBufferParams.x*z+camera_DepthBufferParams.y);}
#ifdef GRAPHICS_API_WEBGL2
#define INVERSE_MAT(mat) inverse(mat)
#else
mat2 inverseMat(mat2 m){return mat2(m[1][1],-m[0][1],-m[1][0],m[0][0])/(m[0][0]*m[1][1]-m[0][1]*m[1][0]);}mat3 inverseMat(mat3 m){float a00=m[0][0],a01=m[0][1],a02=m[0][2];float a10=m[1][0],a11=m[1][1],a12=m[1][2];float a20=m[2][0],a21=m[2][1],a22=m[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}mat4 inverseMat(mat4 m){float a00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],a10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],a20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],a30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return mat4(a11*b11-a12*b10+a13*b09,a02*b10-a01*b11-a03*b09,a31*b05-a32*b04+a33*b03,a22*b04-a21*b05-a23*b03,a12*b08-a10*b11-a13*b07,a00*b11-a02*b08+a03*b07,a32*b02-a30*b05-a33*b01,a20*b05-a22*b02+a23*b01,a10*b10-a11*b08+a13*b06,a01*b08-a00*b10-a03*b06,a30*b04-a31*b02+a33*b00,a21*b02-a20*b04-a23*b00,a11*b07-a10*b09-a12*b06,a00*b09-a01*b07+a02*b06,a31*b01-a30*b03-a32*b00,a20*b03-a21*b01+a22*b00)/det;}
#define INVERSE_MAT(mat) inverseMat(mat)
#endif
`,w1=`#define GLSLIFY 1
attribute vec3 POSITION;
#ifdef RENDERER_HAS_UV
attribute vec2 TEXCOORD_0;
#endif
#ifdef RENDERER_HAS_UV1
attribute vec2 TEXCOORD_1;
#endif
#ifdef RENDERER_HAS_SKIN
attribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;
#ifdef RENDERER_USE_JOINT_TEXTURE
uniform sampler2D renderer_JointSampler;uniform float renderer_JointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/renderer_JointCount;float hf=0.5/renderer_JointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}
#else
uniform mat4 renderer_JointMatrix[RENDERER_JOINTS_NUM];
#endif
#endif
#ifdef RENDERER_ENABLE_VERTEXCOLOR
attribute vec4 COLOR_0;
#endif
#include <transform_declare>
#include <camera_declare>
uniform vec4 material_TilingOffset;
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
attribute vec3 NORMAL;
#endif
#ifdef RENDERER_HAS_TANGENT
attribute vec4 TANGENT;
#endif
#endif
`,T1=`#define GLSLIFY 1
uniform mat4 renderer_LocalMat;uniform mat4 renderer_ModelMat;uniform mat4 camera_ViewMat;uniform mat4 camera_ProjMat;uniform mat4 renderer_MVMat;uniform mat4 renderer_MVPMat;uniform mat4 renderer_NormalMat;`,R1=`#define GLSLIFY 1
#ifdef RENDERER_ENABLE_VERTEXCOLOR
varying vec4 v_color;
#endif
`,P1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
varying vec3 v_positionVS;uniform vec4 scene_FogColor;uniform vec4 scene_FogParams;float ComputeFogIntensity(float fogDepth){
#if SCENE_FOG_MODE == 1
return clamp(fogDepth*scene_FogParams.x+scene_FogParams.y,0.0,1.0);
#elif SCENE_FOG_MODE == 2
return clamp(exp2(-fogDepth*scene_FogParams.z),0.0,1.0);
#elif SCENE_FOG_MODE == 3
float factor=fogDepth*scene_FogParams.w;return clamp(exp2(-factor*factor),0.0,1.0);
#endif
}
#endif
`,M1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
varying vec3 v_positionVS;
#endif
`,B1=`#define GLSLIFY 1
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
varying vec3 v_normal;
#if defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) || defined(MATERIAL_ENABLE_ANISOTROPY) )
varying mat3 v_TBN;
#endif
#endif
#endif
`,D1=`#define GLSLIFY 1
varying vec2 v_uv;
#ifdef RENDERER_HAS_UV1
varying vec2 v_uv1;
#endif
`,L1=`#define GLSLIFY 1
#ifdef MATERIAL_NEED_WORLD_POS
varying vec3 v_pos;
#endif
`,I1=`#define GLSLIFY 1
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
vec3 normal=vec3(NORMAL);
#endif
#ifdef RENDERER_HAS_TANGENT
vec4 tangent=vec4(TANGENT);
#endif
#endif
`,F1=`#define GLSLIFY 1
vec4 position=vec4(POSITION,1.0);`,N1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_BLENDSHAPE
#ifdef RENDERER_BLENDSHAPE_USE_TEXTURE
uniform mediump sampler2DArray renderer_BlendShapeTexture;uniform ivec3 renderer_BlendShapeTextureInfo;uniform float renderer_BlendShapeWeights[RENDERER_BLENDSHAPE_COUNT];
#else
attribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) && defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;uniform float renderer_BlendShapeWeights[2];
#else
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) || defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;
#ifdef RENDERER_BLENDSHAPE_HAS_NORMAL
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;
#endif
#ifdef RENDERER_BLENDSHAPE_HAS_TANGENT
attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;
#endif
uniform float renderer_BlendShapeWeights[4];
#else
attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;attribute vec3 POSITION_BS4;attribute vec3 POSITION_BS5;attribute vec3 POSITION_BS6;attribute vec3 POSITION_BS7;uniform float renderer_BlendShapeWeights[8];
#endif
#endif
#endif
#ifdef RENDERER_BLENDSHAPE_USE_TEXTURE
vec3 getBlendShapeVertexElement(int blendShapeIndex,int vertexElementIndex){int y=vertexElementIndex/renderer_BlendShapeTextureInfo.y;int x=vertexElementIndex-y*renderer_BlendShapeTextureInfo.y;ivec3 uv=ivec3(x,y,blendShapeIndex);return texelFetch(renderer_BlendShapeTexture,uv,0).xyz;}
#endif
#endif
`,V1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_BLENDSHAPE
#ifdef RENDERER_BLENDSHAPE_USE_TEXTURE
int vertexOffset=gl_VertexID*renderer_BlendShapeTextureInfo.x;for(int i=0;i<RENDERER_BLENDSHAPE_COUNT;i++){int vertexElementOffset=vertexOffset;float weight=renderer_BlendShapeWeights[i];if(weight!=0.0){position.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#ifndef MATERIAL_OMIT_NORMAL
#if defined( RENDERER_HAS_NORMAL ) && defined( RENDERER_BLENDSHAPE_HAS_NORMAL )
vertexElementOffset+=1;normal+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#if defined( RENDERER_HAS_TANGENT ) && defined(RENDERER_BLENDSHAPE_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
vertexElementOffset+=1;tangent.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#endif
}}
#else
position.xyz+=POSITION_BS0*renderer_BlendShapeWeights[0];position.xyz+=POSITION_BS1*renderer_BlendShapeWeights[1];
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) && defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
normal+=NORMAL_BS0*renderer_BlendShapeWeights[0];normal+=NORMAL_BS1*renderer_BlendShapeWeights[1];
#endif
#if defined( RENDERER_HAS_TANGENT ) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
tangent.xyz+=TANGENT_BS0*renderer_BlendShapeWeights[0];tangent.xyz+=TANGENT_BS1*renderer_BlendShapeWeights[1];
#endif
#endif
#else
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) || defined( RENDERER_BLENDSHAPE_HAS_TANGENT )
#ifndef MATERIAL_OMIT_NORMAL
position.xyz+=POSITION_BS2*renderer_BlendShapeWeights[2];position.xyz+=POSITION_BS3*renderer_BlendShapeWeights[3];
#if defined( RENDERER_BLENDSHAPE_HAS_NORMAL ) && defined( RENDERER_HAS_NORMAL )
normal+=NORMAL_BS0*renderer_BlendShapeWeights[0];normal+=NORMAL_BS1*renderer_BlendShapeWeights[1];normal+=NORMAL_BS2*renderer_BlendShapeWeights[2];normal+=NORMAL_BS3*renderer_BlendShapeWeights[3];
#endif
#if defined(RENDERER_BLENDSHAPE_HAS_TANGENT) && defined( RENDERER_HAS_TANGENT ) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
tangent.xyz+=TANGENT_BS0*renderer_BlendShapeWeights[0];tangent.xyz+=TANGENT_BS1*renderer_BlendShapeWeights[1];tangent.xyz+=TANGENT_BS2*renderer_BlendShapeWeights[2];tangent.xyz+=TANGENT_BS3*renderer_BlendShapeWeights[3];
#endif
#endif
#else
position.xyz+=POSITION_BS2*renderer_BlendShapeWeights[2];position.xyz+=POSITION_BS3*renderer_BlendShapeWeights[3];position.xyz+=POSITION_BS4*renderer_BlendShapeWeights[4];position.xyz+=POSITION_BS5*renderer_BlendShapeWeights[5];position.xyz+=POSITION_BS6*renderer_BlendShapeWeights[6];position.xyz+=POSITION_BS7*renderer_BlendShapeWeights[7];
#endif
#endif
#endif
#endif
`,O1=`#define GLSLIFY 1
#ifdef RENDERER_ENABLE_VERTEXCOLOR
v_color=COLOR_0;
#endif
`,z1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
vec4 positionVS=renderer_MVMat*position;v_positionVS=positionVS.xyz/positionVS.w;
#endif
`,k1=`#define GLSLIFY 1
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
v_normal=normalize(mat3(renderer_NormalMat)*normal);
#if defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) || defined(MATERIAL_ENABLE_ANISOTROPY) )
vec3 tangentW=normalize(mat3(renderer_NormalMat)*tangent.xyz);vec3 bitangentW=cross(v_normal,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,v_normal);
#endif
#endif
#endif
`,U1=`#define GLSLIFY 1
gl_Position=renderer_MVPMat*position;`,G1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_SKIN
#ifdef RENDERER_USE_JOINT_TEXTURE
mat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(renderer_JointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(renderer_JointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(renderer_JointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(renderer_JointSampler,JOINTS_0.w);
#else
mat4 skinMatrix=WEIGHTS_0.x*renderer_JointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*renderer_JointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*renderer_JointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*renderer_JointMatrix[int(JOINTS_0.w)];
#endif
position=skinMatrix*position;
#if defined(RENDERER_HAS_NORMAL) && !defined(MATERIAL_OMIT_NORMAL)
mat3 skinNormalMatrix=INVERSE_MAT(mat3(skinMatrix));normal=normal*skinNormalMatrix;
#if defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) )
tangent.xyz=tangent.xyz*skinNormalMatrix;
#endif
#endif
#endif
`,H1=`#define GLSLIFY 1
#ifdef RENDERER_HAS_UV
v_uv=TEXCOORD_0;
#else
v_uv=vec2(0.,0.);
#endif
#ifdef RENDERER_HAS_UV1
v_uv1=TEXCOORD_1;
#endif
#ifdef MATERIAL_NEED_TILING_OFFSET
v_uv=v_uv*material_TilingOffset.xy+material_TilingOffset.zw;
#endif
`,W1=`#define GLSLIFY 1
#ifdef MATERIAL_NEED_WORLD_POS
vec4 temp_pos=renderer_ModelMat*position;v_pos=temp_pos.xyz/temp_pos.w;
#endif
`,Q1=`#define GLSLIFY 1
#if SCENE_FOG_MODE != 0
float fogIntensity=ComputeFogIntensity(length(v_positionVS));gl_FragColor.rgb=mix(scene_FogColor.rgb,gl_FragColor.rgb,fogIntensity);
#endif
`,j1=`#define GLSLIFY 1
#ifdef SCENE_DIRECT_LIGHT_COUNT
struct DirectLight{vec3 color;vec3 direction;};uniform ivec2 scene_DirectLightCullingMask[SCENE_DIRECT_LIGHT_COUNT];uniform vec3 scene_DirectLightColor[SCENE_DIRECT_LIGHT_COUNT];uniform vec3 scene_DirectLightDirection[SCENE_DIRECT_LIGHT_COUNT];
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
struct PointLight{vec3 color;vec3 position;float distance;};uniform ivec2 scene_PointLightCullingMask[SCENE_POINT_LIGHT_COUNT];uniform vec3 scene_PointLightColor[SCENE_POINT_LIGHT_COUNT];uniform vec3 scene_PointLightPosition[SCENE_POINT_LIGHT_COUNT];uniform float scene_PointLightDistance[SCENE_POINT_LIGHT_COUNT];
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
struct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform ivec2 scene_SpotLightCullingMask[SCENE_SPOT_LIGHT_COUNT];uniform vec3 scene_SpotLightColor[SCENE_SPOT_LIGHT_COUNT];uniform vec3 scene_SpotLightPosition[SCENE_SPOT_LIGHT_COUNT];uniform vec3 scene_SpotLightDirection[SCENE_SPOT_LIGHT_COUNT];uniform float scene_SpotLightDistance[SCENE_SPOT_LIGHT_COUNT];uniform float scene_SpotLightAngleCos[SCENE_SPOT_LIGHT_COUNT];uniform float scene_SpotLightPenumbraCos[SCENE_SPOT_LIGHT_COUNT];
#endif
struct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;};uniform EnvMapLight scene_EnvMapLight;uniform ivec4 renderer_Layer;
#ifdef SCENE_USE_SH
uniform vec3 scene_EnvSH[9];
#endif
#ifdef SCENE_USE_SPECULAR_ENV
uniform samplerCube scene_EnvSpecularSampler;
#endif
#ifndef GRAPHICS_API_WEBGL2
bool isBitSet(float value,float mask,float bitIndex){return mod(floor(value/pow(2.0,bitIndex)),2.0)==1.0&&mod(floor(mask/pow(2.0,bitIndex)),2.0)==1.0;}
#endif
bool isRendererCulledByLight(ivec2 rendererLayer,ivec2 lightCullingMask){
#ifdef GRAPHICS_API_WEBGL2
return!((rendererLayer.x&lightCullingMask.x)!=0||(rendererLayer.y&lightCullingMask.y)!=0);
#else
for(int i=0;i<16;i++){if(isBitSet(float(rendererLayer.x),float(lightCullingMask.x),float(i))||isBitSet(float(rendererLayer.y),float(lightCullingMask.y),float(i))){return false;}}return true;
#endif
}`,X1=`#define GLSLIFY 1
uniform vec4 material_EmissiveColor;uniform vec4 material_BaseColor;uniform vec4 material_SpecularColor;uniform float material_Shininess;uniform float material_NormalIntensity;uniform float material_AlphaCutoff;
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
uniform sampler2D material_EmissiveTexture;
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
uniform sampler2D material_BaseTexture;
#endif
#ifdef MATERIAL_HAS_SPECULAR_TEXTURE
uniform sampler2D material_SpecularTexture;
#endif
#ifdef MATERIAL_HAS_NORMALTEXTURE
uniform sampler2D material_NormalTexture;
#endif
`,Y1=`#define GLSLIFY 1
vec4 ambient=vec4(0.0);vec4 emission=material_EmissiveColor;vec4 diffuse=material_BaseColor;vec4 specular=material_SpecularColor;
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
vec4 emissiveTextureColor=texture2D(material_EmissiveTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
emissiveTextureColor=gammaToLinear(emissiveTextureColor);
#endif
emission*=emissiveTextureColor;
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 diffuseTextureColor=texture2D(material_BaseTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
diffuseTextureColor=gammaToLinear(diffuseTextureColor);
#endif
diffuse*=diffuseTextureColor;
#endif
#ifdef RENDERER_ENABLE_VERTEXCOLOR
diffuse*=v_color;
#endif
#ifdef MATERIAL_HAS_SPECULAR_TEXTURE
vec4 specularTextureColor=texture2D(material_SpecularTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
specularTextureColor=gammaToLinear(specularTextureColor);
#endif
specular*=specularTextureColor;
#endif
ambient=vec4(scene_EnvMapLight.diffuse*scene_EnvMapLight.diffuseIntensity,1.0)*diffuse;`,q1=`#define GLSLIFY 1
#ifdef CAMERA_ORTHOGRAPHIC
vec3 V=-camera_Forward;
#else
#ifdef MATERIAL_NEED_WORLD_POS
vec3 V=normalize(camera_Position-v_pos);
#endif
#endif
`,K1=`#define GLSLIFY 1
#ifdef MATERIAL_HAS_NORMALTEXTURE
mat3 tbn=getTBN(gl_FrontFacing);vec3 N=getNormalByNormalTexture(tbn,material_NormalTexture,material_NormalIntensity,v_uv,gl_FrontFacing);
#else
vec3 N=getNormal(gl_FrontFacing);
#endif
vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);float shadowAttenuation=1.0;
#ifdef SCENE_DIRECT_LIGHT_COUNT
shadowAttenuation=1.0;
#ifdef SCENE_IS_CALCULATE_SHADOWS
shadowAttenuation*=sampleShadowMap();
#endif
DirectLight directionalLight;for(int i=0;i<SCENE_DIRECT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_DirectLightCullingMask[i])){directionalLight.color=scene_DirectLightColor[i];
#ifdef SCENE_IS_CALCULATE_SHADOWS
if(i==0){directionalLight.color*=shadowAttenuation;}
#endif
directionalLight.direction=scene_DirectLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),material_Shininess);lightSpecular+=directionalLight.color*s;}}
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<SCENE_POINT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_PointLightCullingMask[i])){pointLight.color=scene_PointLightColor[i];pointLight.position=scene_PointLightPosition[i];pointLight.distance=scene_PointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),material_Shininess)*decay;lightSpecular+=pointLight.color*s;}}
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<SCENE_SPOT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_SpotLightCullingMask[i])){spotLight.color=scene_SpotLightColor[i];spotLight.position=scene_SpotLightPosition[i];spotLight.direction=scene_SpotLightDirection[i];spotLight.distance=scene_SpotLightDistance[i];spotLight.angleCos=scene_SpotLightAngleCos[i];spotLight.penumbraCos=scene_SpotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),material_Shininess)*decayTotal;lightSpecular+=spotLight.color*s;}}
#endif
diffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);
#ifdef MATERIAL_IS_ALPHA_CUTOFF
if(diffuse.a<material_AlphaCutoff){discard;}
#endif
`,J1=`#define GLSLIFY 1
#include <noise_cellular_2D>
#include <noise_cellular_3D>
#include <noise_cellular_2x2>
#include <noise_cellular_2x2x2>
`,Z1=`#define GLSLIFY 1
vec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}`,$1=`#define GLSLIFY 1
vec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}`,ex=`#define GLSLIFY 1
vec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}`,tx=`#define GLSLIFY 1
vec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}`,rx=`#define GLSLIFY 1
vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
#define K 0.142857142857
#define Ko 0.428571428571
#define K2 0.020408163265306
#define Kd2 0.0714285714285
#define Kz 0.166666666667
#define Kzo 0.416666666667
#define jitter 1.0
#define jitter1 0.8
`,nx=`#define GLSLIFY 1
#include <noise_perlin_2D>
#include <noise_perlin_3D>
#include <noise_perlin_4D>
`,ix=`#define GLSLIFY 1
float perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}`,ax=`#define GLSLIFY 1
float perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}`,ox=`#define GLSLIFY 1
float perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}`,sx=`#define GLSLIFY 1
vec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}`,lx=`#define GLSLIFY 1
#include <noise_simplex_2D>
#include <noise_simplex_3D>
#include <noise_simplex_3D_grad>
#include <noise_simplex_4D>
`,cx=`#define GLSLIFY 1
float simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}`,ux=`#define GLSLIFY 1
float simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`,dx=`#define GLSLIFY 1
float simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}`,fx=`#define GLSLIFY 1
vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}
#define F4 0.309016994374947451
float simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}`,hx=`#define GLSLIFY 1
#define MIN_PERCEPTUAL_ROUGHNESS 0.045
#define MIN_ROUGHNESS 0.002025
uniform float material_AlphaCutoff;uniform vec4 material_BaseColor;uniform float material_Metal;uniform float material_Roughness;uniform float material_IOR;uniform vec3 material_PBRSpecularColor;uniform float material_Glossiness;uniform vec3 material_EmissiveColor;uniform float material_NormalIntensity;uniform float material_OcclusionIntensity;uniform float material_OcclusionTextureCoord;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
uniform float material_ClearCoat;uniform float material_ClearCoatRoughness;
#ifdef MATERIAL_HAS_CLEAR_COAT_TEXTURE
uniform sampler2D material_ClearCoatTexture;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE
uniform sampler2D material_ClearCoatRoughnessTexture;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE
uniform sampler2D material_ClearCoatNormalTexture;
#endif
#endif
#ifdef MATERIAL_ENABLE_ANISOTROPY
uniform vec3 material_AnisotropyInfo;
#ifdef MATERIAL_HAS_ANISOTROPY_TEXTURE
uniform sampler2D material_AnisotropyTexture;
#endif
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
uniform sampler2D material_BaseTexture;
#endif
#ifdef MATERIAL_HAS_NORMALTEXTURE
uniform sampler2D material_NormalTexture;
#endif
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
uniform sampler2D material_EmissiveTexture;
#endif
#ifdef MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE
uniform sampler2D material_RoughnessMetallicTexture;
#endif
#ifdef MATERIAL_HAS_SPECULAR_GLOSSINESS_TEXTURE
uniform sampler2D material_SpecularGlossinessTexture;
#endif
#ifdef MATERIAL_HAS_OCCLUSION_TEXTURE
uniform sampler2D material_OcclusionTexture;
#endif
struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct Geometry{vec3 position;vec3 normal;vec3 viewDir;float dotNV;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
vec3 clearCoatNormal;float clearCoatDotNV;
#endif
#ifdef MATERIAL_ENABLE_ANISOTROPY
vec3 anisotropicT;vec3 anisotropicB;vec3 anisotropicN;float anisotropy;
#endif
};struct Material{vec3 diffuseColor;float roughness;vec3 specularColor;float opacity;float f0;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
float clearCoat;float clearCoatRoughness;
#endif
};`,_x=`#define GLSLIFY 1
#include <normal_get>
float computeSpecularOcclusion(float ambientOcclusion,float roughness,float dotNV){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}float getAARoughnessFactor(vec3 normal){
#ifdef HAS_DERIVATIVES
vec3 dxy=max(abs(dFdx(normal)),abs(dFdy(normal)));return MIN_PERCEPTUAL_ROUGHNESS+max(max(dxy.x,dxy.y),dxy.z);
#else
return MIN_PERCEPTUAL_ROUGHNESS;
#endif
}
#ifdef MATERIAL_ENABLE_ANISOTROPY
vec3 getAnisotropicBentNormal(Geometry geometry,vec3 n,float roughness){vec3 anisotropyDirection=geometry.anisotropy>=0.0 ? geometry.anisotropicB : geometry.anisotropicT;vec3 anisotropicTangent=cross(anisotropyDirection,geometry.viewDir);vec3 anisotropicNormal=cross(anisotropicTangent,anisotropyDirection);vec3 bentNormal=normalize(mix(n,anisotropicNormal,abs(geometry.anisotropy)*saturate(5.0*roughness)));return bentNormal;}
#endif
void initGeometry(out Geometry geometry,bool isFrontFacing){geometry.position=v_pos;
#ifdef CAMERA_ORTHOGRAPHIC
geometry.viewDir=-camera_Forward;
#else
geometry.viewDir=normalize(camera_Position-v_pos);
#endif
#if defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) || defined(MATERIAL_ENABLE_ANISOTROPY)
mat3 tbn=getTBN(isFrontFacing);
#endif
#ifdef MATERIAL_HAS_NORMALTEXTURE
geometry.normal=getNormalByNormalTexture(tbn,material_NormalTexture,material_NormalIntensity,v_uv,isFrontFacing);
#else
geometry.normal=getNormal(isFrontFacing);
#endif
geometry.dotNV=saturate(dot(geometry.normal,geometry.viewDir));
#ifdef MATERIAL_ENABLE_CLEAR_COAT
#ifdef MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE
geometry.clearCoatNormal=getNormalByNormalTexture(tbn,material_ClearCoatNormalTexture,material_NormalIntensity,v_uv,isFrontFacing);
#else
geometry.clearCoatNormal=getNormal(isFrontFacing);
#endif
geometry.clearCoatDotNV=saturate(dot(geometry.clearCoatNormal,geometry.viewDir));
#endif
#ifdef MATERIAL_ENABLE_ANISOTROPY
float anisotropy=material_AnisotropyInfo.z;vec3 anisotropicDirection=vec3(material_AnisotropyInfo.xy,0.0);
#ifdef MATERIAL_HAS_ANISOTROPY_TEXTURE
vec3 anisotropyTextureInfo=texture2D(material_AnisotropyTexture,v_uv).rgb;anisotropy*=anisotropyTextureInfo.b;anisotropicDirection.xy*=anisotropyTextureInfo.rg*2.0-1.0;
#endif
geometry.anisotropy=anisotropy;geometry.anisotropicT=normalize(tbn*anisotropicDirection);geometry.anisotropicB=normalize(cross(geometry.normal,geometry.anisotropicT));
#endif
}void initMaterial(out Material material,inout Geometry geometry){vec4 baseColor=material_BaseColor;float metal=material_Metal;float roughness=material_Roughness;vec3 specularColor=material_PBRSpecularColor;float glossiness=material_Glossiness;float alphaCutoff=material_AlphaCutoff;float f0=pow2((material_IOR-1.0)/(material_IOR+1.0));material.f0=f0;
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 baseTextureColor=texture2D(material_BaseTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
baseTextureColor=gammaToLinear(baseTextureColor);
#endif
baseColor*=baseTextureColor;
#endif
#ifdef RENDERER_ENABLE_VERTEXCOLOR
baseColor*=v_color;
#endif
#ifdef MATERIAL_IS_ALPHA_CUTOFF
if(baseColor.a<alphaCutoff){discard;}
#endif
#ifdef MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE
vec4 metalRoughMapColor=texture2D(material_RoughnessMetallicTexture,v_uv);roughness*=metalRoughMapColor.g;metal*=metalRoughMapColor.b;
#endif
#ifdef MATERIAL_HAS_SPECULAR_GLOSSINESS_TEXTURE
vec4 specularGlossinessColor=texture2D(material_SpecularGlossinessTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
specularGlossinessColor=gammaToLinear(specularGlossinessColor);
#endif
specularColor*=specularGlossinessColor.rgb;glossiness*=specularGlossinessColor.a;
#endif
#ifdef IS_METALLIC_WORKFLOW
material.diffuseColor=baseColor.rgb*(1.0-metal);material.specularColor=mix(vec3(f0),baseColor.rgb,metal);material.roughness=roughness;
#else
float specularStrength=max(max(specularColor.r,specularColor.g),specularColor.b);material.diffuseColor=baseColor.rgb*(1.0-specularStrength);material.specularColor=specularColor;material.roughness=1.0-glossiness;
#endif
material.roughness=max(material.roughness,getAARoughnessFactor(geometry.normal));
#ifdef MATERIAL_ENABLE_CLEAR_COAT
material.clearCoat=material_ClearCoat;material.clearCoatRoughness=material_ClearCoatRoughness;
#ifdef MATERIAL_HAS_CLEAR_COAT_TEXTURE
material.clearCoat*=texture2D(material_ClearCoatTexture,v_uv).r;
#endif
#ifdef MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE
material.clearCoatRoughness*=texture2D(material_ClearCoatRoughnessTexture,v_uv).g;
#endif
material.clearCoat=saturate(material.clearCoat);material.clearCoatRoughness=max(material.clearCoatRoughness,getAARoughnessFactor(geometry.clearCoatNormal));
#endif
#ifdef MATERIAL_IS_TRANSPARENT
material.opacity=baseColor.a;
#else
material.opacity=1.0;
#endif
#ifdef MATERIAL_ENABLE_ANISOTROPY
geometry.anisotropicN=getAnisotropicBentNormal(geometry,geometry.normal,material.roughness);
#endif
}
#include <brdf>
#include <direct_irradiance_frag_define>
#include <ibl_frag_define>
`,px=`#define GLSLIFY 1
float F_Schlick(float f0,float dotLH){return f0+0.96*(pow(1.0-dotLH,5.0));}vec3 F_Schlick(vec3 specularColor,float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(float alpha,float dotNL,float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}
#ifdef MATERIAL_ENABLE_ANISOTROPY
float G_GGX_SmithCorrelated_Anisotropic(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));return 0.5/max(lambdaV+lambdaL,EPSILON);}
#endif
float D_GGX(float alpha,float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}
#ifdef MATERIAL_ENABLE_ANISOTROPY
float D_GGX_Anisotropic(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*RECIPROCAL_PI;}
#endif
vec3 isotropicLobe(vec3 specularColor,float alpha,float dotNV,float dotNL,float dotNH,float dotLH){vec3 F=F_Schlick(specularColor,dotLH);float D=D_GGX(alpha,dotNH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);return F*(G*D);}
#ifdef MATERIAL_ENABLE_ANISOTROPY
vec3 anisotropicLobe(vec3 h,vec3 l,Geometry geometry,vec3 specularColor,float alpha,float dotNV,float dotNL,float dotNH,float dotLH){vec3 t=geometry.anisotropicT;vec3 b=geometry.anisotropicB;vec3 v=geometry.viewDir;float dotTV=dot(t,v);float dotBV=dot(b,v);float dotTL=dot(t,l);float dotBL=dot(b,l);float dotTH=dot(t,h);float dotBH=dot(b,h);float at=max(alpha*(1.0+geometry.anisotropy),MIN_ROUGHNESS);float ab=max(alpha*(1.0-geometry.anisotropy),MIN_ROUGHNESS);vec3 F=F_Schlick(specularColor,dotLH);float D=D_GGX_Anisotropic(at,ab,dotTH,dotBH,dotNH);float G=G_GGX_SmithCorrelated_Anisotropic(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);return F*(G*D);}
#endif
vec3 BRDF_Specular_GGX(vec3 incidentDirection,Geometry geometry,vec3 normal,vec3 specularColor,float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentDirection+geometry.viewDir);float dotNL=saturate(dot(normal,incidentDirection));float dotNV=saturate(dot(normal,geometry.viewDir));float dotNH=saturate(dot(normal,halfDir));float dotLH=saturate(dot(incidentDirection,halfDir));
#ifdef MATERIAL_ENABLE_ANISOTROPY
return anisotropicLobe(halfDir,incidentDirection,geometry,specularColor,alpha,dotNV,dotNL,dotNH,dotLH);
#else
return isotropicLobe(specularColor,alpha,dotNV,dotNL,dotNH,dotLH);
#endif
}vec3 BRDF_Diffuse_Lambert(vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}`,vx=`#define GLSLIFY 1
#include <ShadowFragmentDeclaration>
void addDirectRadiance(vec3 incidentDirection,vec3 color,Geometry geometry,Material material,inout ReflectedLight reflectedLight){float attenuation=1.0;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
float clearCoatDotNL=saturate(dot(geometry.clearCoatNormal,incidentDirection));vec3 clearCoatIrradiance=clearCoatDotNL*color;reflectedLight.directSpecular+=material.clearCoat*clearCoatIrradiance*BRDF_Specular_GGX(incidentDirection,geometry,geometry.clearCoatNormal,vec3(0.04),material.clearCoatRoughness);attenuation-=material.clearCoat*F_Schlick(material.f0,geometry.clearCoatDotNV);
#endif
float dotNL=saturate(dot(geometry.normal,incidentDirection));vec3 irradiance=dotNL*color*PI;reflectedLight.directSpecular+=attenuation*irradiance*BRDF_Specular_GGX(incidentDirection,geometry,geometry.normal,material.specularColor,material.roughness);reflectedLight.directDiffuse+=attenuation*irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}
#ifdef SCENE_DIRECT_LIGHT_COUNT
void addDirectionalDirectLightRadiance(DirectLight directionalLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 color=directionalLight.color;vec3 direction=-directionalLight.direction;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
void addPointDirectLightRadiance(PointLight pointLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=pointLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);vec3 color=pointLight.color;color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
void addSpotDirectLightRadiance(SpotLight spotLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=spotLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);vec3 color=spotLight.color;color*=spotEffect*decayEffect;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
void addTotalDirectRadiance(Geometry geometry,Material material,inout ReflectedLight reflectedLight){float shadowAttenuation=1.0;
#ifdef SCENE_DIRECT_LIGHT_COUNT
shadowAttenuation=1.0;
#ifdef SCENE_IS_CALCULATE_SHADOWS
shadowAttenuation*=sampleShadowMap();
#endif
DirectLight directionalLight;for(int i=0;i<SCENE_DIRECT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_DirectLightCullingMask[i])){directionalLight.color=scene_DirectLightColor[i];
#ifdef SCENE_IS_CALCULATE_SHADOWS
if(i==0){directionalLight.color*=shadowAttenuation;}
#endif
directionalLight.direction=scene_DirectLightDirection[i];addDirectionalDirectLightRadiance(directionalLight,geometry,material,reflectedLight);}}
#endif
#ifdef SCENE_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<SCENE_POINT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_PointLightCullingMask[i])){pointLight.color=scene_PointLightColor[i];pointLight.position=scene_PointLightPosition[i];pointLight.distance=scene_PointLightDistance[i];addPointDirectLightRadiance(pointLight,geometry,material,reflectedLight);}}
#endif
#ifdef SCENE_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<SCENE_SPOT_LIGHT_COUNT;i++){if(!isRendererCulledByLight(renderer_Layer.xy,scene_SpotLightCullingMask[i])){spotLight.color=scene_SpotLightColor[i];spotLight.position=scene_SpotLightPosition[i];spotLight.direction=scene_SpotLightDirection[i];spotLight.distance=scene_SpotLightDistance[i];spotLight.angleCos=scene_SpotLightAngleCos[i];spotLight.penumbraCos=scene_SpotLightPenumbraCos[i];addSpotDirectLightRadiance(spotLight,geometry,material,reflectedLight);}}
#endif
}`,gx=`#define GLSLIFY 1
vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){normal.x=-normal.x;vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}vec3 envBRDFApprox(vec3 specularColor,float roughness,float dotNV){const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(float roughness,int maxMIPLevel){return roughness*float(maxMIPLevel);}vec3 getReflectedVector(Geometry geometry,vec3 n){
#ifdef MATERIAL_ENABLE_ANISOTROPY
vec3 r=reflect(-geometry.viewDir,geometry.anisotropicN);
#else
vec3 r=reflect(-geometry.viewDir,n);
#endif
return r;}vec3 getLightProbeRadiance(Geometry geometry,vec3 normal,float roughness,int maxMIPLevel,float specularIntensity){
#ifndef SCENE_USE_SPECULAR_ENV
return vec3(0);
#else
vec3 reflectVec=getReflectedVector(geometry,normal);reflectVec.x=-reflectVec.x;float specularMIPLevel=getSpecularMIPLevel(roughness,maxMIPLevel);
#ifdef HAS_TEX_LOD
vec4 envMapColor=textureCubeLodEXT(scene_EnvSpecularSampler,reflectVec,specularMIPLevel);
#else
vec4 envMapColor=textureCube(scene_EnvSpecularSampler,reflectVec,specularMIPLevel);
#endif
#ifdef SCENE_IS_DECODE_ENV_RGBM
envMapColor.rgb=RGBMToLinear(envMapColor,5.0).rgb;
#ifdef ENGINE_IS_COLORSPACE_GAMMA
envMapColor=linearToGamma(envMapColor);
#endif
#else
#ifndef ENGINE_IS_COLORSPACE_GAMMA
envMapColor=gammaToLinear(envMapColor);
#endif
#endif
return envMapColor.rgb*specularIntensity;
#endif
}`,mx=`#define GLSLIFY 1
Geometry geometry;Material material;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));initGeometry(geometry,gl_FrontFacing);initMaterial(material,geometry);addTotalDirectRadiance(geometry,material,reflectedLight);
#ifdef SCENE_USE_SH
vec3 irradiance=getLightProbeIrradiance(scene_EnvSH,geometry.normal);
#ifdef ENGINE_IS_COLORSPACE_GAMMA
irradiance=linearToGamma(vec4(irradiance,1.0)).rgb;
#endif
irradiance*=scene_EnvMapLight.diffuseIntensity;
#else
vec3 irradiance=scene_EnvMapLight.diffuse*scene_EnvMapLight.diffuseIntensity;irradiance*=PI;
#endif
reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);vec3 radiance=getLightProbeRadiance(geometry,geometry.normal,material.roughness,int(scene_EnvMapLight.mipMapLevel),scene_EnvMapLight.specularIntensity);float radianceAttenuation=1.0;
#ifdef MATERIAL_ENABLE_CLEAR_COAT
vec3 clearCoatRadiance=getLightProbeRadiance(geometry,geometry.clearCoatNormal,material.clearCoatRoughness,int(scene_EnvMapLight.mipMapLevel),scene_EnvMapLight.specularIntensity);reflectedLight.indirectSpecular+=clearCoatRadiance*material.clearCoat*envBRDFApprox(vec3(0.04),material.clearCoatRoughness,geometry.clearCoatDotNV);radianceAttenuation-=material.clearCoat*F_Schlick(material.f0,geometry.clearCoatDotNV);
#endif
reflectedLight.indirectSpecular+=radianceAttenuation*radiance*envBRDFApprox(material.specularColor,material.roughness,geometry.dotNV);
#ifdef MATERIAL_HAS_OCCLUSION_TEXTURE
vec2 aoUV=v_uv;
#ifdef RENDERER_HAS_UV1
if(material_OcclusionTextureCoord==1.0){aoUV=v_uv1;}
#endif
float ambientOcclusion=(texture2D(material_OcclusionTexture,aoUV).r-1.0)*material_OcclusionIntensity+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;
#ifdef SCENE_USE_SPECULAR_ENV
reflectedLight.indirectSpecular*=computeSpecularOcclusion(ambientOcclusion,material.roughness,geometry.dotNV);
#endif
#endif
vec3 emissiveRadiance=material_EmissiveColor;
#ifdef MATERIAL_HAS_EMISSIVETEXTURE
vec4 emissiveColor=texture2D(material_EmissiveTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
emissiveColor=gammaToLinear(emissiveColor);
#endif
emissiveRadiance*=emissiveColor.rgb;
#endif
vec3 totalRadiance=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+emissiveRadiance;vec4 targetColor=vec4(totalRadiance,material.opacity);gl_FragColor=targetColor;`,yx={pbr_frag_define:hx,pbr_helper:_x,brdf:px,direct_irradiance_frag_define:vx,ibl_frag_define:gx,pbr_frag:mx},Ax=`#define GLSLIFY 1
uniform mat4 scene_ShadowMatrices[SCENE_SHADOW_CASCADED_COUNT+1];uniform vec4 scene_ShadowSplitSpheres[4];mediump int computeCascadeIndex(vec3 positionWS){vec3 fromCenter0=positionWS-scene_ShadowSplitSpheres[0].xyz;vec3 fromCenter1=positionWS-scene_ShadowSplitSpheres[1].xyz;vec3 fromCenter2=positionWS-scene_ShadowSplitSpheres[2].xyz;vec3 fromCenter3=positionWS-scene_ShadowSplitSpheres[3].xyz;mediump vec4 comparison=vec4(dot(fromCenter0,fromCenter0)<scene_ShadowSplitSpheres[0].w,dot(fromCenter1,fromCenter1)<scene_ShadowSplitSpheres[1].w,dot(fromCenter2,fromCenter2)<scene_ShadowSplitSpheres[2].w,dot(fromCenter3,fromCenter3)<scene_ShadowSplitSpheres[3].w);comparison.yzw=clamp(comparison.yzw-comparison.xyz,0.0,1.0);mediump vec4 indexCoefficient=vec4(4.0,3.0,2.0,1.0);mediump int index=4-int(dot(comparison,indexCoefficient));return index;}vec3 getShadowCoord(){
#if SCENE_SHADOW_CASCADED_COUNT == 1
mediump int cascadeIndex=0;
#else
mediump int cascadeIndex=computeCascadeIndex(v_pos);
#endif
#ifdef GRAPHICS_API_WEBGL2
mat4 shadowMatrix=scene_ShadowMatrices[cascadeIndex];
#else
mat4 shadowMatrix;
#if SCENE_SHADOW_CASCADED_COUNT == 4
if(cascadeIndex==0){shadowMatrix=scene_ShadowMatrices[0];}else if(cascadeIndex==1){shadowMatrix=scene_ShadowMatrices[1];}else if(cascadeIndex==2){shadowMatrix=scene_ShadowMatrices[2];}else if(cascadeIndex==3){shadowMatrix=scene_ShadowMatrices[3];}else{shadowMatrix=scene_ShadowMatrices[4];}
#endif
#if SCENE_SHADOW_CASCADED_COUNT == 2
if(cascadeIndex==0){shadowMatrix=scene_ShadowMatrices[0];}else if(cascadeIndex==1){shadowMatrix=scene_ShadowMatrices[1];}else{shadowMatrix=scene_ShadowMatrices[2];}
#endif
#if SCENE_SHADOW_CASCADED_COUNT == 1
if(cascadeIndex==0){shadowMatrix=scene_ShadowMatrices[0];}else{shadowMatrix=scene_ShadowMatrices[1];}
#endif
#endif
vec4 shadowCoord=shadowMatrix*vec4(v_pos,1.0);return shadowCoord.xyz;}`,xx=`#define GLSLIFY 1
#if defined(SCENE_SHADOW_TYPE) && defined(RENDERER_IS_RECEIVE_SHADOWS)
#define SCENE_IS_CALCULATE_SHADOWS
#endif
#ifdef SCENE_IS_CALCULATE_SHADOWS
#if SCENE_SHADOW_CASCADED_COUNT == 1
varying vec3 v_shadowCoord;
#else
#include <ShadowCoord>
#endif
uniform vec4 scene_ShadowInfo;uniform vec4 scene_ShadowMapSize;
#ifdef GRAPHICS_API_WEBGL2
uniform mediump sampler2DShadow scene_ShadowMap;
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName, coord3 , 0.0)
#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2DShadow shadowMap
#else
uniform sampler2D scene_ShadowMap;
#ifdef ENGINE_NO_DEPTH_TEXTURE
const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (unpack(texture2D(textureName, coord3.xy)) < coord3.z ? 0.0 : 1.0)
#else
#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName, coord3.xy).r < coord3.z ? 0.0 : 1.0)
#endif
#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2D shadowMap
#endif
#if SCENE_SHADOW_TYPE == 2
float sampleShadowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowMapSize){float attenuation;vec4 attenuation4;vec2 offset=shadowMapSize.xy/2.0;vec3 shadowCoord0=shadowCoord+vec3(-offset,0.0);vec3 shadowCoord1=shadowCoord+vec3(offset.x,-offset.y,0.0);vec3 shadowCoord2=shadowCoord+vec3(-offset.x,offset.y,0.0);vec3 shadowCoord3=shadowCoord+vec3(offset,0.0);attenuation4.x=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord0);attenuation4.y=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord1);attenuation4.z=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord2);attenuation4.w=SAMPLE_TEXTURE2D_SHADOW(shadowMap,shadowCoord3);attenuation=dot(attenuation4,vec4(0.25));return attenuation;}
#endif
#if SCENE_SHADOW_TYPE == 3
#include <shadow_sample_tent>
float sampleShadowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowmapSize){float attenuation;float fetchesWeights[9];vec2 fetchesUV[9];sampleShadowComputeSamplesTent5x5(shadowmapSize,shadowCoord.xy,fetchesWeights,fetchesUV);attenuation=fetchesWeights[0]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[0].xy,shadowCoord.z));attenuation+=fetchesWeights[1]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[1].xy,shadowCoord.z));attenuation+=fetchesWeights[2]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[2].xy,shadowCoord.z));attenuation+=fetchesWeights[3]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[3].xy,shadowCoord.z));attenuation+=fetchesWeights[4]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[4].xy,shadowCoord.z));attenuation+=fetchesWeights[5]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[5].xy,shadowCoord.z));attenuation+=fetchesWeights[6]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[6].xy,shadowCoord.z));attenuation+=fetchesWeights[7]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[7].xy,shadowCoord.z));attenuation+=fetchesWeights[8]*SAMPLE_TEXTURE2D_SHADOW(shadowMap,vec3(fetchesUV[8].xy,shadowCoord.z));return attenuation;}
#endif
float getShadowFade(vec3 positionWS){vec3 camToPixel=positionWS-camera_Position;float distanceCamToPixel2=dot(camToPixel,camToPixel);return saturate(distanceCamToPixel2*scene_ShadowInfo.z+scene_ShadowInfo.w);}float sampleShadowMap(){
#if SCENE_SHADOW_CASCADED_COUNT == 1
vec3 shadowCoord=v_shadowCoord;
#else
vec3 shadowCoord=getShadowCoord();
#endif
float attenuation=1.0;if(shadowCoord.z>0.0&&shadowCoord.z<1.0){
#if SCENE_SHADOW_TYPE == 1
attenuation=SAMPLE_TEXTURE2D_SHADOW(scene_ShadowMap,shadowCoord);
#endif
#if SCENE_SHADOW_TYPE == 2
attenuation=sampleShadowMapFiltered4(scene_ShadowMap,shadowCoord,scene_ShadowMapSize);
#endif
#if SCENE_SHADOW_TYPE == 3
attenuation=sampleShadowMapFiltered9(scene_ShadowMap,shadowCoord,scene_ShadowMapSize);
#endif
float shadowFade=getShadowFade(v_pos);attenuation=mix(1.0,mix(attenuation,1.0,shadowFade),scene_ShadowInfo.x);}return attenuation;}
#endif
`,Sx=`#define GLSLIFY 1
float sampleShadowGetIRTriangleTexelArea(float triangleHeight){return triangleHeight-0.5;}void sampleShadowGetTexelAreasTent3x3(float offset,out vec4 computedArea,out vec4 computedAreaUncut){float a=offset+0.5;float offsetSquaredHalved=a*a*0.5;computedAreaUncut.x=computedArea.x=offsetSquaredHalved-offset;computedAreaUncut.w=computedArea.w=offsetSquaredHalved;computedAreaUncut.y=sampleShadowGetIRTriangleTexelArea(1.5-offset);float clampedOffsetLeft=min(offset,0.0);float areaOfSmallLeftTriangle=clampedOffsetLeft*clampedOffsetLeft;computedArea.y=computedAreaUncut.y-areaOfSmallLeftTriangle;computedAreaUncut.z=sampleShadowGetIRTriangleTexelArea(1.5+offset);float clampedOffsetRight=max(offset,0.0);float areaOfSmallRightTriangle=clampedOffsetRight*clampedOffsetRight;computedArea.z=computedAreaUncut.z-areaOfSmallRightTriangle;}void sampleShadowGetTexelWeightsTent5x5(float offset,out vec3 texelsWeightsA,out vec3 texelsWeightsB){vec4 areaFrom3texelTriangle;vec4 areaUncutFrom3texelTriangle;sampleShadowGetTexelAreasTent3x3(offset,areaFrom3texelTriangle,areaUncutFrom3texelTriangle);texelsWeightsA.x=0.16*(areaFrom3texelTriangle.x);texelsWeightsA.y=0.16*(areaUncutFrom3texelTriangle.y);texelsWeightsA.z=0.16*(areaFrom3texelTriangle.y+1.0);texelsWeightsB.x=0.16*(areaFrom3texelTriangle.z+1.0);texelsWeightsB.y=0.16*(areaUncutFrom3texelTriangle.z);texelsWeightsB.z=0.16*(areaFrom3texelTriangle.w);}void sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize,vec2 coord,out float fetchesWeights[9],out vec2 fetchesUV[9]){vec2 tentCenterInTexelSpace=coord.xy*shadowMapTextureTexelSize.zw;vec2 centerOfFetchesInTexelSpace=floor(tentCenterInTexelSpace+0.5);vec2 offsetFromTentCenterToCenterOfFetches=tentCenterInTexelSpace-centerOfFetchesInTexelSpace;vec3 texelsWeightsUA,texelsWeightsUB;vec3 texelsWeightsVA,texelsWeightsVB;sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x,texelsWeightsUA,texelsWeightsUB);sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y,texelsWeightsVA,texelsWeightsVB);vec3 fetchesWeightsU=vec3(texelsWeightsUA.xz,texelsWeightsUB.y)+vec3(texelsWeightsUA.y,texelsWeightsUB.xz);vec3 fetchesWeightsV=vec3(texelsWeightsVA.xz,texelsWeightsVB.y)+vec3(texelsWeightsVA.y,texelsWeightsVB.xz);vec3 fetchesOffsetsU=vec3(texelsWeightsUA.y,texelsWeightsUB.xz)/fetchesWeightsU.xyz+vec3(-2.5,-0.5,1.5);vec3 fetchesOffsetsV=vec3(texelsWeightsVA.y,texelsWeightsVB.xz)/fetchesWeightsV.xyz+vec3(-2.5,-0.5,1.5);fetchesOffsetsU*=shadowMapTextureTexelSize.xxx;fetchesOffsetsV*=shadowMapTextureTexelSize.yyy;vec2 bilinearFetchOrigin=centerOfFetchesInTexelSpace*shadowMapTextureTexelSize.xy;fetchesUV[0]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.x);fetchesUV[1]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.x);fetchesUV[2]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.x);fetchesUV[3]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.y);fetchesUV[4]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.y);fetchesUV[5]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.y);fetchesUV[6]=bilinearFetchOrigin+vec2(fetchesOffsetsU.x,fetchesOffsetsV.z);fetchesUV[7]=bilinearFetchOrigin+vec2(fetchesOffsetsU.y,fetchesOffsetsV.z);fetchesUV[8]=bilinearFetchOrigin+vec2(fetchesOffsetsU.z,fetchesOffsetsV.z);fetchesWeights[0]=fetchesWeightsU.x*fetchesWeightsV.x;fetchesWeights[1]=fetchesWeightsU.y*fetchesWeightsV.x;fetchesWeights[2]=fetchesWeightsU.z*fetchesWeightsV.x;fetchesWeights[3]=fetchesWeightsU.x*fetchesWeightsV.y;fetchesWeights[4]=fetchesWeightsU.y*fetchesWeightsV.y;fetchesWeights[5]=fetchesWeightsU.z*fetchesWeightsV.y;fetchesWeights[6]=fetchesWeightsU.x*fetchesWeightsV.z;fetchesWeights[7]=fetchesWeightsU.y*fetchesWeightsV.z;fetchesWeights[8]=fetchesWeightsU.z*fetchesWeightsV.z;}`,Cx=`#define GLSLIFY 1
#if defined(SCENE_SHADOW_TYPE) && defined(RENDERER_IS_RECEIVE_SHADOWS)
#define SCENE_IS_CALCULATE_SHADOWS
#endif
#ifdef SCENE_IS_CALCULATE_SHADOWS
#if SCENE_SHADOW_CASCADED_COUNT==1
#include <ShadowCoord>
varying vec3 v_shadowCoord;
#endif
#endif
`,bx=`#define GLSLIFY 1
#ifdef SCENE_IS_CALCULATE_SHADOWS
#if SCENE_SHADOW_CASCADED_COUNT == 1
v_shadowCoord=getShadowCoord();
#endif
#endif
`,Ex={ShadowCoord:Ax,ShadowFragmentDeclaration:xx,shadow_sample_tent:Sx,ShadowVertexDeclaration:Cx,ShadowVertex:bx},wx=`#define GLSLIFY 1
vec3 rotationByEuler(in vec3 vector,in vec3 rot){float halfRoll=rot.z*0.5;float halfPitch=rot.x*0.5;float halfYaw=rot.y*0.5;float sinRoll=sin(halfRoll);float cosRoll=cos(halfRoll);float sinPitch=sin(halfPitch);float cosPitch=cos(halfPitch);float sinYaw=sin(halfYaw);float cosYaw=cos(halfYaw);float quaX=(cosYaw*sinPitch*cosRoll)+(sinYaw*cosPitch*sinRoll);float quaY=(sinYaw*cosPitch*cosRoll)-(cosYaw*sinPitch*sinRoll);float quaZ=(cosYaw*cosPitch*sinRoll)-(sinYaw*sinPitch*cosRoll);float quaW=(cosYaw*cosPitch*cosRoll)+(sinYaw*sinPitch*sinRoll);float x=quaX+quaX;float y=quaY+quaY;float z=quaZ+quaZ;float wx=quaW*x;float wy=quaW*y;float wz=quaW*z;float xx=quaX*x;float xy=quaX*y;float xz=quaX*z;float yy=quaY*y;float yz=quaY*z;float zz=quaZ*z;return vec3(((vector.x*((1.0-yy)-zz))+(vector.y*(xy-wz)))+(vector.z*(xz+wy)),((vector.x*(xy+wz))+(vector.y*((1.0-xx)-zz)))+(vector.z*(yz-wx)),((vector.x*(xz-wy))+(vector.y*(yz+wx)))+(vector.z*((1.0-xx)-yy)));}vec3 rotationByAxis(in vec3 vector,in vec3 axis,in float angle){float halfAngle=angle*0.5;float sin=sin(halfAngle);float quaX=axis.x*sin;float quaY=axis.y*sin;float quaZ=axis.z*sin;float quaW=cos(halfAngle);float x=quaX+quaX;float y=quaY+quaY;float z=quaZ+quaZ;float wx=quaW*x;float wy=quaW*y;float wz=quaW*z;float xx=quaX*x;float xy=quaX*y;float xz=quaX*z;float yy=quaY*y;float yz=quaY*z;float zz=quaZ*z;return vec3(((vector.x*((1.0-yy)-zz))+(vector.y*(xy-wz)))+(vector.z*(xz+wy)),((vector.x*(xy+wz))+(vector.y*((1.0-xx)-zz)))+(vector.z*(yz-wx)),((vector.x*(xz-wy))+(vector.y*(yz+wx)))+(vector.z*((1.0-xx)-yy)));}vec3 rotationByQuaternions(in vec3 v,in vec4 q){return v+2.0*cross(q.xyz,cross(q.xyz,v)+q.w*v);}float evaluateParticleCurve(in vec2 keys[4],in float normalizedAge){float value;for(int i=1;i<4;i++){vec2 key=keys[i];float time=key.x;if(time>=normalizedAge){vec2 lastKey=keys[i-1];float lastTime=lastKey.x;float age=(normalizedAge-lastTime)/(time-lastTime);value=mix(lastKey.y,key.y,age);break;}}return value;}float evaluateParticleCurveCumulative(in vec2 keys[4],in float normalizedAge){float cumulativeValue=0.0;for(int i=1;i<4;i++){vec2 key=keys[i];float time=key.x;vec2 lastKey=keys[i-1];float lastValue=lastKey.y;if(time>=normalizedAge){float lastTime=lastKey.x;float offsetTime=normalizedAge-lastTime;float age=offsetTime/(time-lastTime);cumulativeValue+=(lastValue+mix(lastValue,key.y,age))*0.5*offsetTime;break;}else{cumulativeValue+=(lastValue+key.y)*0.5*(time-lastKey.x);}}return cumulativeValue;}`,Tx=`#define GLSLIFY 1
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
uniform int renderer_VOLSpace;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_RANDOM_CONSTANT)
uniform vec3 renderer_VOLMaxConst;
#ifdef RENDERER_VOL_RANDOM_CONSTANT
uniform vec3 renderer_VOLMinConst;
#endif
#endif
#if defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CURVE)
uniform vec2 renderer_VOLMaxGradientX[4];uniform vec2 renderer_VOLMaxGradientY[4];uniform vec2 renderer_VOLMaxGradientZ[4];
#ifdef RENDERER_VOL_RANDOM_CURVE
uniform vec2 renderer_VOLMinGradientX[4];uniform vec2 renderer_VOLMinGradientY[4];uniform vec2 renderer_VOLMinGradientZ[4];
#endif
#endif
#endif
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
vec3 computeParticleLifeVelocity(in float normalizedAge){vec3 velocity;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_RANDOM_CONSTANT)
velocity=renderer_VOLMaxConst;
#ifdef RENDERER_VOL_RANDOM_CONSTANT
velocity=mix(renderer_VOLMinConst,velocity,vec3(a_Random1.y,a_Random1.z,a_Random1.w));
#endif
#endif
#if defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CURVE)
velocity=vec3(evaluateParticleCurve(renderer_VOLMaxGradientX,normalizedAge),evaluateParticleCurve(renderer_VOLMaxGradientY,normalizedAge),evaluateParticleCurve(renderer_VOLMaxGradientZ,normalizedAge));
#endif
#ifdef RENDERER_VOL_RANDOM_CURVE
velocity=vec3(mix(velocity.x,evaluateParticleCurve(renderer_VOLMinGradientX,normalizedAge),a_Random1.y),mix(velocity.y,evaluateParticleCurve(renderer_VOLMinGradientY,normalizedAge),a_Random1.z),mix(velocity.z,evaluateParticleCurve(renderer_VOLMinGradientZ,normalizedAge),a_Random1.w));
#endif
return velocity;}
#endif
vec3 getStartPosition(vec3 startVelocity,float age,vec3 dragData){vec3 startPosition;float lastTime=min(startVelocity.x/dragData.x,age);startPosition=lastTime*(startVelocity-0.5*dragData*lastTime);return startPosition;}vec3 computeParticlePosition(in vec3 startVelocity,in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation,vec3 dragData){vec3 startPosition=getStartPosition(startVelocity,age,dragData);vec3 lifePosition;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
#if defined(RENDERER_VOL_CONSTANT)|| defined(RENDERER_VOL_RANDOM_CONSTANT)
lifePosition=lifeVelocity*age;
#endif
#if defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CURVE)
lifePosition=vec3(evaluateParticleCurveCumulative(renderer_VOLMaxGradientX,normalizedAge)evaluateParticleCurveCumulative(renderer_VOLMaxGradientY,normalizedAge),evaluateParticleCurveCumulative(renderer_VOLMaxGradientZ,normalizedAge));
#ifdef RENDERER_VOL_RANDOM_CURVE
lifePosition=vec3(mix(evaluateParticleCurveCumulative(renderer_VOLMinGradientX,normalizedAge),lifePosition.x,a_Random1.y),mix(evaluateParticleCurveCumulative(renderer_VOLMinGradientY,normalizedAge),lifePosition.y,a_Random1.z),mix(evaluateParticleCurveCumulative(renderer_VOLMinGradientZ,normalizedAge),lifePosition.z,a_Random1.w));
#endif
lifePosition*=vec3(a_ShapePositionStartLifeTime.w);
#endif
vec3 finalPosition;if(renderer_VOLSpace==0){finalPosition=rotationByQuaternions(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);}else{finalPosition=rotationByQuaternions(a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;}
#else
vec3 finalPosition=rotationByQuaternions(a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);
#endif
if(renderer_SimulationSpace==0){finalPosition=finalPosition+renderer_WorldPosition;}else if(renderer_SimulationSpace==1){finalPosition=finalPosition+a_SimulationWorldPosition;}finalPosition+=0.5*gravityVelocity*age;return finalPosition;}`,Rx=`#define GLSLIFY 1
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
#ifdef RENDERER_ROL_CURVE_MODE
uniform vec2 renderer_ROLMaxCurveZ[4];
#ifdef RENDERER_ROL_IS_RANDOM_TWO
uniform vec2 renderer_ROLMinCurveZ[4];
#endif
#else
uniform vec3 renderer_ROLMaxConst;
#ifdef RENDERER_ROL_IS_RANDOM_TWO
uniform vec3 renderer_ROLMinConst;
#endif
#endif
#endif
float computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge){
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
#ifdef RENDERER_ROL_CURVE_MODE
float lifeRotation=evaluateParticleCurveCumulative(renderer_ROLMaxCurveZ,normalizedAge);
#ifdef RENDERER_ROL_IS_RANDOM_TWO
lifeRotation=mix(evaluateParticleCurveCumulative(renderer_ROLMinCurveZ,normalizedAge),lifeRotation,a_Random0.w);
#endif
rotation+=lifeRotation*a_ShapePositionStartLifeTime.w;
#else
float lifeRotation=renderer_ROLMaxConst.z;
#ifdef RENDERER_ROL_IS_RANDOM_TWO
lifeRotation=mix(renderer_ROLMinConst.z,lifeRotation,a_Random0.w);
#endif
rotation+=lifeRotation*age;
#endif
#endif
return rotation;}
#if defined(RENDERER_MODE_MESH) && (defined(ROTATION_OVER_LIFETIME) || defined(ROTATION_OVER_LIFETIME_SEPARATE))
vec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge){
#ifdef ROTATION_OVER_LIFETIME
#ifdef ROTATION_OVER_LIFETIME_CONSTANT
float ageRot=u_ROLAngularVelocityConst*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_CURVE
rotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CONSTANTS
float ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CURVES
rotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);
#endif
#endif
#ifdef ROTATION_OVER_LIFETIME_SEPARATE
#ifdef ROTATION_OVER_LIFETIME_CONSTANT
vec3 ageRot=u_ROLAngularVelocityConstSeparate*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_CURVE
rotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CONSTANTS
vec3 ageRot=mix(u_ROLAngularVelocityConstSeparate,renderer_ROLMaxConst,a_Random0.w)*age;rotation+=ageRot;
#endif
#ifdef ROTATION_OVER_LIFETIME_RANDOM_CURVES
rotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(renderer_ROLMaxCurveX,normalizedAge),a_Random0.w),mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(renderer_ROLMaxCurveY,normalizedAge),a_Random0.w),mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(renderer_ROLMaxCurveZ,normalizedAge),a_Random0.w));
#endif
#endif
return rotation;}
#endif
`,Px=`#define GLSLIFY 1
#ifdef RENDERER_SOL_CURVE_MODE
uniform vec2 renderer_SOLMaxCurveX[4];
#ifdef RENDERER_SOL_IS_SEPARATE
uniform vec2 renderer_SOLMaxCurveY[4];uniform vec2 renderer_SOLMaxCurveZ[4];
#endif
#ifdef RENDERER_SOL_IS_RANDOM_TWO
uniform vec2 renderer_SOLMinCurveX[4];
#ifdef RENDERER_SOL_IS_SEPARATE
uniform vec2 renderer_SOLMinCurveY[4];uniform vec2 renderer_SOLMinCurveZ[4];
#endif
#endif
#endif
vec2 computeParticleSizeBillboard(in vec2 size,in float normalizedAge){
#ifdef RENDERER_SOL_CURVE_MODE
float lifeSizeX=evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge);
#ifdef RENDERER_SOL_IS_RANDOM_TWO
lifeSizeX=mix(evaluateParticleCurve(renderer_SOLMinCurveX,normalizedAge),lifeSizeX,a_Random0.z);
#endif
#ifdef RENDERER_SOL_IS_SEPARATE
float lifeSizeY=evaluateParticleCurve(renderer_SOLMaxCurveY,normalizedAge);
#ifdef RENDERER_SOL_IS_RANDOM_TWO
lifeSizeY=mix(evaluateParticleCurve(renderer_SOLMinCurveY,normalizedAge),lifeSizeY,a_Random0.z);
#endif
size*=vec2(lifeSizeX,lifeSizeY);
#else
size*=lifeSizeX;
#endif
#endif
return size;}
#ifdef RENDERER_MODE_MESH
vec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge){
#ifdef RENDERER_SOL_CURVE
size*=evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge);
#endif
#ifdef RENDERER_SOL_RANDOM_CURVES
size*=mix(evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge),evaluateParticleCurve(u_SOLSizeGradientMax,normalizedAge),a_Random0.z);
#endif
#ifdef RENDERER_SOL_CURVE_SEPARATE
size*=vec3(evaluateParticleCurve(renderer_SOLMinCurveX,normalizedAge),evaluateParticleCurve(renderer_SOLMinCurveY,normalizedAge),evaluateParticleCurve(renderer_SOLMinCurveZ,normalizedAge));
#endif
#ifdef RENDERER_SOL_RANDOM_CURVES_SEPARATE
size*=vec3(mix(evaluateParticleCurve(renderer_SOLMinCurveX,normalizedAge),evaluateParticleCurve(renderer_SOLMaxCurveX,normalizedAge),a_Random0.z),mix(evaluateParticleCurve(renderer_SOLMinCurveY,normalizedAge),evaluateParticleCurve(renderer_SOLMaxCurveY,normalizedAge),a_Random0.z),mix(evaluateParticleCurve(renderer_SOLMinCurveZ,normalizedAge),evaluateParticleCurve(renderer_SOLMaxCurveZ,normalizedAge),a_Random0.z));
#endif
return size;}
#endif
`,Mx=`#define GLSLIFY 1
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
uniform vec4 renderer_COLMaxGradientColor[4];uniform vec2 renderer_COLMaxGradientAlpha[4];
#ifdef RENDERER_COL_RANDOM_GRADIENTS
uniform vec4 renderer_COLMinGradientColor[4];uniform vec2 renderer_COLMinGradientAlpha[4];
#endif
uniform vec4 renderer_COLGradientKeysMaxTime;
#endif
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
vec4 evaluateParticleGradient(in vec4 colorKeys[4],in float colorKeysMaxTime,in vec2 alphaKeys[4],in float alphaKeysMaxTime,in float normalizedAge){vec4 value;float alphaAge=min(normalizedAge,alphaKeysMaxTime);for(int i=0;i<4;i++){vec2 key=alphaKeys[i];float time=key.x;if(alphaAge<=time){if(i==0){value.a=colorKeys[0].y;}else{vec2 lastKey=alphaKeys[i-1];float lastTime=lastKey.x;float age=(alphaAge-lastTime)/(time-lastTime);value.a=mix(lastKey.y,key.y,age);}break;}}float colorAge=min(normalizedAge,colorKeysMaxTime);for(int i=0;i<4;i++){vec4 key=colorKeys[i];float time=key.x;if(colorAge<=time){if(i==0){value.rgb=colorKeys[0].yzw;}else{vec4 lastKey=colorKeys[i-1];float lastTime=lastKey.x;float age=(colorAge-lastTime)/(time-lastTime);value.rgb=mix(lastKey.yzw,key.yzw,age);}break;}}return value;}
#endif
vec4 computeParticleColor(in vec4 color,in float normalizedAge){
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
vec4 gradientColor=evaluateParticleGradient(renderer_COLMaxGradientColor,renderer_COLGradientKeysMaxTime.z,renderer_COLMaxGradientAlpha,renderer_COLGradientKeysMaxTime.w,normalizedAge);
#endif
#ifdef RENDERER_COL_RANDOM_GRADIENTS
gradientColor=mix(evaluateParticleGradient(renderer_COLMinGradientColor,renderer_COLGradientKeysMaxTime.x,renderer_COLMinGradientAlpha,renderer_COLGradientKeysMaxTime.y,normalizedAge),gradientColor,a_Random0.y);
#endif
#if defined(RENDERER_COL_GRADIENT) || defined(RENDERER_COL_RANDOM_GRADIENTS)
color*=gradientColor;
#endif
return color;}`,Bx=`#define GLSLIFY 1
#if defined(RENDERER_TSA_FRAME_CURVE) || defined(RENDERER_TSA_FRAME_RANDOM_CURVES)
uniform float renderer_TSACycles;uniform vec3 renderer_TSATillingParams;uniform vec2 renderer_TSAFrameMaxCurve[4];
#endif
#ifdef RENDERER_TSA_FRAME_RANDOM_CURVES
uniform vec2 renderer_TSAFrameMinCurve[4];
#endif
vec2 computeParticleUV(in vec2 uv,in float normalizedAge){
#if defined(RENDERER_TSA_FRAME_CURVE) || defined(RENDERER_TSA_FRAME_RANDOM_CURVES)
float scaledNormalizedAge=normalizedAge*renderer_TSACycles;float cycleNormalizedAge=scaledNormalizedAge-floor(scaledNormalizedAge);float normalizedFrame=evaluateParticleCurve(renderer_TSAFrameMaxCurve,cycleNormalizedAge);
#ifdef RENDERER_TSA_FRAME_RANDOM_CURVES
normalizedFrame=mix(evaluateParticleCurve(renderer_TSAFrameMinCurve,cycleNormalizedAge),normalizedFrame,a_Random1.x);
#endif
float frame=floor(normalizedFrame*renderer_TSATillingParams.z);float totalULength=frame*renderer_TSATillingParams.x;float floorTotalULength=floor(totalULength);uv.x+=totalULength-floorTotalULength;uv.y+=floorTotalULength*renderer_TSATillingParams.y;
#endif
return uv;}`,Dx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_SPHERE_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;vec3 sideVector=normalize(cross(camera_Forward,camera_Up));vec3 upVector=normalize(cross(sideVector,camera_Forward));corner*=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
if(renderer_ThreeDStartRotation){vec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));center+=renderer_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);}else{float rot=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);float c=cos(rot);float s=sin(rot);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner;center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);}
#else
if(renderer_ThreeDStartRotation){center+=renderer_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);}else{float c=cos(a_StartRotation0.x);float s=sin(a_StartRotation0.x);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner;center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);}
#endif
#endif
`,Lx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_STRETCHED_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;vec3 velocity;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
if(renderer_VOLSpace==0){velocity=rotationByQuaternions(renderer_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;}else{velocity=rotationByQuaternions(renderer_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;}
#else
velocity=rotationByQuaternions(renderer_SizeScale*startVelocity,worldRotation)+gravityVelocity;
#endif
vec3 cameraUpVector=normalize(velocity);vec3 direction=normalize(center-camera_Position);vec3 sideVector=normalize(cross(direction,normalize(velocity)));sideVector=renderer_SizeScale.xzy*sideVector;cameraUpVector=length(vec3(renderer_SizeScale.x,0.0,0.0))*cameraUpVector;vec2 size=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);const mat2 rotationZHalfPI=mat2(0.0,-1.0,1.0,0.0);corner=rotationZHalfPI*corner;corner.y=corner.y-abs(corner.y);float speed=length(velocity);center+=sign(renderer_SizeScale.x)*(sign(renderer_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*renderer_StretchedBillboardSpeedScale+size.y*renderer_StretchedBillboardLengthScale)*corner.y*cameraUpVector);
#endif
`,Ix=`#define GLSLIFY 1
#ifdef RENDERER_MODE_VERTICAL_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;const vec3 cameraUpVector=vec3(0.0,1.0,0.0);vec3 sideVector=normalize(cross(camera_Forward,cameraUpVector));float rot=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);float c=cos(rot);float s=sin(rot);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner*cos(0.78539816339744830961566084581988);corner*=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*cameraUpVector);
#endif
`,Fx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_HORIZONTAL_BILLBOARD
vec2 corner=a_CornerTextureCoordinate.xy+renderer_PivotOffset.xy;const vec3 cameraUpVector=vec3(0.0,0.0,1.0);const vec3 sideVector=vec3(-1.0,0.0,0.0);float rot=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);float c=cos(rot);float s=sin(rot);mat2 rotation=mat2(c,-s,s,c);corner=rotation*corner*cos(0.78539816339744830961566084581988);corner*=computeParticleSizeBillboard(a_StartSize.xy,normalizedAge);center+=renderer_SizeScale.xzy*(corner.x*sideVector+corner.y*cameraUpVector);
#endif
`,Nx=`#define GLSLIFY 1
#ifdef RENDERER_MODE_MESH
vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);
#if defined(RENDERER_ROL_CONSTANT_MODE) || defined(RENDERER_ROL_CURVE_MODE)
if(renderer_ThreeDStartRotation){vec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));center+=rotationByQuaternions(renderer_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);}else{
#ifdef RENDERER_ROL_IS_SEPARATE
float angle=computeParticleRotationFloat(a_StartRotation0.x,age,normalizedAge);if(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){center+=(rotationByQuaternions(rotationByAxis(renderer_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));}else{
#ifdef SHAPE
center+=renderer_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));
#else
if(renderer_SimulationSpace==1)center+=rotationByAxis(renderer_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);else if(renderer_SimulationSpace==0)center+=rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);
#endif
}
#endif
#ifdef ROTATION_OVER_LIFETIME_SEPARATE
vec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,-a_StartRotation0.x),age,normalizedAge);center+=(rotationByQuaternions(rotationByEuler(renderer_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));
#endif
}
#else
if(renderer_ThreeDStartRotation){center+=rotationByQuaternions(renderer_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);}else{if(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){if(renderer_SimulationSpace==1)center+=rotationByAxis(renderer_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);else if(renderer_SimulationSpace==0)center+=(rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));}else{
#ifdef SHAPE
if(renderer_SimulationSpace==1)center+=renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);else if(renderer_SimulationSpace==0)center+=rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);
#else
if(renderer_SimulationSpace==1)center+=rotationByAxis(renderer_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);else if(renderer_SimulationSpace==0)center+=rotationByQuaternions(renderer_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);
#endif
}}
#endif
v_MeshColor=a_MeshColor;
#endif
`,Vx={particle_common:wx,velocity_over_lifetime_module:Tx,rotation_over_lifetime_module:Rx,size_over_lifetime_module:Px,color_over_lifetime_module:Mx,texture_sheet_animation_module:Bx,sphere_billboard:Dx,stretched_billboard:Lx,vertical_billboard:Ix,horizontal_billboard:Fx,particle_mesh:Nx},Ox=`#define GLSLIFY 1
vec3 getNormal(bool isFrontFacing){
#ifdef RENDERER_HAS_NORMAL
vec3 normal=normalize(v_normal);
#elif defined(HAS_DERIVATIVES)
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 normal=normalize(cross(pos_dx,pos_dy));
#else
vec3 normal=vec3(0,0,1);
#endif
normal*=float(isFrontFacing)*2.0-1.0;return normal;}vec3 getNormalByNormalTexture(mat3 tbn,sampler2D normalTexture,float normalIntensity,vec2 uv,bool isFrontFacing){vec3 normal=texture2D(normalTexture,uv).rgb;normal=normalize(tbn*((2.0*normal-1.0)*vec3(normalIntensity,normalIntensity,1.0)));normal*=float(isFrontFacing)*2.0-1.0;return normal;}mat3 getTBN(bool isFrontFacing){
#if defined(RENDERER_HAS_NORMAL) && defined(RENDERER_HAS_TANGENT) && ( defined(MATERIAL_HAS_NORMALTEXTURE) || defined(MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE) || defined(MATERIAL_ENABLE_ANISOTROPY) )
mat3 tbn=v_TBN;
#else
vec3 normal=getNormal(isFrontFacing);vec3 position=v_pos;vec2 uv=isFrontFacing? v_uv:-v_uv;
#ifdef HAS_DERIVATIVES
vec3 dp1=dFdx(position);vec3 dp2=dFdy(position);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));mat3 tbn=mat3(tangent*invmax,bitangent*invmax,normal);
#else
mat3 tbn=mat3(vec3(0.0),vec3(0.0),normal);
#endif
#endif
return tbn;}`,fd=ff({common:E1,common_vert:w1,transform_declare:T1,camera_declare:b1,color_share:R1,normal_share:B1,uv_share:D1,worldpos_share:L1,FogVertexDeclaration:M1,FogFragmentDeclaration:P1,begin_normal_vert:I1,begin_position_vert:F1,position_vert:U1,color_vert:O1,normal_vert:k1,skinning_vert:G1,blendShape_input:N1,blendShape_vert:V1,uv_vert:H1,worldpos_vert:W1,FogVertex:z1,light_frag_define:j1,mobile_material_frag:X1,FogFragment:Q1,begin_mobile_frag:Y1,begin_viewdir_frag:q1,mobile_blinnphong_frag:K1,noise_common:rx,noise_cellular_2D:Z1,noise_cellular_2x2:$1,noise_cellular_2x2x2:ex,noise_cellular_3D:tx,noise_cellular:J1,noise_perlin_2D:ix,noise_perlin_3D:ax,noise_perlin_4D:ox,noise_perlin:nx,noise_psrd_2D:sx,noise_simplex_2D:cx,noise_simplex_3D_grad:dx,noise_simplex_3D:ux,noise_simplex_4D:fx,noise_simplex:lx},Ex,yx,{normal_get:Ox},Vx),Ui=function(){function r(){}return r.parseCustomMacros=function(a){return a.map(function(t){return"#define "+t+`
`}).join("")},r.registerInclude=function(a,t){if(fd[a])throw'The "'+a+'" shader include already exist';fd[a]=t},r.parseIncludes=function(a,t){t===void 0&&(t=/^[ \t]*#include +<([\w\d.]+)>/gm);var e=function(o,s){var l=fd[s];return l===void 0?(me.error('Shader slice "'+o.trim()+'" not founded.'),""):r.parseIncludes(l)};return a.replace(t,e)},r.convertTo300=function(a,t){if(a=a.replace(/\battribute\b/g,"in"),a=a.replace(/\bvarying\b/g,t?"in":"out"),a=a.replace(/\btexture(2D|Cube)\b/g,"texture"),a=a.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),t){var e=/\bgl_FragData\[.+?\]/g.test(a);if(e){a=a.replace(/\bgl_FragColor\b/g,"gl_FragData[0]");var n=a.match(/\bgl_FragData\[.+?\]/g);a=this._replaceMRTShader(a,n)}else a=a.replace(/void\s+?main\s*\(/g,`out vec4 glFragColor;
void main(`),a=a.replace(/\bgl_FragColor\b/g,"glFragColor")}return a},r._replaceMRTShader=function(a,t){for(var e="",n=new Set,o=0;o<t.length;o++){var s=t[o].match(/\bgl_FragData\[(.+?)\]/);n.add(s[1])}return n.forEach(function(l){e+="layout(location="+l+") out vec4 fragOutColor"+l+`;
`}),e+="void main(",a=a.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1"),a=a.replace(/void\s+?main\s*\(/g,e),a},r}();(function(){Ui._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"].map(function(r){return"#extension "+r+` : enable
`}).join("")})();var yi=function(){function r(i){this.name=i,this._uniqueId=r._nameCounter++}return r.getByName=function(a){var t,e,n=r._nameMap;return(t=n)[e=a]||(t[e]=new r(a))},r}();(function(){yi._nameCounter=0})();(function(){yi._nameMap=Object.create(null)})();var rm=function(){function r(){this._tagsMap=Object.create(null)}var i=r.prototype;return i.setTag=function(t,e){var n=typeof t=="string"?yi.getByName(t):t,o=this._tagsMap;o[n._uniqueId]!==void 0&&me.warn('The value of tag named "'+n.name+'" is being replaced.'),o[n._uniqueId]=e},i.deleteTag=function(t){delete this._tagsMap[(typeof t=="string"?yi.getByName(t):t)._uniqueId]},i.getTagValue=function(t){return this._tagsMap[typeof t=="string"?yi.getByName(t)._uniqueId:t._uniqueId]},q(r,[{key:"name",get:function(){return this._name}}]),r}(),Dn;(function(r){r[r.Scene=0]="Scene",r[r.Camera=1]="Camera",r[r.Renderer=2]="Renderer",r[r.Material=3]="Material"})(Dn||(Dn={}));var jr;(function(r){r[r.Linear=0]="Linear",r[r.Gamma=1]="Gamma"})(jr||(jr={}));var zx=function(){function r(a){this.textureUseCompareMode=!1;var t=a._hardwareRenderer;this._rhi=t,this._gl=t.gl,this._colorSpace=a.settings.colorSpace}var i=r.prototype;return i.upload1f=function(t,e){this.cacheValue!==e&&(this._gl.uniform1f(t.location,e),this.cacheValue=e)},i.upload1fv=function(t,e){this._gl.uniform1fv(t.location,e)},i.upload2f=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._colorSpace===jr.Linear?this._gl.uniform2f(t.location,K.gammaToLinearSpace(e.r),K.gammaToLinearSpace(e.g)):this._gl.uniform2f(t.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2f(t.location,e.x,e.y),n.x=e.x,n.y=e.y)},i.upload2fv=function(t,e){this._gl.uniform2fv(t.location,e)},i.upload3f=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._colorSpace===jr.Linear?this._gl.uniform3f(t.location,K.gammaToLinearSpace(e.r),K.gammaToLinearSpace(e.g),K.gammaToLinearSpace(e.b)):this._gl.uniform3f(t.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3f(t.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},i.upload3fv=function(t,e){this._gl.uniform3fv(t.location,e)},i.upload4f=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._colorSpace===jr.Linear?this._gl.uniform4f(t.location,K.gammaToLinearSpace(e.r),K.gammaToLinearSpace(e.g),K.gammaToLinearSpace(e.b),e.a):this._gl.uniform4f(t.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4f(t.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},i.upload4fv=function(t,e){this._gl.uniform4fv(t.location,e)},i.upload1i=function(t,e){this.cacheValue!==e&&(this._gl.uniform1i(t.location,e),this.cacheValue=e)},i.upload1iv=function(t,e){this._gl.uniform1iv(t.location,e)},i.upload2i=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._gl.uniform2i(t.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2i(t.location,e.x,e.y),n.x=e.x,n.y=e.y)},i.upload2iv=function(t,e){this._gl.uniform2iv(t.location,e)},i.upload3i=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._gl.uniform3i(t.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3i(t.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},i.upload3iv=function(t,e){this._gl.uniform3iv(t.location,e)},i.upload4i=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._gl.uniform4i(t.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4i(t.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},i.upload4iv=function(t,e){this._gl.uniform4iv(t.location,e)},i.uploadMat4=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e.elements)},i.uploadMat4v=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e)},i.uploadTexture=function(t,e){var n=this._rhi;n.activeTexture(t.textureIndex),n.bindTexture(e._platformTexture),e._setUseDepthCompareMode(t.textureUseCompareMode)},i.uploadTextureArray=function(t,e){for(var n=this._rhi,o=t.textureIndex,s=0;s<e.length;s++){var l=e[s];n.activeTexture(o[s]),n.bindTexture(l._platformTexture),l._setUseDepthCompareMode(t.textureUseCompareMode)}},r}(),ts=function(){this.constUniforms=[],this.textureUniforms=[]},nm=function(){function r(a,t,e){this.sceneUniformBlock=new ts,this.cameraUniformBlock=new ts,this.rendererUniformBlock=new ts,this.materialUniformBlock=new ts,this.otherUniformBlock=new ts,this._uploadRenderCount=-1,this.attributeLocation=Object.create(null),this._activeTextureUint=0,this._engine=a,this._gl=a._hardwareRenderer.gl,this._glProgram=this._createProgram(t,e),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=r._counter++}var i=r.prototype;return i.uploadAll=function(t,e){this.uploadUniforms(t,e),this.uploadTextures(t,e)},i.uploadUniforms=function(t,e){for(var n=e._propertyValueMap,o=t.constUniforms,s=0,l=o.length;s<l;s++){var c=o[s],u=n[c.propertyId];u!=null&&c.applyFunc(c,u)}},i.uploadTextures=function(t,e){var n=e._propertyValueMap,o=t.textureUniforms;if(o)for(var s=0,l=o.length;s<l;s++){var c=o[s],u=n[c.propertyId];u&&!u.destroyed?c.applyFunc(c,u):c.applyFunc(c,c.textureDefault)}},i.uploadUnGroupTextures=function(){var t=this.otherUniformBlock.textureUniforms;if(t)for(var e=0,n=t.length;e<n;e++){var o=t[e];o.applyFunc(o,o.textureDefault)}},i.groupingOtherUniformBlock=function(){var t=this.otherUniformBlock,e=t.constUniforms,n=t.textureUniforms;e.length>0&&this._groupingSubOtherUniforms(e,!1),n.length>0&&this._groupingSubOtherUniforms(n,!0)},i.bind=function(){var t=this._engine._hardwareRenderer;return t._currentBindShaderProgram!==this?(this._gl.useProgram(this._glProgram),t._currentBindShaderProgram=this,!0):!1},i.destroy=function(){var t=this._gl;this._glProgram&&t.deleteProgram(this._glProgram)},i._groupingSubOtherUniforms=function(t,e){for(var n=t.length-1;n>=0;n--){var o=t[n],s=k._getShaderPropertyGroup(o.name);s!==void 0&&(t.splice(t.indexOf(o),1),this._groupingUniform(o,s,e))}},i._groupingUniform=function(t,e,n){switch(e){case Dn.Scene:n?this.sceneUniformBlock.textureUniforms.push(t):this.sceneUniformBlock.constUniforms.push(t);break;case Dn.Camera:n?this.cameraUniformBlock.textureUniforms.push(t):this.cameraUniformBlock.constUniforms.push(t);break;case Dn.Renderer:n?this.rendererUniformBlock.textureUniforms.push(t):this.rendererUniformBlock.constUniforms.push(t);break;case Dn.Material:n?this.materialUniformBlock.textureUniforms.push(t):this.materialUniformBlock.constUniforms.push(t);break;default:n?this.otherUniformBlock.textureUniforms.push(t):this.otherUniformBlock.constUniforms.push(t)}},i._createProgram=function(t,e){var n=this._gl,o=this._createShader(n.VERTEX_SHADER,t);if(!o)return null;var s=this._createShader(n.FRAGMENT_SHADER,e);if(!s)return null;var l=n.createProgram();return l?(n.attachShader(l,o),n.attachShader(l,s),n.linkProgram(l),n.validateProgram(l),n.deleteShader(o),n.deleteShader(s),me.isEnabled&&!n.getProgramParameter(l,n.LINK_STATUS)&&!n.isContextLost()?(me.error(`Could not link WebGL program

`+("Shader error: "+n.getError()+`

`)+("Validate status: "+n.getProgramParameter(l,n.VALIDATE_STATUS)+`

`)+("Program information log: "+n.getProgramInfoLog(l))),n.deleteProgram(l),null):l):(console.warn("Context lost while create program."),null)},i._createShader=function(t,e){var n=this._gl,o=n.createShader(t);return o?(n.shaderSource(o,e),n.compileShader(o),me.isEnabled&&!n.getShaderParameter(o,n.COMPILE_STATUS)&&!n.isContextLost()?(console.warn(`Could not compile WebGL shader

`+("Shader type: "+(t==n.VERTEX_SHADER?"vertex":"fragment")+`

`)+(`Shader information log:
`+n.getShaderInfoLog(o)+`
`)+(`Shader source:
`+r._addLineNum(e))),n.deleteShader(o),null):o):(console.warn("Context lost while create shader."),null)},i._recordLocation=function(){var t=this,e=this._gl,n=this._glProgram,o=this._getUniformInfos(),s=this._getAttributeInfos();o.forEach(function(l){var c=l.name,u=l.size,d=l.type,f=new zx(t._engine),h=!1,_=!1;c.indexOf("[0]")>0&&(c=c.substr(0,c.length-3),h=!0);var g=e.getUniformLocation(n,c);switch(f.name=c,f.propertyId=k.getByName(c)._uniqueId,f.location=g,d){case e.FLOAT:h?f.applyFunc=f.upload1fv:(f.applyFunc=f.upload1f,f.cacheValue=0);break;case e.FLOAT_VEC2:h?f.applyFunc=f.upload2fv:(f.applyFunc=f.upload2f,f.cacheValue=new te(0,0));break;case e.FLOAT_VEC3:h?f.applyFunc=f.upload3fv:(f.applyFunc=f.upload3f,f.cacheValue=new P(0,0,0));break;case e.FLOAT_VEC4:h?f.applyFunc=f.upload4fv:(f.applyFunc=f.upload4f,f.cacheValue=new ue(0,0,0,0));break;case e.BOOL:case e.INT:h?f.applyFunc=f.upload1iv:(f.applyFunc=f.upload1i,f.cacheValue=0);break;case e.BOOL_VEC2:case e.INT_VEC2:h?f.applyFunc=f.upload2iv:(f.applyFunc=f.upload2i,f.cacheValue=new te(0,0));break;case e.BOOL_VEC3:case e.INT_VEC3:h?f.applyFunc=f.upload3iv:(f.applyFunc=f.upload3i,f.cacheValue=new P(0,0,0));break;case e.BOOL_VEC4:case e.INT_VEC4:h?f.applyFunc=f.upload4iv:(f.applyFunc=f.upload4i,f.cacheValue=new ue(0,0,0));break;case e.FLOAT_MAT4:f.applyFunc=h?f.uploadMat4v:f.uploadMat4;break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_SHADOW:var y;switch(d){case e.SAMPLER_2D:y=t._engine._magentaTexture2D;break;case e.SAMPLER_CUBE:y=t._engine._magentaTextureCube;break;case e.SAMPLER_2D_ARRAY:y=t._engine._magentaTexture2DArray;break;case e.SAMPLER_2D_SHADOW:y=t._engine._depthTexture2D,f.textureUseCompareMode=!0;break}if(_=!0,h){for(var v=new Array(u),p=new Int32Array(u),m=new Array(u),A=0;A<u;A++)v[A]=y,p[A]=t._activeTextureUint,m[A]=e.TEXTURE0+t._activeTextureUint++;f.textureDefault=v,f.textureIndex=m,f.applyFunc=f.uploadTextureArray,t.bind(),e.uniform1iv(g,p)}else{var S=e.TEXTURE0+t._activeTextureUint;f.textureDefault=y,f.textureIndex=S,f.applyFunc=f.uploadTexture,t.bind(),e.uniform1i(g,t._activeTextureUint++)}break;default:throw new Error("Unsupported uniform type")}var x=k._getShaderPropertyGroup(c);t._groupingUniform(f,x,_)}),s.forEach(function(l){var c=l.name;t.attributeLocation[c]=e.getAttribLocation(n,c)})},i._getUniformInfos=function(){for(var t=this._gl,e=this._glProgram,n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=new Array(n),s=0;s<n;++s){var l=t.getActiveUniform(e,s);o[s]=l}return o},i._getAttributeInfos=function(){for(var t=this._gl,e=this._glProgram,n=new Array,o=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s=0;s<o;++s){var l=t.getActiveAttrib(e,s);n[s]=l}return n},r._addLineNum=function(t){var e=t.split(`
`),n=(e.length+1).toString().length+6,o;return e.map(function(s,l){if(o="0:"+(l+1),o.length>=n)return o.substring(0,n)+s;for(var c=0;c<n-o.length;c++)o+=" ";return o+s}).join(`
`)},q(r,[{key:"isValid",get:function(){return this._isValid}}]),r}();(function(){nm._counter=0})();var zt=function(r){W(i,r);function i(t,e,n,o){var s;s=r.call(this)||this,s._shaderPassId=0,s._renderStateDataMap={},s._shaderProgramPools=[],s._shaderPassId=i._shaderPassCounter++,typeof n=="string"?(s._name=t,s._vertexSource=e,s._fragmentSource=n,o=o??{pipelineStage:pr.Forward}):(s._name="Default",s._vertexSource=t,s._fragmentSource=e,o=n??{pipelineStage:pr.Forward});for(var l in o)s.setTag(l,o[l]);return s}var a=i.prototype;return a._getShaderProgram=function(e,n){var o=e._getShaderProgramPool(this),s=o.get(n);if(s)return s;var l=e._hardwareRenderer.isWebGL2,c=[];se._getNamesByMacros(n,c);var u=Ui.parseCustomMacros(c),d=l?"#version 300 es":"#version 100",f=l?"#define GRAPHICS_API_WEBGL2":"#define GRAPHICS_API_WEBGL1",h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      precision highp int;
    #else
      precision mediump float;
      precision mediump int;
    #endif
    `;e._hardwareRenderer.canIUse(J.shaderTextureLod)&&(h+=`#define HAS_TEX_LOD
`),e._hardwareRenderer.canIUse(J.standardDerivatives)&&(h+=`#define HAS_DERIVATIVES
`);var _=" "+d+`
        `+f+`
        `+u+`
      `+Ui.parseIncludes(this._vertexSource),g=" "+d+`
        `+f+`
        `+(l?"":Ui._shaderExtension)+`
        `+h+`
        `+u+`
      `+Ui.parseIncludes(this._fragmentSource);return l&&(_=Ui.convertTo300(_),g=Ui.convertTo300(g,!0)),s=new nm(e,_,g),o.cache(s),s},a._destroy=function(){for(var e=this._shaderProgramPools,n=0,o=e.length;n<o;n++)e[n]._destroy();e.length=0},i}(rm);(function(){zt._shaderPassCounter=0})();var uc=function(r){W(i,r);function i(a,t,e){var n;n=r.call(this)||this,n._name=a;var o=t.length;if(o<1)throw" count must large than 0.";n._passes=t.slice();for(var s in e)n.setTag(s,e[s]);return n}return q(i,[{key:"passes",get:function(){return this._passes}}]),i}(rm),im=function(){this.enabled=!1,this.colorBlendOperation=fr.Add,this.alphaBlendOperation=fr.Add,this.sourceColorBlendFactor=Ee.One,this.sourceAlphaBlendFactor=Ee.One,this.destinationColorBlendFactor=Ee.Zero,this.destinationAlphaBlendFactor=Ee.Zero,this.colorWriteMask=dn.All},Eu=function(){function r(){this.targetBlendState=new im,this.blendColor=new K(0,0,0,0),this.alphaToCoverage=!1}var i=r.prototype;return i._applyShaderDataValue=function(t,e){var n=this.targetBlendState,o=t[ae.BlendStateEnabled0];if(o!==void 0){var s=e.getFloat(o);n.enabled=s!==void 0?!!s:!1}var l=t[ae.BlendStateColorBlendOperation0];if(l!==void 0){var c;n.colorBlendOperation=(c=e.getFloat(l))!=null?c:fr.Add}var u=t[ae.BlendStateAlphaBlendOperation0];if(u!==void 0){var d;n.alphaBlendOperation=(d=e.getFloat(u))!=null?d:fr.Add}var f=t[ae.BlendStateSourceColorBlendFactor0];if(f!==void 0){var h;n.sourceColorBlendFactor=(h=e.getFloat(f))!=null?h:Ee.One}var _=t[ae.BlendStateSourceAlphaBlendFactor0];if(_!==void 0){var g;n.sourceAlphaBlendFactor=(g=e.getFloat(_))!=null?g:Ee.One}var y=t[ae.BlendStateDestinationColorBlendFactor0];if(y!==void 0){var v;n.destinationColorBlendFactor=(v=e.getFloat(y))!=null?v:Ee.Zero}var p=t[ae.BlendStateDestinationAlphaBlendFactor0];if(p!==void 0){var m;n.destinationAlphaBlendFactor=(m=e.getFloat(p))!=null?m:Ee.Zero}var A=t[ae.BlendStateColorWriteMask0];if(A!==void 0){var S;n.colorWriteMask=(S=e.getFloat(A))!=null?S:dn.All}var x=t[ae.BlendStateBlendColor];if(x!==void 0){var b=e.getColor(x);b!==void 0&&this.blendColor.copyFrom(b)}var C=t[ae.BlendStateAlphaToCoverage];if(C!==void 0){var w=e.getFloat(C);this.alphaToCoverage=w!==void 0?!!w:!1}},i._apply=function(t,e){this._platformApply(t,e.blendState)},i._platformApply=function(t,e){var n=t.gl,o=e.targetBlendState,s=this.targetBlendState,l=s.enabled,c=s.colorBlendOperation,u=s.alphaBlendOperation,d=s.sourceColorBlendFactor,f=s.destinationColorBlendFactor,h=s.sourceAlphaBlendFactor,_=s.destinationAlphaBlendFactor,g=s.colorWriteMask;if(l!==o.enabled&&(l?n.enable(n.BLEND):n.disable(n.BLEND),o.enabled=l),l){(d!==o.sourceColorBlendFactor||f!==o.destinationColorBlendFactor||h!==o.sourceAlphaBlendFactor||_!==o.destinationAlphaBlendFactor)&&(n.blendFuncSeparate(r._getGLBlendFactor(t,d),r._getGLBlendFactor(t,f),r._getGLBlendFactor(t,h),r._getGLBlendFactor(t,_)),o.sourceColorBlendFactor=d,o.destinationColorBlendFactor=f,o.sourceAlphaBlendFactor=h,o.destinationAlphaBlendFactor=_),(c!==o.colorBlendOperation||u!==o.alphaBlendOperation)&&(n.blendEquationSeparate(r._getGLBlendOperation(t,c),r._getGLBlendOperation(t,u)),o.colorBlendOperation=c,o.alphaBlendOperation=u);var y=this.blendColor;K.equals(e.blendColor,y)||(n.blendColor(y.r,y.g,y.b,y.a),e.blendColor.copyFrom(y))}g!==o.colorWriteMask&&(n.colorMask((g&dn.Red)!==0,(g&dn.Green)!==0,(g&dn.Blue)!==0,(g&dn.Alpha)!==0),o.colorWriteMask=g);var v=this.alphaToCoverage;v!==e.alphaToCoverage&&(v?n.enable(n.SAMPLE_ALPHA_TO_COVERAGE):n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),e.alphaToCoverage=v)},r._getGLBlendFactor=function(t,e){var n=t.gl;switch(e){case Ee.Zero:return n.ZERO;case Ee.One:return n.ONE;case Ee.SourceColor:return n.SRC_COLOR;case Ee.OneMinusSourceColor:return n.ONE_MINUS_SRC_COLOR;case Ee.DestinationColor:return n.DST_COLOR;case Ee.OneMinusDestinationColor:return n.ONE_MINUS_DST_COLOR;case Ee.SourceAlpha:return n.SRC_ALPHA;case Ee.OneMinusSourceAlpha:return n.ONE_MINUS_SRC_ALPHA;case Ee.DestinationAlpha:return n.DST_ALPHA;case Ee.OneMinusDestinationAlpha:return n.ONE_MINUS_DST_ALPHA;case Ee.SourceAlphaSaturate:return n.SRC_ALPHA_SATURATE;case Ee.BlendColor:return n.CONSTANT_COLOR;case Ee.OneMinusBlendColor:return n.ONE_MINUS_CONSTANT_COLOR}},r._getGLBlendOperation=function(t,e){var n=t.gl;switch(e){case fr.Add:return n.FUNC_ADD;case fr.Subtract:return n.FUNC_SUBTRACT;case fr.ReverseSubtract:return n.FUNC_REVERSE_SUBTRACT;case fr.Min:if(!t.canIUse(J.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return n.MIN;case fr.Max:if(!t.canIUse(J.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return n.MAX}},r}();R([Z],Eu.prototype,"targetBlendState",void 0);R([Z],Eu.prototype,"blendColor",void 0);var am=function(){function r(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=Te.Less}var i=r.prototype;return i._applyShaderDataValue=function(t,e){var n=t[ae.DepthStateEnabled];if(n!==void 0){var o=e.getFloat(n);this.enabled=o!==void 0?!!o:!1}var s=t[ae.DepthStateWriteEnabled];if(s!==void 0){var l=e.getFloat(s);this.writeEnabled=l!==void 0?!!l:!1}var c=t[ae.DepthStateCompareFunction];if(c!==void 0){var u;this.compareFunction=(u=e.getFloat(c))!=null?u:Te.Less}},i._apply=function(t,e){this._platformApply(t,e.depthState)},i._platformApply=function(t,e){var n=t.gl,o=this,s=o.enabled,l=o.compareFunction,c=o.writeEnabled;s!=e.enabled&&(s?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),e.enabled=s),s&&(l!=e.compareFunction&&(n.depthFunc(r._getGLCompareFunction(t,l)),e.compareFunction=l),c!=e.writeEnabled&&(n.depthMask(c),e.writeEnabled=c))},r._getGLCompareFunction=function(t,e){var n=t.gl;switch(e){case Te.Never:return n.NEVER;case Te.Less:return n.LESS;case Te.Equal:return n.EQUAL;case Te.LessEqual:return n.LEQUAL;case Te.Greater:return n.GREATER;case Te.NotEqual:return n.NOTEQUAL;case Te.GreaterEqual:return n.GEQUAL;case Te.Always:return n.ALWAYS}},r}(),om=function(){function r(){this.cullMode=Mr.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0,this._frontFaceInvert=!1}var i=r.prototype;return i._applyShaderDataValue=function(t,e){var n=t[ae.RasterStateCullMode];if(n!==void 0){var o;this.cullMode=(o=e.getFloat(n))!=null?o:Mr.Back}var s=t[ae.RasterStateDepthBias];if(s!==void 0){var l;this.depthBias=(l=e.getFloat(s))!=null?l:0}var c=t[ae.RasterStateSlopeScaledDepthBias];if(c!==void 0){var u;this.slopeScaledDepthBias=(u=e.getFloat(c))!=null?u:0}},i._apply=function(t,e,n){this._platformApply(t,e.rasterState,n)},i._platformApply=function(t,e,n){var o=t.gl,s=this,l=s.cullMode,c=s.depthBias,u=s.slopeScaledDepthBias,d=l!==Mr.Off;d!==e._cullFaceEnable&&(d?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),e._cullFaceEnable=d),d&&l!==e.cullMode&&(l==Mr.Back?o.cullFace(o.BACK):o.cullFace(o.FRONT),e.cullMode=l),n!==e._frontFaceInvert&&(n?o.frontFace(o.CW):o.frontFace(o.CCW),e._frontFaceInvert=n),t._enableGlobalDepthBias||(c!==e.depthBias||u!==e.slopeScaledDepthBias)&&(c!==0||u!==0?(o.enable(o.POLYGON_OFFSET_FILL),o.polygonOffset(u,c)):o.disable(o.POLYGON_OFFSET_FILL),e.depthBias=c,e.slopeScaledDepthBias=u)},r}(),sm=function(){function r(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=Te.Always,this.compareFunctionBack=Te.Always,this.passOperationFront=Je.Keep,this.passOperationBack=Je.Keep,this.failOperationFront=Je.Keep,this.failOperationBack=Je.Keep,this.zFailOperationFront=Je.Keep,this.zFailOperationBack=Je.Keep}var i=r.prototype;return i._applyShaderDataValue=function(t,e){var n=t[ae.StencilStateEnabled];if(n!==void 0){var o=e.getFloat(n);this.enabled=o!==void 0?!!o:!1}var s=t[ae.StencilStateReferenceValue];if(s!==void 0){var l;this.referenceValue=(l=e.getFloat(s))!=null?l:0}var c=t[ae.StencilStateMask];if(c!==void 0){var u;this.mask=(u=e.getFloat(c))!=null?u:255}var d=t[ae.StencilStateWriteMask];if(d!==void 0){var f;this.writeMask=(f=e.getFloat(d))!=null?f:255}var h=t[ae.StencilStateCompareFunctionFront];if(h!==void 0){var _;this.compareFunctionFront=(_=e.getFloat(h))!=null?_:Te.Always}var g=t[ae.StencilStateCompareFunctionBack];if(g!==void 0){var y;this.compareFunctionBack=(y=e.getFloat(g))!=null?y:Te.Always}var v=t[ae.StencilStatePassOperationFront];if(v!==void 0){var p;this.passOperationFront=(p=e.getFloat(v))!=null?p:Je.Keep}var m=t[ae.StencilStatePassOperationBack];if(m!==void 0){var A;this.passOperationBack=(A=e.getFloat(m))!=null?A:Je.Keep}var S=t[ae.StencilStateFailOperationFront];if(S!==void 0){var x;this.failOperationFront=(x=e.getFloat(S))!=null?x:Je.Keep}var b=t[ae.StencilStateFailOperationBack];if(b!==void 0){var C;this.failOperationBack=(C=e.getFloat(b))!=null?C:Je.Keep}var w=t[ae.StencilStateZFailOperationFront];if(w!==void 0){var E;this.zFailOperationFront=(E=e.getFloat(w))!=null?E:Je.Keep}var T=t[ae.StencilStateZFailOperationBack];if(T!==void 0){var M;this.zFailOperationBack=(M=e.getFloat(T))!=null?M:Je.Keep}},i._apply=function(t,e){this._platformApply(t,e.stencilState)},i._platformApply=function(t,e){var n=t.gl,o=this,s=o.enabled,l=o.referenceValue,c=o.mask,u=o.compareFunctionFront,d=o.compareFunctionBack,f=o.failOperationFront,h=o.zFailOperationFront,_=o.passOperationFront,g=o.failOperationBack,y=o.zFailOperationBack,v=o.passOperationBack,p=o.writeMask;if(s!=e.enabled&&(s?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),e.enabled=s),s){var m=l!==e.referenceValue||c!==e.mask;(m||u!==e.compareFunctionFront)&&(n.stencilFuncSeparate(n.FRONT,r._getGLCompareFunction(t,u),l,c),e.compareFunctionFront=u),(m||d!==e.compareFunctionBack)&&(n.stencilFuncSeparate(n.BACK,r._getGLCompareFunction(t,d),l,c),e.compareFunctionBack=this.compareFunctionBack),m&&(e.referenceValue=this.referenceValue,e.mask=this.mask),(f!==e.failOperationFront||h!==e.zFailOperationFront||_!==e.passOperationFront)&&(n.stencilOpSeparate(n.FRONT,r._getGLStencilOperation(t,f),r._getGLStencilOperation(t,h),r._getGLStencilOperation(t,_)),e.failOperationFront=f,e.zFailOperationFront=h,e.passOperationFront=_),(g!==e.failOperationBack||y!==e.zFailOperationBack||v!==e.passOperationBack)&&(n.stencilOpSeparate(n.BACK,r._getGLStencilOperation(t,g),r._getGLStencilOperation(t,y),r._getGLStencilOperation(t,v)),e.failOperationBack=g,e.zFailOperationBack=y,e.passOperationBack=v),p!==e.writeMask&&(n.stencilMask(p),e.writeMask=p)}},r._getGLCompareFunction=function(t,e){var n=t.gl;switch(e){case Te.Never:return n.NEVER;case Te.Less:return n.LESS;case Te.Equal:return n.EQUAL;case Te.LessEqual:return n.LEQUAL;case Te.Greater:return n.GREATER;case Te.NotEqual:return n.NOTEQUAL;case Te.GreaterEqual:return n.GEQUAL;case Te.Always:return n.ALWAYS}},r._getGLStencilOperation=function(t,e){var n=t.gl;switch(e){case Je.Keep:return n.KEEP;case Je.Zero:return n.ZERO;case Je.Replace:return n.REPLACE;case Je.IncrementSaturate:return n.INCR;case Je.DecrementSaturate:return n.DECR;case Je.Invert:return n.INVERT;case Je.IncrementWrap:return n.INCR_WRAP;case Je.DecrementWrap:return n.DECR_WRAP}},r}(),$n=function(){function r(){this.blendState=new Eu,this.depthState=new am,this.stencilState=new sm,this.rasterState=new om,this.renderQueueType=Dt.Opaque}var i=r.prototype;return i._applyShaderDataValue=function(t,e){this.blendState._applyShaderDataValue(t,e),this.depthState._applyShaderDataValue(t,e),this.stencilState._applyShaderDataValue(t,e),this.rasterState._applyShaderDataValue(t,e);var n=t[ae.RenderQueueType];if(n!==void 0){var o;this.renderQueueType=(o=e.getFloat(n))!=null?o:Dt.Opaque}},i._apply=function(t,e,n,o){n&&this._applyShaderDataValue(n,o);var s=t._hardwareRenderer,l=t._lastRenderState;this.blendState._apply(s,l),this.depthState._apply(s,l),this.stencilState._apply(s,l),this.rasterState._apply(s,l,e)},r}();R([Z],$n.prototype,"blendState",void 0);R([Z],$n.prototype,"depthState",void 0);R([Z],$n.prototype,"stencilState",void 0);R([Z],$n.prototype,"rasterState",void 0);var Le=function(){function r(a,t){this.name=a,this._refCount=0,this._destroyed=!1,this.name=a,this._subShaders=t}var i=r.prototype;return i.compileVariant=function(t,e){var n=r._compileMacros;n.clear();for(var o=0,s=e.length;o<s;o++)n.enable(se.getByName(e[o]));for(var l=!1,c=this._subShaders,u=0,d=c.length;u<d;u++)for(var f=c[u].passes,h=0,_=f.length;h<_;h++){var g=f[h]._getShaderProgram(t,n);l=(h===0||l)&&g.isValid}return l},i.destroy=function(t){if(t===void 0&&(t=!1),!t&&this._refCount!==0)return!1;for(var e=this._subShaders,n=0,o=e.length;n<o;n++)for(var s=e[n].passes,l=0,c=s.length;l<c;l++)s[l]._destroy();return delete r._shaderMap[this.name],this._destroyed=!0,!0},i._getReferCount=function(){return this._refCount},i._addReferCount=function(t){this._refCount+=t},r.create=function(t,e,n){var o,s=r._shaderMap;if(e){if(s[t])throw'Shader named "'+t+'" already exists.';if(typeof e=="string"){var u=new zt(e,n);o=new r(t,[new uc("Default",[u])])}else if(e.length>0)e[0].constructor===zt?o=new r(t,[new uc("Default",e)]):o=new r(t,e.slice());else throw"SubShader or ShaderPass count must large than 0."}else{if(!r._shaderLab)throw"ShaderLab has not been set up yet.";var l=r._shaderLab.parseShader(t);if(s[l.name])throw'Shader named "'+l.name+'" already exists.';var c=l.subShaders.map(function(d){var f=d.passes.map(function(h){if(typeof h=="string"){var _,g,y=h.split("/");return(g=r.find(y[0]))==null||(_=g.subShaders.find(function(w){return w.name===y[1]}))==null?void 0:_.passes.find(function(w){return w.name===y[2]})}var v=new zt(h.name,h.vertexSource,h.fragmentSource,h.tags),p=h.renderStates,m=new $n;v._renderState=m;var A=p[0];for(var S in A)r._applyConstRenderStates(m,parseInt(S),A[S]);var x=p[1],b={};for(var C in x)b[C]=k.getByName(x[C]);return v._renderStateDataMap=b,v});return new uc(l.name,f,d.tags)});return o=new r(l.name,c),s[l.name]=o,o}return s[t]=o,o},r.find=function(t){return r._shaderMap[t]},r._applyConstRenderStates=function(t,e,n){switch(e){case ae.BlendStateEnabled0:t.blendState.targetBlendState.enabled=n;break;case ae.BlendStateColorBlendOperation0:t.blendState.targetBlendState.colorBlendOperation=n;break;case ae.BlendStateAlphaBlendOperation0:t.blendState.targetBlendState.alphaBlendOperation=n;break;case ae.BlendStateSourceColorBlendFactor0:t.blendState.targetBlendState.sourceColorBlendFactor=n;break;case ae.BlendStateDestinationColorBlendFactor0:t.blendState.targetBlendState.destinationColorBlendFactor=n;break;case ae.BlendStateSourceAlphaBlendFactor0:t.blendState.targetBlendState.sourceAlphaBlendFactor=n;break;case ae.BlendStateDestinationAlphaBlendFactor0:t.blendState.targetBlendState.destinationAlphaBlendFactor=n;break;case ae.BlendStateColorWriteMask0:t.blendState.targetBlendState.colorWriteMask=n;break;case ae.DepthStateEnabled:t.depthState.enabled=n;break;case ae.DepthStateWriteEnabled:t.depthState.writeEnabled=n;break;case ae.DepthStateCompareFunction:t.depthState.compareFunction=n;break;case ae.StencilStateEnabled:t.stencilState.enabled=n;break;case ae.StencilStateReferenceValue:t.stencilState.referenceValue=n;break;case ae.StencilStateMask:t.stencilState.mask=n;break;case ae.StencilStateWriteMask:t.stencilState.writeMask=n;break;case ae.StencilStateCompareFunctionFront:t.stencilState.compareFunctionFront=n;break;case ae.StencilStateCompareFunctionBack:t.stencilState.compareFunctionBack=n;break;case ae.StencilStatePassOperationFront:t.stencilState.passOperationFront=n;break;case ae.StencilStatePassOperationBack:t.stencilState.passOperationBack=n;break;case ae.StencilStateFailOperationFront:t.stencilState.failOperationFront=n;break;case ae.StencilStateFailOperationBack:t.stencilState.failOperationBack=n;break;case ae.StencilStateZFailOperationFront:t.stencilState.zFailOperationFront=n;break;case ae.StencilStateZFailOperationBack:t.stencilState.zFailOperationBack=n;break;case ae.RasterStateCullMode:t.rasterState.cullMode=n;break;case ae.RasterStateDepthBias:t.rasterState.depthBias=n;break;case ae.RasterStateSlopeScaledDepthBias:t.rasterState.slopeScaledDepthBias=n;break;case ae.RenderQueueType:t.renderQueueType=n;break}},r.getMacroByName=function(t,e){return se.getByName(t,e)},r.getPropertyByName=function(t){return k.getByName(t)},q(r,[{key:"subShaders",get:function(){return this._subShaders}},{key:"destroyed",get:function(){return this._destroyed}}]),r}();(function(){Le._compileMacros=new Ir})();(function(){Le._shaderMap=Object.create(null)})();var wu=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._isContentLost=!1,t.resourceManager._addGraphicResource(he(e)),e}var a=i.prototype;return a._onDestroy=function(){r.prototype._onDestroy.call(this),this.engine.resourceManager._deleteGraphicResource(this)},q(i,[{key:"isContentLost",get:function(){return this._isContentLost}}]),i}(ni),Kn=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t._isDepthTexture=!1,t._anisoLevel=1,t._useDepthCompareMode=!1,t}var a=i.prototype;return a.generateMipmaps=function(){this._mipmap&&this._platformTexture.generateMipmaps()},a._setUseDepthCompareMode=function(e){this._useDepthCompareMode!==e&&(this._platformTexture.setUseDepthCompareMode(e),this._useDepthCompareMode=e)},a._rebuild=function(){var e=this._platformTexture;e.wrapModeU=this._wrapModeU,e.wrapModeV=this._wrapModeV,e.filterMode=this._filterMode,e.anisoLevel=this._anisoLevel,this._engine._hardwareRenderer._isWebGL2&&(e.depthCompareFunction=this._depthCompareFunction,e.setUseDepthCompareMode(this._useDepthCompareMode))},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._platformTexture.destroy(),this._platformTexture=null},a._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},a._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},q(i,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"usage",get:function(){return this._usage}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var n=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>n&&(me.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+n),e=n),e<1&&(me.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}},{key:"depthCompareFunction",get:function(){return this._depthCompareFunction},set:function(e){if(!this._engine._hardwareRenderer._isWebGL2){console.warn("depthCompareFunction only support WebGL2");return}e!==this._depthCompareFunction&&(this._depthCompareFunction=e,this._platformTexture.depthCompareFunction=e)}}]),i}(wu),ii=function(){function r(a){this._propertyValueMap=Object.create(null),this._macroCollection=new Ir,this._macroMap=Object.create(null),this._refCount=0,this._group=a}var i=r.prototype;return i.getFloat=function(t){return this.getPropertyValue(t)},i.setFloat=function(t,e){this._setPropertyValue(t,lr.Float,e)},i.getInt=function(t){return this.getPropertyValue(t)},i.setInt=function(t,e){this._setPropertyValue(t,lr.Int,e)},i.getFloatArray=function(t){return this.getPropertyValue(t)},i.setFloatArray=function(t,e){this._setPropertyValue(t,lr.FloatArray,e)},i.getIntArray=function(t){return this.getPropertyValue(t)},i.setIntArray=function(t,e){this._setPropertyValue(t,lr.IntArray,e)},i.getVector2=function(t){return this.getPropertyValue(t)},i.setVector2=function(t,e){this._setPropertyValue(t,lr.Vector2,e)},i.getVector3=function(t){return this.getPropertyValue(t)},i.setVector3=function(t,e){this._setPropertyValue(t,lr.Vector3,e)},i.getVector4=function(t){return this.getPropertyValue(t)},i.setVector4=function(t,e){this._setPropertyValue(t,lr.Vector4,e)},i.getMatrix=function(t){return this.getPropertyValue(t)},i.setMatrix=function(t,e){this._setPropertyValue(t,lr.Matrix,e)},i.getColor=function(t){return this.getPropertyValue(t)},i.setColor=function(t,e){this._setPropertyValue(t,lr.Color,e)},i.getTexture=function(t){return this.getPropertyValue(t)},i.setTexture=function(t,e){var n=this._refCount;if(n>0){var o=this.getPropertyValue(t);o&&o._addReferCount(-n),e&&e._addReferCount(n)}this._setPropertyValue(t,lr.Texture,e)},i.getTextureArray=function(t){return this.getPropertyValue(t)},i.setTextureArray=function(t,e){var n=this._refCount;if(n>0){var o=this.getPropertyValue(t);if(o)for(var s=0,l=o.length;s<l;s++)o[s]._addReferCount(-n);if(e)for(var c=0,u=e.length;c<u;c++)e[c]._addReferCount(n)}this._setPropertyValue(t,lr.TextureArray,e)},i.getPropertyValue=function(t){return typeof t=="string"&&(t=k.getByName(t)),this._propertyValueMap[t._uniqueId]},i.enableMacro=function(t,e){typeof t=="string"&&(t=se.getByName(t,e));var n=t._nameId,o=this._macroMap[n];if(o!==t){var s=this._macroCollection;o&&s.disable(o),s.enable(t),this._macroMap[n]=t}},i.disableMacro=function(t){var e;if(typeof t=="string"){if(e=se._macroNameIdMap[t],e===void 0)return}else e=t._nameId;var n=this._macroMap[e];n&&(this._macroCollection.disable(n),delete this._macroMap[e])},i.getMacros=function(t){if(t){var e=this._macroMap;t.length=0;for(var n in e)t.push(e[n])}else return Object.values(this._macroMap)},i.getProperties=function(t){var e;t?(t.length=0,e=t):e=[];var n=this._propertyValueMap,o=k._propertyIdMap;for(var s in n)e.push(o[s]);if(!t)return e},i.clone=function(){var t=new r(this._group);return this.cloneTo(t),t},i.cloneTo=function(t){mn.deepCloneObject(this._macroCollection,t._macroCollection),Object.assign(t._macroMap,this._macroMap);for(var e=t._getReferCount(),n=this._propertyValueMap,o=t._propertyValueMap,s=Object.keys(n),l=0,c=s.length;l<c;l++){var u=s[l],d=n[u];if(d!=null)if(typeof d=="number")o[u]=d;else if(mt(d,Kn))o[u]=d,e>0&&d._addReferCount(e);else if(mt(d,Array)||mt(d,Float32Array)||mt(d,Int32Array))o[u]=d.slice();else{var f=o[u];f?f.copyFrom(d):o[u]=d.clone()}else o[u]=d}},i._setPropertyValue=function(t,e,n){if(typeof t=="string"&&(t=k.getByName(t)),t._group!==this._group)if(t._group===void 0)t._group=this._group;else throw"Shader property "+t.name+" has been used as "+Dn[t._group]+" group.";if(t._type!==e)if(t._type===void 0)t._type=e;else throw"Shader property "+t.name+" has been used as "+lr[t._type]+" type.";this._propertyValueMap[t._uniqueId]=n},i._getReferCount=function(){return this._refCount},i._addReferCount=function(t){this._refCount+=t;var e=this._propertyValueMap;for(var n in e){var o=e[n];o&&mt(o,Kn)&&o._addReferCount(t)}},r}();R([z],ii.prototype,"_group",void 0);R([z],ii.prototype,"_propertyValueMap",void 0);R([z],ii.prototype,"_macroCollection",void 0);R([z],ii.prototype,"_macroMap",void 0);R([z],ii.prototype,"_refCount",void 0);var Cn,Ce=(Cn=function(r){W(i,r);function i(t){var e;e=r.call(this,t)||this,e._onUpdateIndex=-1,e._rendererIndex=-1,e._globalShaderMacro=new Ir,e._bounds=new qt,e._overrideUpdate=!1,e._materials=[],e._dirtyUpdateFlag=0,e._shaderData=new ii(Dn.Renderer),e._mvMatrix=new $,e._mvpMatrix=new $,e._mvInvMatrix=new $,e._normalMatrix=new $,e._materialsInstanced=[],e._priority=0,e._receiveShadows=!0,e._rendererLayer=new ue,e.castShadows=!0;var n=Ce.prototype,o=e.shaderData;return e._overrideUpdate=e.update!==n.update,e._addResourceReferCount(e.shaderData,1),e._onTransformChanged=e._onTransformChanged.bind(he(e)),e._registerEntityTransformListener(),o.enableMacro(Ce._receiveShadowMacro),o.setVector4(Ce._rendererLayerProperty,e._rendererLayer),e}var a=i.prototype;return a.getInstanceMaterial=function(e){e===void 0&&(e=0);var n=this._materials;if(n.length>e){var o=n[e];if(o)return this._materialsInstanced[e]?o:this._createInstanceMaterial(o,e)}return null},a.getMaterial=function(e){return e===void 0&&(e=0),this._materials[e]||null},a.setMaterial=function(e,n){n===void 0&&(n=null),typeof e=="number"?this._setMaterial(e,n):this._setMaterial(0,e)},a.getInstanceMaterials=function(){for(var e=this._materials,n=this._materialsInstanced,o=0,s=e.length;o<s;o++)n[o]||this._createInstanceMaterial(this._materials[o],o);return e},a.getMaterials=function(){return this._materials},a.setMaterials=function(e){for(var n=e.length,o=this._materials,s=this._materialsInstanced,l=n,c=o.length;l<c;l++){var u=o[l];u&&this._addResourceReferCount(u,-1)}o.length!==n&&(o.length=n),s.length!==0&&(s.length=0);for(var d=0;d<n;d++){var f=o[d],h=e[d];f!==h&&(o[d]=h,f&&this._addResourceReferCount(f,-1),h&&this._addResourceReferCount(h,1))}},a.update=function(e){},a._onEnableInScene=function(){var e=this.scene._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},a._onDisableInScene=function(){var e=this.scene._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},a._prepareRender=function(e){var n=e.virtualCamera,o=n.position,s=this.bounds.getCenter(Ce._tempVector0);n.isOrthographic?(P.subtract(s,o,s),this._distanceForSort=P.dot(s,n.forward)):this._distanceForSort=P.distanceSquared(s,o),this._updateShaderData(e),this._render(e),Ir.unionCollection(e.camera._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro)},a._cloneTo=function(e,n,o){for(var s=this._materials,l=0,c=s.length;l<c;l++)e._setMaterial(l,s[l])},a._onDestroy=function(){r.prototype._onDestroy.call(this),this.entity.transform._updateFlagManager.removeListener(this._onTransformChanged),this._addResourceReferCount(this.shaderData,-1);for(var e=this._materials,n=0,o=e.length;n<o;n++){var s=e[n];s&&this._addResourceReferCount(s,-1)}this._entity=null,this._globalShaderMacro=null,this._bounds=null,this._materials=null,this._shaderData=null,this._mvMatrix=null,this._mvpMatrix=null,this._mvInvMatrix=null,this._normalMatrix=null,this._materialsInstanced=null,this._rendererLayer=null},a._updateShaderData=function(e){var n=this.entity,o=n.transform.worldMatrix;this._updateTransformShaderData(e,o);var s=n.layer;this._rendererLayer.set(s&65535,s>>>16&65535,0,0)},a._updateTransformShaderData=function(e,n){var o=this.shaderData,s=e.virtualCamera,l=this._mvMatrix,c=this._mvpMatrix,u=this._mvInvMatrix,d=this._normalMatrix;$.multiply(s.viewMatrix,n,l),$.multiply(s.viewProjectionMatrix,n,c),$.invert(l,u),$.invert(n,d),d.transpose(),o.setMatrix(Ce._localMatrixProperty,this.entity.transform.localMatrix),o.setMatrix(Ce._worldMatrixProperty,n),o.setMatrix(Ce._mvMatrixProperty,l),o.setMatrix(Ce._mvpMatrixProperty,c),o.setMatrix(Ce._mvInvMatrixProperty,u),o.setMatrix(Ce._normalMatrixProperty,d)},a._registerEntityTransformListener=function(){this.entity.transform._updateFlagManager.addListener(this._onTransformChanged)},a._updateBounds=function(e){},a._render=function(e){throw"not implement"},a._createInstanceMaterial=function(e,n){var o=e.clone();return o.name=o.name+"(Instance)",this._addResourceReferCount(e,-1),this._addResourceReferCount(o,1),this._materialsInstanced[n]=!0,this._materials[n]=o,o},a._setMaterial=function(e,n){var o=this._materials;e>=o.length&&(o.length=e+1);var s=o[e];if(s!==n){var l=this._materialsInstanced;e<l.length&&(l[e]=!1),s&&this._addResourceReferCount(s,-1),n&&this._addResourceReferCount(n,1),o[e]=n}},a._onTransformChanged=function(e){this._dirtyUpdateFlag|=1},q(i,[{key:"shaderData",get:function(){return this._shaderData}},{key:"isCulled",get:function(){return!(this._renderFrameCount===void 0||this._renderFrameCount===this._engine.time.frameCount-1)}},{key:"receiveShadows",get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(e?this.shaderData.enableMacro(Ce._receiveShadowMacro):this.shaderData.disableMacro(Ce._receiveShadowMacro),this._receiveShadows=e)}},{key:"materialCount",get:function(){return this._materials.length},set:function(e){var n=this._materials,o=this._materialsInstanced;n.length!==e&&(n.length=e),o.length>e&&(o.length=e)}},{key:"bounds",get:function(){return this._dirtyUpdateFlag&1&&(this._updateBounds(this._bounds),this._dirtyUpdateFlag&=-2),this._bounds}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}}]),i}(ir),function(){Cn._tempVector0=new P}(),function(){Cn._receiveShadowMacro=se.getByName("RENDERER_IS_RECEIVE_SHADOWS")}(),function(){Cn._localMatrixProperty=k.getByName("renderer_LocalMat")}(),function(){Cn._worldMatrixProperty=k.getByName("renderer_ModelMat")}(),function(){Cn._mvMatrixProperty=k.getByName("renderer_MVMat")}(),function(){Cn._mvpMatrixProperty=k.getByName("renderer_MVPMat")}(),function(){Cn._mvInvMatrixProperty=k.getByName("renderer_MVInvMat")}(),function(){Cn._normalMatrixProperty=k.getByName("renderer_NormalMat")}(),function(){Cn._rendererLayerProperty=k.getByName("renderer_Layer")}(),Cn);R([z],Ce.prototype,"_distanceForSort",void 0);R([z],Ce.prototype,"_onUpdateIndex",void 0);R([z],Ce.prototype,"_rendererIndex",void 0);R([z],Ce.prototype,"_globalShaderMacro",void 0);R([z],Ce.prototype,"_bounds",void 0);R([z],Ce.prototype,"_renderFrameCount",void 0);R([z],Ce.prototype,"_overrideUpdate",void 0);R([z],Ce.prototype,"_materials",void 0);R([z],Ce.prototype,"_dirtyUpdateFlag",void 0);R([Z],Ce.prototype,"_shaderData",void 0);R([z],Ce.prototype,"_mvMatrix",void 0);R([z],Ce.prototype,"_mvpMatrix",void 0);R([z],Ce.prototype,"_mvInvMatrix",void 0);R([z],Ce.prototype,"_normalMatrix",void 0);R([z],Ce.prototype,"_materialsInstanced",void 0);R([Ie],Ce.prototype,"_priority",void 0);R([Ie],Ce.prototype,"_receiveShadows",void 0);R([z],Ce.prototype,"_rendererLayer",void 0);R([z],Ce.prototype,"_onTransformChanged",null);Ce=R([sl(ye,Ua.CheckOnly)],Ce);var gt;(function(r){r[r.WorldVolume=1]="WorldVolume"})(gt||(gt={}));function Sr(){return function(r){}}var Vl,pi=(Vl=function(){function r(){}return r.resetData=function(a){var t=a._verticesData,e=t.positions,n=t.uvs;t.vertexCount=e.length=n.length=4;for(var o=0;o<4;o++){var s,l,c,u;(s=e)[l=o]||(s[l]=new P),(c=n)[u=o]||(c[u]=new te)}t.triangles=pi._rectangleTriangles},r.updatePositions=function(a){var t=a.width,e=a.height,n=a.sprite,o=n.pivot,s=o.x,l=o.y,c=pi._worldMatrix,u=c.elements,d=a.entity.transform.worldMatrix,f=d.elements,h=a.flipX?-t:t,_=a.flipY?-e:e;u[0]=f[0]*h,u[1]=f[1]*h,u[2]=f[2]*h,u[4]=f[4]*_,u[5]=f[5]*_,u[6]=f[6]*_,u[8]=f[8],u[9]=f[9],u[10]=f[10],u[12]=f[12]-s*u[0]-l*u[4],u[13]=f[13]-s*u[1]-l*u[5],u[14]=f[14]-s*u[2]-l*u[6];for(var g=n._getPositions(),y=a._verticesData.positions,v=0;v<4;v++){var p=g[v],m=p.x,A=p.y;y[v].set(u[0]*m+u[4]*A+u[12],u[1]*m+u[5]*A+u[13],u[2]*m+u[6]*A+u[14])}qt.transform(n._getBounds(),c,a._bounds)},r.updateUVs=function(a){var t=a.sprite._getUVs(),e=a._verticesData.uvs,n=t[0],o=n.x,s=n.y,l=t[3],c=l.x,u=l.y;e[0].set(o,s),e[1].set(c,s),e[2].set(o,u),e[3].set(c,u)},r}(),function(){Vl._rectangleTriangles=[0,1,2,2,1,3]}(),function(){Vl._worldMatrix=new $}(),Vl);pi=R([Sr()],pi);var Ol,Qs=(Ol=function(){function r(){}return r.resetData=function(a){var t=a._verticesData,e=t.positions,n=t.uvs;t.vertexCount=e.length=n.length=16;for(var o=0;o<16;o++){var s,l,c,u;(s=e)[l=o]||(s[l]=new P),(c=n)[u=o]||(c[u]=new te)}t.triangles=Qs._rectangleTriangles},r.updatePositions=function(a){var t=a.width,e=a.height,n=a.sprite,o=a._verticesData,s=o.positions,l=o.uvs,c=n.border,u=n._getUVs(),d=n._getPositions(),f=d[0],h=f.x,_=f.y,g=d[3],y=g.x,v=g.y,p=n.width,m=n.height,A=p*c.x,S=m*c.y,x=p*c.z,b=m*c.w,C,w;if(A+x>t){var E=t/(A+x);C=[p*h*E,A*E,A*E,t-p*(1-y)*E]}else C=[p*h,A,t-x,t-p*(1-y)];if(b+S>e){var T=e/(b+S);w=[m*_*T,S*T,S*T,e-m*(1-v)*T]}else w=[m*_,S,e-b,e-m*(1-v)];var M=a.sprite.pivot,B=M.x,I=M.y,F=a.width*B,L=a.height*I,V=Qs._worldMatrix,D=V.elements,N=a.entity.transform.worldMatrix,O=N.elements,G=a.flipX?-1:1,Q=a.flipY?-1:1;D[0]=O[0]*G,D[1]=O[1]*G,D[2]=O[2]*G,D[4]=O[4]*Q,D[5]=O[5]*Q,D[6]=O[6]*Q,D[8]=O[8],D[9]=O[9],D[10]=O[10],D[12]=O[12]-F*D[0]-L*D[4],D[13]=O[13]-F*D[1]-L*D[5],D[14]=O[14]-F*D[2]-L*D[6];for(var H=0;H<4;H++)for(var ee=C[H],ve=u[H].x,oe=0;oe<4;oe++){var ne=w[oe],Me=H*4+oe;s[Me].set(D[0]*ee+D[4]*ne+D[12],D[1]*ee+D[5]*ne+D[13],D[2]*ee+D[6]*ne+D[14]),l[Me].set(ve,u[oe].y)}var He=a._bounds,ot=He.min,be=He.max;ot.set(C[0],w[0],0),be.set(C[3],w[3],0),a._bounds.transform(V)},r.updateUVs=function(a){},r}(),function(){Ol._rectangleTriangles=[0,1,4,1,5,4,1,2,5,2,6,5,2,3,6,3,7,6,4,5,8,5,9,8,5,6,9,6,10,9,6,7,10,7,11,10,8,9,12,9,13,12,9,10,13,10,14,13,10,11,14,11,15,14]}(),function(){Ol._worldMatrix=new $}(),Ol);Qs=R([Sr()],Qs);var $e=function(){function r(a){a===void 0&&(a=0),this.length=0,this._isLooping=!1,this._blankCount=0,this._elements=new Array(a)}var i=r.prototype;return i.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},i.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},i.set=function(t,e){if(t>=this.length)throw"Index is out of range.";this._elements[t]=e},i.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},i.deleteByIndex=function(t){var e=this._elements,n;if(this._isLooping)this._elements[t]=null,this._blankCount++;else{var o=this.length-1;t!==o&&(n=e[o],e[t]=n),e[o]=null,this.length--}return n},i.forEach=function(t,e){this._startLoop();for(var n=this._elements,o=0,s=this.length;o<s;o++){var l=n[o];l&&t(l)}this._endLoop(e)},i.forEachAndClean=function(t){this._startLoop();for(var e=this._elements,n=0,o=this.length;n<o;n++){var s=e[n];s&&t(s)}this._endLoopAndClear()},i.sort=function(t){Ye._quickSort(this._elements,0,this.length,t)},i.garbageCollection=function(){this._elements.length=this.length},i._startLoop=function(){this._isLooping=!0},i._endLoop=function(t){if(this._isLooping=!1,this._blankCount){var e=0,n=this.length-1,o=this._elements;e:do{for(;o[e];)if(++e>=n)break e;for(;!o[n];)if(e>=--n)break e;var s=o[n];t(s,e),o[e++]=s,o[n--]=null}while(e<n);this.length-=this._blankCount,this._blankCount=0}},i._endLoopAndClear=function(){this._isLooping=!1,this.length=0,this._blankCount=0},r}(),yt;(function(r){r[r.Static=0]="Static",r[r.Dynamic=1]="Dynamic",r[r.Stream=2]="Stream"})(yt||(yt={}));var Ri;(function(r){r[r.None=0]="None",r[r.Discard=1]="Discard"})(Ri||(Ri={}));var qr=function(r){W(i,r);function i(t,e,n,o,s){o===void 0&&(o=yt.Static),s===void 0&&(s=!1);var l;if(l=r.call(this,t)||this,l._dataUpdateManager=new On,l._engine=t,l._type=e,l._bufferUsage=o,l._readable=s,typeof n=="number")l._byteLength=n,l._platformBuffer=t._hardwareRenderer.createPlatformBuffer(e,n,o),s&&(l._data=new Uint8Array(n));else{var c=n,u=c.byteLength;if(l._byteLength=u,l._platformBuffer=t._hardwareRenderer.createPlatformBuffer(e,u,o,c),s){var d=c.constructor===ArrayBuffer?c.slice(0):c.buffer.slice(c.byteOffset,c.byteOffset+u);l._data=new Uint8Array(d)}}return l}var a=i.prototype;return a.bind=function(){this._platformBuffer.bind()},a.setData=function(e,n,o,s,l){if(n===void 0&&(n=0),o===void 0&&(o=0),l===void 0&&(l=Ri.None),this._platformBuffer.setData(this._byteLength,e,n,o,s,l),this._readable){var c=e.constructor===ArrayBuffer?e:e.buffer;if(this._data.buffer!==c){var u=e.BYTES_PER_ELEMENT||1,d=s?u*s:e.byteLength,f=e.byteOffset!==void 0,h=f?e.byteOffset+o*u:o,_=new Uint8Array(c,h,d);this._data.set(_,n)}}this._isContentLost=!1,this._dataUpdateManager.dispatch()},a.getData=function(e,n,o,s){n===void 0&&(n=0),o===void 0&&(o=0),this._platformBuffer.getData(e,n,o,s)},a.markAsUnreadable=function(){this._data=null,this._readable=!1},a._rebuild=function(){var e=this._engine._hardwareRenderer.createPlatformBuffer(this._type,this._byteLength,this._bufferUsage);this._platformBuffer=e},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._platformBuffer.destroy()},q(i,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}},{key:"readable",get:function(){return this._readable}},{key:"data",get:function(){if(this._readable)return this._data;throw"Buffer is not readable."}}]),i}(wu),Wt;(function(r){r[r.UInt8=0]="UInt8",r[r.UInt16=1]="UInt16",r[r.UInt32=2]="UInt32"})(Wt||(Wt={}));var ie;(function(r){r[r.Float=0]="Float",r[r.Vector2=1]="Vector2",r[r.Vector3=2]="Vector3",r[r.Vector4=3]="Vector4",r[r.Byte4=4]="Byte4",r[r.UByte4=5]="UByte4",r[r.NormalizedByte4=6]="NormalizedByte4",r[r.NormalizedUByte4=7]="NormalizedUByte4",r[r.Short2=8]="Short2",r[r.UShort2=9]="UShort2",r[r.NormalizedShort2=10]="NormalizedShort2",r[r.NormalizedUShort2=11]="NormalizedUShort2",r[r.Short4=12]="Short4",r[r.UShort4=13]="UShort4",r[r.NormalizedShort4=14]="NormalizedShort4",r[r.NormalizedUShort4=15]="NormalizedUShort4"})(ie||(ie={}));var Vc=function(){function r(){}return r._getGLIndexType=function(a){switch(a){case Wt.UInt8:return We.UNSIGNED_BYTE;case Wt.UInt16:return We.UNSIGNED_SHORT;case Wt.UInt32:return We.UNSIGNED_INT}},r._getGLIndexByteCount=function(a){switch(a){case Wt.UInt8:return 1;case Wt.UInt16:return 2;case Wt.UInt32:return 4}},r._getElementInfo=function(a){var t,e,n=!1,o;switch(a){case ie.Float:t=1,e=We.FLOAT;break;case ie.Vector2:t=2,e=We.FLOAT;break;case ie.Vector3:t=3,e=We.FLOAT;break;case ie.Vector4:t=4,e=We.FLOAT;break;case ie.Byte4:t=4,e=We.BYTE;break;case ie.UByte4:t=4,e=We.UNSIGNED_BYTE;break;case ie.NormalizedByte4:t=4,e=We.BYTE,n=!0,o=1/127;break;case ie.NormalizedUByte4:t=4,e=We.UNSIGNED_BYTE,n=!0,o=1/255;break;case ie.Short2:t=2,e=We.SHORT;break;case ie.UShort2:t=2,e=We.UNSIGNED_SHORT;break;case ie.NormalizedShort2:t=2,e=We.SHORT,n=!0,o=1/32767;break;case ie.NormalizedUShort2:t=2,e=We.UNSIGNED_SHORT,n=!0,o=1/65535;break;case ie.Short4:t=4,e=We.SHORT;break;case ie.UShort4:t=4,e=We.UNSIGNED_SHORT;break;case ie.NormalizedShort4:t=4,e=We.SHORT,n=!0,o=1/32767;break;case ie.NormalizedUShort4:t=4,e=We.UNSIGNED_SHORT,n=!0,o=1/65535;break}return{size:t,type:e,normalized:n,normalizedScaleFactor:o}},r}(),mr;(function(r){r[r.VertexBuffer=0]="VertexBuffer",r[r.IndexBuffer=1]="IndexBuffer"})(mr||(mr={}));var oa;(function(r){r[r.Points=0]="Points",r[r.Lines=1]="Lines",r[r.LineLoop=2]="LineLoop",r[r.LineStrip=3]="LineStrip",r[r.Triangles=4]="Triangles",r[r.TriangleStrip=5]="TriangleStrip",r[r.TriangleFan=6]="TriangleFan"})(oa||(oa={}));var js=function(){function r(i,a){this._buffer=i,this._format=a}return q(r,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),r}(),Tu=function(){function r(a,t,e){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=oa.Triangles),this.start=a,this.count=t,this.topology=e}var i=r.prototype;return i.dispose=function(){},r}(),Bh=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e.enableVAO=!0,e.instanceCount=0,e.vertexBufferBindings=[],e._vertexElementMap={},e._bufferStructChanged=!1,e._vertexElements=[],e._platformPrimitive=t._hardwareRenderer.createPlatformPrimitive(he(e)),e}var a=i.prototype;return a.addVertexElement=function(e){var n=this._vertexElementMap,o=this._vertexElements,s=e.attribute,l=n[s];l&&(console.warn("VertexElement "+s+" already exists."),o.splice(o.indexOf(l),1)),n[s]=e,o.push(e),this._bufferStructChanged=!0},a.removeVertexElement=function(e){var n=this._vertexElements,o=n[e];n.splice(e,1),delete this._vertexElementMap[o.attribute],this._bufferStructChanged=!0},a.clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var n in e)delete e[n];this._bufferStructChanged=!0},a.setVertexElement=function(e,n){var o=this._vertexElementMap,s=this._vertexElements,l=s[e];l&&delete o[l.attribute],o[n.attribute]=n,s[e]=n,this._bufferStructChanged=!0},a.setVertexElementsLength=function(e){for(var n=this._vertexElementMap,o=this._vertexElements,s=e,l=o.length;s<l;s++){var c=o[s];delete n[c.attribute]}o.length=e},a.setVertexBufferBinding=function(e,n){var o=this._getReferCount(),s=this.vertexBufferBindings;if(o>0){var l,c;(l=s[e])==null||l.buffer._addReferCount(-o),(c=n)==null||c.buffer._addReferCount(o)}s[e]=n,this._bufferStructChanged=!0},a.setVertexBufferBindings=function(e,n){n===void 0&&(n=0);var o=this.vertexBufferBindings,s=e.length,l=n+s;o.length<l&&(o.length=l);for(var c=0;c<s;c++)this.setVertexBufferBinding(n+c,e[c])},a.setIndexBufferBinding=function(e){var n=this.indexBufferBinding,o=this._getReferCount();if(n!==e){var s,l,c;this._indexBufferBinding=e,o>0&&((s=n)==null||s.buffer._addReferCount(-o)),e?(o>0&&e.buffer._addReferCount(o),this._glIndexType=Vc._getGLIndexType(e.format),this._glIndexByteCount=Vc._getGLIndexByteCount(e.format)):this._glIndexType=void 0,this._bufferStructChanged=((l=n)==null?void 0:l.buffer)!==((c=e)==null?void 0:c.buffer)}},a.draw=function(e,n){this._platformPrimitive.draw(e,n),this._bufferStructChanged=!1},a._addReferCount=function(e){var n;r.prototype._addReferCount.call(this,e);for(var o=this.vertexBufferBindings,s=0,l=o.length;s<l;s++){var c;(c=o[s])==null||c.buffer._addReferCount(e)}(n=this.indexBufferBinding)==null||n._buffer._addReferCount(e)},a._rebuild=function(){this._engine._hardwareRenderer.createPlatformPrimitive(this),this._isContentLost=!1},a._onDestroy=function(){this._platformPrimitive.destroy(),this._vertexElementMap=null},q(i,[{key:"vertexElements",get:function(){return this._vertexElements}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}}]),i}(wu),Dh=function(r){W(i,r);function i(t,e){var n;n=r.call(this,t)||this,n._updateFlagManager=new On,n._bounds=new qt,n._subMeshes=[],n.name=e,n._primitive=new Bh(t),n._onBoundsChanged=n._onBoundsChanged.bind(he(n));var o=n._bounds;return o.min._onValueChanged=n._onBoundsChanged,o.max._onValueChanged=n._onBoundsChanged,n}var a=i.prototype;return a.addSubMesh=function(e,n,o){return o===void 0&&(o=oa.Triangles),typeof e=="number"&&(e=new Tu(e,n,o)),this._subMeshes.push(e),e},a.removeSubMesh=function(e){var n=this._subMeshes,o=n.indexOf(e);o!==-1&&n.splice(o,1)},a.clearSubMesh=function(){this._subMeshes.length=0},a._clearVertexElements=function(){this._primitive.clearVertexElements(),this._updateFlagManager.dispatch(2)},a._addVertexElement=function(e){this._primitive.addVertexElement(e),this._updateFlagManager.dispatch(2)},a._removeVertexElement=function(e){this._primitive.removeVertexElement(e),this._updateFlagManager.dispatch(2)},a._setVertexElement=function(e,n){this._primitive.setVertexElement(e,n),this._updateFlagManager.dispatch(2)},a._setVertexElementsLength=function(e){this._primitive.setVertexElementsLength(e)},a._setVertexBufferBinding=function(e,n){this._primitive.setVertexBufferBinding(e,n)},a._addReferCount=function(e){r.prototype._addReferCount.call(this,e),this._primitive._addReferCount(e)},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._primitive.destroy()},a._setVertexElements=function(e){this._clearVertexElements();for(var n=0,o=e.length;n<o;n++)this._addVertexElement(e[n])},a._setIndexBufferBinding=function(e){this._primitive.setIndexBufferBinding(e)},a._onBoundsChanged=function(){this._updateFlagManager.dispatch(1)},q(i,[{key:"bounds",get:function(){return this._bounds},set:function(e){this._bounds!==e&&this._bounds.copyFrom(e)}},{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),i}(ni),Oc;(function(r){r[r.Bounds=1]="Bounds",r[r.VertexElements=2]="VertexElements"})(Oc||(Oc={}));var Ga=function(){function r(i,a){this._buffer=i,this._stride=a}return q(r,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),r}(),De=function(){function r(i,a,t,e,n){n===void 0&&(n=0),this._attributeName=i,this._offset=a,this._format=t,this._bindingIndex=e,this._formatMetaInfo=Vc._getElementInfo(this.format),this._instanceStepRate=Math.floor(n)}return q(r,[{key:"attribute",get:function(){return this._attributeName}},{key:"offset",get:function(){return this._offset},set:function(a){this._offset=a}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex},set:function(a){this._bindingIndex=a}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}},{key:"semantic",get:function(){return this.attribute}}]),r}(),lm=function(){function r(a,t,e,n){if(e===void 0&&(e=null),n===void 0&&(n=null),this._dataChangeManager=new On,this._dirty=7,e&&e.length!==t.length)throw"deltaNormals length must same with deltaPositions length.";if(n&&n.length!==t.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=a,this._deltaPositions=t,this._deltaNormals=e,this._deltaTangents=n}var i=r.prototype;return i._releaseData=function(){this._deltaPositions=null,this._deltaNormals=null,this._deltaTangents=null},q(r,[{key:"deltaPositions",get:function(){return this._deltaPositions},set:function(t){this._deltaPositions=t,this._dirty|=1,this._dataChangeManager.dispatch(this._dirty,this)}},{key:"deltaNormals",get:function(){return this._deltaNormals},set:function(t){this._deltaNormals=t,this._dirty|=2,this._dataChangeManager.dispatch(this._dirty,this)}},{key:"deltaTangents",get:function(){return this._deltaTangents},set:function(t){this._deltaTangents=t,this._dirty|=4,this._dataChangeManager.dispatch(this._dirty,this)}}]),r}(),hf;(function(r){r[r.Position=1]="Position",r[r.Normal=2]="Normal",r[r.Tangent=4]="Tangent",r[r.All=7]="All"})(hf||(hf={}));var Lh=function(){function r(a){this._useBlendShapeNormal=!0,this._useBlendShapeTangent=!0,this._layoutChangeManager=new On,this._dataChangeManager=new On,this._frames=[],this.name=a,this._frameDataChangeListener=this._frameDataChangeListener.bind(this)}var i=r.prototype;return i.addFrame=function(t,e,n,o){if(typeof t=="number"){var s=new lm(t,e,n,o);return this._addFrame(s),s}else this._addFrame(t)},i.clearFrames=function(){for(var t=this._frames,e=0,n=t.length;e<n;e++)t[e]._dataChangeManager.removeListener(this._frameDataChangeListener);t.length=0,this._updateUseNormalAndTangent(!0,!0),this._dataChangeManager.dispatch()},i._releaseData=function(){for(var t=this._frames,e=0,n=t.length;e<n;e++)t[e]._releaseData()},i._addFrame=function(t){var e=this._frames,n=e.length;if(n>0&&t.deltaPositions.length!==e[n-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._frames.push(t),this._frameDataChangeListener(hf.All,t),t._dataChangeManager.addListener(this._frameDataChangeListener)},i._updateUseNormalAndTangent=function(t,e){var n=this._useBlendShapeNormal&&t,o=this._useBlendShapeTangent&&e;(this._useBlendShapeNormal!==n||this._useBlendShapeTangent!==o)&&(this._useBlendShapeNormal=n,this._useBlendShapeTangent=o,this._layoutChangeManager.dispatch(0,this))},i._frameDataChangeListener=function(t,e){this._updateUseNormalAndTangent(!!e.deltaNormals,!!e.deltaTangents),this._dataChangeManager.dispatch()},q(r,[{key:"frames",get:function(){return this._frames}}]),r}(),Ih=function(r){W(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.setVertexElements=function(e){this._setVertexElements(e)},a.setVertexBufferBinding=function(e,n,o){n===void 0&&(n=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new Ga(e,n));var c=this._primitive.vertexBufferBindings;c.length<=o&&(c.length=o+1),this._setVertexBufferBinding(l?n:o,s)},a.setVertexBufferBindings=function(e,n){n===void 0&&(n=0);var o=this._primitive.vertexBufferBindings,s=e.length,l=n+s;o.length<l&&(o.length=l);for(var c=0;c<s;c++)this._setVertexBufferBinding(n+c,e[c])},a.setIndexBufferBinding=function(e,n){var o=e;if(o){var s=o.buffer!==void 0;s||(o=new js(e,n))}this._setIndexBufferBinding(o)},q(i,[{key:"instanceCount",get:function(){return this._primitive.instanceCount},set:function(e){this._primitive.instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._primitive.vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._primitive.indexBufferBinding}},{key:"vertexElements",get:function(){return this._primitive.vertexElements}}]),i}(Dh),hr=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._enableVertexColor=!1,e._onMeshChanged=e._onMeshChanged.bind(he(e)),e}var a=i.prototype;return a._onDestroy=function(){var e=this._mesh;e&&(e.destroyed||this._addResourceReferCount(e,-1),e._updateFlagManager.removeListener(this._onMeshChanged),this._mesh=null),r.prototype._onDestroy.call(this)},a._cloneTo=function(e,n,o){r.prototype._cloneTo.call(this,e,n,o),e.mesh=this._mesh},a._prepareRender=function(e){if(!this._mesh){me.error("mesh is null.");return}if(this._mesh.destroyed){me.error("mesh is destroyed.");return}r.prototype._prepareRender.call(this,e)},a._updateBounds=function(e){var n=this._mesh;if(n){var o=n.bounds,s=this._entity.transform.worldMatrix;qt.transform(o,s,e)}else e.min.set(0,0,0),e.max.set(0,0,0)},a._render=function(e){var n=this._mesh;if(this._dirtyUpdateFlag&2){var o=this.shaderData,s=n._primitive.vertexElements;o.disableMacro(i._uvMacro),o.disableMacro(i._uv1Macro),o.disableMacro(i._normalMacro),o.disableMacro(i._tangentMacro),o.disableMacro(i._enableVertexColorMacro);for(var l=0,c=s.length;l<c;l++)switch(s[l].attribute){case"TEXCOORD_0":o.enableMacro(i._uvMacro);break;case"TEXCOORD_1":o.enableMacro(i._uv1Macro);break;case"NORMAL":o.enableMacro(i._normalMacro);break;case"TANGENT":o.enableMacro(i._tangentMacro);break;case"COLOR_0":this._enableVertexColor&&o.enableMacro(i._enableVertexColorMacro);break}this._dirtyUpdateFlag&=-3}for(var u=this._materials,d=n.subMeshes,f=e.camera._renderPipeline,h=this._engine._renderDataPool,_=0,g=d.length;_<g;_++){var y=u[_];if(y){(y.destroyed||y.shader.destroyed)&&(y=this.engine._meshMagentaMaterial);var v=h.getFromPool();v.setX(this,y,n._primitive,d[_]),f.pushRenderData(e,v)}}},a._setMesh=function(e){var n=this._mesh;n&&(this._addResourceReferCount(n,-1),n._updateFlagManager.removeListener(this._onMeshChanged)),e&&(this._addResourceReferCount(e,1),e._updateFlagManager.addListener(this._onMeshChanged),this._dirtyUpdateFlag|=3),this._mesh=e},a._onMeshChanged=function(e){e&Oc.Bounds&&(this._dirtyUpdateFlag|=gt.WorldVolume),e&Oc.VertexElements&&(this._dirtyUpdateFlag|=2)},q(i,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&this._setMesh(e)}},{key:"enableVertexColor",get:function(){return this._enableVertexColor},set:function(e){e!==this._enableVertexColor&&(this._dirtyUpdateFlag|=2,this._enableVertexColor=e)}}]),i}(Ce);(function(){hr._uvMacro=se.getByName("RENDERER_HAS_UV")})();(function(){hr._uv1Macro=se.getByName("RENDERER_HAS_UV1")})();(function(){hr._normalMacro=se.getByName("RENDERER_HAS_NORMAL")})();(function(){hr._tangentMacro=se.getByName("RENDERER_HAS_TANGENT")})();(function(){hr._enableVertexColorMacro=se.getByName("RENDERER_ENABLE_VERTEXCOLOR")})();R([z],hr.prototype,"_mesh",void 0);R([z],hr.prototype,"_onMeshChanged",null);var lp;(function(r){r[r.VertexElementMacro=2]="VertexElementMacro",r[r.All=3]="All"})(lp||(lp={}));var Ut;(function(r){r[r.Depth=0]="Depth",r[r.DepthStencil=1]="DepthStencil",r[r.Stencil=2]="Stencil",r[r.Depth16=3]="Depth16",r[r.Depth24=4]="Depth24",r[r.Depth32=5]="Depth32",r[r.Depth24Stencil8=6]="Depth24Stencil8",r[r.Depth32Stencil8=7]="Depth32Stencil8"})(Ut||(Ut={}));var yn;(function(r){r[r.PositiveX=0]="PositiveX",r[r.NegativeX=1]="NegativeX",r[r.PositiveY=2]="PositiveY",r[r.NegativeY=3]="NegativeY",r[r.PositiveZ=4]="PositiveZ",r[r.NegativeZ=5]="NegativeZ"})(yn||(yn={}));var an;(function(r){r[r.Never=0]="Never",r[r.Less=1]="Less",r[r.Equal=2]="Equal",r[r.LessEqual=3]="LessEqual",r[r.Greater=4]="Greater",r[r.NotEqual=5]="NotEqual",r[r.GreaterEqual=6]="GreaterEqual",r[r.Always=7]="Always"})(an||(an={}));var Xt;(function(r){r[r.Point=0]="Point",r[r.Bilinear=1]="Bilinear",r[r.Trilinear=2]="Trilinear"})(Xt||(Xt={}));var j;(function(r){r[r.R8G8B8=0]="R8G8B8",r[r.R8G8B8A8=1]="R8G8B8A8",r[r.R4G4B4A4=2]="R4G4B4A4",r[r.R5G5B5A1=3]="R5G5B5A1",r[r.R5G6B5=4]="R5G6B5",r[r.Alpha8=5]="Alpha8",r[r.LuminanceAlpha=6]="LuminanceAlpha",r[r.R16G16B16A16=7]="R16G16B16A16",r[r.R32G32B32A32=8]="R32G32B32A32",r[r.BC1=9]="BC1",r[r.BC3=10]="BC3",r[r.BC7=11]="BC7",r[r.ETC1_RGB=12]="ETC1_RGB",r[r.ETC2_RGB=13]="ETC2_RGB",r[r.ETC2_RGBA5=14]="ETC2_RGBA5",r[r.ETC2_RGBA8=15]="ETC2_RGBA8",r[r.PVRTC_RGB2=16]="PVRTC_RGB2",r[r.PVRTC_RGBA2=17]="PVRTC_RGBA2",r[r.PVRTC_RGB4=18]="PVRTC_RGB4",r[r.PVRTC_RGBA4=19]="PVRTC_RGBA4",r[r.ASTC_4x4=20]="ASTC_4x4",r[r.ASTC_5x5=21]="ASTC_5x5",r[r.ASTC_6x6=22]="ASTC_6x6",r[r.ASTC_8x8=23]="ASTC_8x8",r[r.ASTC_10x10=24]="ASTC_10x10",r[r.ASTC_12x12=25]="ASTC_12x12",r[r.Depth=26]="Depth",r[r.DepthStencil=27]="DepthStencil",r[r.Depth16=28]="Depth16",r[r.Depth24=29]="Depth24",r[r.Depth32=30]="Depth32",r[r.Depth24Stencil8=31]="Depth24Stencil8",r[r.Depth32Stencil8=32]="Depth32Stencil8",r[r.DXT1=33]="DXT1",r[r.DXT5=34]="DXT5"})(j||(j={}));var Fo;(function(r){r[r.Static=0]="Static",r[r.Dynamic=1]="Dynamic"})(Fo||(Fo={}));var rr;(function(r){r[r.Clamp=0]="Clamp",r[r.Repeat=1]="Repeat",r[r.Mirror=2]="Mirror"})(rr||(rr={}));var zc=function(r){W(i,r);function i(t,e,n,o,s,l){s===void 0&&(s=Ut.Depth),l===void 0&&(l=1);var c;if(c=r.call(this,t)||this,c._autoGenerateMipmaps=!0,c._width=e,c._height=n,c._antiAliasing=l,c._depth=s,o){for(var u=mt(o,Array)?o.slice():[o],d=0,f=u.length;d<f;d++){var h=u[d];if(h._isDepthTexture)throw"Render texture can't use depth format.";h._addReferCount(1)}c._colorTextures=u}else c._colorTextures=[];if(mt(s,Kn)){if(!s._isDepthTexture)throw"Depth texture must use depth format.";c._depthTexture=s,c._depthTexture._addReferCount(1)}return c._platformRenderTarget=t._hardwareRenderer.createPlatformRenderTarget(he(c)),c}var a=i.prototype;return a.getColorTexture=function(e){e===void 0&&(e=0);var n;return(n=this._colorTextures[e])!=null?n:null},a.generateMipmaps=function(){if(this._autoGenerateMipmaps){for(var e=this._colorTextures,n=0,o=e.length;n<o;n++){var s=e[n];s.generateMipmaps()}this._depthTexture&&this._depthTexture.generateMipmaps()}},a._onDestroy=function(){var e;r.prototype._onDestroy.call(this),this._platformRenderTarget.destroy();for(var n=this,o=n._colorTextures,s=0,l=o.length;s<l;s++)o[s]._addReferCount(-1);o.length=0,(e=this._depthTexture)==null||e._addReferCount(-1),this._depthTexture=null,this._depth=null},a._setRenderTargetInfo=function(e,n){this._platformRenderTarget.setRenderTargetInfo(e,n),this._isContentLost=!1},a._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},a._rebuild=function(){this._platformRenderTarget=this._engine._hardwareRenderer.createPlatformRenderTarget(this)},q(i,[{key:"autoGenerateMipmaps",get:function(){return this._autoGenerateMipmaps},set:function(e){this._autoGenerateMipmaps=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),i}(wu),vr=function(r){W(i,r);function i(t,e,n,o,s,l){o===void 0&&(o=j.R8G8B8A8),s===void 0&&(s=!0),l===void 0&&(l=Fo.Static);var c;return c=r.call(this,t)||this,c._mipmap=s,c._width=e,c._height=n,c._usage=l,c._format=o,c._mipmapCount=c._getMipmapCount(),c._isDepthTexture=o==j.Depth||o==j.DepthStencil||o==j.Depth16||o==j.Depth24||o==j.Depth32||o==j.Depth24Stencil8||o==j.Depth32Stencil8,c._platformTexture=t._hardwareRenderer.createPlatformTexture2D(he(c)),c.filterMode=Xt.Bilinear,c.wrapModeU=c.wrapModeV=rr.Repeat,c}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,c){n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,c),this._isContentLost=!1},a.setImageSource=function(e,n,o,s,l,c){n===void 0&&(n=0),o===void 0&&(o=!1),s===void 0&&(s=!1),l===void 0&&(l=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,n,o,s,l,c),this._isContentLost=!1},a.getPixelBuffer=function(e,n,o,s,l,c){var u=arguments.length;u===1?this._platformTexture.getPixelBuffer(0,0,this._width,this._height,0,e):u===2?this._platformTexture.getPixelBuffer(0,0,this._width>>e,this._height>>e,e,n):u===5?this._platformTexture.getPixelBuffer(e,n,o,s,0,l):u===6&&this._platformTexture.getPixelBuffer(e,n,o,s,l,c)},a._rebuild=function(){this._platformTexture=this._engine._hardwareRenderer.createPlatformTexture2D(this),r.prototype._rebuild.call(this)},i}(Kn),Fh=function(r){W(i,r);function i(t,e,n,o,s,l){s===void 0&&(s=j.R8G8B8A8),l===void 0&&(l=!0);var c;return c=r.call(this,t)||this,c._mipmap=l,c._width=e,c._height=n,c._length=o,c._format=s,c._mipmapCount=c._getMipmapCount(),c._platformTexture=t._hardwareRenderer.createPlatformTexture2DArray(he(c)),c.filterMode=Xt.Bilinear,c.wrapModeU=c.wrapModeV=rr.Repeat,c}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,c,u,d){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,c,u,d),this._isContentLost=!1},a.setImageSource=function(e,n,o,s,l,c,u){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),c===void 0&&(c=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,n,o,s,l,c,u),this._isContentLost=!1},a.getPixelBuffer=function(e,n,o,s,l,c,u){var d=arguments.length;d===1?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,n):d===2?this._platformTexture.getPixelBuffer(e,0,0,this._width>>n,this._height>>n,n,o):d===5?this._platformTexture.getPixelBuffer(e,n,o,s,l,0,c):d===6&&this._platformTexture.getPixelBuffer(e,n,o,s,l,c,u)},a._rebuild=function(){this._platformTexture=this._engine._hardwareRenderer.createPlatformTexture2DArray(this),r.prototype._rebuild.call(this)},q(i,[{key:"length",get:function(){return this._length}}]),i}(Kn),Rr=function(r){W(i,r);function i(t,e,n,o){n===void 0&&(n=j.R8G8B8A8),o===void 0&&(o=!0);var s;return s=r.call(this,t)||this,s._mipmap=o,s._width=e,s._height=e,s._format=n,s._mipmapCount=s._getMipmapCount(),s._platformTexture=t._hardwareRenderer.createPlatformTextureCube(he(s)),s.filterMode=Xt.Bilinear,s.wrapModeU=s.wrapModeV=rr.Clamp,s}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,c,u){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,c,u),this._isContentLost=!1},a.setImageSource=function(e,n,o,s,l,c,u){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),c===void 0&&(c=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,n,o,s,l,c,u),this._isContentLost=!1},a.getPixelBuffer=function(e,n,o,s,l,c,u){var d=arguments.length;d===2?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,n):d===3?this._platformTexture.getPixelBuffer(e,0,0,this._width>>n,this._height>>n,n,o):d===6?this._platformTexture.getPixelBuffer(e,n,o,s,l,0,c):d===7&&this._platformTexture.getPixelBuffer(e,n,o,s,l,c,u)},a._rebuild=function(){this._platformTexture=this._engine._hardwareRenderer.createPlatformTextureCube(this),r.prototype._rebuild.call(this)},i}(Kn),ha=function(){function r(a,t){this._blendShapeCount=0,this._blendShapes=[],this._subDataDirtyFlags=[],this._vertexBuffers=[],this._uniformOccupiesCount=0,this._bufferBindingOffset=-1,this._vertexElementOffset=0,this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._storeInVertexBufferInfo=[],this._maxCountSingleVertexBuffer=0,this._lastHostCreatedInfo=new ue,this._canUseTextureStoreData=!0,this._dataTextureInfo=new P,this._engine=a,this._modelMesh=t,this._canUseTextureStoreData=this._engine._hardwareRenderer.capability.canUseFloatTextureBlendShape,this._updateLayoutChange=this._updateLayoutChange.bind(this)}var i=r.prototype;return i._addBlendShape=function(t){this._blendShapes.push(t),this._blendShapeCount++,t._layoutChangeManager.addListener(this._updateLayoutChange),this._updateLayoutChange(0,t),this._subDataDirtyFlags.push(t._dataChangeManager.createFlag(bu))},i._clearBlendShapes=function(){for(var t=this._blendShapes,e=0,n=t.length;e<n;e++)t[e]._layoutChangeManager.removeListener(this._updateLayoutChange);this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._blendShapes.length=0,this._blendShapeCount=0;for(var o=this._subDataDirtyFlags,s=0,l=o.length;s<l;s++)o[s].destroy();o.length=0},i._updateShaderData=function(t,e){var n=this._blendShapeCount;if(n>0){if(t.enableMacro(r._blendShapeMacro),this._useTextureMode())t.enableMacro(r._blendShapeTextureMacro),t.setTexture(r._blendShapeTextureProperty,this._vertexTexture),t.setVector3(r._blendShapeTextureInfoProperty,this._dataTextureInfo),t.setFloatArray(r._blendShapeWeightsProperty,e.blendShapeWeights),t.enableMacro("RENDERER_BLENDSHAPE_COUNT",n.toString()),this._uniformOccupiesCount=n+1;else{var o=this._getVertexBufferModeSupportCount();if(n>o){var s=e._condensedBlendShapeWeights;s||(s=new Float32Array(o),e._condensedBlendShapeWeights=s),this._filterCondensedBlendShapeWeights(e.blendShapeWeights,s),t.setFloatArray(r._blendShapeWeightsProperty,s),this._modelMesh._primitive.enableVAO=!1,n=o}else t.setFloatArray(r._blendShapeWeightsProperty,e.blendShapeWeights),this._modelMesh._primitive.enableVAO=!0;t.disableMacro(r._blendShapeTextureMacro),t.disableMacro("RENDERER_BLENDSHAPE_COUNT"),this._uniformOccupiesCount=n}this._useBlendNormal?t.enableMacro(r._blendShapeNormalMacro):t.disableMacro(r._blendShapeNormalMacro),this._useBlendTangent?t.enableMacro(r._blendShapeTangentMacro):t.disableMacro(r._blendShapeTangentMacro)}else t.disableMacro(r._blendShapeMacro),t.disableMacro("RENDERER_BLENDSHAPE_COUNT")},i._useTextureMode=function(){return this._canUseTextureStoreData?this._blendShapeCount>this._getVertexBufferModeSupportCount():!1},i._isCreateHost=function(t){var e=this._lastHostCreatedInfo;return e.x!==this._blendShapeCount||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent||e.w!==t},i._vertexElementsNeedUpdate=function(){var t=this._getVertexBufferModeSupportCount(),e=this._lastHostCreatedInfo;return Math.min(e.x,t)!==Math.min(this._blendShapeCount,t)||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent},i._needUpdateData=function(){for(var t=this._subDataDirtyFlags,e=0,n=t.length;e<n;e++)if(t[e].flag)return!0;return!1},i._updateVertexBufferIndex=function(){if(this._bufferBindingOffset===-1){for(var t=this._modelMesh,e=t._internalVertexBufferIndex,n=t._primitive.vertexBufferBindings,o=0,s=Math.max(n.length,e+1);o<s&&!(!n[o]&&o!==e);o++);this._bufferBindingOffset=o}},i._addVertexElements=function(t){this._updateVertexBufferIndex();for(var e=this._vertexElementOffset,n=this._bufferBindingOffset,o=0,s=0,l=Math.min(this._blendShapeCount,this._getVertexBufferModeSupportCount());s<l;s++)t._setVertexElement(e++,new De("POSITION_BS"+s,o,ie.Vector3,n)),o+=12,this._useBlendNormal&&(t._setVertexElement(e++,new De("NORMAL_BS"+s,o,ie.Vector3,n)),o+=12),this._useBlendTangent&&(t._setVertexElement(e++,new De("TANGENT_BS"+s,o,ie.Vector3,n)),o+=12);return e},i._update=function(t){var e=this._modelMesh.vertexCount,n=this._useTextureMode(),o=this._isCreateHost(e);o&&(n?this._createTextureArray(e):this._createVertexBuffers(e,t),this._lastHostCreatedInfo.set(this._blendShapeCount,+this._useBlendNormal,+this._useBlendTangent,e)),this._needUpdateData()&&(n?this._updateTextureArray(e,o):this._updateVertexBuffers(e,o))},i._releaseMemoryCache=function(){for(var t=this._blendShapes,e=0,n=t.length;e<n;e++)t[e]._releaseData();this._vertices=null},i._createVertexBuffers=function(t,e){var n=this,o=n._engine,s=n._modelMesh,l=n._blendShapeCount,c=n._vertexBuffers,u=this._vertexElementCount*3,d=u*4,f=Math.floor(255/d),h=Math.ceil(l/f),_=u*t*Math.min(f,l);c.length=h,this._vertices=new Float32Array(_),this._maxCountSingleVertexBuffer=f,this._storeInVertexBufferInfo.length=l;for(var g=this._bufferBindingOffset,y=0;y<h;y++){var v=h-1,p=y===v?l-v*f:f,m=p*d,A=m*t,S=e?yt.Static:yt.Dynamic,x=new qr(o,mr.VertexBuffer,A,S);s._setVertexBufferBinding(g+y,new Ga(x,m)),c[y]=x}},i._createTextureArray=function(t){var e=this._engine._hardwareRenderer.capability.maxTextureSize,n=this._vertexElementCount,o=n*t,s=1;o>e&&(s=Math.ceil(o/e),o=e);var l=this._vertexTexture,c=this._blendShapes.length;l&&l.destroy(),l=new Fh(this._engine,o,s,c,j.R32G32B32A32,!1),l.filterMode=Xt.Point,this._vertices=new Float32Array(c*o*s*4),this._vertexTexture=l,this._dataTextureInfo.set(n,o,s)},i._updateVertexBuffers=function(t,e){for(var n=this,o=n._blendShapes,s=n._maxCountSingleVertexBuffer,l=this,c=l._vertices,u=l._vertexBuffers,d=l._storeInVertexBufferInfo,f=this._subDataDirtyFlags,h=this._vertexElementCount*3,_=h*4,g=this._bufferBindingOffset,y=0,v=o.length;y<v;y++){var p=f[y];if(e||p.flag){var m=o[y].frames,A=m.length,S=m[A-1];if(A>0&&S.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";var x=Math.floor(y/s),b=y%s,C=u[x],w=C.byteLength/(t*4),E=b*h,T=d[y];T||(d[y]=T=new te),T.set(g+x,b*_);for(var M=S.deltaPositions,B=0;B<t;B++){var I=E+w*B,F=M[B];F&&(c[I]=F.x,c[I+1]=F.y,c[I+2]=F.z)}if(E+=3,this._useBlendNormal){var L=S.deltaNormals;if(L)for(var V=0;V<t;V++){var D=E+w*V,N=L[V];N&&(c[D]=N.x,c[D+1]=N.y,c[D+2]=N.z)}E+=3}if(this._useBlendTangent){var O=S.deltaTangents;if(O)for(var G=0;G<t;G++){var Q=E+w*G,H=O[G];H&&(c[Q]=H.x,c[Q+1]=H.y,c[Q+2]=H.z)}E+=3}(b===s-1||y===v-1)&&C.setData(c,0,0,C.byteLength/4),p.flag=!1}}},i._updateTextureArray=function(t,e){for(var n=this,o=n._blendShapes,s=n._vertexTexture,l=n._vertices,c=n._subDataDirtyFlags,u=0,d=o.length;u<d;u++){var f=c[u],h=s.width*s.height*4;if(e||f.flag){var _=o[u].frames,g=_.length,y=_[g-1];if(g>0&&y.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var v=y.deltaPositions,p=y.deltaNormals,m=y.deltaTangents,A=u*h,S=0;S<t;S++){var x=v[S];if(l[A]=x.x,l[A+1]=x.y,l[A+2]=x.z,A+=4,p){var b=p[S];l[A]=b.x,l[A+1]=b.y,l[A+2]=b.z,A+=4}if(m){var C=m[S];l[A]=C.x,l[A+1]=C.y,l[A+2]=C.z,A+=4}}f.flag=!1}}s.setPixelBuffer(0,l)},i._updateLayoutChange=function(t,e){var n=this._blendShapeCount>1,o=1,s=e._useBlendShapeNormal,l=e._useBlendShapeTangent;n&&(s&&(s=this._useBlendNormal),l&&(l=this._useBlendTangent)),s&&o++,l&&o++,this._useBlendNormal=s,this._useBlendTangent=l,this._vertexElementCount=o},i._attributeModeUpdateVertexElement=function(t,e,n,o){var s=this._vertexElementOffset+this._vertexElementCount*o,l=e[n],c=l.x,u=l.y,d=t[s];if(d.bindingIndex=c,d.offset=u,this._useBlendNormal){var f=t[++s];u+=12,f.bindingIndex=c,f.offset=u}if(this._useBlendTangent){var h=t[++s];u+=12,h.bindingIndex=c,h.offset=u}},i._getVertexBufferModeSupportCount=function(){return this._useBlendNormal&&this._useBlendTangent?2:this._useBlendNormal||this._useBlendTangent?4:8},i._filterCondensedBlendShapeWeights=function(t,e){for(var n=e.length,o=this._modelMesh._primitive.vertexElements,s=this._storeInVertexBufferInfo,l=Number.POSITIVE_INFINITY,c,u=0,d=Math.min(t.length,this._blendShapeCount);u<d;u++){var f=t[u];if(u<n)this._attributeModeUpdateVertexElement(o,s,u,u),e[u]=f,f<l&&(l=f,c=u);else if(f>l){this._attributeModeUpdateVertexElement(o,s,u,c),e[c]=f,l=Number.POSITIVE_INFINITY;for(var h=0;h<n;h++){var _=e[h];_<l&&(l=_,c=h)}}}},r}();(function(){ha._blendShapeMacro=se.getByName("RENDERER_HAS_BLENDSHAPE")})();(function(){ha._blendShapeTextureMacro=se.getByName("RENDERER_BLENDSHAPE_USE_TEXTURE")})();(function(){ha._blendShapeNormalMacro=se.getByName("RENDERER_BLENDSHAPE_HAS_NORMAL")})();(function(){ha._blendShapeTangentMacro=se.getByName("RENDERER_BLENDSHAPE_HAS_TANGENT")})();(function(){ha._blendShapeWeightsProperty=k.getByName("renderer_BlendShapeWeights")})();(function(){ha._blendShapeTextureProperty=k.getByName("renderer_BlendShapeTexture")})();(function(){ha._blendShapeTextureInfoProperty=k.getByName("renderer_BlendShapeTextureInfo")})();var X;(function(r){r.Position="POSITION",r.Normal="NORMAL",r.Color="COLOR_0",r.Tangent="TANGENT",r.BoneWeight="WEIGHTS_0",r.BoneIndex="JOINTS_0",r.UV="TEXCOORD_0",r.UV1="TEXCOORD_1",r.UV2="TEXCOORD_2",r.UV3="TEXCOORD_3",r.UV4="TEXCOORD_4",r.UV5="TEXCOORD_5",r.UV6="TEXCOORD_6",r.UV7="TEXCOORD_7"})(X||(X={}));var Nt=function(r){W(i,r);function i(t,e){var n;return n=r.call(this,t)||this,n._internalVertexBufferIndex=-1,n._vertexCount=0,n._vertexCountDirty=!1,n._dataVersionCounter=0,n._positions=null,n._normals=null,n._colors=null,n._tangents=null,n._uv=null,n._uv1=null,n._uv2=null,n._uv3=null,n._uv4=null,n._uv5=null,n._uv6=null,n._uv7=null,n._boneWeights=null,n._boneIndices=null,n._advancedElementUpdateFlag=0,n._advancedDataUpdateFlag=0,n._advancedVertexDataVersions=new Array(14),n._advancedDataSyncToBuffer=!1,n._internalVertexBufferStride=0,n._internalVertexBufferCreatedInfo=new P(0,0,-1),n._internalVertexElementsOffset=0,n._internalVertexElementsFlags=0,n._vertexBufferInfos=[],n._indices=null,n._indicesFormat=null,n._indicesChangeFlag=!1,n._accessible=!0,n.name=e,n._blendShapeManager=new ha(t,he(n)),n}var a=i.prototype;return a.setPositions=function(e){var n;if(!(!this._positions&&!e)){this._updateAdvancedVertexDataMarks(1,0),this._positions=e;var o;this._vertexCount=(o=(n=e)==null?void 0:n.length)!=null?o:0,this._vertexCountDirty=!1}},a.getPositions=function(){var e=this._getVertexElementData(this._positions,X.Position,0,this._readVector3VertexData);return this._positions=e,e},a.setNormals=function(e){this._beforeSetAdvancedVertexData(e,2,1),this._normals=e},a.getNormals=function(){var e=this._getVertexElementData(this._normals,X.Normal,1,this._readVector3VertexData);return this._normals=e,e},a.setColors=function(e){this._beforeSetAdvancedVertexData(e,4,2),this._colors=e},a.getColors=function(){var e=this._getVertexElementData(this._colors,X.Color,2,this._readColorVertexData);return this._colors=e,e},a.setBoneWeights=function(e){this._beforeSetAdvancedVertexData(e,16,4),this._boneWeights=e},a.getBoneWeights=function(){var e=this._getVertexElementData(this._boneWeights,X.BoneWeight,4,this._readVector4VertexData);return this._boneWeights=e,e},a.setBoneIndices=function(e){this._beforeSetAdvancedVertexData(e,32,5),this._boneIndices=e},a.getBoneIndices=function(){var e=this._getVertexElementData(this._boneIndices,X.BoneIndex,5,this._readVector4VertexData);return this._boneIndices=e,e},a.setTangents=function(e){this._beforeSetAdvancedVertexData(e,8,3),this._tangents=e},a.getTangents=function(){var e=this._getVertexElementData(this._tangents,X.Tangent,3,this._readVector4VertexData);return this._tangents=e,e},a.setUVs=function(e,n){switch(n=n??0,n){case 0:this._beforeSetAdvancedVertexData(e,64,6),this._uv=e;break;case 1:this._beforeSetAdvancedVertexData(e,128,7),this._uv1=e;break;case 2:this._beforeSetAdvancedVertexData(e,256,8),this._uv2=e;break;case 3:this._beforeSetAdvancedVertexData(e,512,9),this._uv3=e;break;case 4:this._beforeSetAdvancedVertexData(e,1024,10),this._uv4=e;break;case 5:this._beforeSetAdvancedVertexData(e,2048,11),this._uv5=e;break;case 6:this._beforeSetAdvancedVertexData(e,4096,12),this._uv6=e;break;case 7:this._beforeSetAdvancedVertexData(e,8192,13),this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},a.getUVs=function(e){switch(e=e??0,e){case 0:var n=this._getVertexElementData(this._uv,X.UV,6,this._readVector2VertexData);return this._uv=n,n;case 1:var o=this._getVertexElementData(this._uv1,X.UV1,7,this._readVector2VertexData);return this._uv1=o,o;case 2:var s=this._getVertexElementData(this._uv2,X.UV2,8,this._readVector2VertexData);return this._uv2=s,s;case 3:var l=this._getVertexElementData(this._uv3,X.UV3,9,this._readVector2VertexData);return this._uv3=l,l;case 4:var c=this._getVertexElementData(this._uv4,X.UV4,10,this._readVector2VertexData);return this._uv4=c,c;case 5:var u=this._getVertexElementData(this._uv5,X.UV5,11,this._readVector2VertexData);return this._uv5=u,u;case 6:var d=this._getVertexElementData(this._uv6,X.UV6,12,this._readVector2VertexData);return this._uv6=d,d;case 7:var f=this._getVertexElementData(this._uv7,X.UV7,13,this._readVector2VertexData);return this._uv7=f,f}throw"The index of channel needs to be in range [0 - 7]."},a.setIndices=function(e){this._indices!==e&&(this._indices=e,mt(e,Uint8Array)?this._indicesFormat=Wt.UInt8:mt(e,Uint16Array)?this._indicesFormat=Wt.UInt16:mt(e,Uint32Array)&&(this._indicesFormat=Wt.UInt32)),this._indicesChangeFlag=!0},a.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},a.setVertexElements=function(e){this._clearVertexElements();for(var n=e.length,o=0;o<n;o++)this._addVertexElement(e[o]);var s=this._primitive._vertexElementMap;s[X.Position]||this.setPositions(null),s[X.Normal]||this.setNormals(null),s[X.Color]||this.setColors(null),s[X.BoneWeight]||this.setBoneWeights(null),s[X.BoneIndex]||this.setBoneIndices(null),s[X.Tangent]||this.setTangents(null),s[X.UV]||this.setUVs(null,0),s[X.UV1]||this.setUVs(null,1),s[X.UV2]||this.setUVs(null,2),s[X.UV3]||this.setUVs(null,3),s[X.UV4]||this.setUVs(null,4),s[X.UV5]||this.setUVs(null,5),s[X.UV6]||this.setUVs(null,6),s[X.UV7]||this.setUVs(null,7);var l=this._internalVertexBufferCreatedInfo.z;if(l!==-1){var c;(c=this._primitive.vertexBufferBindings[l])==null||c.buffer.destroy(),this._setVertexBufferBinding(l,null),this._internalVertexBufferCreatedInfo.z=-1}this._internalVertexBufferStride=0,this._internalVertexElementsOffset=n,this._advancedElementUpdateFlag=0,this._vertexCountDirty=!0,this._blendShapeManager._bufferBindingOffset=-1,this._blendShapeManager._vertexElementOffset=n},a.setVertexBufferBinding=function(e,n,o){n===void 0&&(n=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new Ga(e,n));var c=l?n:o,u=this._primitive.vertexBufferBindings,d=this._vertexBufferInfos,f=c+1;u.length<f&&(u.length=f,d.length=f),this._setVertexBufferBinding(c,s),c===this._internalVertexBufferIndex&&(this._internalVertexBufferIndex=-1),c===this._blendShapeManager._bufferBindingOffset&&(this._blendShapeManager._bufferBindingOffset=-1),this._vertexCountDirty=!0},a.setVertexBufferBindings=function(e,n){n===void 0&&(n=0);var o=e.length,s=this._primitive.vertexBufferBindings,l=this._vertexBufferInfos,c=n+o;s.length<c&&(s.length=c,l.length=c);for(var u=0;u<o;u++){var d=n+u;this._setVertexBufferBinding(d,e[u]),d===this._internalVertexBufferIndex&&(this._internalVertexBufferIndex=-1),d===this._blendShapeManager._bufferBindingOffset&&(this._blendShapeManager._bufferBindingOffset=-1)}this._vertexCountDirty=!0},a.getVertexElement=function(e){return this._updateVertexElements(),this._primitive._vertexElementMap[e]},a.addBlendShape=function(e){this._blendShapeManager._addBlendShape(e)},a.clearBlendShapes=function(){this._blendShapeManager._clearBlendShapes()},a.getBlendShapeName=function(e){var n=this._blendShapeManager._blendShapes;return n[e].name},a.uploadData=function(e){if(this._updateVertexElements(),this._advancedDataSyncToBuffer=!0,this._updateInternalVertexBuffer(e),this._advancedDataUpdateFlag&65535){this._updateAdvancedVertices();for(var n=this._vertexBufferInfos,o=this._primitive.vertexBufferBindings,s=0,l=o.length;s<l;s++){var c,u=n[s];if((c=u)!=null&&c.uploadAdvancedData){var d,f=(d=o[s])==null?void 0:d.buffer;f.setData(f.data),u.uploadAdvancedData=!1}}}if(this._advancedDataSyncToBuffer=!1,this._indicesChangeFlag){var h,_=this,g=_._indices,y=(h=this._primitive.indexBufferBinding)==null?void 0:h._buffer;if(g)if(!y||g.byteLength!=y.byteLength){var v;(v=y)==null||v.destroy();var p=new qr(this._engine,mr.IndexBuffer,g);this._setIndexBufferBinding(new js(p,this._indicesFormat))}else y.setData(g),this._primitive.indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new js(y,this._indicesFormat));else y&&(y.destroy(),this._setIndexBufferBinding(null));this._indicesChangeFlag=!1}var m=this._blendShapeManager;m._blendShapeCount>0&&m._update(e),e&&(this._accessible=!1,this._releaseCache(!1))},a.calculateTangents=function(){var e=this.getPositions(),n=this.getNormals(),o=this.getUVs();if(!n||!o)throw"Set normal and uv before calculation.";for(var s=this,l=s._indices,c=s.vertexCount,u=i._tempVec0,d=i._tempVec1,f=i._tempVec2,h=i._tempVec3,_=i._tempVec4,g=l?l.length/3:e.length/3,y=new Array(c),v=new Array(c),p=0;p<c;p++)y[p]=new ue,v[p]=new P;for(var m=0;m<g;m++){var A=3*m,S=3*m+1,x=3*m+2;l&&(A=l[A],S=l[S],x=l[x]);var b=e[A],C=e[S],w=e[x],E=o[A],T=o[S],M=o[x];P.subtract(C,b,u),P.subtract(w,b,d);var B=T.x-E.x,I=M.x-E.x,F=T.y-E.y,L=M.y-E.y,V=1/(B*L-I*F);P.scale(u,L*V,f),P.scale(d,F*V,_),P.subtract(f,_,f),P.scale(d,B*V,h),P.scale(u,I*V,_),P.subtract(h,_,h);var D=y[A];D.set(D.x+f.x,D.y+f.y,D.z+f.z,1),D=y[S],D.set(D.x+f.x,D.y+f.y,D.z+f.z,1),D=y[x],D.set(D.x+f.x,D.y+f.y,D.z+f.z,1),v[A].add(h),v[S].add(h),v[x].add(h)}for(var N=0;N<c;N++){var O=n[N],G=v[N],Q=y[N];f.set(Q.x,Q.y,Q.z),P.cross(f,G,_);var H=P.dot(_,O)>0?1:-1;P.scale(O,P.dot(f,O),_),P.subtract(f,_,f),f.normalize(),Q.set(f.x,f.y,f.z,H)}this.setTangents(y)},a._setVertexBufferBinding=function(e,n){var o=this,s=this._primitive.vertexBufferBindings,l=this._vertexBufferInfos,c=function(){o._advancedDataSyncToBuffer||(l[e].dataVersion=o._dataVersionCounter++)},u=s[e];if(u&&u.buffer._dataUpdateManager.removeListener(c),r.prototype._setVertexBufferBinding.call(this,e,n),n){var d,f;n.buffer._dataUpdateManager.addListener(c),((d=l)[f=e]||(d[f]=new kx)).reset(),c()}else e+1==s.length&&s.length--},a._getVertexTypedArray=function(e,n){switch(n){case We.BYTE:return new Int8Array(e);case We.UNSIGNED_BYTE:return new Uint8Array(e);case We.SHORT:return new Int16Array(e);case We.UNSIGNED_SHORT:return new Uint16Array(e);case We.FLOAT:return new Float32Array(e)}},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._releaseCache(!0)},a._getVertexElementData=function(e,n,o,s){var l=this._advancedVertexDataVersions,c,u=(c=l[o])!=null?c:-1,d=this._primitive._vertexElementMap[n],f=d?this._vertexBufferInfos[d.bindingIndex].dataVersion:-1;return u>=f?e:(l[o]=f,s.call(this,n))},a._beforeSetAdvancedVertexData=function(e,n,o){if(e&&e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._updateAdvancedVertexDataMarks(n,o)},a._updateAdvancedVertexDataMarks=function(e,n){this._advancedElementUpdateFlag|=e,this._advancedDataUpdateFlag|=e,this._advancedVertexDataVersions[n]=this._dataVersionCounter++},a._updateInternalVertexBuffer=function(e){var n=this._internalVertexBufferStride,o=this.vertexCount,s=this._internalVertexBufferCreatedInfo,l=n*o;if(s.x*s.y!==l){var c=s.z;if(c!==-1){var u;(u=this._primitive.vertexBufferBindings[c])==null||u.buffer.destroy(),this._setVertexBufferBinding(c,null)}var d=this._internalVertexBufferIndex,f=n*this.vertexCount>0;if(f){this._advancedDataUpdateFlag|=this._internalVertexElementsFlags;var h=e?yt.Static:yt.Dynamic,_=new qr(this._engine,mr.VertexBuffer,l,h,!0);this._setVertexBufferBinding(d,new Ga(_,n))}s.set(n,o,f?d:-1)}},a._readVector2VertexData=function(e){return this._readVertexData(e,function(n,o){return new te(n[o],n[o+1])})},a._readVector3VertexData=function(e){return this._readVertexData(e,function(n,o){return new P(n[o],n[o+1],n[o+2])})},a._readVector4VertexData=function(e){return this._readVertexData(e,function(n,o){return new ue(n[o],n[o+1],n[o+2],n[o+3])})},a._readColorVertexData=function(e){return this._readVertexData(e,function(n,o){return new K(n[o],n[o+1],n[o+2],n[o+3])})},a._readVertexData=function(e,n){var o,s=this._primitive,l=s._vertexElementMap[e];if(!l)return null;var c=s.vertexBufferBindings[l.bindingIndex],u=(o=c)==null?void 0:o.buffer;if(!u)return null;if(!u.readable)throw"Not allowed to access data while vertex buffer readable is false.";for(var d=this.vertexCount,f=l._formatMetaInfo,h=new Array(d),_=this._getVertexTypedArray(u.data.buffer,f.type),g=l.offset,y=c.stride,v=0;v<d;v++){var p=(v*y+g)/_.BYTES_PER_ELEMENT,m=n(_,p);f.normalized&&m.scale(f.normalizedScaleFactor),h[v]=m}return h},a._updateAdvancedVertexElement=function(e,n,o){var s=this._primitive,l=s._vertexElementMap;if(e){if(!l[n]){var c=this._getAttributeFormat(n),u=this._internalVertexBufferStride,d=this._getInternalVertexBufferIndex();this._addVertexElement(new De(n,u,c,d)),this._internalVertexBufferStride+=this._getAttributeByteLength(n),this._internalVertexElementsFlags|=o,this._blendShapeManager._vertexElementOffset++}}else{var f=l[n];if(f){var h=this._primitive.vertexElements.indexOf(f);h>=this._internalVertexElementsOffset?(this._internalVertexBufferStride-=this._getAttributeByteLength(n),this._internalVertexElementsFlags&=~o):this._internalVertexElementsOffset--,this._blendShapeManager._vertexElementOffset--,this._removeVertexElement(h)}}},a._updateAdvancedVertexElements=function(){var e=this._advancedElementUpdateFlag;e&1&&this._updateAdvancedVertexElement(this._positions,X.Position,1),e&2&&this._updateAdvancedVertexElement(this._normals,X.Normal,2),e&4&&this._updateAdvancedVertexElement(this._colors,X.Color,4),e&16&&this._updateAdvancedVertexElement(this._boneWeights,X.BoneWeight,16),e&32&&this._updateAdvancedVertexElement(this._boneIndices,X.BoneIndex,32),e&8&&this._updateAdvancedVertexElement(this._tangents,X.Tangent,8),e&64&&this._updateAdvancedVertexElement(this._uv,X.UV,64),e&128&&this._updateAdvancedVertexElement(this._uv1,X.UV1,128),e&256&&this._updateAdvancedVertexElement(this._uv2,X.UV2,256),e&512&&this._updateAdvancedVertexElement(this._uv3,X.UV3,512),e&1024&&this._updateAdvancedVertexElement(this._uv4,X.UV4,1024),e&2048&&this._updateAdvancedVertexElement(this._uv5,X.UV5,2048),e&4096&&this._updateAdvancedVertexElement(this._uv6,X.UV6,4096),e&8192&&this._updateAdvancedVertexElement(this._uv7,X.UV7,8192)},a._updateVertexElements=function(){var e=this._primitive.vertexElements,n=this._blendShapeManager,o=e.length,s=n._vertexElementOffset;this._advancedElementUpdateFlag&65535&&(this._updateAdvancedVertexElements(),this._advancedElementUpdateFlag=0);var l=!n._useTextureMode()&&n._vertexElementsNeedUpdate();if(s!==n._vertexElementOffset||l&&n._blendShapeCount>0){var c=n._addVertexElements(this);c<o&&this._setVertexElementsLength(c)}},a._writeVector2AdvancedVertexData=function(e,n,o){this._writeAdvancedVertexData(e,n,function(s,l,c){var u=o[c];u&&(s[l]=u.x,s[l+1]=u.y)})},a._writeVector3AdvancedVertexData=function(e,n,o){this._writeAdvancedVertexData(e,n,function(s,l,c){var u=o[c];u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)})},a._writeVector4AdvancedVertexData=function(e,n,o){this._writeAdvancedVertexData(e,n,function(s,l,c){var u=o[c];u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z,s[l+3]=u.w)})},a._writeColorAdvancedVertexData=function(e,n,o){this._writeAdvancedVertexData(e,n,function(s,l,c){var u=o[c];u&&(s[l]=u.r,s[l+1]=u.g,s[l+2]=u.b,s[l+3]=u.a)})},a._writeAdvancedVertexData=function(e,n,o){var s,l=this._primitive,c=l._vertexElementMap[e],u=c.bindingIndex,d=l.vertexBufferBindings[u],f=(s=d)==null?void 0:s.buffer;if(f){if(!f.readable)throw"Vertex buffer is not readable, can't write vertex data.";var h,_=(h=this._advancedVertexDataVersions[n])!=null?h:-1,g=this._vertexBufferInfos[u];if(_>g.dataVersion){for(var y=c._formatMetaInfo,v=this._getVertexTypedArray(f.data.buffer,y.type),p=c.offset,m=d.stride,A=v.BYTES_PER_ELEMENT,S=y.normalized,x=y.size,b=y.normalizedScaleFactor,C=0,w=this._vertexCount;C<w;C++){var E=(C*m+p)/A;if(o(v,E,C),S)for(var T=0;T<x;T++)v[E+T]/=b}g.uploadAdvancedData=!0}}},a._updateAdvancedVertices=function(){var e=this,n=e._positions,o=e._normals,s=e._colors,l=e._advancedDataUpdateFlag,c=e._boneWeights,u=e._boneIndices,d=e._tangents,f=e._uv,h=e._uv1,_=e._uv2,g=e._uv3,y=e._uv4,v=e._uv5,p=e._uv6,m=e._uv7;l&1&&this._writeVector3AdvancedVertexData(X.Position,0,n),o&&l&2&&this._writeVector3AdvancedVertexData(X.Normal,1,o),s&&l&4&&this._writeColorAdvancedVertexData(X.Color,2,s),c&&l&16&&this._writeVector4AdvancedVertexData(X.BoneWeight,4,c),u&&l&32&&this._writeVector4AdvancedVertexData(X.BoneIndex,5,u),d&&l&8&&this._writeVector4AdvancedVertexData(X.Tangent,3,d),f&&l&64&&this._writeVector2AdvancedVertexData(X.UV,6,f),h&&l&128&&this._writeVector2AdvancedVertexData(X.UV1,7,h),_&&l&256&&this._writeVector2AdvancedVertexData(X.UV2,8,_),g&&l&512&&this._writeVector2AdvancedVertexData(X.UV3,9,g),y&&l&1024&&this._writeVector2AdvancedVertexData(X.UV4,10,y),v&&l&2048&&this._writeVector2AdvancedVertexData(X.UV5,11,v),p&&l&4096&&this._writeVector2AdvancedVertexData(X.UV6,12,p),m&&l&8192&&this._writeVector2AdvancedVertexData(X.UV7,13,m),this._advancedDataUpdateFlag=0},a._getInternalVertexBufferIndex=function(){var e=this._internalVertexBufferIndex;if(e!==-1)return e;for(var n=0,o=this._primitive.vertexBufferBindings,s=o.length;n<s&&o[n];n++);return this._internalVertexBufferIndex=n,n},a._getAttributeFormat=function(e){switch(e){case X.Position:case X.Normal:return ie.Vector3;case X.Color:case X.BoneWeight:case X.Tangent:return ie.Vector4;case X.BoneIndex:return ie.UByte4;case X.UV:case X.UV1:case X.UV2:case X.UV3:case X.UV4:case X.UV5:case X.UV6:case X.UV7:return ie.Vector2}},a._getAttributeByteLength=function(e){switch(e){case X.Position:case X.Normal:return 12;case X.Color:case X.BoneWeight:case X.Tangent:return 16;case X.BoneIndex:return 4;case X.UV:case X.UV1:case X.UV2:case X.UV3:case X.UV4:case X.UV5:case X.UV6:case X.UV7:return 8}},a._releaseCache=function(e){if(this._positions=null,this._tangents=null,this._normals=null,this._colors=null,this._boneIndices=null,this._boneWeights=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._indices=null,this._blendShapeManager._releaseMemoryCache(),!e){var n;(n=this._primitive.vertexBufferBindings[this._internalVertexBufferIndex])==null||n.buffer.markAsUnreadable();for(var o=this._dataVersionCounter++,s=this._vertexBufferInfos,l=0,c=s.length;l<c;l++){var u=s[l];u&&(u.dataVersion=o)}}},q(i,[{key:"vertexCount",get:function(){if(this._vertexCountDirty){var e=0,n=this._primitive._vertexElementMap[X.Position];if(n){var o=this._primitive.vertexBufferBindings[n.bindingIndex];o&&(e=o.buffer.byteLength/o.stride)}this._vertexCount=e,this._vertexCountDirty=!1}return this._vertexCount}},{key:"vertexElements",get:function(){return this._updateVertexElements(),this._primitive.vertexElements}},{key:"vertexBufferBindings",get:function(){return this._primitive.vertexBufferBindings}},{key:"blendShapes",get:function(){return this._blendShapeManager._blendShapes}},{key:"blendShapeCount",get:function(){return this._blendShapeManager._blendShapeCount}},{key:"accessible",get:function(){return this._accessible}}]),i}(Dh);(function(){Nt._tempVec0=new P})();(function(){Nt._tempVec1=new P})();(function(){Nt._tempVec2=new P})();(function(){Nt._tempVec3=new P})();(function(){Nt._tempVec4=new P})();var kx=function(){function r(){this.dataVersion=-1,this.uploadAdvancedData=!1}var i=r.prototype;return i.reset=function(){this.uploadAdvancedData=!1},r}(),cp;(function(r){r[r.None=0]="None",r[r.Position=1]="Position",r[r.Normal=2]="Normal",r[r.Color=4]="Color",r[r.Tangent=8]="Tangent",r[r.BoneWeight=16]="BoneWeight",r[r.BoneIndex=32]="BoneIndex",r[r.UV=64]="UV",r[r.UV1=128]="UV1",r[r.UV2=256]="UV2",r[r.UV3=512]="UV3",r[r.UV4=1024]="UV4",r[r.UV5=2048]="UV5",r[r.UV6=4096]="UV6",r[r.UV7=8192]="UV7",r[r.All=65535]="All"})(cp||(cp={}));var up;(function(r){r[r.Position=0]="Position",r[r.Normal=1]="Normal",r[r.Color=2]="Color",r[r.Tangent=3]="Tangent",r[r.BoneWeight=4]="BoneWeight",r[r.BoneIndex=5]="BoneIndex",r[r.UV=6]="UV",r[r.UV1=7]="UV1",r[r.UV2=8]="UV2",r[r.UV3=9]="UV3",r[r.UV4=10]="UV4",r[r.UV5=11]="UV5",r[r.UV6=12]="UV6",r[r.UV7=13]="UV7"})(up||(up={}));var Ai=function(i){this.resource=i},Ni=function(r){W(i,r);function i(t,e){var n;return n=r.call(this,t)||this,n.primitiveInfo=e,n}var a=i.prototype;return a.restoreContent=function(){var e=this.primitiveInfo;switch(e.type){case 0:var n=e;ut._setSphereData(this.resource,n.radius,n.segments,n.noLongerAccessible,!0,n.vertexBuffer);break;case 7:var o=e;ut._setSubdivisionSurfaceSphereData(this.resource,o.radius,o.step,o.noLongerAccessible,!0,o.vertexBuffer);break;case 1:var s=e;ut._setCuboidData(this.resource,s.width,s.height,s.depth,s.noLongerAccessible,!0,s.vertexBuffer);break;case 2:var l=e;ut._setPlaneData(this.resource,l.width,l.height,l.horizontalSegments,l.verticalSegments,l.noLongerAccessible,!0,l.vertexBuffer);break;case 3:var c=e;ut._setCylinderData(this.resource,c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.noLongerAccessible,!0,c.vertexBuffer);break;case 4:var u=e;ut._setTorusData(this.resource,u.radius,u.tubeRadius,u.radialSegments,u.tubularSegments,u.arc,u.noLongerAccessible,!0,u.vertexBuffer);break;case 5:var d=e;ut._setConeData(this.resource,d.radius,d.height,d.radialSegments,d.heightSegments,d.noLongerAccessible,!0,d.vertexBuffer);break;case 6:var f=e;ut._setCapsuleData(this.resource,f.radius,f.height,f.radialSegments,f.heightSegments,f.noLongerAccessible,!0,f.vertexBuffer);break}},i}(Ai),dp;(function(r){r[r.Sphere=0]="Sphere",r[r.Cuboid=1]="Cuboid",r[r.Plane=2]="Plane",r[r.Cylinder=3]="Cylinder",r[r.Torus=4]="Torus",r[r.Cone=5]="Cone",r[r.Capsule=6]="Capsule",r[r.CCSphere=7]="CCSphere"})(dp||(dp={}));var _a=function(i,a,t){this.type=i,this.vertexBuffer=a,this.noLongerAccessible=t},Ux=function(r){W(i,r);function i(a,t,e,n){var o;return o=r.call(this,0,e,n)||this,o.radius=a,o.segments=t,o}return i}(_a),Gx=function(r){W(i,r);function i(a,t,e,n){var o;return o=r.call(this,7,e,n)||this,o.radius=a,o.step=t,o}return i}(_a),Hx=function(r){W(i,r);function i(a,t,e,n,o){var s;return s=r.call(this,1,n,o)||this,s.width=a,s.height=t,s.depth=e,s}return i}(_a),Wx=function(r){W(i,r);function i(a,t,e,n,o,s){var l;return l=r.call(this,2,o,s)||this,l.width=a,l.height=t,l.horizontalSegments=e,l.verticalSegments=n,l}return i}(_a),Qx=function(r){W(i,r);function i(a,t,e,n,o,s,l){var c;return c=r.call(this,3,s,l)||this,c.radiusTop=a,c.radiusBottom=t,c.height=e,c.radialSegments=n,c.heightSegments=o,c}return i}(_a),jx=function(r){W(i,r);function i(a,t,e,n,o,s,l){var c;return c=r.call(this,4,s,l)||this,c.radius=a,c.tubeRadius=t,c.radialSegments=e,c.tubularSegments=n,c.arc=o,c}return i}(_a),Xx=function(r){W(i,r);function i(a,t,e,n,o,s){var l;return l=r.call(this,5,o,s)||this,l.radius=a,l.height=t,l.radialSegments=e,l.heightSegments=n,l}return i}(_a),Yx=function(r){W(i,r);function i(a,t,e,n,o,s){var l;return l=r.call(this,6,o,s)||this,l.radius=a,l.height=t,l.radialSegments=e,l.heightSegments=n,l}return i}(_a),ut=function(){function r(){}return r.createSphere=function(a,t,e,n){t===void 0&&(t=.5),e===void 0&&(e=18),n===void 0&&(n=!0);var o=new Nt(a);r._setSphereData(o,t,e,n,!1);var s=o.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(o,new Ux(t,e,s,n))),o},r.createSubdivisionSurfaceSphere=function(a,t,e,n){t===void 0&&(t=.5),e===void 0&&(e=3),n===void 0&&(n=!0);var o=new Nt(a);r._setSubdivisionSurfaceSphereData(o,t,e,n,!1);var s=o.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(o,new Gx(t,e,s,n))),o},r.createCuboid=function(a,t,e,n,o){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=!0);var s=new Nt(a);r._setCuboidData(s,t,e,n,o,!1);var l=s.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(s,new Hx(t,e,n,l,o))),s},r.createPlane=function(a,t,e,n,o,s){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Nt(a);r._setPlaneData(l,t,e,n,o,s,!1);var c=l.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(l,new Wx(t,e,n,o,c,s))),l},r.createCylinder=function(a,t,e,n,o,s,l){t===void 0&&(t=.5),e===void 0&&(e=.5),n===void 0&&(n=2),o===void 0&&(o=20),s===void 0&&(s=1),l===void 0&&(l=!0);var c=new Nt(a);r._setCylinderData(c,t,e,n,o,s,l,!1);var u=c.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(c,new Qx(t,e,n,o,s,u,l))),c},r.createTorus=function(a,t,e,n,o,s,l){t===void 0&&(t=.5),e===void 0&&(e=.1),n===void 0&&(n=30),o===void 0&&(o=30),s===void 0&&(s=360),l===void 0&&(l=!0);var c=new Nt(a);r._setTorusData(c,t,e,n,o,s,l,!1);var u=c.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(c,new jx(t,e,n,o,s,u,l))),c},r.createCone=function(a,t,e,n,o,s){t===void 0&&(t=.5),e===void 0&&(e=2),n===void 0&&(n=20),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Nt(a);r._setConeData(l,t,e,n,o,s,!1);var c=l.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(l,new Xx(t,e,n,o,c,s))),l},r.createCapsule=function(a,t,e,n,o,s){t===void 0&&(t=.5),e===void 0&&(e=2),n===void 0&&(n=6),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new Nt(a);r._setCapsuleData(l,t,e,n,o,s,!1);var c=l.vertexBufferBindings[0].buffer;return a.resourceManager.addContentRestorer(new Ni(l,new Yx(t,e,n,o,c,s))),l},r._setSubdivisionSurfaceSphereData=function(a,t,e,n,o,s){e=U.clamp(Math.floor(e),1,6);var l=new Float32Array(3*(6*Math.pow(4,e)+2)),c=new Float32Array(24*Math.pow(4,e));r._subdiveCatmullClark(e,l,c);for(var u=l.length/3,d=c.length/4,f=u+Math.pow(2,e+1)-1,h=f+16,_=new Float32Array(h*8),g=r._generateIndices(a.engine,u,d*6),y=0,v={},p=0;p<u;p++){var m=3*p,A=l[m],S=l[m+1],x=l[m+2],b=1/Math.sqrt(A*A+S*S+x*x);if(A*=b,S*=b,x*=b,m=8*p,_[m]=A*t,_[m+1]=S*t,_[m+2]=x*t,_[m+3]=A,_[m+4]=S,_[m+5]=x,_[m+6]=(Math.PI-Math.atan2(x,A))/(2*Math.PI),_[m+7]=Math.acos(S)/Math.PI,_[m+6]===0){var C=8*(u+y++);_.set(_.subarray(m,m+8),C),_[C+6]=1,v[m/8]=C/8}}var w=0;this._spherePoleIdx=0;for(var E=0;E<d;E++){var T=4*E,M=c[T],B=c[T+1],I=c[T+2],F=c[T+3],L=8*M,V=8*B,D=8*I,N=8*F;_[L+2]+_[V+2]+_[D+2]<0&&(_[L+6]===0&&(M=v[M]),_[V+6]===0&&(B=v[B]),_[D+6]===0&&(I=v[I]),_[N+6]===0&&(F=v[F])),g[w]=M,g[w+1]=B,g[w+2]=I,this._generateAndReplacePoleUV(g,_,w,f),g[w+3]=M,g[w+4]=I,g[w+5]=F,this._generateAndReplacePoleUV(g,_,w+3,f),w+=6}if(!o){var O=a.bounds;O.min.set(-t,-t,-t),O.max.set(t,t,t)}r._initialize(a,_,g,n,o,s)},r._setSphereData=function(a,t,e,n,o,s){e=Math.max(2,Math.floor(e));for(var l=e+1,c=l*l,u=e*e,d=r._generateIndices(a.engine,c,u*6),f=Math.PI,h=f*2,_=1/l,g=1/e,y=8,v=new Float32Array(c*y),p=0;p<c;++p){var m=p%l,A=p*_|0,S=m*g,x=A*g,b=S*h,C=x*f,w=Math.sin(C),E=-t*Math.cos(b)*w,T=t*Math.cos(C),M=t*Math.sin(b)*w,B=p*y;v[B++]=E,v[B++]=T,v[B++]=M,v[B++]=E,v[B++]=T,v[B++]=M,v[B++]=S,v[B++]=x}for(var I=0,F=0;F<u;++F){var L=F%e,V=F*g|0,D=V*l+L,N=D+1,O=D+l,G=O+1;d[I++]=N,d[I++]=D,d[I++]=G,d[I++]=D,d[I++]=O,d[I++]=G}if(!o){var Q=a.bounds;Q.min.set(-t,-t,-t),Q.max.set(t,t,t)}r._initialize(a,v,d,n,o,s)},r._subdiveCatmullClark=function(a,t,e){var n=new Map,o=new Array;t.set(r._sphereSeedPositions),e.set(r._sphereSeedCells);for(var s=0;s<a;s++){var l=6*Math.pow(4,s),c=4*l+2;n.clear(),o.length=0;for(var u=0;u<l;u++){for(var d=o[u]={facePoint:new P,adjacentEdges:new Array(4)},f=0;f<4;f++){var h=3*e[4*u+f];d.facePoint.x+=.25*t[h],d.facePoint.y+=.25*t[h+1],d.facePoint.z+=.25*t[h+2]}for(var _=0;_<4;_++){var g=e[4*u+_],y=e[4*u+(_+1)%4],v=Math.min(g,y)*c+Math.max(g,y);if(!n.has(v)){var p={edgePoint:new P,edgePointIndex:void 0},m=3*g,A=3*y;p.edgePoint.set(.25*(t[m]+t[A]),.25*(t[m+1]+t[A+1]),.25*(t[m+2]+t[A+2])),n.set(v,p)}var S=n.get(v);d.adjacentEdges[_]=S;var x=S.edgePoint,b=d.facePoint;x.x+=.25*b.x,x.y+=.25*b.y,x.z+=.25*b.z}}var C=l+2,w=C+l,E=0;this._sphereEdgeIdx=0;for(var T=e.slice(0,4*l),M=0;M<l;M++){var B=o[M];B.facePoint.copyToArray(t,3*(C+M));for(var I=C+M,F=void 0,L=void 0,V=void 0,D=0;D<4;D++){var N=T[E++];switch(D){case 0:{var O=B.adjacentEdges[D%4],G=B.adjacentEdges[(D+3)%4];L=this._calculateEdgeIndex(t,O,w),F=this._calculateEdgeIndex(t,G,w),V=F;break}case 1:case 2:{var Q=B.adjacentEdges[D%4];F=L,L=this._calculateEdgeIndex(t,Q,w);break}case 3:{F=L,L=V;break}}var H=4*(4*M+D);e[H]=N,e[H+1]=L,e[H+2]=I,e[H+3]=F}}}},r._generateAndReplacePoleUV=function(a,t,e,n){var o=t[8*a[e]+7];if(o===0||o===1){var s=8*a[e],l=8*(n+this._spherePoleIdx);t.set(t.subarray(s,s+8),l),t[l+6]=.5*(t[s+6]+t[8*a[e+1]+6]+t[8*a[e+2]+6]-.5),a[e]=n+this._spherePoleIdx++}},r._calculateEdgeIndex=function(a,t,e){if(t.edgePointIndex!==void 0)return t.edgePointIndex;t.edgePoint.copyToArray(a,3*(e+r._sphereEdgeIdx));var n=e+r._sphereEdgeIdx++;return t.edgePointIndex=n,n},r._setCuboidData=function(a,t,e,n,o,s,l){var c=t/2,u=e/2,d=n/2,f=8,h=new Float32Array(24*f);h[0]=-c,h[1]=u,h[2]=-d,h[6]=0,h[7]=0,h[8]=c,h[9]=u,h[10]=-d,h[14]=1,h[15]=0,h[16]=c,h[17]=u,h[18]=d,h[22]=1,h[23]=1,h[24]=-c,h[25]=u,h[26]=d,h[30]=0,h[31]=1;for(var _=0;_<4;_++){var g=f*_+3;h[g++]=0,h[g++]=1,h[g++]=0}h[32]=-c,h[33]=-u,h[34]=-d,h[38]=0,h[39]=1,h[40]=c,h[41]=-u,h[42]=-d,h[46]=1,h[47]=1,h[48]=c,h[49]=-u,h[50]=d,h[54]=1,h[55]=0,h[56]=-c,h[57]=-u,h[58]=d,h[62]=0,h[63]=0;for(var y=0;y<4;y++){var v=f*y+35;h[v++]=0,h[v++]=-1,h[v++]=0}h[64]=-c,h[65]=u,h[66]=-d,h[70]=0,h[71]=0,h[72]=-c,h[73]=u,h[74]=d,h[78]=1,h[79]=0,h[80]=-c,h[81]=-u,h[82]=d,h[86]=1,h[87]=1,h[88]=-c,h[89]=-u,h[90]=-d,h[94]=0,h[95]=1;for(var p=0;p<4;p++){var m=f*p+67;h[m++]=-1,h[m++]=0,h[m++]=0}h[96]=c,h[97]=u,h[98]=-d,h[102]=1,h[103]=0,h[104]=c,h[105]=u,h[106]=d,h[110]=0,h[111]=0,h[112]=c,h[113]=-u,h[114]=d,h[118]=0,h[119]=1,h[120]=c,h[121]=-u,h[122]=-d,h[126]=1,h[127]=1;for(var A=0;A<4;A++){var S=f*A+99;h[S++]=1,h[S++]=0,h[S++]=0}h[128]=-c,h[129]=u,h[130]=d,h[134]=0,h[135]=0,h[136]=c,h[137]=u,h[138]=d,h[142]=1,h[143]=0,h[144]=c,h[145]=-u,h[146]=d,h[150]=1,h[151]=1,h[152]=-c,h[153]=-u,h[154]=d,h[158]=0,h[159]=1;for(var x=0;x<4;x++){var b=f*x+131;h[b++]=0,h[b++]=0,h[b++]=1}h[160]=-c,h[161]=u,h[162]=-d,h[166]=1,h[167]=0,h[168]=c,h[169]=u,h[170]=-d,h[174]=0,h[175]=0,h[176]=c,h[177]=-u,h[178]=-d,h[182]=0,h[183]=1,h[184]=-c,h[185]=-u,h[186]=-d,h[190]=1,h[191]=1;for(var C=0;C<4;C++){var w=f*C+163;h[w++]=0,h[w++]=0,h[w++]=-1}var E=new Uint16Array(36);if(E[0]=0,E[1]=2,E[2]=1,E[3]=2,E[4]=0,E[5]=3,E[6]=4,E[7]=6,E[8]=7,E[9]=6,E[10]=4,E[11]=5,E[12]=8,E[13]=10,E[14]=9,E[15]=10,E[16]=8,E[17]=11,E[18]=12,E[19]=14,E[20]=15,E[21]=14,E[22]=12,E[23]=13,E[24]=16,E[25]=18,E[26]=17,E[27]=18,E[28]=16,E[29]=19,E[30]=20,E[31]=22,E[32]=23,E[33]=22,E[34]=20,E[35]=21,!s){var T=a.bounds;T.min.set(-c,-u,-d),T.max.set(c,u,d)}r._initialize(a,h,E,o,s,l)},r._setPlaneData=function(a,t,e,n,o,s,l,c){n=Math.max(1,Math.floor(n)),o=Math.max(1,Math.floor(o));for(var u=n+1,d=o+1,f=t/2,h=e/2,_=t/n,g=e/o,y=u*d,v=o*n,p=r._generateIndices(a.engine,y,v*6),m=1/u,A=1/n,S=1/o,x=8,b=new Float32Array(y*x),C=0;C<y;++C){var w=C%u,E=C*m|0,T=C*x;b[T++]=w*_-f,b[T++]=0,b[T++]=E*g-h,b[T++]=0,b[T++]=1,b[T++]=0,b[T++]=w*A,b[T++]=E*S}for(var M=0,B=0;B<v;++B){var I=B%n,F=B*A|0,L=F*u+I,V=L+1,D=L+u,N=D+1;p[M++]=L,p[M++]=D,p[M++]=V,p[M++]=D,p[M++]=N,p[M++]=V}if(!l){var O=a.bounds;O.min.set(-f,0,-h),O.max.set(f,0,h)}r._initialize(a,b,p,s,l,c)},r._setCylinderData=function(a,t,e,n,o,s,l,c,u){t===void 0&&(t=.5),e===void 0&&(e=.5),n===void 0&&(n=2),o===void 0&&(o=20),s===void 0&&(s=1),o=Math.floor(o),s=Math.floor(s);for(var d=o+1,f=s+1,h=n*.5,_=n/s,g=d*f,y=o*s,v=o*2,p=g+2+v,m=r._generateIndices(a.engine,p,y*6+v*3),A=1/d,S=1/o,x=1/s,b=8,C=new Float32Array(p*b),w=0,E=Math.PI,T=Math.PI*2,M=e-t,B=M/n,I=M/s,F=0;F<g;++F){var L=F%d,V=F*A|0,D=L*S,N=V*x,O=E+D*T,G=Math.sin(O),Q=Math.cos(O),H=e-V*I,ee=H*G,ve=V*_-h,oe=H*Q,ne=F*b;C[ne++]=ee,C[ne++]=ve,C[ne++]=oe,C[ne++]=G,C[ne++]=B,C[ne++]=Q,C[ne++]=D,C[ne++]=1-N}for(var Me=0;Me<y;++Me){var He=Me%o,ot=Me*S|0,be=ot*d+He,_t=be+1,qe=be+d,st=qe+1;m[w++]=_t,m[w++]=qe,m[w++]=be,m[w++]=_t,m[w++]=st,m[w++]=qe}var ce=g*b;C[ce++]=0,C[ce++]=-h,C[ce++]=0,C[ce++]=0,C[ce++]=-1,C[ce++]=0,C[ce++]=.5,C[ce++]=.5,C[ce++]=0,C[ce++]=h,C[ce++]=0,C[ce++]=0,C[ce++]=1,C[ce++]=0,C[ce++]=.5,C[ce++]=.5,ce=(g+2)*b;for(var Ct=1/(t*2),zr=1/(e*2),oi=d*s,xn=0;xn<o;++xn){var Li=xn*b,si=C[Li],va=C[Li+2];C[ce++]=si,C[ce++]=-h,C[ce++]=va,C[ce++]=0,C[ce++]=-1,C[ce++]=0,C[ce++]=si*zr+.5,C[ce++]=.5-va*zr;var gl=(xn+oi)*b;si=C[gl],va=C[gl+2],C[ce++]=si,C[ce++]=h,C[ce++]=va,C[ce++]=0,C[ce++]=1,C[ce++]=0,C[ce++]=si*Ct+.5,C[ce++]=.5-va*Ct}for(var zm=g+1,Ou=g+2,jh=Ou+1,ml=0;ml<o;++ml){var zu=ml*2,Xh=ml===o-1?0:zu+2;m[w++]=g,m[w++]=Ou+Xh,m[w++]=Ou+zu,m[w++]=zm,m[w++]=jh+zu,m[w++]=jh+Xh}if(!c){var Yh=a.bounds,yl=Math.max(t,e);Yh.min.set(-yl,-h,-yl),Yh.max.set(yl,h,yl)}r._initialize(a,C,m,l,c,u)},r._setTorusData=function(a,t,e,n,o,s,l,c,u){n=Math.floor(n),o=Math.floor(o);var d=(n+1)*(o+1),f=n*o,h=r._generateIndices(a.engine,d,f*6),_=8,g=new Float32Array(d*_);s=s/180*Math.PI;for(var y=0,v=r._tempVec30,p=0;p<=n;p++)for(var m=0;m<=o;m++){var A=m/o*s,S=p/n*Math.PI*2,x=Math.cos(S),b=Math.sin(S),C=Math.cos(A),w=Math.sin(A),E=(t+e*x)*C,T=(t+e*x)*w,M=e*b;g[y++]=E,g[y++]=T,g[y++]=M;var B=t*C,I=t*w;v.set(E-B,T-I,M).normalize(),g[y++]=v.x,g[y++]=v.y,g[y++]=v.z,g[y++]=m/o,g[y++]=p/n}y=0;for(var F=1;F<=n;F++)for(var L=1;L<=o;L++){var V=(o+1)*F+L-1,D=(o+1)*(F-1)+L-1,N=(o+1)*(F-1)+L,O=(o+1)*F+L;h[y++]=V,h[y++]=D,h[y++]=O,h[y++]=D,h[y++]=N,h[y++]=O}if(!c){var G=a.bounds,Q=t+e;G.min.set(-Q,-Q,-e),G.max.set(Q,Q,e)}r._initialize(a,g,h,l,c,u)},r._setConeData=function(a,t,e,n,o,s,l,c){n=Math.floor(n),o=Math.floor(o);for(var u=n+1,d=o+1,f=e*.5,h=e/o,_=u*d,g=n*o,y=_+1+n,v=r._generateIndices(a.engine,y,g*6+n*3),p=1/u,m=1/n,A=1/o,S=8,x=new Float32Array(y*8),b=0,C=Math.PI,w=Math.PI*2,E=t/e,T=0;T<_;++T){var M=T%u,B=T*p|0,I=M*m,F=B*A,L=C+I*w,V=Math.sin(L),D=Math.cos(L),N=t-B*t,O=N*V,G=B*h-f,Q=N*D,H=T*S;x[H++]=O,x[H++]=G,x[H++]=Q,x[H++]=V,x[H++]=E,x[H++]=D,x[H++]=I,x[H++]=1-F}for(var ee=0;ee<g;++ee){var ve=ee%n,oe=ee*m|0,ne=oe*u+ve,Me=ne+1,He=ne+u,ot=He+1;v[b++]=Me,v[b++]=He,v[b++]=ne,v[b++]=Me,v[b++]=ot,v[b++]=He}var be=_*S;x[be++]=0,x[be++]=-f,x[be++]=0,x[be++]=0,x[be++]=-1,x[be++]=0,x[be++]=.5,x[be++]=.5,be=(_+1)*S;for(var _t=1/(t*2),qe=0;qe<n;++qe){var st=x[qe*S],ce=x[qe*S+2];x[be++]=st,x[be++]=-f,x[be++]=ce,x[be++]=0,x[be++]=-1,x[be++]=0,x[be++]=st*_t+.5,x[be++]=.5-ce*_t}for(var Ct=_+1,zr=0;zr<n;++zr){var oi=zr,xn=zr===n-1?0:oi+1;v[b++]=_,v[b++]=Ct+xn,v[b++]=Ct+oi}if(!l){var Li=a.bounds;Li.min.set(-t,-f,-t),Li.max.set(t,f,t)}r._initialize(a,x,v,s,l,c)},r._setCapsuleData=function(a,t,e,n,o,s,l,c){n=Math.max(2,Math.floor(n)),o=Math.floor(o);for(var u=n+1,d=o+1,f=e*.5,h=e/o,_=u*d,g=n*o,y=u*u,v=n*n,p=_+2*y,m=r._generateIndices(a.engine,p,(g+2*v)*6),A=1/u,S=1/n,x=1/o,b=Math.PI,C=Math.PI*2,w=8,E=new Float32Array(p*w),T=0,M=0;M<_;++M){var B=M%u,I=M*A|0,F=B*S,L=I*x,V=b+F*C,D=Math.sin(V),N=Math.cos(V),O=M*w;E[O++]=t*D,E[O++]=I*h-f,E[O++]=t*N,E[O++]=D,E[O++]=0,E[O++]=N,E[O++]=F,E[O++]=1-L}for(var G=0;G<g;++G){var Q=G%n,H=G*S|0,ee=H*u+Q,ve=ee+1,oe=ee+u,ne=oe+1;m[T++]=ve,m[T++]=oe,m[T++]=ee,m[T++]=ve,m[T++]=ne,m[T++]=oe}if(r._createCapsuleCap(t,e,n,C,_,1,E,m,T),r._createCapsuleCap(t,e,n,-C,_+y,-1,E,m,T+6*v),!l){var Me=a.bounds;Me.min.set(-t,-t-f,-t),Me.max.set(t,t+f,t)}r._initialize(a,E,m,s,l,c)},r._initialize=function(a,t,e,n,o,s){if(o)s.setData(t),a.setIndices(e),a.uploadData(n);else{var l=[new De(X.Position,0,ie.Vector3,0),new De(X.Normal,12,ie.Vector3,0),new De(X.UV,24,ie.Vector2,0)];a.setVertexElements(l);var c=new qr(a.engine,mr.VertexBuffer,t,yt.Static,!0);a.setVertexBufferBinding(c,32,0),a.setIndices(e),a.calculateTangents(),a.uploadData(n),a.addSubMesh(0,e.length)}},r._generateIndices=function(a,t,e){var n=null;if(t>65535)if(a._hardwareRenderer.canIUse(J.elementIndexUint))n=new Uint32Array(e);else throw Error("The vertex count is over limit.");else n=new Uint16Array(e);return n},r._createCapsuleCap=function(a,t,e,n,o,s,l,c,u){for(var d=e+1,f=t*.5*s,h=d*d,_=e*e,g=1/d,y=1/e,v=8,p=0;p<h;++p){var m=p%d,A=p*g|0,S=m*y,x=A*y,b=S*n,C=x*Math.PI/2,w=Math.sin(C),E=-a*Math.cos(b)*w,T=a*Math.cos(C)*s+f,M=a*Math.sin(b)*w,B=(p+o)*v;l[B++]=E,l[B++]=T,l[B++]=M,l[B++]=E,l[B++]=T-f,l[B++]=M,l[B++]=S,l[B++]=x}for(var I=0;I<_;++I){var F=I%e,L=I*y|0,V=L*d+F+o,D=V+1,N=V+d,O=N+1;c[u++]=D,c[u++]=V,c[u++]=O,c[u++]=V,c[u++]=N,c[u++]=O}},r}();(function(){ut._tempVec30=new P})();(function(){ut._sphereSeedPositions=new Float32Array([-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,1,-1,-1,-1,-1,-1,1,-1])})();(function(){ut._sphereSeedCells=new Float32Array([0,1,2,3,3,2,4,5,5,4,6,7,7,0,3,5,7,6,1,0,6,4,2,1])})();(function(){ut._sphereEdgeIdx=0})();(function(){ut._spherePoleIdx=0})();var cm=function(r){W(i,r);function i(a){var t;return t=r.call(this,null)||this,t.name=a,t._bones=[],t.inverseBindMatrices=[],t.joints=[],t.skeleton="none",t}return i}(ri),Jt=function(r){W(i,r);function i(t){var e;e=r.call(this,t)||this,e._localBounds=new qt,e._jointDataCreateCache=new te(-1,-1),e._skin=null;var n=e.entity.engine._hardwareRenderer,o=n.renderStates.getParameter(n.gl.MAX_VERTEX_UNIFORM_VECTORS);o=Math.min(o,n._options._maxAllowSkinUniformVectorCount),e._maxVertexUniformVectors=o,e._onLocalBoundsChanged=e._onLocalBoundsChanged.bind(he(e));var s=e._localBounds;return s.min._onValueChanged=e._onLocalBoundsChanged,s.max._onValueChanged=e._onLocalBoundsChanged,e}var a=i.prototype;return a.update=function(){var e=this,n=e._skin,o=e._bones;if(n&&o)for(var s=this._jointMatrices,l=n.inverseBindMatrices,c,u=((c=this._rootBone)!=null?c:this.entity).getInvModelMatrix(),d=o.length-1;d>=0;d--){var f=o[d],h=d*16;f?Ye._floatMatrixMultiply(f.transform.worldMatrix,l[d].elements,0,s,h):s.set(l[d].elements,h),Ye._floatMatrixMultiply(u,s,h,s,h)}},a._updateShaderData=function(e){var n=this.entity,o=this._rootBone?this._rootBone.transform.worldMatrix:n.transform.worldMatrix;this._updateTransformShaderData(e,o);var s=this.shaderData,l=this.mesh,c=l._blendShapeManager;c._updateShaderData(s,this);var u=this._bones;if(u){var d=c._uniformOccupiesCount,f=u.length,h=this._jointDataCreateCache,_=f!==h.x;if(_||d!==h.y){var g=Math.ceil((this._maxVertexUniformVectors-(44+d))/4);if(f>g){var y=this.engine;if(y._hardwareRenderer.canIUseMoreJoints){if(_){var v;(v=this._jointTexture)==null||v.destroy(),this._jointTexture=new vr(y,4,f,j.R32G32B32A32,!1),this._jointTexture.filterMode=Xt.Point,this._jointTexture.isGCIgnored=!0}s.disableMacro("RENDERER_JOINTS_NUM"),s.enableMacro("RENDERER_USE_JOINT_TEXTURE"),s.setTexture(i._jointSamplerProperty,this._jointTexture)}else me.error("component's joints count("+f+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+this._maxVertexUniformVectors+", and don't support jointTexture in this device. suggest joint count less than "+g+".",this)}else{var p;(p=this._jointTexture)==null||p.destroy(),s.disableMacro("RENDERER_USE_JOINT_TEXTURE"),s.enableMacro("RENDERER_JOINTS_NUM",g.toString()),s.setFloatArray(i._jointMatrixProperty,this._jointMatrices)}h.set(f,d)}this._jointTexture&&this._jointTexture.setPixelBuffer(this._jointMatrices)}var m=n.layer;this._rendererLayer.set(m&65535,m>>>16&65535,0,0)},a._onDestroy=function(){var e,n;r.prototype._onDestroy.call(this),(e=this._rootBone)==null||e.transform._updateFlagManager.removeListener(this._onTransformChanged),this._rootBone=null,this._jointDataCreateCache=null,this._skin=null,this._blendShapeWeights=null,this._localBounds=null,this._jointMatrices=null,(n=this._jointTexture)==null||n.destroy(),this._jointTexture=null,this._bones=null},a._cloneTo=function(e,n,o){r.prototype._cloneTo.call(this,e,n,o);var s=new Array;if(this.rootBone){var l=this._getEntityHierarchyPath(n,this.rootBone,s);e.rootBone=l?this._getEntityByHierarchyPath(o,s):this.rootBone}var c=this._bones;if(c){for(var u=c.length,d=new Array(u),f=0;f<u;f++){var h=c[f],_=this._getEntityHierarchyPath(n,h,s);d[f]=_?this._getEntityByHierarchyPath(o,s):h}e.bones=d}this._blendShapeWeights&&(e._blendShapeWeights=this._blendShapeWeights.slice())},a._registerEntityTransformListener=function(){},a._updateBounds=function(e){if(this._rootBone){var n=this._localBounds,o=this._rootBone.transform.worldMatrix;qt.transform(n,o,e)}else r.prototype._updateBounds.call(this,e)},a._checkBlendShapeWeightLength=function(){var e=this._mesh,n=e?e.blendShapeCount:0,o=this._blendShapeWeights;if(o){var s=o.length;if(s!==n){var l=new Float32Array(n);if(n>s)l.set(o);else for(var c=0;c<n;c++)l[c]=o[c];this._blendShapeWeights=l}}else this._blendShapeWeights=new Float32Array(n)},a._onLocalBoundsChanged=function(){this._dirtyUpdateFlag|=gt.WorldVolume},a._getEntityHierarchyPath=function(e,n,o){for(o.length=0;n!==e;){var s=n.parent;if(!s)return!1;o.push(n.siblingIndex),n=s}return!0},a._getEntityByHierarchyPath=function(e,n){for(var o=e,s=n.length-1;s>=0;s--)o=o.children[n[s]];return o},q(i,[{key:"blendShapeWeights",get:function(){return this._checkBlendShapeWeightLength(),this._blendShapeWeights},set:function(e){this._checkBlendShapeWeightLength();var n=this._blendShapeWeights;if(e.length<=n.length)n.set(e);else for(var o=0,s=n.length;o<s;o++)n[o]=e[o]}},{key:"localBounds",get:function(){return this._localBounds},set:function(e){this._localBounds!==e&&this._localBounds.copyFrom(e)}},{key:"rootBone",get:function(){return this._rootBone},set:function(e){if(this._rootBone!==e){var n;(n=this._rootBone)==null||n.transform._updateFlagManager.removeListener(this._onTransformChanged),e.transform._updateFlagManager.addListener(this._onTransformChanged),this._rootBone=e,this._dirtyUpdateFlag|=gt.WorldVolume}}},{key:"bones",get:function(){return this._bones},set:function(e){if(this._bones!==e){var n,o,s,l=(s=(n=this._bones)==null?void 0:n.length)!=null?s:0,c,u=(c=(o=e)==null?void 0:o.length)!=null?c:0;if(l!==u){var d=this.shaderData;u>0?(this._jointMatrices=new Float32Array(u*16),d.enableMacro("RENDERER_HAS_SKIN"),d.setInt(i._jointCountProperty,u)):(this._jointMatrices=null,d.disableMacro("RENDERER_HAS_SKIN"))}this._bones=e}}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}}]),i}(hr);(function(){Jt._jointCountProperty=k.getByName("renderer_JointCount")})();(function(){Jt._jointSamplerProperty=k.getByName("renderer_JointSampler")})();(function(){Jt._jointMatrixProperty=k.getByName("renderer_JointMatrix")})();R([Z],Jt.prototype,"_localBounds",void 0);R([z],Jt.prototype,"_jointDataCreateCache",void 0);R([z],Jt.prototype,"_blendShapeWeights",void 0);R([z],Jt.prototype,"_maxVertexUniformVectors",void 0);R([z],Jt.prototype,"_rootBone",void 0);R([z],Jt.prototype,"_jointMatrices",void 0);R([z],Jt.prototype,"_jointTexture",void 0);R([z],Jt.prototype,"_bones",void 0);R([z],Jt.prototype,"_condensedBlendShapeWeights",void 0);R([z],Jt.prototype,"_onLocalBoundsChanged",null);var Sa=function(){function r(a){this._elementPoolIndex=0,this._elementPool=[],this._type=a}var i=r.prototype;return i.getFromPool=function(){var t=this,e=t._elementPoolIndex,n=t._elementPool;if(this._elementPoolIndex++,n.length===e){var o=new this._type;return n.push(o),o}else return n[e]},i.resetPool=function(){this._elementPoolIndex=0},i.garbageCollection=function(){for(var t=this,e=t._elementPool,n=e.length-1;n>=0;n--)e[n].dispose&&e[n].dispose()},r}(),Ln=function(){function r(a){this._subMeshPool=new Sa(Tu),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._flushId=0,this._vertexCount=0,this._elementCount=0,this._engine=a,this._initMeshes(a)}var i=r.prototype;return i.drawElement=function(t,e){var n=t.data;if(n.multiRenderData)for(var o=n.charsData,s=e.engine._renderElementPool,l=0,c=o.length;l<c;++l){var u=s.getFromPool();u.set(o[l],t.shaderPasses),this._drawSubElement(u,e)}else this._drawSubElement(t,e)},i._initMeshes=function(t){var e=r.MAX_VERTEX_COUNT;this._vertices=new Float32Array(e*9),this._indices=new Uint16Array(e*3);for(var n=this,o=n._meshes,s=n._meshCount,l=0;l<s;l++)o[l]=this._createMesh(t,l)},i.flush=function(t){var e=this._batchedQueue;e.length!==0&&(this._updateData(this._engine),this.drawBatches(t),r._canUploadSameBuffer||this._flushId++,e.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},i.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},i.destroy=function(){this._batchedQueue=null;for(var t=this,e=t._meshes,n=t._vertexBuffers,o=t._indiceBuffers,s=0,l=e.length;s<l;++s)e[s].destroy();this._meshes=null;for(var c=0,u=n.length;c<u;++c)n[c].destroy();this._vertexBuffers=null;for(var d=0,f=o.length;d<f;++d)o[d].destroy();this._indiceBuffers=null},i._drawSubElement=function(t,e){var n=t.data.verticesData.vertexCount;this._vertexCount+n>r.MAX_VERTEX_COUNT&&this.flush(e),this._vertexCount+=n,this._batchedQueue[this._elementCount++]=t},i._createMesh=function(t,e){var n=r.MAX_VERTEX_COUNT,o=new Ih(t,"BufferMesh"+e);o.isGCIgnored=!0;var s=[],l=this.createVertexElements(s),c=this._vertexBuffers[e]=new qr(t,mr.VertexBuffer,n*l,yt.Dynamic);c.isGCIgnored=!0;var u=this._indiceBuffers[e]=new qr(t,mr.IndexBuffer,n*6,yt.Dynamic);return u.isGCIgnored=!0,o.setVertexBufferBinding(c,l),o.setIndexBufferBinding(u,Wt.UInt16),o.setVertexElements(s),o},i._updateData=function(t){var e=this,n=e._meshes,o=e._flushId;!r._canUploadSameBuffer&&this._meshCount<=o&&(this._meshCount++,n[o]=this._createMesh(t,o));var s=this,l=s._batchedQueue,c=s._vertices,u=s._indices,d=n[o];d.clearSubMesh();for(var f=0,h=0,_=0,g=0,y=0,v=0,p=null,m=0,A=l.length;m<A;m++){var S=l[m],x=S.data;f=this.updateVertices(x,c,f);for(var b=x.verticesData.triangles,C=b.length,w=0;w<C;w++)u[h++]=b[w]+y;y+=x.verticesData.vertexCount,p===null||this.canBatch(p,S)?g+=C:(d.addSubMesh(this._getSubMeshFromPool(_,g)),_+=g,g=C,l[v++]=p),p=S}d.addSubMesh(this._getSubMeshFromPool(_,g)),l[v]=p,this._vertexBuffers[o].setData(c,0,0,f,Ri.Discard),this._indiceBuffers[o].setData(u,0,0,h,Ri.Discard)},i._getSubMeshFromPool=function(t,e){var n=this._subMeshPool.getFromPool();return n.start=t,n.count=e,n.topology=oa.Triangles,n},r}();(function(){Ln._disableBatchTag=yi.getByName("spriteDisableBatching")})();(function(){Ln.MAX_VERTEX_COUNT=4096})();(function(){Ln._canUploadSameBuffer=!0})();var ga,kc=(ga=function(){function r(){}return r.resetData=function(a){a._verticesData.triangles=[]},r.updatePositions=function(a){var t=a.width,e=a.height,n=a.sprite,o=a.tileMode,s=a.tiledAdaptiveThreshold,l=a._verticesData,c=l.positions,u=l.uvs,d=l.triangles,f=this,h=f._posRow,_=f._posColumn,g=f._uvRow,y=f._uvColumn;h.length=_.length=g.length=y.length=0,o===Ws.Adaptive?this._calculateAdaptiveDividing(n,t,e,s,h,_,g,y):this._calculateContinuousDividing(n,t,e,h,_,g,y);var v=a.sprite.pivot,p=v.x,m=v.y,A=a.width*p,S=a.height*m,x=kc._worldMatrix,b=x.elements,C=a.entity.transform.worldMatrix,w=C.elements,E=a.flipX?-1:1,T=a.flipY?-1:1,M,B,I,F,L,V;M=b[0]=w[0]*E,B=b[1]=w[1]*E,I=b[2]=w[2]*E,F=b[4]=w[4]*T,L=b[5]=w[5]*T,V=b[6]=w[6]*T,b[8]=w[8],b[9]=w[9],b[10]=w[10];for(var D=b[12]=w[12]-A*b[0]-S*b[4],N=b[13]=w[13]-A*b[1]-S*b[5],O=b[14]=w[14]-A*b[2]-S*b[6],G=h.length-1,Q=_.length-1,H=0,ee=0,ve=0;ve<Q;ve++)for(var oe=2*ve,ne=0;ne<G;ne++){var Me=g.get(2*ne),He=y.get(oe),ot=g.get(2*ne+1),be=y.get(oe+1);if(!(isNaN(Me)||isNaN(Me)||isNaN(ot)||isNaN(be))){d[ee++]=H,d[ee++]=H+1,d[ee++]=H+2,d[ee++]=H+2,d[ee++]=H+1,d[ee++]=H+3;var _t=h.get(ne),qe=_.get(ve),st=h.get(ne+1),ce=_.get(ve+1);u[H]?u[H].set(Me,He):u[H]=new te(Me,He);var Ct=c[H];Ct?Ct.set(M*_t+F*qe+D,B*_t+L*qe+N,I*_t+V*qe+O):c[H]=new P(M*_t+F*qe+D,B*_t+L*qe+N,I*_t+V*qe+O),H++,u[H]?u[H].set(ot,He):u[H]=new te(ot,He),Ct=c[H],Ct?Ct.set(M*st+F*qe+D,B*st+L*qe+N,I*st+V*qe+O):c[H]=new P(M*st+F*qe+D,B*st+L*qe+N,I*st+V*qe+O),H++,u[H]?u[H].set(Me,be):u[H]=new te(Me,be),Ct=c[H],Ct?Ct.set(M*_t+F*ce+D,B*_t+L*ce+N,I*_t+V*ce+O):c[H]=new P(M*_t+F*ce+D,B*_t+L*ce+N,I*_t+V*ce+O),H++,u[H]?u[H].set(ot,be):u[H]=new te(ot,be),Ct=c[H],Ct?Ct.set(M*st+F*ce+D,B*st+L*ce+N,I*st+V*ce+O):c[H]=new P(M*st+F*ce+D,B*st+L*ce+N,I*st+V*ce+O),H++}}a._verticesData.vertexCount=H,d.length=ee;var zr=a._bounds,oi=zr.min,xn=zr.max;oi.set(h.get(0),_.get(0),0),xn.set(h.get(G),_.get(Q),0),a._bounds.transform(x)},r.updateUVs=function(a){},r._calculateAdaptiveDividing=function(a,t,e,n,o,s,l,c){var u=a.border,d=a._getPositions(),f=d[0],h=f.x,_=f.y,g=d[3],y=g.x,v=g.y,p=a._getUVs(),m=p[0],A=p[1],S=p[2],x=p[3],b=a.width,C=a.height,w=b*u.x,E=b*u.z,T=w+E,M=b-T,B=C*u.w,I=C*u.y,F=B+I,L=C-F,V,D,N,O,G,Q,H;if(T>=t?(O=3,D=0):M>U.zeroTolerance?(Q=(t-T)/M,Q=Q%1>=n?Math.ceil(Q):Math.floor(Q),O=4+Q-1,D=2):(O=4,D=1),F>=e?(G=3,N=0):L>U.zeroTolerance?(H=(e-F)/L,H=H%1>=n?Math.ceil(H):Math.floor(H),G=4+H-1,N=2):(G=4,N=1),(O-1)*(G-1)*4>Ln.MAX_VERTEX_COUNT){o.add(t*h),o.add(t*y),s.add(e*_),s.add(e*v),l.add(m.x),l.add(x.x),c.add(m.y),c.add(x.y),me.warn("The number of vertices exceeds the upper limit("+Ln.MAX_VERTEX_COUNT+").");return}switch(D){case 0:V=t/T,o.add(b*h*V),o.add(w*V),o.add(t-b*(1-y)*V),l.add(m.x),l.add(A.x),l.add(S.x),l.add(x.x);break;case 1:o.add(b*h),o.add(w),o.add(t-E),o.add(t-b*(1-y)),l.add(m.x),l.add(A.x),l.add(NaN),l.add(NaN),l.add(S.x),l.add(x.x);break;case 2:V=t/(T+Q*M),o.add(b*h*V),o.add(w*V),l.add(m.x),l.add(A.x),l.add(A.x);for(var ee=0,ve=Q-1;ee<ve;ee++)o.add(w+(ee+1)*M*V),l.add(S.x),l.add(A.x);o.add(t-E*V),o.add(t-b*(1-y)*V),l.add(S.x),l.add(S.x),l.add(x.x);break}switch(N){case 0:V=e/F,s.add(C*_*V),s.add(I*V),s.add(e-C*(1-v)*V),c.add(m.y),c.add(A.y),c.add(S.y),c.add(x.y);break;case 1:s.add(C*_),s.add(I),s.add(e-B),s.add(e-C*(1-v)),c.add(m.y),c.add(A.y),c.add(NaN),c.add(NaN),c.add(S.y),c.add(x.y);break;case 2:V=e/(F+H*L),s.add(C*_*V),s.add(I*V),c.add(m.y),c.add(A.y),c.add(A.y);for(var oe=0,ne=H-1;oe<ne;oe++)s.add(I+(oe+1)*L*V),c.add(S.y),c.add(A.y);s.add(e-B*V),s.add(e-C*(1-v)*V),c.add(S.y),c.add(S.y),c.add(x.y);break}},r._calculateContinuousDividing=function(a,t,e,n,o,s,l){var c=a.border,u=a._getPositions(),d=u[0],f=d.x,h=d.y,_=u[3],g=_.x,y=_.y,v=a._getUVs(),p=v[0],m=v[1],A=v[2],S=v[3],x=a.width,b=a.height,C=x*c.x,w=x*c.z,E=C+w,T=x-E,M=b*c.w,B=b*c.y,I=M+B,F=b-I,L,V,D,N,O,G;if(E>=t?(D=3,L=0):T>U.zeroTolerance?(O=(t-E)/T,D=4+(O|0),L=2):(D=4,L=1),I>=e?(N=3,V=0):F>U.zeroTolerance?(G=(e-I)/F,N=4+(G|0),V=2):(N=4,V=1),(D-1)*(N-1)*4>Ln.MAX_VERTEX_COUNT){n.add(t*f),n.add(t*g),o.add(e*h),o.add(e*y),s.add(p.x),s.add(S.x),l.add(p.y),l.add(S.y),me.warn("The number of vertices exceeds the upper limit("+Ln.MAX_VERTEX_COUNT+").");return}switch(L){case 0:var Q=t/E;n.add(x*f*Q),n.add(C*Q),n.add(t-x*(1-g)*Q),s.add(p.x),s.add(m.x),s.add(A.x),s.add(S.x);break;case 1:n.add(x*f),n.add(C),n.add(t-w),n.add(t-x*(1-g)),s.add(p.x),s.add(m.x),s.add(NaN),s.add(NaN),s.add(A.x),s.add(S.x);break;case 2:n.add(x*f),n.add(C),s.add(p.x),s.add(m.x),s.add(m.x);for(var H=O|0,ee=0;ee<H;ee++)n.add(C+(ee+1)*T),s.add(A.x),s.add(m.x);n.add(t-w),n.add(t-x*(1-g)),s.add((A.x-m.x)*(O-H)+m.x),s.add(A.x),s.add(S.x);break}switch(V){case 0:var ve=e/I;o.add(b*h*ve),o.add(B*ve),o.add(e-b*(1-y)*ve),l.add(p.y),l.add(m.y),l.add(A.y),l.add(S.y);break;case 1:o.add(b*h),o.add(B),o.add(e-M),o.add(e-b*(1-y)),l.add(p.y),l.add(m.y),l.add(NaN),l.add(NaN),l.add(A.y),l.add(S.y);break;case 2:o.add(b*h),o.add(B),l.add(p.y),l.add(m.y),l.add(m.y);for(var oe=G|0,ne=0;ne<oe;ne++)o.add(B+(ne+1)*F),l.add(A.y),l.add(m.y);o.add(e-M),o.add(e-b*(1-y)),l.add((A.y-m.y)*(G-oe)+m.y),l.add(A.y),l.add(S.y);break}},r}(),function(){ga._worldMatrix=new $}(),function(){ga._posRow=new $e}(),function(){ga._posColumn=new $e}(),function(){ga._uvRow=new $e}(),function(){ga._uvColumn=new $e}(),ga);kc=R([Sr()],kc);var fp;(function(r){r[r.Compressed=0]="Compressed",r[r.WithoutTiled=1]="WithoutTiled",r[r.WithTiled=2]="WithTiled"})(fp||(fp={}));var Nh=function(i,a,t,e,n){e===void 0&&(e=null),n===void 0&&(n=null),this.vertexCount=i,this.positions=a,this.uvs=t,this.triangles=e,this.color=n},tt=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._tileMode=Ws.Continuous,e._tiledAdaptiveThreshold=.5,e._color=new K(1,1,1,1),e._sprite=null,e._automaticWidth=0,e._automaticHeight=0,e._customWidth=void 0,e._customHeight=void 0,e._flipX=!1,e._flipY=!1,e._maskLayer=Lo.Layer0,e._maskInteraction=Tt.None,e._verticesData=new Nh(4,[],[],null,e._color),e.drawMode=nn.Simple,e.setMaterial(e._engine._spriteDefaultMaterial),e._onSpriteChange=e._onSpriteChange.bind(he(e)),e}var a=i.prototype;return a._cloneTo=function(e,n,o){r.prototype._cloneTo.call(this,e,n,o),e._assembler.resetData(e),e.sprite=this._sprite,e.drawMode=this._drawMode},a._updateShaderData=function(e){this._updateTransformShaderData(e,$._identity)},a._updateBounds=function(e){this.sprite?this._assembler.updatePositions(this):(e.min.set(0,0,0),e.max.set(0,0,0))},a._render=function(e){var n;if(!(!((n=this.sprite)!=null&&n.texture)||!this.width||!this.height)){this._dirtyUpdateFlag&gt.WorldVolume&&(this._assembler.updatePositions(this),this._dirtyUpdateFlag&=~gt.WorldVolume),this._dirtyUpdateFlag&2&&(this._assembler.updateUVs(this),this._dirtyUpdateFlag&=-3);var o=this.getMaterial(),s=this.sprite.texture,l=this._engine._spriteRenderDataPool.getFromPool();l.set(this,o,this._verticesData,s),e.camera._renderPipeline.pushRenderData(e,l)}},a._onDestroy=function(){var e=this._sprite;e&&(this._addResourceReferCount(e,-1),e._updateFlagManager.removeListener(this._onSpriteChange)),r.prototype._onDestroy.call(this),this._entity=null,this._color=null,this._sprite=null,this._assembler=null,this._verticesData=null},a._calDefaultSize=function(){var e=this._sprite;e?(this._automaticWidth=e.width,this._automaticHeight=e.height):this._automaticWidth=this._automaticHeight=0,this._dirtyUpdateFlag&=-5},a._updateStencilState=function(e,n){var o=this.getMaterial(),s=this._engine,l=s._spriteDefaultMaterials;if(o===l[e])this.setMaterial(l[n]);else{var c=o.renderState.stencilState;n===Tt.None?(c.enabled=!1,c.writeMask=255,c.referenceValue=0,c.compareFunctionFront=c.compareFunctionBack=Te.Always):(c.enabled=!0,c.writeMask=0,c.referenceValue=1,c.compareFunctionFront=c.compareFunctionBack=n===Tt.VisibleInsideMask?Te.LessEqual:Te.Greater)}},a._onSpriteChange=function(e){switch(e){case Be.texture:this.shaderData.setTexture(i._textureProperty,this.sprite.texture);break;case Be.size:var n=this,o=n._drawMode;this._dirtyUpdateFlag|=4,this._drawMode===nn.Sliced?this._dirtyUpdateFlag|=gt.WorldVolume:o===nn.Tiled?this._dirtyUpdateFlag|=3:(this._customWidth===void 0||this._customHeight===void 0)&&(this._dirtyUpdateFlag|=gt.WorldVolume);break;case Be.border:this._drawMode===nn.Sliced&&(this._dirtyUpdateFlag|=3);break;case Be.region:case Be.atlasRegionOffset:this._dirtyUpdateFlag|=3;break;case Be.atlasRegion:this._dirtyUpdateFlag|=2;break;case Be.pivot:this._dirtyUpdateFlag|=gt.WorldVolume;break;case Be.destroy:this.sprite=null;break}},q(i,[{key:"drawMode",get:function(){return this._drawMode},set:function(e){if(this._drawMode!==e){switch(this._drawMode=e,e){case nn.Simple:this._assembler=pi;break;case nn.Sliced:this._assembler=Qs;break;case nn.Tiled:this._assembler=kc;break}this._assembler.resetData(this),this._dirtyUpdateFlag|=3}}},{key:"tileMode",get:function(){return this._tileMode},set:function(e){this._tileMode!==e&&(this._tileMode=e,this.drawMode===nn.Tiled&&(this._dirtyUpdateFlag|=3))}},{key:"tiledAdaptiveThreshold",get:function(){return this._tiledAdaptiveThreshold},set:function(e){e!==this._tiledAdaptiveThreshold&&(e=U.clamp(e,0,1),this._tiledAdaptiveThreshold=e,this.drawMode===nn.Tiled&&(this._dirtyUpdateFlag|=3))}},{key:"sprite",get:function(){return this._sprite},set:function(e){var n=this._sprite;n!==e&&(n&&(this._addResourceReferCount(n,-1),n._updateFlagManager.removeListener(this._onSpriteChange)),this._dirtyUpdateFlag|=7,e?(this._addResourceReferCount(e,1),e._updateFlagManager.addListener(this._onSpriteChange),this.shaderData.setTexture(i._textureProperty,e.texture)):this.shaderData.setTexture(i._textureProperty,null),this._sprite=e)}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"width",get:function(){return this._customWidth!==void 0?this._customWidth:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticWidth)},set:function(e){this._customWidth!==e&&(this._customWidth=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"height",get:function(){return this._customHeight!==void 0?this._customHeight:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticHeight)},set:function(e){this._customHeight!==e&&(this._customHeight=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._updateStencilState(this._maskInteraction,e),this._maskInteraction=e)}}]),i}(Ce);(function(){tt._textureProperty=k.getByName("renderer_SpriteTexture")})();R([z],tt.prototype,"_verticesData",void 0);R([z],tt.prototype,"_drawMode",void 0);R([Ie],tt.prototype,"_assembler",void 0);R([Ie],tt.prototype,"_tileMode",void 0);R([Ie],tt.prototype,"_tiledAdaptiveThreshold",void 0);R([Z],tt.prototype,"_color",void 0);R([z],tt.prototype,"_sprite",void 0);R([z],tt.prototype,"_automaticWidth",void 0);R([z],tt.prototype,"_automaticHeight",void 0);R([Ie],tt.prototype,"_customWidth",void 0);R([Ie],tt.prototype,"_customHeight",void 0);R([Ie],tt.prototype,"_flipX",void 0);R([Ie],tt.prototype,"_flipY",void 0);R([Ie],tt.prototype,"_maskLayer",void 0);R([Ie],tt.prototype,"_maskInteraction",void 0);R([z],tt.prototype,"_onSpriteChange",null);var hp;(function(r){r[r.UV=2]="UV",r[r.RenderData=3]="RenderData",r[r.AutomaticSize=4]="AutomaticSize",r[r.All=7]="All"})(hp||(hp={}));var ar=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e.influenceLayers=Lo.Everything,e._sprite=null,e._automaticWidth=0,e._automaticHeight=0,e._customWidth=void 0,e._customHeight=void 0,e._flipX=!1,e._flipY=!1,e._alphaCutoff=.5,e._verticesData=new Nh(4,[],[]),pi.resetData(he(e)),e.setMaterial(e._engine._spriteMaskDefaultMaterial),e.shaderData.setFloat(i._alphaCutoffProperty,e._alphaCutoff),e._onSpriteChange=e._onSpriteChange.bind(he(e)),e}var a=i.prototype;return a._cloneTo=function(e,n,o){r.prototype._cloneTo.call(this,e,n,o),e.sprite=this._sprite},a._updateBounds=function(e){this.sprite?pi.updatePositions(this):(e.min.set(0,0,0),e.max.set(0,0,0))},a._render=function(e){var n;if(!(!((n=this.sprite)!=null&&n.texture)||!this.width||!this.height)){this._dirtyUpdateFlag&gt.WorldVolume&&(pi.updatePositions(this),this._dirtyUpdateFlag&=~gt.WorldVolume),this._dirtyUpdateFlag&2&&(pi.updateUVs(this),this._dirtyUpdateFlag&=-3),e.camera._renderPipeline._allSpriteMasks.add(this);var o=this._engine._spriteMaskRenderDataPool.getFromPool(),s=this.getMaterial();o.set(this,s,this._verticesData);var l=this._engine._renderElementPool.getFromPool();l.set(o,s.shader.subShaders[0].passes),this._maskElement=l}},a._onDestroy=function(){var e=this._sprite;e&&(this._addResourceReferCount(e,-1),e._updateFlagManager.removeListener(this._onSpriteChange)),r.prototype._onDestroy.call(this),this._sprite=null,this._verticesData=null},a._calDefaultSize=function(){var e=this._sprite;e?(this._automaticWidth=e.width,this._automaticHeight=e.height):this._automaticWidth=this._automaticHeight=0,this._dirtyUpdateFlag&=-5},a._onSpriteChange=function(e){switch(e){case Be.texture:this.shaderData.setTexture(i._textureProperty,this.sprite.texture);break;case Be.size:this._dirtyUpdateFlag|=4,(this._customWidth===void 0||this._customHeight===void 0)&&(this._dirtyUpdateFlag|=gt.WorldVolume);break;case Be.region:case Be.atlasRegionOffset:this._dirtyUpdateFlag|=3;break;case Be.atlasRegion:this._dirtyUpdateFlag|=2;break;case Be.pivot:this._dirtyUpdateFlag|=gt.WorldVolume;break;case Be.destroy:this.sprite=null;break}},q(i,[{key:"width",get:function(){return this._customWidth!==void 0?this._customWidth:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticWidth)},set:function(e){this._customWidth!==e&&(this._customWidth=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"height",get:function(){return this._customHeight!==void 0?this._customHeight:(this._dirtyUpdateFlag&4&&this._calDefaultSize(),this._automaticHeight)},set:function(e){this._customHeight!==e&&(this._customHeight=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyUpdateFlag|=gt.WorldVolume)}},{key:"sprite",get:function(){return this._sprite},set:function(e){var n=this._sprite;n!==e&&(n&&(this._addResourceReferCount(n,-1),n._updateFlagManager.removeListener(this._onSpriteChange)),this._dirtyUpdateFlag|=7,e?(this._addResourceReferCount(e,1),e._updateFlagManager.addListener(this._onSpriteChange),this.shaderData.setTexture(i._textureProperty,e.texture)):this.shaderData.setTexture(i._textureProperty,null),this._sprite=e)}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(i._alphaCutoffProperty,e))}}]),i}(Ce);(function(){ar._textureProperty=k.getByName("renderer_MaskTexture")})();(function(){ar._alphaCutoffProperty=k.getByName("renderer_MaskAlphaCutoff")})();R([Ie],ar.prototype,"influenceLayers",void 0);R([z],ar.prototype,"_verticesData",void 0);R([z],ar.prototype,"_sprite",void 0);R([z],ar.prototype,"_automaticWidth",void 0);R([z],ar.prototype,"_automaticHeight",void 0);R([Ie],ar.prototype,"_customWidth",void 0);R([Ie],ar.prototype,"_customHeight",void 0);R([Ie],ar.prototype,"_flipX",void 0);R([Ie],ar.prototype,"_flipY",void 0);R([Ie],ar.prototype,"_alphaCutoff",void 0);R([z],ar.prototype,"_onSpriteChange",null);var _p;(function(r){r[r.UV=2]="UV",r[r.RenderData=3]="RenderData",r[r.AutomaticSize=4]="AutomaticSize",r[r.All=7]="All"})(_p||(_p={}));var qx=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._charInfoMap={},e._space=1,e._curX=1,e._curY=1,e._nextY=1,e}var a=i.prototype;return a.uploadCharTexture=function(e){var n=e.w,o=e.h,s=e.data,l=this,c=l._space,u=l.texture,d=u.width,f=n+c,h=o+c;if(1+f>=d||1+h>=d)throw Error("The char fontSize is too large.");var _=this._curX+f;_>=d&&(this._curX=c,this._curY=this._nextY+c);var g=this._curY+h;if(g>this._nextY&&(this._nextY=g),g>=d)return!1;n>0&&o>0&&s&&(e.bufferOffset=new te(this._curX,this._curY),u.setPixelBuffer(s,0,this._curX,this._curY,n,o),u.generateMipmaps());var y=1/d,v=this._curX,p=this._curY,m=n,A=o,S=v*y,x=(v+m)*y,b=p*y,C=(p+A)*y;e.x=v,e.y=p;var w=e.uvs;return w[0].set(S,b),w[1].set(x,b),w[2].set(x,C),w[3].set(S,C),this._curX+=f+c,!0},a.addCharInfo=function(e,n){this._charInfoMap[e.charCodeAt(0)]=n},a.getCharInfo=function(e){return this._charInfoMap[e.charCodeAt(0)]},a._onDestroy=function(){r.prototype._onDestroy.call(this),this.texture.destroy(),this.texture=null,this._charInfoMap={}},i}(ni),Xr=function(){function r(){}return r.textContext=function(){var a=r._textContext;if(!a){var t;try{t=new OffscreenCanvas(0,0)}catch{t=document.createElement("canvas")}var e=t.getContext("2d",{willReadFrequently:!0});a={canvas:t,context:e},r._textContext=a}return a},r.measureFont=function(a){var t=r._fontSizeInfoCache,e=t[a];return e||(e=r._measureFontOrChar(a),t[a]=e,e)},r.getNativeFontString=function(a,t,e){var n=e&ji.Bold?"bold ":"";return e&ji.Italic&&(n+="italic "),!/([\"\'])[^\'\"]+\1/.test(a)&&r._genericFontFamilies.indexOf(a)==-1&&(a='"'+a+'"'),n+=t+"px "+a,n},r.measureChar=function(a,t){return r._measureFontOrChar(t,a)},r.measureTextWithWrap=function(a){var t=a._subFont,e=t.nativeFontString,n=r.measureFont(e),o=a.text.split(/(?:\r\n|\r|\n)/),s=new Array,l=new Array,c=new Array,u=ei._pixelsPerUnit,d=n.size+a.lineSpacing*u,f=a.width*u,h=0;t.nativeFontString=e;for(var _=0,g=o.length;_<g;_++){var y=o[_];if(y.length===0){this._pushLine(s,l,c,"",0,0,0);continue}for(var v="",p=0,m=0,A=0,S="",x=0,b=0,C=0,w=!1,E=0,T=y.length;E<T;++E){var M=y[E],B=r._getCharInfo(M,e,t),I=M.charCodeAt(0),F=I===32;if(!(F&&w&&S.length===0&&v.length===0)){var L=F||I>=19968&&I<=40959,V=B.w,D=B.offsetY,N=B.h*.5,O=N+D,G=N-D;L?(v.length>0&&(x+p>f?(x>0&&this._pushLine(s,l,c,S,x,b,C),h=Math.max(h,x),w=!0,S=v,x=p,b=m,C=A):(S+=v,x+=p,b=Math.max(b,m),C=Math.max(C,A)),v="",p=m=A=0),x+V>f&&x>0?(this._pushLine(s,l,c,S,x,b,C),h=Math.max(h,x),w=!0,F?(S="",x=b=C=0):(S=M,x=B.xAdvance,b=O,C=G)):(S+=M,x+=B.xAdvance,b=Math.max(b,O),C=Math.max(C,G))):p+B.w>f?(x>0&&(this._pushLine(s,l,c,S,x,b,C),h=Math.max(h,x),S="",x=b=C=0),p>0&&this._pushLine(s,l,c,v,p,m,A),h=Math.max(h,p),w=!0,v=M,p=B.xAdvance,m=O,A=G):(v+=M,p+=B.xAdvance,m=Math.max(m,O),A=Math.max(A,G))}}p>0&&(x+p>f?(x>0&&this._pushLine(s,l,c,S,x,b,C),h=Math.max(h,x),x=0,p>0&&this._pushLine(s,l,c,v,p,m,A),h=Math.max(h,p)):(S+=v,x+=p,b=Math.max(b,m),C=Math.max(C,A))),x>0&&(this._pushLine(s,l,c,S,x,b,C),h=Math.max(h,x))}var Q=a.height*u;return a.overflowMode===ka.Overflow&&(Q=d*s.length),{width:h,height:Q,lines:s,lineWidths:l,lineHeight:d,lineMaxSizes:c}},r.measureTextWithoutWrap=function(a){var t=a._subFont,e=t.nativeFontString,n=r.measureFont(e),o=a.text.split(/(?:\r\n|\r|\n)/),s=o.length,l=new Array,c=new Array,u=new Array,d=ei._pixelsPerUnit,f=n.size+a.lineSpacing*d,h=0;t.nativeFontString=e;for(var _=0;_<s;++_){for(var g=o[_],y=0,v=0,p=0,m=0,A=g.length;m<A;++m){var S=r._getCharInfo(g[m],e,t);y+=S.xAdvance;var x=S.offsetY,b=S.h*.5,C=b+x,w=b-x;v<C&&(v=C),p<w&&(p=w)}y>0&&(this._pushLine(l,c,u,g,y,v,p),h=Math.max(h,y))}var E=a.height*d;return a.overflowMode===ka.Overflow&&(E=f*l.length),{width:h,height:E,lines:l,lineWidths:c,lineHeight:f,lineMaxSizes:u}},r.getNativeFontHash=function(a,t,e){var n=e&ji.Bold?"bold":"";return e&ji.Italic&&(n+="italic"),!/([\"\'])[^\'\"]+\1/.test(a)&&r._genericFontFamilies.indexOf(a)==-1&&(a=""+a),n+=t+"px"+a,n},r._measureFontOrChar=function(a,t){t===void 0&&(t="");var e=r.textContext(),n=e.canvas,o=e.context;o.font=a;var s=t||r._measureString,l=Math.max(1,Math.round(o.measureText(s).width)),c=Math.ceil(o.measureText(r._measureBaseline).width),u=c*r._heightMultiplier;c=r._baselineMultiplier*c|0;var d=r._extendHeight;u+=d,c+=d*.5,n.width=l,n.height=u,o.font=a,o.fillStyle="#000",o.clearRect(0,0,l,u),o.textBaseline="middle",o.fillStyle="#fff",o.fillText(s,0,c);for(var f=o.getImageData(0,0,l,u).data,h=f.length,_=-1,g=-1,y,v=0,p=0,m=0,A=n.width,S=1/A,x=0;x<h;x+=4)if(f[x+3]!==0){var b=x*.25;y=~~(b*S),_===-1&&(_=y),y>g&&(g=y)}else f[x]=f[x+1]=f[x+2]=255;_!==-1&&g!==-1&&(v=c-_,p=g-c+1,m=v+p);var C={ascent:v,descent:p,size:m};if(t){var w=null;if(m>0){var E=A*4;w=new Uint8Array(f.buffer,_*E,m*E)}return{char:t,x:0,y:0,w:l,h:m,offsetX:0,offsetY:(v-p)*.5,xAdvance:l,uvs:[new te,new te,new te,new te],ascent:v,descent:p,index:0,data:w}}else return C},r._getCharInfo=function(a,t,e){var n=e._getCharInfo(a);return n||(n=r.measureChar(a,t),e._uploadCharTexture(n),e._addCharInfo(a,n)),n},r._pushLine=function(a,t,e,n,o,s,l){a.push(n),t.push(o),e.push({ascent:s,descent:l,size:s+l})},r}();(function(){Xr._genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui","math","emoji","fangsong"]})();(function(){Xr._extendHeight=0})();(function(){Xr._measureString="|ÉqÅ"})();(function(){Xr._measureBaseline="M"})();(function(){Xr._heightMultiplier=2})();(function(){Xr._baselineMultiplier=1.4})();(function(){Xr._fontSizeInfoCache={}})();(function(){Xr._textContext=null})();var Kx=function(){function r(a){this._fontAtlases=[],this._lastIndex=-1,this._engine=a}var i=r.prototype;return i.destroy=function(){for(var t=this._fontAtlases,e=0,n=t.length;e<n;++e)t[e].destroy(!0);t.length=0},i._uploadCharTexture=function(t){var e=this._fontAtlases,n=this._lastIndex;n===-1&&(this._createFontAtlas(),n++);var o=e[n];o.uploadCharTexture(t)||(o=this._createFontAtlas(),o.uploadCharTexture(t),n++),this._lastIndex=n,t.data=null},i._addCharInfo=function(t,e){var n=this._lastIndex;e.index=n,this._fontAtlases[n].addCharInfo(t,e)},i._getCharInfo=function(t){for(var e=this._fontAtlases,n=0,o=e.length;n<o;++n){var s=e[n],l=s.getCharInfo(t);if(l)return l}return null},i._getTextureByIndex=function(t){var e=this._fontAtlases[t];return e?e.texture:null},i._getLastIndex=function(){return this._lastIndex},i._createFontAtlas=function(){var t=this,e=t._engine,n=new qx(e),o=new vr(e,256,256,j.R8G8B8A8,!1);o.filterMode=Xt.Bilinear,n.texture=o,n.isGCIgnored=o.isGCIgnored=!0,this._fontAtlases.push(n);var s=this.nativeFontString;return e.resourceManager.addContentRestorer(new(function(l){W(c,l);function c(){return l.call(this,n)}var u=c.prototype;return u.restoreContent=function(){var f=this.resource,h=f._charInfoMap,_=f.texture;for(var g in h){var y=h[g],v=Xr.measureChar(y.char,s).data;if(y.w>0&&y.h>0&&v){var p=y.bufferOffset;_.setPixelBuffer(v,0,p.x,p.y,y.w,y.h)}}_.generateMipmaps()},c}(Ai))),n},r}(),No=function(r){W(i,r);function i(t,e){e===void 0&&(e="");var n;return n=r.call(this,t)||this,n._name="",n._subFontMap={},n._name=e,n}var a=i.prototype;return a._getSubFont=function(e,n){var o=e+"-"+n,s=this._subFontMap,l=s[o];return l||(l=new Kx(this.engine),s[o]=l,l)},a._onDestroy=function(){r.prototype._onDestroy.call(this);var e=this._subFontMap;for(var n in e)e[n].destroy();this._subFontMap=null,delete this.engine._fontMap[this._name]},i.createFromOS=function(e,n){if(n){var o=e._fontMap,s=o[n];return s||(s=new i(e,n),o[n]=s,s)}return null},q(i,[{key:"name",get:function(){return this._name}}]),i}(ni),um=function r(){this.localPositions=new ue;var i=[new P,new P,new P,new P];this.renderData=new Nh(4,i,null,r.triangles,null)};(function(){um.triangles=[0,2,1,2,0,3]})();var Jx=function(){function r(a,t){this._elements=[],this._type=a;for(var e=this._elements,n=0;n<t;++n)e[n]=new a}var i=r.prototype;return i.get=function(){return this._elements.length>0?this._elements.pop():new this._type},i.put=function(t){this._elements.push(t)},r}(),At=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._subFont=null,e._charRenderDatas=[],e._dirtyFlag=15,e._color=new K(1,1,1,1),e._text="",e._width=0,e._height=0,e._localBounds=new qt,e._font=null,e._fontSize=24,e._fontStyle=ji.None,e._lineSpacing=0,e._horizontalAlignment=wa.Center,e._verticalAlignment=Ta.Center,e._enableWrapping=!1,e._overflowMode=ka.Overflow,e._maskInteraction=Tt.None,e._maskLayer=Lo.Layer0,e._init(),e}var a=i.prototype;return a._init=function(){var e=this.engine;this._font=e._textDefaultFont,this._addResourceReferCount(this._font,1),this.setMaterial(e._spriteDefaultMaterial)},a._onDestroy=function(){this._font&&(this._addResourceReferCount(this._font,-1),this._font=null),r.prototype._onDestroy.call(this);for(var e=this._charRenderDatas,n=0,o=e.length;n<o;++n)i._charRenderDataPool.put(e[n]);e.length=0,this._subFont&&(this._subFont=null)},a._cloneTo=function(e,n,o){r.prototype._cloneTo.call(this,e,n,o),e.font=this._font,e._subFont=this._subFont},a._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},a._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},a._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},a._updateShaderData=function(e){this._updateTransformShaderData(e,$._identity)},a._updateBounds=function(e){qt.transform(this._localBounds,this._entity.transform.worldMatrix,e)},a._render=function(e){if(!this._isTextNoVisible()){this._isContainDirtyFlag(16)&&(this._updateStencilState(),this._setDirtyFlagFalse(16)),this._isContainDirtyFlag(1)&&(this._resetSubFont(),this._setDirtyFlagFalse(1)),this._isContainDirtyFlag(2)&&(this._updateLocalData(),this._setDirtyFlagFalse(2)),this._isContainDirtyFlag(4)&&(this._updatePosition(),this._setDirtyFlagFalse(4));var n=this._engine._spriteRenderDataPool,o=this._engine._textRenderDataPool.getFromPool(),s=o.charsData,l=this.getMaterial(),c=this._charRenderDatas,u=c.length;o.component=this,o.material=l,s.length=u;for(var d=0;d<u;++d){var f=c[d],h=n.getFromPool();h.set(this,l,f.renderData,f.texture,d),s[d]=h}e.camera._renderPipeline.pushRenderData(e,o)}},a._updateStencilState=function(){var e=this.getInstanceMaterial(),n=e.renderState.stencilState,o=this._maskInteraction;if(o===Tt.None)n.enabled=!1,n.writeMask=255,n.referenceValue=0,n.compareFunctionFront=n.compareFunctionBack=Te.Always;else{n.enabled=!0,n.writeMask=0,n.referenceValue=1;var s=o===Tt.VisibleInsideMask?Te.LessEqual:Te.Greater;n.compareFunctionFront=s,n.compareFunctionBack=s}},a._resetSubFont=function(){var e=this._font;this._subFont=e._getSubFont(this.fontSize,this.fontStyle),this._subFont.nativeFontString=Xr.getNativeFontString(e.name,this.fontSize,this.fontStyle)},a._updatePosition=function(){for(var e=this.entity.transform,n=e.worldMatrix.elements,o=this._charRenderDatas,s=n[0],l=n[1],c=n[2],u=n[4],d=n[5],f=n[6],h=n[12],_=n[13],g=n[14],y=i._tempVec31.set(u,d,f),v=i._tempVec30.set(s,l,c),p=0,m=o.length;p<m;++p){var A=o[p],S=A.localPositions,x=A.renderData.positions,b=S.x,C=S.y,w=x[0];w.x=b*s+C*u+h,w.y=b*l+C*d+_,w.z=b*c+C*f+g;var E=x[1];P.scale(v,S.z-b,E),P.add(w,E,E);var T=x[2];P.scale(y,S.w-C,T),P.add(w,T,x[3]),P.add(E,T,T)}},a._updateLocalData=function(){var e=this._localBounds,n=e.min,o=e.max,s=this,l=s.color,c=s._charRenderDatas,u=s._subFont,d=this.enableWrapping?Xr.measureTextWithWrap(this):Xr.measureTextWithoutWrap(this),f=d.height,h=d.lines,_=d.lineWidths,g=d.lineHeight,y=d.lineMaxSizes,v=i._charRenderDataPool,p=h.length,m=0;if(p>0){var A=ei._pixelsPerUnit,S=this.horizontalAlignment,x=1/A,b=this.width*A,C=b*.5,w=this.height*A,E=g*.5,T=0,M=g*.5-y[0].ascent,B=g*.5-y[p-1].descent-1;switch(this.verticalAlignment){case Ta.Top:T=w*.5-E+M;break;case Ta.Center:T=f*.5-E-(B-M)*.5;break;case Ta.Bottom:T=f-w*.5-E-B;break}for(var I=-1,F=Number.MAX_SAFE_INTEGER,L=Number.MAX_SAFE_INTEGER,V=Number.MIN_SAFE_INTEGER,D=Number.MIN_SAFE_INTEGER,N=0;N<p;++N){var O=_[N];if(O>0){var G=h[N],Q=0,H=-1;switch(I<0&&(I=N),S){case wa.Left:Q=-C;break;case wa.Center:Q=-O*.5;break;case wa.Right:Q=C-O;break}for(var ee=0,ve=G.length;ee<ve;++ee){var oe=G[ee],ne=u._getCharInfo(oe);if(ne.h>0){var Me,He;H<0&&(H=ee);var ot=(Me=c)[He=m++]||(Me[He]=v.get()),be=ot.renderData,_t=ot.localPositions;ot.texture=u._getTextureByIndex(ne.index),be.color=l,be.uvs=ne.uvs;var qe=ne.w,st=ne.ascent,ce=ne.descent,Ct=Q*x,zr=(Q+qe)*x,oi=(T+st)*x,xn=(T-ce)*x;_t.set(Ct,oi,zr,xn),N===I&&(D=Math.max(D,oi)),L=Math.min(L,xn),ee===H&&(F=Math.min(F,Ct)),V=Math.max(V,zr)}Q+=ne.xAdvance}}T-=g}I<0?(n.set(0,0,0),o.set(0,0,0)):(n.set(F,L,0),o.set(V,D,0))}else n.set(0,0,0),o.set(0,0,0);var Li=c.length;if(Li>m){for(var si=m;si<Li;++si)v.put(c[si]);c.length=m}u._getLastIndex()>0&&c.sort(function(va,gl){return va.texture.instanceId-gl.texture.instanceId})},a._onTransformChanged=function(e){r.prototype._onTransformChanged.call(this,e),this._setDirtyFlagTrue(12)},a._isTextNoVisible=function(){return this._text===""||this._fontSize===0||this.enableWrapping&&this.width<=0||this.overflowMode===ka.Truncate&&this.height<=0},q(i,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"text",get:function(){return this._text},set:function(e){e=e||"",this._text!==e&&(this._text=e,this._setDirtyFlagTrue(14))}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this._setDirtyFlagTrue(14))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._setDirtyFlagTrue(14))}},{key:"font",get:function(){return this._font},set:function(e){var n=this._font;n!==e&&(n&&this._addResourceReferCount(n,-1),e&&this._addResourceReferCount(e,1),this._font=e,this._setDirtyFlagTrue(15))}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._setDirtyFlagTrue(15))}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(e){this.fontStyle!==e&&(this._fontStyle=e,this._setDirtyFlagTrue(15))}},{key:"lineSpacing",get:function(){return this._lineSpacing},set:function(e){this._lineSpacing!==e&&(this._lineSpacing=e,this._setDirtyFlagTrue(14))}},{key:"horizontalAlignment",get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._setDirtyFlagTrue(14))}},{key:"verticalAlignment",get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._setDirtyFlagTrue(14))}},{key:"enableWrapping",get:function(){return this._enableWrapping},set:function(e){this._enableWrapping!==e&&(this._enableWrapping=e,this._setDirtyFlagTrue(14))}},{key:"overflowMode",get:function(){return this._overflowMode},set:function(e){this._overflowMode!==e&&(this._overflowMode=e,this._setDirtyFlagTrue(14))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue(16))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"bounds",get:function(){if(this._isTextNoVisible()){if(this._isContainDirtyFlag(8)){var e=this._localBounds;e.min.set(0,0,0),e.max.set(0,0,0),this._updateBounds(this._bounds),this._setDirtyFlagFalse(8)}return this._bounds}return this._isContainDirtyFlag(1)&&this._resetSubFont(),this._isContainDirtyFlag(2)&&this._updateLocalData(),this._isContainDirtyFlag(4)&&this._updatePosition(),this._isContainDirtyFlag(8)&&this._updateBounds(this._bounds),this._setDirtyFlagFalse(15),this._bounds}}]),i}(Ce);(function(){At._charRenderDataPool=new Jx(um,50)})();(function(){At._tempVec30=new P})();(function(){At._tempVec31=new P})();R([Ie],At.prototype,"_subFont",void 0);R([z],At.prototype,"_charRenderDatas",void 0);R([z],At.prototype,"_dirtyFlag",void 0);R([Z],At.prototype,"_color",void 0);R([Ie],At.prototype,"_text",void 0);R([Ie],At.prototype,"_width",void 0);R([Ie],At.prototype,"_height",void 0);R([z],At.prototype,"_localBounds",void 0);R([Ie],At.prototype,"_font",void 0);R([Ie],At.prototype,"_fontSize",void 0);R([Ie],At.prototype,"_fontStyle",void 0);R([Ie],At.prototype,"_lineSpacing",void 0);R([Ie],At.prototype,"_horizontalAlignment",void 0);R([Ie],At.prototype,"_verticalAlignment",void 0);R([Ie],At.prototype,"_enableWrapping",void 0);R([Ie],At.prototype,"_overflowMode",void 0);R([Ie],At.prototype,"_maskInteraction",void 0);R([Ie],At.prototype,"_maskLayer",void 0);var pp;(function(r){r[r.SubFont=1]="SubFont",r[r.LocalPositionBounds=2]="LocalPositionBounds",r[r.WorldPosition=4]="WorldPosition",r[r.WorldBounds=8]="WorldBounds",r[r.MaskInteraction=16]="MaskInteraction",r[r.Position=14]="Position",r[r.Font=15]="Font"})(pp||(pp={}));var Kr;(function(r){r[r.Layer0=1]="Layer0",r[r.Layer1=2]="Layer1",r[r.Layer2=4]="Layer2",r[r.Layer3=8]="Layer3",r[r.Layer4=16]="Layer4",r[r.Layer5=32]="Layer5",r[r.Layer6=64]="Layer6",r[r.Layer7=128]="Layer7",r[r.Layer8=256]="Layer8",r[r.Layer9=512]="Layer9",r[r.Layer10=1024]="Layer10",r[r.Layer11=2048]="Layer11",r[r.Layer12=4096]="Layer12",r[r.Layer13=8192]="Layer13",r[r.Layer14=16384]="Layer14",r[r.Layer15=32768]="Layer15",r[r.Layer16=65536]="Layer16",r[r.Layer17=131072]="Layer17",r[r.Layer18=262144]="Layer18",r[r.Layer19=524288]="Layer19",r[r.Layer20=1048576]="Layer20",r[r.Layer21=2097152]="Layer21",r[r.Layer22=4194304]="Layer22",r[r.Layer23=8388608]="Layer23",r[r.Layer24=16777216]="Layer24",r[r.Layer25=33554432]="Layer25",r[r.Layer26=67108864]="Layer26",r[r.Layer27=134217728]="Layer27",r[r.Layer28=268435456]="Layer28",r[r.Layer29=536870912]="Layer29",r[r.Layer30=1073741824]="Layer30",r[r.Layer31=2147483648]="Layer31",r[r.Everything=4294967295]="Everything",r[r.Nothing=0]="Nothing"})(Kr||(Kr={}));var Zx=function(){function r(){}return r.cloneComponent=function(a,t,e,n){var o=mn.getCloneMode(a.constructor);for(var s in a)mn.cloneProperty(a,t,s,o[s]);a._cloneTo&&a._cloneTo(t,e,n)},r}(),hn=function(r){W(i,r);function i(t,e){var n;return n=r.call(this,t)||this,n.layer=Kr.Layer0,n._isActiveInHierarchy=!1,n._isActiveInScene=!1,n._components=[],n._scripts=new $e,n._children=[],n._isRoot=!1,n._isActive=!0,n._siblingIndex=-1,n._isTemplate=!1,n._parent=null,n._invModelMatrix=new $,n.name=e,n.transform=n.addComponent(ye),n._inverseWorldMatFlag=n.transform.registerWorldChangeFlag(),n}var a=i.prototype;return a.addComponent=function(e){Io._addCheck(this,e);var n=new e(this);return this._components.push(n),n._setActive(!0,_e.All),n},a.getComponent=function(e){for(var n=this._components,o=0,s=n.length;o<s;o++){var l=n[o];if(mt(l,e))return l}return null},a.getComponents=function(e,n){n.length=0;for(var o=this._components,s=0,l=o.length;s<l;s++){var c=o[s];mt(c,e)&&n.push(c)}return n},a.getComponentsIncludeChildren=function(e,n){return n.length=0,this._getComponentsInChildren(e,n),n},a.addChild=function(e,n){var o;if(typeof e=="number"?o=e:(o=void 0,n=e),n._isRoot){n._scene._removeFromEntityList(n),n._isRoot=!1,this._addToChildrenList(o,n),n._parent=this;var s=n._scene,l=this._scene,c=_e.None;this._isActiveInHierarchy||n._isActiveInHierarchy&&(c|=_e.Hierarchy),n._isActiveInScene&&(this._isActiveInScene?s!==l&&(c|=_e.Scene):c|=_e.Scene),c&&n._processInActive(c),n._scene!==l&&i._traverseSetOwnerScene(n,l);var u=_e.None;n._isActive&&(this._isActiveInHierarchy&&!n._isActiveInHierarchy&&(u|=_e.Hierarchy),this._isActiveInScene&&(!n._isActiveInScene||s!==l)&&(u|=_e.Scene)),u&&n._processActive(u),n._setTransformDirty()}else n._setParent(this,o)},a.removeChild=function(e){e._setParent(null)},a.getChild=function(e){return this._children[e]},a.findByName=function(e){if(e===this.name)return this;for(var n=this._children,o=0,s=n.length;o<s;o++){var l=n[o].findByName(e);if(l)return l}return null},a.findByPath=function(e){for(var n=e.split("/"),o=this,s=0,l=n.length;s<l;++s){var c=n[s];if(c&&(o=i._findChildByName(o,c),!o))return null}return o},a.createChild=function(e){var n=new i(this.engine,e);return n.layer=this.layer,n.parent=this,n},a.clearChildren=function(){for(var e=this._children,n=e.length-1;n>=0;n--){var o=e[n];o._parent=null;var s=_e.None;o._isActiveInHierarchy&&(s|=_e.Hierarchy),o._isActiveInScene&&(s|=_e.Scene),s&&o._processInActive(s),i._traverseSetOwnerScene(o,null)}e.length=0},a.clone=function(){var e=this._createCloneEntity(this);return this._parseCloneEntity(this,e,this,e),e},a._markAsTemplate=function(e){this._isTemplate=!0,this._templateResource=e},a._createCloneEntity=function(e){var n=new i(e._engine,e.name),o=this._templateResource;o&&(n._templateResource=o,o._addReferCount(1)),n.layer=e.layer,n._isActive=e._isActive;var s=n.transform,l=e.transform;s.position=l.position,s.rotation=l.rotation,s.scale=l.scale;for(var c=e._children,u=0,d=e._children.length;u<d;u++)n.addChild(this._createCloneEntity(c[u]));return n},a._parseCloneEntity=function(e,n,o,s){for(var l=e._children,c=n._children,u=0,d=l.length;u<d;u++)this._parseCloneEntity(l[u],c[u],o,s);for(var f=e._components,h=0,_=f.length;h<_;h++){var g=f[h];if(!mt(g,ye)){var y=n.addComponent(g.constructor);Zx.cloneComponent(g,y,o,s)}}},a.destroy=function(){if(!this._destroyed){r.prototype.destroy.call(this),this._templateResource&&(this._isTemplate||this._templateResource._addReferCount(-1),this._templateResource=null);for(var e=this._components,n=e.length-1;n>=0;n--)e[n].destroy();this._components.length=0;for(var o=this._children;o.length>0;)o[0].destroy();this._isRoot?this._scene.removeRootEntity(this):this._setParent(null),this.isActive=!1}},a._removeComponent=function(e){Io._removeCheck(this,e.constructor);var n=this._components;n.splice(n.indexOf(e),1)},a._addScript=function(e){e._entityScriptsIndex=this._scripts.length,this._scripts.add(e)},a._removeScript=function(e){var n=this._scripts.deleteByIndex(e._entityScriptsIndex);n&&(n._entityScriptsIndex=e._entityScriptsIndex),e._entityScriptsIndex=-1},a._removeFromParent=function(){var e=this._parent;if(e!=null){var n=e._children,o=this._siblingIndex;n.splice(o,1);for(var s=n.length;o<s;o++)n[o]._siblingIndex--;this._parent=null,this._siblingIndex=-1}},a._processActive=function(e){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._scene._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents,e),this._setActiveComponents(!0,e)},a._processInActive=function(e){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._scene._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents,e),this._setActiveComponents(!1,e)},a._addToChildrenList=function(e,n){var o=this._children,s=o.length;if(e===void 0)n._siblingIndex=s,o.push(n);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;n._siblingIndex=e,o.splice(e,0,n);for(var l=e+1,c=s+1;l<c;l++)o[l]._siblingIndex++}},a._setParent=function(e,n){var o=this._parent;if(e!==o){if(this._removeFromParent(),this._parent=e,e){e._addToChildrenList(n,this);var s=this._scene,l=e._scene,c=_e.None;e._isActiveInHierarchy||this._isActiveInHierarchy&&(c|=_e.Hierarchy),e._isActiveInScene?this._isActiveInScene&&s!==l&&(c|=_e.Scene):this._isActiveInScene&&(c|=_e.Scene),c&&this._processInActive(c),s!==l&&i._traverseSetOwnerScene(this,l);var u=_e.None;this._isActive&&(e._isActiveInHierarchy&&!this._isActiveInHierarchy&&(u|=_e.Hierarchy),e._isActiveInScene&&(!this._isActiveInScene||s!==l)&&(u|=_e.Scene)),u&&this._processActive(u)}else{var d=_e.None;this._isActiveInHierarchy&&(d|=_e.Hierarchy),this._isActiveInScene&&(d|=_e.Scene),d&&this._processInActive(d),o&&i._traverseSetOwnerScene(this,null)}this._setTransformDirty()}},a._getComponentsInChildren=function(e,n){for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];mt(s,e)&&n.push(s)}for(var l=this._children.length-1;l>=0;l--)this._children[l]._getComponentsInChildren(e,n)},a._setActiveComponents=function(e,n){for(var o=this._activeChangedComponents,s=0,l=o.length;s<l;++s)o[s]._setActive(e,n);this._scene._componentsManager.putActiveChangedTempList(o),this._activeChangedComponents=null},a._setActiveInHierarchy=function(e,n){n&_e.Hierarchy&&(this._isActiveInHierarchy=!0),n&_e.Scene&&(this._isActiveInScene=!0);for(var o=this._components,s=0,l=o.length;s<l;s++){var c=o[s];(c.enabled||!c._awoken)&&e.push(c)}for(var u=this._children,d=0,f=u.length;d<f;d++){var h=u[d];h.isActive&&h._setActiveInHierarchy(e,n)}},a._setInActiveInHierarchy=function(e,n){n&_e.Hierarchy&&(this._isActiveInHierarchy=!1),n&_e.Scene&&(this._isActiveInScene=!1);for(var o=this._components,s=0,l=o.length;s<l;s++){var c=o[s];c.enabled&&e.push(c)}for(var u=this._children,d=0,f=u.length;d<f;d++){var h=u[d];h.isActive&&h._setInActiveInHierarchy(e,n)}},a._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,n=this._children.length;e<n;e++)this._children[e]._setTransformDirty()},a._setSiblingIndex=function(e,n){if(n=Math.min(n,e.length-1),n<0)throw"Sibling index "+n+" should large than 0";if(this._siblingIndex!==n){var o=this._siblingIndex;if(n<o)for(var s=o;s>=n;s--){var l=s==n?this:e[s-1];e[s]=l,l._siblingIndex=s}else for(var c=o;c<=n;c++){var u=c==n?this:e[c+1];e[c]=u,u._siblingIndex=c}}},a.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&($.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},i._findChildByName=function(e,n){for(var o=e._children,s=o.length-1;s>=0;s--){var l=o[s];if(l.name===n)return l}return null},i._traverseSetOwnerScene=function(e,n){e._scene=n;for(var o=e._children,s=o.length-1;s>=0;s--)this._traverseSetOwnerScene(o[s],n)},q(i,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var n=this._parent,o=_e.None;if(this._isRoot&&this._scene._isActiveInEngine)o|=_e.All;else{var s,l;(s=n)!=null&&s._isActiveInHierarchy&&(o|=_e.Hierarchy),(l=n)!=null&&l._isActiveInScene&&(o|=_e.Scene)}o&&this._processActive(o)}else{var c=_e.None;this._isActiveInHierarchy&&(c|=_e.Hierarchy),this._isActiveInScene&&(c|=_e.Scene),c&&this._processInActive(c)}}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this._setParent(e)}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(e){if(this._siblingIndex===-1)throw"The entity "+this.name+" is not in the hierarchy";this._setSiblingIndex(this._isRoot?this._scene._rootEntities:this._parent._children,e)}}]),i}(ri),xi=function(){function r(){}var i=r.prototype;return i.applyVirtualCamera=function(t){this.virtualCamera=t;var e=this.camera.shaderData;e.setMatrix(r._viewMatrixProperty,t.viewMatrix),e.setMatrix(r._projectionMatrixProperty,t.projectionMatrix),e.setMatrix(r.vpMatrixProperty,t.viewProjectionMatrix)},r}();(function(){xi.vpMatrixProperty=k.getByName("camera_VPMat")})();(function(){xi.pipelineStageKey=yi.getByName("pipelineStage")})();(function(){xi._viewMatrixProperty=k.getByName("camera_ViewMat")})();(function(){xi._projectionMatrixProperty=k.getByName("camera_ProjMat")})();var Ru=function(){function r(){}var i=r.prototype;return i.setX=function(t,e,n,o){this.component=t,this.material=e,this.primitive=n,this.subPrimitive=o},i.dispose=function(){this.component=null,this.material=null,this.primitive=null,this.subPrimitive=null},r}(),$x=function(){function r(){}var i=r.prototype;return i.set=function(t,e){this.data=t,this.shaderPasses=e},i.dispose=function(){this.data=this.shaderPasses=null},r}(),eS=function(r){W(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new De("POSITION",0,ie.Vector3,0),e[1]=new De("TEXCOORD_0",12,ie.Vector2,0),20},a.canBatch=function(e,n){var o=e.data,s=n.data;if(o.isAdd!==s.isAdd)return!1;var l=o.component.shaderData,c=s.component.shaderData,u=ar._textureProperty,d=ar._alphaCutoffProperty;return l.getTexture(u)===c.getTexture(u)&&l.getTexture(d)===c.getTexture(d)},a.updateVertices=function(e,n,o){for(var s=e.verticesData,l=s.positions,c=s.uvs,u=s.vertexCount,d=0;d<u;d++){var f=l[d],h=c[d];n[o++]=f.x,n[o++]=f.y,n[o++]=f.z,n[o++]=h.x,n[o++]=h.y}return o},a.drawBatches=function(e){for(var n=this,o=n._engine,s=n._batchedQueue,l=this._meshes[this._flushId],c=l.subMeshes,u=l._primitive,d=e.scene.shaderData,f=e.shaderData,h=0,_=c.length;h<_;h++){var g=c[h],y=s[h],v=y.data;if(!g||!y)return;var p=v.component,m=v.material,A=Le._compileMacros;Ir.unionCollection(p._globalShaderMacro,m.shaderData._macroCollection,A);var S=m.renderState.stencilState,x=v.isAdd?Je.IncrementSaturate:Je.DecrementSaturate;S.passOperationFront=x,S.passOperationBack=x;var b=m.shader.subShaders[0].passes[0],C=b._getShaderProgram(o,A);if(!C.isValid)return;C.bind(),C.groupingOtherUniformBlock(),C.uploadAll(C.sceneUniformBlock,d),C.uploadAll(C.cameraUniformBlock,f),C.uploadAll(C.rendererUniformBlock,p.shaderData),C.uploadAll(C.materialUniformBlock,m.shaderData),m.renderState._apply(o,!1,b._renderStateDataMap,m.shaderData),o._hardwareRenderer.drawPrimitive(u,g,C)}},i}(Ln),tS=function(){function r(a){this._preMaskLayer=0,this._batcher=new eS(a)}var i=r.prototype;return i.clear=function(){this._preMaskLayer=0,this._batcher.clear()},i.preRender=function(t,e){e.maskInteraction!==Tt.None&&(this._batcher.clear(),this._processMasksDiff(t,e),this._batcher.flush(t))},i.postRender=function(t){t.maskInteraction!==Tt.None&&(this._preMaskLayer=t.maskLayer)},i.destroy=function(){this._batcher.destroy(),this._batcher=null},i._processMasksDiff=function(t,e){var n=this._preMaskLayer,o=e.maskLayer;if(n!==o)for(var s=t._renderPipeline._allSpriteMasks,l=n&o,c=o&~n,u=n&~o,d=s._elements,f=0,h=s.length;f<h;f++){var _=d[f],g=_.influenceLayers;if(!(g&l)){if(g&c){var y=_._maskElement;y.data.isAdd=!0,this._batcher.drawElement(y,t);continue}if(g&u){var v=_._maskElement;v.data.isAdd=!1,this._batcher.drawElement(v,t)}}}},r}(),rS=function(r){W(i,r);function i(){var t;return t=r.call(this)||this,t.isAdd=!0,t.multiRenderData=!1,t}var a=i.prototype;return a.set=function(e,n,o){this.component=e,this.material=n,this.verticesData=o},a.dispose=function(){this.component=this.material=this.verticesData=null},i}(Ru),nS=function(r){W(i,r);function i(){var t;return t=r.call(this)||this,t.multiRenderData=!1,t}var a=i.prototype;return a.set=function(e,n,o,s,l){l===void 0&&(l=0),this.component=e,this.material=n,this.verticesData=o,this.texture=s,this.dataIndex=l},a.dispose=function(){this.component=this.material=this.verticesData=this.texture=null},i}(Ru),iS=function(r){W(i,r);function i(){var t;return t=r.call(this)||this,t.charsData=[],t.multiRenderData=!0,t}var a=i.prototype;return a.dispose=function(){this.component=this.material=null,this.charsData.length=0},i}(Ru),Re;(function(r){r.Text="Text",r.JSON="JSON",r.Buffer="Buffer",r.Texture2D="Texture2D",r.TextureCube="TextureCube",r.Material="Material",r.Mesh="Mesh",r.AnimationClip="AnimationClip",r.AnimatorController="AnimatorController",r.GLTF="GLTF",r.KTX="KTX",r.KTXCube="KTXCube",r.KTX2="KTX2",r.Sprite="Sprite",r.PrimitiveMesh="PrimitiveMesh",r.SpriteAtlas="SpriteAtlas",r.Env="Environment",r.Scene="Scene",r.HDR="HDR",r.Font="Font",r.SourceFont="SourceFont",r.Project="project"})(Re||(Re={}));var aS=function(){function r(){this._array=[],this._loopArray=[],this._loopArrayDirty=!1}var i=r.prototype;return i.push=function(t){this._array.push(t),this._loopArrayDirty=!0},i.add=function(t,e){this._array.splice(t,0,e),this._loopArrayDirty=!0},i.removeByIndex=function(t){this._array.splice(t,1),this._loopArrayDirty=!0},i.indexOf=function(t){return this._array.indexOf(t)},i.getArray=function(){return this._array},i.getLoopArray=function(){var t=this._loopArray;if(this._loopArrayDirty){var e=this._array,n=e.length;t.length=n;for(var o=0;o<n;o++)t[o]=e[o];this._loopArrayDirty=!1}return t},q(r,[{key:"length",get:function(){return this._array.length}}]),r}(),dm=function(){function r(a){this.engine=a,this._allCreatedScenes=[],this._scenes=new aS}var i=r.prototype;return i.addScene=function(t,e){var n=this._scenes,o;if(typeof t=="number"){if(t<0||t>n.length)throw"The index is out of range.";o=t}else o=n.length,e=t;if(e.engine!==this.engine)throw"The scene is not belong to this engine.";if(e._sceneManager){var s=n.indexOf(e);s!==o&&(n.removeByIndex(s),n.add(o,e))}else e._sceneManager=this,n.add(o,e),e.isActive&&e._processActive(!0)},i.removeScene=function(t){var e=this._scenes,n=e.indexOf(t);if(n!==-1){var o=e.getArray()[n];e.removeByIndex(n),t._sceneManager=null,o.isActive&&o._processActive(!1)}},i.loadScene=function(t,e){e===void 0&&(e=!0);var n=this,o=this.engine.resourceManager.load({url:t,type:Re.Scene});return o.then(function(s){if(e)for(var l=n._scenes.getArray(),c=0,u=l.length;c<u;c++)l[c].destroy();n.addScene(s)}),o},i.mergeScenes=function(t,e){for(var n=t.rootEntities;n.length>0;)e.addRootEntity(n[0])},i._destroyAllScene=function(){for(var t=this._allCreatedScenes;t.length>0;)t[0].destroy()},q(r,[{key:"scenes",get:function(){return this._scenes.getArray()}},{key:"activeScene",get:function(){return this._scenes.getArray()[0]},set:function(t){var e=this.scenes[0];e&&this.removeScene(e),t&&this.addScene(0,t)}}]),r}(),Ne=function(){function r(a){var t=this;this._state="pending",this._onTaskCompleteCallbacks=[],this._onTaskDetailCallbacks=[],this._promise=new Promise(function(e,n){t._reject=n;var o=function(d){t._state==="pending"&&(e(d),t._state="fulfilled",t._onTaskCompleteCallbacks=void 0,t._onTaskDetailCallbacks=void 0)},s=function(d){t._state==="pending"&&(n(d),t._state="rejected",t._onTaskCompleteCallbacks=void 0,t._onTaskDetailCallbacks=void 0)},l=function(d){t._state==="pending"&&(t._onCancelHandler=d)},c=function(d,f){if(t._state==="pending"){var h=t._taskCompleteProgress||(t._taskCompleteProgress={loaded:d,total:f});h.loaded=d,h.total=f,t._onTaskCompleteCallbacks.forEach(function(_){return _(d,f)})}},u=function(d,f,h){if(t._state==="pending"){var _,g;t._taskDetailProgress||(t._taskDetailProgress={});var y=(_=t._taskDetailProgress)[g=d]||(_[g]={loaded:f,total:h});y.loaded=f,y.total=h,t._onTaskDetailCallbacks.forEach(function(v){return v(d,f,h)})}};a(o,s,c,u,l)})}var i=r.prototype;return i.onProgress=function(t,e){var n=this._taskCompleteProgress,o=this._taskDetailProgress;if(n&&t(n.loaded,n.total),o)for(var s in o){var l=o[s],c=l.loaded,u=l.total;e(s,c,u)}return this._state==="pending"&&(t&&this._onTaskCompleteCallbacks.push(t),e&&this._onTaskDetailCallbacks.push(e)),this},i.then=function(t,e){var n=this;return new r(function(o,s){n._promise.then(t,e).then(o).catch(s)})},i.catch=function(t){var e=this;return new r(function(n,o){e._promise.catch(t).then(n).catch(o)})},i.finally=function(t){return this._promise.finally(t)},i.cancel=function(){if(this._state==="pending")return this._state="canceled",this._reject("canceled"),this._onCancelHandler&&this._onCancelHandler(),this},r.all=function(t){return new r(function(e,n,o){var s=function(_,g){d++,u[_]=g,o(d,c),d===c&&e(u)},l=function(_,g){mt(_,Promise)||mt(_,r)?_.then(function(y){s(g,y)},n):Promise.resolve().then(function(){s(g,_)})},c=t.length,u=new Array(c),d=0;if(c===0)return e(u);for(var f=0;f<c;f++)l(t[f],f)})},q(r,[{key:Symbol.toStringTag,get:function(){return"AssetPromise"}}]),r}(),vp;(function(r){r.Pending="pending",r.Fulfilled="fulfilled",r.Rejected="rejected",r.Canceled="canceled"})(vp||(vp={}));var Vo=function(){function r(a){this.engine=a,this.retryCount=1,this.retryInterval=0,this.timeout=1/0,this.baseUrl=null,this._loadingPromises={},this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._referResourcePool=Object.create(null),this._graphicResourcePool=Object.create(null),this._contentRestorerPool=Object.create(null),this._subAssetPromiseCallbacks={},this._objectPool=Object.create(null),this._editorResourceConfig=Object.create(null),this._virtualPathMap=Object.create(null)}var i=r.prototype;return i.load=function(t){var e=this;if(!Array.isArray(t))return this._loadSingleItem(t);var n=t.map(function(o){return e._loadSingleItem(o)});return Ne.all(n)},i.getFromCache=function(t){var e;return(e=this._assetUrlPool[t])!=null?e:null},i.findResourcesByType=function(t){var e=new Array,n=this._referResourcePool;for(var o in n){var s=n[o];mt(s,t)&&e.push(s)}return e},i.getAssetPath=function(t){return this._assetPool[t]},i.cancelNotLoaded=function(t){var e=this;if(!t)Ye.objectValues(this._loadingPromises).forEach(function(o){o.cancel()});else if(typeof t=="string"){var n;(n=this._loadingPromises[t])==null||n.cancel()}else t.forEach(function(o){var s;(s=e._loadingPromises[o])==null||s.cancel()})},i.gc=function(){this._gc(!1),this.engine._pendingGC()},i.addContentRestorer=function(t){this._contentRestorerPool[t.resource.instanceId]=t},i._onSubAssetSuccess=function(t,e){var n;(n=this._subAssetPromiseCallbacks[t])==null||n.resolve(e),delete this._subAssetPromiseCallbacks[t]},i._onSubAssetFail=function(t,e){var n;(n=this._subAssetPromiseCallbacks[t])==null||n.reject(e),delete this._subAssetPromiseCallbacks[t]},i._addAsset=function(t,e){this._assetPool[e.instanceId]=t,this._assetUrlPool[t]=e},i._deleteAsset=function(t){var e=t.instanceId,n=this._assetPool[e];n&&(delete this._assetPool[e],delete this._assetUrlPool[n])},i._addReferResource=function(t){this._referResourcePool[t.instanceId]=t},i._deleteReferResource=function(t){delete this._referResourcePool[t.instanceId]},i._addGraphicResource=function(t){this._graphicResourcePool[t.instanceId]=t},i._deleteGraphicResource=function(t){delete this._graphicResourcePool[t.instanceId]},i._deleteContentRestorer=function(t){delete this._contentRestorerPool[t.instanceId]},i._restoreGraphicResources=function(){var t=this._graphicResourcePool;for(var e in t)t[e]._rebuild()},i._lostGraphicResources=function(){var t=this._graphicResourcePool;for(var e in t)t[e]._isContentLost=!0},i._restoreResourcesContent=function(){var t=this._contentRestorerPool,e=new Array;for(var n in t){var o=t[n],s=o.restoreContent();s&&e.push(s)}return Promise.all(e)},i._destroy=function(){this.cancelNotLoaded(),this._gc(!0),this._assetPool=null,this._assetUrlPool=null,this._referResourcePool=null,this._graphicResourcePool=null,this._contentRestorerPool=null,this._loadingPromises=null},i._assignDefaultOptions=function(t){var e;if(t.type=(e=t.type)!=null?e:r._getTypeByUrl(t.url),t.type===void 0)throw"asset type should be specified: "+t.url;var n;t.retryCount=(n=t.retryCount)!=null?n:this.retryCount;var o;t.timeout=(o=t.timeout)!=null?o:this.timeout;var s;t.retryInterval=(s=t.retryInterval)!=null?s:this.retryInterval;var l;return t.url=(l=t.url)!=null?l:t.urls.join(","),t},i._loadSingleItem=function(t){var e=this,n=this._assignDefaultOptions(typeof t=="string"?{url:t}:t),o=n.url,s=this._virtualPathMap[o]?this._virtualPathMap[o]:o;!Ye.isAbsoluteUrl(s)&&this.baseUrl&&(s=Ye.resolveAbsoluteUrl(this.baseUrl,s));var l=this._parseURL(s),c=l.assetBaseURL,u=l.queryPath,d=u?this._parseQueryPath(u):[],f=this._assetUrlPool[c];if(f)return new Ne(function(A){A(e._getResolveResource(f,d))});var h=c;if(u){h+="?q="+d.shift();for(var _;_=d.shift();)h+="["+_+"]"}var g=this._loadingPromises,y=g[h];if(y)return new Ne(function(A,S,x,b){y.onProgress(x,b).then(function(C){A(C)}).catch(function(C){S(C)})});var v=r._loaders[n.type];if(!v)throw"loader not found: "+n.type;n.url=c;var p=v.load(n,this);if(g[c]=p,p.then(function(A){v.useCache&&e._addAsset(c,A),delete g[c]},function(){return delete g[c]}),u){var m=new Ne(function(A,S){e._pushSubAssetPromiseCallback(h,A,S)});return g[h]=m,m.then(function(){delete g[h]},function(){return delete g[h]}),p.catch(function(A){e._onSubAssetFail(h,A)}),m}return p},i._pushSubAssetPromiseCallback=function(t,e,n){this._subAssetPromiseCallbacks[t]={resolve:e,reject:n}},i._gc=function(t){for(var e=Ye.objectValues(this._referResourcePool),n=0,o=e.length;n<o;n++){var s=e[n];(!s.isGCIgnored||t)&&s.destroy(t,!0)}},i._getResolveResource=function(t,e){var n=t;if(e)for(var o=0,s=e.length;o<s;o++){var l=e[o];n=n[l]}return n},i._parseURL=function(t){var e=t.split("?"),n=e[0],o=e[1],s=new URLSearchParams(o),l=s.get("q");s.delete("q");var c=s.size>0?n+"?"+s.toString():n;return{assetBaseURL:c,queryPath:l}},i._parseQueryPath=function(t){var e=[];return t.charCodeAt(0)===oS&&e.push(""),t.replace(lS,function(n,o,s,l){var c=n;s?c=l.replace(sS,"$1"):o&&(c=o.trim()),e.push(c)}),e},i.getResourceByRef=function(t){var e=t.refId,n=t.key,o=t.isClone,s=this._objectPool[e],l;if(s)l=Promise.resolve(s);else{var c,u=(c=this._editorResourceConfig[e])==null?void 0:c.path;if(!u)return me.warn("refId:"+e+" is not find in this._editorResourceConfig."),Promise.resolve(null);u=n?""+u+(u.indexOf("?")>-1?"&":"?")+"q="+n:u,l=this.load({url:u,type:this._editorResourceConfig[e].type})}return l.then(function(d){return o?d.clone():d})},i.initVirtualResources=function(t){var e=this;t.forEach(function(n){e._virtualPathMap[n.virtualPath]=n.path,e._editorResourceConfig[n.id]=n})},r._addLoader=function(t,e,n){this._loaders[t]=e;for(var o=0,s=n.length;o<s;o++)this._extTypeMapping[n[o].toLowerCase()]=t},r._getTypeByUrl=function(t){var e=t.split("?")[0];return this._extTypeMapping[e.substring(e.lastIndexOf(".")+1).toLowerCase()]},r}();(function(){Vo._loaders={}})();(function(){Vo._extTypeMapping={}})();function at(r,i,a){return a===void 0&&(a=!0),function(t){var e=new t(a);Vo._addLoader(r,e,i)}}var oS=46,sS=/\\(\\)?/g,lS=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),Ur;(function(r){r[r.Down=0]="Down",r[r.Move=1]="Move",r[r.Stationary=2]="Stationary",r[r.Up=3]="Up",r[r.Leave=4]="Leave"})(Ur||(Ur={}));var fm=function(){function r(a){this.phase=Ur.Leave,this.position=new te,this.deltaPosition=new te,this._events=[],this._upMap=[],this._downMap=[],this._upList=new $e,this._downList=new $e,this.id=a}var i=r.prototype;return i._firePointerExitAndEnter=function(t){var e=this;this._currentEnteredEntity!==t&&(this._currentEnteredEntity&&this._currentEnteredEntity._scripts.forEach(function(n){n.onPointerExit(e)},function(n,o){n._entityScriptsIndex=o}),t&&t._scripts.forEach(function(n){n.onPointerEnter(e)},function(n,o){n._entityScriptsIndex=o}),this._currentEnteredEntity=t)},i._firePointerDown=function(t){var e=this;t&&t._scripts.forEach(function(n){n.onPointerDown(e)},function(n,o){n._entityScriptsIndex=o}),this._currentPressedEntity=t},i._firePointerDrag=function(){var t=this;this._currentPressedEntity&&this._currentPressedEntity._scripts.forEach(function(e){e.onPointerDrag(t)},function(e,n){e._entityScriptsIndex=n})},i._firePointerUpAndClick=function(t){var e=this,n=this,o=n._currentPressedEntity;if(o){var s=o===t;o._scripts.forEach(function(l){s&&l.onPointerClick(e),l.onPointerUp(e)},function(l,c){l._entityScriptsIndex=c}),this._currentPressedEntity=null}},r}(),So;(function(r){r[r.None=0]="None",r[r.Primary=1]="Primary",r[r.Secondary=2]="Secondary",r[r.Auxiliary=4]="Auxiliary",r[r.XButton1=8]="XButton1",r[r.XButton2=16]="XButton2",r[r.XButton3=32]="XButton3",r[r.XButton4=64]="XButton4",r[r.XButton5=128]="XButton5",r[r.XButton6=256]="XButton6",r[r.XButton7=512]="XButton7",r[r.XButton8=1024]="XButton8"})(So||(So={}));var cS=[1,4,2,8,16,32,64,128,256,512,1024],gp={1:0,2:2,4:1,8:3,16:4,32:5,64:6,128:7,256:8,512:9,1024:10},Jn=function(){function r(){}return r._initialize=function(){{if(typeof navigator>"u")return;var a=navigator.userAgent;/iPhone/i.test(a)?r.platform=dr.IPhone:/iPad/i.test(a)?r.platform=dr.IPad:/Android/i.test(a)?r.platform=dr.Android:/Macintosh/i.test(a)&&(r.platform=dr.Mac);var t;switch(r.platform){case dr.IPhone:t=a.match(/OS (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"iPhone OS "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"iPhone OS";break;case dr.IPad:t=a.match(/OS (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"iPad OS "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"iPad OS";break;case dr.Android:t=a.match(/Android (\d+).?(\d+)?.?(\d+)?/),this.operatingSystem=t?"Android "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"Android";break;case dr.Mac:t=a.match(/Mac OS X (\d+)_?(\d+)?_?(\d+)?/),this.operatingSystem=t?"Mac OS X "+t[1]+"."+(t[2]||0)+"."+(t[3]||0):"Mac OS X";break}}},r._detectSIMDSupported=function(){return this._simdSupported===null&&(this._simdSupported=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]))),this._simdSupported},q(r,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),r}();(function(){Jn.platform=dr.Unknown})();(function(){Jn.operatingSystem=""})();(function(){Jn._simdSupported=null})();Jn._initialize();var La;(function(r){r[r.Backquote=0]="Backquote",r[r.Backslash=1]="Backslash",r[r.Backspace=2]="Backspace",r[r.BracketLeft=3]="BracketLeft",r[r.BracketRight=4]="BracketRight",r[r.Comma=5]="Comma",r[r.Digit0=6]="Digit0",r[r.Digit1=7]="Digit1",r[r.Digit2=8]="Digit2",r[r.Digit3=9]="Digit3",r[r.Digit4=10]="Digit4",r[r.Digit5=11]="Digit5",r[r.Digit6=12]="Digit6",r[r.Digit7=13]="Digit7",r[r.Digit8=14]="Digit8",r[r.Digit9=15]="Digit9",r[r.Equal=16]="Equal",r[r.IntlBackslash=17]="IntlBackslash",r[r.IntlRo=18]="IntlRo",r[r.IntlYen=19]="IntlYen",r[r.KeyA=20]="KeyA",r[r.KeyB=21]="KeyB",r[r.KeyC=22]="KeyC",r[r.KeyD=23]="KeyD",r[r.KeyE=24]="KeyE",r[r.KeyF=25]="KeyF",r[r.KeyG=26]="KeyG",r[r.KeyH=27]="KeyH",r[r.KeyI=28]="KeyI",r[r.KeyJ=29]="KeyJ",r[r.KeyK=30]="KeyK",r[r.KeyL=31]="KeyL",r[r.KeyM=32]="KeyM",r[r.KeyN=33]="KeyN",r[r.KeyO=34]="KeyO",r[r.KeyP=35]="KeyP",r[r.KeyQ=36]="KeyQ",r[r.KeyR=37]="KeyR",r[r.KeyS=38]="KeyS",r[r.KeyT=39]="KeyT",r[r.KeyU=40]="KeyU",r[r.KeyV=41]="KeyV",r[r.KeyW=42]="KeyW",r[r.KeyX=43]="KeyX",r[r.KeyY=44]="KeyY",r[r.KeyZ=45]="KeyZ",r[r.Minus=46]="Minus",r[r.Period=47]="Period",r[r.Quote=48]="Quote",r[r.Semicolon=49]="Semicolon",r[r.Slash=50]="Slash",r[r.AltLeft=51]="AltLeft",r[r.AltRight=52]="AltRight",r[r.CapsLock=53]="CapsLock",r[r.ContextMenu=54]="ContextMenu",r[r.ControlLeft=55]="ControlLeft",r[r.ControlRight=56]="ControlRight",r[r.Enter=57]="Enter",r[r.MetaLeft=58]="MetaLeft",r[r.MetaRight=59]="MetaRight",r[r.ShiftLeft=60]="ShiftLeft",r[r.ShiftRight=61]="ShiftRight",r[r.Space=62]="Space",r[r.Tab=63]="Tab",r[r.Convert=64]="Convert",r[r.KanaMode=65]="KanaMode",r[r.Lang1=66]="Lang1",r[r.Lang2=67]="Lang2",r[r.Lang3=68]="Lang3",r[r.Lang4=69]="Lang4",r[r.Lang5=70]="Lang5",r[r.NonConvert=71]="NonConvert",r[r.Delete=72]="Delete",r[r.End=73]="End",r[r.Help=74]="Help",r[r.Home=75]="Home",r[r.Insert=76]="Insert",r[r.PageDown=77]="PageDown",r[r.PageUp=78]="PageUp",r[r.ArrowDown=79]="ArrowDown",r[r.ArrowLeft=80]="ArrowLeft",r[r.ArrowRight=81]="ArrowRight",r[r.ArrowUp=82]="ArrowUp",r[r.NumLock=83]="NumLock",r[r.Numpad0=84]="Numpad0",r[r.Numpad1=85]="Numpad1",r[r.Numpad2=86]="Numpad2",r[r.Numpad3=87]="Numpad3",r[r.Numpad4=88]="Numpad4",r[r.Numpad5=89]="Numpad5",r[r.Numpad6=90]="Numpad6",r[r.Numpad7=91]="Numpad7",r[r.Numpad8=92]="Numpad8",r[r.Numpad9=93]="Numpad9",r[r.NumpadAdd=94]="NumpadAdd",r[r.NumpadBackspace=95]="NumpadBackspace",r[r.NumpadClear=96]="NumpadClear",r[r.NumpadClearEntry=97]="NumpadClearEntry",r[r.NumpadComma=98]="NumpadComma",r[r.NumpadDecimal=99]="NumpadDecimal",r[r.NumpadDivide=100]="NumpadDivide",r[r.NumpadEnter=101]="NumpadEnter",r[r.NumpadEqual=102]="NumpadEqual",r[r.NumpadHash=103]="NumpadHash",r[r.NumpadMemoryAdd=104]="NumpadMemoryAdd",r[r.NumpadMemoryClear=105]="NumpadMemoryClear",r[r.NumpadMemoryRecall=106]="NumpadMemoryRecall",r[r.NumpadMemoryStore=107]="NumpadMemoryStore",r[r.NumpadMemorySubtract=108]="NumpadMemorySubtract",r[r.NumpadMultiply=109]="NumpadMultiply",r[r.NumpadParenLeft=110]="NumpadParenLeft",r[r.NumpadParenRight=111]="NumpadParenRight",r[r.NumpadStar=112]="NumpadStar",r[r.NumpadSubtract=113]="NumpadSubtract",r[r.Escape=114]="Escape",r[r.F1=115]="F1",r[r.F2=116]="F2",r[r.F3=117]="F3",r[r.F4=118]="F4",r[r.F5=119]="F5",r[r.F6=120]="F6",r[r.F7=121]="F7",r[r.F8=122]="F8",r[r.F9=123]="F9",r[r.F10=124]="F10",r[r.F11=125]="F11",r[r.F12=126]="F12",r[r.F13=127]="F13",r[r.F14=128]="F14",r[r.F15=129]="F15",r[r.Fn=130]="Fn",r[r.FnLock=131]="FnLock",r[r.PrintScreen=132]="PrintScreen",r[r.ScrollLock=133]="ScrollLock",r[r.Pause=134]="Pause",r[r.BrowserBack=135]="BrowserBack",r[r.BrowserFavorites=136]="BrowserFavorites",r[r.BrowserForward=137]="BrowserForward",r[r.BrowserHome=138]="BrowserHome",r[r.BrowserRefresh=139]="BrowserRefresh",r[r.BrowserSearch=140]="BrowserSearch",r[r.BrowserStop=141]="BrowserStop",r[r.Eject=142]="Eject",r[r.LaunchApp1=143]="LaunchApp1",r[r.LaunchApp2=144]="LaunchApp2",r[r.LaunchMail=145]="LaunchMail",r[r.MediaPlayPause=146]="MediaPlayPause",r[r.MediaSelect=147]="MediaSelect",r[r.MediaStop=148]="MediaStop",r[r.MediaTrackNext=149]="MediaTrackNext",r[r.MediaTrackPrevious=150]="MediaTrackPrevious",r[r.Power=151]="Power",r[r.Sleep=152]="Sleep",r[r.AudioVolumeDown=153]="AudioVolumeDown",r[r.AudioVolumeMute=154]="AudioVolumeMute",r[r.AudioVolumeUp=155]="AudioVolumeUp",r[r.WakeUp=156]="WakeUp",r[r.Hyper=157]="Hyper",r[r.Super=158]="Super",r[r.Turbo=159]="Turbo",r[r.Abort=160]="Abort",r[r.Resume=161]="Resume",r[r.Suspend=162]="Suspend",r[r.Again=163]="Again",r[r.Copy=164]="Copy",r[r.Cut=165]="Cut",r[r.Find=166]="Find",r[r.Open=167]="Open",r[r.Paste=168]="Paste",r[r.Props=169]="Props",r[r.Select=170]="Select",r[r.Undo=171]="Undo",r[r.Hiragana=172]="Hiragana",r[r.Katakana=173]="Katakana",r[r.Unidentified=174]="Unidentified"})(La||(La={}));var uS=function(){function r(a,t){this._curHeldDownKeyToIndexMap=[],this._upKeyToFrameCountMap=[],this._downKeyToFrameCountMap=[],this._curFrameHeldDownList=new $e,this._curFrameDownList=new $e,this._curFrameUpList=new $e,this._nativeEvents=[],this._engine=a,this._onBlur=this._onBlur.bind(this),this._onKeyEvent=this._onKeyEvent.bind(this),this._target=t,this._addEventListener()}var i=r.prototype;return i._update=function(){var t=this,e=t._nativeEvents,n=t._curFrameDownList,o=t._curFrameUpList;if(n.length=0,o.length=0,e.length>0){for(var s=this._engine.time.frameCount,l=this,c=l._curHeldDownKeyToIndexMap,u=l._curFrameHeldDownList,d=l._downKeyToFrameCountMap,f=l._upKeyToFrameCountMap,h=0,_=e.length;h<_;h++){var g=e[h],y=La[g.code];switch(g.type){case"keydown":c[y]==null&&(n.add(y),u.add(y),c[y]=u.length-1,d[y]=s);break;case"keyup":var v=c[y];if(v!=null){c[y]=null;var p=u.deleteByIndex(v);p&&(c[p]=v)}if(o.add(y),f[y]=s,Jn.platform===dr.Mac&&(y===La.MetaLeft||y===La.MetaRight)){for(var m=0,A=u.length;m<A;m++)c[u.get(m)]=null;u.length=0}break}}e.length=0}},i._destroy=function(){this._removeEventListener(),this._curHeldDownKeyToIndexMap.length=0,this._curHeldDownKeyToIndexMap=null,this._upKeyToFrameCountMap.length=0,this._upKeyToFrameCountMap=null,this._downKeyToFrameCountMap.length=0,this._downKeyToFrameCountMap=null,this._nativeEvents.length=0,this._nativeEvents=null,this._curFrameHeldDownList.length=0,this._curFrameHeldDownList=null,this._curFrameDownList.length=0,this._curFrameDownList=null,this._curFrameUpList.length=0,this._curFrameUpList=null,this._engine=null},i._onBlur=function(){this._curHeldDownKeyToIndexMap.length=0,this._curFrameHeldDownList.length=0,this._curFrameDownList.length=0,this._curFrameUpList.length=0,this._nativeEvents.length=0},i._onKeyEvent=function(t){this._nativeEvents.push(t)},i._addEventListener=function(){var t=this,e=t._target;e.addEventListener("keydown",this._onKeyEvent),e.addEventListener("keyup",this._onKeyEvent),e.addEventListener("blur",this._onBlur)},i._removeEventListener=function(){var t=this,e=t._target;e.removeEventListener("keydown",this._onKeyEvent),e.removeEventListener("keyup",this._onKeyEvent),e.removeEventListener("blur",this._onBlur)},r}(),gr;(function(r){r[r.None=0]="None",r[r.Color=1]="Color",r[r.Depth=2]="Depth",r[r.Stencil=4]="Stencil",r[r.ColorDepth=3]="ColorDepth",r[r.ColorStencil=5]="ColorStencil",r[r.DepthStencil=6]="DepthStencil",r[r.All=7]="All"})(gr||(gr={}));var Fr=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._index=-1,e._shapes=[],e._updateFlag=e.entity.transform.registerWorldChangeFlag(),e}var a=i.prototype;return a.addShape=function(e){var n=e._collider;n!==this&&(n&&n.removeShape(e),this._shapes.push(e),e._collider=this,this._nativeCollider.addShape(e._nativeShape),this._phasedActiveInScene&&this.scene.physics._addColliderShape(e))},a.removeShape=function(e){var n=this._shapes.indexOf(e);n!==-1&&(this._shapes.splice(n,1),this._phasedActiveInScene&&this.scene.physics._removeColliderShape(e),e._collider=null,this._nativeCollider.removeShape(e._nativeShape))},a.clearShapes=function(){for(var e=this._shapes,n=0,o=e.length;n<o;n++){var s=e[n];this._phasedActiveInScene&&this.scene.physics._removeColliderShape(s),s._destroy(),this._nativeCollider.removeShape(s._nativeShape)}e.length=0},a._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform;this._nativeCollider.setWorldTransform(e.worldPosition,e.worldRotationQuaternion);for(var n=e.lossyWorldScale,o=0,s=this.shapes.length;o<s;o++)this.shapes[o]._nativeShape.setWorldScale(n);this._updateFlag.flag=!1}},a._onLateUpdate=function(){},a._onEnableInScene=function(){var e=this.scene.physics;e._addCollider(this);for(var n=this.shapes,o=0,s=n.length;o<s;o++)e._addColliderShape(n[o])},a._onDisableInScene=function(){var e=this.scene.physics;e._removeCollider(this);for(var n=this.shapes,o=0,s=n.length;o<s;o++)e._removeColliderShape(n[o])},a._cloneTo=function(e){for(var n=e._shapes,o=0,s=n.length;o<s;o++)e._addPhysicsShape(n[o])},a._onDestroy=function(){r.prototype._onDestroy.call(this),this.clearShapes(),this._nativeCollider.destroy()},a._addPhysicsShape=function(e){e._collider=this,this._nativeCollider.addShape(e._nativeShape),this._phasedActiveInScene&&this.scene.physics._addColliderShape(e)},q(i,[{key:"shapes",get:function(){return this._shapes}}]),i}(ir);R([z],Fr.prototype,"_index",void 0);R([z],Fr.prototype,"_nativeCollider",void 0);R([z],Fr.prototype,"_updateFlag",void 0);R([Z],Fr.prototype,"_shapes",void 0);Fr=R([sl(ye,Ua.CheckOnly)],Fr);var dS=function(){},Cr=function(){function r(a){var t=this;this._restTime=0,this._fixedTimeStep=1/60,this._colliders=new $e,this._gravity=new P(0,-9.81,0),this._onContactEnter=function(n,o){var s=t._scene.engine._physicalObjectsMap,l=s[n],c=s[o];l.collider.entity._scripts.forEach(function(u){var d=r._collision;d.shape=c,u.onCollisionEnter(d)},function(u,d){u._entityScriptsIndex=d}),c.collider.entity._scripts.forEach(function(u){var d=r._collision;d.shape=l,u.onCollisionEnter(d)},function(u,d){u._entityScriptsIndex=d})},this._onContactExit=function(n,o){var s=t._scene.engine._physicalObjectsMap,l=s[n],c=s[o];l.collider.entity._scripts.forEach(function(u){var d=r._collision;d.shape=c,u.onCollisionExit(d)},function(u,d){u._entityScriptsIndex=d}),c.collider.entity._scripts.forEach(function(u){var d=r._collision;d.shape=l,u.onCollisionExit(d)},function(u,d){u._entityScriptsIndex=d})},this._onContactStay=function(n,o){var s=t._scene.engine._physicalObjectsMap,l=s[n],c=s[o];l.collider.entity._scripts.forEach(function(u){var d=r._collision;d.shape=c,u.onCollisionStay(d)},function(u,d){u._entityScriptsIndex=d}),c.collider.entity._scripts.forEach(function(u){var d=r._collision;d.shape=l,u.onCollisionStay(d)},function(u,d){u._entityScriptsIndex=d})},this._onTriggerEnter=function(n,o){var s=t._scene.engine._physicalObjectsMap,l=s[n],c=s[o];l.collider.entity._scripts.forEach(function(u){u.onTriggerEnter(c)},function(u,d){u._entityScriptsIndex=d}),c.collider.entity._scripts.forEach(function(u){u.onTriggerEnter(l)},function(u,d){u._entityScriptsIndex=d})},this._onTriggerExit=function(n,o){var s=t._scene.engine._physicalObjectsMap,l=s[n],c=s[o];l.collider.entity._scripts.forEach(function(u){u.onTriggerExit(c)},function(u,d){u._entityScriptsIndex=d}),c.collider.entity._scripts.forEach(function(u){u.onTriggerExit(l)},function(u,d){u._entityScriptsIndex=d})},this._onTriggerStay=function(n,o){var s=t._scene.engine._physicalObjectsMap,l=s[n],c=s[o];l.collider.entity._scripts.forEach(function(u){u.onTriggerStay(c)},function(u,d){u._entityScriptsIndex=d}),c.collider.entity._scripts.forEach(function(u){u.onTriggerStay(l)},function(u,d){u._entityScriptsIndex=d})},this._scene=a,this._setGravity=this._setGravity.bind(this),this._gravity._onValueChanged=this._setGravity;var e=a.engine;e._physicsInitialized&&(this._nativePhysicsScene=r._nativePhysics.createPhysicsScene(e._nativePhysicsManager,this._onContactEnter,this._onContactExit,this._onContactStay,this._onTriggerEnter,this._onTriggerExit,this._onTriggerStay))}var i=r.prototype;return i.raycast=function(t,e,n,o){var s=this,l,c=Number.MAX_VALUE;typeof e=="number"?c=e:e!=null&&(l=e);var u=Kr.Everything;typeof n=="number"?u=n:n!=null&&(l=n),o&&(l=o);var d=function(h){var _=s._scene.engine._physicalObjectsMap[h];return _?_.collider.entity.layer&u&&_.isSceneQuery:!1};if(l!=null){var f=this._nativePhysicsScene.raycast(t,c,d,function(h,_,g,y){l.entity=s._scene.engine._physicalObjectsMap[h]._collider.entity,l.distance=_,l.normal.copyFrom(y),l.point.copyFrom(g)});return f?!0:(l.entity=null,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0),!1)}else return this._nativePhysicsScene.raycast(t,c,d)},i._update=function(t){var e=this,n=e._fixedTimeStep,o=e._nativePhysicsScene,s=this._scene._componentsManager,l=this._restTime+t,c=Math.floor(l/n);this._restTime=l-c*n;for(var u=0;u<c;u++)s.callScriptOnPhysicsUpdate(),this._callColliderOnUpdate(),o.update(n),this._callColliderOnLateUpdate()},i._addColliderShape=function(t){this._scene.engine._physicalObjectsMap[t.id]=t,this._nativePhysicsScene.addColliderShape(t._nativeShape)},i._removeColliderShape=function(t){delete this._scene.engine._physicalObjectsMap[t.id],this._nativePhysicsScene.removeColliderShape(t._nativeShape)},i._addCollider=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsScene.addCollider(t._nativeCollider)},i._addCharacterController=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsScene.addCharacterController(t._nativeCollider)},i._removeCollider=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsScene.removeCollider(t._nativeCollider)},i._removeCharacterController=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsScene.removeCharacterController(t._nativeCollider)},i._callColliderOnUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onUpdate()},i._callColliderOnLateUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onLateUpdate()},i._gc=function(){this._colliders.garbageCollection()},i._setGravity=function(){this._nativePhysicsScene.setGravity(this._gravity)},q(r,[{key:"gravity",get:function(){return this._gravity},set:function(t){var e=this._gravity;e!==t&&e.copyFrom(t)}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=Math.max(t,U.zeroTolerance)}}]),r}();(function(){Cr._collision=new dS})();var Uc;(function(r){r[r.PreventClimbing=0]="PreventClimbing",r[r.PreventClimbingAndForceSliding=1]="PreventClimbingAndForceSliding"})(Uc||(Uc={}));var fS=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._stepOffset=.5,e._nonWalkableMode=Uc.PreventClimbing,e._upDirection=new P(0,1,0),e._slopeLimit=.707,e._nativeCollider=Cr._nativePhysics.createCharacterController(),e._setUpDirection=e._setUpDirection.bind(he(e)),e._upDirection._onValueChanged=e._setUpDirection,e}var a=i.prototype;return a.move=function(e,n,o){return this._nativeCollider.move(e,n,o)},a.addShape=function(e){if(this._shapes.length>0)throw"only allow single shape on controller!";r.prototype.addShape.call(this,e),this._updateFlag.flag=!0},a.clearShapes=function(){this._shapes.length>0&&r.prototype.removeShape.call(this,this._shapes[0])},a._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform,n=this.shapes;this._nativeCollider.setWorldPosition(e.worldPosition);for(var o=e.lossyWorldScale,s=0,l=n.length;s<l;s++)n[s]._nativeShape.setWorldScale(o);this._updateFlag.flag=!1}},a._onLateUpdate=function(){var e=this.entity.transform.worldPosition;this._nativeCollider.getWorldPosition(e),this._updateFlag.flag=!1},a._onEnableInScene=function(){var e=this.scene.physics;e._addCharacterController(this);for(var n=this.shapes,o=0,s=n.length;o<s;o++)e._addColliderShape(n[o])},a._onDisableInScene=function(){var e=this.scene.physics;e._removeCharacterController(this);for(var n=this.shapes,o=0,s=n.length;o<s;o++)e._removeColliderShape(n[o])},a._setUpDirection=function(){this._nativeCollider.setUpDirection(this._upDirection)},q(i,[{key:"stepOffset",get:function(){return this._stepOffset},set:function(e){this._stepOffset!==e&&(this._stepOffset=e,this._nativeCollider.setStepOffset(e))}},{key:"nonWalkableMode",get:function(){return this._nonWalkableMode},set:function(e){this._nonWalkableMode!==e&&(this._nonWalkableMode=e,this._nativeCollider.setNonWalkableMode(e))}},{key:"upDirection",get:function(){return this._upDirection},set:function(e){this._upDirection!==e&&this._upDirection.copyFrom(e)}},{key:"slopeLimit",get:function(){return this._slopeLimit},set:function(e){this._slopeLimit!==e&&(this._slopeLimit=e,this._nativeCollider.setSlopeLimit(e))}}]),i}(Fr),br=function(r){W(i,r);function i(t){var e;e=r.call(this,t)||this,e._linearDamping=0,e._angularDamping=.05,e._linearVelocity=new P,e._angularVelocity=new P,e._mass=1,e._centerOfMass=new P,e._inertiaTensor=new P(1,1,1),e._maxAngularVelocity=100,e._maxDepenetrationVelocity=1e3,e._solverIterations=4,e._isKinematic=!1,e._constraints=0,e._collisionDetectionMode=0,e._sleepThreshold=.005;var n=e.entity.transform;return e._nativeCollider=Cr._nativePhysics.createDynamicCollider(n.worldPosition,n.worldRotationQuaternion),e._setLinearVelocity=e._setLinearVelocity.bind(he(e)),e._setAngularVelocity=e._setAngularVelocity.bind(he(e)),e._setCenterOfMass=e._setCenterOfMass.bind(he(e)),e._setInertiaTensor=e._setInertiaTensor.bind(he(e)),e._linearVelocity._onValueChanged=e._setLinearVelocity,e._angularVelocity._onValueChanged=e._setAngularVelocity,e._centerOfMass._onValueChanged=e._setCenterOfMass,e._inertiaTensor._onValueChanged=e._setInertiaTensor,e}var a=i.prototype;return a.applyForce=function(e){this._nativeCollider.addForce(e)},a.applyTorque=function(e){this._nativeCollider.addTorque(e)},a.move=function(e,n){this._nativeCollider.move(e,n)},a.sleep=function(){this._nativeCollider.sleep()},a.wakeUp=function(){this._nativeCollider.wakeUp()},a._onLateUpdate=function(){var e=this.entity.transform,n=e.worldPosition,o=e.worldRotationQuaternion;this._nativeCollider.getWorldTransform(n,o),this._updateFlag.flag=!1},a._cloneTo=function(e){r.prototype._cloneTo.call(this,e),e.linearDamping=this.linearDamping,e.angularDamping=this.angularDamping,e.linearVelocity=this.linearVelocity,e.angularVelocity=this.angularVelocity,e.mass=this.mass,e.centerOfMass=this.centerOfMass,e.inertiaTensor=this.inertiaTensor,e.maxAngularVelocity=this.maxAngularVelocity,e.maxDepenetrationVelocity=this.maxDepenetrationVelocity,e.sleepThreshold=this.sleepThreshold,e.solverIterations=this.solverIterations,e.isKinematic=this.isKinematic,e.constraints=this.constraints,e.collisionDetectionMode=this.collisionDetectionMode},a._setLinearVelocity=function(){this._nativeCollider.setLinearVelocity(this._linearVelocity)},a._setAngularVelocity=function(){this._nativeCollider.setAngularVelocity(this._angularVelocity)},a._setCenterOfMass=function(){this._nativeCollider.setCenterOfMass(this._centerOfMass)},a._setInertiaTensor=function(){this._nativeCollider.setInertiaTensor(this._inertiaTensor)},q(i,[{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping!==e&&(this._linearDamping=e,this._nativeCollider.setLinearDamping(e))}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping!==e&&(this._angularDamping=e,this._nativeCollider.setAngularDamping(e))}},{key:"linearVelocity",get:function(){return this._linearVelocity},set:function(e){this._linearVelocity!==e&&this._linearVelocity.copyFrom(e)}},{key:"angularVelocity",get:function(){return this._angularVelocity},set:function(e){this._angularVelocity!==e&&this._angularVelocity.copyFrom(e)}},{key:"mass",get:function(){return this._mass},set:function(e){this._mass!==e&&(this._mass=e,this._nativeCollider.setMass(e))}},{key:"centerOfMass",get:function(){return this._centerOfMass},set:function(e){this._centerOfMass!==e&&this._centerOfMass.copyFrom(e)}},{key:"inertiaTensor",get:function(){return this._inertiaTensor},set:function(e){this._inertiaTensor!==e&&this._inertiaTensor.copyFrom(e)}},{key:"maxAngularVelocity",get:function(){return this._maxAngularVelocity},set:function(e){this._maxAngularVelocity!==e&&(this._maxAngularVelocity=e,this._nativeCollider.setMaxAngularVelocity(e))}},{key:"maxDepenetrationVelocity",get:function(){return this._maxDepenetrationVelocity},set:function(e){this._maxDepenetrationVelocity!==e&&(this._maxDepenetrationVelocity=e,this._nativeCollider.setMaxDepenetrationVelocity(e))}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(e){e!==this._sleepThreshold&&(this._sleepThreshold=e,this._nativeCollider.setSleepThreshold(e))}},{key:"solverIterations",get:function(){return this._solverIterations},set:function(e){this._solverIterations!==e&&(this._solverIterations=e,this._nativeCollider.setSolverIterations(e))}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic!==e&&(this._isKinematic=e,this._nativeCollider.setIsKinematic(e))}},{key:"constraints",get:function(){return this._constraints},set:function(e){this._constraints!==e&&(this._constraints=e,this._nativeCollider.setConstraints(e))}},{key:"collisionDetectionMode",get:function(){return this._collisionDetectionMode},set:function(e){this._collisionDetectionMode!==e&&(this._collisionDetectionMode=e,this._nativeCollider.setCollisionDetectionMode(e))}}]),i}(Fr);R([z],br.prototype,"_linearDamping",void 0);R([z],br.prototype,"_angularDamping",void 0);R([z],br.prototype,"_linearVelocity",void 0);R([z],br.prototype,"_angularVelocity",void 0);R([z],br.prototype,"_mass",void 0);R([z],br.prototype,"_centerOfMass",void 0);R([z],br.prototype,"_inertiaTensor",void 0);R([z],br.prototype,"_maxAngularVelocity",void 0);R([z],br.prototype,"_maxDepenetrationVelocity",void 0);R([z],br.prototype,"_solverIterations",void 0);R([z],br.prototype,"_isKinematic",void 0);R([z],br.prototype,"_constraints",void 0);R([z],br.prototype,"_collisionDetectionMode",void 0);R([z],br.prototype,"_sleepThreshold",void 0);var _f;(function(r){r[r.Discrete=0]="Discrete",r[r.Continuous=1]="Continuous",r[r.ContinuousDynamic=2]="ContinuousDynamic",r[r.ContinuousSpeculative=3]="ContinuousSpeculative"})(_f||(_f={}));var pf;(function(r){r[r.None=0]="None",r[r.FreezePositionX=1]="FreezePositionX",r[r.FreezePositionY=2]="FreezePositionY",r[r.FreezePositionZ=4]="FreezePositionZ",r[r.FreezeRotationX=8]="FreezeRotationX",r[r.FreezeRotationY=16]="FreezeRotationY",r[r.FreezeRotationZ=32]="FreezeRotationZ"})(pf||(pf={}));var hm=function(){this.entity=null,this.distance=0,this.point=new P,this.normal=new P},Xs;(function(r){r[r.Average=0]="Average",r[r.Minimum=1]="Minimum",r[r.Multiply=2]="Multiply",r[r.Maximum=3]="Maximum"})(Xs||(Xs={}));var _m=function(){function r(){this._bounciness=.1,this._dynamicFriction=.1,this._staticFriction=.1,this._bounceCombine=Xs.Average,this._frictionCombine=Xs.Average,this._nativeMaterial=Cr._nativePhysics.createPhysicsMaterial(this._staticFriction,this._dynamicFriction,this._bounciness,this._bounceCombine,this._frictionCombine)}var i=r.prototype;return i._destroy=function(){!this._destroyed&&this._nativeMaterial.destroy(),this._destroyed=!0},q(r,[{key:"bounciness",get:function(){return this._bounciness},set:function(t){this._bounciness!==t&&(this._bounciness=t,this._nativeMaterial.setBounciness(t))}},{key:"dynamicFriction",get:function(){return this._dynamicFriction},set:function(t){this._dynamicFriction!==t&&(this._dynamicFriction=t,this._nativeMaterial.setDynamicFriction(t))}},{key:"staticFriction",get:function(){return this._staticFriction},set:function(t){this._staticFriction!==t&&(this._staticFriction=t,this._nativeMaterial.setStaticFriction(t))}},{key:"bounceCombine",get:function(){return this._bounceCombine},set:function(t){this._bounceCombine!==t&&(this._bounceCombine=t,this._nativeMaterial.setBounceCombine(t))}},{key:"frictionCombine",get:function(){return this._frictionCombine},set:function(t){this._frictionCombine!==t&&(this._frictionCombine=t,this._nativeMaterial.setFrictionCombine(t))}}]),r}(),vf=function(r){W(i,r);function i(a){var t;t=r.call(this,a)||this;var e=t.entity.transform;return t._nativeCollider=Cr._nativePhysics.createStaticCollider(e.worldPosition,e.worldRotationQuaternion),t}return i}(Fr),Gc;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(Gc||(Gc={}));var gf;(function(r){r[r.Sides=1]="Sides",r[r.Up=2]="Up",r[r.Down=4]="Down"})(gf||(gf={}));var zn=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._colliderInfo=new mp,e._connectedColliderInfo=new mp,e._force=0,e._torque=0,e._connectedColliderInfo.localPosition=new P,e}var a=i.prototype;return a._cloneTo=function(e){e.connectedCollider=this.connectedCollider,e.connectedAnchor=this.connectedAnchor,e.connectedMassScale=this.connectedMassScale,e.connectedInertiaScale=this.connectedInertiaScale,e.massScale=this.massScale,e.inertiaScale=this.inertiaScale,e.breakForce=this.breakForce,e.breakTorque=this.breakTorque},q(i,[{key:"connectedCollider",get:function(){return this._connectedColliderInfo.collider},set:function(e){this._connectedColliderInfo.collider!==e&&(this._connectedColliderInfo.collider=e,this._nativeJoint.setConnectedCollider(e._nativeCollider))}},{key:"connectedAnchor",get:function(){return this._connectedColliderInfo.localPosition},set:function(e){var n=this._connectedColliderInfo.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setConnectedAnchor(e)}},{key:"connectedMassScale",get:function(){return this._connectedColliderInfo.massScale},set:function(e){e!==this._connectedColliderInfo.massScale&&(this._connectedColliderInfo.massScale=e,this._nativeJoint.setConnectedMassScale(e))}},{key:"connectedInertiaScale",get:function(){return this._connectedColliderInfo.inertiaScale},set:function(e){e!==this._connectedColliderInfo.inertiaScale&&(this._connectedColliderInfo.inertiaScale=e,this._nativeJoint.setConnectedInertiaScale(e))}},{key:"massScale",get:function(){return this._colliderInfo.massScale},set:function(e){e!==this._colliderInfo.massScale&&(this._colliderInfo.massScale=e,this._nativeJoint.setMassScale(e))}},{key:"inertiaScale",get:function(){return this._colliderInfo.inertiaScale},set:function(e){e!==this._colliderInfo.inertiaScale&&(this._colliderInfo.inertiaScale=e,this._nativeJoint.setInertiaScale(e))}},{key:"breakForce",get:function(){return this._force},set:function(e){e!==this._force&&(this._force=e,this._nativeJoint.setBreakForce(e))}},{key:"breakTorque",get:function(){return this._torque},set:function(e){e!==this._torque&&(this._torque=e,this._nativeJoint.setBreakTorque(e))}}]),i}(ir);R([z],zn.prototype,"_colliderInfo",void 0);R([z],zn.prototype,"_connectedColliderInfo",void 0);R([z],zn.prototype,"_nativeJoint",void 0);R([z],zn.prototype,"_force",void 0);R([z],zn.prototype,"_torque",void 0);zn=R([sl(Fr,Ua.CheckOnly)],zn);var mp=function(){this.collider=null,this.massScale=0,this.inertiaScale=0},hS=function(r){W(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a._onAwake=function(){var e=this._colliderInfo;e.collider=this.entity.getComponent(Fr),this._nativeJoint=Cr._nativePhysics.createFixedJoint(e.collider._nativeCollider)},i}(zn),Er;(function(r){r[r.None=0]="None",r[r.LimitEnabled=1]="LimitEnabled",r[r.DriveEnabled=2]="DriveEnabled",r[r.DriveFreeSpin=4]="DriveFreeSpin"})(Er||(Er={}));var Qo=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t._axis=new P(1,0,0),t._hingeFlags=Er.None,t._useSpring=!1,t}var a=i.prototype;return a._onAwake=function(){var e=this._colliderInfo;e.localPosition=new P,e.collider=this.entity.getComponent(Fr),this._nativeJoint=Cr._nativePhysics.createHingeJoint(e.collider._nativeCollider)},a._cloneTo=function(e){e.axis=this.axis,e.swingOffset=this.swingOffset,e.useLimits=this.useLimits,e.useMotor=this.useMotor,e.useSpring=this.useSpring,e.motor=this.motor,e.limits=this.limits},q(i,[{key:"axis",get:function(){return this._axis},set:function(e){var n=this._axis;e!==n&&n.copyFrom(e),this._nativeJoint.setAxis(n)}},{key:"swingOffset",get:function(){return this._colliderInfo.localPosition},set:function(e){var n=this._colliderInfo.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setSwingOffset(n)}},{key:"angle",get:function(){return this._nativeJoint.getAngle()}},{key:"velocity",get:function(){return this._nativeJoint.getVelocity()}},{key:"useLimits",get:function(){return(this._hingeFlags&Er.LimitEnabled)==Er.LimitEnabled},set:function(e){e!==this.useLimits&&(e?this._hingeFlags|=Er.LimitEnabled:this._hingeFlags&=~Er.LimitEnabled,this._nativeJoint.setHingeJointFlag(Er.LimitEnabled,e))}},{key:"useMotor",get:function(){return(this._hingeFlags&Er.DriveEnabled)==Er.DriveEnabled},set:function(e){e!==this.useMotor&&(e?this._hingeFlags|=Er.DriveEnabled:this._hingeFlags&=~Er.DriveEnabled,this._nativeJoint.setHingeJointFlag(Er.DriveEnabled,e))}},{key:"useSpring",get:function(){return this._useSpring},set:function(e){this._useSpring!==e&&(this._useSpring=e,this.limits=this._limits)}},{key:"motor",get:function(){return this._jointMonitor},set:function(e){this._jointMonitor!==e&&(this._jointMonitor=e,this._nativeJoint.setDriveVelocity(e.targetVelocity),this._nativeJoint.setDriveForceLimit(e.forceLimit),this._nativeJoint.setDriveGearRatio(e.gearRation),this._nativeJoint.setHingeJointFlag(Er.DriveFreeSpin,e.freeSpin))}},{key:"limits",get:function(){return this._limits},set:function(e){this._limits!==e&&(this._limits=e,this.useSpring?this._nativeJoint.setSoftLimit(e.min,e.max,e.stiffness,e.damping):this._nativeJoint.setHardLimit(e.min,e.max,e.contactDistance))}}]),i}(zn);R([z],Qo.prototype,"_axis",void 0);R([z],Qo.prototype,"_hingeFlags",void 0);R([z],Qo.prototype,"_useSpring",void 0);R([z],Qo.prototype,"_jointMonitor",void 0);R([z],Qo.prototype,"_limits",void 0);var _S=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t._minDistance=0,t._maxDistance=0,t._tolerance=.25,t._stiffness=0,t._damping=0,t}var a=i.prototype;return a._onAwake=function(){var e=this._colliderInfo;e.localPosition=new P,e.collider=this.entity.getComponent(Fr),this._nativeJoint=Cr._nativePhysics.createSpringJoint(e.collider._nativeCollider)},a._cloneTo=function(e){e.swingOffset=this.swingOffset,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.tolerance=this.tolerance,e.stiffness=this.stiffness,e.damping=this.damping},q(i,[{key:"swingOffset",get:function(){return this._colliderInfo.localPosition},set:function(e){var n=this._colliderInfo.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setSwingOffset(e)}},{key:"minDistance",get:function(){return this._minDistance},set:function(e){this._minDistance!==e&&(this._minDistance=e,this._nativeJoint.setMinDistance(e))}},{key:"maxDistance",get:function(){return this._maxDistance},set:function(e){this._maxDistance!==e&&(this._maxDistance=e,this._nativeJoint.setMaxDistance(e))}},{key:"tolerance",get:function(){return this._tolerance},set:function(e){this._tolerance!==e&&(this._tolerance=e,this._nativeJoint.setTolerance(e))}},{key:"stiffness",get:function(){return this._stiffness},set:function(e){this._stiffness!==e&&(this._stiffness=e,this._nativeJoint.setStiffness(e))}},{key:"damping",get:function(){return this._damping},set:function(e){this._damping!==e&&(this._damping=e,this._nativeJoint.setDamping(e))}}]),i}(zn),pS=function(){this.max=0,this.min=0,this.contactDistance=-1,this.stiffness=0,this.damping=0},vS=function(){this.targetVelocity=0,this.forceLimit=Number.MAX_VALUE,this.gearRation=1,this.freeSpin=!1},Vr=function(){function r(){this._isTrigger=!1,this._rotation=new P,this._position=new P,this._contactOffset=.02,this.isSceneQuery=!0,this._material=new _m,this._id=r._idGenerator++,this._setRotation=this._setRotation.bind(this),this._setPosition=this._setPosition.bind(this),this._rotation._onValueChanged=this._setRotation,this._position._onValueChanged=this._setPosition}var i=r.prototype;return i._cloneTo=function(t){t.contactOffset=this.contactOffset,t.rotation=this.rotation,t.position=this.position,t.isTrigger=this.isTrigger,t.material=this.material},i._destroy=function(){this._material._destroy(),this._nativeShape.destroy()},i._setPosition=function(){this._nativeShape.setPosition(this._position)},i._setRotation=function(){this._nativeShape.setRotation(this._rotation)},q(r,[{key:"collider",get:function(){return this._collider}},{key:"id",get:function(){return this._id}},{key:"contactOffset",get:function(){return this._contactOffset},set:function(t){this._contactOffset!==t&&(this._contactOffset=t,this._nativeShape.setContactOffset(t))}},{key:"material",get:function(){return this._material},set:function(t){this._material!==t&&(this._material=t,this._nativeShape.setMaterial(t._nativeMaterial))}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation!=t&&this._rotation.copyFrom(t)}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t)}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger!==t&&(this._isTrigger=t,this._nativeShape.setIsTrigger(t))}}]),r}();(function(){Vr._idGenerator=0})();R([z],Vr.prototype,"_collider",void 0);R([z],Vr.prototype,"_nativeShape",void 0);R([z],Vr.prototype,"_id",void 0);R([z],Vr.prototype,"_material",void 0);R([z],Vr.prototype,"_isTrigger",void 0);R([z],Vr.prototype,"_rotation",void 0);R([z],Vr.prototype,"_position",void 0);R([z],Vr.prototype,"_contactOffset",void 0);var Hc=function(r){W(i,r);function i(){var t;return t=r.call(this)||this,t._size=new P(1,1,1),t._nativeShape=Cr._nativePhysics.createBoxColliderShape(t._id,t._size,t._material._nativeMaterial),t._setSize=t._setSize.bind(he(t)),t._size._onValueChanged=t._setSize,t}var a=i.prototype;return a._cloneTo=function(e){r.prototype._cloneTo.call(this,e),e.size=this.size},a._setSize=function(){this._nativeShape.setSize(this._size)},q(i,[{key:"size",get:function(){return this._size},set:function(e){this._size!==e&&this._size.copyFrom(e)}}]),i}(Vr);R([z],Hc.prototype,"_size",void 0);var pm=function(r){W(i,r);function i(){var t;return t=r.call(this)||this,t._radius=1,t._nativeShape=Cr._nativePhysics.createSphereColliderShape(t._id,t._radius,t._material._nativeMaterial),t}var a=i.prototype;return a._cloneTo=function(e){r.prototype._cloneTo.call(this,e),e.radius=this.radius},q(i,[{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._nativeShape.setRadius(e))}}]),i}(Vr);R([z],pm.prototype,"_radius",void 0);var gS=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._nativeShape=Cr._nativePhysics.createPlaneColliderShape(a._id,a._material._nativeMaterial),a}return i}(Vr),Pu=function(r){W(i,r);function i(){var t;return t=r.call(this)||this,t._radius=1,t._height=2,t._upAxis=Gc.Y,t._nativeShape=Cr._nativePhysics.createCapsuleColliderShape(t._id,t._radius,t._height,t._material._nativeMaterial),t}var a=i.prototype;return a._cloneTo=function(e){r.prototype._cloneTo.call(this,e),e.radius=this.radius,e.height=this.height,e.upAxis=this.upAxis},q(i,[{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._nativeShape.setRadius(e))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._nativeShape.setHeight(e))}},{key:"upAxis",get:function(){return this._upAxis},set:function(e){this._upAxis!==e&&(this._upAxis=e,this._nativeShape.setUpAxis(e))}}]),i}(Vr);R([z],Pu.prototype,"_radius",void 0);R([z],Pu.prototype,"_height",void 0);R([z],Pu.prototype,"_upAxis",void 0);var Mu=function(){function r(a,t){if(this._pointers=[],this._multiPointerEnabled=!0,this._buttons=So.None,this._upMap=[],this._downMap=[],this._upList=new $e,this._downList=new $e,this._nativeEvents=[],mt(t,Window))throw"Do not set window as target because window cannot listen to pointer leave event.";this._engine=a,this._target=t,this._canvas=a.canvas,this._htmlCanvas=a._canvas._webCanvas,this._pointerPool=new Array(11),this._onPointerEvent=this._onPointerEvent.bind(this),this._addEventListener()}var i=r.prototype;return i._update=function(){for(var t=this,e=t._pointers,n=t._nativeEvents,o=t._htmlCanvas,s=this._canvas,l=s.width,c=s.height,u=o.clientWidth,d=o.clientHeight,f=o.getBoundingClientRect(),h=f.left,_=f.top,g=l/u,y=c/d,v=e.length-1;v>=0;v--)e[v].phase===Ur.Leave&&e.splice(v,1);for(var p=0,m=n.length;p<m;p++){var A=n[p],S=A.pointerId,x=this._getPointerByID(S);if(x)x._events.push(A);else{var b=e.length;if(b===0||this._multiPointerEnabled){for(var C,w,E=this,T=E._pointerPool,M=0;M<b&&!(e[M].id>M);M++);x=(C=T)[w=M]||(C[w]=new fm(M)),x._uniqueID=S,x._events.push(A),x.position.set((A.clientX-h)*g,(A.clientY-_)*y),e.splice(M,0,x)}}}n.length=0,this._upList.length=this._downList.length=0,this._buttons=So.None;for(var B=this._engine.time.frameCount,I=0,F=e.length;I<F;I++){var L=e[I];L._upList.length=L._downList.length=0,this._updatePointerInfo(B,L,h,_,g,y),this._buttons|=L.pressedButtons}},i._firePointerScript=function(t){for(var e=this,n=e._pointers,o=e._canvas,s=0,l=n.length;s<l;s++){var c=n[s],u=c._events,d=c.position;c._firePointerDrag();var f=this._pointerRayCast(t,d.x/o.width,d.y/o.height);c._firePointerExitAndEnter(f);var h=u.length;if(h>0){for(var _=0;_<h;_++){var g=u[_];switch(g.type){case"pointerdown":c.phase=Ur.Down,c._firePointerDown(f);break;case"pointerup":c.phase=Ur.Up,c._firePointerUpAndClick(f);break;case"pointerleave":case"pointercancel":c.phase=Ur.Leave,c._firePointerExitAndEnter(null);break}}u.length=0}}},i._destroy=function(){this._removeEventListener(),this._pointerPool.length=0,this._nativeEvents.length=0,this._downMap.length=0,this._upMap.length=0},i._onPointerEvent=function(t){this._nativeEvents.push(t)},i._getPointerByID=function(t){for(var e=this,n=e._pointers,o=n.length-1;o>=0;o--)if(n[o]._uniqueID===t)return n[o];return null},i._updatePointerInfo=function(t,e,n,o,s,l){var c=e._events,u=e.position,d=c.length;if(d>0){var f=this,h=f._upList,_=f._upMap,g=f._downList,y=f._downMap,v=c[d-1],p=(v.clientX-n)*s,m=(v.clientY-o)*l;e.deltaPosition.set(p-u.x,m-u.y),u.set(p,m);for(var A=0;A<d;A++){var S=c[A],x=S.button;switch(e.button=cS[x]||So.None,e.pressedButtons=S.buttons,S.type){case"pointerdown":g.add(x),y[x]=t,e._downList.add(x),e._downMap[x]=t,e.phase=Ur.Down;break;case"pointerup":h.add(x),_[x]=t,e._upList.add(x),e._upMap[x]=t,e.phase=Ur.Up;break;case"pointermove":e.phase=Ur.Move;break;case"pointerleave":case"pointercancel":e.phase=Ur.Leave}}this._engine._physicsInitialized||(c.length=0)}else e.deltaPosition.set(0,0),e.phase=Ur.Stationary},i._pointerRayCast=function(t,e,n){for(var o=r._tempPoint,s=r._tempRay,l=r._tempHitResult,c=t.length-1;c>=0;c--){var u=t[c];if(!(!u.isActive||u.destroyed))for(var d=u._componentsManager,f=d._activeCameras,h=f._elements,_=f.length-1;_>=0;_--){var g=h[_];if(!g.renderTarget){var y=g.viewport,v=y.x,p=y.y,m=y.z,A=y.w;if(e>=v&&n>=p&&e-v<=m&&n-p<=A){if(o.set((e-v)/m,(n-p)/A),u.physics.raycast(g.viewportPointToRay(o,s),Number.MAX_VALUE,g.cullingMask,l))return l.entity;if(g.clearFlags&gr.Color)return null}}}}return null},i._addEventListener=function(){var t=this,e=t._target,n=t._onPointerEvent;e.addEventListener("pointerdown",n),e.addEventListener("pointerup",n),e.addEventListener("pointerleave",n),e.addEventListener("pointermove",n),e.addEventListener("pointercancel",n)},i._removeEventListener=function(){var t=this,e=t._target,n=t._onPointerEvent;e.removeEventListener("pointerdown",n),e.removeEventListener("pointerup",n),e.removeEventListener("pointerleave",n),e.removeEventListener("pointermove",n),e.removeEventListener("pointercancel",n),this._nativeEvents.length=0,this._pointers.length=0,this._downList.length=0,this._upList.length=0},r}();(function(){Mu._tempRay=new em})();(function(){Mu._tempPoint=new te})();(function(){Mu._tempHitResult=new hm})();var mS=function(){function r(a,t){this._delta=new P,this._nativeEvents=[],this._onWheelEvent=this._onWheelEvent.bind(this),this._target=t,this._addEventListener()}var i=r.prototype;return i._update=function(){var t=this,e=t._delta;e.set(0,0,0);var n=this,o=n._nativeEvents;if(o.length>0){for(var s=o.length-1;s>=0;s--){var l=o[s];e.x+=l.deltaX,e.y+=l.deltaY,e.z+=l.deltaZ}o.length=0}},i._addEventListener=function(){this._target.addEventListener("wheel",this._onWheelEvent)},i._removeEventListener=function(){this._target.removeEventListener("wheel",this._onWheelEvent),this._nativeEvents.length=0,this._delta.set(0,0,0)},i._destroy=function(){this._removeEventListener(),this._nativeEvents=null,this._delta=null},i._onWheelEvent=function(t){this._nativeEvents.push(t)},r}(),vm=function(){function r(a,t){this._initialized=!1,this._engine=a;var e=a._canvas._webCanvas;if(typeof OffscreenCanvas>"u"||!mt(e,OffscreenCanvas)){var n,o,s,l;this._wheelManager=new mS(a,(l=(n=t)==null?void 0:n.wheelTarget)!=null?l:e);var c;this._pointerManager=new Mu(a,(c=(o=t)==null?void 0:o.pointerTarget)!=null?c:e);var u;this._keyboardManager=new uS(a,(u=(s=t)==null?void 0:s.keyboardTarget)!=null?u:window),this._initialized=!0}}var i=r.prototype;return i.isKeyHeldDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameHeldDownList.length>0:this._keyboardManager._curHeldDownKeyToIndexMap[t]!=null:!1},i.isKeyDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameDownList.length>0:this._keyboardManager._downKeyToFrameCountMap[t]===this._engine.time.frameCount:!1},i.isKeyUp=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameUpList.length>0:this._keyboardManager._upKeyToFrameCountMap[t]===this._engine.time.frameCount:!1},i.isPointerHeldDown=function(t){return this._initialized?t===void 0?this._pointerManager._buttons!==0:(this._pointerManager._buttons&t)!==0:!1},i.isPointerDown=function(t){return this._initialized?t===void 0?this._pointerManager._downList.length>0:this._pointerManager._downMap[gp[t]]===this._engine.time.frameCount:!1},i.isPointerUp=function(t){return this._initialized?t===void 0?this._pointerManager._upList.length>0:this._pointerManager._upMap[gp[t]]===this._engine.time.frameCount:!1},i._update=function(){this._initialized&&(this._wheelManager._update(),this._pointerManager._update(),this._keyboardManager._update())},i._firePointerScript=function(t){this._initialized&&this._pointerManager._firePointerScript(t)},i._destroy=function(){this._initialized&&(this._wheelManager._destroy(),this._wheelManager=null,this._pointerManager._destroy(),this._pointerManager=null,this._keyboardManager._destroy(),this._keyboardManager=null)},q(r,[{key:"pointers",get:function(){return this._initialized?this._pointerManager._pointers:[]}},{key:"multiPointerEnabled",get:function(){return this._initialized?this._pointerManager._multiPointerEnabled:!1},set:function(t){this._initialized&&(this._pointerManager._multiPointerEnabled=t)}},{key:"wheelDelta",get:function(){return this._initialized?this._wheelManager._delta:null}}]),r}(),In=function(r){W(i,r);function i(t,e){var n;return n=r.call(this,t)||this,n._renderStates=[],n._priority=0,n._shaderData=new ii(Dn.Material),n.shader=e,n}var a=i.prototype;return a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){e.shader=this.shader,this.shaderData.cloneTo(e.shaderData),mn.deepCloneObject(this.renderStates,e.renderStates)},a._addReferCount=function(e){this._destroyed||(r.prototype._addReferCount.call(this,e),this.shaderData._addReferCount(e),this._shader._addReferCount(e))},a._onDestroy=function(){r.prototype._onDestroy.call(this),this._shader=null,this._shaderData=null,this._renderStates.length=0,this._renderStates=null},q(i,[{key:"shaderData",get:function(){return this._shaderData}},{key:"shader",get:function(){return this._shader},set:function(e){var n=this._getReferCount();if(n>0){var o;(o=this._shader)==null||o._addReferCount(-n),e._addReferCount(n)}this._shader=e;for(var s=this._renderStates,l=s.length,c=0,u=e.subShaders,d=0;d<u.length;d++)c=Math.max(u[d].passes.length,c);if(l<c)for(var f=l;f<c;f++)s.push(new $n);else s.length=c}},{key:"renderState",get:function(){return this._renderStates[0]}},{key:"renderStates",get:function(){return this._renderStates}}]),i}(ni),mf;(function(r){r.cornerTextureCoordinate="a_CornerTextureCoordinate"})(mf||(mf={}));var kr;(function(r){r.ShapePositionStartLifeTime="a_ShapePositionStartLifeTime",r.DirectionTime="a_DirectionTime",r.StartColor="a_StartColor",r.StartSize="a_StartSize",r.StartRotation0="a_StartRotation0",r.StartSpeed="a_StartSpeed",r.Random0="a_Random0",r.Random1="a_Random1",r.SimulationWorldPosition="a_SimulationWorldPosition",r.SimulationWorldRotation="a_SimulationWorldRotation",r.SimulationUV="a_SimulationUV"})(kr||(kr={}));var yS=function(){function r(a){this.billboardVertexElement=new De(mf.cornerTextureCoordinate,0,ie.Vector4,0),this.instanceVertexElements=[new De(kr.ShapePositionStartLifeTime,0,ie.Vector4,1,1),new De(kr.DirectionTime,16,ie.Vector4,1,1),new De(kr.StartColor,32,ie.Vector4,1,1),new De(kr.StartSize,48,ie.Vector3,1,1),new De(kr.StartRotation0,60,ie.Vector3,1,1),new De(kr.StartSpeed,72,ie.Float,1,1),new De(kr.Random0,76,ie.Vector4,1,1),new De(kr.Random1,92,ie.Vector4,1,1),new De(kr.SimulationWorldPosition,108,ie.Vector3,1,1),new De(kr.SimulationWorldRotation,120,ie.Vector4,1,1),new De(kr.SimulationUV,136,ie.Vector4,1,1)],this.instanceVertexStride=152,this.instanceVertexFloatStride=this.instanceVertexStride/4,this.startLifeTimeOffset=3,this.timeOffset=7,this.simulationUVOffset=34,this.billboardIndexCount=6;var t=16,e=new qr(a,mr.VertexBuffer,t*4,yt.Static,!1);this.billboardVertexBufferBinding=new Ga(e,t);var n=new qr(a,mr.IndexBuffer,this.billboardIndexCount,yt.Static,!1);this.billboardIndexBufferBinding=new js(n,Wt.UInt8),this.setBufferData()}var i=r.prototype;return i.setBufferData=function(){this.billboardVertexBufferBinding.buffer.setData(new Float32Array([-.5,-.5,0,1,.5,-.5,1,1,.5,.5,1,0,-.5,.5,0,0])),this.billboardIndexBufferBinding.buffer.setData(new Uint8Array([0,2,3,0,1,2]))},r}(),AS=`#define GLSLIFY 1
#include <common>
const float MIE_G=-0.990;const float MIE_G2=0.9801;const float SKY_GROUND_THRESHOLD=0.02;uniform float material_SunSize;uniform float material_SunSizeConvergence;uniform vec4 scene_SunlightColor;uniform vec3 scene_SunlightDirection;varying vec3 v_GroundColor;varying vec3 v_SkyColor;
#ifdef MATERIAL_SUN_HIGH_QUALITY
varying vec3 v_Vertex;
#elif defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_RayDir;
#else
varying float v_SkyGroundFactor;
#endif
#if defined(MATERIAL_SUN_HIGH_QUALITY)||defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_SunColor;
#endif
#if defined(ENGINE_IS_COLORSPACE_GAMMA)
#define LINEAR_2_OUTPUT(color) sqrt(color)
#endif
float getMiePhase(float eyeCos,float eyeCos2){float temp=1.0+MIE_G2-2.0*MIE_G*eyeCos;temp=pow(temp,pow(material_SunSize,0.65)*10.0);temp=max(temp,1.0e-4);temp=1.5*((1.0-MIE_G2)/(2.0+MIE_G2))*(1.0+eyeCos2)/temp;return temp;}float calcSunAttenuation(vec3 lightPos,vec3 ray){
#ifdef MATERIAL_SUN_HIGH_QUALITY
float focusedEyeCos=pow(clamp(dot(lightPos,ray),0.0,1.0),material_SunSizeConvergence);return getMiePhase(-focusedEyeCos,focusedEyeCos*focusedEyeCos);
#else
vec3 delta=lightPos-ray;float dist=length(delta);float spot=1.0-smoothstep(0.0,material_SunSize,dist);return spot*spot;
#endif
}void main(){vec3 col=vec3(0.0,0.0,0.0);
#ifdef MATERIAL_SUN_HIGH_QUALITY
vec3 ray=normalize(v_Vertex);float y=ray.y/SKY_GROUND_THRESHOLD;
#elif defined(MATERIAL_SUN_SIMPLE)
vec3 ray=v_RayDir;float y=ray.y/SKY_GROUND_THRESHOLD;
#else
float y=v_SkyGroundFactor;
#endif
col=mix(v_SkyColor,v_GroundColor,clamp(y,0.0,1.0));
#if defined(MATERIAL_SUN_HIGH_QUALITY)||defined(MATERIAL_SUN_SIMPLE)
if(y<0.0)col+=v_SunColor*calcSunAttenuation(-scene_SunlightDirection,-ray);
#endif
#ifdef ENGINE_IS_COLORSPACE_GAMMA
col=LINEAR_2_OUTPUT(col);
#endif
gl_FragColor=vec4(col,1.0);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,xS=`#define GLSLIFY 1
#define OUTER_RADIUS 1.025
#define RAYLEIGH (mix(0.0, 0.0025, pow(material_AtmosphereThickness,2.5)))
#define MIE 0.0010
#define SUN_BRIGHTNESS 20.0
#define MAX_SCATTER 50.0
const float SKY_GROUND_THRESHOLD=0.02;const float outerRadius=OUTER_RADIUS;const float outerRadius2=OUTER_RADIUS*OUTER_RADIUS;const float innerRadius=1.0;const float innerRadius2=1.0;const float cameraHeight=0.0001;const float HDSundiskIntensityFactor=15.0;const float simpleSundiskIntensityFactor=27.0;const float sunScale=400.0*SUN_BRIGHTNESS;const float kmESun=MIE*SUN_BRIGHTNESS;const float km4PI=MIE*4.0*3.14159265;const float scale=1.0/(OUTER_RADIUS-1.0);const float scaleDepth=0.25;const float scaleOverScaleDepth=(1.0/(OUTER_RADIUS-1.0))/0.25;const float samples=2.0;const vec3 c_DefaultScatteringWavelength=vec3(0.65,0.57,0.475);const vec3 c_VariableRangeForScatteringWavelength=vec3(0.15,0.15,0.15);attribute vec4 POSITION;uniform mat4 camera_VPMat;uniform vec3 material_SkyTint;uniform vec3 material_GroundTint;uniform float material_Exposure;uniform float material_AtmosphereThickness;uniform vec4 scene_SunlightColor;uniform vec3 scene_SunlightDirection;varying vec3 v_GroundColor;varying vec3 v_SkyColor;
#ifdef MATERIAL_SUN_HIGH_QUALITY
varying vec3 v_Vertex;
#elif defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_RayDir;
#else
varying float v_SkyGroundFactor;
#endif
#if defined(MATERIAL_SUN_HIGH_QUALITY)||defined(MATERIAL_SUN_SIMPLE)
varying vec3 v_SunColor;
#endif
#if defined(ENGINE_IS_COLORSPACE_GAMMA)
#define COLOR_2_GAMMA(color) color
#define COLOR_2_LINEAR(color) color*color
#else
#define GAMMA 2.2
#define COLOR_2_GAMMA(color) pow(color,vec3(1.0/GAMMA))
#define COLOR_2_LINEAR(color) color
#endif
float getRayleighPhase(vec3 light,vec3 ray){float eyeCos=dot(light,ray);return 0.75+0.75*eyeCos*eyeCos;}float scaleAngle(float inCos){float x=1.0-inCos;return 0.25*exp(-0.00287+x*(0.459+x*(3.83+x*(-6.80+x*5.25))));}void main(){gl_Position=camera_VPMat*vec4(POSITION.xyz,1.0);vec3 skyTintInGammaSpace=COLOR_2_GAMMA(material_SkyTint);vec3 scatteringWavelength=mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0)-skyTintInGammaSpace);vec3 invWavelength=1.0/pow(scatteringWavelength,vec3(4.0));float krESun=RAYLEIGH*SUN_BRIGHTNESS;float kr4PI=RAYLEIGH*4.0*3.14159265;vec3 cameraPos=vec3(0.0,innerRadius+cameraHeight,0.0);vec3 eyeRay=normalize(POSITION.xyz);float far=0.0;vec3 cIn,cOut;if(eyeRay.y>=0.0){far=sqrt(outerRadius2+innerRadius2*eyeRay.y*eyeRay.y-innerRadius2)-innerRadius*eyeRay.y;float height=innerRadius+cameraHeight;float depth=exp(scaleOverScaleDepth*-cameraHeight);float startAngle=dot(eyeRay,cameraPos)/height;float startOffset=depth*scaleAngle(startAngle);float sampleLength=far/samples;float scaledLength=sampleLength*scale;vec3 sampleRay=eyeRay*sampleLength;vec3 samplePoint=cameraPos+sampleRay*0.5;vec3 frontColor=vec3(0.0);{float height=length(samplePoint);float depth=exp(scaleOverScaleDepth*(innerRadius-height));float lightAngle=dot(-scene_SunlightDirection,samplePoint)/height;float cameraAngle=dot(eyeRay,samplePoint)/height;float scatter=(startOffset+depth*(scaleAngle(lightAngle)-scaleAngle(cameraAngle)));vec3 attenuate=exp(-clamp(scatter,0.0,MAX_SCATTER)*(invWavelength*kr4PI+km4PI));frontColor+=attenuate*(depth*scaledLength);samplePoint+=sampleRay;}{float height=length(samplePoint);float depth=exp(scaleOverScaleDepth*(innerRadius-height));float lightAngle=dot(-scene_SunlightDirection,samplePoint)/height;float cameraAngle=dot(eyeRay,samplePoint)/height;float scatter=(startOffset+depth*(scaleAngle(lightAngle)-scaleAngle(cameraAngle)));vec3 attenuate=exp(-clamp(scatter,0.0,MAX_SCATTER)*(invWavelength*kr4PI+km4PI));frontColor+=attenuate*(depth*scaledLength);samplePoint+=sampleRay;}cIn=frontColor*(invWavelength*krESun);cOut=frontColor*kmESun;}else{far=(-cameraHeight)/(min(-0.001,eyeRay.y));vec3 pos=cameraPos+far*eyeRay;float depth=exp((-cameraHeight)*(1.0/scaleDepth));float cameraAngle=dot(-eyeRay,pos);float lightAngle=dot(-scene_SunlightDirection,pos);float cameraScale=scaleAngle(cameraAngle);float lightScale=scaleAngle(lightAngle);float cameraOffset=depth*cameraScale;float temp=lightScale+cameraScale;float sampleLength=far/samples;float scaledLength=sampleLength*scale;vec3 sampleRay=eyeRay*sampleLength;vec3 samplePoint=cameraPos+sampleRay*0.5;vec3 frontColor=vec3(0.0,0.0,0.0);vec3 attenuate;{float height=length(samplePoint);float depth=exp(scaleOverScaleDepth*(innerRadius-height));float scatter=depth*temp-cameraOffset;attenuate=exp(-clamp(scatter,0.0,MAX_SCATTER)*(invWavelength*kr4PI+km4PI));frontColor+=attenuate*(depth*scaledLength);samplePoint+=sampleRay;}cIn=frontColor*(invWavelength*krESun+kmESun);cOut=clamp(attenuate,0.0,1.0);}
#ifdef MATERIAL_SUN_HIGH_QUALITY
v_Vertex=-POSITION.xyz;
#elif defined(MATERIAL_SUN_SIMPLE)
v_RayDir=-eyeRay;
#else
v_SkyGroundFactor=-eyeRay.y/SKY_GROUND_THRESHOLD;
#endif
v_GroundColor=material_Exposure*(cIn+COLOR_2_LINEAR(material_GroundTint)*cOut);v_SkyColor=material_Exposure*(cIn*getRayleighPhase(-scene_SunlightDirection,-eyeRay));float lightColorIntensity=clamp(length(scene_SunlightColor.xyz),0.25,1.0);
#ifdef MATERIAL_SUN_HIGH_QUALITY
v_SunColor=HDSundiskIntensityFactor*clamp(cOut,0.0,1.0)*scene_SunlightColor.xyz/lightColorIntensity;
#elif defined(MATERIAL_SUN_SIMPLE)
v_SunColor=simpleSundiskIntensityFactor*clamp(cOut*sunScale,0.0,1.0)*scene_SunlightColor.xyz/lightColorIntensity;
#endif
}`,SS=`#define GLSLIFY 1
uniform sampler2D material_BaseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(material_BaseTexture,v_uv);}`,CS=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,bS=`#define GLSLIFY 1
#include <common>
#include <camera_declare>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <ShadowFragmentDeclaration>
#include <mobile_material_frag>
#include <FogFragmentDeclaration>
#include <normal_get>
void main(){
#include <begin_mobile_frag>
#include <begin_viewdir_frag>
#include <mobile_blinnphong_frag>
gl_FragColor=emission+ambient+diffuse+specular;
#ifdef MATERIAL_IS_TRANSPARENT
gl_FragColor.a=diffuse.a;
#else
gl_FragColor.a=1.0;
#endif
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,ES=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <ShadowVertexDeclaration>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <position_vert>
#include <ShadowVertex>
#include <FogVertex>
}`,wS=`#define GLSLIFY 1
void main(){}`,TS=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
uniform mat4 camera_VPMat;void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <position_vert>
}`,RS=`#define GLSLIFY 1
#include <common>
varying vec4 v_Color;varying vec2 v_TextureCoordinate;uniform sampler2D material_BaseTexture;uniform vec4 material_BaseColor;
#ifdef RENDERER_MODE_MESH
varying vec4 v_MeshColor;
#endif
void main(){vec4 color=material_BaseColor*v_Color;
#ifdef RENDERER_MODE_MESH
color*=v_MeshColor;
#endif
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 textureColor=texture2D(material_BaseTexture,v_TextureCoordinate);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
color*=textureColor;
#endif
gl_FragColor=color;
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,PS=`#define GLSLIFY 1
#if defined(RENDERER_MODE_SPHERE_BILLBOARD) || defined(RENDERER_MODE_STRETCHED_BILLBOARD) || defined(RENDERER_MODE_HORIZONTAL_BILLBOARD) || defined(RENDERER_MODE_VERTICAL_BILLBOARD)
attribute vec4 a_CornerTextureCoordinate;
#endif
#ifdef RENDERER_MODE_MESH
attribute vec3 a_MeshPosition;attribute vec4 a_MeshColor;attribute vec2 a_MeshTextureCoordinate;varying vec4 v_MeshColor;
#endif
attribute vec4 a_ShapePositionStartLifeTime;attribute vec4 a_DirectionTime;attribute vec4 a_StartColor;attribute vec3 a_StartSize;attribute vec3 a_StartRotation0;attribute float a_StartSpeed;attribute vec4 a_Random0;
#if defined(RENDERER_TSA_FRAME_RANDOM_CURVES) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
attribute vec4 a_Random1;
#endif
attribute vec3 a_SimulationWorldPosition;attribute vec4 a_SimulationWorldRotation;varying vec4 v_Color;
#ifdef MATERIAL_HAS_BASETEXTURE
attribute vec4 a_SimulationUV;varying vec2 v_TextureCoordinate;
#endif
uniform float renderer_CurrentTime;uniform vec3 renderer_Gravity;uniform vec2 u_DragConstant;uniform vec3 renderer_WorldPosition;uniform vec4 renderer_WorldRotation;uniform bool renderer_ThreeDStartRotation;uniform int renderer_ScalingMode;uniform vec3 renderer_PositionScale;uniform vec3 renderer_SizeScale;uniform vec3 renderer_PivotOffset;uniform mat4 camera_ViewMat;uniform mat4 camera_ProjMat;
#ifdef RENDERER_MODE_STRETCHED_BILLBOARD
uniform vec3 camera_Position;
#endif
uniform vec3 camera_Forward;uniform vec3 camera_Up;uniform float renderer_StretchedBillboardLengthScale;uniform float renderer_StretchedBillboardSpeedScale;uniform int renderer_SimulationSpace;
#include <particle_common>
#include <velocity_over_lifetime_module>
#include <color_over_lifetime_module>
#include <size_over_lifetime_module>
#include <rotation_over_lifetime_module>
#include <texture_sheet_animation_module>
void main(){float age=renderer_CurrentTime-a_DirectionTime.w;float normalizedAge=age/a_ShapePositionStartLifeTime.w;vec3 lifeVelocity;if(normalizedAge<1.0){vec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;
#if defined(RENDERER_VOL_CONSTANT) || defined(RENDERER_VOL_CURVE) || defined(RENDERER_VOL_RANDOM_CONSTANT) || defined(RENDERER_VOL_RANDOM_CURVE)
lifeVelocity=computeParticleLifeVelocity(normalizedAge);
#endif
vec3 gravityVelocity=renderer_Gravity*age;vec4 worldRotation;if(renderer_SimulationSpace==0){worldRotation=renderer_WorldRotation;}else{worldRotation=a_SimulationWorldRotation;}vec3 dragData=a_DirectionTime.xyz*mix(u_DragConstant.x,u_DragConstant.y,a_Random0.x);vec3 center=computeParticlePosition(startVelocity,lifeVelocity,age,normalizedAge,gravityVelocity,worldRotation,dragData);
#include <sphere_billboard>
#include <stretched_billboard>
#include <horizontal_billboard>
#include <vertical_billboard>
#include <particle_mesh>
gl_Position=camera_ProjMat*camera_ViewMat*vec4(center,1.0);v_Color=computeParticleColor(a_StartColor,normalizedAge);
#ifdef MATERIAL_HAS_BASETEXTURE
vec2 simulateUV;
#if defined(RENDERER_MODE_SPHERE_BILLBOARD) || defined(RENDERER_MODE_STRETCHED_BILLBOARD) || defined(RENDERER_MODE_HORIZONTAL_BILLBOARD) || defined(RENDERER_MODE_VERTICAL_BILLBOARD)
simulateUV=a_CornerTextureCoordinate.zw*a_SimulationUV.xy+a_SimulationUV.zw;v_TextureCoordinate=computeParticleUV(simulateUV,normalizedAge);
#endif
#ifdef RENDERER_MODE_MESH
simulateUV=a_SimulationUV.xy+a_MeshTextureCoordinate*a_SimulationUV.zw;v_TextureCoordinate=computeParticleUV(simulateUV,normalizedAge);
#endif
#endif
}else{gl_Position=vec4(2.0,2.0,2.0,1.0);}}`,MS=`#define GLSLIFY 1
#include <common>
#include <camera_declare>
#include <FogFragmentDeclaration>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,BS=`#define GLSLIFY 1
#define IS_METALLIC_WORKFLOW
#include <common>
#include <camera_declare>
#include <FogFragmentDeclaration>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,yp=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <ShadowVertexDeclaration>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <position_vert>
#include <ShadowVertex>
#include <FogVertex>
}`,DS=`#define GLSLIFY 1
#ifdef ENGINE_NO_DEPTH_TEXTURE
vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}
#endif
void main(){
#ifdef ENGINE_NO_DEPTH_TEXTURE
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
#endif
}`,LS=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <normal_share>
uniform mat4 camera_VPMat;uniform vec2 scene_ShadowBias;uniform vec3 scene_LightDirection;vec3 applyShadowBias(vec3 positionWS){positionWS-=scene_LightDirection*scene_ShadowBias.x;return positionWS;}vec3 applyShadowNormalBias(vec3 positionWS,vec3 normalWS){float invNdotL=1.0-clamp(dot(-scene_LightDirection,normalWS),0.0,1.0);float scale=invNdotL*scene_ShadowBias.y;positionWS+=normalWS*vec3(scale);return positionWS;}void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
vec4 positionWS=renderer_ModelMat*position;positionWS.xyz=applyShadowBias(positionWS.xyz);
#ifndef MATERIAL_OMIT_NORMAL
#ifdef RENDERER_HAS_NORMAL
vec3 normalWS=normalize(mat3(renderer_NormalMat)*normal);positionWS.xyz=applyShadowNormalBias(positionWS.xyz,normalWS);
#endif
#endif
vec4 positionCS=camera_VPMat*positionWS;positionCS.z=max(positionCS.z,-1.0);gl_Position=positionCS;}`,IS=`#define GLSLIFY 1
#include <common>
uniform samplerCube material_CubeTexture;varying vec3 v_cubeUV;uniform float material_Exposure;uniform vec4 material_TintColor;void main(){vec4 textureColor=textureCube(material_CubeTexture,v_cubeUV);
#ifdef MATERIAL_IS_DECODE_SKY_RGBM
textureColor=RGBMToLinear(textureColor,5.0);
#elif !defined(ENGINE_IS_COLORSPACE_GAMMA)
textureColor=gammaToLinear(textureColor);
#endif
textureColor.rgb*=material_Exposure*material_TintColor.rgb;gl_FragColor=textureColor;
#if defined(MATERIAL_IS_DECODE_SKY_RGBM) || !defined(ENGINE_IS_COLORSPACE_GAMMA)
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,FS=`#define GLSLIFY 1
#include <common_vert>
uniform mat4 camera_VPMat;varying vec3 v_cubeUV;uniform float material_Rotation;vec4 rotateY(vec4 v,float angle){const float deg2rad=3.1415926/180.0;float radian=angle*deg2rad;float sina=sin(radian);float cosa=cos(radian);mat2 m=mat2(cosa,-sina,sina,cosa);return vec4(m*v.xz,v.yw).xzyw;}void main(){v_cubeUV=vec3(-POSITION.x,POSITION.yz);gl_Position=camera_VPMat*rotateY(vec4(POSITION,1.0),material_Rotation);}`,NS=`#define GLSLIFY 1
uniform sampler2D renderer_MaskTexture;uniform float renderer_MaskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(renderer_MaskTexture,v_uv);if(color.a<renderer_MaskAlphaCutoff){discard;}gl_FragColor=color;}`,VS=`#define GLSLIFY 1
uniform mat4 camera_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=camera_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,OS=`#define GLSLIFY 1
uniform sampler2D renderer_SpriteTexture;varying vec2 v_uv;varying vec4 v_color;void main(){vec4 baseColor=texture2D(renderer_SpriteTexture,v_uv);gl_FragColor=baseColor*v_color;}`,zS=`#define GLSLIFY 1
uniform mat4 renderer_MVPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){gl_Position=renderer_MVPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;v_color=COLOR_0;}`,kS=`#define GLSLIFY 1
#include <common>
#include <uv_share>
#include <FogFragmentDeclaration>
uniform vec4 material_BaseColor;uniform float material_AlphaCutoff;
#ifdef MATERIAL_HAS_BASETEXTURE
uniform sampler2D material_BaseTexture;
#endif
void main(){vec4 baseColor=material_BaseColor;
#ifdef MATERIAL_HAS_BASETEXTURE
vec4 textureColor=texture2D(material_BaseTexture,v_uv);
#ifndef ENGINE_IS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
baseColor*=textureColor;
#endif
#ifdef MATERIAL_IS_ALPHA_CUTOFF
if(baseColor.a<material_AlphaCutoff){discard;}
#endif
gl_FragColor=baseColor;
#ifndef MATERIAL_IS_TRANSPARENT
gl_FragColor.a=1.0;
#endif
#include <FogFragment>
#ifndef ENGINE_IS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
}`,US=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <FogVertexDeclaration>
void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <position_vert>
#include <FogVertex>
}`,GS=function(){function r(){}return r.init=function(){var a=new zt("ShadowCaster",LS,DS,{pipelineStage:pr.ShadowCaster}),t=new zt("DepthOnly",TS,wS,{pipelineStage:pr.DepthOnly}),e=[a,t],n={pipelineStage:pr.Forward};Le.create("blinn-phong",[].concat(new zt("Forward",ES,bS,n),e)),Le.create("pbr",[].concat(new zt("Forward",yp,BS,n),e)),Le.create("pbr-specular",[].concat(new zt("Forward",yp,MS,n),e)),Le.create("unlit",[].concat(new zt("Forward",US,kS,n),e)),Le.create("skybox",[new zt("Forward",FS,IS,n)]),Le.create("SkyProcedural",[new zt("Forward",xS,AS,n)]),Le.create("particle-shader",[new zt("Forward",PS,RS,n)]),Le.create("SpriteMask",[new zt("Forward",VS,NS,n)]),Le.create("Sprite",[new zt("Forward",zS,OS,n)]),Le.create("background-texture",[new zt("Forward",CS,SS,n)])},r}(),HS=function(){function r(){this._cacheHierarchyDepth=1,this._cacheMap=Object.create(null)}var i=r.prototype;return i.get=function(t){var e=this._cacheMap,n=t._length,o=this._cacheHierarchyDepth;n>o&&(this._resizeCacheMapHierarchy(e,0,o,n-o),this._cacheHierarchyDepth=n);for(var s=t._mask,l=t._length-1,c=this._cacheHierarchyDepth-1,u=0;u<c;u++){var d=l<u?0:s[u],f=e[d];f||(e[d]=f=Object.create(null)),e=f}var h=l<c?0:s[c],_=e[h];return _||(this._lastQueryKey=h,this._lastQueryMap=e),_},i.cache=function(t){this._lastQueryMap[this._lastQueryKey]=t},i._destroy=function(){this._recursiveDestroy(0,this._cacheMap),this._cacheMap=Object.create(null)},i._recursiveDestroy=function(t,e){if(t===this._cacheHierarchyDepth-1){for(var n in e)e[n].destroy();return}++t;for(var o in e)this._recursiveDestroy(t,e[o])},i._resizeCacheMapHierarchy=function(t,e,n,o){if(e==n-1)for(var s in t){for(var l=t[s],c=t,u=0;u<o;u++)c[u==0?s:0]=c=Object.create(null);c[0]=l}else{e++;for(var d in t)this._resizeCacheMapHierarchy(t[d],e,n,o)}},r}(),gm=function(){function r(){}var i=r.prototype;return i._initialize=function(t,e){},i._update=function(){},i._destroy=function(){},i._getRequestAnimationFrame=function(){return null},i._getCancelAnimationFrame=function(){return null},i._getCameraClearFlagsMask=function(t){return gr.None},r}();GS.init();var ei=function(r){W(i,r);function i(t,e,n){var o;o=r.call(this)||this,o._physicsInitialized=!1,o._physicalObjectsMap={},o._lastRenderState=new $n,o._renderElementPool=new Sa($x),o._renderDataPool=new Sa(Ru),o._spriteRenderDataPool=new Sa(nS),o._spriteMaskRenderDataPool=new Sa(rS),o._textRenderDataPool=new Sa(iS),o._spriteDefaultMaterials=[],o._renderContext=new xi,o._renderCount=0,o._shaderProgramPools=[],o._canSpriteBatch=!0,o._fontMap={},o._macroCollection=new Ir,o._settings={},o._resourceManager=new Vo(he(o)),o._sceneManager=new dm(he(o)),o._vSyncCount=1,o._targetFrameRate=60,o._time=new Cu,o._isPaused=!0,o._vSyncCounter=1,o._targetFrameInterval=1e3/60,o._destroyed=!1,o._frameInProcess=!1,o._waitingDestroy=!1,o._isDeviceLost=!1,o._waitingGC=!1,o._animate=function(){if(o._vSyncCount){var g,y=((g=o.xrManager)==null?void 0:g._getRequestAnimationFrame())||requestAnimationFrame;o._requestId=y(o._animate),o._vSyncCounter++%o._vSyncCount===0&&(o.update(),o._vSyncCounter=1)}else o._timeoutId=window.setTimeout(o._animate,o._targetFrameInterval),o.update()},o._hardwareRenderer=e,o._hardwareRenderer.init(t,o._onDeviceLost.bind(he(o)),o._onDeviceRestored.bind(he(o))),o._canvas=t,o._spriteMaskManager=new tS(he(o));var s=he(o),l=s._spriteDefaultMaterials;o._spriteDefaultMaterial=l[Tt.None]=o._createSpriteMaterial(Tt.None),l[Tt.VisibleInsideMask]=o._createSpriteMaterial(Tt.VisibleInsideMask),l[Tt.VisibleOutsideMask]=o._createSpriteMaterial(Tt.VisibleOutsideMask),o._spriteMaskDefaultMaterial=o._createSpriteMaskMaterial(),o._textDefaultFont=No.createFromOS(he(o),"Arial"),o._textDefaultFont.isGCIgnored=!0,o.inputManager=new vm(he(o),n.input);var c=n.xrDevice;if(c&&(o.xrManager=new gm,o.xrManager._initialize(he(o),c)),o._initMagentaTextures(e),!e.canIUse(J.depthTexture))o._macroCollection.enable(i._noDepthTextureMacro);else{var u=new vr(he(o),1,1,j.Depth16,!1);u.isGCIgnored=!0,o._depthTexture2D=u}var d=new In(he(o),Le.find("unlit"));d.isGCIgnored=!0,d.shaderData.setColor("material_BaseColor",new K(1,0,1.01,1)),o._meshMagentaMaterial=d;var f=new In(he(o),Le.find("particle-shader"));f.isGCIgnored=!0,f.shaderData.setColor("material_BaseColor",new K(1,0,1.01,1)),o._particleMagentaMaterial=f;var h=o._settings,_=n.colorSpace||jr.Linear;return _===jr.Gamma&&o._macroCollection.enable(i._gammaMacro),h.colorSpace=_,o._particleBufferUtils=new yS(he(o)),o}var a=i.prototype;return a.createEntity=function(e){return new hn(this,e)},a.pause=function(){var e;this._isPaused=!0;var n=((e=this.xrManager)==null?void 0:e._getCancelAnimationFrame())||cancelAnimationFrame;n(this._requestId),clearTimeout(this._timeoutId)},a.resume=function(){if(this._isPaused)if(this._isPaused=!1,this.time._reset(),this._vSyncCount){var e,n=((e=this.xrManager)==null?void 0:e._getRequestAnimationFrame())||requestAnimationFrame;this._requestId=n(this._animate)}else this._timeoutId=window.setTimeout(this._animate,this._targetFrameInterval)},a.update=function(){var e,n=this._time;n._update();var o=n.deltaTime;this._frameInProcess=!0,this._renderElementPool.resetPool(),this._renderDataPool.resetPool(),this._spriteRenderDataPool.resetPool(),this._spriteMaskRenderDataPool.resetPool(),this._textRenderDataPool.resetPool(),(e=this.xrManager)==null||e._update();var s=this,l=s.inputManager,c=s._physicsInitialized;l._update();for(var u=this._sceneManager._scenes.getLoopArray(),d=u.length,f=0;f<d;f++){var h=u[f];if(!(!h.isActive||h.destroyed)){var _=h._componentsManager;_.sortCameras(),_.callScriptOnStart()}}if(c)for(var g=0;g<d;g++){var y=u[g];!y.isActive||y.destroyed||y.physics._update(o)}c&&l._firePointerScript(u);for(var v=0;v<d;v++){var p=u[v];!p.isActive||p.destroyed||p._componentsManager.callScriptOnUpdate(o)}for(var m=0;m<d;m++){var A=u[m];!A.isActive||A.destroyed||A._componentsManager.callAnimationUpdate(o)}for(var S=0;S<d;S++){var x=u[S];!x.isActive||x.destroyed||x._componentsManager.callScriptOnLateUpdate(o)}if(this._isDeviceLost||this._render(u),this._waitingDestroy)this._destroy();else for(var b=0;b<d;b++){var C=u[b];!C.isActive||C.destroyed||C._componentsManager.handlingInvalidScripts()}this._waitingGC&&(this._gc(),this._waitingGC=!1),this._frameInProcess=!1},a.run=function(){this.resume(),this.dispatch("run",this)},a.forceLoseDevice=function(){this._hardwareRenderer.forceLoseDevice()},a.forceRestoreDevice=function(){this._hardwareRenderer.forceRestoreDevice()},a._destroy=function(){var e;this._sceneManager._destroyAllScene(),this._resourceManager._destroy(),this._textDefaultFont=null,this._fontMap=null,this.inputManager._destroy(),(e=this.xrManager)==null||e._destroy(),this.dispatch("shutdown",this),this.pause(),this._spriteMaskManager.destroy(),this._hardwareRenderer.destroy(),this.removeAllEventListeners(),this._animate=null,this._sceneManager=null,this._resourceManager=null,this._canvas=null,this._time=null,this._waitingDestroy=!1,this._destroyed=!0},a.destroy=function(){this._destroyed||(this._frameInProcess?this._waitingDestroy=!0:this._destroy())},a._getShaderProgramPool=function(e){var n=e._shaderPassId,o=this._shaderProgramPools,s=o[n];if(!s){var l=n+1;l>o.length&&(o.length=l),o[n]=s=new HS,e._shaderProgramPools.push(s)}return s},a._render=function(e){for(var n=function(h,_){var g=e[h];if(!g.isActive||g.destroyed)return"continue";var y=g._componentsManager._activeCameras;if(y.length===0)return me.debug("No active camera in scene."),"continue";y.forEach(function(v){var p=g._componentsManager;p.callCameraOnBeginRender(v),v.render(),p.callCameraOnEndRender(v),o._hardwareRenderer._options._forceFlush&&o._hardwareRenderer.flush()},function(v,p){v._cameraIndex=p})},o=this,s=this.time.deltaTime,l=0,c=e.length;l<c;l++){var u=e[l];!u.isActive||u.destroyed||(u._componentsManager.callRendererOnUpdate(s),u._updateShaderData())}for(var d=0,f=e.length;d<f;d++)n(d)},a._initMagentaTextures=function(e){var n=new Uint8Array([255,255,255,255]),o=new vr(this,1,1,j.R8G8B8A8,!1);o.setPixelBuffer(n),o.isGCIgnored=!0;var s=new Uint8Array([255,0,255,255]),l=new vr(this,1,1,j.R8G8B8A8,!1);l.setPixelBuffer(s),l.isGCIgnored=!0,this.resourceManager.addContentRestorer(new(function(f){W(h,f);function h(){return f.call(this,l)}var _=h.prototype;return _.restoreContent=function(){this.resource.setPixelBuffer(s)},h}(Ai)));for(var c=new Rr(this,1,j.R8G8B8A8,!1),u=0;u<6;u++)c.setPixelBuffer(yn.PositiveX+u,s);if(c.isGCIgnored=!0,this.resourceManager.addContentRestorer(new(function(f){W(h,f);function h(){return f.call(this,c)}var _=h.prototype;return _.restoreContent=function(){for(var y=0;y<6;y++)this.resource.setPixelBuffer(yn.PositiveX+y,s)},h}(Ai))),this._whiteTexture2D=o,this._magentaTexture2D=l,this._magentaTextureCube=c,e.isWebGL2){var d=new Fh(this,1,1,1,j.R8G8B8A8,!1);d.setPixelBuffer(0,s),d.isGCIgnored=!0,this.resourceManager.addContentRestorer(new(function(f){W(h,f);function h(){return f.call(this,d)}var _=h.prototype;return _.restoreContent=function(){this.resource.setPixelBuffer(0,s)},h}(Ai))),this._magentaTexture2DArray=d}},a._pendingGC=function(){this._frameInProcess?this._waitingGC=!0:this._gc()},a._initialize=function(e){var n=this,o=e.shaderLab,s=e.physics;o&&(Le._shaderLab=o);var l=new Array;s&&l.push(s.initialize().then(function(){return Cr._nativePhysics=s,n._nativePhysicsManager=s.createPhysicsManager(),n._physicsInitialized=!0,n}));var c=Vo._loaders;for(var u in c){var d=c[u];d.initialize&&l.push(d.initialize(this,e))}return Promise.all(l).then(function(){return n})},a._createSpriteMaterial=function(e){var n=new In(this,Le.find("Sprite")),o=n.renderState,s=o.blendState.targetBlendState;if(s.enabled=!0,s.sourceColorBlendFactor=Ee.SourceAlpha,s.destinationColorBlendFactor=Ee.OneMinusSourceAlpha,s.sourceAlphaBlendFactor=Ee.One,s.destinationAlphaBlendFactor=Ee.OneMinusSourceAlpha,s.colorBlendOperation=s.alphaBlendOperation=fr.Add,e!==Tt.None){var l=o.stencilState;l.enabled=!0,l.writeMask=0,l.referenceValue=1;var c=e===Tt.VisibleInsideMask?Te.LessEqual:Te.Greater;l.compareFunctionFront=c,l.compareFunctionBack=c}return o.depthState.writeEnabled=!1,o.rasterState.cullMode=Mr.Off,o.renderQueueType=Dt.Transparent,n.isGCIgnored=!0,n},a._createSpriteMaskMaterial=function(){var e=new In(this,Le.find("SpriteMask")),n=e.renderState;return n.blendState.targetBlendState.colorWriteMask=dn.None,n.rasterState.cullMode=Mr.Off,n.stencilState.enabled=!0,n.depthState.enabled=!1,e.isGCIgnored=!0,e},a._onDeviceLost=function(){this._isDeviceLost=!0,this.resourceManager._lostGraphicResources(),console.log("Device lost."),this.dispatch("devicelost",this)},a._onDeviceRestored=function(){var e=this;this._hardwareRenderer.resetState(),this._lastRenderState=new $n,this._shaderProgramPools.length=0;var n=this.resourceManager;n._restoreGraphicResources(),console.log("Graphic resource restored."),this._particleBufferUtils.setBufferData(),n._restoreResourcesContent().then(function(){console.log(`Graphic resource content restored.

Device restored.`),e.dispatch("devicerestored",e),e._isDeviceLost=!1}).catch(function(o){console.error(o)})},a._gc=function(){this._renderElementPool.garbageCollection(),this._renderDataPool.garbageCollection(),this._spriteRenderDataPool.garbageCollection(),this._spriteMaskRenderDataPool.garbageCollection(),this._textRenderDataPool.garbageCollection()},q(i,[{key:"settings",get:function(){return this._settings}},{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}},{key:"destroyed",get:function(){return this._destroyed}},{key:"physicsManager",get:function(){var e;return(e=this.sceneManager.scenes[0])==null?void 0:e.physics}}]),i}(Mh);(function(){ei._gammaMacro=se.getByName("ENGINE_IS_COLORSPACE_GAMMA")})();(function(){ei._noDepthTextureMacro=se.getByName("ENGINE_NO_DEPTH_TEXTURE")})();(function(){ei._pixelsPerUnit=100})();var mm=function(){function r(){this._sizeUpdateFlagManager=new On}return q(r,[{key:"width",get:function(){return this._width},set:function(a){this._width!==a&&(this._width=a,this._sizeUpdateFlagManager.dispatch(),this._onSizeChanged(a,this._width))}},{key:"height",get:function(){return this._height},set:function(a){this._height!==a&&(this._height=a,this._sizeUpdateFlagManager.dispatch(),this._onSizeChanged(this._width,a))}}]),r}(),Si;(function(r){r[r.SolidColor=0]="SolidColor",r[r.Sky=1]="Sky",r[r.Texture=2]="Texture"})(Si||(Si={}));var Xi;(function(r){r[r.AspectFitWidth=0]="AspectFitWidth",r[r.AspectFitHeight=1]="AspectFitHeight",r[r.Fill=2]="Fill"})(Xi||(Xi={}));var Oo=function(){function r(){}var i=r.prototype;return i.destroy=function(){this.mesh=null,this.material=null},i._render=function(t){var e=this,n=e.material,o=e.mesh;if(!n){me.warn("The material of sky is not defined.");return}if(n.destroyed){me.warn("The material of sky is destroyed.");return}if(!o){me.warn("The mesh of sky is not defined.");return}if(o.destroyed){me.warn("The mesh of sky is destroyed.");return}var s=t.camera,l=s.engine,c=s.scene,u=s.aspectRatio,d=s.fieldOfView,f=s.viewMatrix,h=s.shaderData,_=c.shaderData,g=r._viewProjMatrix,y=r._projectionMatrix,v=l._hardwareRenderer,p=n.shaderData,m=n.shader,A=n.renderState;g.copyFrom(f);var S=g.elements;S[12]=S[13]=S[14]=0;var x=1/Math.tan(U.degreeToRadian(d)/2);y.elements[0]=x/u,y.elements[5]=x,$.multiply(y,g,g);var b=h.getMatrix(xi.vpMatrixProperty);h.setMatrix(xi.vpMatrixProperty,g);var C=Le._compileMacros;Ir.unionCollection(t.camera._globalShaderMacro,p._macroCollection,C);var w=m.subShaders[0].passes[0],E=w._getShaderProgram(l,C);E.bind(),E.groupingOtherUniformBlock(),E.uploadAll(E.sceneUniformBlock,_),E.uploadAll(E.cameraUniformBlock,h),E.uploadAll(E.materialUniformBlock,p),E.uploadUnGroupTextures(),A._apply(l,!1,w._renderStateDataMap,p),v.drawPrimitive(o._primitive,o.subMesh,E),h.setMatrix(xi.vpMatrixProperty,b)},q(r,[{key:"material",get:function(){return this._material},set:function(t){if(this._material!==t){var e,n;(e=t)==null||e._addReferCount(1),(n=this._material)==null||n._addReferCount(-1),this._material=t}}},{key:"mesh",get:function(){return this._mesh},set:function(t){if(this._mesh!==t){var e,n;(e=t)==null||e._addReferCount(1),(n=this._mesh)==null||n._addReferCount(-1),this._mesh=t}}}]),r}();(function(){Oo._epsilon=1e-6})();(function(){Oo._viewProjMatrix=new $})();(function(){Oo._projectionMatrix=new $(1,0,0,0,0,1,0,0,0,0,Oo._epsilon-1,-1,0,0,0,0)})();var ym=function(){function r(a){this._engine=a,this.mode=Si.SolidColor,this.solidColor=new K(.25,.25,.25,1),this.sky=new Oo,this._textureFillMode=Xi.AspectFitHeight,this._texture=null,this._initMesh(a),this._initMaterial(a)}var i=r.prototype;return i.destroy=function(){this.texture=null,this._mesh._addReferCount(-1),this._mesh=null,this._material._addReferCount(-1),this._material=null,this.solidColor=null,this.sky.destroy()},i._resizeBackgroundTexture=function(){var t=this,e=t._texture,n=t._mesh;if(this._texture){var o=this._engine.canvas,s=o.width,l=o.height,c=n.getPositions();switch(this._textureFillMode){case Xi.Fill:c[0].set(-1,-1,1),c[1].set(1,-1,1),c[2].set(-1,1,1),c[3].set(1,1,1);break;case Xi.AspectFitWidth:var u=e.height*s/e.width/l;c[0].set(-1,-u,1),c[1].set(1,-u,1),c[2].set(-1,u,1),c[3].set(1,u,1);break;case Xi.AspectFitHeight:var d=e.width*l/e.height/s;c[0].set(-d,-1,1),c[1].set(d,-1,1),c[2].set(-d,1,1),c[3].set(d,1,1);break}n.setPositions(c),n.uploadData(!1)}},i._initMesh=function(t){this._mesh=this._createPlane(t),this._mesh._addReferCount(1)},i._initMaterial=function(t){var e=this._material=new In(t,Le.find("background-texture"));e.renderState.depthState.compareFunction=Te.LessEqual,e._addReferCount(1)},i._createPlane=function(t){var e=new Nt(t);e.isGCIgnored=!0;for(var n=new Uint8Array([1,2,0,1,3,2]),o=new Array(4),s=new Array(4),l=0;l<4;++l)o[l]=new P,s[l]=new te(l%2,1-(l*.5|0));return e.setPositions(o),e.setUVs(s),e.setIndices(n),e.uploadData(!1),e.addSubMesh(0,n.length),e},q(r,[{key:"texture",get:function(){return this._texture},set:function(t){if(this._texture!==t){var e,n;(e=t)==null||e._addReferCount(1),(n=this._texture)==null||n._addReferCount(-1),this._texture=t,this._material.shaderData.setTexture("material_BaseTexture",t),this._resizeBackgroundTexture()}}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(t){t!==this._textureFillMode&&(this._textureFillMode=t,this._resizeBackgroundTexture())}}]),r}(),WS=function(){function r(){this._cameraNeedSorting=!1,this._activeCameras=new $e,this._renderers=new $e,this._onStartScripts=new $e,this._onUpdateScripts=new $e,this._onLateUpdateScripts=new $e,this._onPhysicsUpdateScripts=new $e,this._pendingDestroyScripts=[],this._disposeDestroyScripts=[],this._onUpdateAnimations=new $e,this._onUpdateRenderers=new $e,this._componentsContainerPool=[]}var i=r.prototype;return i.addCamera=function(t){t._cameraIndex=this._activeCameras.length,this._activeCameras.add(t),this._cameraNeedSorting=!0},i.removeCamera=function(t){var e=this._activeCameras.deleteByIndex(t._cameraIndex);e&&(e._cameraIndex=t._cameraIndex),t._cameraIndex=-1,this._cameraNeedSorting=!0},i.sortCameras=function(){if(this._cameraNeedSorting){var t=this._activeCameras;t.sort(function(o,s){return o.priority-s.priority});for(var e=0,n=t.length;e<n;e++)t.get(e)._cameraIndex=e;this._cameraNeedSorting=!1}},i.addRenderer=function(t){t._rendererIndex=this._renderers.length,this._renderers.add(t)},i.removeRenderer=function(t){var e=this._renderers.deleteByIndex(t._rendererIndex);e&&(e._rendererIndex=t._rendererIndex),t._rendererIndex=-1},i.addOnStartScript=function(t){t._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(t)},i.removeOnStartScript=function(t){var e=this._onStartScripts.deleteByIndex(t._onStartIndex);e&&(e._onStartIndex=t._onStartIndex),t._onStartIndex=-1},i.addOnUpdateScript=function(t){t._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(t)},i.removeOnUpdateScript=function(t){var e=this._onUpdateScripts.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addOnLateUpdateScript=function(t){t._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(t)},i.removeOnLateUpdateScript=function(t){var e=this._onLateUpdateScripts.deleteByIndex(t._onLateUpdateIndex);e&&(e._onLateUpdateIndex=t._onLateUpdateIndex),t._onLateUpdateIndex=-1},i.addOnPhysicsUpdateScript=function(t){t._onPhysicsUpdateIndex=this._onPhysicsUpdateScripts.length,this._onPhysicsUpdateScripts.add(t)},i.removeOnPhysicsUpdateScript=function(t){var e=this._onPhysicsUpdateScripts.deleteByIndex(t._onPhysicsUpdateIndex);e&&(e._onPhysicsUpdateIndex=t._onPhysicsUpdateIndex),t._onPhysicsUpdateIndex=-1},i.addOnUpdateAnimations=function(t){t._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(t)},i.removeOnUpdateAnimations=function(t){var e=this._onUpdateAnimations.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addOnUpdateRenderers=function(t){t._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(t)},i.removeOnUpdateRenderers=function(t){var e=this._onUpdateRenderers.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},i.addPendingDestroyScript=function(t){this._pendingDestroyScripts.push(t)},i.callScriptOnStart=function(){var t=this,e=this._onStartScripts;e.length>0&&e.forEachAndClean(function(n){n._started=!0,t.removeOnStartScript(n),n.onStart()})},i.callScriptOnUpdate=function(t){this._onUpdateScripts.forEach(function(e){e._started&&e.onUpdate(t)},function(e,n){e._onUpdateIndex=n})},i.callScriptOnLateUpdate=function(t){this._onLateUpdateScripts.forEach(function(e){e._started&&e.onLateUpdate(t)},function(e,n){e._onLateUpdateIndex=n})},i.callScriptOnPhysicsUpdate=function(){this._onPhysicsUpdateScripts.forEach(function(t){t._started&&t.onPhysicsUpdate()},function(t,e){t._onPhysicsUpdateIndex=e})},i.callAnimationUpdate=function(t){this._onUpdateAnimations.forEach(function(e){e.engine.time.frameCount>e._playFrameCount&&e.update(t)},function(e,n){e._onUpdateIndex=n})},i.callRendererOnUpdate=function(t){this._onUpdateRenderers.forEach(function(e){e.update(t)},function(e,n){e._onUpdateIndex=n})},i.handlingInvalidScripts=function(){var t=this,e=t._disposeDestroyScripts,n=t._pendingDestroyScripts;this._disposeDestroyScripts=n,this._pendingDestroyScripts=e;var o=n.length;if(o>0){for(var s=o-1;s>=0;s--)n[s].onDestroy();n.length=0}},i.callCameraOnBeginRender=function(t){t.entity._scripts.forEach(function(e){e.onBeginRender(t)},function(e,n){e._entityScriptsIndex=n})},i.callCameraOnEndRender=function(t){t.entity._scripts.forEach(function(e){e.onEndRender(t)},function(e,n){e._entityScriptsIndex=n})},i.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},i.putActiveChangedTempList=function(t){t.length=0,this._componentsContainerPool.push(t)},i._gc=function(){this._renderers.garbageCollection(),this._onStartScripts.garbageCollection(),this._onUpdateScripts.garbageCollection(),this._onLateUpdateScripts.garbageCollection(),this._onPhysicsUpdateScripts.garbageCollection(),this._onUpdateAnimations.garbageCollection(),this._onUpdateRenderers.garbageCollection(),this._activeCameras.garbageCollection()},r}(),Wc;(function(r){r[r.None=0]="None",r[r.Linear=1]="Linear",r[r.Exponential=2]="Exponential",r[r.ExponentialSquared=3]="ExponentialSquared"})(Wc||(Wc={}));var Ha;(function(r){r[r.SolidColor=0]="SolidColor",r[r.SphericalHarmonics=1]="SphericalHarmonics"})(Ha||(Ha={}));var An=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._diffuseSolidColor=new K(.212,.227,.259),e._diffuseIntensity=1,e._specularIntensity=1,e._diffuseMode=Ha.SolidColor,e._shArray=new Float32Array(27),e._scenes=[],e._specularTextureDecodeRGBM=!1,e}var a=i.prototype;return a._addToScene=function(e){this._addReferCount(1),this._scenes.push(e);var n=e.shaderData;n.setColor(i._diffuseColorProperty,this._diffuseSolidColor),n.setFloat(i._diffuseIntensityProperty,this._diffuseIntensity),n.setFloat(i._specularIntensityProperty,this._specularIntensity),n.setFloatArray(i._diffuseSHProperty,this._shArray),this._setDiffuseMode(n),this._setSpecularTextureDecodeRGBM(n),this._setSpecularTexture(n)},a._removeFromScene=function(e){this._addReferCount(-1);var n=this._scenes,o=n.indexOf(e);n.splice(o,1);var s=e.shaderData;s.setTexture(i._specularTextureProperty,null),s.disableMacro(i._specularMacro)},a._setDiffuseMode=function(e){this._diffuseMode===Ha.SphericalHarmonics?e.enableMacro(i._shMacro):e.disableMacro(i._shMacro)},a._setSpecularTexture=function(e){this._specularTexture?(e.setTexture(i._specularTextureProperty,this._specularTexture),e.setFloat(i._mipLevelProperty,this._specularTexture.mipmapCount-1),e.enableMacro(i._specularMacro)):e.disableMacro(i._specularMacro)},a._setSpecularTextureDecodeRGBM=function(e){this._specularTextureDecodeRGBM?e.enableMacro(i._decodeRGBMMacro):e.disableMacro(i._decodeRGBMMacro)},a._preComputeSH=function(e,n){var o=e.coefficients;n[0]=o[0]*.886227,n[1]=o[1]*.886227,n[2]=o[2]*.886227,n[3]=o[3]*-1.023327,n[4]=o[4]*-1.023327,n[5]=o[5]*-1.023327,n[6]=o[6]*1.023327,n[7]=o[7]*1.023327,n[8]=o[8]*1.023327,n[9]=o[9]*-1.023327,n[10]=o[10]*-1.023327,n[11]=o[11]*-1.023327,n[12]=o[12]*.858086,n[13]=o[13]*.858086,n[14]=o[14]*.858086,n[15]=o[15]*-.858086,n[16]=o[16]*-.858086,n[17]=o[17]*-.858086,n[18]=o[18]*.247708,n[19]=o[19]*.247708,n[20]=o[20]*.247708,n[21]=o[21]*-.858086,n[22]=o[22]*-.858086,n[23]=o[23]*-.858086,n[24]=o[24]*.429042,n[25]=o[25]*.429042,n[26]=o[26]*.429042},q(i,[{key:"specularTextureDecodeRGBM",get:function(){return this._specularTextureDecodeRGBM},set:function(e){this._specularTextureDecodeRGBM=e;for(var n=this._scenes,o=0,s=n.length;o<s;o++)this._setSpecularTextureDecodeRGBM(n[o].shaderData)}},{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(e){this._diffuseMode=e;for(var n=this._scenes,o=0,s=n.length;o<s;o++)this._setDiffuseMode(n[o].shaderData)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(e){e!==this._diffuseSolidColor&&this._diffuseSolidColor.copyFrom(e)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(e){if(this._diffuseSphericalHarmonics=e,e){this._preComputeSH(e,this._shArray);for(var n=this._scenes,o=0,s=n.length;o<s;o++)n[o].shaderData.setFloatArray(i._diffuseSHProperty,this._shArray)}}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(e){this._diffuseIntensity=e;for(var n=this._scenes,o=0,s=n.length;o<s;o++)n[o].shaderData.setFloat(i._diffuseIntensityProperty,e)}},{key:"specularTexture",get:function(){return this._specularTexture},set:function(e){this._specularTexture=e;for(var n=this._scenes,o=0,s=n.length;o<s;o++)this._setSpecularTexture(n[o].shaderData)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(e){this._specularIntensity=e;for(var n=0,o=this._scenes.length;n<o;n++)this._scenes[n].shaderData.setFloat(i._specularIntensityProperty,e)}}]),i}(ni);(function(){An._shMacro=se.getByName("SCENE_USE_SH")})();(function(){An._specularMacro=se.getByName("SCENE_USE_SPECULAR_ENV")})();(function(){An._decodeRGBMMacro=se.getByName("SCENE_IS_DECODE_ENV_RGBM")})();(function(){An._diffuseColorProperty=k.getByName("scene_EnvMapLight.diffuse")})();(function(){An._diffuseSHProperty=k.getByName("scene_EnvSH")})();(function(){An._diffuseIntensityProperty=k.getByName("scene_EnvMapLight.diffuseIntensity")})();(function(){An._specularTextureProperty=k.getByName("scene_EnvSpecularSampler")})();(function(){An._specularIntensityProperty=k.getByName("scene_EnvMapLight.specularIntensity")})();(function(){An._mipLevelProperty=k.getByName("scene_EnvMapLight.mipMapLevel")})();var on;(function(r){r[r.NoCascades=1]="NoCascades",r[r.TwoCascades=2]="TwoCascades",r[r.FourCascades=4]="FourCascades"})(on||(on={}));var Yi;(function(r){r[r.Low=0]="Low",r[r.Medium=1]="Medium",r[r.High=2]="High",r[r.VeryHigh=3]="VeryHigh"})(Yi||(Yi={}));var Pi;(function(r){r[r.None=0]="None",r[r.Hard=1]="Hard",r[r.SoftLow=2]="SoftLow",r[r.SoftHigh=3]="SoftHigh"})(Pi||(Pi={}));var ll=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.intensity=1,t.cullingMask=Kr.Everything,t.shadowType=Pi.None,t.shadowBias=1,t.shadowNormalBias=1,t.shadowNearPlane=.1,t.shadowStrength=1,t._lightIndex=-1,t._lightColor=new K,t._color=new K(1,1,1,1),t}var a=i.prototype;return a._getLightIntensityColor=function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor},q(i,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new $),$.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new $),$.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),i}(ir);R([z],ll.prototype,"_lightIndex",void 0);var Wa=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t._reverseDirection=new P,t}var a=i.prototype;return a._appendData=function(e,n){var o=e*2,s=e*3,l=e*3,c=this._getLightIntensityColor(),u=this.direction,d=this.cullingMask;n.cullingMask[o]=d&65535,n.cullingMask[o+1]=d>>>16&65535,this.engine.settings.colorSpace===jr.Linear?(n.color[s]=K.gammaToLinearSpace(c.r),n.color[s+1]=K.gammaToLinearSpace(c.g),n.color[s+2]=K.gammaToLinearSpace(c.b)):(n.color[s]=c.r,n.color[s+1]=c.g,n.color[s+2]=c.b),n.direction[l]=u.x,n.direction[l+1]=u.y,n.direction[l+2]=u.z},a._onEnableInScene=function(){this.scene._lightManager._attachDirectLight(this)},a._onDisableInScene=function(){this.scene._lightManager._detachDirectLight(this)},i._updateShaderData=function(e,n){e.setIntArray(i._cullingMaskProperty,n.cullingMask),e.setFloatArray(i._colorProperty,n.color),e.setFloatArray(i._directionProperty,n.direction)},q(i,[{key:"direction",get:function(){return this.entity.transform.worldForward}},{key:"reverseDirection",get:function(){return P.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}},{key:"_shadowProjectionMatrix",get:function(){throw"Unknown!"}}]),i}(ll);(function(){Wa._cullingMaskProperty=k.getByName("scene_DirectLightCullingMask")})();(function(){Wa._colorProperty=k.getByName("scene_DirectLightColor")})();(function(){Wa._directionProperty=k.getByName("scene_DirectLightDirection")})();var Xa=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.distance=100,t}var a=i.prototype;return a._appendData=function(e,n){var o=e*2,s=e*3,l=e*3,c=e,u=this._getLightIntensityColor(),d=this.position,f=this.cullingMask;n.cullingMask[o]=f&65535,n.cullingMask[o+1]=f>>>16&65535,this.engine.settings.colorSpace===jr.Linear?(n.color[s]=K.gammaToLinearSpace(u.r),n.color[s+1]=K.gammaToLinearSpace(u.g),n.color[s+2]=K.gammaToLinearSpace(u.b)):(n.color[s]=u.r,n.color[s+1]=u.g,n.color[s+2]=u.b),n.position[l]=d.x,n.position[l+1]=d.y,n.position[l+2]=d.z,n.distance[c]=this.distance},a._onEnableInScene=function(){this.scene._lightManager._attachPointLight(this)},a._onDisableInScene=function(){this.scene._lightManager._detachPointLight(this)},i._updateShaderData=function(e,n){e.setIntArray(i._cullingMaskProperty,n.cullingMask),e.setFloatArray(i._colorProperty,n.color),e.setFloatArray(i._positionProperty,n.position),e.setFloatArray(i._distanceProperty,n.distance)},q(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"_shadowProjectionMatrix",get:function(){throw"Unknown!"}}]),i}(ll);(function(){Xa._cullingMaskProperty=k.getByName("scene_PointLightCullingMask")})();(function(){Xa._colorProperty=k.getByName("scene_PointLightColor")})();(function(){Xa._positionProperty=k.getByName("scene_PointLightPosition")})();(function(){Xa._distanceProperty=k.getByName("scene_PointLightDistance")})();var kn=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.distance=100,t.angle=Math.PI/6,t.penumbra=Math.PI/12,t._inverseDirection=new P,t._projectMatrix=new $,t}var a=i.prototype;return a._appendData=function(e,n){var o=e*2,s=e*3,l=e*3,c=e*3,u=e,d=e,f=e,h=this._getLightIntensityColor(),_=this.position,g=this.direction,y=this.cullingMask;n.cullingMask[o]=y&65535,n.cullingMask[o+1]=y>>>16&65535,this.engine.settings.colorSpace===jr.Linear?(n.color[s]=K.gammaToLinearSpace(h.r),n.color[s+1]=K.gammaToLinearSpace(h.g),n.color[s+2]=K.gammaToLinearSpace(h.b)):(n.color[s]=h.r,n.color[s+1]=h.g,n.color[s+2]=h.b),n.position[l]=_.x,n.position[l+1]=_.y,n.position[l+2]=_.z,n.direction[c]=g.x,n.direction[c+1]=g.y,n.direction[c+2]=g.z,n.distance[u]=this.distance,n.angleCos[f]=Math.cos(this.angle),n.penumbraCos[d]=Math.cos(this.angle+this.penumbra)},a._onEnableInScene=function(){this.scene._lightManager._attachSpotLight(this)},a._onDisableInScene=function(){this.scene._lightManager._detachSpotLight(this)},i._updateShaderData=function(e,n){e.setIntArray(i._cullingMaskProperty,n.cullingMask),e.setFloatArray(i._colorProperty,n.color),e.setFloatArray(i._positionProperty,n.position),e.setFloatArray(i._directionProperty,n.direction),e.setFloatArray(i._distanceProperty,n.distance),e.setFloatArray(i._angleCosProperty,n.angleCos),e.setFloatArray(i._penumbraCosProperty,n.penumbraCos)},q(i,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.worldForward}},{key:"reverseDirection",get:function(){return P.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"_shadowProjectionMatrix",get:function(){var e=this._projectMatrix,n=Math.min(Math.PI/2,this.angle*2*Math.sqrt(2));return $.perspective(n,1,this.shadowNearPlane,this.distance+this.shadowNearPlane,e),e}}]),i}(ll);(function(){kn._cullingMaskProperty=k.getByName("scene_SpotLightCullingMask")})();(function(){kn._colorProperty=k.getByName("scene_SpotLightColor")})();(function(){kn._positionProperty=k.getByName("scene_SpotLightPosition")})();(function(){kn._directionProperty=k.getByName("scene_SpotLightDirection")})();(function(){kn._distanceProperty=k.getByName("scene_SpotLightDistance")})();(function(){kn._angleCosProperty=k.getByName("scene_SpotLightAngleCos")})();(function(){kn._penumbraCosProperty=k.getByName("scene_SpotLightPenumbraCos")})();var Ra=function(){function r(){this._spotLights=new $e,this._pointLights=new $e,this._directLights=new $e,this._directData={cullingMask:new Int32Array(r._maxLight*2),color:new Float32Array(r._maxLight*3),direction:new Float32Array(r._maxLight*3)},this._pointData={cullingMask:new Int32Array(r._maxLight*2),color:new Float32Array(r._maxLight*3),position:new Float32Array(r._maxLight*3),distance:new Float32Array(r._maxLight)},this._spotData={cullingMask:new Int32Array(r._maxLight*2),color:new Float32Array(r._maxLight*3),position:new Float32Array(r._maxLight*3),direction:new Float32Array(r._maxLight*3),distance:new Float32Array(r._maxLight),angleCos:new Float32Array(r._maxLight),penumbraCos:new Float32Array(r._maxLight)}}var i=r.prototype;return i._attachSpotLight=function(t){t._lightIndex=this._spotLights.length,this._spotLights.add(t)},i._detachSpotLight=function(t){var e=this._spotLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._attachPointLight=function(t){t._lightIndex=this._pointLights.length,this._pointLights.add(t)},i._detachPointLight=function(t){var e=this._pointLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._attachDirectLight=function(t){t._lightIndex=this._directLights.length,this._directLights.add(t)},i._detachDirectLight=function(t){var e=this._directLights.deleteByIndex(t._lightIndex);e&&(e._lightIndex=t._lightIndex),t._lightIndex=-1},i._updateShaderData=function(t){for(var e=this,n=e._spotLights,o=e._pointLights,s=e._directLights,l=this,c=l._spotData,u=l._pointData,d=l._directData,f=n.length,h=o.length,_=s.length,g=0;g<f;g++)n.get(g)._appendData(g,c);for(var y=0;y<h;y++)o.get(y)._appendData(y,u);for(var v=0;v<_;v++)s.get(v)._appendData(v,d);_?(Wa._updateShaderData(t,d),t.enableMacro("SCENE_DIRECT_LIGHT_COUNT",_.toString())):t.disableMacro("SCENE_DIRECT_LIGHT_COUNT"),h?(Xa._updateShaderData(t,u),t.enableMacro("SCENE_POINT_LIGHT_COUNT",h.toString())):t.disableMacro("SCENE_POINT_LIGHT_COUNT"),f?(kn._updateShaderData(t,c),t.enableMacro("SCENE_SPOT_LIGHT_COUNT",f.toString())):t.disableMacro("SCENE_SPOT_LIGHT_COUNT")},i._gc=function(){this._spotLights.garbageCollection(),this._pointLights.garbageCollection(),this._directLights.garbageCollection()},i._updateSunlightIndex=function(t){var e=this._directLights,n=t._lightIndex;if(n>0){var o=e.get(0),s=e.get(n);e.set(0,s),e.set(n,o),s._lightIndex=0,o._lightIndex=n}},i._getMaxBrightestSunlight=function(){for(var t=this._directLights,e=null,n=Number.NEGATIVE_INFINITY,o=!1,s=0,l=t.length;s<l;s++){var c=t.get(s);c.shadowType!==Pi.None&&!o&&(n=Number.NEGATIVE_INFINITY,o=!0);var u=c.intensity*c.color.getBrightness();o?c.shadowType!==Pi.None&&n<u&&(n=u,e=c):n<u&&(n=u,e=c)}return e},r}();(function(){Ra._sunlightColorProperty=k.getByName("scene_SunlightColor")})();(function(){Ra._sunlightDirectionProperty=k.getByName("scene_SunlightDirection")})();(function(){Ra._maxLight=10})();var cl=function(r){W(i,r);function i(t,e){var n;n=r.call(this,t)||this,n.physics=new Cr(he(n)),n.castShadows=!0,n.shadowResolution=Yi.Medium,n.shadowTwoCascadeSplits=1/3,n.shadowFourCascadeSplits=new P(1/15,3/15,7/15),n.shadowDistance=50,n.shadowFadeBorder=.1,n._lightManager=new Ra,n._componentsManager=new WS,n._isActiveInEngine=!1,n._globalShaderMacro=new Ir,n._rootEntities=[],n._background=new ym(n._engine),n._shaderData=new ii(Dn.Scene),n._shadowCascades=on.NoCascades,n._fogMode=Wc.None,n._fogColor=new K(.5,.5,.5,1),n._fogStart=0,n._fogEnd=300,n._fogDensity=.01,n._fogParams=new ue,n._isActive=!0,n.name=e||"";var o=n.shaderData;return o._addReferCount(1),n.ambientLight=new An(t),t.sceneManager._allCreatedScenes.push(he(n)),o.enableMacro("SCENE_FOG_MODE",n._fogMode.toString()),o.enableMacro("SCENE_SHADOW_CASCADED_COUNT",n.shadowCascades.toString()),o.setColor(i._fogColorProperty,n._fogColor),o.setVector4(i._fogParamsProperty,n._fogParams),n._computeLinearFogParams(n._fogStart,n._fogEnd),n._computeExponentialFogParams(n._fogDensity),n}var a=i.prototype;return a.createRootEntity=function(e){var n=new hn(this._engine,e);return this.addRootEntity(n),n},a.addRootEntity=function(e,n){var o;typeof e=="number"?o=e:(o=void 0,n=e);var s=n._isRoot;s||(n._isRoot=!0,n._removeFromParent());var l=n._scene;l!==this?(l&&s&&l._removeFromEntityList(n),this._addToRootEntityList(o,n)):s||this._addToRootEntityList(o,n);var c=_e.None;n._isActiveInHierarchy&&(this._isActiveInEngine||(c|=_e.Hierarchy)),n._isActiveInScene&&l!==this&&(c|=_e.Scene),c&&n._processInActive(c),l!==this&&hn._traverseSetOwnerScene(n,this);var u=_e.None;n._isActive&&(this._isActiveInEngine&&!n._isActiveInHierarchy&&(u|=_e.Hierarchy),(!n._isActiveInScene||l!==this)&&(u|=_e.Scene)),u&&n._processActive(u)},a.removeRootEntity=function(e){if(e._isRoot&&e._scene==this){this._removeFromEntityList(e),e._isRoot=!1;var n=_e.None;this._isActiveInEngine&&e._isActiveInHierarchy&&(n|=_e.Hierarchy),e._isActiveInScene&&(n|=_e.Scene),n&&e._processInActive(n),hn._traverseSetOwnerScene(e,null)}},a.getRootEntity=function(e){return e===void 0&&(e=0),this._rootEntities[e]},a.findEntityByName=function(e){for(var n=this._rootEntities,o=0,s=n.length;o<s;o++){var l=n[o].findByName(e);if(l)return l}return null},a.findEntityByPath=function(e){for(var n=e.split("/").filter(Boolean),o=0,s=this.rootEntitiesCount;o<s;o++){var l=this.getRootEntity(o);if(l.name==n[0]){for(var c=1,u=n.length;c<u&&(l=hn._findChildByName(l,n[c]),!!l);++c);return l}}return null},a._processActive=function(e){this._isActiveInEngine=e;for(var n=this._rootEntities,o=n.length-1;o>=0;o--){var s=n[o];s._isActive&&(e?s._processActive(_e.Hierarchy):s._processInActive(_e.Hierarchy))}},a._updateShaderData=function(){var e=this.shaderData,n=this._engine,o=this._lightManager;n.time._updateSceneShaderData(e),o._updateShaderData(this.shaderData);var s=this._lightManager._sunlight=this._getSunlight();s?(o._updateSunlightIndex(s),e.setColor(Ra._sunlightColorProperty,s._lightColor),e.setVector3(Ra._sunlightDirectionProperty,s.direction)):e.setVector3(Ra._sunlightDirectionProperty,P._zero),this.castShadows&&s&&s.shadowType!==Pi.None?e.enableMacro("SCENE_SHADOW_TYPE",s.shadowType.toString()):e.disableMacro("SCENE_SHADOW_TYPE"),Ir.unionCollection(this.engine._macroCollection,e._macroCollection,this._globalShaderMacro)},a._removeFromEntityList=function(e){var n=this._rootEntities,o=e._siblingIndex;n.splice(o,1);for(var s=n.length;o<s;o++)n[o]._siblingIndex--;e._siblingIndex=-1},a._onDestroy=function(){r.prototype._onDestroy.call(this);var e=this._engine.sceneManager;for(e.removeScene(this);this.rootEntitiesCount>0;)this._rootEntities[0].destroy();this.background.destroy(),this._ambientLight&&this._ambientLight._removeFromScene(this),this.shaderData._addReferCount(-1),this._componentsManager.handlingInvalidScripts();var n=e._allCreatedScenes;n.splice(n.indexOf(this),1)},a._addToRootEntityList=function(e,n){var o=this._rootEntities,s=o.length;if(e===void 0)n._siblingIndex=s,o.push(n);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;n._siblingIndex=e,o.splice(e,0,n);for(var l=e+1,c=s+1;l<c;l++)o[l]._siblingIndex++}},a._computeLinearFogParams=function(e,n){var o=n-e,s=this._fogParams;s.x=-1/o,s.y=n/o},a._computeExponentialFogParams=function(e){this._fogParams.z=e/Math.LN2,this._fogParams.w=e/Math.sqrt(Math.LN2)},a._getSunlight=function(){var e=null;return this._sun?e=this._sun.enabled?this._sun:null:e=this._lightManager._getMaxBrightestSunlight(),e},q(i,[{key:"isActive",get:function(){return this._isActive},set:function(e){this._isActive!==e&&(this._isActive=e,e?this._sceneManager&&this._processActive(!0):this._sceneManager&&this._processActive(!1))}},{key:"shaderData",get:function(){return this._shaderData}},{key:"background",get:function(){return this._background}},{key:"shadowCascades",get:function(){return this._shadowCascades},set:function(e){this._shadowCascades!==e&&(this.shaderData.enableMacro("SCENE_SHADOW_CASCADED_COUNT",e.toString()),this._shadowCascades=e)}},{key:"ambientLight",get:function(){return this._ambientLight},set:function(e){if(!e){me.warn("The scene must have one ambient light");return}var n=this._ambientLight;n!==e&&(n&&n._removeFromScene(this),e._addToScene(this),this._ambientLight=e)}},{key:"fogMode",get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this.shaderData.enableMacro("SCENE_FOG_MODE",e.toString()),this._fogMode=e)}},{key:"fogColor",get:function(){return this._fogColor},set:function(e){this._fogColor!==e&&this._fogColor.copyFrom(e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart!==e&&(this._computeLinearFogParams(e,this._fogEnd),this._fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd!==e&&(this._computeLinearFogParams(this._fogStart,e),this._fogEnd=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity!==e&&(this._computeExponentialFogParams(e),this._fogDensity=e)}},{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}},{key:"sun",get:function(){return this._sun},set:function(e){this._sun=e}}]),i}(ri);(function(){cl._fogColorProperty=k.getByName("scene_FogColor")})();(function(){cl._fogParamsProperty=k.getByName("scene_FogParams")})();var Bt=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t._started=!1,t._onStartIndex=-1,t._onUpdateIndex=-1,t._onLateUpdateIndex=-1,t._onPhysicsUpdateIndex=-1,t._onPreRenderIndex=-1,t._onPostRenderIndex=-1,t._entityScriptsIndex=-1,t}var a=i.prototype;return a.onAwake=function(){},a.onEnable=function(){},a.onStart=function(){},a.onUpdate=function(e){},a.onLateUpdate=function(e){},a.onBeginRender=function(e){},a.onEndRender=function(e){},a.onPhysicsUpdate=function(){},a.onTriggerEnter=function(e){},a.onTriggerExit=function(e){},a.onTriggerStay=function(e){},a.onCollisionEnter=function(e){},a.onCollisionExit=function(e){},a.onCollisionStay=function(e){},a.onPointerDown=function(e){},a.onPointerUp=function(e){},a.onPointerClick=function(e){},a.onPointerEnter=function(e){},a.onPointerExit=function(e){},a.onPointerDrag=function(e){},a.onDisable=function(){},a.onDestroy=function(){},a._onAwake=function(){this.onAwake()},a._onEnable=function(){this.onEnable()},a._onDisable=function(){this.onDisable()},a._onEnableInScene=function(){var e=this.scene,n=e._componentsManager,o=i.prototype;this._started||n.addOnStartScript(this),this.onUpdate!==o.onUpdate&&n.addOnUpdateScript(this),this.onLateUpdate!==o.onLateUpdate&&n.addOnLateUpdateScript(this),this.onPhysicsUpdate!==o.onPhysicsUpdate&&n.addOnPhysicsUpdateScript(this),this._entity._addScript(this)},a._onDisableInScene=function(){var e=this.scene._componentsManager,n=i.prototype;this._started||e.removeOnStartScript(this),this.onUpdate!==n.onUpdate&&e.removeOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.removeOnLateUpdateScript(this),this.onPhysicsUpdate!==n.onPhysicsUpdate&&e.removeOnPhysicsUpdateScript(this),this._entity._removeScript(this)},a._onDestroy=function(){r.prototype._onDestroy.call(this),this.scene?this.scene._componentsManager.addPendingDestroyScript(this):this.onDestroy()},i}(ir);R([z],Bt.prototype,"_started",void 0);R([z],Bt.prototype,"_onStartIndex",void 0);R([z],Bt.prototype,"_onUpdateIndex",void 0);R([z],Bt.prototype,"_onLateUpdateIndex",void 0);R([z],Bt.prototype,"_onPhysicsUpdateIndex",void 0);R([z],Bt.prototype,"_onPreRenderIndex",void 0);R([z],Bt.prototype,"_onPostRenderIndex",void 0);R([z],Bt.prototype,"_entityScriptsIndex",void 0);var Ys;(function(r){r[r.None=0]="None",r[r.PrePass=1]="PrePass"})(Ys||(Ys={}));var Am=function(i){this._engine=i},yf=function(){function r(){}return r.recreateTextureIfNeeded=function(a,t,e,n,o,s){if(t)if(t.width!==e||t.height!==n||t.format!==o||t.mipmapCount>1!==s){t.destroy();var l=new vr(a,e,n,o,s);return l.isGCIgnored=!0,l}else return t;else{var c=new vr(a,e,n,o,s);return c.isGCIgnored=!0,c}},r.recreateRenderTargetIfNeeded=function(a,t,e,n,o,s,l){var c,u,d=(c=t)==null?void 0:c.getColorTexture(0),f=(u=t)==null?void 0:u.depthTexture,h=o?r.recreateTextureIfNeeded(a,d,e,n,o,l):null,_=s?r.recreateTextureIfNeeded(a,f,e,n,s,l):null;if(d!==h||f!==_){var g;(g=t)==null||g.destroy(),t=new zc(a,e,n,h,_),t.isGCIgnored=!0}return t},r}(),xm=function(r){W(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createVertexElements=function(e){return e[0]=new De("POSITION",0,ie.Vector3,0),e[1]=new De("TEXCOORD_0",12,ie.Vector2,0),e[2]=new De("COLOR_0",20,ie.Vector4,0),36},a.canBatch=function(e,n){if(!this._engine._canSpriteBatch||n.shaderPasses[0].getTagValue(Ln._disableBatchTag)===!0)return!1;var o=e.data,s=n.data,l=o.component,c=s.component;return!this.checkBatchWithMask(l,c)||o.texture!==s.texture?!1:o.material===s.material},a.checkBatchWithMask=function(e,n){var o=e.maskInteraction;return o!==n.maskInteraction?!1:o===Tt.None?!0:e.maskLayer===n.maskLayer},a.updateVertices=function(e,n,o){for(var s=e.verticesData,l=s.positions,c=s.uvs,u=s.color,d=s.vertexCount,f=0;f<d;f++){var h=l[f],_=c[f];n[o++]=h.x,n[o++]=h.y,n[o++]=h.z,n[o++]=_.x,n[o++]=_.y,n[o++]=u.r,n[o++]=u.g,n[o++]=u.b,n[o++]=u.a}return o},a.drawBatches=function(e){for(var n=this,o=n._engine,s=n._batchedQueue,l=this._meshes[this._flushId],c=l.subMeshes,u=l._primitive,d=o._spriteMaskManager,f=e.scene.shaderData,h=e.shaderData,_=0,g=c.length;_<g;_++){var y=c[_],v=s[_],p=v.data;if(!y||!v)return;var m=p.component,A=p.material;d.preRender(e,m);var S=Le._compileMacros;Ir.unionCollection(m._globalShaderMacro,A.shaderData._macroCollection,S);var x=v.shaderPasses[0],b=x._getShaderProgram(o,S);if(!b.isValid)return;m.shaderData.setTexture(i._textureProperty,p.texture),b.bind(),b.groupingOtherUniformBlock(),b.uploadAll(b.sceneUniformBlock,f),b.uploadAll(b.cameraUniformBlock,h),b.uploadAll(b.rendererUniformBlock,m.shaderData),b.uploadAll(b.materialUniformBlock,A.shaderData),A.renderState._apply(o,!1,x._renderStateDataMap,A.shaderData),o._hardwareRenderer.drawPrimitive(u,y,b),d.postRender(m)}},a.destroy=function(){this._batchedQueue=null;for(var e=this,n=e._meshes,o=e._vertexBuffers,s=e._indiceBuffers,l=0,c=n.length;l<c;++l)n[l].destroy();this._meshes=null;for(var u=0,d=o.length;u<d;++u)o[u].destroy();this._vertexBuffers=null;for(var f=0,h=s.length;f<h;++f)s[f].destroy();this._indiceBuffers=null},i}(Ln);(function(){xm._textureProperty=k.getByName("renderer_SpriteTexture")})();var fi=function(){function r(a,t){this.elements=[],this._initSpriteBatcher(a),this._renderQueueType=t}var i=r.prototype;return i.pushRenderElement=function(t){this.elements.push(t)},i.render=function(t,e,n){var o=this.elements;if(o.length!==0){for(var s=t.engine,l=t.scene,c=s._renderCount,u=s._hardwareRenderer,d=l.shaderData,f=t.shaderData,h=xi.pipelineStageKey,_=this._renderQueueType,g=0,y=o.length;g<y;g++){var v=o[g],p=v.data,m=v.shaderPasses,A=p.component.entity.layer;if(A&e)if(p.primitive){this._spriteBatcher.flush(t);var S=Le._compileMacros,x=p.primitive,b=p.component,C=p.material,w=b.shaderData,E=C.shaderData,T=C.renderStates;Ir.unionCollection(b._globalShaderMacro,E._macroCollection,S);for(var M=0,B=m.length;M<B;M++){var I=m[M];if(I.getTagValue(h)===n){var F;if(((F=I._renderState)!=null?F:T[M]).renderQueueType===_){var L=I._getShaderProgram(s,S);if(L.isValid){var V=L.bind(),D=c!==L._uploadRenderCount;D?(L.groupingOtherUniformBlock(),L.uploadAll(L.sceneUniformBlock,d),L.uploadAll(L.cameraUniformBlock,f),L.uploadAll(L.rendererUniformBlock,w),L.uploadAll(L.materialUniformBlock,E),L.uploadUnGroupTextures(),L._uploadScene=l,L._uploadCamera=t,L._uploadRenderer=b,L._uploadMaterial=C,L._uploadRenderCount=c):(L._uploadScene!==l?(L.uploadAll(L.sceneUniformBlock,d),L._uploadScene=l):V&&L.uploadTextures(L.sceneUniformBlock,d),L._uploadCamera!==t?(L.uploadAll(L.cameraUniformBlock,f),L._uploadCamera=t):V&&L.uploadTextures(L.cameraUniformBlock,f),L._uploadRenderer!==b?(L.uploadAll(L.rendererUniformBlock,w),L._uploadRenderer=b):V&&L.uploadTextures(L.rendererUniformBlock,w),L._uploadMaterial!==C?(L.uploadAll(L.materialUniformBlock,E),L._uploadMaterial=C):V&&L.uploadTextures(L.materialUniformBlock,E),V&&L.uploadUnGroupTextures());var N,O=(N=I._renderState)!=null?N:T[M];O._apply(s,b.entity.transform._isFrontFaceInvert(),I._renderStateDataMap,C.shaderData),u.drawPrimitive(x,p.subPrimitive,L)}}}}}else this._spriteBatcher.drawElement(v,t)}this._spriteBatcher.flush(t)}},i.clear=function(){this.elements.length=0,this._spriteBatcher.clear()},i.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},i.sort=function(t){Ye._quickSort(this.elements,0,this.elements.length,t)},i._initSpriteBatcher=function(t){this._spriteBatcher=new xm(t)},r._compareFromNearToFar=function(t,e){var n=t.data,o=e.data,s=n.component,l=o.component,c=s.priority-l.priority;if(c!==0)return c;if(s.instanceId===l.instanceId)return n.material._priority-o.material._priority||s._distanceForSort-l._distanceForSort;var u=s._distanceForSort-l._distanceForSort;return u===0?s.instanceId-l.instanceId:u},r._compareFromFarToNear=function(t,e){var n=t.data,o=e.data,s=n.component,l=o.component,c=s.priority-l.priority;if(c!==0)return c;if(s.instanceId===l.instanceId)return n.material._priority-o.material._priority||l._distanceForSort-s._distanceForSort;var u=l._distanceForSort-s._distanceForSort;return u===0?s.instanceId-l.instanceId:u},r}(),QS=0,cs=function(){function r(a,t,e,n,o){a===void 0&&(a="RENDER_PASS"+QS++),t===void 0&&(t=0),e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),this.name=a,this.enabled=!0,this.priority=t,this.renderTarget=e,this.replaceMaterial=n,this.mask=o||Kr.Everything,this.renderOverride=!1}var i=r.prototype;return i.render=function(t,e,n,o){},i.preRender=function(t,e,n,o){},i.postRender=function(t,e,n,o){},r}(),Sm=function(){this.position=new P,this.isOrthographic=!1,this.viewMatrix=new $,this.projectionMatrix=new $,this.viewProjectionMatrix=new $,this.forward=new P},jS=function(){this.virtualCamera=new Sm,this.cullPlanes=[new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P),new Pt(new P)],this.splitBoundSphere=new ol(new P,0)},Ap;(function(r){r[r.FarBottomLeft=0]="FarBottomLeft",r[r.FarTopLeft=1]="FarTopLeft",r[r.FarTopRight=2]="FarTopRight",r[r.FarBottomRight=3]="FarBottomRight",r[r.nearBottomLeft=4]="nearBottomLeft",r[r.nearTopLeft=5]="nearTopLeft",r[r.nearTopRight=6]="nearTopRight",r[r.nearBottomRight=7]="nearBottomRight",r[r.unknown=8]="unknown"})(Ap||(Ap={}));var Et=function(){function r(){}return r.shadowResolution=function(a){switch(a){case Yi.Low:return 512;case Yi.Medium:return 1024;case Yi.High:return 2048;case Yi.VeryHigh:return 4096}},r.shadowDepthFormat=function(a,t){return t?j.Depth16:j.R8G8B8A8},r.cullingRenderBounds=function(a,t,e){for(var n=a.min,o=a.max,s=0;s<t;s++){var l=e[s],c=l.normal;if(c.x*(c.x>=0?o.x:n.x)+c.y*(c.y>=0?o.y:n.y)+c.z*(c.z>=0?o.z:n.z)<-l.distance)return!1}return!0},r.shadowCullFrustum=function(a,t,e,n){var o=e._entity.layer;a.camera.cullingMask&o&&t.cullingMask&o&&e.castShadows&&r.cullingRenderBounds(e.bounds,n.cullPlaneCount,n.cullPlanes)&&(e._renderFrameCount=e.engine.time.frameCount,e._prepareRender(a))},r.getBoundSphereByFrustum=function(a,t,e,n,o){var s=e.aspectRatio,l=e.fieldOfView,c,u,d=Math.sqrt(1+s*s)*Math.tan(U.degreeToRadian(l)/2),f=d*d,h=t-a,_=t+a;f>h/_?(c=t,u=t*d):(c=.5*_*(1+f),u=.5*Math.sqrt(h*h+2*(t*t+a*a)*f+_*_*f*f));var g=o.splitBoundSphere.center;o.splitBoundSphere.radius=u,P.scale(n,c,g),P.add(e.entity.transform.worldPosition,g,g),o.sphereCenterZ=c},r.getDirectionLightShadowCullPlanes=function(a,t,e,n,o){var s=r._frustumCorners,l=r._backPlaneFaces,c=r._frustumPlaneNeighbors,u=r._frustumTwoPlaneCorners,d=r._edgePlanePoint2,f=o.cullPlanes,h=a.getPlane(Se.Near),_=a.getPlane(Se.Far),g=a.getPlane(Se.Left),y=a.getPlane(Se.Right),v=a.getPlane(Se.Bottom),p=a.getPlane(Se.Top),m=t-e,A=r._adjustNearPlane,S=r._adjustFarPlane;A.normal.copyFrom(h.normal),S.normal.copyFrom(_.normal),A.distance=h.distance-m,S.distance=Math.min(-h.distance+o.sphereCenterZ+o.splitBoundSphere.radius,_.distance),wt.intersectionPointThreePlanes(A,v,y,s[7]),wt.intersectionPointThreePlanes(A,p,y,s[6]),wt.intersectionPointThreePlanes(A,p,g,s[5]),wt.intersectionPointThreePlanes(A,v,g,s[4]),wt.intersectionPointThreePlanes(S,v,y,s[3]),wt.intersectionPointThreePlanes(S,p,y,s[2]),wt.intersectionPointThreePlanes(S,p,g,s[1]),wt.intersectionPointThreePlanes(S,v,g,s[0]);for(var x=0,b=0;b<6;b++){var C=void 0;switch(b){case Se.Near:C=A;break;case Se.Far:C=S;break;default:C=a.getPlane(b);break}P.dot(C.normal,n)<0&&(f[x].copyFrom(C),l[x]=b,x++)}for(var w=x,E=0;E<x;E++)for(var T=l[E],M=c[T],B=0;B<4;B++){for(var I=M[B],F=!0,L=0;L<x;L++)if(I==l[L]){F=!1;break}if(F){var V=u[T][I],D=s[V[0]],N=s[V[1]];P.add(D,n,d),Pt.fromPoints(D,N,d,f[w++])}}o.cullPlaneCount=w},r.getDirectionalLightMatrices=function(a,t,e,n,o,s,l,c){var u=l.splitBoundSphere;l.resolution=s;var d=u.center,f=u.radius,h=s/2,_=f*h/(h-r.atlasBorderSize),g=_*2,y=s/g,v=g/s,p=Math.ceil(P.dot(d,a)*y)*v,m=Math.ceil(P.dot(d,t)*y)*v,A=P.dot(d,e);d.x=a.x*p+t.x*m+e.x*A,d.y=a.y*p+t.y*m+e.y*A,d.z=a.z*p+t.z*m+e.z*A;var S=l.virtualCamera,x=S.position,b=S.viewMatrix,C=S.projectionMatrix;P.scale(e,f+o,x),P.subtract(d,x,x),$.lookAt(x,d,a,b),$.ortho(-_,_,-_,_,0,f*2+o,C);var w=S.viewProjectionMatrix;$.multiply(C,b,w),Ye._floatMatrixMultiply(r._shadowMapCoordMatrix,w.elements,0,c,n*16)},r.getMaxTileResolutionInAtlas=function(a,t,e){for(var n=Math.min(a,t),o=Math.floor(a/n)*Math.floor(t/n);o<e;)n=Math.floor(n>>1),o=Math.floor(a/n)*Math.floor(t/n);return n},r.getShadowBias=function(a,t,e,n){var o=2/t.elements[0],s=o/e,l=-a.shadowBias*s,c=-a.shadowNormalBias*s;if(a.shadowType==Pi.SoftHigh){var u=2.5;l*=u,c*=u}n.set(l,c)},r.applySliceTransform=function(a,t,e,n,o,s){var l=r._tempMatrix0,c=l.elements,u=1/t,d=1/e,f=a*u,h=a*d,_=o.x*u,g=o.y*d;c[0]=f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=h,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=_,c[13]=g,c[14]=0,c[15]=1;var y=n*16;Ye._floatMatrixMultiply(l,s,y,s,y)},r.getScaleAndBiasForLinearDistanceFade=function(a,t,e){if(t<1e-4){var n=1e3;e.z=n,e.w=-a*n;return}t=1-t,t*=t;var o=t*a,s=a-o;e.z=1/s,e.w=-o/s},r}();(function(){Et._tempMatrix0=new $})();(function(){Et._shadowMapCoordMatrix=new $(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1)})();(function(){Et._frustumCorners=[new P,new P,new P,new P,new P,new P,new P,new P]})();(function(){Et._adjustNearPlane=new Pt(new P)})();(function(){Et._adjustFarPlane=new Pt(new P)})();(function(){Et._backPlaneFaces=new Array(5)})();(function(){Et._edgePlanePoint2=new P})();(function(){Et._frustumPlaneNeighbors=[[Se.Left,Se.Right,Se.Top,Se.Bottom],[Se.Left,Se.Right,Se.Top,Se.Bottom],[Se.Near,Se.Far,Se.Top,Se.Bottom],[Se.Near,Se.Far,Se.Top,Se.Bottom],[Se.Near,Se.Far,Se.Left,Se.Right],[Se.Near,Se.Far,Se.Left,Se.Right]]})();(function(){Et._frustumTwoPlaneCorners=[[[8,8],[8,8],[4,5],[6,7],[7,4],[5,6]],[[8,8],[8,8],[1,0],[3,2],[0,3],[2,1]],[[5,4],[0,1],[8,8],[8,8],[4,0],[1,5]],[[7,6],[2,3],[8,8],[8,8],[3,7],[6,2]],[[4,7],[3,0],[0,4],[7,3],[8,8],[8,8]],[[6,5],[1,2],[5,1],[2,6],[8,8],[8,8]]]})();(function(){Et.atlasBorderSize=4})();var yr=function(r){W(i,r);function i(t){var e;return e=r.call(this,t.engine)||this,e._shadowMapSize=new ue,e._shadowBias=new te,e._shadowSliceData=new jS,e._lightUp=new P,e._lightSide=new P,e._splitBoundSpheres=new Float32Array(i._maxCascades*4),e._shadowMatrices=new Float32Array((i._maxCascades+1)*16),e._shadowInfos=new ue,e._viewportOffsets=[new te,new te,new te,new te],e._camera=t,e._supportDepthTexture=t.engine._hardwareRenderer.canIUse(J.depthTexture),e._shadowSliceData.virtualCamera.isOrthographic=!0,e}var a=i.prototype;return a.onRender=function(e){var n=this._camera.scene._lightManager._sunlight;this._updateShadowSettings(),this._renderDirectShadowMap(e,n),this._updateReceiversShaderData(n)},a._renderDirectShadowMap=function(e,n){var o=this,s=o._engine,l=o._camera,c=o._viewportOffsets,u=o._shadowSliceData,d=o._splitBoundSpheres,f=o._shadowMatrices,h=l._renderPipeline._cullingResults,_=h.opaqueQueue,g=h.alphaTestQueue,y=h.transparentQueue,v=l.scene,p=v._componentsManager,m=s._hardwareRenderer,A=v.shadowCascades,S=i._cascadesSplitDistance,x=u.splitBoundSphere,b=i._tempMatrix0,C=b.elements,w=this._lightUp,E=this._lightSide,T=u.virtualCamera.forward,M=this._shadowMapSize,B=M.z,I=M.w,F=this._shadowMapFormat,L,V;this._supportDepthTexture?(L=yf.recreateRenderTargetIfNeeded(s,this._renderTarget,B,I,null,F,!1),V=L.depthTexture):(L=yf.recreateRenderTargetIfNeeded(s,this._renderTarget,B,I,F,null,!1),V=L.getColorTexture(0)),V.wrapModeU=V.wrapModeV=rr.Clamp,s._hardwareRenderer._isWebGL2&&(V.depthCompareFunction=an.Less),this._renderTarget=L,this._depthTexture=V,m.activeRenderTarget(L,i._viewport,0),this._supportDepthTexture?m.clearRenderTarget(s,gr.Depth,null):m.clearRenderTarget(s,gr.All,i._clearColor),$.rotationQuaternion(n.entity.transform.worldRotationQuaternion,b),E.set(C[0],C[1],C[2]),w.set(C[4],C[5],C[6]),T.set(-C[8],-C[9],-C[10]);var D=i._tempVector;D.copyFrom(l.entity.transform.worldForward);for(var N=this._shadowTileResolution,O=0;O<A;O++){Et.getBoundSphereByFrustum(S[O],S[O+1],l,D,u),Et.getDirectionLightShadowCullPlanes(l._frustum,S[O],l.nearClipPlane,T,u),Et.getDirectionalLightMatrices(w,E,T,O,n.shadowNearPlane,N,u,f),A>1&&Et.applySliceTransform(N,B,I,O,this._viewportOffsets[O],f),this._updateSingleShadowCasterShaderData(n,u,e);var G=x.center,Q=x.radius,H=O*4;d[H]=G.x,d[H+1]=G.y,d[H+2]=G.z,d[H+3]=Q*Q,_.clear(),g.clear(),y.clear();for(var ee=p._renderers,ve=ee._elements,oe=ee.length-1;oe>=0;--oe)Et.shadowCullFrustum(e,n,ve[oe],u);if(_.elements.length||g.elements.length){_.sort(fi._compareFromNearToFar),g.sort(fi._compareFromNearToFar);var ne=c[O],Me=ne.x,He=ne.y;m.setGlobalDepthBias(1,1),m.viewport(Me,He,N,N),m.scissor(Me+1,He+1,N-2,N-2),s._renderCount++,_.render(l,Kr.Everything,pr.ShadowCaster),g.render(l,Kr.Everything,pr.ShadowCaster),m.setGlobalDepthBias(0,0)}}},a._updateReceiversShaderData=function(e){var n=this._camera,o=n.scene,s=this._splitBoundSpheres,l=this._shadowMatrices,c=o.shadowCascades,u=Math.min(o.shadowDistance,n.farClipPlane);if(Et.getScaleAndBiasForLinearDistanceFade(Math.pow(u,2),o.shadowFadeBorder,this._shadowInfos),this._shadowInfos.x=e.shadowStrength,c>1)for(var d=c*4,f=s.length;d<f;d++)s[d]=0;for(var h=c*16,_=l.length;h<_;h++)l[h]=0;var g=o.shaderData;g.setFloatArray(i._shadowMatricesProperty,this._shadowMatrices),g.setVector4(i._shadowInfosProperty,this._shadowInfos),g.setTexture(i._shadowMapsProperty,this._depthTexture),g.setFloatArray(i._shadowSplitSpheresProperty,this._splitBoundSpheres),g.setVector4(i._shadowMapSize,this._shadowMapSize)},a._getCascadesSplitDistance=function(e){var n=i._cascadesSplitDistance,o=this._camera.scene,s=o.shadowTwoCascadeSplits,l=o.shadowFourCascadeSplits,c=o.shadowCascades,u=this._camera,d=u.nearClipPlane,f=u.aspectRatio,h=u.fieldOfView;n[0]=d;var _=e-d,g=Math.tan(U.degreeToRadian(h)*.5),y=1+g*g*(f*f+1);switch(c){case on.NoCascades:n[1]=this._getFarWithRadius(e,y);break;case on.TwoCascades:n[1]=this._getFarWithRadius(d+_*s,y),n[2]=this._getFarWithRadius(e,y);break;case on.FourCascades:n[1]=this._getFarWithRadius(d+_*l.x,y),n[2]=this._getFarWithRadius(d+_*l.y,y),n[3]=this._getFarWithRadius(d+_*l.z,y),n[4]=this._getFarWithRadius(e,y);break}},a._getFarWithRadius=function(e,n){return Math.sqrt(e*e/n)},a._updateShadowSettings=function(){var e=this._camera,n=e.scene,o=Et.shadowDepthFormat(n.shadowResolution,this._supportDepthTexture),s=Et.shadowResolution(n.shadowResolution),l=n.shadowCascades,c=Math.min(n.shadowDistance,e.farClipPlane);if(this._getCascadesSplitDistance(c),o!==this._shadowMapFormat||s!==this._shadowMapResolution||l!==this._shadowCascadeMode){if(this._shadowMapFormat=o,this._shadowMapResolution=s,this._shadowCascadeMode=l,l==on.NoCascades)this._shadowTileResolution=s,this._shadowMapSize.set(1/s,1/s,s,s);else{var u=Et.getMaxTileResolutionInAtlas(s,s,l);this._shadowTileResolution=u;var d=u*2,f=l==on.TwoCascades?u:u*2;this._shadowMapSize.set(1/d,1/f,d,f)}this._renderTarget=null;var h=this._viewportOffsets,_=this._shadowTileResolution;switch(l){case on.NoCascades:h[0].set(0,0);break;case on.TwoCascades:h[0].set(0,0),h[1].set(_,0);break;case on.FourCascades:h[0].set(0,0),h[1].set(_,0),h[2].set(0,_),h[3].set(_,_)}}},a._updateSingleShadowCasterShaderData=function(e,n,o){var s=n.virtualCamera;Et.getShadowBias(e,s.projectionMatrix,this._shadowTileResolution,this._shadowBias);var l=this._camera.scene.shaderData;l.setVector2(i._lightShadowBiasProperty,this._shadowBias),l.setVector3(i._lightDirectionProperty,e.direction),o.applyVirtualCamera(s)},i}(Am);(function(){yr._lightShadowBiasProperty=k.getByName("scene_ShadowBias")})();(function(){yr._lightDirectionProperty=k.getByName("scene_LightDirection")})();(function(){yr._shadowMatricesProperty=k.getByName("scene_ShadowMatrices")})();(function(){yr._shadowMapSize=k.getByName("scene_ShadowMapSize")})();(function(){yr._shadowInfosProperty=k.getByName("scene_ShadowInfo")})();(function(){yr._shadowMapsProperty=k.getByName("scene_ShadowMap")})();(function(){yr._shadowSplitSpheresProperty=k.getByName("scene_ShadowSplitSpheres")})();(function(){yr._maxCascades=4})();(function(){yr._cascadesSplitDistance=new Array(yr._maxCascades+1)})();(function(){yr._viewport=new ue(0,0,1,1)})();(function(){yr._clearColor=new K(1,1,1,1)})();(function(){yr._tempVector=new P})();(function(){yr._tempMatrix0=new $})();var XS=function(){function r(a){this.opaqueQueue=new fi(a,Dt.Opaque),this.transparentQueue=new fi(a,Dt.Transparent),this.alphaTestQueue=new fi(a,Dt.AlphaTest)}var i=r.prototype;return i.reset=function(){this.opaqueQueue.clear(),this.transparentQueue.clear(),this.alphaTestQueue.clear()},i.sort=function(){this.opaqueQueue.sort(fi._compareFromNearToFar),this.alphaTestQueue.sort(fi._compareFromNearToFar),this.transparentQueue.sort(fi._compareFromFarToNear)},i.destroy=function(){this.opaqueQueue.destroy(),this.transparentQueue.destroy(),this.alphaTestQueue.destroy()},r}(),YS=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e._supportDepthTexture=t._hardwareRenderer.canIUse(J.depthTexture),e}var a=i.prototype;return a.onConfig=function(e){var n=this._engine,o=e.pixelViewport,s=o.width,l=o.height,c=yf.recreateRenderTargetIfNeeded(n,this._renderTarget,s,l,null,j.Depth16,!1),u=c.depthTexture;u.wrapModeU=u.wrapModeV=rr.Clamp,u.filterMode=Xt.Point,this._renderTarget=c},a.onRender=function(e,n){var o=this._engine,s=this._renderTarget,l=e.camera,c=o._hardwareRenderer;c.activeRenderTarget(s,l.viewport,0),c.clearRenderTarget(o,gr.Depth,null),c.viewport(0,0,s.width,s.height),c.scissor(0,0,s.width,s.height),n.opaqueQueue.render(l,Kr.Everything,pr.DepthOnly),n.alphaTestQueue.render(l,Kr.Everything,pr.DepthOnly),l.shaderData.setTexture(rt._cameraDepthTextureProperty,this._renderTarget.depthTexture)},i}(Am),Cm=function(){function r(a){this._allSpriteMasks=new $e,this._lastCanvasSize=new te,this._camera=a;var t=a.engine;this._cullingResults=new XS(t),this._cascadedShadowCaster=new yr(a),this._depthOnlyPass=new YS(t),this._renderPassArray=[],this._defaultPass=new cs("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var i=r.prototype;return i.addRenderPass=function(t,e,n,o,s){if(e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),s===void 0&&(s=null),typeof t=="string"){var l=new cs(t,e,n,o,s);this._renderPassArray.push(l)}else mt(t,cs)&&this._renderPassArray.push(t);this._renderPassArray.sort(function(c,u){return c.priority-u.priority})},i.removeRenderPass=function(t){var e;if(typeof t=="string"?e=this.getRenderPass(t):mt(t,cs)&&(e=t),e){var n=this._renderPassArray.indexOf(e);this._renderPassArray.splice(n,1)}},i.getRenderPass=function(t){for(var e=0,n=this._renderPassArray.length;e<n;e++){var o=this._renderPassArray[e];if(o.name===t)return o}return null},i.destroy=function(){this._cullingResults.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},i.render=function(t,e,n,o){var s=this._camera,l=s.scene,c=this._cullingResults,u=l._lightManager._sunlight;s.engine._spriteMaskManager.clear(),l.castShadows&&u&&u.shadowType!==Pi.None&&this._cascadedShadowCaster.onRender(t),c.reset(),this._allSpriteMasks.length=0,t.applyVirtualCamera(s._virtualCamera),this._callRender(t),c.sort();var d=this._depthOnlyPass;s.depthTextureMode===Ys.PrePass&&d._supportDepthTexture?(d.onConfig(s),d.onRender(t,c)):s.shaderData.setTexture(rt._cameraDepthTextureProperty,s.engine._whiteTexture2D);for(var f=0,h=this._renderPassArray.length;f<h;f++)this._drawRenderPass(t,this._renderPassArray[f],s,e,n,o)},i._drawRenderPass=function(t,e,n,o,s,l){var c=this._cullingResults,u=c.opaqueQueue,d=c.alphaTestQueue,f=c.transparentQueue;if(e.preRender(n,u,d,f),e.enabled){var h,_,g,y=n.engine,v=n.scene,p=v.background,m=y._hardwareRenderer,A=n.renderTarget||e.renderTarget;m.activeRenderTarget(A,n.viewport,s),(h=A)==null||h._setRenderTargetInfo(o,s);var S,x=((S=e.clearFlags)!=null?S:n.clearFlags)&~(l??gr.None),b,C=(b=e.clearColor)!=null?b:p.solidColor;x!==gr.None&&m.clearRenderTarget(n.engine,x,C),e.renderOverride?e.render(n,u,d,f):(u.render(n,e.mask,pr.Forward),d.render(n,e.mask,pr.Forward),x&gr.Color&&(p.mode===Si.Sky?p.sky._render(t):p.mode===Si.Texture&&p.texture&&this._drawBackgroundTexture(y,p)),c.transparentQueue.render(n,e.mask,pr.Forward)),(_=A)==null||_._blitRenderTarget(),(g=A)==null||g.generateMipmaps()}e.postRender(n,c.opaqueQueue,c.alphaTestQueue,c.transparentQueue)},i.pushRenderData=function(t,e){var n=e.material,o=n.renderStates,s=n.shader.subShaders[0],l=t.replacementShader;if(l){var c=l.subShaders,u=t.replacementTag;if(u)for(var d=0,f=c.length;d<f;d++){var h=c[d];if(h.getTagValue(u)===s.getTagValue(u)){this.pushRenderDataWithShader(t,e,h.passes,o);break}}else this.pushRenderDataWithShader(t,e,c[0].passes,o)}else this.pushRenderDataWithShader(t,e,s.passes,o)},i.pushRenderDataWithShader=function(t,e,n,o){for(var s=this._cullingResults,l=s.opaqueQueue,c=s.alphaTestQueue,u=s.transparentQueue,d=t.camera.engine._renderElementPool,f=0,h=0,_=n.length;h<_;h++){var g,y=((g=n[h]._renderState)!=null?g:o[h]).renderQueueType;if(!(f&1<<y)){var v=d.getFromPool();switch(v.set(e,n),y){case Dt.Opaque:l.pushRenderElement(v),f|=1;break;case Dt.AlphaTest:c.pushRenderElement(v),f|=2;break;case Dt.Transparent:u.pushRenderElement(v),f|=4;break}}}},i._drawBackgroundTexture=function(t,e){var n=t._hardwareRenderer,o=t.canvas,s=e._material,l=e._mesh;(this._lastCanvasSize.x!==o.width||this._lastCanvasSize.y!==o.height)&&e._textureFillMode!==Xi.Fill&&(this._lastCanvasSize.set(o.width,o.height),e._resizeBackgroundTexture());var c=s.shader.subShaders[0].passes[0],u=c._getShaderProgram(t,Le._compileMacros);u.bind(),u.uploadAll(u.materialUniformBlock,s.shaderData),u.uploadUnGroupTextures(),(c._renderState||s.renderState)._apply(t,!1,c._renderStateDataMap,s.shaderData),n.drawPrimitive(l._primitive,l.subMesh,u)},i._callRender=function(t){for(var e=t.camera.engine,n=t.camera,o=n.scene._componentsManager._renderers,s=o._elements,l=o.length-1;l>=0;--l){var c=s[l];n.cullingMask&c._entity.layer&&(n.enableFrustumCulling&&!n._frustum.intersectsBox(c.bounds)||(c._renderFrameCount=e.time.frameCount,c._prepareRender(t)))}},q(r,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),r}(),xp;(function(r){r[r.None=0]="None",r[r.Opaque=1]="Opaque",r[r.AlphaTest=2]="AlphaTest",r[r.Transparent=4]="Transparent"})(xp||(xp={}));var qs;(function(r){r[r.Normal=0]="Normal",r[r.XRCenterCamera=1]="XRCenterCamera",r[r.XRLeftCamera=2]="XRLeftCamera",r[r.XRRightCamera=4]="XRRightCamera"})(qs||(qs={}));var Vi,Pa=function(){};(function(){Pa.tempVec4=new ue})();(function(){Pa.tempVec3=new P})();(function(){Pa.tempVec2=new te})();var rt=(Vi=function(r){W(i,r);function i(t){var e;e=r.call(this,t)||this,e.enableFrustumCulling=!0,e.clearFlags=gr.All,e.cullingMask=Kr.Everything,e.depthTextureMode=Ys.None,e._cameraType=qs.Normal,e._globalShaderMacro=new Ir,e._frustum=new _1,e._virtualCamera=new Sm,e._replacementShader=null,e._replacementSubShaderTag=null,e._cameraIndex=-1,e._priority=0,e._shaderData=new ii(Dn.Camera),e._isCustomViewMatrix=!1,e._isCustomProjectionMatrix=!1,e._nearClipPlane=.1,e._farClipPlane=100,e._fieldOfView=45,e._orthographicSize=10,e._isProjectionDirty=!0,e._isInvProjMatDirty=!0,e._customAspectRatio=void 0,e._renderTarget=null,e._depthBufferParams=new ue,e._viewport=new ue(0,0,1,1),e._pixelViewport=new Mn(0,0,0,0),e._inverseProjectionMatrix=new $,e._invViewProjMat=new $;var n=e.entity.transform;return e._transform=n,e._isViewMatrixDirty=n.registerWorldChangeFlag(),e._isInvViewProjDirty=n.registerWorldChangeFlag(),e._frustumChangeFlag=n.registerWorldChangeFlag(),e._renderPipeline=new Cm(he(e)),e._addResourceReferCount(e.shaderData,1),e._updatePixelViewport(),e._onPixelViewportChanged=e._onPixelViewportChanged.bind(he(e)),e._viewport._onValueChanged=e._onPixelViewportChanged,e.engine.canvas._sizeUpdateFlagManager.addListener(e._onPixelViewportChanged),e}var a=i.prototype;return a.resetViewMatrix=function(){this._isCustomViewMatrix=!1,this._viewMatrixChange()},a.resetProjectionMatrix=function(){this._isCustomProjectionMatrix=!1,this._projectionMatrixChange()},a.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projectionMatrixChange()},a.worldToViewportPoint=function(e,n){var o=Pa.tempVec3,s=Pa.tempVec4;P.transformCoordinate(e,this.viewMatrix,o),P.transformToVec4(o,this.projectionMatrix,s);var l=s.w;return n.set((s.x/l+1)*.5,(1-s.y/l)*.5,-o.z),n},a.viewportToWorldPoint=function(e,n){var o=this,s=o.nearClipPlane,l=o.farClipPlane,c=1/(s-l),u;if(this.isOrthographic)u=-e.z*2*c,u+=(l+s)*c;else{var d=e.z;u=-d*(s+l)*c,u+=2*s*l*c,u=u/d}return this._innerViewportToWorldPoint(e.x,e.y,(u+1)/2,this._getInvViewProjMat(),n),n},a.viewportPointToRay=function(e,n){var o=this._getInvViewProjMat(),s=this._innerViewportToWorldPoint(e.x,e.y,0,o,n.origin),l=this._innerViewportToWorldPoint(e.x,e.y,1-U.zeroTolerance,o,n.direction);return P.subtract(l,s,l),l.normalize(),n},a.screenToViewportPoint=function(e,n){var o=this.engine.canvas,s=this.viewport;return n.x=(e.x/o.width-s.x)/s.z,n.y=(e.y/o.height-s.y)/s.w,e.z!==void 0&&(n.z=e.z),n},a.viewportToScreenPoint=function(e,n){var o=this.engine.canvas,s=this.viewport;return n.x=(s.x+e.x*s.z)*o.width,n.y=(s.y+e.y*s.w)*o.height,e.z!==void 0&&(n.z=e.z),n},a.worldToScreenPoint=function(e,n){return this.worldToViewportPoint(e,n),this.viewportToScreenPoint(n,n)},a.screenToWorldPoint=function(e,n){return this.screenToViewportPoint(e,n),this.viewportToWorldPoint(n,n)},a.screenPointToRay=function(e,n){var o=Pa.tempVec2;return this.screenToViewportPoint(e,o),this.viewportPointToRay(o,n)},a.render=function(e,n){n===void 0&&(n=0);var o=this.engine._renderContext,s=this._virtualCamera,l=this.entity.transform;$.multiply(this.projectionMatrix,this.viewMatrix,s.viewProjectionMatrix),s.position.copyFrom(l.worldPosition),s.isOrthographic&&s.forward.copyFrom(l.worldForward),o.camera=this,o.virtualCamera=s,o.replacementShader=this._replacementShader,o.replacementTag=this._replacementSubShaderTag,this.enableFrustumCulling&&this._frustumChangeFlag.flag&&(this._frustum.calculateFromMatrix(s.viewProjectionMatrix),this._frustumChangeFlag.flag=!1),this._updateShaderData(),Ir.unionCollection(this.scene._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro),n>0&&!this.engine._hardwareRenderer.isWebGL2&&(n=0,me.error("mipLevel only take effect in WebGL2.0"));var c;this._cameraType!==qs.Normal&&(c=this.engine.xrManager._getCameraClearFlagsMask(this._cameraType)),this._renderPipeline.render(o,e,n,c),this._engine._renderCount++},a.setReplacementShader=function(e,n){this._replacementShader=e,this._replacementSubShaderTag=typeof n=="string"?yi.getByName(n):n},a.resetReplacementShader=function(){this._replacementShader=null,this._replacementSubShaderTag=null},a._onEnableInScene=function(){this.scene._componentsManager.addCamera(this)},a._onDisableInScene=function(){this.scene._componentsManager.removeCamera(this)},a._onDestroy=function(){var e;r.prototype._onDestroy.call(this),(e=this._renderPipeline)==null||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this._addResourceReferCount(this.shaderData,-1),this._viewport._onValueChanged=null,this.engine.canvas._sizeUpdateFlagManager.removeListener(this._onPixelViewportChanged),this._entity=null,this._globalShaderMacro=null,this._frustum=null,this._renderPipeline=null,this._virtualCamera=null,this._shaderData=null,this._frustumChangeFlag=null,this._transform=null,this._isViewMatrixDirty=null,this._isInvViewProjDirty=null,this._viewport=null,this._inverseProjectionMatrix=null,this._invViewProjMat=null},a._updatePixelViewport=function(){var e,n,o=this._renderTarget;if(o)e=o.width,n=o.height;else{var s=this.engine.canvas;e=s.width,n=s.height}var l=this._viewport;this._pixelViewport.set(l.x*e,l.y*n,l.z*e,l.w*n)},a._viewMatrixChange=function(){this._isViewMatrixDirty.flag=!0,this._isInvViewProjDirty.flag=!0,this._frustumChangeFlag.flag=!0},a._projectionMatrixChange=function(){this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0,this._frustumChangeFlag.flag=!0},a._innerViewportToWorldPoint=function(e,n,o,s,l){var c=Pa.tempVec3;return c.set(e*2-1,1-n*2,o*2-1),P.transformCoordinate(c,s,l),l},a._updateShaderData=function(){var e=this.shaderData,n=this._transform;e.setMatrix(rt._inverseViewMatrixProperty,n.worldMatrix),e.setVector3(rt._cameraPositionProperty,n.worldPosition),e.setVector3(rt._cameraForwardProperty,n.worldForward),e.setVector3(rt._cameraUpProperty,n.worldUp);var o=this._depthBufferParams,s=this._farClipPlane/this._nearClipPlane;o.set(1-s,s,0,0),e.setVector4(rt._cameraDepthBufferParamsProperty,o)},a._getInvViewProjMat=function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,$.multiply(this._transform.worldMatrix,this._getInverseProjectionMatrix(),this._invViewProjMat)),this._invViewProjMat},a._getInverseProjectionMatrix=function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,$.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix},a._onPixelViewportChanged=function(){this._updatePixelViewport();var e;(e=this._customAspectRatio)!=null||this._projectionMatrixChange()},q(i,[{key:"shaderData",get:function(){return this._shaderData}},{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projectionMatrixChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projectionMatrixChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projectionMatrixChange()}},{key:"aspectRatio",get:function(){var e=this.pixelViewport,n;return(n=this._customAspectRatio)!=null?n:e.width/e.height},set:function(e){this._customAspectRatio=e,this._projectionMatrixChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&this._viewport.copyFrom(e)}},{key:"pixelViewport",get:function(){return this._pixelViewport}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority!==e&&(this._phasedActiveInScene&&(this.scene._componentsManager._cameraNeedSorting=!0),this._priority=e)}},{key:"isOrthographic",get:function(){return this._virtualCamera.isOrthographic},set:function(e){this._virtualCamera.isOrthographic=e,this._projectionMatrixChange(),e?this.shaderData.enableMacro("CAMERA_ORTHOGRAPHIC"):this.shaderData.disableMacro("CAMERA_ORTHOGRAPHIC")}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projectionMatrixChange()}},{key:"viewMatrix",get:function(){var e=this._virtualCamera.viewMatrix;if(!this._isViewMatrixDirty.flag||this._isCustomViewMatrix)return e;this._isViewMatrixDirty.flag=!1;var n=this._transform;return $.rotationTranslation(n.worldRotationQuaternion,n.worldPosition,e),e.invert(),e},set:function(e){this._virtualCamera.viewMatrix.copyFrom(e),this._isCustomViewMatrix=!0,this._viewMatrixChange()}},{key:"projectionMatrix",get:function(){var e=this._virtualCamera,n=e.projectionMatrix;if(!this._isProjectionDirty||this._isCustomProjectionMatrix)return n;this._isProjectionDirty=!1;var o=this.aspectRatio;if(!e.isOrthographic)$.perspective(U.degreeToRadian(this._fieldOfView),o,this._nearClipPlane,this._farClipPlane,n);else{var s=this._orthographicSize*o,l=this._orthographicSize;$.ortho(-s,s,-l,l,this._nearClipPlane,this._farClipPlane,n)}return n},set:function(e){this._virtualCamera.projectionMatrix.copyFrom(e),this._isCustomProjectionMatrix=!0,this._projectionMatrixChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget!==e&&(this._renderTarget&&this._addResourceReferCount(this._renderTarget,-1),e&&this._addResourceReferCount(e,1),this._renderTarget=e,this._onPixelViewportChanged())}}]),i}(ir),function(){Vi._cameraDepthTextureProperty=k.getByName("camera_DepthTexture")}(),function(){Vi._inverseViewMatrixProperty=k.getByName("camera_ViewInvMat")}(),function(){Vi._cameraPositionProperty=k.getByName("camera_Position")}(),function(){Vi._cameraForwardProperty=k.getByName("camera_Forward")}(),function(){Vi._cameraUpProperty=k.getByName("camera_Up")}(),function(){Vi._cameraDepthBufferParamsProperty=k.getByName("camera_DepthBufferParams")}(),Vi);R([Z],rt.prototype,"_frustum",void 0);R([z],rt.prototype,"_renderPipeline",void 0);R([z],rt.prototype,"_virtualCamera",void 0);R([z],rt.prototype,"_cameraIndex",void 0);R([z],rt.prototype,"_frustumChangeFlag",void 0);R([z],rt.prototype,"_transform",void 0);R([z],rt.prototype,"_isViewMatrixDirty",void 0);R([z],rt.prototype,"_isInvViewProjDirty",void 0);R([Z],rt.prototype,"_viewport",void 0);R([Z],rt.prototype,"_pixelViewport",void 0);R([Z],rt.prototype,"_inverseProjectionMatrix",void 0);R([Z],rt.prototype,"_invViewProjMat",void 0);R([z],rt.prototype,"_onPixelViewportChanged",null);rt=R([sl(ye,Ua.CheckOnly)],rt);var qS={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"},KS=1,JS=1/0,ZS=500;function sa(r,i){return i===void 0&&(i={}),new Ne(function(a,t,e,n){var o,s=(o=i.retryCount)!=null?o:KS,l,c=(l=i.retryInterval)!=null?l:ZS,u;i.timeout=(u=i.timeout)!=null?u:JS;var d;i.type=(d=i.type)!=null?d:eC(r);var f=new tC(function(){return $S(r,i).onProgress(e,n)},s,c);f.start().onError(t).onComplete(a)})}function $S(r,i){return new Ne(function(a,t,e,n){var o=new XMLHttpRequest,s=i.type==="image";o.timeout=i.timeout;var l;i.method=(l=i.method)!=null?l:"get",o.onload=function(){if(o.status<200||o.status>=300){t(new Error("request failed from: "+r));return}var u,d=(u=o.response)!=null?u:o.responseText;if(s){var f=new Image;f.onload=function(){requestAnimationFrame(function(){e(1,1),a(f),f.onload=null,f.onerror=null,f.onabort=null,URL.revokeObjectURL(f.src)})},f.onerror=f.onabort=function(){t(new Error("request "+f.src+" fail")),URL.revokeObjectURL(f.src)},f.crossOrigin="anonymous",f.src=URL.createObjectURL(d)}else e(1,1),a(d)},o.onerror=function(){t(new Error("request failed from: "+r))},o.ontimeout=function(){t(new Error("request timeout from: "+r))},o.onprogress=function(u){u.lengthComputable&&n(r,u.loaded,u.total)},o.open(i.method,r,!0),o.withCredentials=i.credentials==="include",o.responseType=s?"blob":i.type;var c=i.headers;c&&Object.keys(c).forEach(function(u){o.setRequestHeader(u,c[u])}),o.send(i.body)})}function eC(r){var i=r.substring(r.lastIndexOf(".")+1);return qS[i]}var tC=function(){function r(a,t,e){this.execFunc=a,this.totalCount=t,this.interval=e,this._timeoutId=-100,this._currentCount=0,this.exec=this.exec.bind(this)}var i=r.prototype;return i.start=function(){return this.exec(),this},i.onComplete=function(t){return this._onComplete=t,this},i.onError=function(t){return this._onError=t,this},i.cancel=function(){window.clearTimeout(this._timeoutId)},i.exec=function(){var t=this;if(this._currentCount>=this.totalCount){this._onError&&this._onError(this._error);return}this._currentCount++,this.execFunc(this._currentCount).then(function(e){return t._onComplete&&t._onComplete(e)}).catch(function(e){t._error=e,t._timeoutId=window.setTimeout(t.exec,t.interval)})},r}(),Ve=function(){function r(i){this.useCache=i,this.request=sa}return r.registerClass=function(a,t){this._engineObjects[a]=t,this._classNameMap.set(t,a)},r.getClass=function(a){return this._engineObjects[a]},r.getClassName=function(a){return this._classNameMap.get(a)},r}();(function(){Ve._engineObjects={}})();(function(){Ve._classNameMap=new Map})();var Ma;(function(r){r[r.Normal=0]="Normal",r[r.Additive=1]="Additive"})(Ma||(Ma={}));var vi;(function(r){r[r.Front=0]="Front",r[r.Back=1]="Back",r[r.Double=2]="Double"})(vi||(vi={}));var et=function(r){W(i,r);function i(t,e){var n;return n=r.call(this,t,e)||this,n._renderFace=vi.Front,n._isTransparent=!1,n._blendMode=Ma.Normal,n.shaderData.setFloat(i._alphaCutoffProp,0),n}var a=i.prototype;return a.setIsTransparent=function(e,n){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";var s=o[e];n?(s.blendState.targetBlendState.enabled=!0,s.depthState.writeEnabled=!1,s.renderQueueType=Dt.Transparent,this.shaderData.enableMacro(i._transparentMacro)):(s.blendState.targetBlendState.enabled=!1,s.depthState.writeEnabled=!0,s.renderQueueType=this.shaderData.getFloat(i._alphaCutoffProp)?Dt.AlphaTest:Dt.Opaque,this.shaderData.disableMacro(i._transparentMacro))},a.setBlendMode=function(e,n){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";var s=o[e].blendState,l=s.targetBlendState;switch(n){case Ma.Normal:l.sourceColorBlendFactor=Ee.SourceAlpha,l.destinationColorBlendFactor=Ee.OneMinusSourceAlpha,l.sourceAlphaBlendFactor=Ee.One,l.destinationAlphaBlendFactor=Ee.OneMinusSourceAlpha,l.colorBlendOperation=l.alphaBlendOperation=fr.Add;break;case Ma.Additive:l.sourceColorBlendFactor=Ee.SourceAlpha,l.destinationColorBlendFactor=Ee.One,l.sourceAlphaBlendFactor=Ee.One,l.destinationAlphaBlendFactor=Ee.OneMinusSourceAlpha,l.colorBlendOperation=l.alphaBlendOperation=fr.Add;break}},a.setRenderFace=function(e,n){var o=this.renderStates;if(o.length<e)throw"Pass should less than pass count.";switch(n){case vi.Front:o[e].rasterState.cullMode=Mr.Back;break;case vi.Back:o[e].rasterState.cullMode=Mr.Front;break;case vi.Double:o[e].rasterState.cullMode=Mr.Off;break}},a.clone=function(){var e=new i(this._engine,this.shader);return this.cloneTo(e),e},a.cloneTo=function(e){r.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},q(i,[{key:"shader",get:function(){return this._shader},set:function(e){var n=this._getReferCount();if(n>0){var o;(o=this._shader)==null||o._addReferCount(-n),e._addReferCount(n)}this._shader=e;for(var s=this._renderStates,l=s.length,c=0,u=e.subShaders,d=0;d<u.length;d++)c=Math.max(u[d].passes.length,c);if(l<c)for(var f=l;f<c;f++)s.push(new $n),this.setBlendMode(f,Ma.Normal);else s.length=c}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){e!==this._isTransparent&&(this.setIsTransparent(0,e),this._isTransparent=e)}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){e!==this._blendMode&&(this.setBlendMode(0,e),this._blendMode=e)}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(i._alphaCutoffProp)},set:function(e){var n=this.shaderData;if(n.getFloat(i._alphaCutoffProp)!==e){e?n.enableMacro(i._alphaCutoffMacro):n.disableMacro(i._alphaCutoffMacro);for(var o=this.renderStates,s=0,l=o.length;s<l;s++){var c=o[s];e>0?c.renderQueueType=c.blendState.targetBlendState.enabled?Dt.Transparent:Dt.AlphaTest:c.renderQueueType=c.blendState.targetBlendState.enabled?Dt.Transparent:Dt.Opaque}n.setFloat(i._alphaCutoffProp,e)}}},{key:"renderFace",get:function(){return this._renderFace},set:function(e){e!==this._renderFace&&(this.setRenderFace(0,e),this._renderFace=e)}}]),i}(In);(function(){et._baseTextureMacro=se.getByName("MATERIAL_HAS_BASETEXTURE")})();(function(){et._normalTextureMacro=se.getByName("MATERIAL_HAS_NORMALTEXTURE")})();(function(){et._emissiveTextureMacro=se.getByName("MATERIAL_HAS_EMISSIVETEXTURE")})();(function(){et._transparentMacro=se.getByName("MATERIAL_IS_TRANSPARENT")})();(function(){et._baseColorProp=k.getByName("material_BaseColor")})();(function(){et._baseTextureProp=k.getByName("material_BaseTexture")})();(function(){et._tilingOffsetProp=k.getByName("material_TilingOffset")})();(function(){et._normalTextureProp=k.getByName("material_NormalTexture")})();(function(){et._normalIntensityProp=k.getByName("material_NormalIntensity")})();(function(){et._emissiveColorProp=k.getByName("material_EmissiveColor")})();(function(){et._emissiveTextureProp=k.getByName("material_EmissiveTexture")})();(function(){et._alphaCutoffProp=k.getByName("material_AlphaCutoff")})();(function(){et._alphaCutoffMacro=se.getByName("MATERIAL_IS_ALPHA_CUTOFF")})();var ul=function(r){W(i,r);function i(t){var e;e=r.call(this,t,Le.find("blinn-phong"))||this;var n=e.shaderData;return n.enableMacro("MATERIAL_NEED_WORLD_POS"),n.enableMacro("MATERIAL_NEED_TILING_OFFSET"),n.setColor(i._baseColorProp,new K(1,1,1,1)),n.setColor(i._specularColorProp,new K(1,1,1,1)),n.setColor(i._emissiveColorProp,new K(0,0,0,1)),n.setVector4(i._tilingOffsetProp,new ue(1,1,0,0)),n.setFloat(i._shininessProp,16),n.setFloat(i._normalIntensityProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var n=this.shaderData.getColor(i._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var n=this.shaderData.getColor(i._specularColorProp);e!==n&&n.copyFrom(e)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(i._specularTextureProp)},set:function(e){this.shaderData.setTexture(i._specularTextureProp,e),e?this.shaderData.enableMacro("MATERIAL_HAS_SPECULAR_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(e){var n=this.shaderData.getColor(i._emissiveColorProp);e!==n&&n.copyFrom(e)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(i._emissiveTextureProp,e),e?this.shaderData.enableMacro(i._emissiveTextureMacro):this.shaderData.disableMacro(i._emissiveTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(e){this.shaderData.setTexture(i._normalTextureProp,e),e?this.shaderData.enableMacro(i._normalTextureMacro):this.shaderData.disableMacro(i._normalTextureMacro)}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(e){this.shaderData.setFloat(i._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(i._shininessProp)},set:function(e){this.shaderData.setFloat(i._shininessProp,Math.max(e,1e-4))}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(i._tilingOffsetProp);e!==n&&n.copyFrom(e)}}]),i}(et);(function(){ul._specularColorProp=k.getByName("material_SpecularColor")})();(function(){ul._shininessProp=k.getByName("material_Shininess")})();(function(){ul._specularTextureProp=k.getByName("material_SpecularTexture")})();var na;(function(r){r[r.UV0=0]="UV0",r[r.UV1=1]="UV1",r[r.UV2=2]="UV2",r[r.UV3=3]="UV3",r[r.UV4=4]="UV4",r[r.UV5=5]="UV5",r[r.UV6=6]="UV6",r[r.UV7=7]="UV7"})(na||(na={}));var Un=function(r){W(i,r);function i(a,t){var e;e=r.call(this,a,t)||this;var n=e.shaderData;return n.enableMacro("MATERIAL_NEED_WORLD_POS"),n.enableMacro("MATERIAL_NEED_TILING_OFFSET"),n.setColor(i._baseColorProp,new K(1,1,1,1)),n.setColor(i._emissiveColorProp,new K(0,0,0,1)),n.setVector4(i._tilingOffsetProp,new ue(1,1,0,0)),n.setFloat(i._normalIntensityProp,1),n.setFloat(i._occlusionTextureIntensityProp,1),n.setFloat(i._occlusionTextureCoordProp,na.UV0),n.setFloat(i._clearCoatProp,0),n.setFloat(i._clearCoatRoughnessProp,0),e}return q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(t){var e=this.shaderData.getColor(i._baseColorProp);t!==e&&e.copyFrom(t)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(t){this.shaderData.setTexture(i._baseTextureProp,t),t?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(i._normalTextureProp)},set:function(t){this.shaderData.setTexture(i._normalTextureProp,t),t?this.shaderData.enableMacro(i._normalTextureMacro):this.shaderData.disableMacro(i._normalTextureMacro)}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(i._normalIntensityProp)},set:function(t){this.shaderData.setFloat(i._normalIntensityProp,t)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(i._emissiveColorProp)},set:function(t){var e=this.shaderData.getColor(i._emissiveColorProp);t!==e&&e.copyFrom(t)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(i._emissiveTextureProp)},set:function(t){this.shaderData.setTexture(i._emissiveTextureProp,t),t?this.shaderData.enableMacro(i._emissiveTextureMacro):this.shaderData.disableMacro(i._emissiveTextureMacro)}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(i._occlusionTextureProp)},set:function(t){this.shaderData.setTexture(i._occlusionTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_OCCLUSION_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_OCCLUSION_TEXTURE")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(i._occlusionTextureIntensityProp)},set:function(t){this.shaderData.setFloat(i._occlusionTextureIntensityProp,t)}},{key:"occlusionTextureCoord",get:function(){return this.shaderData.getFloat(i._occlusionTextureCoordProp)},set:function(t){t>na.UV1&&me.warn("Occlusion texture uv coordinate must be UV0 or UV1."),this.shaderData.setFloat(i._occlusionTextureCoordProp,t)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(t){var e=this.shaderData.getVector4(i._tilingOffsetProp);t!==e&&e.copyFrom(t)}},{key:"clearCoat",get:function(){return this.shaderData.getFloat(i._clearCoatProp)},set:function(t){!!this.shaderData.getFloat(i._clearCoatProp)!=!!t&&(t===0?this.shaderData.disableMacro("MATERIAL_ENABLE_CLEAR_COAT"):this.shaderData.enableMacro("MATERIAL_ENABLE_CLEAR_COAT")),this.shaderData.setFloat(i._clearCoatProp,t)}},{key:"clearCoatTexture",get:function(){return this.shaderData.getTexture(i._clearCoatTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_CLEAR_COAT_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_CLEAR_COAT_TEXTURE")}},{key:"clearCoatRoughness",get:function(){return this.shaderData.getFloat(i._clearCoatRoughnessProp)},set:function(t){this.shaderData.setFloat(i._clearCoatRoughnessProp,t)}},{key:"clearCoatRoughnessTexture",get:function(){return this.shaderData.getTexture(i._clearCoatRoughnessTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatRoughnessTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_CLEAR_COAT_ROUGHNESS_TEXTURE")}},{key:"clearCoatNormalTexture",get:function(){return this.shaderData.getTexture(i._clearCoatNormalTextureProp)},set:function(t){this.shaderData.setTexture(i._clearCoatNormalTextureProp,t),t?this.shaderData.enableMacro("MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_CLEAR_COAT_NORMAL_TEXTURE")}}]),i}(et);(function(){Un._occlusionTextureIntensityProp=k.getByName("material_OcclusionIntensity")})();(function(){Un._occlusionTextureCoordProp=k.getByName("material_OcclusionTextureCoord")})();(function(){Un._occlusionTextureProp=k.getByName("material_OcclusionTexture")})();(function(){Un._clearCoatProp=k.getByName("material_ClearCoat")})();(function(){Un._clearCoatTextureProp=k.getByName("material_ClearCoatTexture")})();(function(){Un._clearCoatRoughnessProp=k.getByName("material_ClearCoatRoughness")})();(function(){Un._clearCoatRoughnessTextureProp=k.getByName("material_ClearCoatRoughnessTexture")})();(function(){Un._clearCoatNormalTextureProp=k.getByName("material_ClearCoatNormalTexture")})();var Zn=function(r){W(i,r);function i(t){var e;e=r.call(this,t,Le.find("pbr"))||this,e._anisotropyRotation=0;var n=e.shaderData;return n.setFloat(i._metallicProp,1),n.setFloat(i._roughnessProp,1),n.setFloat(i._iorProp,1.5),n.setVector3(i._anisotropyInfoProp,new P(1,0,0)),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"ior",get:function(){return this.shaderData.getFloat(i._iorProp)},set:function(e){this.shaderData.setFloat(i._iorProp,Math.max(e,0))}},{key:"metallic",get:function(){return this.shaderData.getFloat(i._metallicProp)},set:function(e){this.shaderData.setFloat(i._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(i._roughnessProp)},set:function(e){this.shaderData.setFloat(i._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(i._roughnessMetallicTextureProp)},set:function(e){this.shaderData.setTexture(i._roughnessMetallicTextureProp,e),e?this.shaderData.enableMacro("MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_ROUGHNESS_METALLIC_TEXTURE")}},{key:"anisotropy",get:function(){return this.shaderData.getVector3(i._anisotropyInfoProp).z},set:function(e){var n=this.shaderData.getVector3(i._anisotropyInfoProp);!!n.z!=!!e&&(e===0?this.shaderData.disableMacro("MATERIAL_ENABLE_ANISOTROPY"):this.shaderData.enableMacro("MATERIAL_ENABLE_ANISOTROPY")),n.z=e}},{key:"anisotropyRotation",get:function(){return this._anisotropyRotation},set:function(e){if(this._anisotropyRotation!==e){this._anisotropyRotation=e;var n=this.shaderData.getVector3(i._anisotropyInfoProp),o=U.degreeToRadFactor*e;n.x=Math.cos(o),n.y=Math.sin(o)}}},{key:"anisotropyTexture",get:function(){return this.shaderData.getTexture(i._anisotropyTextureProp)},set:function(e){this.shaderData.setTexture(i._anisotropyTextureProp,e),e?this.shaderData.enableMacro("MATERIAL_HAS_ANISOTROPY_TEXTURE"):this.shaderData.disableMacro("MATERIAL_HAS_ANISOTROPY_TEXTURE")}}]),i}(Un);(function(){Zn._metallicProp=k.getByName("material_Metal")})();(function(){Zn._roughnessProp=k.getByName("material_Roughness")})();(function(){Zn._roughnessMetallicTextureProp=k.getByName("material_RoughnessMetallicTexture")})();(function(){Zn._iorProp=k.getByName("material_IOR")})();(function(){Zn._anisotropyInfoProp=k.getByName("material_AnisotropyInfo")})();(function(){Zn._anisotropyTextureProp=k.getByName("material_AnisotropyTexture")})();var Ya=function(r){W(i,r);function i(t){var e;return e=r.call(this,t,Le.find("pbr-specular"))||this,e.shaderData.setColor(i._specularColorProp,new K(1,1,1,1)),e.shaderData.setFloat(i._glossinessProp,1),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"specularColor",get:function(){return this.shaderData.getColor(i._specularColorProp)},set:function(e){var n=this.shaderData.getColor(i._specularColorProp);e!==n&&n.copyFrom(e)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(i._glossinessProp)},set:function(e){this.shaderData.setFloat(i._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(i._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(i._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro(i._specularGlossinessTextureMacro):this.shaderData.disableMacro(i._specularGlossinessTextureMacro)}}]),i}(Un);(function(){Ya._specularColorProp=k.getByName("material_PBRSpecularColor")})();(function(){Ya._glossinessProp=k.getByName("material_Glossiness")})();(function(){Ya._specularGlossinessTextureProp=k.getByName("material_SpecularGlossinessTexture")})();(function(){Ya._specularGlossinessTextureMacro=se.getByName("MATERIAL_HAS_SPECULAR_GLOSSINESS_TEXTURE")})();var Qc=function(r){W(i,r);function i(t){var e;e=r.call(this,t,Le.find("unlit"))||this;var n=e.shaderData;return n.enableMacro("MATERIAL_OMIT_NORMAL"),n.enableMacro("MATERIAL_NEED_TILING_OFFSET"),n.setColor(i._baseColorProp,new K(1,1,1,1)),n.setVector4(i._tilingOffsetProp,new ue(1,1,0,0)),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(i._baseColorProp)},set:function(e){var n=this.shaderData.getColor(i._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(i._baseTextureProp)},set:function(e){this.shaderData.setTexture(i._baseTextureProp,e),e?this.shaderData.enableMacro(i._baseTextureMacro):this.shaderData.disableMacro(i._baseTextureMacro)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(i._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(i._tilingOffsetProp);e!==n&&n.copyFrom(e)}}]),i}(et),rC=function(){function r(){}var i=r.prototype;return i.initialize=function(t){var e=t.component,n=t.property.split(".");if(t.getProperty){var o=t.getProperty.split(".");this._initializeMounted(e,o,1),this._initializeMounted(e,n,2)}else this._initializeMounted(e,n,3)},i.getTargetValue=function(){switch(this._getType){case 2:return this._getMounted[this._getArrayIndex];case 1:return this._getMounted[this._getValueName].apply(this._getMounted,this._getArgs);case 0:return this._getMounted[this._getValueName]}},i.setTargetValue=function(t){switch(this._setType){case 2:this._setMounted[this._setArrayIndex]=t;break;case 1:var e=this._setArgs;e[this._replaceValueIndex]=t,this._setMounted[this._setValueName].apply(this._setMounted,e);break;case 0:this._setMounted[this._setValueName]=t;break}},i._initializeMounted=function(t,e,n){for(var o=e.length-1,s=0;s<o;s++){var l=e[s];if(l.indexOf("[")>-1){var c=l.indexOf("[");t=t[l.slice(0,c)],t=t[parseInt(l.slice(c+1,-1))]}else if(l.endsWith(")")){var u=l.slice(0,l.indexOf("(")),d=l.match(/\w+\(([^)]*)\)/)[1].split(",").map(function(m){return m.trim().replace(/['"]+/g,"")}).filter(function(m){return m!==""});t=t[u].apply(t,d)}else t=t[l]}var f=e[o],h,_,g,y;if(f.indexOf("[")>-1){var v=f.indexOf("[");h=2,t=t[f.slice(0,v)],_=parseInt(f.slice(v+1,-1))}else if(f.endsWith(")")){if(g=f.slice(0,f.indexOf("(")),y=f.match(/\w+\(([^)]*)\)/)[1].split(",").map(function(m){return m.trim().replace(/['"]+/g,"")}).filter(function(m){return m!==""}),h=1,n&2){var p=y.indexOf("$value");this._replaceValueIndex=p>-1?p:y.length}}else h=0;n&2&&(this._setMounted=t,this._setType=h,this._setArrayIndex=_,this._setValueName=f,g&&(this._setValueName=g),this._setArgs=y),n&1&&(this._getMounted=t,this._getType=h,this._getArrayIndex=_,this._getValueName=f,g&&(this._getValueName=g),this._getArgs=y)},r}(),Sp;(function(r){r[r.Property=0]="Property",r[r.Method=1]="Method",r[r.Array=2]="Array"})(Sp||(Sp={}));var Cp;(function(r){r[r.Get=1]="Get",r[r.Set=2]="Set",r[r.Both=3]="Both"})(Cp||(Cp={}));var Bi=function(){function r(a,t,e,n,o,s){this.baseEvaluateData={curKeyframeIndex:0,value:null},this.crossEvaluateData={curKeyframeIndex:0,value:null},this.updateMark=0,this.target=a,this.property=n,this.getProperty=o,this.component=e,this.cureType=s;var l=r.getAssemblerType(t,n);this._assembler=new l,this._assembler.initialize(this),s._isCopyMode&&(this.referenceTargetValue=this._assembler.getTargetValue())}var i=r.prototype;return i.evaluateValue=function(t,e,n){return n?t._evaluateAdditive(e,this.baseEvaluateData):t._evaluate(e,this.baseEvaluateData)},i.evaluateCrossFadeValue=function(t,e,n,o,s,l){if(!this.cureType._supportInterpolationMode)return this.evaluateValue(e,o,!1);var c=t&&t.keys.length?l?t._evaluateAdditive(n,this.baseEvaluateData):t._evaluate(n,this.baseEvaluateData):l?this.cureType._getZeroValue(this.baseEvaluateData.value):this.defaultValue,u=e&&e.keys.length?l?e._evaluateAdditive(o,this.crossEvaluateData):e._evaluate(o,this.crossEvaluateData):l?this.cureType._getZeroValue(this.crossEvaluateData.value):this.defaultValue;return this._lerpValue(c,u,s)},i.crossFadeFromPoseAndApplyValue=function(t,e,n,o){if(!this.cureType._supportInterpolationMode)return this.evaluateValue(t,e,!1);var s=o?this.cureType._subtractValue(this.fixedPoseValue,this.defaultValue,this.baseEvaluateData.value):this.fixedPoseValue,l=t&&t.keys.length?o?t._evaluateAdditive(e,this.crossEvaluateData):t._evaluate(e,this.crossEvaluateData):o?this.cureType._getZeroValue(this.crossEvaluateData.value):this.defaultValue;return this._lerpValue(s,l,n)},i.revertDefaultValue=function(){this._assembler.setTargetValue(this.defaultValue)},i.getEvaluateValue=function(t){return this.cureType._isCopyMode?(this.cureType._setValue(this.baseEvaluateData.value,t),t):this.baseEvaluateData.value},i.saveDefaultValue=function(){this.cureType._isCopyMode?this.cureType._setValue(this.referenceTargetValue,this.defaultValue):this.defaultValue=this._assembler.getTargetValue()},i.saveFixedPoseValue=function(){this.cureType._isCopyMode?this.cureType._setValue(this.referenceTargetValue,this.fixedPoseValue):this.fixedPoseValue=this._assembler.getTargetValue()},i.applyValue=function(t,e,n){var o=this.cureType;if(n){var s=this._assembler;if(o._isCopyMode)o._additiveValue(t,e,this.referenceTargetValue);else{var l=s.getTargetValue(),c=o._additiveValue(t,e,l);s.setTargetValue(c)}}else if(e===1)o._isCopyMode?o._setValue(t,this.referenceTargetValue):this._assembler.setTargetValue(t);else if(o._isCopyMode){var u=this.referenceTargetValue;o._lerpValue(u,t,e,u)}else{var d=this._assembler.getTargetValue(),f=o._lerpValue(d,t,e);this._assembler.setTargetValue(f)}},i._lerpValue=function(t,e,n){return this.cureType._isCopyMode?this.cureType._lerpValue(t,e,n,this.baseEvaluateData.value):(this.baseEvaluateData.value=this.cureType._lerpValue(t,e,n),this.baseEvaluateData.value)},r.registerAssembler=function(t,e,n){var o=r._assemblerMap.get(t);o||(o={},r._assemblerMap.set(t,o)),o[e]=n},r.getAssemblerType=function(t,e){var n=r._assemblerMap.get(t),o=n?n[e]:void 0;return o??rC},r}();(function(){Bi._components=[]})();(function(){Bi._assemblerMap=new Map})();var nC=function(){function r(){}var i=r.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.position},i.setTargetValue=function(t){this._transform.position=t},r}();Bi.registerAssembler(ye,"position",nC);var iC=function(){function r(){}var i=r.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.rotationQuaternion},i.setTargetValue=function(t){this._transform.rotationQuaternion=t},r}();Bi.registerAssembler(ye,"rotationQuaternion",iC);var aC=function(){function r(){}var i=r.prototype;return i.initialize=function(t){this._transform=t.target.transform},i.getTargetValue=function(){return this._transform.scale},i.setTargetValue=function(t){this._transform.scale=t},r}();Bi.registerAssembler(ye,"scale",aC);var oC=function(){function r(){}var i=r.prototype;return i.initialize=function(t){this._skinnedMeshRenderer=t.component},i.getTargetValue=function(){return this._skinnedMeshRenderer.blendShapeWeights},i.setTargetValue=function(t){this._skinnedMeshRenderer.blendShapeWeights=t},r}();Bi.registerAssembler(Jt,"blendShapeWeights",oC);var sC=function(){function r(){this.crossCurveMark=0,this.isActive=!0}var i=r.prototype;return i.initFinalValue=function(){var t=this.curveOwner,e=t.cureType,n=t.defaultValue;e._isCopyMode?e._setValue(n,this.finalValue):this.finalValue=n},i.saveFinalValue=function(){this.finalValue=this.curveOwner.getEvaluateValue(this.finalValue)},r}(),bm=function(){function r(){this.typeIndex=0,this._tempCurveOwner={}}var i=r.prototype;return i._createCurveOwner=function(t,e){var n=this.curve.constructor,o=new Bi(t,this.type,e,this.property,this.getProperty,n);return n._initializeOwner(o),o.saveDefaultValue(),o},i._createCurveLayerOwner=function(t){var e=this.curve.constructor,n=new sC;return n.curveOwner=t,e._initializeLayerOwner(n),n.initFinalValue(),n},i._getTempCurveOwner=function(t,e){var n=t.instanceId;return this._tempCurveOwner[n]||(this._tempCurveOwner[n]=this._createCurveOwner(t,e)),this._tempCurveOwner[n]},r}(),Bu=function(){},Vh=function(r){W(i,r);function i(t){var e;return e=r.call(this,null)||this,e.name=t,e._curveBindings=[],e._updateFlagManager=new On,e._length=0,e._events=[],e}var a=i.prototype;return a.addEvent=function(e,n,o){var s;if(typeof e=="string"){var l=new Bu;l.functionName=e,l.time=n,l.parameter=o,s=l}else s=e;var c=this._events,u=c.length,d=s.time,f=u?c[u-1].time:0;if(d>=f)c.push(s);else{for(var h=u;--h>=0&&d<c[h].time;);c.splice(h+1,0,s)}this._updateFlagManager.dispatch()},a.clearEvents=function(){this._events.length=0,this._updateFlagManager.dispatch()},a.addCurveBinding=function(e,n,o,s,l,c){var u=new bm;u.relativePath=e,u.type=n,typeof o=="number"?(u.typeIndex=o,u.property=s,typeof l=="string"?(u.getProperty=l,u.curve=c):u.curve=l):(u.property=o,typeof s=="string"?(u.getProperty=s,u.curve=l):u.curve=s),this._length=Math.max(this._length,u.curve.length),this._curveBindings.push(u)},a.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},a._sampleAnimation=function(e,n){for(var o=this,s=o._curveBindings,l=s.length-1;l>=0;l--){var c=s[l],u=e.findByPath(c.relativePath);if(u){var d=c.typeIndex>0?u.getComponents(c.type,Bi._components)[c.typeIndex]:u.getComponent(c.type);if(!d)continue;var f=c._getTempCurveOwner(u,d);if(f&&c.curve.keys.length){var h=f.evaluateValue(c.curve,n,!1);f.applyValue(h,1,!1)}}}},q(i,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),i}(ri),Gt;(function(r){r[r.Linear=0]="Linear",r[r.CubicSpine=1]="CubicSpine",r[r.Step=2]="Step",r[r.Hermite=3]="Hermite"})(Gt||(Gt={}));var $r=function(){function r(){this.keys=[],this._evaluateData={curKeyframeIndex:0,value:null},this._length=0;var a=this.constructor;this._interpolation=a._supportInterpolationMode?Gt.Linear:Gt.Step,this._type=a}var i=r.prototype;return i.addKey=function(t){var e=t.time,n=this.keys;if(e>=this._length)n.push(t),this._length=e;else{for(var o=n.length;--o>=0&&e<n[o].time;);n.splice(o+1,0,t)}},i.evaluate=function(t){return this._evaluate(t,this._evaluateData)},i.removeKey=function(t){this.keys.splice(t,1);for(var e=this.keys,n=0,o=e.length-1;o>=0;o--){var s=e[o];s.time>this._length&&(n=s.time)}this._length=n},i._evaluate=function(t,e){var n=this.keys.length;if(!n){console.warn("This curve don't have any keyframes: ",this);return}var o=this,s=o.keys,l=o.interpolation,c=e.curKeyframeIndex;c!==-1&&(c>=n||t<s[c].time)&&(c=-1);for(var u=c+1;u<n&&!(t<s[u].time);)c++,u++;e.curKeyframeIndex=c;var d;if(c===-1)d=this._type._setValue(s[0].value,e.value);else if(u===n)d=this._type._setValue(s[c].value,e.value);else{var f=s[c],h=s[u],_=f.time,g=h.time-_,y=(t-_)/g;switch(l){case Gt.Linear:d=this._type._lerpValue(f.value,h.value,y,e.value);break;case Gt.Step:d=this._type._setValue(f.value,e.value);break;case Gt.CubicSpine:case Gt.Hermite:d=this._type._hermiteInterpolationValue(f,h,y,g,e.value);break}}return e.value=d,d},i._evaluateAdditive=function(t,e){var n=this._evaluate(t,e);return this._type._subtractValue(n,this.keys[0].value,e.value)},q(r,[{key:"interpolation",get:function(){return this._interpolation},set:function(t){!this._type._supportInterpolationMode&&t!==Gt.Step?(this._interpolation=Gt.Step,console.warn("The interpolation type must be `InterpolationType.Step`.")):this._interpolation=t}},{key:"length",get:function(){return this._length}}]),r}(),zl,jc=(zl=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=[],a}return i._initializeOwner=function(t){t.defaultValue=[],t.fixedPoseValue=[],t.baseEvaluateData.value=[],t.crossEvaluateData.value=[]},i._initializeLayerOwner=function(t){t.finalValue=[]},i._lerpValue=function(t,e,n,o){for(var s=0,l=o.length;s<l;++s){var c=t[s];o[s]=c+(e[s]-c)*n}return o},i._subtractValue=function(t,e,n){for(var o=0,s=t.length;o<s;o++)n[o]=t[o]-e[o];return n},i._getZeroValue=function(t){for(var e=0,n=t.length;e<n;e++)t[e]=0;return t},i._additiveValue=function(t,e,n){for(var o=0,s=n.length;o<s;++o)n[o]+=t[o]*e;return n},i._setValue=function(t,e){for(var n=0,o=e.length;n<o;++n)e[n]=t[n];return e},i._hermiteInterpolationValue=function(t,e,n,o,s){for(var l=t.outTangent,c=e.inTangent,u=t.value,d=e.value,f=n*n,h=f*n,_=2*h-3*f+1,g=h-2*f+n,y=h-f,v=-2*h+3*f,p=0,m=u.length;p<m;++p)Number.isFinite(l[p])&&Number.isFinite(c[p])?s[p]=_*u[p]+g*l[p]*o+y*c[p]*o+v*d[p]:s[p]=t.value[p];return s},i}($r),function(){zl._isCopyMode=!0}(),function(){zl._supportInterpolationMode=!0}(),zl);jc=R([Sr()],jc);var kl,Xc=(kl=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=!1,a}return i._initializeOwner=function(t){t.defaultValue=!1,t.fixedPoseValue=!1,t.baseEvaluateData.value=!1,t.crossEvaluateData.value=!1},i._initializeLayerOwner=function(t){t.finalValue=!1},i._lerpValue=function(t,e){return t},i._subtractValue=function(t,e,n){return t},i._getZeroValue=function(){return!1},i._additiveValue=function(t,e,n){return t},i._setValue=function(t){return t},i._hermiteInterpolationValue=function(t){return t.value},i}($r),function(){kl._isCopyMode=!1}(),function(){kl._supportInterpolationMode=!1}(),kl);Xc=R([Sr()],Xc);var Ul,Yc=(Ul=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=new K,a}return i._initializeOwner=function(t){t.defaultValue=new K,t.fixedPoseValue=new K,t.baseEvaluateData.value=new K,t.crossEvaluateData.value=new K},i._initializeLayerOwner=function(t){t.finalValue=new K},i._lerpValue=function(t,e,n,o){return K.lerp(t,e,n,o),o},i._subtractValue=function(t,e,n){return K.subtract(t,e,n),n},i._getZeroValue=function(t){return t.set(0,0,0,0),t},i._additiveValue=function(t,e,n){return K.scale(t,e,t),K.add(n,t,n),n},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,n,o,s){var l=t.value,c=t.outTangent,u=e.value,d=e.inTangent,f=n*n,h=f*n,_=2*h-3*f+1,g=h-2*f+n,y=h-f,v=-2*h+3*f,p=c.x,m=d.x;return Number.isFinite(p)&&Number.isFinite(m)?s.r=_*l.r+g*p*o+y*m*o+v*u.r:s.r=l.r,p=c.y,m=d.y,Number.isFinite(p)&&Number.isFinite(m)?s.g=_*l.g+g*p*o+y*m*o+v*u.g:s.g=l.g,p=c.z,m=d.z,Number.isFinite(p)&&Number.isFinite(m)?s.b=_*l.b+g*p*o+y*m*o+v*u.b:s.b=l.b,p=c.w,m=d.w,Number.isFinite(p)&&Number.isFinite(m)?s.a=_*l.a+g*p*o+y*m*o+v*u.a:s.a=l.a,s},i}($r),function(){Ul._isCopyMode=!0}(),function(){Ul._supportInterpolationMode=!0}(),Ul);Yc=R([Sr()],Yc);var Gl,Ks=(Gl=function(r){W(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.addKey=function(e){r.prototype.addKey.call(this,e);var n=this._evaluateData;if(!n.value||n.value.length!==e.value.length){var o=e.value.length;n.value=new Float32Array(o)}},i._initializeOwner=function(e){var n=e.referenceTargetValue.length;e.defaultValue=new Float32Array(n),e.fixedPoseValue=new Float32Array(n),e.baseEvaluateData.value=new Float32Array(n),e.crossEvaluateData.value=new Float32Array(n)},i._initializeLayerOwner=function(e){var n=e.curveOwner.referenceTargetValue.length;e.finalValue=new Float32Array(n)},i._lerpValue=function(e,n,o,s){for(var l=0,c=s.length;l<c;++l){var u=e[l];s[l]=u+(n[l]-u)*o}return s},i._subtractValue=function(e,n,o){for(var s=0,l=e.length;s<l;s++)o[s]=e[s]-n[s];return o},i._getZeroValue=function(e){for(var n=0,o=e.length;n<o;n++)e[n]=0;return e},i._additiveValue=function(e,n,o){for(var s=0,l=o.length;s<l;++s)o[s]+=e[s]*n;return o},i._setValue=function(e,n){for(var o=0,s=n.length;o<s;++o)n[o]=e[o];return n},i._hermiteInterpolationValue=function(e,n,o,s,l){for(var c=e.outTangent,u=n.inTangent,d=e.value,f=n.value,h=o*o,_=h*o,g=2*_-3*h+1,y=_-2*h+o,v=_-h,p=-2*_+3*h,m=0,A=d.length;m<A;++m)Number.isFinite(c[m])&&Number.isFinite(u[m])?l[m]=g*d[m]+y*c[m]*s+v*u[m]*s+p*f[m]:l[m]=e.value[m];return l},i}($r),function(){Gl._isCopyMode=!0}(),function(){Gl._supportInterpolationMode=!0}(),Gl);Ks=R([Sr()],Ks);var Hl,qc=(Hl=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=0,a}return i._initializeOwner=function(t){t.defaultValue=0,t.fixedPoseValue=0,t.baseEvaluateData.value=0,t.crossEvaluateData.value=0},i._initializeLayerOwner=function(t){t.finalValue=0},i._lerpValue=function(t,e,n){return t+(e-t)*n},i._additiveValue=function(t,e,n){return n+=t*e},i._subtractValue=function(t,e){return t-e},i._getZeroValue=function(){return 0},i._setValue=function(t){return t},i._hermiteInterpolationValue=function(t,e,n,o){var s=t.outTangent,l=e.inTangent;if(Number.isFinite(s)&&Number.isFinite(l)){var c=n*n,u=c*n,d=2*u-3*c+1,f=u-2*c+n,h=u-c,_=-2*u+3*c;return d*t.value+f*s*o+h*l*o+_*e.value}else return t.value},i}($r),function(){Hl._isCopyMode=!1}(),function(){Hl._supportInterpolationMode=!0}(),Hl);qc=R([Sr()],qc);var rs,zo=(rs=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=new xe,a}return i._initializeOwner=function(t){t.defaultValue=new xe,t.fixedPoseValue=new xe,t.baseEvaluateData.value=new xe,t.crossEvaluateData.value=new xe},i._initializeLayerOwner=function(t){t.finalValue=new xe},i._lerpValue=function(t,e,n,o){return xe.slerp(t,e,n,o),o},i._additiveValue=function(t,e,n){return t.x=t.x*e,t.y=t.y*e,t.z=t.z*e,t.normalize(),n.multiply(t),n},i._subtractValue=function(t,e,n){var o=zo._tempConjugateQuat;return xe.conjugate(e,o),xe.multiply(o,t,n),n},i._getZeroValue=function(t){return t.set(0,0,0,1),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,n,o,s){var l=t.value,c=t.outTangent,u=e.value,d=e.inTangent,f=n*n,h=f*n,_=2*h-3*f+1,g=h-2*f+n,y=h-f,v=-2*h+3*f,p=c.x,m=d.x;return Number.isFinite(p)&&Number.isFinite(m)?s.x=_*l.x+g*p*o+y*m*o+v*u.x:s.x=l.x,p=c.y,m=d.y,Number.isFinite(p)&&Number.isFinite(m)?s.y=_*l.y+g*p*o+y*m*o+v*u.y:s.y=l.y,p=c.z,m=d.z,Number.isFinite(p)&&Number.isFinite(m)?s.z=_*l.z+g*p*o+y*m*o+v*u.z:s.z=l.z,p=c.w,m=d.w,Number.isFinite(p)&&Number.isFinite(m)?s.w=_*l.w+g*p*o+y*m*o+v*u.w:s.w=l.w,s},i}($r),function(){rs._supportInterpolationMode=!0}(),function(){rs._isCopyMode=!0}(),function(){rs._tempConjugateQuat=new xe}(),rs);zo=R([Sr()],zo);var Wl,Kc=(Wl=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=new te,a}return i._initializeOwner=function(t){t.defaultValue=new te,t.fixedPoseValue=new te,t.baseEvaluateData.value=new te,t.crossEvaluateData.value=new te},i._initializeLayerOwner=function(t){t.finalValue=new te},i._lerpValue=function(t,e,n,o){return te.lerp(t,e,n,o),o},i._additiveValue=function(t,e,n){return te.scale(t,e,t),te.add(n,t,n),n},i._subtractValue=function(t,e,n){return te.subtract(t,e,n),n},i._getZeroValue=function(t){return t.set(0,0),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,n,o,s){var l=t.value,c=t.outTangent,u=e.value,d=e.inTangent,f=n*n,h=f*n,_=2*h-3*f+1,g=h-2*f+n,y=h-f,v=-2*h+3*f,p=c.x,m=d.x;return Number.isFinite(p)&&Number.isFinite(m)?s.x=_*l.x+g*p*o+y*m*o+v*u.x:s.x=l.x,p=c.y,m=d.y,Number.isFinite(p)&&Number.isFinite(m)?s.y=_*l.y+g*p*o+y*m*o+v*u.y:s.y=l.y,s},i}($r),function(){Wl._isCopyMode=!0}(),function(){Wl._supportInterpolationMode=!0}(),Wl);Kc=R([Sr()],Kc);var Ql,Js=(Ql=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=new P,a}return i._initializeOwner=function(t){t.defaultValue=new P,t.fixedPoseValue=new P,t.baseEvaluateData.value=new P,t.crossEvaluateData.value=new P},i._initializeLayerOwner=function(t){t.finalValue=new P},i._lerpValue=function(t,e,n,o){return P.lerp(t,e,n,o),o},i._relativeBaseValue=function(t,e){return P.subtract(e,t,e),e},i._additiveValue=function(t,e,n){return P.scale(t,e,t),P.add(n,t,n),n},i._subtractValue=function(t,e,n){return P.subtract(t,e,n),n},i._getZeroValue=function(t){return t.set(0,0,0),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,n,o,s){var l=t.value,c=t.outTangent,u=e.value,d=e.inTangent,f=n*n,h=f*n,_=2*h-3*f+1,g=h-2*f+n,y=h-f,v=-2*h+3*f,p=c.x,m=d.x;return Number.isFinite(p)&&Number.isFinite(m)?s.x=_*l.x+g*p*o+y*m*o+v*u.x:s.x=l.x,p=c.y,m=d.y,Number.isFinite(p)&&Number.isFinite(m)?s.y=_*l.y+g*p*o+y*m*o+v*u.y:s.y=l.y,p=c.z,m=d.z,Number.isFinite(p)&&Number.isFinite(m)?s.z=_*l.z+g*p*o+y*m*o+v*u.z:s.z=l.z,s},i}($r),function(){Ql._isCopyMode=!0}(),function(){Ql._supportInterpolationMode=!0}(),Ql);Js=R([Sr()],Js);var jl,Jc=(jl=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=new ue,a}return i._initializeOwner=function(t){t.defaultValue=new ue,t.fixedPoseValue=new ue,t.baseEvaluateData.value=new ue,t.crossEvaluateData.value=new ue},i._initializeLayerOwner=function(t){t.finalValue=new ue},i._lerpValue=function(t,e,n,o){return ue.lerp(t,e,n,o),o},i._additiveValue=function(t,e,n){return ue.scale(t,e,t),ue.add(n,t,n),n},i._subtractValue=function(t,e,n){return ue.subtract(t,e,n),n},i._getZeroValue=function(t){return t.set(0,0,0,0),t},i._setValue=function(t,e){return e.copyFrom(t),e},i._hermiteInterpolationValue=function(t,e,n,o,s){var l=t.value,c=t.outTangent,u=e.value,d=e.inTangent,f=n*n,h=f*n,_=2*h-3*f+1,g=h-2*f+n,y=h-f,v=-2*h+3*f,p=c.x,m=d.x;return Number.isFinite(p)&&Number.isFinite(m)?s.x=_*l.x+g*p*o+y*m*o+v*u.x:s.x=l.x,p=c.y,m=d.y,Number.isFinite(p)&&Number.isFinite(m)?s.y=_*l.y+g*p*o+y*m*o+v*u.y:s.y=l.y,p=c.z,m=d.z,Number.isFinite(p)&&Number.isFinite(m)?s.z=_*l.z+g*p*o+y*m*o+v*u.z:s.z=l.z,p=c.w,m=d.w,Number.isFinite(p)&&Number.isFinite(m)?s.w=_*l.w+g*p*o+y*m*o+v*u.w:s.w=l.w,s},i}($r),function(){jl._isCopyMode=!0}(),function(){jl._supportInterpolationMode=!0}(),jl);Jc=R([Sr()],Jc);var Xl,Zc=(Xl=function(r){W(i,r);function i(){return r.call(this)}return i._initializeOwner=function(t){},i._initializeLayerOwner=function(t){},i._setValue=function(t){return t},i}($r),function(){Xl._isCopyMode=!1}(),function(){Xl._supportInterpolationMode=!1}(),Xl);Zc=R([Sr()],Zc);var Yl,Af=(Yl=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value=new Mn,a}return i._initializeOwner=function(t){t.defaultValue=new Mn,t.fixedPoseValue=new Mn,t.baseEvaluateData.value=new Mn,t.crossEvaluateData.value=new Mn},i._initializeLayerOwner=function(t){t.finalValue=new Mn},i._setValue=function(t,e){return e.copyFrom(t),e},i}($r),function(){Yl._isCopyMode=!0}(),function(){Yl._supportInterpolationMode=!1}(),Yl);Af=R([Sr()],Af);var ql,$c=(ql=function(r){W(i,r);function i(){var a;return a=r.call(this)||this,a._evaluateData.value="",a}return i._initializeOwner=function(t){t.defaultValue="",t.fixedPoseValue="",t.baseEvaluateData.value="",t.crossEvaluateData.value=""},i._initializeLayerOwner=function(t){t.finalValue=""},i._lerpValue=function(t,e){return t},i._subtractValue=function(t,e,n){return t},i._getZeroValue=function(){return""},i._additiveValue=function(t,e,n){return t},i._setValue=function(t){return t},i._hermiteInterpolationValue=function(t){return t.value},i}($r),function(){ql._isCopyMode=!1}(),function(){ql._supportInterpolationMode=!1}(),ql);$c=R([Sr()],$c);var Zs;(function(r){r[r.None=0]="None",r[r.Complete=1]="Complete"})(Zs||(Zs={}));var $s;(function(r){r[r.Override=0]="Override",r[r.Additive=1]="Additive"})($s||($s={}));var It;(function(r){r[r.UnStarted=0]="UnStarted",r[r.Playing=1]="Playing",r[r.Finished=2]="Finished"})(It||(It={}));var lt;(function(r){r[r.Standby=0]="Standby",r[r.Playing=1]="Playing",r[r.CrossFading=2]="CrossFading",r[r.FixedCrossFading=3]="FixedCrossFading",r[r.Finished=4]="Finished"})(lt||(lt={}));var lC=function(){function r(){this.handlers=[]}var i=r.prototype;return i.dispose=function(){},r}(),Oh=function(){this.duration=0,this.offset=0,this.exitTime=1},el;(function(r){r[r.Once=0]="Once",r[r.Loop=1]="Loop"})(el||(el={}));var bp=function(){function r(){}var i=r.prototype;return i.reset=function(t,e,n){this.state=t,this.frameTime=n,this.stateData=e,this.playState=It.UnStarted,this.clipTime=t.clipStartTime*t.clip.length,this.currentEventIndex=0,this.currentTransitionIndex=0},i.update=function(t){var e=this.state,n=this.frameTime,o=e._getDuration();this.playState=It.Playing,e.wrapMode===el.Loop?n=o?n%o:0:Math.abs(n)>o&&(n=n<0?-o:o,this.playState=It.Finished),t&&n===0?this.clipTime=e.clipEndTime*e.clip.length:(n<0&&(n+=o),this.clipTime=n+e.clipStartTime*e.clip.length)},r}(),cC=function(){function r(){this.curveOwnerPool=Object.create(null),this.animatorStateDataMap={},this.srcPlayData=new bp,this.destPlayData=new bp,this.layerState=lt.Standby,this.crossCurveMark=0,this.manuallyTransition=new Oh,this.crossLayerOwnerCollection=[]}var i=r.prototype;return i.switchPlayData=function(){var t=this.destPlayData,e=this.srcPlayData;this.srcPlayData=t,this.destPlayData=e},r}(),uC=function(){this.curveLayerOwner=[],this.eventHandlers=[]},ai=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e.cullingMode=Zs.None,e.speed=1,e._playFrameCount=-1,e._onUpdateIndex=-1,e._updateMark=0,e._animatorLayersData=[],e._curveOwnerPool=Object.create(null),e._animationEventHandlerPool=new Sa(lC),e._tempAnimatorStateInfo={layerIndex:-1,state:null},e._controlledRenderers=[],e}var a=i.prototype;return a.play=function(e,n,o){n===void 0&&(n=-1),o===void 0&&(o=0);var s;(s=this._controllerUpdateFlag)!=null&&s.flag&&this._reset(),this._playFrameCount=this.engine.time.frameCount;var l=this._getAnimatorStateInfo(e,n),c=l.state,u=l.layerIndex;if(c){if(!c.clip){me.warn("The state named "+e+" has no AnimationClip data.");return}var d=this._getAnimatorLayerData(u),f=this._getAnimatorStateData(e,c,d,u);this._preparePlay(d,c),d.layerState=lt.Playing,d.srcPlayData.reset(c,f,c._getDuration()*o),this.update(0)}},a.crossFade=function(e,n,o,s){o===void 0&&(o=-1),s===void 0&&(s=0);var l;(l=this._controllerUpdateFlag)!=null&&l.flag&&this._reset(),this._playFrameCount=this.engine.time.frameCount;var c=this._getAnimatorStateInfo(e,o),u=c.state,d=c.layerIndex,f=this._getAnimatorLayerData(d).manuallyTransition;f.duration=n,f.offset=s,f.destinationState=u,this._crossFadeByTransition(f,d)&&this.update(0)},a.update=function(e){var n,o;if(this.cullingMode===Zs.Complete){o=!1;for(var s=this._controlledRenderers,l=0,c=s.length;l<c;l++)if(!s[l].isCulled){o=!0;break}}else o=!0;var u=this,d=u._animatorController;if(d){if((n=this._controllerUpdateFlag)!=null&&n.flag){this._checkAutoPlay();return}this._updateMark++;for(var f=0,h=d.layers.length;f<h;f++){var _=this._getAnimatorLayerData(f);_.layerState!==lt.Standby&&this._updateLayer(f,f===0,e,o)}}},a.getCurrentAnimatorState=function(e){var n,o;return(o=this._animatorLayersData[e])==null||(n=o.srcPlayData)==null?void 0:n.state},a.findAnimatorState=function(e,n){return n===void 0&&(n=-1),this._getAnimatorStateInfo(e,n).state},a._onEnable=function(){this.animatorController&&this._checkAutoPlay(),this._entity.getComponentsIncludeChildren(Ce,this._controlledRenderers)},a._onEnableInScene=function(){this.scene._componentsManager.addOnUpdateAnimations(this)},a._onDisableInScene=function(){this.scene._componentsManager.removeOnUpdateAnimations(this)},a._reset=function(){var e=this,n=e._curveOwnerPool;for(var o in n){var s=n[o];for(var l in s){var c=s[l];c.revertDefaultValue()}}this._animatorLayersData.length=0,this._curveOwnerPool={},this._animationEventHandlerPool.resetPool(),this._controllerUpdateFlag&&(this._controllerUpdateFlag.flag=!1)},a._getAnimatorStateInfo=function(e,n){var o=this,s=o._animatorController,l=o._tempAnimatorStateInfo,c=null;if(s){var u=s.layers;if(n===-1){for(var d=0,f=u.length;d<f;d++)if(c=u[d].stateMachine.findStateByName(e),c){n=d;break}}else c=u[n].stateMachine.findStateByName(e)}return l.layerIndex=n,l.state=c,l},a._getAnimatorStateData=function(e,n,o,s){var l=o.animatorStateDataMap,c=l[e];return c||(c=new uC,l[e]=c,this._saveAnimatorStateData(n,c,o,s),this._saveAnimatorEventHandlers(n,c)),c},a._saveAnimatorStateData=function(e,n,o,s){for(var l=this,c=l.entity,u=l._curveOwnerPool,d=this._animatorController.layers[s].mask,f=n.curveLayerOwner,h=e.clip,_=h._curveBindings,g=o.curveOwnerPool,y=_.length-1;y>=0;y--){var v=_[y],p=v.relativePath,m=v.relativePath===""?c:c.findByPath(v.relativePath);if(m){var A,S,x,b,C,w,E,T,M=""+v.typeIndex+"."+v.property,B=v.typeIndex>0?m.getComponents(v.type,Bi._components)[v.typeIndex]:m.getComponent(v.type);if(!B)continue;var I=v.property,F=m.instanceId,L=(A=u)[S=F]||(A[S]=Object.create(null)),V=(x=L)[b=I]||(x[b]=v._createCurveOwner(m,B)),D=(C=g)[w=F]||(C[w]=Object.create(null)),N=(E=D)[T=M]||(E[T]=v._createCurveLayerOwner(V));d&&d.pathMasks.length&&(N.isActive=d.getPathMask(p).active),f[y]=N}else f[y]=null,me.warn("The entity don't have the child entity which path is "+v.relativePath+".")}},a._saveAnimatorEventHandlers=function(e,n){var o=this,s=this._animationEventHandlerPool,l=[],c=n.eventHandlers,u=function(){o._entity.getComponents(Bt,l);var d=l.length,f=e.clip.events;c.length=0;for(var h=0,_=f.length;h<_;h++){var g=f[h],y=s.getFromPool(),v=g.functionName,p=y.handlers;y.event=g,p.length=0;for(var m=d-1;m>=0;m--){var A=l[m][v];A&&p.push(A)}c.push(y)}};u(),e._updateFlagManager.addListener(u)},a._clearCrossData=function(e){e.crossCurveMark++,e.crossLayerOwnerCollection.length=0},a._addCrossOwner=function(e,n,o,s){n.crossSrcCurveIndex=o,n.crossDestCurveIndex=s,e.crossLayerOwnerCollection.push(n)},a._prepareCrossFading=function(e){this._prepareSrcCrossData(e,!1),this._prepareDestCrossData(e,!1)},a._prepareStandbyCrossFading=function(e){e.srcPlayData.state&&this._prepareSrcCrossData(e,!0),this._prepareDestCrossData(e,!0)},a._prepareFixedPoseCrossFading=function(e){for(var n=e.crossLayerOwnerCollection,o=n.length-1;o>=0;o--){var s=n[o];s&&(s.curveOwner.saveFixedPoseValue(),s.crossDestCurveIndex=-1)}this._prepareDestCrossData(e,!0)},a._prepareSrcCrossData=function(e,n){for(var o=e.srcPlayData.stateData.curveLayerOwner,s=o.length-1;s>=0;s--){var l=o[s];l&&(l.crossCurveMark=e.crossCurveMark,n&&l.curveOwner.saveFixedPoseValue(),this._addCrossOwner(e,l,s,-1))}},a._prepareDestCrossData=function(e,n){for(var o=e.destPlayData.stateData.curveLayerOwner,s=o.length-1;s>=0;s--){var l=o[s];if(l)if(l.crossCurveMark===e.crossCurveMark)l.crossDestCurveIndex=s;else{var c=l.curveOwner;n&&c.saveFixedPoseValue(),l.crossCurveMark=e.crossCurveMark,this._addCrossOwner(e,l,-1,s)}}},a._getAnimatorLayerData=function(e){var n=this._animatorLayersData[e];return n||(this._animatorLayersData[e]=n=new cC),n},a._updateLayer=function(e,n,o,s){var l=this._animatorController.layers[e],c=l.blendingMode,u=l.weight,d=this._animatorLayersData[e],f=d.srcPlayData,h=d.destPlayData,_=c===$s.Additive;switch(n&&(u=1),d.layerState){case lt.Playing:this._updatePlayingState(f,d,e,u,o,_,s);break;case lt.FixedCrossFading:this._updateCrossFadeFromPose(h,d,e,u,o,_,s);break;case lt.CrossFading:this._updateCrossFade(f,h,d,e,u,o,_,s);break;case lt.Finished:this._updateFinishedState(f,u,_,s);break}},a._updatePlayingState=function(e,n,o,s,l,c,u){var d=e.stateData,f=d.curveLayerOwner,h=d.eventHandlers,_=e.state,g=e.playState,y=e.clipTime,v=_.transitions,p=_.clip,m=p._curveBindings,A=_.speed*this.speed;e.frameTime+=A*l,e.update(A<0);var S=e.clipTime,x=e.playState,b=x===It.Finished;if(u||b)for(var C=m.length-1;C>=0;C--){var w,E=f[C],T=(w=E)==null?void 0:w.curveOwner;if(!(!T||!E.isActive)){var M=m[C].curve;if(M.keys.length){this._checkRevertOwner(T,c);var B=T.evaluateValue(M,S,c);u&&T.applyValue(B,s,c),b&&E.saveFinalValue()}}}if(x===It.Finished&&(n.layerState=lt.Finished),h.length&&this._fireAnimationEvents(e,h,y,S),g===It.UnStarted&&this._callAnimatorScriptOnEnter(_,o),x===It.Finished?this._callAnimatorScriptOnExit(_,o):this._callAnimatorScriptOnUpdate(_,o),v.length){var I=n.layerState;I!==lt.CrossFading&&I!==lt.FixedCrossFading&&this._checkTransition(e,v,o,y,S)}},a._updateCrossFade=function(e,n,o,s,l,c,u,d){var f=this.speed,h=o.crossLayerOwnerCollection,_=e.state.clip,g=_._curveBindings,y=e.state,v=e.stateData,p=e.playState,m=v.eventHandlers,A=n.state,S=n.stateData,x=n.playState,b=S.eventHandlers,C=A.clip,w=C._curveBindings,E=e.clipTime,T=n.clipTime,M=A._getDuration()*o.crossFadeTransition.duration,B=Math.abs(n.frameTime)/M;(B>=1||M===0)&&(B=1);var I=y.speed*f,F=A.speed*f;e.frameTime+=I*c,n.frameTime+=F*c,e.update(I<0),n.update(F<0);var L=e.clipTime,V=e.playState,D=n.clipTime,N=n.playState,O=n.playState===It.Finished;if(d||O)for(var G=h.length-1;G>=0;G--){var Q,H=h[G],ee=(Q=H)==null?void 0:Q.curveOwner;if(ee){var ve=H.crossSrcCurveIndex,oe=H.crossDestCurveIndex;this._checkRevertOwner(ee,u);var ne=ee.evaluateCrossFadeValue(ve>=0?g[ve].curve:null,oe>=0?w[oe].curve:null,L,D,B,u);d&&ee.applyValue(ne,l,u),O&&H.saveFinalValue()}}this._updateCrossFadeData(o,B),m.length&&this._fireAnimationEvents(e,m,E,L),b.length&&this._fireAnimationEvents(n,b,T,D),p===It.UnStarted&&this._callAnimatorScriptOnEnter(y,s),B===1||V===It.Finished?this._callAnimatorScriptOnExit(y,s):this._callAnimatorScriptOnUpdate(y,s),x===It.UnStarted&&this._callAnimatorScriptOnEnter(A,s),N===It.Finished?this._callAnimatorScriptOnExit(A,s):this._callAnimatorScriptOnUpdate(A,s)},a._updateCrossFadeFromPose=function(e,n,o,s,l,c,u){var d=n.crossLayerOwnerCollection,f=e.state,h=e.stateData,_=e.playState,g=h.eventHandlers,y=f.clip,v=y._curveBindings,p=e.clipTime,m=f._getDuration()*n.crossFadeTransition.duration,A=Math.abs(e.frameTime)/m;(A>=1||m===0)&&(A=1);var S=f.speed*this.speed;e.frameTime+=S*l,e.update(S<0);var x=e.clipTime,b=e.playState,C=b===It.Finished;if(u||C)for(var w=d.length-1;w>=0;w--){var E,T=d[w],M=(E=T)==null?void 0:E.curveOwner;if(M){var B=T.crossDestCurveIndex;this._checkRevertOwner(M,c);var I=T.curveOwner.crossFadeFromPoseAndApplyValue(B>=0?v[B].curve:null,x,A,c);u&&M.applyValue(I,s,c),C&&T.saveFinalValue()}}this._updateCrossFadeData(n,A),g.length&&this._fireAnimationEvents(e,g,p,x),_===It.UnStarted&&this._callAnimatorScriptOnEnter(f,o),b===It.Finished?this._callAnimatorScriptOnExit(f,o):this._callAnimatorScriptOnUpdate(f,o)},a._updateFinishedState=function(e,n,o,s){if(s)for(var l=e.stateData.curveLayerOwner,c=e.state.clip,u=c._curveBindings,d=u.length-1;d>=0;d--){var f,h=l[d],_=(f=h)==null?void 0:f.curveOwner;_&&(this._checkRevertOwner(_,o),_.applyValue(h.finalValue,n,o))}},a._updateCrossFadeData=function(e,n){var o=e.destPlayData;n===1&&(o.playState===It.Finished?e.layerState=lt.Finished:e.layerState=lt.Playing,e.switchPlayData(),e.crossFadeTransition=null)},a._preparePlay=function(e,n){if(e.layerState===lt.Playing){var o=e.srcPlayData;if(o.state!==n)for(var s=o.stateData.curveLayerOwner,l=s.length-1;l>=0;l--){var c;(c=s[l])==null||c.curveOwner.revertDefaultValue()}}else for(var u=e.crossLayerOwnerCollection,d=u.length-1;d>=0;d--)u[d].curveOwner.revertDefaultValue()},a._checkTransition=function(e,n,o,s,l){var c=e.state,u=c.clip.length;this.speed*c.speed>=0?l<s?(this._checkSubTransition(e,n,o,s,c.clipEndTime*u),e.currentTransitionIndex=0,this._checkSubTransition(e,n,o,c.clipStartTime*u,l)):this._checkSubTransition(e,n,o,s,l):l>s?(this._checkBackwardsSubTransition(e,n,o,s,c.clipStartTime*u),e.currentTransitionIndex=n.length-1,this._checkBackwardsSubTransition(e,n,o,l,c.clipEndTime*u)):this._checkBackwardsSubTransition(e,n,o,s,l)},a._checkSubTransition=function(e,n,o,s,l){for(var c=e.currentTransitionIndex,u=e.state._getDuration(),d=n.length;c<d;c++){var f=n[c],h=f.exitTime*u;if(h>l)break;h>=s&&(this._crossFadeByTransition(f,o),e.currentTransitionIndex=Math.min(c+1,d-1))}},a._checkBackwardsSubTransition=function(e,n,o,s,l){for(var c=e.currentTransitionIndex,u=e.state._getDuration();c>=0;c--){var d=n[c],f=d.exitTime*u;if(f<l)break;f<=s&&(this._crossFadeByTransition(d,o),e.currentTransitionIndex=Math.max(c-1,0))}},a._crossFadeByTransition=function(e,n){var o=e.destinationState;if(!o)return!1;if(!o.clip)return me.warn("The state named "+name+" has no AnimationClip data."),!1;var s=this._getAnimatorLayerData(n),l=s.layerState,c=s.destPlayData,u=this._getAnimatorStateData(o.name,o,s,n),d=o._getDuration(),f=d*e.offset;switch(c.reset(o,u,f),l){case lt.Standby:case lt.Finished:s.layerState=lt.FixedCrossFading,this._clearCrossData(s),this._prepareStandbyCrossFading(s);break;case lt.Playing:s.layerState=lt.CrossFading,this._clearCrossData(s),this._prepareCrossFading(s);break;case lt.CrossFading:s.layerState=lt.FixedCrossFading,this._prepareFixedPoseCrossFading(s);break;case lt.FixedCrossFading:this._prepareFixedPoseCrossFading(s);break}return s.crossFadeTransition=e,!0},a._fireAnimationEvents=function(e,n,o,s){var l=e.state,c=l.clip.length;this.speed*l.speed>=0?s<o?(this._fireSubAnimationEvents(e,n,o,l.clipEndTime*c),e.currentEventIndex=0,this._fireSubAnimationEvents(e,n,l.clipStartTime*c,s)):this._fireSubAnimationEvents(e,n,o,s):s>o?(this._fireBackwardSubAnimationEvents(e,n,o,l.clipStartTime*c),e.currentEventIndex=n.length-1,this._fireBackwardSubAnimationEvents(e,n,l.clipEndTime*c,s)):this._fireBackwardSubAnimationEvents(e,n,o,s)},a._fireSubAnimationEvents=function(e,n,o,s){for(var l=e.currentEventIndex,c=n.length;l<c;l++){var u=n[l],d=u.event,f=d.time,h=d.parameter;if(f>s)break;var _=u.handlers;if(f>=o){for(var g=_.length-1;g>=0;g--)_[g](h);e.currentEventIndex=Math.min(l+1,c-1)}}},a._fireBackwardSubAnimationEvents=function(e,n,o,s){for(var l=e.currentEventIndex;l>=0;l--){var c=n[l],u=c.event,d=u.time,f=u.parameter;if(d<s)break;if(d<=o){for(var h=c.handlers,_=h.length-1;_>=0;_--)h[_](f);e.currentEventIndex=Math.max(l-1,0)}}},a._callAnimatorScriptOnEnter=function(e,n){for(var o=e._onStateEnterScripts,s=0,l=o.length;s<l;s++)o[s].onStateEnter(this,e,n)},a._callAnimatorScriptOnUpdate=function(e,n){for(var o=e._onStateUpdateScripts,s=0,l=o.length;s<l;s++)o[s].onStateUpdate(this,e,n)},a._callAnimatorScriptOnExit=function(e,n){for(var o=e._onStateExitScripts,s=0,l=o.length;s<l;s++)o[s].onStateExit(this,e,n)},a._checkAutoPlay=function(){for(var e=this._animatorController.layers,n=0,o=e.length;n<o;++n){var s,l=e[n].stateMachine;(s=l)!=null&&s.defaultState&&this.play(l.defaultState.name,n)}},a._checkRevertOwner=function(e,n){n&&e.updateMark!==this._updateMark&&e.revertDefaultValue(),e.updateMark=this._updateMark},q(i,[{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._reset(),this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),i}(ir);R([Ie],ai.prototype,"speed",void 0);R([z],ai.prototype,"_controllerUpdateFlag",void 0);R([z],ai.prototype,"_updateMark",void 0);R([z],ai.prototype,"_animatorLayersData",void 0);R([z],ai.prototype,"_curveOwnerPool",void 0);R([z],ai.prototype,"_animationEventHandlerPool",void 0);R([z],ai.prototype,"_tempAnimatorStateInfo",void 0);R([z],ai.prototype,"_controlledRenderers",void 0);var zh=function(){function r(){this._updateFlagManager=new On,this._layers=[],this._layersMap={}}var i=r.prototype;return i.findLayerByName=function(t){return this._layersMap[t]},i.addLayer=function(t){this._layers.push(t),this._layersMap[t.name]=t,this._updateFlagManager.dispatch()},i.removeLayer=function(t){var e=this.layers[t];this._layers.splice(t,1),delete this._layersMap[e.name],this._updateFlagManager.dispatch()},i.clearLayers=function(){this._layers.length=0;for(var t in this._layersMap)delete this._layersMap[t];this._updateFlagManager.dispatch()},i._registerChangeFlag=function(){return this._updateFlagManager.createFlag(bu)},q(r,[{key:"layers",get:function(){return this._layers}}]),r}(),kh=function(i){this.name=i,this.weight=1,this.blendingMode=$s.Override},xf=function(){function r(){this._destroyed=!1}var i=r.prototype;return i.onStateEnter=function(t,e,n){},i.onStateUpdate=function(t,e,n){},i.onStateExit=function(t,e,n){},i.destroy=function(){this._destroyed||(this._state._removeStateMachineScript(this),this._destroyed=!0)},r}(),Em=function(){function r(a){this.name=a,this.speed=1,this.wrapMode=el.Loop,this._onStateEnterScripts=[],this._onStateUpdateScripts=[],this._onStateExitScripts=[],this._updateFlagManager=new On,this._clipStartTime=0,this._clipEndTime=1,this._transitions=[],this._onClipChanged=this._onClipChanged.bind(this)}var i=r.prototype;return i.addTransition=function(t){var e=this._transitions,n=e.length,o=t.exitTime,s=n?e[n-1].exitTime:0;if(o>=s)e.push(t);else{for(var l=n;--l>=0&&o<e[l].exitTime;);e.splice(l+1,0,t)}},i.removeTransition=function(t){var e=this._transitions.indexOf(t);e!==-1&&this._transitions.splice(e,1)},i.addStateMachineScript=function(t){var e=new t;e._state=this;var n=xf.prototype;return e.onStateEnter!==n.onStateEnter&&this._onStateEnterScripts.push(e),e.onStateUpdate!==n.onStateUpdate&&this._onStateUpdateScripts.push(e),e.onStateExit!==n.onStateExit&&this._onStateExitScripts.push(e),e},i.clearTransitions=function(){this._transitions.length=0},i._getDuration=function(){return this.clip?(this._clipEndTime-this._clipStartTime)*this.clip.length:null},i._removeStateMachineScript=function(t){var e=xf.prototype;if(t.onStateEnter!==e.onStateEnter){var n=this._onStateEnterScripts.indexOf(t);n!==-1&&this._onStateEnterScripts.splice(n,1)}if(t.onStateUpdate!==e.onStateUpdate){var o=this._onStateUpdateScripts.indexOf(t);o!==-1&&this._onStateUpdateScripts.splice(o,1)}if(t.onStateExit!==e.onStateExit){var s=this._onStateExitScripts.indexOf(t);s!==-1&&this._onStateExitScripts.splice(s,1)}},i._onClipChanged=function(){this._updateFlagManager.dispatch()},q(r,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(t){var e=this._clip;e!==t&&(e&&e._updateFlagManager.removeListener(this._onClipChanged),this._clip=t,this._clipEndTime=Math.min(this._clipEndTime,1),this._onClipChanged(),t&&t._updateFlagManager.addListener(this._onClipChanged))}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(t){this._clipStartTime=Math.max(t,0)}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(t){this._clipEndTime=Math.min(t,1)}}]),r}(),Uh=function(){function r(){this.states=[],this._statesMap={}}var i=r.prototype;return i.addState=function(t){var e=this.findStateByName(t);return e?console.warn("The state named "+t+" has existed."):(e=new Em(t),this.states.push(e),this._statesMap[t]=e),e},i.removeState=function(t){var e=t.name,n=this.states.indexOf(t);n>-1&&this.states.splice(n,1),delete this._statesMap[e]},i.findStateByName=function(t){return this._statesMap[t]},i.makeUniqueStateName=function(t){for(var e=this._statesMap,n=t,o=0;e[t];)t=n+" "+o,o++;return t},r}(),Sf;(function(r){r[r.If=0]="If",r[r.IfNot=1]="IfNot",r[r.Greater=2]="Greater",r[r.Less=3]="Less",r[r.Equals=4]="Equals",r[r.NotEquals=5]="NotEquals"})(Sf||(Sf={}));var cr=function(){},dC=function(){},fC=function(){function r(){this._pathMasks=[],this._pathMaskMap={}}var i=r.prototype;return i.addPathMask=function(t){var e=this._pathMaskMap[t];if(e)return e;var n=new dC;return n.path=t,n.active=!0,this._pathMasks.push(n),this._pathMaskMap[t]=n,n},i.removePathMask=function(t){for(var e=this,n=e._pathMasks,o=0,s=this._pathMasks.length;o<s;++o)if(n[o]===t){n.splice(o,1),delete this._pathMaskMap[t];break}},i.getPathMask=function(t){return this._pathMaskMap[t]},i.setPathMaskActive=function(t,e,n){n===void 0&&(n=!1);var o=this._pathMaskMap[t];if(o&&(o.active=e),n)for(var s in this._pathMaskMap)s.startsWith(t)&&(this._pathMaskMap[s].active=e)},r.createByEntity=function(t){var e=new r;return e.addPathMask(""),r._addPathMaskWithChildren(e,t,""),e},r._addPathMaskWithChildren=function(t,e,n){for(var o=e.children,s=0,l=o.length;s<l;++s){var c=o[s],u=n?n+"/"+c.name:c.name;t.addPathMask(u),r._addPathMaskWithChildren(t,c,u)}},q(r,[{key:"pathMasks",get:function(){return this._pathMasks}}]),r}(),jo=function(r){W(i,r);function i(t){var e;return e=r.call(this,t,Le.find("skybox"))||this,e._textureDecodeRGBM=!1,e._tintColor=new K(1,1,1,1),e.renderState.rasterState.cullMode=Mr.Off,e.renderState.depthState.compareFunction=Te.LessEqual,e.shaderData.setFloat(i._rotationProp,0),e.shaderData.setFloat(i._exposureProp,1),e.shaderData.setColor(i._tintColorProp,e._tintColor),e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"textureDecodeRGBM",get:function(){return this._textureDecodeRGBM},set:function(e){this._textureDecodeRGBM=e,e?this.shaderData.enableMacro(i._decodeSkyRGBMMacro):this.shaderData.disableMacro(i._decodeSkyRGBMMacro)}},{key:"texture",get:function(){return this.shaderData.getTexture(i._textureCubeProp)},set:function(e){this.shaderData.setTexture(i._textureCubeProp,e)}},{key:"rotation",get:function(){return this.shaderData.getFloat(i._rotationProp)},set:function(e){this.shaderData.setFloat(i._rotationProp,e)}},{key:"exposure",get:function(){return this.shaderData.getFloat(i._exposureProp)},set:function(e){this.shaderData.setFloat(i._exposureProp,e)}},{key:"tintColor",get:function(){return this._tintColor},set:function(e){this._tintColor!=e&&this._tintColor.copyFrom(e)}}]),i}(In);(function(){jo._tintColorProp=k.getByName("material_TintColor")})();(function(){jo._textureCubeProp=k.getByName("material_CubeTexture")})();(function(){jo._rotationProp=k.getByName("material_Rotation")})();(function(){jo._exposureProp=k.getByName("material_Exposure")})();(function(){jo._decodeSkyRGBMMacro=se.getByName("MATERIAL_IS_DECODE_SKY_RGBM")})();var Cf;(function(r){r[r.None=0]="None",r[r.Simple=1]="Simple",r[r.HighQuality=2]="HighQuality"})(Cf||(Cf={}));var Di=function(r){W(i,r);function i(t){var e;return e=r.call(this,t,Le.find("SkyProcedural"))||this,e.sunMode=2,e.sunSize=.04,e.sunSizeConvergence=5,e.atmosphereThickness=1,e.skyTint=new K(.5,.5,.5,1),e.groundTint=new K(.369,.349,.341,1),e.exposure=1.3,e.renderState.rasterState.cullMode=Mr.Off,e.renderState.depthState.compareFunction=Te.LessEqual,e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"sunMode",get:function(){return this._sunDisk},set:function(e){var n=this.shaderData;switch(e){case 2:n.disableMacro(i._sunSimpleMacro),n.enableMacro(i._sunHighQualityMacro);break;case 1:n.disableMacro(i._sunHighQualityMacro),n.enableMacro(i._sunSimpleMacro);break;case 0:n.disableMacro(i._sunHighQualityMacro),n.disableMacro(i._sunSimpleMacro);break;default:throw"SkyBoxProceduralMaterial: unknown sun value."}this._sunDisk=e}},{key:"sunSize",get:function(){return this.shaderData.getFloat(i._sunSizeProp)},set:function(e){this.shaderData.setFloat(i._sunSizeProp,Math.min(Math.max(0,e),1))}},{key:"sunSizeConvergence",get:function(){return this.shaderData.getFloat(i._sunSizeConvergenceProp)},set:function(e){this.shaderData.setFloat(i._sunSizeConvergenceProp,Math.min(Math.max(0,e),20))}},{key:"atmosphereThickness",get:function(){return this.shaderData.getFloat(i._atmosphereThicknessProp)},set:function(e){this.shaderData.setFloat(i._atmosphereThicknessProp,Math.min(Math.max(0,e),5))}},{key:"skyTint",get:function(){return this.shaderData.getColor(i._skyTintProp)},set:function(e){this.shaderData.setColor(i._skyTintProp,e)}},{key:"groundTint",get:function(){return this.shaderData.getColor(i._groundTintProp)},set:function(e){this.shaderData.setColor(i._groundTintProp,e)}},{key:"exposure",get:function(){return this.shaderData.getFloat(i._exposureProp)},set:function(e){this.shaderData.setFloat(i._exposureProp,Math.min(Math.max(0,e),8))}}]),i}(In);(function(){Di._sunSizeProp=k.getByName("material_SunSize")})();(function(){Di._sunSizeConvergenceProp=k.getByName("material_SunSizeConvergence")})();(function(){Di._atmosphereThicknessProp=k.getByName("material_AtmosphereThickness")})();(function(){Di._skyTintProp=k.getByName("material_SkyTint")})();(function(){Di._groundTintProp=k.getByName("material_GroundTint")})();(function(){Di._exposureProp=k.getByName("material_Exposure")})();(function(){Di._sunHighQualityMacro=se.getByName("MATERIAL_SUN_HIGH_QUALITY")})();(function(){Di._sunSimpleMacro=se.getByName("MATERIAL_SUN_SIMPLE")})();var hC=function(){},sn;(function(r){r[r.Billboard=0]="Billboard",r[r.StretchBillboard=1]="StretchBillboard",r[r.HorizontalBillboard=2]="HorizontalBillboard",r[r.VerticalBillboard=3]="VerticalBillboard",r[r.Mesh=4]="Mesh",r[r.None=5]="None"})(sn||(sn={}));var ko;(function(r){r[r.StopEmittingAndClear=0]="StopEmittingAndClear",r[r.StopEmitting=1]="StopEmitting"})(ko||(ko={}));var Nr=function(r){W(i,r);function i(t){var e;return e=r.call(this,t)||this,e.generator=new Ge(he(e)),e.velocityScale=0,e.lengthScale=2,e.pivot=new P,e._currentRenderModeMacro=i._billboardModeMacro,e.shaderData.enableMacro(i._billboardModeMacro),e._supportInstancedArrays=e.engine._hardwareRenderer.canIUse(J.instancedArrays),e}var a=i.prototype;return a._onEnable=function(){this.generator.main.playOnEnabled&&this.generator.play(!1)},a._onDisable=function(){this.generator.stop(!1,ko.StopEmittingAndClear)},a._prepareRender=function(e){if(this._supportInstancedArrays){var n=this.generator;n._update(this.engine.time.deltaTime),n._firstActiveElement!==n._firstFreeElement&&r.prototype._prepareRender.call(this,e)}},a._updateBounds=function(e){e.min.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),e.max.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a._updateShaderData=function(e){var n=this.shaderData;n.setFloat(i._lengthScale,this.lengthScale),n.setFloat(i._speedScale,this.velocityScale),n.setFloat(i._currentTime,this.generator._playTime),n.setVector3(i._pivotOffsetProperty,this.pivot),this.generator._updateShaderData(n)},a._render=function(e){var n=this.generator;n._primitive.instanceCount=n._getAliveParticleCount();var o=this.getMaterial();if(o){(o.destroyed||o.shader.destroyed)&&(o=this.engine._particleMagentaMaterial);var s=this._engine._renderDataPool.getFromPool();s.setX(this,o,n._primitive,n._subPrimitive),e.camera._renderPipeline.pushRenderData(e,s)}},a._onDestroy=function(){r.prototype._onDestroy.call(this);var e=this._mesh;e&&(e.destroyed||this._addResourceReferCount(e,-1)),this.generator._destroy()},q(i,[{key:"renderMode",get:function(){return this._renderMode},set:function(e){if(this._renderMode!==e){var n=this._renderMode;this._renderMode=e;var o=null,s=this.shaderData;switch(e){case sn.Billboard:o=i._billboardModeMacro;break;case sn.StretchBillboard:o=i._stretchedBillboardModeMacro;break;case sn.HorizontalBillboard:throw"Not implemented";case sn.VerticalBillboard:throw"Not implemented";case sn.Mesh:throw"Not implemented"}this._currentRenderModeMacro!==o&&(this._currentRenderModeMacro&&s.disableMacro(this._currentRenderModeMacro),o&&s.enableMacro(o),this._currentRenderModeMacro=o),n!==sn.Mesh!=(e===sn.Mesh)&&this.generator._reorganizeGeometryBuffers()}}},{key:"mesh",get:function(){return this._mesh},set:function(e){var n=this._mesh;n!==e&&(this._mesh=e,n&&this._addResourceReferCount(n,-1),e&&this._addResourceReferCount(e,1),this.renderMode===sn.Mesh&&this.generator._reorganizeGeometryBuffers())}}]),i}(Ce);(function(){Nr._billboardModeMacro=se.getByName("RENDERER_MODE_SPHERE_BILLBOARD")})();(function(){Nr._stretchedBillboardModeMacro=se.getByName("RENDERER_MODE_STRETCHED_BILLBOARD")})();(function(){Nr._horizontalBillboardModeMacro=se.getByName("RENDERER_MODE_HORIZONTAL_BILLBOARD")})();(function(){Nr._verticalBillboardModeMacro=se.getByName("RENDERER_MODE_VERTICAL_BILLBOARD")})();(function(){Nr._renderModeMeshMacro=se.getByName("RENDERER_MODE_MESH")})();(function(){Nr._pivotOffsetProperty=k.getByName("renderer_PivotOffset")})();(function(){Nr._lengthScale=k.getByName("renderer_StretchedBillboardLengthScale")})();(function(){Nr._speedScale=k.getByName("renderer_StretchedBillboardSpeedScale")})();(function(){Nr._currentTime=k.getByName("renderer_CurrentTime")})();R([Z],Nr.prototype,"generator",void 0);R([Ph],Nr.prototype,"pivot",void 0);var pe;(function(r){r[r.Constant=0]="Constant",r[r.TwoConstants=1]="TwoConstants",r[r.Curve=2]="Curve",r[r.TwoCurves=3]="TwoCurves"})(pe||(pe={}));var wr;(function(r){r[r.Constant=0]="Constant",r[r.TwoConstants=1]="TwoConstants",r[r.Gradient=2]="Gradient",r[r.TwoGradients=3]="TwoGradients"})(wr||(wr={}));var Ci;(function(r){r[r.Local=0]="Local",r[r.World=1]="World"})(Ci||(Ci={}));var Ze;(function(r){r[r.Burst=592910910]="Burst",r[r.StartDelay=322376503]="StartDelay",r[r.StartColor=306581307]="StartColor",r[r.StartSize=1793934638]="StartSize",r[r.StartRotation=3737431713]="StartRotation",r[r.randomizeRotationDirection=2527743459]="randomizeRotationDirection",r[r.StartLifetime=2368504881]="StartLifetime",r[r.StartSpeed=4085612399]="StartSpeed",r[r.VelocityOverLifetime=3774601268]="VelocityOverLifetime",r[r.ColorOverLifetime=326370691]="ColorOverLifetime",r[r.SizeOverLifetime=1494990940]="SizeOverLifetime",r[r.RotationOverLifetime=1089181156]="RotationOverLifetime",r[r.TextureSheetAnimation=197469413]="TextureSheetAnimation",r[r.Shape=2941263940]="Shape",r[r.GravityModifier=2759560269]="GravityModifier"})(Ze||(Ze={}));var la=function(){function r(a,t){if(a===void 0&&(a=null),t===void 0&&(t=null),this._colorKeys=[],this._alphaKeys=[],this._colorTypeArrayDirty=!1,this._alphaTypeArrayDirty=!1,a)for(var e=0,n=a.length;e<n;e++){var o=a[e];this.addColorKey(o)}if(t)for(var s=0,l=t.length;s<l;s++){var c=t[s];this.addAlphaKey(c)}}var i=r.prototype;return i.addColorKey=function(t,e){var n=this._colorKeys;if(n.length===4)throw new Error("Gradient can only have 4 color keys");var o=typeof t=="number"?new eu(t,e):t;o._onValueChanged=this._setColorTypeArrayDirty.bind(this),this._addKey(n,o),this._colorTypeArrayDirty=!0},i.addAlphaKey=function(t,e){var n=this._alphaKeys;if(n.length===4)throw new Error("Gradient can only have 4 alpha keys");var o=typeof t=="number"?new tu(t,e):t;o._onValueChanged=this._setAlphaTypeArrayDirty.bind(this),this._addKey(n,o),this._alphaTypeArrayDirty=!0},i.removeColorKey=function(t){this._colorKeys[t]._onValueChanged=null,this._removeKey(this._colorKeys,t),this._colorTypeArrayDirty=!0},i.removeAlphaKey=function(t){this._alphaKeys[t]._onValueChanged=null,this._removeKey(this._alphaKeys,t),this._alphaTypeArrayDirty=!0},i.setKeys=function(t,e){for(var n=this._colorKeys,o=this._alphaKeys,s=0,l=n.length;s<l;s++)n[s]._onValueChanged=null;for(var c=0,u=o.length;c<u;c++)o[c]._onValueChanged=null;n.length=0,o.length=0;for(var d=0,f=t.length;d<f;d++)this._addKey(n,t[d]);for(var h=0,_=e.length;h<_;h++)this._addKey(o,e[h]);this._alphaTypeArrayDirty=!0,this._colorTypeArrayDirty=!0},i._getColorTypeArray=function(t){var e=this._colorTypeArray||(this._colorTypeArray=new Float32Array(16));if(this._colorTypeArrayDirty){for(var n=this._colorKeys,o=0,s=Math.min(n.length,4);o<s;o++){var l=o*4,c=n[o];e[l]=c.time;var u=c.color;t===jr.Linear?(e[l+1]=K.gammaToLinearSpace(u.r),e[l+2]=K.gammaToLinearSpace(u.g),e[l+3]=K.gammaToLinearSpace(u.b)):(e[l+1]=u.r,e[l+2]=u.g,e[l+3]=u.b)}this._colorTypeArrayDirty=!1}return e},i._getAlphaTypeArray=function(){var t=this._alphaTypeArray||(this._alphaTypeArray=new Float32Array(8));if(this._alphaTypeArrayDirty){for(var e=this._alphaKeys,n=0,o=Math.min(e.length,4);n<o;n++){var s=n*2,l=e[n];t[s]=l.time,t[s+1]=l.alpha}this._alphaTypeArrayDirty=!1}return t},i._addKey=function(t,e){var n=e.time,o=t.length,s=o?t[o-1].time:0;if(n>=s)t.push(e);else{for(var l=o;--l>=0&&n<t[l].time;);t.splice(l+1,0,e)}},i._removeKey=function(t,e){t.splice(e,1)},i._setColorTypeArrayDirty=function(){this._colorTypeArrayDirty=!0},i._setAlphaTypeArrayDirty=function(){this._alphaTypeArrayDirty=!0},q(r,[{key:"colorKeys",get:function(){return this._colorKeys}},{key:"alphaKeys",get:function(){return this._alphaKeys}}]),r}();R([Z],la.prototype,"_colorKeys",void 0);R([Z],la.prototype,"_alphaKeys",void 0);R([z],la.prototype,"_colorTypeArray",void 0);R([z],la.prototype,"_alphaTypeArray",void 0);var eu=function(){function r(i,a){this._onValueChanged=null,this._color=new K,this._time=i,a&&this._color.copyFrom(a),this._color._onValueChanged=this._onValueChanged}return q(r,[{key:"time",get:function(){return this._time},set:function(a){this._time=a,this._onValueChanged&&this._onValueChanged()}},{key:"color",get:function(){return this._color},set:function(a){this._color!==a&&this._color.copyFrom(a)}}]),r}(),tu=function(){function r(i,a){this._onValueChanged=null,this._time=i,this._alpha=a}return q(r,[{key:"time",get:function(){return this._time},set:function(a){this._time=a,this._onValueChanged&&this._onValueChanged()}},{key:"alpha",get:function(){return this._alpha},set:function(a){this._alpha=a,this._onValueChanged&&this._onValueChanged()}}]),r}(),qa=function(){function r(a,t){this.mode=wr.Constant,this.constantMin=new K,this.constantMax=new K,this.gradientMin=new la,this.gradientMax=new la,a.constructor===K?t?(this.constantMin.copyFrom(a),this.constantMax.copyFrom(t),this.mode=wr.TwoConstants):(this.constant.copyFrom(a),this.mode=wr.Constant):t?(this.gradientMin=a,this.gradientMax=t,this.mode=wr.TwoGradients):(this.gradient=a,this.mode=wr.Gradient)}var i=r.prototype;return i.evaluate=function(t,e,n){switch(this.mode){case wr.Constant:n.copyFrom(this.constant);break;case wr.TwoConstants:K.lerp(this.constantMin,this.constantMax,e,n);break}},q(r,[{key:"constant",get:function(){return this.constantMax},set:function(t){this.constantMax=t}},{key:"gradient",get:function(){return this.gradientMax},set:function(t){this.gradientMax=t}}]),r}();R([Z],qa.prototype,"constantMin",void 0);R([Z],qa.prototype,"constantMax",void 0);R([Z],qa.prototype,"gradientMin",void 0);R([Z],qa.prototype,"gradientMax",void 0);var Ka=function(){function r(a){this.enabled=!1,this._generator=a}var i=r.prototype;return i._enableMacro=function(t,e,n){return e!==n&&(e&&t.disableMacro(e),n&&t.enableMacro(n)),n},r}();R([z],Ka.prototype,"_generator",void 0);var en=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.color=new qa(new la([new eu(0,new K(1,1,1)),new eu(1,new K(1,1,1))],[new tu(0,1),new tu(1,1)])),t._colorGradientRand=new un(0,Ze.ColorOverLifetime),t._gradientKeysCount=new ue(0,0,0,0),t}var a=i.prototype;return a._updateShaderData=function(e){var n=null;if(this.enabled){var o=this.color.mode;if(o!==wr.Gradient&&o!==wr.TwoGradients)throw new Error("Invalid color mode, only gradient and two gradients are supported in color over lifetime.");var s=this.color,l=this._generator._renderer.engine.settings.colorSpace;e.setFloatArray(i._maxGradientColor,s.gradientMax._getColorTypeArray(l)),e.setFloatArray(i._maxGradientAlpha,s.gradientMax._getAlphaTypeArray()),o===wr.Gradient?n=i._gradientMacro:(e.setFloatArray(i._minGradientColor,s.gradientMin._getColorTypeArray(l)),e.setFloatArray(i._minGradientAlpha,s.gradientMin._getAlphaTypeArray()),n=i._randomGradientsMacro);var c=s.gradientMin.colorKeys,u=s.gradientMin.alphaKeys,d=s.gradientMax.colorKeys,f=s.gradientMax.alphaKeys;this._gradientKeysCount.set(c.length?c[c.length-1].time:0,u.length?u[u.length-1].time:0,d.length?d[d.length-1].time:0,f.length?f[f.length-1].time:0),e.setVector4(i._gradientKeysCount,this._gradientKeysCount)}this._colorMacro=this._enableMacro(e,this._colorMacro,n)},a._resetRandomSeed=function(e){this._colorGradientRand.reset(e,Ze.ColorOverLifetime)},i}(Ka);(function(){en._gradientMacro=se.getByName("RENDERER_COL_GRADIENT")})();(function(){en._randomGradientsMacro=se.getByName("RENDERER_COL_RANDOM_GRADIENTS")})();(function(){en._minGradientColor=k.getByName("renderer_COLMinGradientColor")})();(function(){en._minGradientAlpha=k.getByName("renderer_COLMinGradientAlpha")})();(function(){en._maxGradientColor=k.getByName("renderer_COLMaxGradientColor")})();(function(){en._maxGradientAlpha=k.getByName("renderer_COLMaxGradientAlpha")})();(function(){en._gradientKeysCount=k.getByName("renderer_COLGradientKeysMaxTime")})();R([Z],en.prototype,"color",void 0);R([z],en.prototype,"_colorGradientRand",void 0);R([z],en.prototype,"_gradientKeysCount",void 0);R([z],en.prototype,"_colorMacro",void 0);var Qe=function(){function r(a,t){this.mode=pe.Constant,this.constantMin=0,this.constantMax=0,typeof a=="number"?t?(this.constantMin=a,this.constantMax=t,this.mode=pe.TwoConstants):(this.constant=a,this.mode=pe.Constant):t?(this.curveMin=a,this.curveMax=t,this.mode=pe.TwoCurves):(this.curve=a,this.mode=pe.Curve)}var i=r.prototype;return i.evaluate=function(t,e){switch(this.mode){case pe.Constant:return this.constant;case pe.TwoConstants:return this.constantMin+(this.constantMax-this.constantMin)*e}},q(r,[{key:"constant",get:function(){return this.constantMax},set:function(t){this.constantMax=t}},{key:"curve",get:function(){return this.curveMax},set:function(t){this.curveMax=t}}]),r}();R([Z],Qe.prototype,"curveMin",void 0);R([Z],Qe.prototype,"curveMax",void 0);var pa=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.rateOverTime=new Qe(10),t.rateOverDistance=new Qe(0),t._shapeRand=new un(0,Ze.Shape),t._frameRateTime=0,t._bursts=[],t._currentBurstIndex=0,t._burstRand=new un(0,Ze.Burst),t}var a=i.prototype;return a.addBurst=function(e){for(var n=this._bursts,o=n.length;--o>=0&&e.time<n[o].time;);n.splice(o+1,0,e)},a.removeBurst=function(e){var n=this._bursts.indexOf(e);n!==-1&&this._bursts.splice(n,1)},a.removeBurstByIndex=function(e){this._bursts.splice(e,1)},a.clearBurst=function(){this._bursts.length=0},a._emit=function(e,n){this._emitByRateOverTime(n),this._emitByBurst(e,n)},a._resetRandomSeed=function(e){this._burstRand.reset(e,Ze.Burst),this._shapeRand.reset(e,Ze.Shape)},a._reset=function(){this._frameRateTime=0,this._currentBurstIndex=0},a._emitByRateOverTime=function(e){var n=this.rateOverTime.evaluate(void 0,void 0);if(n>0)for(var o=this._generator,s=1/n,l=e-this._frameRateTime;l>=s;)l-=s,this._frameRateTime+=s,o._emit(this._frameRateTime,1)},a._emitByBurst=function(e,n){var o=this._generator.main,s=o.duration,l=Math.floor((n-e)/s);if(o.isLoop&&(l>0||n%s<e%s)){var c=Math.ceil(e/s)*s;this._emitBySubBurst(e,c,s),this._currentBurstIndex=0;for(var u=0;u<l;u++){var d=c;c+=s,this._emitBySubBurst(d,c,s),this._currentBurstIndex=0}this._emitBySubBurst(c,n,s)}else this._emitBySubBurst(e,n,s)},a._emitBySubBurst=function(e,n,o){for(var s=this._generator,l=this._burstRand,c=this.bursts,u=Math.floor(e/o)*o,d=e%o,f=d+(n-e),h=this._currentBurstIndex,_=c.length;h<_;h++){var g=c[h],y=g.time;if(y>f)break;if(y>=d){var v=g.count.evaluate(void 0,l.random());s._emit(u+y,v)}}this._currentBurstIndex=h},q(i,[{key:"bursts",get:function(){return this._bursts}}]),i}(Ka);R([Z],pa.prototype,"rateOverTime",void 0);R([Z],pa.prototype,"rateOverDistance",void 0);R([Z],pa.prototype,"shape",void 0);R([z],pa.prototype,"_shapeRand",void 0);R([Z],pa.prototype,"_bursts",void 0);R([z],pa.prototype,"_burstRand",void 0);var Qn;(function(r){r[r.Hierarchy=0]="Hierarchy",r[r.Local=1]="Local",r[r.World=2]="World"})(Qn||(Qn={}));var Oe=function(){function r(a){this.duration=5,this.isLoop=!0,this.startDelay=new Qe(0),this.startLifetime=new Qe(5),this.startSpeed=new Qe(5),this.startSize3D=!1,this.startSizeX=new Qe(1),this.startSizeY=new Qe(1),this.startSizeZ=new Qe(1),this.startRotation3D=!1,this.startRotationX=new Qe(0),this.startRotationY=new Qe(0),this.startRotationZ=new Qe(0),this.flipRotation=0,this.startColor=new qa(new K(1,1,1,1)),this.gravityModifier=new Qe(0),this.simulationSpace=Ci.Local,this.simulationSpeed=1,this.scalingMode=Qn.Local,this.playOnEnabled=!0,this._maxParticleBuffer=1e3,this._startSpeedRand=new un(0,Ze.StartSpeed),this._startLifeTimeRand=new un(0,Ze.StartLifetime),this._startColorRand=new un(0,Ze.StartColor),this._startSizeRand=new un(0,Ze.StartSize),this._startRotationRand=new un(0,Ze.StartRotation),this._gravityModifierRand=new un(0,Ze.GravityModifier),this._gravity=new P,this._generator=a}var i=r.prototype;return i._resetRandomSeed=function(t){this._startSpeedRand.reset(t,Ze.StartSpeed),this._startLifeTimeRand.reset(t,Ze.StartLifetime),this._startColorRand.reset(t,Ze.StartColor),this._startSizeRand.reset(t,Ze.StartSize),this._startRotationRand.reset(t,Ze.StartRotation)},i._getPositionScale=function(){var t=this._generator._renderer.entity.transform;switch(this.scalingMode){case Qn.Hierarchy:case Qn.World:return t.lossyWorldScale;case Qn.Local:return t.scale}},i._updateShaderData=function(t){var e=this._generator._renderer,n=e.entity.transform;switch(this.simulationSpace){case Ci.Local:t.setVector3(r._worldPosition,n.worldPosition);var o=n.worldRotationQuaternion,s=r._tempVector40;s.copyFrom(o),t.setVector4(r._worldRotation,s);break;case Ci.World:break;default:throw new Error("ParticleRenderer: SimulationSpace value is invalid.")}switch(this.scalingMode){case Qn.Hierarchy:var l=n.lossyWorldScale;t.setVector3(r._positionScale,l),t.setVector3(r._sizeScale,l);break;case Qn.Local:var l=n.scale;t.setVector3(r._positionScale,l),t.setVector3(r._sizeScale,l);break;case Qn.World:t.setVector3(r._positionScale,n.lossyWorldScale),t.setVector3(r._sizeScale,r._vector3One);break}var c=this._gravity,u=this.gravityModifier.evaluate(void 0,this._gravityModifierRand.random());P.scale(e.scene.physics.gravity,u,c),t.setVector3(r._gravity,c),t.setInt(r._simulationSpace,this.simulationSpace),t.setFloat(r._startRotation3D,+this.startRotation3D),t.setInt(r._scaleMode,this.scalingMode)},i._cloneTo=function(t){t.maxParticles=this.maxParticles},q(r,[{key:"maxParticles",get:function(){return this._maxParticleBuffer-1},set:function(t){this._maxParticleBuffer=t+1}},{key:"startSize",get:function(){return this.startSizeX},set:function(t){this.startSizeX=t}}]),r}();(function(){Oe._tempVector40=new ue})();(function(){Oe._vector3One=new P(1,1,1)})();(function(){Oe._positionScale=k.getByName("renderer_PositionScale")})();(function(){Oe._sizeScale=k.getByName("renderer_SizeScale")})();(function(){Oe._worldPosition=k.getByName("renderer_WorldPosition")})();(function(){Oe._worldRotation=k.getByName("renderer_WorldRotation")})();(function(){Oe._gravity=k.getByName("renderer_Gravity")})();(function(){Oe._simulationSpace=k.getByName("renderer_SimulationSpace")})();(function(){Oe._startRotation3D=k.getByName("renderer_ThreeDStartRotation")})();(function(){Oe._scaleMode=k.getByName("renderer_ScalingMode")})();R([Z],Oe.prototype,"startDelay",void 0);R([Z],Oe.prototype,"startLifetime",void 0);R([Z],Oe.prototype,"startSpeed",void 0);R([Z],Oe.prototype,"startSizeX",void 0);R([Z],Oe.prototype,"startSizeY",void 0);R([Z],Oe.prototype,"startSizeZ",void 0);R([Z],Oe.prototype,"startRotationX",void 0);R([Z],Oe.prototype,"startRotationY",void 0);R([Z],Oe.prototype,"startRotationZ",void 0);R([Z],Oe.prototype,"startColor",void 0);R([Z],Oe.prototype,"gravityModifier",void 0);R([z],Oe.prototype,"_maxParticleBuffer",void 0);R([z],Oe.prototype,"_startSpeedRand",void 0);R([z],Oe.prototype,"_startLifeTimeRand",void 0);R([z],Oe.prototype,"_startColorRand",void 0);R([z],Oe.prototype,"_startSizeRand",void 0);R([z],Oe.prototype,"_startRotationRand",void 0);R([z],Oe.prototype,"_gravityModifierRand",void 0);R([z],Oe.prototype,"_generator",void 0);R([z],Oe.prototype,"_gravity",void 0);var ht=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.separateAxes=!1,t.rotationX=new Qe(0),t.rotationY=new Qe(0),t.rotationZ=new Qe(45),t._rotationRand=new un(0,Ze.RotationOverLifetime),t._rotationMinConstant=new P,t._rotationMaxConstant=new P,t}var a=i.prototype;return a._updateShaderData=function(e){var n=null,o=null,s=null;if(this.enabled){var l=this.rotationX,c=this.rotationY,u=this.rotationZ,d=this.separateAxes,f=d?l.mode===pe.TwoCurves&&c.mode===pe.TwoCurves&&u.mode===pe.TwoCurves:u.mode===pe.TwoCurves,h=f||d?l.mode===pe.Curve&&c.mode===pe.Curve&&u.mode===pe.Curve:u.mode===pe.Curve;if(h)e.setFloatArray(i._maxCurveZProperty,u.curveMax._getTypeArray()),d&&(e.setFloatArray(i._maxCurveXProperty,l.curveMax._getTypeArray()),e.setFloatArray(i._maxCurveYProperty,c.curveMax._getTypeArray())),f&&(e.setFloatArray(i._minCurveZProperty,u.curveMin._getTypeArray()),d&&(e.setFloatArray(i._minCurveXProperty,l.curveMin._getTypeArray()),e.setFloatArray(i._minCurveYProperty,c.curveMin._getTypeArray())),s=i._isRandomTwoMacro),o=i._curveModeMacro;else{var _=this._rotationMaxConstant;if(_.set(U.degreeToRadian(l.constantMax),U.degreeToRadian(c.constantMax),U.degreeToRadian(u.constantMax)),e.setVector3(i._maxConstantProperty,_),d?l.mode===pe.TwoConstants&&c.mode===pe.TwoConstants&&u.mode===pe.TwoConstants:u.mode===pe.TwoConstants){var g=this._rotationMinConstant;g.set(U.degreeToRadian(l.constantMin),U.degreeToRadian(c.constantMin),U.degreeToRadian(u.constantMin)),e.setVector3(i._minConstantProperty,g),s=i._isRandomTwoMacro}o=i._constantModeMacro}d&&(n=i._isSeparateMacro)}this._enableSeparateMacro=this._enableMacro(e,this._enableSeparateMacro,n),this._isCurveMacro=this._enableMacro(e,this._isCurveMacro,o),this._isRandomTwoMacro=this._enableMacro(e,this._isRandomTwoMacro,s)},a._resetRandomSeed=function(e){this._rotationRand.reset(e,Ze.RotationOverLifetime)},i}(Ka);(function(){ht._constantModeMacro=se.getByName("RENDERER_ROL_CONSTANT_MODE")})();(function(){ht._curveModeMacro=se.getByName("RENDERER_ROL_CURVE_MODE")})();(function(){ht._isSeparateMacro=se.getByName("RENDERER_ROL_IS_SEPARATE")})();(function(){ht._isRandomTwoMacro=se.getByName("RENDERER_ROL_IS_RANDOM_TWO")})();(function(){ht._minConstantProperty=k.getByName("renderer_ROLMinConst")})();(function(){ht._minCurveXProperty=k.getByName("renderer_ROLMinCurveX")})();(function(){ht._minCurveYProperty=k.getByName("renderer_ROLMinCurveY")})();(function(){ht._minCurveZProperty=k.getByName("renderer_ROLMinCurveZ")})();(function(){ht._maxConstantProperty=k.getByName("renderer_ROLMaxConst")})();(function(){ht._maxCurveXProperty=k.getByName("renderer_ROLMaxCurveX")})();(function(){ht._maxCurveYProperty=k.getByName("renderer_ROLMaxCurveY")})();(function(){ht._maxCurveZProperty=k.getByName("renderer_ROLMaxCurveZ")})();R([Z],ht.prototype,"rotationX",void 0);R([Z],ht.prototype,"rotationY",void 0);R([Z],ht.prototype,"rotationZ",void 0);R([z],ht.prototype,"_rotationRand",void 0);R([z],ht.prototype,"_rotationMinConstant",void 0);R([z],ht.prototype,"_rotationMaxConstant",void 0);R([z],ht.prototype,"_enableSeparateMacro",void 0);R([z],ht.prototype,"_isCurveMacro",void 0);R([z],ht.prototype,"_isRandomTwoMacro",void 0);var Ia=function(){function r(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];this._keys=[],this._typeArrayDirty=!1;for(var n=0,o=t.length;n<o;n++){var s=t[n];this.addKey(s)}}var i=r.prototype;return i.addKey=function(t,e){var n=this._keys;if(n.length===4)throw new Error("Curve can only have 4 keys");var o=typeof t=="number"?new jn(t,e):t;this._addKey(n,o),this._typeArrayDirty=!0},i.removeKey=function(t){this._keys.splice(t,1),this._typeArrayDirty=!0},i.setKeys=function(t){this._keys.length=0;for(var e=0,n=t.length;e<n;e++)this.addKey(t[e]);this._typeArrayDirty=!0},i._getTypeArray=function(){var t=this._typeArray||(this._typeArray=new Float32Array(8));if(this._typeArrayDirty){for(var e=this._keys,n=0,o=Math.min(e.length,4);n<o;n++){var s=n*2,l=e[n];t[s]=l.time,t[s+1]=l.value}this._typeArrayDirty=!1}return t},i._addKey=function(t,e){var n=t.length,o=e.time,s=n?t[n-1].time:0;if(o>=s)t.push(e);else{for(var l=n;--l>=0&&o<t[l].time;);t.splice(l+1,0,e)}},q(r,[{key:"keys",get:function(){return this._keys}}]),r}();R([Z],Ia.prototype,"_keys",void 0);R([z],Ia.prototype,"_typeArray",void 0);var jn=function(i,a){this.time=i,this.value=a},Zt=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.separateAxes=!1,t.sizeX=new Qe(new Ia(new jn(0,0),new jn(1,1))),t.sizeY=new Qe(new Ia(new jn(0,0),new jn(1,1))),t.sizeZ=new Qe(new Ia(new jn(0,0),new jn(1,1))),t}var a=i.prototype;return a._updateShaderData=function(e){var n=null,o=null,s=null;if(this.enabled){var l=this.sizeX,c=this.sizeY,u=this.sizeZ,d=this.separateAxes,f=d?l.mode===pe.TwoCurves&&c.mode===pe.TwoCurves&&u.mode===pe.TwoCurves:l.mode===pe.TwoCurves,h=f||d?l.mode===pe.Curve&&c.mode===pe.Curve&&u.mode===pe.Curve:l.mode===pe.Curve;h&&(e.setFloatArray(i._maxCurveXProperty,l.curveMax._getTypeArray()),d&&(e.setFloatArray(i._maxCurveYProperty,c.curveMax._getTypeArray()),e.setFloatArray(i._maxCurveZProperty,u.curveMax._getTypeArray())),f&&(e.setFloatArray(i._minCurveXProperty,l.curveMin._getTypeArray()),d&&(e.setFloatArray(i._minCurveYProperty,c.curveMin._getTypeArray()),e.setFloatArray(i._minCurveZProperty,u.curveMin._getTypeArray())),s=i._isRandomTwoMacro),o=i._curveModeMacro),d&&(n=i._isSeparateMacro)}this._enableSeparateMacro=this._enableMacro(e,this._enableSeparateMacro,n),this._isCurveMacro=this._enableMacro(e,this._isCurveMacro,o),this._isRandomTwoMacro=this._enableMacro(e,this._isRandomTwoMacro,s)},q(i,[{key:"size",get:function(){return this.sizeX},set:function(e){this.sizeX=e}}]),i}(Ka);(function(){Zt._curveModeMacro=se.getByName("RENDERER_SOL_CURVE_MODE")})();(function(){Zt._isSeparateMacro=se.getByName("RENDERER_SOL_IS_SEPARATE")})();(function(){Zt._isRandomTwoMacro=se.getByName("RENDERER_SOL_IS_RANDOM_TWO")})();(function(){Zt._minCurveXProperty=k.getByName("renderer_SOLMinCurveX")})();(function(){Zt._minCurveYProperty=k.getByName("renderer_SOLMinCurveY")})();(function(){Zt._minCurveZProperty=k.getByName("renderer_SOLMinCurveZ")})();(function(){Zt._maxCurveXProperty=k.getByName("renderer_SOLMaxCurveX")})();(function(){Zt._maxCurveYProperty=k.getByName("renderer_SOLMaxCurveY")})();(function(){Zt._maxCurveZProperty=k.getByName("renderer_SOLMaxCurveZ")})();R([Z],Zt.prototype,"sizeX",void 0);R([Z],Zt.prototype,"sizeY",void 0);R([Z],Zt.prototype,"sizeZ",void 0);R([z],Zt.prototype,"_enableSeparateMacro",void 0);R([z],Zt.prototype,"_isCurveMacro",void 0);R([z],Zt.prototype,"_isRandomTwoMacro",void 0);var Or=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.startFrame=new Qe(0),t.frameOverTime=new Qe(new Ia(new jn(0,0),new jn(1,1))),t.type=0,t.cycleCount=1,t._tillingInfo=new P(1,1,1),t._frameOverTimeRand=new un(0,Ze.TextureSheetAnimation),t._tiling=new te(1,1),t}var a=i.prototype;return a._updateShaderData=function(e){var n=null;if(this.enabled){var o=this.frameOverTime.mode;if(o===pe.Curve||o===pe.TwoCurves){var s=this.frameOverTime;e.setFloatArray(i._frameMaxCurveProperty,s.curveMax._getTypeArray()),o===pe.Curve?n=i._frameCurveMacro:(e.setFloatArray(i._frameMinCurveProperty,s.curveMin._getTypeArray()),n=i._frameRandomCurvesMacro),e.setFloat(i._cycleCountProperty,this.cycleCount),e.setVector3(i._tillingParamsProperty,this._tillingInfo)}}this._textureSheetMacro=this._enableMacro(e,this._textureSheetMacro,n)},a._resetRandomSeed=function(e){this._frameOverTimeRand.reset(e,Ze.TextureSheetAnimation)},q(i,[{key:"tiling",get:function(){return this._tiling},set:function(e){this._tiling=e,this._tillingInfo.set(1/e.x,1/e.y,e.x*e.y)}}]),i}(Ka);(function(){Or._frameCurveMacro=se.getByName("RENDERER_TSA_FRAME_CURVE")})();(function(){Or._frameRandomCurvesMacro=se.getByName("RENDERER_TSA_FRAME_RANDOM_CURVES")})();(function(){Or._cycleCountProperty=k.getByName("renderer_TSACycles")})();(function(){Or._tillingParamsProperty=k.getByName("renderer_TSATillingParams")})();(function(){Or._frameMinCurveProperty=k.getByName("renderer_TSAFrameMinCurve")})();(function(){Or._frameMaxCurveProperty=k.getByName("renderer_TSAFrameMaxCurve")})();R([Z],Or.prototype,"startFrame",void 0);R([Z],Or.prototype,"frameOverTime",void 0);R([Ph],Or.prototype,"_tillingInfo",void 0);R([z],Or.prototype,"_frameOverTimeRand",void 0);R([Z],Or.prototype,"_tiling",void 0);R([z],Or.prototype,"_textureSheetMacro",void 0);var Ep;(function(r){r[r.WholeSheet=0]="WholeSheet",r[r.SingleRow=1]="SingleRow"})(Ep||(Ep={}));var xt=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.velocityX=new Qe(0),t.velocityY=new Qe(0),t.velocityZ=new Qe(0),t.space=Ci.Local,t._velocityRand=new un(0,Ze.VelocityOverLifetime),t._velocityMinConstant=new P,t._velocityMaxConstant=new P,t}var a=i.prototype;return a._updateShaderData=function(e){var n=null;if(this.enabled){var o=this.velocityX,s=this.velocityY,l=this.velocityZ,c=o.mode===pe.TwoCurves&&s.mode===pe.TwoCurves&&l.mode===pe.TwoCurves;if(c||o.mode===pe.Curve&&s.mode===pe.Curve&&l.mode===pe.Curve)e.setFloatArray(i._maxGradientXProperty,o.curveMax._getTypeArray()),e.setFloatArray(i._maxGradientYProperty,s.curveMax._getTypeArray()),e.setFloatArray(i._maxGradientZProperty,l.curveMax._getTypeArray()),c?(e.setFloatArray(i._minGradientXProperty,o.curveMin._getTypeArray()),e.setFloatArray(i._minGradientYProperty,s.curveMin._getTypeArray()),e.setFloatArray(i._minGradientZProperty,l.curveMin._getTypeArray()),n=i._randomCurveMacro):n=i._curveMacro;else{var u=this._velocityMaxConstant;if(u.set(o.constantMax,s.constantMax,l.constantMax),e.setVector3(i._maxConstantProperty,u),o.mode===pe.TwoConstants&&s.mode===pe.TwoConstants&&l.mode===pe.TwoConstants){var d=this._velocityMinConstant;d.set(o.constantMin,s.constantMin,l.constantMin),e.setVector3(i._minConstantProperty,d),n=i._randomConstantMacro}else n=i._constantMacro}e.setInt(i._spaceProperty,this.space)}this._velocityMacro=this._enableMacro(e,this._velocityMacro,n)},a._resetRandomSeed=function(e){this._velocityRand.reset(e,Ze.VelocityOverLifetime)},i}(Ka);(function(){xt._constantMacro=se.getByName("RENDERER_VOL_CONSTANT")})();(function(){xt._curveMacro=se.getByName("RENDERER_VOL_CURVE")})();(function(){xt._randomConstantMacro=se.getByName("RENDERER_VOL_RANDOM_CONSTANT")})();(function(){xt._randomCurveMacro=se.getByName("RENDERER_VOL_RANDOM_CURVE")})();(function(){xt._minConstantProperty=k.getByName("renderer_VOLMinConst")})();(function(){xt._maxConstantProperty=k.getByName("renderer_VOLMaxConst")})();(function(){xt._minGradientXProperty=k.getByName("renderer_VOLMinGradientX")})();(function(){xt._minGradientYProperty=k.getByName("renderer_VOLMinGradientY")})();(function(){xt._minGradientZProperty=k.getByName("renderer_VOLMinGradientZ")})();(function(){xt._maxGradientXProperty=k.getByName("renderer_VOLMaxGradientX")})();(function(){xt._maxGradientYProperty=k.getByName("renderer_VOLMaxGradientY")})();(function(){xt._maxGradientZProperty=k.getByName("renderer_VOLMaxGradientZ")})();(function(){xt._spaceProperty=k.getByName("renderer_VOLSpace")})();R([Z],xt.prototype,"velocityX",void 0);R([Z],xt.prototype,"velocityY",void 0);R([Z],xt.prototype,"velocityZ",void 0);R([z],xt.prototype,"_velocityRand",void 0);R([z],xt.prototype,"_velocityMinConstant",void 0);R([z],xt.prototype,"_velocityMaxConstant",void 0);R([z],xt.prototype,"_velocityMacro",void 0);var Ge=function(){function r(a){this.useAutoRandomSeed=!0,this.main=new Oe(this),this.emission=new pa(this),this.velocityOverLifetime=new xt(this),this.sizeOverLifetime=new Zt(this),this.rotationOverLifetime=new ht(this),this.colorOverLifetime=new en(this),this.textureSheetAnimation=new Or(this),this._currentParticleCount=0,this._playTime=0,this._firstNewElement=0,this._firstActiveElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._vertexBufferBindings=new Array,this._subPrimitive=new Tu(0,0,oa.Triangles),this._isPlaying=!1,this._instanceBufferResized=!1,this._waitProcessRetiredElementCount=0,this._randomSeed=0,this._renderer=a;var t=new hC;t.start=0,this._primitive=new Bh(a.engine),this._reorganizeGeometryBuffers(),this._resizeInstanceBuffer(!0,r._particleIncreaseCount),this.emission.enabled=!0}var i=r.prototype;return i.play=function(t){if(t===void 0&&(t=!0),t)for(var e=this._renderer.entity.getComponentsIncludeChildren(Nr,r._tempParticleRenderers),n=0,o=e.length;n<o;n++){var s=e[n];s.generator.play(!1)}else this._isPlaying=!0,this.useAutoRandomSeed&&this._resetGlobalRandSeed(Math.floor(Math.random()*4294967295))},i.stop=function(t,e){if(t===void 0&&(t=!0),e===void 0&&(e=ko.StopEmitting),t)for(var n=this._renderer.entity.getComponentsIncludeChildren(Nr,r._tempParticleRenderers),o=0,s=n.length;o<s;o++){var l=n[o];l.generator.stop(!1,e)}else if(this._isPlaying=!1,e===ko.StopEmittingAndClear){var c=this._firstFreeElement;this._firstRetiredElement=c,this._firstActiveElement=c,this._firstNewElement=c,this._playTime=0,this.emission._reset()}},i.emit=function(t){this._emit(this._playTime,t)},i._emit=function(t,e){if(this.emission.enabled){if(this.main._maxParticleBuffer<this._currentParticleCount)return;for(var n=r._tempVector30,o=r._tempVector31,s=this._renderer.entity.transform,l=this.emission.shape,c=0;c<e;c++){if(l){l._generatePositionAndDirection(this.emission._shapeRand,t,n,o);var u=this.main._getPositionScale();n.multiply(u),o.normalize().multiply(u)}else n.set(0,0,0),o.set(0,0,-1);this._addNewParticle(n,o,s,t)}}},i._update=function(t){var e=this,n=e.main,o=e.emission,s=n.duration,l=this._playTime;if(this._playTime+=t*n.simulationSpeed,this._retireActiveParticles(),this._freeRetiredParticles(),o.enabled&&this._isPlaying){if(this._currentParticleCount>n._maxParticleBuffer){var c=this._getNotRetiredParticleCount();c<n._maxParticleBuffer&&this._resizeInstanceBuffer(!1)}o._emit(l,this._playTime),!n.isLoop&&this._playTime>s&&(this._isPlaying=!1)}if(!this.isAlive){var u=Math.min(o._frameRateTime,Math.floor(this._playTime/s)*s);this._playTime-=u,o._frameRateTime-=u}(this._firstNewElement!=this._firstFreeElement||this._waitProcessRetiredElementCount>0||this._instanceBufferResized||this._instanceVertexBufferBinding._buffer.isContentLost)&&this._addActiveParticlesToVertexBuffer()},i._reorganizeGeometryBuffers=function(){var t=this._renderer,e=t.engine._particleBufferUtils,n=this._primitive,o=this._vertexBufferBindings;if(n.clearVertexElements(),o.length=0,t.renderMode===sn.Mesh){var s=t.mesh;if(!s)return;var l=s.getVertexElement(X.Position),c=s.getVertexElement(X.Color),u=s.getVertexElement(X.UV),d=l?s.vertexBufferBindings[l.bindingIndex]:null,f=c?s.vertexBufferBindings[c.bindingIndex]:null,h=u?s.vertexBufferBindings[u.bindingIndex]:null;if(d){var _=this._addVertexBufferBindingsFilterDuplicate(d,o);n.addVertexElement(new De(X.Position,l.offset,l.format,_))}if(f){var g=this._addVertexBufferBindingsFilterDuplicate(f,o);n.addVertexElement(new De(X.Color,c.offset,c.format,g))}if(h){var y=this._addVertexBufferBindingsFilterDuplicate(h,o);n.addVertexElement(new De(X.UV,u.offset,u.format,y))}var v=s._primitive.indexBufferBinding;n.setIndexBufferBinding(v),this._subPrimitive.count=v.buffer.byteLength/n._glIndexByteCount}else n.addVertexElement(e.billboardVertexElement),o.push(e.billboardVertexBufferBinding),n.setIndexBufferBinding(e.billboardIndexBufferBinding),this._subPrimitive.count=e.billboardIndexCount;n.setVertexBufferBindings(o);for(var p=e.instanceVertexElements,m=o.length,A=0,S=p.length;A<S;A++){var x=p[A];n.addVertexElement(new De(x.attribute,x.offset,x.format,m,x.instanceStepRate))}},i._resizeInstanceBuffer=function(t,e){var n;(n=this._instanceVertexBufferBinding)==null||n.buffer.destroy();var o=this._renderer.engine._particleBufferUtils,s=o.instanceVertexStride,l=t?this._currentParticleCount+e:this.main._maxParticleBuffer,c=s*l,u=this._renderer.engine,d=new qr(u,mr.VertexBuffer,c,yt.Dynamic,!1);d.isGCIgnored=!0;var f=this._primitive.vertexBufferBindings,h=new Ga(d,s),_=new Float32Array(c/4),g=this._instanceVertices;if(g){var y=o.instanceVertexFloatStride,v=this._firstFreeElement,p=this._firstRetiredElement;if(t){var m=this._firstFreeElement*y;_.set(new Float32Array(g.buffer,0,m));var A=(this._firstFreeElement+e)*y;_.set(new Float32Array(g.buffer,m*4),A),this._firstNewElement>v&&(this._firstNewElement+=e),this._firstActiveElement>v&&(this._firstActiveElement+=e),p>v&&(this._firstRetiredElement+=e)}else{var S,x;p<=v?(S=v-p,x=0,this._firstFreeElement-=p,this._firstNewElement-=p,this._firstActiveElement-=p,this._firstRetiredElement=0):(S=this._currentParticleCount-p,x=v,this._firstNewElement>v&&(this._firstNewElement-=v),this._firstActiveElement>v&&(this._firstActiveElement-=v),p>v&&(this._firstRetiredElement-=v)),_.set(new Float32Array(g.buffer,p*y*4,S*y),x*y)}this._instanceBufferResized=!0}this._primitive.setVertexBufferBinding(g?f.length-1:f.length,h),this._instanceVertices=_,this._instanceVertexBufferBinding=h,this._currentParticleCount=l},i._updateShaderData=function(t){this.main._updateShaderData(t),this.velocityOverLifetime._updateShaderData(t),this.textureSheetAnimation._updateShaderData(t),this.sizeOverLifetime._updateShaderData(t),this.rotationOverLifetime._updateShaderData(t),this.colorOverLifetime._updateShaderData(t)},i._resetGlobalRandSeed=function(t){this._randomSeed=t,this.main._resetRandomSeed(t),this.emission._resetRandomSeed(t),this.textureSheetAnimation._resetRandomSeed(t),this.velocityOverLifetime._resetRandomSeed(t),this.rotationOverLifetime._resetRandomSeed(t),this.colorOverLifetime._resetRandomSeed(t)},i._getAliveParticleCount=function(){if(this._firstActiveElement<=this._firstFreeElement)return this._firstFreeElement-this._firstActiveElement;var t=this._currentParticleCount-this._firstActiveElement;return this._firstFreeElement>0&&(t+=this._firstFreeElement),t},i._getNotRetiredParticleCount=function(){if(this._firstRetiredElement<=this._firstFreeElement)return this._firstFreeElement-this._firstRetiredElement;var t=this._currentParticleCount-this._firstRetiredElement;return this._firstFreeElement>0&&(t+=this._firstFreeElement),t},i._destroy=function(){this._instanceVertexBufferBinding.buffer.destroy(),this._primitive.destroy()},i._addNewParticle=function(t,e,n,o){var s=this._firstFreeElement,l=s+1;l>=this._currentParticleCount&&(l=0);var c=this.main;if(l===this._firstRetiredElement){var u=Math.min(r._particleIncreaseCount,c._maxParticleBuffer-this._currentParticleCount);if(u===0)return;this._resizeInstanceBuffer(!0,u),l=s+1}var d,f;c.simulationSpace===Ci.World&&(d=n.worldPosition,f=n.worldRotationQuaternion);var h=this._renderer.engine._particleBufferUtils,_=c.startSpeed.evaluate(void 0,c._startSpeedRand.random()),g=this._instanceVertices,y=s*h.instanceVertexFloatStride;g[y]=t.x,g[y+1]=t.y,g[y+2]=t.z,g[y+h.startLifeTimeOffset]=c.startLifetime.evaluate(void 0,c._startLifeTimeRand.random()),g[y+4]=e.x,g[y+5]=e.y,g[y+6]=e.z,g[y+h.timeOffset]=o;var v=r._tempColor0;c.startColor.evaluate(void 0,c._startColorRand.random(),v),this._renderer.engine.settings.colorSpace===jr.Linear&&v.toLinear(v),g[y+8]=v.r,g[y+9]=v.g,g[y+10]=v.b,g[y+11]=v.a;var p=c._startSizeRand;if(c.startSize3D)g[y+12]=c.startSizeX.evaluate(void 0,p.random()),g[y+13]=c.startSizeY.evaluate(void 0,p.random()),g[y+14]=c.startSizeZ.evaluate(void 0,p.random());else{var m=c.startSize.evaluate(void 0,p.random());g[y+12]=m,g[y+13]=m,g[y+14]=m}var A=c._startRotationRand;c.startRotation3D?(g[y+15]=U.degreeToRadian(c.startRotationX.evaluate(void 0,A.random())),g[y+16]=U.degreeToRadian(c.startRotationY.evaluate(void 0,A.random())),g[y+17]=U.degreeToRadian(c.startRotationZ.evaluate(void 0,A.random()))):g[y+15]=U.degreeToRadian(c.startRotationZ.evaluate(void 0,A.random())),g[y+18]=_;var S=this.colorOverLifetime;S.enabled&&S.color.mode===wr.TwoGradients&&(g[y+20]=S._colorGradientRand.random());var x=this.rotationOverLifetime;x.enabled&&x.rotationZ.mode===pe.TwoConstants&&(g[y+22]=x._rotationRand.random());var b=this.textureSheetAnimation;b.enabled&&b.frameOverTime.mode===pe.TwoCurves&&(g[y+23]=b._frameOverTimeRand.random());var C=this.velocityOverLifetime;if(C.enabled&&C.velocityX.mode===pe.TwoConstants&&C.velocityY.mode===pe.TwoConstants&&C.velocityZ.mode===pe.TwoConstants){var w=C._velocityRand;g[y+24]=w.random(),g[y+25]=w.random(),g[y+26]=w.random()}if(this.main.simulationSpace===Ci.World&&(g[y+27]=d.x,g[y+28]=d.y,g[y+29]=d.z,g[y+30]=f.x,g[y+31]=f.y,g[y+32]=f.z,g[y+33]=f.w),this.textureSheetAnimation.enabled){var E=this.textureSheetAnimation._tillingInfo;g[y+h.simulationUVOffset]=E.x,g[y+35]=E.y,g[y+36]=0,g[y+37]=0}else g[y+h.simulationUVOffset]=1,g[y+35]=1,g[y+36]=0,g[y+37]=0;this._firstFreeElement=l},i._retireActiveParticles=function(){for(var t=this._renderer.engine,e=t._particleBufferUtils,n=t.time.frameCount,o=this._instanceVertices;this._firstActiveElement!==this._firstNewElement;){var s=this._firstActiveElement*e.instanceVertexFloatStride,l=s+e.timeOffset,c=this._playTime-o[l];if(Math.fround(c)<o[s+e.startLifeTimeOffset])break;o[l]=n,++this._firstActiveElement>=this._currentParticleCount&&(this._firstActiveElement=0),this._waitProcessRetiredElementCount++}},i._freeRetiredParticles=function(){for(var t=this._renderer.engine._particleBufferUtils,e=this._renderer.engine.time.frameCount;this._firstRetiredElement!==this._firstActiveElement;){var n=this._firstRetiredElement*t.instanceVertexFloatStride+t.startLifeTimeOffset,o=e-this._instanceVertices[n];if(o<0)break;++this._firstRetiredElement>=this._currentParticleCount&&(this._firstRetiredElement=0)}},i._addActiveParticlesToVertexBuffer=function(){var t=this._firstActiveElement,e=this._firstFreeElement;if(t!==e){var n=this._renderer.engine._particleBufferUtils.instanceVertexStride,o=t*n,s=this._instanceVertexBufferBinding.buffer,l=this._instanceVertices.buffer;if(t<e)s.setData(l,0,o,(e-t)*n,Ri.Discard);else{var c=(this._currentParticleCount-t)*n;s.setData(l,0,o,c,Ri.Discard),e>0&&s.setData(l,c,0,e*n)}this._firstNewElement=e,this._waitProcessRetiredElementCount=0,this._instanceBufferResized=!1}},i._addVertexBufferBindingsFilterDuplicate=function(t,e){for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return e.push(t),n},q(r,[{key:"isAlive",get:function(){return this._isPlaying?!0:this._firstActiveElement!==this._firstFreeElement}},{key:"randomSeed",get:function(){return this._randomSeed},set:function(t){this._resetGlobalRandSeed(t),this.useAutoRandomSeed=!1}}]),r}();(function(){Ge._tempVector30=new P})();(function(){Ge._tempVector31=new P})();(function(){Ge._tempColor0=new K})();(function(){Ge._tempParticleRenderers=new Array})();(function(){Ge._particleIncreaseCount=128})();R([Z],Ge.prototype,"main",void 0);R([Z],Ge.prototype,"emission",void 0);R([Z],Ge.prototype,"velocityOverLifetime",void 0);R([Z],Ge.prototype,"sizeOverLifetime",void 0);R([Z],Ge.prototype,"rotationOverLifetime",void 0);R([Z],Ge.prototype,"colorOverLifetime",void 0);R([Z],Ge.prototype,"textureSheetAnimation",void 0);R([z],Ge.prototype,"_playTime",void 0);R([z],Ge.prototype,"_firstNewElement",void 0);R([z],Ge.prototype,"_firstActiveElement",void 0);R([z],Ge.prototype,"_firstFreeElement",void 0);R([z],Ge.prototype,"_firstRetiredElement",void 0);R([z],Ge.prototype,"_primitive",void 0);R([z],Ge.prototype,"_vertexBufferBindings",void 0);R([z],Ge.prototype,"_subPrimitive",void 0);R([z],Ge.prototype,"_renderer",void 0);R([z],Ge.prototype,"_isPlaying",void 0);R([z],Ge.prototype,"_instanceBufferResized",void 0);R([z],Ge.prototype,"_waitProcessRetiredElementCount",void 0);R([z],Ge.prototype,"_instanceVertexBufferBinding",void 0);R([z],Ge.prototype,"_instanceVertices",void 0);var _C=function(r){W(i,r);function i(t){var e;e=r.call(this,t,Le.find("particle-shader"))||this;var n=e.shaderData;return n.setColor(et._baseColorProp,new K(1,1,1,1)),e.isTransparent=!0,e}var a=i.prototype;return a.clone=function(){var e=new i(this._engine);return this.cloneTo(e),e},q(i,[{key:"baseColor",get:function(){return this.shaderData.getColor(et._baseColorProp)},set:function(e){var n=this.shaderData.getColor(et._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(et._baseTextureProp)},set:function(e){this.shaderData.setTexture(et._baseTextureProp,e),e?this.shaderData.enableMacro(et._baseTextureMacro):this.shaderData.disableMacro(et._baseTextureMacro)}}]),i}(et),wm=function(i,a){this.time=i,this.count=a};R([Z],wm.prototype,"count",void 0);var dl=function(){function r(){this.enable=!0,this.randomDirectionAmount=0}var i=r.prototype;return i._generatePositionAndDirection=function(t,e,n,o){throw new Error("BaseShape: must override it.")},r}(),_n=function(){function r(){}return r.randomPointUnitArcCircle=function(a,t,e){var n=e.random()*a;t.x=Math.cos(n),t.y=Math.sin(n)},r.randomPointInsideUnitArcCircle=function(a,t,e){r.randomPointUnitArcCircle(a,t,e);var n=Math.sqrt(e.random());t.x=t.x*n,t.y=t.y*n},r.randomPointUnitCircle=function(a,t){var e=t.random()*Math.PI*2;a.x=Math.cos(e),a.y=Math.sin(e)},r.randomPointInsideUnitCircle=function(a,t){r.randomPointUnitCircle(a,t);var e=Math.sqrt(t.random());a.x=a.x*e,a.y=a.y*e},r._randomPointUnitSphere=function(a,t){var e=t.random()*2-1,n=t.random()*Math.PI*2,o=Math.sqrt(1-e*e);a.x=o*Math.cos(n),a.y=o*Math.sin(n),a.z=e},r._randomPointInsideUnitSphere=function(a,t){r._randomPointUnitSphere(a,t);var e=Math.pow(t.random(),1/3);a.x=a.x*e,a.y=a.y*e,a.z=a.z*e},r._randomPointInsideHalfUnitBox=function(a,t){t===void 0&&(t=null),a.x=t.random()-.5,a.y=t.random()-.5,a.z=t.random()-.5},r}(),ca;(function(r){r[r.Box=0]="Box",r[r.Circle=1]="Circle",r[r.Cone=2]="Cone",r[r.Hemisphere=3]="Hemisphere",r[r.Sphere=4]="Sphere"})(ca||(ca={}));var Gh=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.shapeType=ca.Box,t.size=new P(1,1,1),t}var a=i.prototype;return a._generatePositionAndDirection=function(e,n,o,s){_n._randomPointInsideHalfUnitBox(o,e),o.multiply(this.size);var l=i._tempVector30;l.set(0,0,-1),_n._randomPointUnitSphere(s,e),P.lerp(l,s,this.randomDirectionAmount,s)},i}(dl);(function(){Gh._tempVector30=new P})();R([Z],Gh.prototype,"size",void 0);var Co;(function(r){r[r.Random=0]="Random",r[r.Loop=1]="Loop"})(Co||(Co={}));var Tm=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.shapeType=ca.Circle,t.radius=1,t.arc=360,t.arcMode=Co.Random,t.arcSpeed=1,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,n,o,s){var l=i._tempPositionPoint;switch(this.arcMode){case Co.Loop:var c=n*this.arcSpeed*(360/this.arc)%1,u=U.degreeToRadian(this.arc*c);l.set(Math.cos(u),Math.sin(u)),l.scale(e.random());break;case Co.Random:_n.randomPointInsideUnitArcCircle(U.degreeToRadian(this.arc),l,e);break}o.set(l.x,l.y,0),o.scale(this.radius),_n._randomPointUnitSphere(s,e),P.lerp(o,s,this.randomDirectionAmount,s)},i}(dl);(function(){Tm._tempPositionPoint=new te})();var fl=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.shapeType=ca.Cone,t.angle=25,t.radius=1,t.length=5,t.emitType=0,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,n,o,s){var l=i._tempVector20,c=U.degreeToRadian(this.angle),u=Math.sin(c),d=Math.cos(c);switch(this.emitType){case 0:_n.randomPointInsideUnitCircle(l,e),o.set(l.x*this.radius,l.y*this.radius,0);var f=i._tempVector21;_n.randomPointInsideUnitCircle(f,e),te.lerp(l,f,this.randomDirectionAmount,f),s.set(f.x*u,f.y*u,-d);break;case 1:_n.randomPointInsideUnitCircle(l,e),o.set(l.x*this.radius,l.y*this.radius,0),s.set(l.x*u,l.y*u,-d),s.normalize();var h=i._tempVector30;P.scale(s,this.length*e.random(),h),o.add(h);var _=i._tempVector31;_n._randomPointUnitSphere(_,e),P.lerp(s,_,this.randomDirectionAmount,s);break}},i}(dl);(function(){fl._tempVector20=new te})();(function(){fl._tempVector21=new te})();(function(){fl._tempVector30=new P})();(function(){fl._tempVector31=new P})();var bf;(function(r){r[r.Base=0]="Base",r[r.Volume=1]="Volume"})(bf||(bf={}));var pC=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.shapeType=ca.Hemisphere,t.radius=1,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,n,o,s){_n._randomPointInsideUnitSphere(o,e),o.scale(this.radius);var l=o.z;l>0&&(o.z=-l),_n._randomPointUnitSphere(s,e),P.lerp(o,s,this.randomDirectionAmount,s)},i}(dl),vC=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.shapeType=ca.Sphere,t.radius=1,t}var a=i.prototype;return a._generatePositionAndDirection=function(e,n,o,s){_n._randomPointInsideUnitSphere(o,e),o.scale(this.radius),_n._randomPointUnitSphere(s,e),P.lerp(o,s,this.randomDirectionAmount,s)},i}(dl),gC=`#define GLSLIFY 1
varying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}`,mC=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 camera_ProjMat;uniform mat4 camera_ViewMat;void main(){gl_Position=camera_ProjMat*camera_ViewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`;Le.create("trail",mC,gC);var Rm=function(r){W(i,r);function i(a){var t;t=r.call(this,a,Le.find("trail"))||this;var e=t.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=Ee.SourceAlpha,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=Ee.One,t.renderState.depthState.writeEnabled=!1,t}return i}(In),wp=new P,yC=function(r){W(i,r);function i(t,e){var n;n=r.call(this,t)||this,n._stroke=e.stroke||.2,n._minSeg=e.minSeg||.02,n._lifetime=e.lifetime||1e3,n._maxPointNum=n._lifetime/1e3*t.engine.targetFrameRate,n._points=[],n._pointStates=[],n._strapPoints=[];for(var o=0;o<n._maxPointNum;o++)n._points.push(new P),n._pointStates.push(n._lifetime),n._strapPoints.push(new P),n._strapPoints.push(new P);n._curPointNum=0;var s=e.material||new Rm(n.engine);return n.setMaterial(s),n.setTexture(e.texture),n._initGeometry(),n}var a=i.prototype;return a.update=function(e){for(var n=0,o=0,s=0;s<this._curPointNum;s++)this._pointStates[s]-=e,this._pointStates[s]<0?n++:n>0&&(o=s-n,this._pointStates[o]=this._pointStates[s],this._points[o].copyFrom(this._points[s]));this._curPointNum-=n;var l=!0;if(this._curPointNum===this._maxPointNum)l=!1;else if(this._curPointNum>0){var c=this._points[this._points.length-1];P.distance(this.entity.transform.worldPosition,c)<this._minSeg&&(l=!1)}l&&(this._pointStates[this._curPointNum]=this._lifetime,this._points[this._curPointNum].copyFrom(this.entity.transform.worldPosition),this._curPointNum++)},a.setTexture=function(e){e&&this.getMaterial().shaderData.setTexture("u_texture",e)},a._render=function(e){this._updateStrapVertices(e.camera,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),r.prototype._render.call(this,e)},a._initGeometry=function(){var e=new Ih(this._entity.engine),n=20,o=this._maxPointNum*2,s=o*n,l=new Float32Array(s),c=[new De("POSITION",0,ie.Vector3,0),new De("TEXCOORD_0",12,ie.Vector2,0)],u=new qr(this.engine,s*4,yt.Dynamic);e.setVertexBufferBinding(u,n),e.setVertexElements(c),e.addSubMesh(0,o,oa.TriangleStrip),this._vertexBuffer=u,this._vertexStride=n,this._vertices=l,this.mesh=e},a._updateStrapVertices=function(e,n){var o=e.viewMatrix,s=o.elements,l=new P(s[0],s[4],s[8]),c=new P(s[1],s[5],s[9]),u=new P(s[2],s[6],s[10]),d=this._stroke;c.scale(d);var f=new P,h=new P,_=new xe;P.transformByQuat(l,_,l),P.transformByQuat(c,_,c);var g=new P,y=new P,v=new P;l.normalize();for(var p=this._vertices,m=0;m<this._maxPointNum;m++){if(m<this._curPointNum){var A=n[m];m===this._curPointNum-1&&m!==0?P.subtract(A,n[m-1],v):P.subtract(n[m+1],A,v),this._projectOnPlane(v,u,v),v.normalize();var S=Math.acos(P.dot(l,v));P.cross(l,v,y),P.dot(y,u)<=0&&(S=Math.PI*2-S),xe.rotationAxisAngle(u,S,_),P.transformByQuat(c,_,g),P.add(A,g,f),P.subtract(A,g,h)}var x=m*2*this._vertexStride/4,b=(m*2+1)*this._vertexStride/4;p[x]=f.x,p[x+1]=f.y,p[x+2]=f.z,p[b]=h.x,p[b+1]=h.y,p[b+2]=h.z}},a._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,n=1/e,o=this._vertices,s=0;s<e;s++){var l=1-s*n,c=s*2*this._vertexStride/4,u=(s*2+1)*this._vertexStride/4;o[c]=0,o[c+1]=l,o[u]=1,o[u+1]=l}}},a._projectOnVector=function(e,n,o){var s=n.clone();P.normalize(s,s);var l=P.dot(e,s);o.x=s.x*l,o.y=s.y*l,o.z=s.z*l},a._projectOnPlane=function(e,n,o){this._projectOnVector(e,n,wp),P.subtract(e,wp,o)},i}(hr),Pm=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.probeLayer=Kr.Everything,t.width=1024,t.height=1024,t.antiAliasing=1,t._isCube=!1,t}var a=i.prototype;return a.onTextureChange=function(e){},a.onBeginRender=function(e){this.enabled&&(this._camera=e,this._oriCameraCullingMask=e.cullingMask,e.cullingMask=this.probeLayer,(!this._activeRenderTarget||this._activeRenderTarget.width!==this.width||this._activeRenderTarget.height!==this.height||this._activeRenderTarget.antiAliasing!==this.antiAliasing)&&(this._renderTarget=new zc(this.engine,this.width,this.height,this._isCube?new Rr(this.engine,this.width):new vr(this.engine,this.width,this.height),Ut.Depth,this.antiAliasing),this._renderTargetSwap=new zc(this.engine,this.width,this.height,this._isCube?new Rr(this.engine,this.width):new vr(this.engine,this.width,this.height),Ut.Depth,this.antiAliasing),this._activeRenderTarget=this._renderTarget),this._oriCameraRenderTarget=e.renderTarget,e.renderTarget=this._activeRenderTarget)},a.onEndRender=function(e){this.enabled&&(this.onTextureChange&&this.onTextureChange(this._texture),this._activeRenderTarget=this._activeRenderTarget===this._renderTarget?this._renderTargetSwap:this._renderTarget)},a._reset=function(){this.enabled&&(this._camera.renderTarget=this._oriCameraRenderTarget,this._camera.cullingMask=this._oriCameraCullingMask)},q(i,[{key:"_texture",get:function(){var e;return(e=this._activeRenderTarget)==null?void 0:e.getColorTexture()}}]),i}(Bt),Tp=new P,ma=new P,ya=new P,AC=function(r){W(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.position=new P(0,0,0),t._isCube=!0,t.oriViewMatrix=new $,t}var a=i.prototype;return a.onBeginRender=function(e){if(this.enabled){r.prototype.onBeginRender.call(this,e),this._storeCamera(e);for(var n=0;n<6;n++)this._setCamera(n,e),e.render(yn.PositiveX+n);this._restoreCamera(e),r.prototype._reset.call(this)}},a._storeCamera=function(e){this.oriViewMatrix.copyFrom(e.viewMatrix),this._oriFieldOfView=e.fieldOfView},a._restoreCamera=function(e){e.viewMatrix.copyFrom(this.oriViewMatrix),e.fieldOfView=this._oriFieldOfView},a._setCamera=function(e,n){switch(e){case 0:ma.set(0,-1,0),ya.set(1,0,0);break;case 1:ma.set(0,-1,0),ya.set(-1,0,0);break;case 2:ma.set(0,0,1),ya.set(0,1,0);break;case 3:ma.set(0,0,-1),ya.set(0,-1,0);break;case 4:ma.set(0,-1,0),ya.set(0,0,1);break;case 5:ma.set(0,-1,0),ya.set(0,0,-1);break}P.add(this.position,ya,Tp),$.lookAt(this.position,Tp,ma,n.viewMatrix),n.fieldOfView=90},i}(Pm);const Rp=Object.freeze(Object.defineProperty({__proto__:null,AmbientLight:An,get AnimationArrayCurve(){return jc},get AnimationBoolCurve(){return Xc},AnimationClip:Vh,AnimationClipCurveBinding:bm,get AnimationColorCurve(){return Yc},AnimationCurve:$r,AnimationEvent:Bu,get AnimationFloatArrayCurve(){return Ks},get AnimationFloatCurve(){return qc},get AnimationQuaternionCurve(){return zo},get AnimationRectCurve(){return Af},get AnimationRefCurve(){return Zc},get AnimationStringCurve(){return $c},get AnimationVector2Curve(){return Kc},get AnimationVector3Curve(){return Js},get AnimationVector4Curve(){return Jc},Animator:ai,get AnimatorConditionMode(){return Sf},AnimatorController:zh,AnimatorControllerLayer:kh,get AnimatorCullingMode(){return Zs},get AnimatorLayerBlendingMode(){return $s},AnimatorLayerMask:fC,AnimatorState:Em,AnimatorStateMachine:Uh,AnimatorStateTransition:Oh,AssetPromise:Ne,get AssetType(){return Re},Background:ym,get BackgroundMode(){return Si},get BackgroundTextureFillMode(){return Xi},BaseMaterial:et,Basic2DBatcher:Ln,BasicRenderPipeline:Cm,get BlendFactor(){return Ee},get BlendMode(){return Ma},get BlendOperation(){return fr},BlendShape:Lh,BlendShapeFrame:lm,BlendState:Eu,BlinnPhongMaterial:ul,BoolUpdateFlag:bu,BoxColliderShape:Hc,BoxShape:Gh,Buffer:qr,get BufferBindFlag(){return mr},BufferMesh:Ih,get BufferUsage(){return yt},BufferUtil:Vc,Burst:wm,get Camera(){return rt},get CameraClearFlags(){return gr},get CameraType(){return qs},Canvas:mm,CapsuleColliderShape:Pu,CharacterController:fS,CircleShape:Tm,CloneManager:mn,get Collider(){return Fr},ColliderShape:Vr,get ColliderShapeUpAxis(){return Gc},get CollisionDetectionMode(){return _f},ColorOverLifetimeModule:en,get ColorSpace(){return jr},get ColorWriteMask(){return dn},get CompareFunction(){return Te},Component:ir,get ConeEmitType(){return bf},ConeShape:fl,ContentRestorer:Ai,get ControllerCollisionFlag(){return gf},get ControllerNonWalkableMode(){return Uc},CubeProbe:AC,get CullMode(){return Mr},CurveKey:jn,get DataType(){return We},get DependentMode(){return Ua},DepthState:am,get DepthTextureMode(){return Ys},get DiffuseMode(){return Ha},DirectLight:Wa,DynamicCollider:br,get DynamicColliderConstraints(){return pf},EmissionModule:pa,Engine:ei,EngineObject:ri,Entity:hn,EventDispatcher:Mh,FixedJoint:hS,get FogMode(){return Wc},Font:No,get FontStyle(){return ji},get GLCapabilityType(){return J},GradientAlphaKey:tu,GradientColorKey:eu,HemisphereShape:pC,HingeJoint:Qo,HitResult:hm,IndexBufferBinding:js,get IndexFormat(){return Wt},InputManager:vm,get InterpolationType(){return Gt},get Joint(){return zn},JointLimits:pS,JointMotor:vS,Keyframe:cr,get Keys(){return La},get Layer(){return Kr},Light:ll,Loader:Ve,Logger:me,MainModule:Oe,Material:In,Mesh:Dh,MeshRenderer:hr,get MeshTopology(){return oa},ModelMesh:Nt,get OverflowMode(){return ka},PBRBaseMaterial:Un,PBRMaterial:Zn,PBRSpecularMaterial:Ya,ParticleCompositeCurve:Qe,ParticleCompositeGradient:qa,ParticleCurve:Ia,get ParticleCurveMode(){return pe},ParticleGenerator:Ge,ParticleGradient:la,get ParticleGradientMode(){return wr},ParticleMaterial:_C,get ParticleRenderMode(){return sn},ParticleRenderer:Nr,get ParticleScaleMode(){return Qn},get ParticleShapeArcMode(){return Co},get ParticleShapeType(){return ca},get ParticleSimulationSpace(){return Ci},get ParticleStopMode(){return ko},PhysicsMaterial:_m,get PhysicsMaterialCombineMode(){return Xs},PhysicsScene:Cr,get PipelineStage(){return pr},PlaneColliderShape:gS,get Platform(){return dr},PointLight:Xa,Pointer:fm,get PointerButton(){return So},get PointerPhase(){return Ur},Primitive:Bh,PrimitiveMesh:ut,Probe:Pm,RasterState:om,ReferResource:ni,get RenderBufferDepthFormat(){return Ut},get RenderFace(){return vi},RenderPass:cs,RenderQueue:fi,get RenderQueueType(){return Dt},RenderState:$n,get RenderStateDataKey(){return ae},RenderTarget:zc,RenderTargetBlendState:im,get Renderer(){return Ce},ResourceManager:Vo,RotationOverLifetimeModule:ht,Scene:cl,SceneManager:dm,Script:Bt,get SetDataOptions(){return Ri},Shader:Le,ShaderData:ii,ShaderFactory:Ui,ShaderMacro:se,ShaderMacroCollection:Ir,ShaderPass:zt,ShaderProperty:k,get ShaderPropertyType(){return lr},ShaderTagKey:yi,get ShadowCascadesMode(){return on},get ShadowResolution(){return Yi},get ShadowType(){return Pi},SizeOverLifetimeModule:Zt,Skin:cm,SkinnedMeshRenderer:Jt,Sky:Oo,SkyBoxMaterial:jo,SkyProceduralMaterial:Di,SphereColliderShape:pm,SphereShape:vC,SpotLight:kn,SpringJoint:_S,Sprite:Rn,SpriteAtlas:tm,get SpriteDrawMode(){return nn},SpriteMask:ar,get SpriteMaskInteraction(){return Tt},get SpriteMaskLayer(){return Lo},SpriteRenderer:tt,get SpriteTileMode(){return Ws},StateMachineScript:xf,StaticCollider:vf,get StencilOperation(){return Je},StencilState:sm,SubMesh:Tu,SubShader:uc,get SunMode(){return Cf},SystemInfo:Jn,get TextHorizontalAlignment(){return wa},TextRenderer:At,TextUtils:Xr,get TextVerticalAlignment(){return Ta},Texture:Kn,Texture2D:vr,Texture2DArray:Fh,get TextureCoordinate(){return na},TextureCube:Rr,get TextureCubeFace(){return yn},get TextureDepthCompareFunction(){return an},get TextureFilterMode(){return Xt},get TextureFormat(){return j},TextureSheetAnimationModule:Or,get TextureUsage(){return Fo},get TextureWrapMode(){return rr},Time:Cu,TrailMaterial:Rm,TrailRenderer:yC,Transform:ye,UnlitMaterial:Qc,Utils:Ye,VelocityOverLifetimeModule:xt,get VertexAttribute(){return X},VertexBufferBinding:Ga,VertexElement:De,get VertexElementFormat(){return ie},get WrapMode(){return el},XRManager:gm,assignmentClone:Ie,deepClone:Z,dependentComponents:sl,ignoreClone:z,request:sa,resourceLoader:at,shallowClone:Ph},Symbol.toStringTag,{value:"Module"}));var de;(function(r){r[r.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",r[r.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",r[r.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",r[r.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",r[r.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",r[r.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",r[r.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",r[r.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",r[r.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",r[r.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",r[r.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",r[r.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",r[r.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",r[r.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",r[r.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",r[r.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",r[r.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",r[r.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",r[r.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",r[r.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",r[r.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",r[r.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",r[r.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",r[r.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",r[r.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",r[r.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",r[r.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",r[r.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",r[r.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",r[r.R11_EAC=37488]="R11_EAC",r[r.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",r[r.RG11_EAC=37490]="RG11_EAC",r[r.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",r[r.RGB8_ETC2=37492]="RGB8_ETC2",r[r.SRGB8_ETC2=37493]="SRGB8_ETC2",r[r.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",r[r.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",r[r.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",r[r.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",r[r.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",r[r.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",r[r.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",r[r.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",r[r.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",r[r.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT",r[r.RGBA_BPTC_UNORM_EXT=36492]="RGBA_BPTC_UNORM_EXT",r[r.SRGB_ALPHA_BPTC_UNORM_EXT=36493]="SRGB_ALPHA_BPTC_UNORM_EXT",r[r.RGB_BPTC_SIGNED_FLOAT_EXT=36494]="RGB_BPTC_SIGNED_FLOAT_EXT",r[r.RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="RGB_BPTC_UNSIGNED_FLOAT_EXT"})(de||(de={}));function Pp(r,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function hl(r,i,a){return i&&Pp(r.prototype,i),a&&Pp(r,a),r}function Ef(r,i){return Ef=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ef(r,i)}function _l(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(i&&i.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),i&&Ef(r,i)}function Hr(r,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](r):r instanceof i}var xC=function(r){_l(i,r);function i(t){var e;e=r.call(this)||this,e._scale=new te;var n=t.width,o=t.height;return e._webCanvas=t,e.width=n,e.height=o,e}var a=i.prototype;return a.resizeByClientSize=function(e){e===void 0&&(e=window.devicePixelRatio);var n=this._webCanvas;(typeof OffscreenCanvas>"u"||!Hr(n,OffscreenCanvas))&&(this.width=n.clientWidth*e,this.height=n.clientHeight*e)},a.setScale=function(e,n){this._scale.set(e,n),this.scale=this._scale},a._onSizeChanged=function(e,n){this._webCanvas.width=e,this._webCanvas.height=n},hl(i,[{key:"scale",get:function(){var e=this._webCanvas;return(typeof OffscreenCanvas>"u"||!Hr(e,OffscreenCanvas))&&this._scale.set(e.clientWidth*devicePixelRatio/e.width,e.clientHeight*devicePixelRatio/e.height),this._scale},set:function(e){var n=this._webCanvas;(typeof OffscreenCanvas>"u"||!Hr(n,OffscreenCanvas))&&(n.style.transformOrigin="left top",n.style.transform="scale("+e.x+", "+e.y+")")}}]),i}(mm),SC=function(r){_l(i,r);function i(){return r.apply(this,arguments)}return i.create=function(t){var e=t.canvas,n=new xC(typeof e=="string"?document.getElementById(e):e),o=new DC(t.graphicDeviceOptions),s=new i(n,o,t),l=s._initialize(t);return l.then(function(){return s.sceneManager.addScene(new cl(s,"DefaultScene")),s})},hl(i,[{key:"canvas",get:function(){return this._canvas}}]),i}(ei);function ru(){return ru=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},ru.apply(this,arguments)}var CC=function(){function r(a,t,e,n,o){n===void 0&&(n=yt.Static);var s=a.gl,l=s.createBuffer(),c=this._getGLBufferUsage(s,n),u=t===mr.VertexBuffer?s.ARRAY_BUFFER:s.ELEMENT_ARRAY_BUFFER;this._gl=s,this._glBuffer=l,this._glBufferUsage=c,this._glBindTarget=u,this._isWebGL2=a.isWebGL2,this.bind(),o?s.bufferData(u,o,c):s.bufferData(u,e,c),s.bindBuffer(u,null)}var i=r.prototype;return i.bind=function(){this._gl.bindBuffer(this._glBindTarget,this._glBuffer)},i.setData=function(t,e,n,o,s,l){var c=this._gl,u=this._glBindTarget;this.bind(),l===Ri.Discard&&c.bufferData(u,t,this._glBufferUsage);var d=e.BYTES_PER_ELEMENT||1,f=s?d*s:e.byteLength;if(o!==0||f<e.byteLength){var h=e.byteOffset!==void 0;if(this._isWebGL2&&h)c.bufferSubData(u,n,e,o,f/d);else{var _=new Uint8Array(h?e.buffer:e,o*d,f);c.bufferSubData(u,n,_)}}else c.bufferSubData(u,n,e);c.bindBuffer(u,null)},i.getData=function(t,e,n,o){if(this._isWebGL2){var s=this._gl;this.bind(),s.getBufferSubData(this._glBindTarget,e,t,n,o)}else throw"Buffer is write-only on WebGL1.0 platforms."},i.destroy=function(){this._gl.deleteBuffer(this._glBuffer),this._gl=null,this._glBuffer=null},i._getGLBufferUsage=function(t,e){switch(e){case yt.Static:return t.STATIC_DRAW;case yt.Dynamic:return t.DYNAMIC_DRAW;case yt.Stream:return t.STREAM_DRAW}},r}(),bC=function(){function r(a){this._rhi=a,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var i=r.prototype;return i.canIUse=function(t){return this.capabilityList.get(t)},i.canIUseCompressedTextureInternalFormat=function(t){var e=de.RGBA_ASTC_4X4_KHR,n=de.RGBA_ASTC_12X12_KHR,o=de.SRGB8_ALPHA8_ASTC_4X4_KHR,s=de.SRGB8_ALPHA8_ASTC_12X12_KHR,l=de.RGB_ETC1_WEBGL,c=de.R11_EAC,u=de.SRGB8_ALPHA8_ETC2_EAC,d=de.RGB_PVRTC_4BPPV1_IMG,f=de.RGBA_PVRTC_2BPPV1_IMG,h=de.RGB_S3TC_DXT1_EXT,_=de.RGBA_S3TC_DXT5_EXT,g=de.RGBA_BPTC_UNORM_EXT,y=de.RGB_BPTC_UNSIGNED_FLOAT_EXT;return t>=e&&n<=n||t>=o&&t<=s?this.canIUse(J.astc):t===l?this.canIUse(J.etc1):t>=c&&t<=u?this.canIUse(J.etc):t>=d&&t<=f?this.canIUse(J.pvrtc):t>=h&&t<=_?this.canIUse(J.s3tc):t>=g&&t<=y?this.canIUse(J.bptc):!1},i._init=function(){var t=this.capabilityList,e=this.rhi.isWebGL2,n=this.rhi.requireExtension.bind(this.rhi),o=J.shaderVertexID,s=J.standardDerivatives,l=J.shaderTextureLod,c=J.elementIndexUint,u=J.depthTexture,d=J.vertexArrayObject,f=J.instancedArrays,h=J.multipleSample,_=J.drawBuffers,g=J.astc,y=J.astc_webkit,v=J.etc,p=J.etc_webkit,m=J.etc1,A=J.etc1_webkit,S=J.pvrtc,x=J.pvrtc_webkit,b=J.s3tc,C=J.s3tc_webkit,w=J.bptc,E=J.textureFloat,T=J.textureHalfFloat,M=J.textureFloatLinear,B=J.textureHalfFloatLinear,I=J.WEBGL_colorBufferFloat,F=J.colorBufferFloat,L=J.colorBufferHalfFloat,V=J.textureFilterAnisotropic;t.set(o,e),t.set(s,e||!!n(s)),t.set(l,e||!!n(l)),t.set(c,e||!!n(c)),t.set(u,e||!!n(u)),t.set(d,e||!!n(d)),t.set(f,e||!!n(f)),t.set(h,e),t.set(_,e||!!n(_)),t.set(E,e||!!n(E)),t.set(T,e||!!n(T)),t.set(M,!!n(M)),t.set(B,e||!!n(B)),t.set(F,e&&!!n(F)||!!n(I)),t.set(L,e&&!!n(F)||!!n(L)),t.set(V,!!n(V)),t.set(g,!!(n(g)||n(y))),t.set(v,!!(n(v)||n(p))),t.set(m,!!(n(m)||n(A))),t.set(S,!!(n(S)||n(x))),t.set(b,!!(n(b)||n(C))),t.set(w,!!n(w))},i._compatibleInterface=function(t,e){var n=this.rhi,o=n.gl,s=null;if(s=n.requireExtension(t))for(var l in e){var c,u=e[l],d=s[u];(c=d)!=null&&c.bind?o[l]=d.bind(s):o[l]=d}},i._compatibleAllInterface=function(){var t=J.depthTexture,e=J.vertexArrayObject,n=J.instancedArrays,o=J.drawBuffers,s=J.textureFilterAnisotropic,l=J.textureHalfFloat,c=J.colorBufferHalfFloat,u=J.WEBGL_colorBufferFloat,d=this.rhi.isWebGL2;if(!d){this._compatibleInterface(t,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(e,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(n,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(o,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var f={};if(this.canIUse(J.drawBuffers)){for(var h=this.maxDrawBuffers,_=0;_<h;_++)_!=0&&(f["COLOR_ATTACHMENT"+_]="COLOR_ATTACHMENT"+_+"_WEBGL"),f["DRAW_BUFFER"+_]="DRAW_BUFFER"+_+"_WEBGL";this._compatibleInterface(o,ru({drawBuffers:"drawBuffersWEBGL"},f))}this._compatibleInterface(l,{HALF_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(c,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(u,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(s,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},hl(r,[{key:"maxTextureSize",get:function(){return this.rhi.renderStates.getParameter(this.rhi.gl.MAX_TEXTURE_SIZE)}},{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(J.shaderVertexID)&&this.canIUse(J.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(J.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(J.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var t=this._rhi.requireExtension(J.textureFilterAnisotropic);this._maxAnisoLevel=t?this._rhi.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var t=this._rhi.gl,e=this.canIUse(J.multipleSample);this._maxAntiAliasing=e?t.getParameter(t.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),r}(),EC=function(){function r(a){this.rhi=a,this._requireResult={}}var i=r.prototype;return i.requireExtension=function(t){return this._requireResult[t]!==void 0?this._requireResult[t]:(this._requireResult[t]=this.rhi.gl.getExtension(t),this._requireResult[t])},r}(),wC=function(){function r(a,t){this._attribLocArray=[],this._vaoMap=new Map,this._primitive=t,this._canUseInstancedArrays=a.canIUse(J.instancedArrays),this._isSupportVAO=a.canIUse(J.vertexArrayObject),this._gl=a.gl}var i=r.prototype;return i.draw=function(t,e){var n=this._gl,o=this._primitive,s=this._isSupportVAO&&o.enableVAO;if(s){o._bufferStructChanged&&this._clearVAO(),this._vaoMap.has(t.id)||this._registerVAO(t);var l=this._vaoMap.get(t.id);n.bindVertexArray(l)}else this._bindBufferAndAttrib(t);var c=o.indexBufferBinding,u=o.instanceCount,d=o._glIndexType,f=o._glIndexByteCount,h=e.topology,_=e.start,g=e.count;if(u)if(this._canUseInstancedArrays)if(c)if(s)n.drawElementsInstanced(h,g,d,_*f,u);else{var v=c.buffer._platformBuffer._glBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v),n.drawElementsInstanced(h,g,d,_*f,u),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArraysInstanced(h,_,g,u);else me.error("ANGLE_instanced_arrays extension is not supported");else if(c)if(s)n.drawElements(h,g,d,_*f);else{var y=c.buffer._platformBuffer._glBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,y),n.drawElements(h,g,d,_*f),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArrays(h,_,g);s?n.bindVertexArray(null):this._disableAttrib()},i.destroy=function(){this._isSupportVAO&&this._clearVAO()},i._bindBufferAndAttrib=function(t){var e=this._gl,n=this._primitive,o=n.vertexBufferBindings;this._attribLocArray.length=0;var s=t.attributeLocation,l=n._vertexElementMap,c,u;for(var d in s){var f=s[d];if(f!==-1){var h=l[d];if(h){var _=o[h.bindingIndex],g=_.buffer,y=_.stride;c=g._platformBuffer._glBuffer,u!==c&&(u=c,e.bindBuffer(e.ARRAY_BUFFER,c)),e.enableVertexAttribArray(f);var v=h._formatMetaInfo;e.vertexAttribPointer(f,v.size,v.type,v.normalized,y,h.offset),this._canUseInstancedArrays&&e.vertexAttribDivisor(f,h.instanceStepRate),this._attribLocArray.push(f)}else me.warn("vertex attribute not found: "+d)}}e.bindBuffer(e.ARRAY_BUFFER,null)},i._disableAttrib=function(){for(var t=this._gl,e=0,n=this._attribLocArray.length;e<n;e++)t.disableVertexAttribArray(this._attribLocArray[e])},i._registerVAO=function(t){var e=this._gl,n=e.createVertexArray();e.bindVertexArray(n);var o=this._primitive.indexBufferBinding;o&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffer._platformBuffer._glBuffer),this._bindBufferAndAttrib(t),e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this._disableAttrib(),this._vaoMap.set(t.id,n)},i._clearVAO=function(){var t=this._gl;this._vaoMap.forEach(function(e){t.deleteVertexArray(e)}),this._vaoMap.clear()},r}(),TC=function(){function r(a){this._parameters={},this._gl=a,this._parameters={},this._parameters[a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_VERTEX_UNIFORM_VECTORS]=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[a.MAX_VERTEX_ATTRIBS]=a.getParameter(a.MAX_VERTEX_ATTRIBS),this._parameters[a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[a.MAX_TEXTURE_SIZE]=a.getParameter(a.MAX_TEXTURE_SIZE),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.colorMask(!0,!0,!0,!0),a.blendColor(0,0,0,0),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS),a.depthMask(!0),a.disable(a.STENCIL_TEST),a.stencilFuncSeparate(a.FRONT,a.ALWAYS,0,255),a.stencilFuncSeparate(a.BACK,a.ALWAYS,0,255),a.stencilOpSeparate(a.FRONT,a.KEEP,a.KEEP,a.KEEP),a.stencilOpSeparate(a.BACK,a.KEEP,a.KEEP,a.KEEP),a.stencilMask(255),a.enable(a.CULL_FACE),a.cullFace(a.BACK),a.disable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,0)}var i=r.prototype;return i.getParameter=function(t){return this._parameters[t]},r}(),Qt=function(){function r(a,t,e){this._texture=t,this._rhi=a,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=e,this._glTexture=this._gl.createTexture()}var i=r.prototype;return i.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},i.setUseDepthCompareMode=function(t){var e=this._gl;e.texParameteri(this._target,e.TEXTURE_COMPARE_MODE,t?e.COMPARE_REF_TO_TEXTURE:e.NONE)},i.generateMipmaps=function(){(this._texture.width!==1||this._texture.height!==1)&&(this._bind(),this._gl.generateMipmap(this._target))},i._bind=function(){this._rhi.bindTexture(this)},i._init=function(t){var e=this._gl,n=this._isWebGL2,o=this._formatDetail,s=o.internalFormat,l=o.baseFormat,c=o.dataType,u=this._texture,d=u.mipmapCount,f=u.width,h=u.height,_=u.usage,g=u._isDepthTexture;if(this._bind(),n&&!(l===e.LUMINANCE_ALPHA||l===e.ALPHA)&&_!==Fo.Dynamic)e.texStorage2D(this._target,d,s,f,h);else if(t)for(var m=0;m<d;m++)for(var A=Math.max(1,f>>m),S=0;S<6;S++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+S,m,s,A,A,0,l,c,null);else if(g)e.texImage2D(this._target,0,s,f,h,0,l,c,null);else for(var y=0;y<d;y++){var v=Math.max(1,f>>y),p=Math.max(1,h>>y);e.texImage2D(this._target,y,s,v,p,0,l,c,null)}},i._getPixelBuffer=function(t,e,n,o,s,l,c){var u=this._gl,d=this._formatDetail,f=d.baseFormat,h=d.dataType;u.bindFramebuffer(u.FRAMEBUFFER,this._getReadFrameBuffer()),l>0&&!this._isWebGL2&&(l=0,me.error("mipLevel only take effect in WebGL2.0")),t!=null?u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+t,this._glTexture,l):u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,this._glTexture,l),u.readPixels(e,n,o,s,f,h,c),u.bindFramebuffer(u.FRAMEBUFFER,null)},i._setWrapMode=function(t,e){var n=this._gl,o=this._isWebGL2,s=this._target,l=this._texture,c=l.width,u=l.height;switch(!o&&t!==rr.Clamp&&(!r._isPowerOf2(c)||!r._isPowerOf2(u))&&(me.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),t=rr.Clamp),t){case rr.Clamp:n.texParameteri(s,e,n.CLAMP_TO_EDGE);break;case rr.Repeat:n.texParameteri(s,e,n.REPEAT);break;case rr.Mirror:n.texParameteri(s,e,n.MIRRORED_REPEAT);break}},i._getReadFrameBuffer=function(){var t=this._rhi._readFrameBuffer;return t||(this._rhi._readFrameBuffer=t=this._gl.createFramebuffer()),t},r._isPowerOf2=function(t){return(t&t-1)===0},r._getFormatDetail=function(t,e,n){switch(t){case j.R8G8B8:return{internalFormat:n?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.R8G8B8A8:return{internalFormat:n?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.R4G4B4A4:return{internalFormat:n?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case j.R5G5B5A1:return{internalFormat:n?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case j.R5G6B5:return{internalFormat:n?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case j.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.LuminanceAlpha:return{internalFormat:e.LUMINANCE_ALPHA,baseFormat:e.LUMINANCE_ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case j.R16G16B16A16:return{internalFormat:n?e.RGBA16F:e.RGBA,baseFormat:e.RGBA,dataType:e.HALF_FLOAT,isCompressed:!1};case j.R32G32B32A32:return{internalFormat:n?e.RGBA32F:e.RGBA,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};case j.BC1:return{internalFormat:de.RGB_S3TC_DXT1_EXT,isCompressed:!0};case j.BC3:return{internalFormat:de.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case j.BC7:return{internalFormat:de.RGBA_BPTC_UNORM_EXT,isCompressed:!0};case j.ETC1_RGB:return{internalFormat:de.RGB_ETC1_WEBGL,isCompressed:!0};case j.ETC2_RGB:return{internalFormat:de.RGB8_ETC2,isCompressed:!0};case j.ETC2_RGBA5:return{internalFormat:de.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case j.ETC2_RGBA8:return{internalFormat:de.RGBA8_ETC2_EAC,isCompressed:!0};case j.PVRTC_RGB2:return{internalFormat:de.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case j.PVRTC_RGBA2:return{internalFormat:de.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case j.PVRTC_RGB4:return{internalFormat:de.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case j.PVRTC_RGBA4:return{internalFormat:de.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case j.ASTC_4x4:return{internalFormat:de.RGBA_ASTC_4X4_KHR,isCompressed:!0};case j.ASTC_5x5:return{internalFormat:de.RGBA_ASTC_5X5_KHR,isCompressed:!0};case j.ASTC_6x6:return{internalFormat:de.RGBA_ASTC_6X6_KHR,isCompressed:!0};case j.ASTC_8x8:return{internalFormat:de.RGBA_ASTC_8X8_KHR,isCompressed:!0};case j.ASTC_10x10:return{internalFormat:de.RGBA_ASTC_10X10_KHR,isCompressed:!0};case j.ASTC_12x12:return{internalFormat:de.RGBA_ASTC_12X12_KHR,isCompressed:!0};case j.Depth:return{internalFormat:n?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT,baseFormat:e.DEPTH_COMPONENT,dataType:n?e.FLOAT:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.DepthStencil:return{internalFormat:n?e.DEPTH32F_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:n?e.FLOAT_32_UNSIGNED_INT_24_8_REV:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case j.Depth16:return{internalFormat:n?e.DEPTH_COMPONENT16:e.DEPTH_COMPONENT,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.Depth24Stencil8:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case j.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case j.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Galacean Engine: "+t)}},r._getRenderBufferDepthFormatDetail=function(t,e,n){switch(t){case Ut.Depth:return{internalFormat:n?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:n?e.FLOAT:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case Ut.DepthStencil:return{internalFormat:n?e.DEPTH32F_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:n?e.FLOAT_32_UNSIGNED_INT_24_8_REV:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case Ut.Stencil:return{internalFormat:e.STENCIL_INDEX8,baseFormat:e.STENCIL_ATTACHMENT,dataType:e.UNSIGNED_BYTE,isCompressed:!1,attachment:e.STENCIL_ATTACHMENT};case Ut.Depth16:return{internalFormat:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_SHORT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case Ut.Depth24Stencil8:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case Ut.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case Ut.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case Ut.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Galacean Engine: "+t)}},r._supportTextureFormat=function(t,e){switch(t){case j.R16G16B16A16:if(!e.canIUse(J.textureHalfFloat))return!1;break;case j.R32G32B32A32:if(!e.canIUse(J.textureFloat))return!1;break;case j.Depth16:case j.Depth24Stencil8:case j.Depth:case j.DepthStencil:if(!e.canIUse(J.depthTexture))return!1;break;case j.Depth24:case j.Depth32:case j.Depth32Stencil8:return e.isWebGL2}return!0},r._supportRenderBufferColorFormat=function(t,e){var n=!0;switch(t){case j.R16G16B16A16:(!e.canIUse(J.colorBufferHalfFloat)||!e.canIUse(J.textureHalfFloat))&&(n=!1);break;case j.R32G32B32A32:(!e.canIUse(J.colorBufferFloat)||!e.canIUse(J.textureFloat))&&(n=!1);break}return n},r._supportRenderBufferDepthFormat=function(t,e){if(!e.isWebGL2)switch(t){case Ut.Depth24:case Ut.Depth32:case Ut.Depth32Stencil8:return!1}return!0},hl(r,[{key:"wrapModeU",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(t){var e=this._gl,n=this._target,o=this._texture._mipmap;switch(this._bind(),t){case Xt.Point:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST);break;case Xt.Bilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR);break;case Xt.Trilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);break}}},{key:"anisoLevel",set:function(t){var e=this._gl;this._bind(),e.texParameterf(this._target,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},{key:"depthCompareFunction",set:function(t){this._bind();var e=this._gl;switch(t){case an.Never:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.NEVER);break;case an.Less:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.LESS);break;case an.Equal:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.EQUAL);break;case an.LessEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);break;case an.Greater:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.GREATER);break;case an.NotEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.NOTEQUAL);break;case an.GreaterEqual:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.GEQUAL);break;case an.Always:e.texParameteri(this._target,e.TEXTURE_COMPARE_FUNC,e.ALWAYS);break}}}]),r}(),RC=function(){function r(a,t){this._MSAAColorRenderBuffers=[],this._curMipLevel=0,this._gl=a.gl,this._isWebGL2=a.isWebGL2,this._target=t;for(var e=t._colorTextures,n=t._depth,o=t.width,s=t.height,l=Hr(n,Kn),c=0,u=e.length;c<u;c++){var d=e[c]._format;if(!Qt._supportRenderBufferColorFormat(d,a))throw new Error("TextureFormat is not supported:"+j[d]+" in RenderTarget")}if(!l&&!Qt._supportRenderBufferDepthFormat(n,a))throw new Error("TextureFormat is not supported:"+j[n]+" in RenderTarget");if(e.length>1&&!a.canIUse(J.drawBuffers))throw new Error("MRT is not supported");if(e.some(function(h){return h.width!==o||h.height!==s}))throw new Error("ColorTexture's size must as same as RenderTarget");if(l&&(n.width!==o||n.height!==s))throw new Error("DepthTexture's size must as same as RenderTarget");if(e.length>1&&e.some(function(h){return Hr(h,Rr)}))throw new Error("MRT+Cube+[,MSAA] is not supported");var f=a.capability.maxAntiAliasing;t.antiAliasing>f&&(me.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+f),t._antiAliasing=f),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),t.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var i=r.prototype;return i.setRenderTargetInfo=function(t,e){var n=this,o=n._gl,s=n._target,l=s.depthTexture,c=s.getColorTexture(0),u=e!==this._curMipLevel;if(o.bindFramebuffer(o.FRAMEBUFFER,this._frameBuffer),c){var d=Hr(c,Rr);(u||d)&&o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,d?o.TEXTURE_CUBE_MAP_POSITIVE_X+t:o.TEXTURE_2D,c._platformTexture._glTexture,e)}if(l){var f=Hr(l,Rr);if(u||f){var h=l._platformTexture;o.framebufferTexture2D(o.FRAMEBUFFER,h._formatDetail.attachment,f?o.TEXTURE_CUBE_MAP_POSITIVE_X+t:o.TEXTURE_2D,h._glTexture,e)}}else if(u){var _=Qt._getRenderBufferDepthFormatDetail(s._depth,o,this._isWebGL2).internalFormat;o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,_,s.width>>e,s.height>>e)}this._curMipLevel=e,this._activeRenderTarget()},i.blitRenderTarget=function(){if(this._MSAAFrameBuffer){var t=this._gl,e=t.COLOR_BUFFER_BIT|(this._target.depthTexture?t.DEPTH_BUFFER_BIT:0),n=this._target,o=n.colorTextureCount,s=n.width,l=n.height;t.bindFramebuffer(t.READ_FRAMEBUFFER,this._MSAAFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this._frameBuffer);for(var c=0;c<o;c++){var u=t.COLOR_ATTACHMENT0+c;this._blitDrawBuffers[c]=u,t.readBuffer(u),t.drawBuffers(this._blitDrawBuffers),t.blitFramebuffer(0,0,s,l,0,0,s,l,e,t.NEAREST),this._blitDrawBuffers[c]=t.NONE}t.bindFramebuffer(t.FRAMEBUFFER,null)}},i.destroy=function(){var t=this._gl;this._frameBuffer&&t.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&t.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&t.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var e=0;e<this._MSAAColorRenderBuffers.length;e++)t.deleteRenderbuffer(this._MSAAColorRenderBuffers[e]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},i._activeRenderTarget=function(){var t=this._gl;this._MSAAFrameBuffer?t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer)},i._bindMainFBO=function(){var t=this._gl,e=this._isWebGL2,n=this._target,o=n._depth,s=n.colorTextureCount,l=n.width,c=n.height,u=new Array(s);t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);for(var d=0;d<s;d++){var f=this._target.getColorTexture(d),h=t.COLOR_ATTACHMENT0+d;u[d]=h,Hr(f,Rr)||t.framebufferTexture2D(t.FRAMEBUFFER,h,t.TEXTURE_2D,f._platformTexture._glTexture,0)}if(s>1&&t.drawBuffers(u),this._oriDrawBuffers=u,o!==null){if(Hr(o,Kn)&&!Hr(o,Rr)){var _=o._platformTexture;t.framebufferTexture2D(t.FRAMEBUFFER,_._formatDetail.attachment,t.TEXTURE_2D,_._glTexture,0)}else if(this._target.antiAliasing<=1){var g=Qt._getRenderBufferDepthFormatDetail(o,t,e),y=g.internalFormat,v=g.attachment,p=t.createRenderbuffer();this._depthRenderBuffer=p,t.bindRenderbuffer(t.RENDERBUFFER,p),t.renderbufferStorage(t.RENDERBUFFER,y,l,c),t.framebufferRenderbuffer(t.FRAMEBUFFER,v,t.RENDERBUFFER,p)}}t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},i._bindMSAAFBO=function(){var t=this._gl,e=this._isWebGL2,n=t.createRenderbuffer(),o=this._target,s=o._depth,l=o.colorTextureCount,c=o.antiAliasing,u=o.width,d=o.height;this._blitDrawBuffers=new Array(l),this._MSAADepthRenderBuffer=n,t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer);for(var f=0;f<l;f++){var h=t.createRenderbuffer();this._MSAAColorRenderBuffers[f]=h,this._blitDrawBuffers[f]=t.NONE,t.bindRenderbuffer(t.RENDERBUFFER,h),t.renderbufferStorageMultisample(t.RENDERBUFFER,c,this._target.getColorTexture(f)._platformTexture._formatDetail.internalFormat,u,d),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.RENDERBUFFER,h)}if(t.drawBuffers(this._oriDrawBuffers),s!==null){var _=Hr(s,Kn)?s._platformTexture._formatDetail:Qt._getRenderBufferDepthFormatDetail(s,t,e),g=_.internalFormat,y=_.attachment;t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorageMultisample(t.RENDERBUFFER,c,g,u,d),t.framebufferRenderbuffer(t.FRAMEBUFFER,y,t.RENDERBUFFER,n)}this._checkFrameBuffer(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},i._checkFrameBuffer=function(){var t=this._gl,e=this._isWebGL2,n=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(e&&n===t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},r}(),PC=function(r){_l(i,r);function i(t,e){var n;n=r.call(this,t,e,t.gl.TEXTURE_2D)||this,n._compressedMipFilled=0;var o=e.format,s=e._mipmap,l=e.width,c=e.height,u=n._isWebGL2;if(!Qt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+j[o]);return s&&!u&&(!Qt._isPowerOf2(l)||!Qt._isPowerOf2(c))&&(me.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=Qt._getFormatDetail(o,n._gl,u),n._formatDetail.isCompressed&&!u||n._init(!1),n}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,c){n===void 0&&(n=0);var u=this._gl,d=this._isWebGL2,f=this._formatDetail,h=f.internalFormat,_=f.baseFormat,g=f.dataType,y=f.isCompressed,v=Math.max(1,this._texture.width>>n),p=Math.max(1,this._texture.height>>n);if(l=l||v-o,c=c||p-s,this._bind(),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,0),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),y){var m=1<<n;d||this._compressedMipFilled&m?u.compressedTexSubImage2D(this._target,n,o,s,l,c,h,e):(u.compressedTexImage2D(this._target,n,h,l,c,0,e),this._compressedMipFilled|=m)}else u.texSubImage2D(this._target,n,o,s,l,c,_,g,e)},a.setImageSource=function(e,n,o,s,l,c){var u=this._gl,d=this._formatDetail,f=d.internalFormat,h=d.baseFormat,_=d.dataType;this._bind(),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,+o),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+s),this._texture.usage===Fo.Dynamic?u.texImage2D(this._target,n,f,h,_,e):u.texSubImage2D(this._target,n,l||0,c||0,h,_,e)},a.getPixelBuffer=function(e,n,o,s,l,c){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");r.prototype._getPixelBuffer.call(this,null,e,n,o,s,l,c)},i}(Qt),MC=function(r){_l(i,r);function i(t,e){var n;n=r.call(this,t,e,t.gl.TEXTURE_2D_ARRAY)||this;var o=e.format,s=e.width,l=e.height,c=e.length,u=e.mipmapCount;if(!n._isWebGL2)throw new Error("Texture2D Array is not supported in WebGL1.0");if(!Qt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+j[o]);return n._bind(),n._formatDetail=Qt._getFormatDetail(o,n._gl,!0),n._gl.texStorage3D(n._target,u,n._formatDetail.internalFormat,s,l,c),n}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,c,u,d){var f=this,h=f._target,_=f._gl,g=this._formatDetail,y=g.internalFormat,v=g.baseFormat,p=g.dataType,m=g.isCompressed;c=c||Math.max(1,this._texture.width>>o)-s,u=u||Math.max(1,this._texture.height>>o)-l,d=d||this._texture.length,this._bind(),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,0),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),m?_.compressedTexSubImage3D(h,o,s,l,e,c,u,d,y,n):_.texSubImage3D(h,o,s,l,e,c,u,d,v,p,n)},a.setImageSource=function(e,n,o,s,l,c,u){var d=this._gl,f=this._formatDetail,h=f.baseFormat,_=f.dataType;this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,+s),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l);var g,y;d.texSubImage3D(this._target,o,c,u,e,(g=n.width)!=null?g:n.codedWidth,(y=n.height)!=null?y:n.codedHeight,1,h,_,n)},a.getPixelBuffer=function(e,n,o,s,l,c,u){var d=this,f=d._gl,h=d._formatDetail;if(h.isCompressed)throw new Error("Unable to read compressed texture");f.bindFramebuffer(f.FRAMEBUFFER,this._getReadFrameBuffer()),f.framebufferTextureLayer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,this._glTexture,c,e),f.readPixels(n,o,s,l,h.baseFormat,h.dataType,u),f.bindFramebuffer(f.FRAMEBUFFER,null)},i}(Qt),BC=function(r){_l(i,r);function i(t,e){var n;n=r.call(this,t,e,t.gl.TEXTURE_CUBE_MAP)||this,n._compressedFaceFilled=[0,0,0,0,0,0];var o=e.format,s=e._mipmap,l=e.width,c=n._isWebGL2;if(!Qt._supportTextureFormat(o,t))throw new Error("Texture format is not supported:"+j[o]);return s&&!c&&!Qt._isPowerOf2(l)&&(me.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=Qt._getFormatDetail(o,n._gl,c),n._formatDetail.isCompressed&&!c||n._init(!0),n}var a=i.prototype;return a.setPixelBuffer=function(e,n,o,s,l,c,u){var d=this._gl,f=this._isWebGL2,h=this._formatDetail,_=h.internalFormat,g=h.baseFormat,y=h.dataType,v=h.isCompressed,p=Math.max(1,this._texture.width>>o);if(c=c||p-s,u=u||p-l,this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,0),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),v){var m=1<<o;f||this._compressedFaceFilled[e]&m?d.compressedTexSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,c,u,_,n):(d.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,_,c,u,0,n),this._compressedFaceFilled[e]|=m)}else d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,c,u,g,y,n)},a.setImageSource=function(e,n,o,s,l,c,u){var d=this._gl,f=this._formatDetail,h=f.baseFormat,_=f.dataType;this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,+s),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,c||0,u||0,h,_,n)},a.getPixelBuffer=function(e,n,o,s,l,c,u){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");r.prototype._getPixelBuffer.call(this,e,n,o,s,l,c,u)},i}(Qt),Mp;(function(r){r[r.Auto=0]="Auto",r[r.WebGL2=1]="WebGL2",r[r.WebGL1=2]="WebGL1"})(Mp||(Mp={}));var DC=function(){function r(a){a===void 0&&(a={}),this._readFrameBuffer=null,this._mainFrameBuffer=null,this._mainFrameWidth=0,this._mainFrameHeight=0,this._enableGlobalDepthBias=!1,this._activeTextures=new Array(32),this._lastViewport=new ue(null,null,null,null),this._lastScissor=new ue(null,null,null,null),this._lastClearColor=new K(null,null,null,null),this._scissorEnable=!1;var t=ru({webGLMode:0,stencil:!0,_forceFlush:!1,_maxAllowSkinUniformVectorCount:256},a);if(Jn.platform===dr.IPhone||Jn.platform===dr.IPad){var e=Jn.operatingSystem.match(/(\d+).?(\d+)?.?(\d+)?/);if(e){var n=parseInt(e[1]),o=parseInt(e[2]);n===15&&o>=0&&o<=4&&(t._forceFlush=!0)}}this._options=t,this._onWebGLContextLost=this._onWebGLContextLost.bind(this),this._onWebGLContextRestored=this._onWebGLContextRestored.bind(this)}var i=r.prototype;return i.init=function(t,e,n){var o=this._options,s=t._webCanvas,l=o.webGLMode;this._onDeviceLost=e,this._onDeviceRestored=n,s.addEventListener("webglcontextlost",this._onWebGLContextLost,!1),s.addEventListener("webglcontextrestored",this._onWebGLContextRestored,!1),s.addEventListener("webglcontextcreationerror",this._onContextCreationError,!1),this._webCanvas=s;var c;if((l==0||l==1)&&(c=s.getContext("webgl2",o),!c&&(typeof OffscreenCanvas>"u"||!Hr(s,OffscreenCanvas))&&(c=s.getContext("experimental-webgl2",o)),this._isWebGL2=!0,c&&!c.deleteQuery&&(this._isWebGL2=!1)),c||(l==0||l==2)&&(c=s.getContext("webgl",o),!c&&(typeof OffscreenCanvas>"u"||!Hr(s,OffscreenCanvas))&&(c=s.getContext("experimental-webgl",o)),this._isWebGL2=!1),!c)throw new Error("Get GL Context FAILED.");this._gl=c,this._initGLState(c)},i.createPlatformPrimitive=function(t){return new wC(this,t)},i.createPlatformTexture2D=function(t){return new PC(this,t)},i.createPlatformTexture2DArray=function(t){return new MC(this,t)},i.createPlatformTextureCube=function(t){return new BC(this,t)},i.createPlatformRenderTarget=function(t){return new RC(this,t)},i.createPlatformBuffer=function(t,e,n,o){return n===void 0&&(n=yt.Static),new CC(this,t,e,n,o)},i.requireExtension=function(t){return this._extensions.requireExtension(t)},i.canIUse=function(t){return this.capability.canIUse(t)},i.canIUseCompressedTextureInternalFormat=function(t){return this.capability.canIUseCompressedTextureInternalFormat(t)},i.viewport=function(t,e,n,o){var s=this,l=s._gl,c=s._lastViewport;(t!==c.x||e!==c.y||n!==c.z||o!==c.w)&&(l.viewport(t,e,n,o),c.set(t,e,n,o))},i.scissor=function(t,e,n,o){var s=this,l=s._gl,c=s._lastScissor;if(t!==c.x||e!==c.y||n!==c.z||o!==c.w){var u=this,d=u._webCanvas;t===0&&e===0&&n===d.width&&o===d.height?this._scissorEnable&&(l.disable(l.SCISSOR_TEST),this._scissorEnable=!1):(this._scissorEnable||(l.enable(l.SCISSOR_TEST),this._scissorEnable=!0),l.scissor(t,e,n,o)),c.set(t,e,n,o)}},i.colorMask=function(t,e,n,o){this._gl.colorMask(t,e,n,o)},i.clearRenderTarget=function(t,e,n){var o=this._gl,s=t._lastRenderState,l=s.blendState.targetBlendState,c=s.depthState,u=s.stencilState,d=0;if(e&gr.Color){d|=o.COLOR_BUFFER_BIT;var f=this._lastClearColor,h=n.r,_=n.g,g=n.b,y=n.a;n&&(h!==f.r||_!==f.g||g!==f.b||y!==f.a)&&(o.clearColor(h,_,g,y),f.set(h,_,g,y)),l.colorWriteMask!==dn.All&&(o.colorMask(!0,!0,!0,!0),l.colorWriteMask=dn.All)}e&gr.Depth&&(d|=o.DEPTH_BUFFER_BIT,c.writeEnabled!==!0&&(o.depthMask(!0),c.writeEnabled=!0)),e&gr.Stencil&&(d|=o.STENCIL_BUFFER_BIT,u.writeMask!==255&&(o.stencilMask(255),u.writeMask=255)),o.clear(d)},i.drawPrimitive=function(t,e,n){t?t.draw(n,e):me.error("draw primitive failed.")},i.activeRenderTarget=function(t,e,n){var o=this._gl,s,l;if(t){var c;(c=t._platformRenderTarget)==null||c._activeRenderTarget(),s=t.width>>n,l=t.height>>n}else o.bindFramebuffer(o.FRAMEBUFFER,this._mainFrameBuffer),s=this._mainFrameWidth||o.drawingBufferWidth,l=this._mainFrameHeight||o.drawingBufferHeight;var u=s*e.z,d=l*e.w,f=e.x*s,h=l-e.y*l-d;this.viewport(f,h,u,d),this.scissor(f,h,u,d)},i.activeTexture=function(t){this._activeTextureID!==t&&(this._gl.activeTexture(t),this._activeTextureID=t)},i.bindTexture=function(t){var e=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[e]!==t&&(this._gl.bindTexture(t._target,t._glTexture),this._activeTextures[e]=t)},i.setGlobalDepthBias=function(t,e){var n=this._gl,o=t!==0||e!==0;o?(n.enable(n.POLYGON_OFFSET_FILL),n.polygonOffset(e,t)):n.disable(n.POLYGON_OFFSET_FILL),this._enableGlobalDepthBias=o},i.flush=function(){this._gl.flush()},i.forceLoseDevice=function(){var t=this.requireExtension(J.WEBGL_lose_context);t.loseContext()},i.forceRestoreDevice=function(){var t=this.requireExtension(J.WEBGL_lose_context);t.restoreContext()},i.resetState=function(){this._readFrameBuffer=null,this._enableGlobalDepthBias=!1,this._currentBindShaderProgram=null;for(var t=this._activeTextures,e=0,n=t.length;e<n;e++)t[e]=null;this._lastViewport.set(null,null,null,null),this._lastScissor.set(null,null,null,null),this._lastClearColor.set(null,null,null,null),this._scissorEnable=!1,this._initGLState(this._gl)},i._initGLState=function(t){this._activeTextureID=t.TEXTURE0,this._renderStates=new TC(t),this._extensions=new EC(this),this._capability=new bC(this),t.activeTexture(t.TEXTURE0);var e=t.getExtension("WEBGL_debug_renderer_info");e!=null&&(this._renderer=t.getParameter(e.UNMASKED_RENDERER_WEBGL))},i.destroy=function(){var t=this._webCanvas;t.removeEventListener("webglcontextcreationerror",this._onContextCreationError,!1),t.removeEventListener("webglcontextlost",this._onWebGLContextLost,!1),t.removeEventListener("webglcontextrestored",this._onWebGLContextRestored,!1)},i._onContextCreationError=function(t){console.error("WebGLRenderer: WebGL context could not be created. Reason: ",t.statusMessage)},i._onWebGLContextLost=function(t){t.preventDefault(),this._onDeviceLost()},i._onWebGLContextRestored=function(t){this._onDeviceRestored()},hl(r,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"renderer",get:function(){return this._renderer}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),r}();function or(){return or=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},or.apply(this,arguments)}function nu(r,i){return nu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nu(r,i)}function le(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(i&&i.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),i&&nu(r,i)}function fe(r,i,a,t){var e=arguments.length,n=e<3?i:t===null?t=Object.getOwnPropertyDescriptor(i,a):t,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,i,a,t);else for(var s=r.length-1;s>=0;s--)(o=r[s])&&(n=(e<3?o(n):e>3?o(i,a,n):o(i,a))||n);return e>3&&n&&Object.defineProperty(i,a,n),n}function Du(r,i){var a={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},t,e,n,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(u){return l([c,u])}}function l(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(t=1,e&&(n=c[0]&2?e.return:c[0]?e.throw||((n=e.return)&&n.call(e),0):e.next)&&!(n=n.call(e,c[1])).done)return n;switch(e=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,e=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){a.label=c[1];break}if(c[0]===6&&a.label<n[1]){a.label=n[1],n=c;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(c);break}n[2]&&a.ops.pop(),a.trys.pop();continue}c=i.call(r,a)}catch(u){c=[6,u],e=0}finally{t=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Bp(r,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Lu(r,i,a){return i&&Bp(r.prototype,i),a&&Bp(r,a),r}var $a=function(){function r(a,t,e,n){t===void 0&&(t=0),n===void 0&&(n=!0),this.data=a,this._dataView=new DataView(a.buffer,a.byteOffset+t,e??a.byteLength-t),this._littleEndian=n,this._position=0,this._baseOffset=t}var i=r.prototype;return i.nextUint8=function(){var t=this._dataView.getUint8(this._position);return this._position+=1,t},i.nextUint16=function(){var t=this._dataView.getUint16(this._position,this._littleEndian);return this._position+=2,t},i.nextUint32=function(){var t=this._dataView.getUint32(this._position,this._littleEndian);return this._position+=4,t},i.nextInt32=function(){var t=this._dataView.getInt32(this._position,this._littleEndian);return this._position+=4,t},i.nextInt32Array=function(t){var e=new Int32Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=4*t,e},i.nextFloat32=function(){var t=this._dataView.getFloat32(this._position,this._littleEndian);return this._position+=4,t},i.nextFloat32Array=function(t){var e=new Float32Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=4*t,e},i.nextUint32Array=function(t){var e=new Uint32Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=4*t,e},i.nextUint8Array=function(t){var e=new Uint8Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=t,e},i.nextUint64=function(){var t=this._dataView.getUint32(this._position,this._littleEndian),e=this._dataView.getUint32(this._position+4,this._littleEndian),n=t+Math.pow(2,32)*e;return this._position+=8,n},i.nextStr=function(){var t=this.nextUint16(),e=new Uint8Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=t,Ye.decodeText(e)},i.nextImageData=function(t){return new Uint8Array(this.data.buffer,this.data.byteOffset+this._position)},i.nextImagesData=function(t){for(var e=new Array(t),n=0;n<t;n++){var o=this._dataView.getUint32(this._position,this._littleEndian);e[n]=o,this._position+=4}for(var s=[],l=0;l<t;l++){var c=e[l],u=new Uint8Array(this.data.buffer,this._dataView.byteOffset+this._position,c);this._position+=c,s.push(u)}return s},i.skip=function(t){return this._position+=t,this},i.scan=function(t,e){e===void 0&&(e=0);for(var n=this._position,o=0;this._dataView.getUint8(this._position)!==e&&o<t;)o++,this._position++;return o<t&&this._position++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,o)},Lu(r,[{key:"position",get:function(){return this._position}},{key:"offset",get:function(){return this._position+this._baseOffset}}]),r}(),Mm={};function Hh(r){return function(i){Mm[r]=i}}var LC=function(){function r(){this.totalLength=0,this.version=0,this.type="",this.name="",this.headerLength=0}return r.decode=function(a){var t=new DataView(a),e=t.getUint32(0,!0),n=t.getUint8(4),o=t.getUint16(5,!0),s=new Uint8Array(a,7,o),l=t.getUint16(7+o,!0),c=new Uint8Array(a,9+o,l),u=Ye.decodeText(c),d=Ye.decodeText(s),f=new r;return f.totalLength=e,f.name=u,f.type=d,f.version=n,f.headerLength=c.byteLength+s.byteLength+9,f},Lu(r,[{key:"dataLength",get:function(){return this.totalLength-this.headerLength}}]),r}(),Dp=function(){function r(){}return r.decode=function(a,t){return new Promise(function(e){var n=new Nt(a),o=t.nextStr(),s=JSON.parse(o);s.bounds&&n.bounds.copyFrom(s.bounds);var l=Math.ceil(t.offset/4)*4+t.data.byteOffset,c=t.data.buffer,u=new Float32Array(c,s.positions.start+l,(s.positions.end-s.positions.start)/4),d=u.length/3,f=Kl(u,d);if(n.setPositions(f),s.normals){var h=new Float32Array(c,s.normals.start+l,(s.normals.end-s.normals.start)/4),_=Kl(h,d);n.setNormals(_)}if(s.uvs){var g=new Float32Array(c,s.uvs.start+l,(s.uvs.end-s.uvs.start)/4);n.setUVs(Oi(g,d))}if(s.uv1){var y=new Float32Array(c,s.uv1.start+l,(s.uv1.end-s.uv1.start)/4);n.setUVs(Oi(y,d),1)}if(s.uv2){var v=new Float32Array(c,s.uv2.start+l,(s.uv2.end-s.uv2.start)/4);n.setUVs(Oi(v,d),2)}if(s.uv3){var p=new Float32Array(c,s.uv3.start+l,(s.uv3.end-s.uv3.start)/4);n.setUVs(Oi(p,d),3)}if(s.uv4){var m=new Float32Array(c,s.uv4.start+l,(s.uv4.end-s.uv4.start)/4);n.setUVs(Oi(m,d),4)}if(s.uv5){var A=new Float32Array(c,s.uv5.start+l,(s.uv5.end-s.uv5.start)/4);n.setUVs(Oi(A,d),5)}if(s.uv6){var S=new Float32Array(c,s.uv6.start+l,(s.uv6.end-s.uv6.start)/4);n.setUVs(Oi(S,d),6)}if(s.uv7){var x=new Float32Array(c,s.uv7.start+l,(s.uv7.end-s.uv7.start)/4);n.setUVs(Oi(x,d),7)}if(s.colors){var b=new Float32Array(c,s.colors.start+l,(s.colors.end-s.colors.start)/4);n.setColors(IC(b,d))}if(s.boneWeights){var C=new Float32Array(c,s.boneWeights.start+l,(s.boneWeights.end-s.boneWeights.start)/4);n.setBoneWeights(hd(C,d))}if(s.boneIndices){var w=new Float32Array(c,s.boneIndices.start+l,(s.boneIndices.end-s.boneIndices.start)/4);n.setBoneIndices(hd(w,d))}if(s.blendShapes&&s.blendShapes.forEach(function(T){var M=new Lh(T.name);T.frames.forEach(function(B){var I=new Float32Array(c,B.deltaPosition.start+l,(B.deltaPosition.end-B.deltaPosition.start)/4),F=I.length/3,L=Kl(I,F);if(B.deltaNormals){var V=new Float32Array(c,B.deltaNormals.start+l,(B.deltaNormals.end-B.deltaNormals.start)/4);Kl(V,F)}if(B.deltaTangents){var D=new Float32Array(c,B.deltaTangents.start+l,(B.deltaTangents.end-B.deltaTangents.start)/4);hd(D,F)}M.addFrame(B.weight,L)}),n.addBlendShape(M)}),s.indices){var E=null;s.indices.type===0?E=new Uint16Array(c,s.indices.start+l,(s.indices.end-s.indices.start)/2):E=new Uint32Array(c,s.indices.start+l,(s.indices.end-s.indices.start)/4),n.setIndices(E)}s.subMeshes.forEach(function(T){return n.addSubMesh(T)}),n.uploadData(!1),e(n)})},r}();Dp=fe([Hh("Mesh")],Dp);function IC(r,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new K(r[t*4],r[t*4+1],r[t*4+2],r[t*4+3]);return a}function hd(r,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new ue(r[t*4],r[t*4+1],r[t*4+2],r[t*4+3]);return a}function Kl(r,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new P(r[t*3],r[t*3+1],r[t*3+2]);return a}function Oi(r,i){for(var a=new Array(i),t=0;t<i;t++)a[t]=new te(r[t*2],r[t*2+1]);return a}var Lp=function(){function r(){}return r.decode=function(a,t){return new Promise(function(e,n){var o=t.nextStr(),s=!!t.nextUint8(),l=t.nextUint8(),c=t.nextUint8(),u=t.nextUint8(),d=t.nextUint8(),f=t.nextUint8(),h=t.nextUint16(),_=t.nextUint16(),g=t.nextUint8(),y=t.nextUint8(),v=t.nextImagesData(y),p=new vr(a,h,_,f,s);if(p.filterMode=l,p.anisoLevel=c,p.wrapModeU=u,p.wrapModeV=d,g){var m=v[0];if(p.setPixelBuffer(m),s){p.generateMipmaps();for(var A=1;A<y;A++){var S=v[A];p.setPixelBuffer(S,A)}}a.resourceManager._objectPool[o]=p,e(p)}else{var x=new window.Blob([v[0]]),b=new Image;b.onload=function(){p.setImageSource(b);var C=0,w=function(){C++,C>=y&&e(p)};if(w(),s){var E=function(M){var B=new window.Blob([v[M]]),I=new Image;I.onload=function(){p.setImageSource(I,M),w()},I.src=URL.createObjectURL(B)};p.generateMipmaps();for(var T=1;T<y;T++)E(T)}},b.src=URL.createObjectURL(x)}})},r}();Lp=fe([Hh("Texture2D")],Lp);function FC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dc(r,i,a){return FC()?dc=Reflect.construct:dc=function(e,n,o){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),c=new l;return o&&nu(c,o.prototype),c},dc.apply(null,arguments)}var Wh=function(){function r(a){this._context=a}var i=r.prototype;return i.parseEntity=function(t){return this._getEntityByConfig(t).then(function(e){var n;e.isActive=(n=t.isActive)!=null?n:!0;var o=t.position,s=t.rotation,l=t.scale;o&&e.transform.position.copyFrom(o),s&&e.transform.rotation.copyFrom(s),l&&e.transform.scale.copyFrom(l);var c;return e.layer=(c=t.layer)!=null?c:e.layer,e})},i.parseClassObject=function(t){var e=this,n=Ve.getClass(t.class),o,s=(o=t.constructParams)!=null?o:[];return Promise.all(s.map(function(l){return e.parseBasicType(l)})).then(function(l){return dc(n,[].concat(l))}).then(function(l){return e.parsePropsAndMethods(l,t)})},i.parsePropsAndMethods=function(t,e){var n=[];if(e.methods)for(var o in e.methods)for(var s=e.methods[o],l=0,c=s.length;l<c;l++)n.push(this.parseMethod(t,o,s[l]));if(e.props){var u=this,d=function(h){var _=e.props[h],g=u.parseBasicType(_,t[h]).then(function(y){return t[h]=y});n.push(g)};for(var f in e.props)d(f)}return Promise.all(n).then(function(){var h=r.customParseComponentHandles[t.constructor.name];return h?h(t,e):t})},i.parseMethod=function(t,e,n){var o=this;return Promise.all(n.map(function(s){return o.parseBasicType(s)})).then(function(s){var l;return(l=t)[e].apply(l,[].concat(s))})},i.parseBasicType=function(t,e){var n=this;if(Array.isArray(t))return Promise.all(t.map(function(u){return n.parseBasicType(u)}));if(typeof t=="object"&&t!=null){if(r._isClass(t))return this.parseClassObject(t);if(r._isAssetRef(t))return this._context.resourceManager.getResourceByRef(t);if(r._isEntityRef(t))return Promise.resolve(this._context.entityMap.get(t.entityId));if(e){var o=this,s=function(u){if(u==="methods"){var d=t[u];for(var f in d)for(var h=d[f],_=0,g=h.length;_<g;_++){var y=h[_],v=o.parseMethod(e,f,y);l.push(v)}}else l.push(o.parseBasicType(t[u],e[u]).then(function(p){return e[u]=p}))},l=[];for(var c in t)s(c);return Promise.all(l).then(function(){return e})}}return Promise.resolve(t)},i._getEntityByConfig=function(t){var e=t.assetRefId,n=this._context.engine;if(e)return n.resourceManager.getResourceByRef({refId:e,key:t.key,isClone:t.isClone}).then(function(s){return s.name=t.name,s});var o=new hn(n,t.name);return Promise.resolve(o)},r.registerCustomParseComponent=function(t,e){this.customParseComponentHandles[t]=e},r._isClass=function(t){return t.class!=null},r._isAssetRef=function(t){return t.refId!=null},r._isEntityRef=function(t){return t.entityId!=null},r}();(function(){Wh.customParseComponentHandles=new Map})();var Bm=function(){function r(a,t,e){this.originalData=a,this.engine=t,this.target=e,this.entityMap=new Map,this.components=new Map,this.assets=new Map,this.entityConfigMap=new Map,this.rootIds=[],this.strippedIds=[],this.resourceManager=t.resourceManager}var i=r.prototype;return i.destroy=function(){this.entityMap.clear(),this.components.clear(),this.assets.clear(),this.entityConfigMap.clear(),this.rootIds.length=0},r}();function Ip(r,i){(i==null||i>r.length)&&(i=r.length);for(var a=0,t=new Array(i);a<i;a++)t[a]=r[a];return t}function NC(r,i){if(r){if(typeof r=="string")return Ip(r,i);var a=Object.prototype.toString.call(r).slice(8,-1);if(a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ip(r,i)}}function As(r,i){var a=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(a)return(a=a.call(r)).next.bind(a);if(Array.isArray(r)||(a=NC(r))||i&&r&&typeof r.length=="number"){a&&(r=a);var t=0;return function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var VC=function(){function r(a){var t=this;this.context=a,this.prefabContextMap=new WeakMap,this.prefabPromiseMap=new Map,this._engine=this.context.engine,this._organizeEntities=this._organizeEntities.bind(this),this._parseComponents=this._parseComponents.bind(this),this._parsePrefabModification=this._parsePrefabModification.bind(this),this._parsePrefabRemovedEntities=this._parsePrefabRemovedEntities.bind(this),this._parsePrefabRemovedComponents=this._parsePrefabRemovedComponents.bind(this),this._clearAndResolve=this._clearAndResolve.bind(this),this.promise=new Promise(function(e,n){t._reject=n,t._resolve=e}),this._reflectionParser=new Wh(a)}var i=r.prototype;return i.start=function(){this._parseEntities().then(this._organizeEntities).then(this._parseComponents).then(this._parsePrefabModification).then(this._parsePrefabRemovedEntities).then(this._parsePrefabRemovedComponents).then(this._clearAndResolve).then(this._resolve).catch(this._reject)},i._parseEntities=function(){var t=this,e=this.context.originalData.entities,n=this.context.entityConfigMap,o=this.context.entityMap,s=this._engine,l=e.map(function(c){var u,d=(u=c.strippedId)!=null?u:c.id;return c.id=d,n.set(d,c),t._getEntityByConfig(c,s)});return Promise.all(l).then(function(c){for(var u=0,d=c.length;u<d;u++)o.set(e[u].id,c[u]);return c})},i._parseComponents=function(){for(var t=this.context.originalData.entities,e=this.context.entityMap,n=this.context.components,o=[],s=0,l=t.length;s<l;s++)for(var c=t[s],u=e.get(c.id),d=0;d<c.components.length;d++){var f=c.components[d],h=f.refId?f.refId:f.class,_=u.addComponent(Ve.getClass(h));n.set(f.id,_);var g=this._reflectionParser.parsePropsAndMethods(_,f);o.push(g)}return Promise.all(o)},i._parsePrefabModification=function(){for(var t=function(u,d){var f,h=n[u],_=h.id,g=h.modifications;if((f=g)!=null&&f.length){var y,v=o.get(_);(y=s).push.apply(y,[].concat(g.map(function(p){var m=p.target,A=p.props,S=p.methods,x=m.entityId,b=m.componentId,C=e.prefabContextMap.get(v),w=C.entityMap.get(x),E=C.components.get(b);if(E)return e._reflectionParser.parsePropsAndMethods(E,{props:A,methods:S});if(w)return Promise.resolve(e._applyEntityData(w,A))})))}},e=this,n=this.context.originalData.entities,o=this.context.entityMap,s=[],l=0,c=n.length;l<c;l++)t(l);return Promise.all(s)},i._parsePrefabRemovedEntities=function(){for(var t=function(u,d){var f,h=n[u],_=h.id,g=h.removedEntities;if((f=g)!=null&&f.length){var y,v=o.get(_);(y=s).push.apply(y,[].concat(g.map(function(p){var m=p.entityId,A=e.prefabContextMap.get(v),S=A.entityMap.get(m);S&&S.destroy()})))}},e=this,n=this.context.originalData.entities,o=this.context.entityMap,s=[],l=0,c=n.length;l<c;l++)t(l);return Promise.all(s)},i._parsePrefabRemovedComponents=function(){for(var t=function(u,d){var f,h=n[u],_=h.id,g=h.removedComponents;if((f=g)!=null&&f.length){var y,v=o.get(_);(y=s).concat.apply(y,[].concat(g.map(function(p){var m=p.componentId,A=e.prefabContextMap.get(v),S=A.components.get(m);S&&S.destroy()})))}},e=this,n=this.context.originalData.entities,o=this.context.entityMap,s=[],l=0,c=n.length;l<c;l++)t(l);return Promise.all(s)},i._clearAndResolve=function(){var t=this.context.target;return t},i._organizeEntities=function(){for(var t=this.context,e=t.rootIds,n=t.strippedIds,o=e.concat(n),s=As(o),l;!(l=s()).done;){var c=l.value;this._parseChildren(c)}for(var u=0;u<e.length;u++)this.handleRootEntity(e[u])},i._getEntityByConfig=function(t,e){var n=this,o;return t.assetRefId?o=this._parseGLTF(t,e):t.strippedId?o=this._parseStrippedEntity(t):o=this._parseEntity(t,e),o.then(function(s){return n._applyEntityData(s,t)})},i._parseEntity=function(t,e){var n=new hn(e,t.name);return t.parent||this.context.rootIds.push(t.id),Promise.resolve(n)},i._parseGLTF=function(t,e){var n=this,o=t.assetRefId,s=new Bm(null,e);return e.resourceManager.getResourceByRef({refId:o}).then(function(l){var c=l.instantiateSceneRoot();t.parent||n.context.rootIds.push(t.id),n._traverseAddEntityToMap(c,s,""),n.prefabContextMap.set(c,s);var u=n.prefabPromiseMap.get(t.id);return u&&u.forEach(function(d){d.resolve(s)}),c})},i._parseStrippedEntity=function(t){var e=this;return this.context.strippedIds.push(t.id),new Promise(function(n,o){var s,l=(s=e.prefabPromiseMap.get(t.prefabInstanceId))!=null?s:[];l.push({resolve:n,reject:o}),e.prefabPromiseMap.set(t.prefabInstanceId,l)}).then(function(n){var o=t.prefabSource.entityId;return n.entityMap.get(o)})},i._parseChildren=function(t){var e=this.context,n=e.entityConfigMap,o=e.entityMap,s=n.get(t).children;if(s&&s.length>0)for(var l=o.get(t),c=0;c<s.length;c++){var u=s[c],d=o.get(u);l.addChild(d),this._parseChildren(u)}},i._applyEntityData=function(t,e){var n;t.isActive=(n=e.isActive)!=null?n:t.isActive;var o;t.name=(o=e.name)!=null?o:t.name;var s=e.position,l=e.rotation,c=e.scale;return s&&t.transform.position.copyFrom(s),l&&t.transform.rotation.copyFrom(l),c&&t.transform.scale.copyFrom(c),t},i._traverseAddEntityToMap=function(t,e,n){var o=e.entityMap,s=e.components;o.set(n,t),t._components.forEach(function(d){var f=Ve.getClassName(d.constructor);s.set(n+":"+f,d)});for(var l=0;l<t.children.length;l++){var c=t.children[l],u=n?n+"/"+c.name:c.name;this._traverseAddEntityToMap(c,e,u)}},r}(),Fp;(function(r){r[r.Float=0]="Float",r[r.FloatArray=1]="FloatArray",r[r.Vector2=2]="Vector2",r[r.Vector3=3]="Vector3",r[r.Vector4=4]="Vector4",r[r.Quaternion=5]="Quaternion",r[r.Color=6]="Color",r[r.Array=7]="Array",r[r.Boolean=8]="Boolean",r[r.Rect=9]="Rect",r[r.ReferResource=10]="ReferResource"})(Fp||(Fp={}));var Np=function(){function r(){}return r.decode=function(a,t){return new Promise(function(e){for(var n=t.nextStr(),o=new Vh(n),s=t.nextUint16(),l=0;l<s;++l){var c=new Bu;c.time=t.nextFloat32(),c.functionName=t.nextStr(),c.parameter=JSON.parse(t.nextStr()).val,o.addEvent(c)}for(var u=t.nextUint16(),d=0;d<u;++d){var f=t.nextStr(),h=t.nextStr(),_=Ve.getClass(h),g=t.nextStr(),y=t.nextStr(),v=void 0,p=t.nextUint8(),m=t.nextUint16(),A=t.nextStr();switch(A){case"AnimationFloatCurve":{v=new qc,v.interpolation=p;for(var S=0;S<m;++S){var x=new cr;x.time=t.nextFloat32(),x.value=t.nextFloat32(),x.inTangent=t.nextFloat32(),x.outTangent=t.nextFloat32(),v.addKey(x)}break}case"AnimationArrayCurve":{v=new jc,v.interpolation=p;for(var b=0;b<m;++b){var C=new cr;C.time=t.nextFloat32();var w=t.nextUint16();C.value=Array.from(t.nextFloat32Array(w)),C.inTangent=Array.from(t.nextFloat32Array(w)),C.outTangent=Array.from(t.nextFloat32Array(w)),v.addKey(C)}break}case"AnimationFloatArrayCurve":{v=new Ks,v.interpolation=p;for(var E=0;E<m;++E){var T=new cr;T.time=t.nextFloat32();var M=t.nextUint16();T.value=t.nextFloat32Array(M),T.inTangent=Array.from(t.nextFloat32Array(M)),T.outTangent=Array.from(t.nextFloat32Array(M)),v.addKey(T)}break}case"AnimationVector2Curve":{v=new Kc,v.interpolation=p;for(var B=0;B<m;++B){var I=new cr;I.time=t.nextFloat32(),I.value=new te(t.nextFloat32(),t.nextFloat32()),I.inTangent=new te(t.nextFloat32(),t.nextFloat32()),I.outTangent=new te(t.nextFloat32(),t.nextFloat32()),v.addKey(I)}break}case"AnimationVector3Curve":{v=new Js,v.interpolation=p;for(var F=0;F<m;++F){var L=new cr;L.time=t.nextFloat32(),L.value=new P(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),L.inTangent=new P(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),L.outTangent=new P(t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),v.addKey(L)}break}case"AnimationVector4Curve":{v=new Jc,v.interpolation=p;var V=new cr;V.time=t.nextFloat32(),V.value=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),V.inTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),V.outTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),v.addKey(V);break}case"AnimationColorCurve":{v=new Yc,v.interpolation=p;for(var D=0;D<m;++D){var N=new cr;N.time=t.nextFloat32(),N.value=new K(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),N.inTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),N.outTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),v.addKey(N)}break}case"AnimationQuaternionCurve":{v=new zo,v.interpolation=p;for(var O=0;O<m;++O){var G=new cr;G.time=t.nextFloat32(),G.value=new xe(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),G.inTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),G.outTangent=new ue(t.nextFloat32(),t.nextFloat32(),t.nextFloat32(),t.nextFloat32()),v.addKey(G)}break}case"AnimationRefCurve":{v=new Zc,v.interpolation=p;for(var Q=0;Q<m;++Q){var H=new cr;H.time=t.nextFloat32();var ee=t.nextStr();ee?H.value=JSON.parse(ee):H.value=null,v.addKey(H)}break}case"AnimationBoolCurve":{v=new Xc,v.interpolation=p;for(var ve=0;ve<m;++ve){var oe=new cr;oe.time=t.nextFloat32(),oe.value=t.nextUint8()===1,v.addKey(oe)}break}case"AnimationStringCurve":{v=new $c,v.interpolation=p;for(var ne=0;ne<m;++ne){var Me=new cr;Me.time=t.nextFloat32(),Me.value=t.nextStr(),v.addKey(Me)}break}}o.addCurveBinding(f,_,g,y,v)}e(o)})},r}();Np=fe([Hh("AnimationClip")],Np);var Vp;(function(r){r.Sky="Sky",r.Custom="Custom"})(Vp||(Vp={}));var OC=function(r){le(i,r);function i(a,t,e){var n;return n=r.call(this,a,t,e)||this,n.originalData=a,n.engine=t,n.scene=e,n}return i}(Bm),zC=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.handleRootEntity=function(e){var n=this.context,o=n.target,s=n.entityMap;o.addRootEntity(s.get(e))},i.parse=function(e,n){var o=new cl(e),s=new OC(n,e,o),l=new i(s);return l.start(),l.promise},i}(VC),Op=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(c){Iu(c,n.engine).then(function(u){s(u)})}).catch(l)})},i}(Ve);Op=fe([at("Mesh",["prefab"],!0)],Op);var zp=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(c){Iu(c,n.engine).then(function(u){s(u)})}).catch(l)})},i}(Ve);zp=fe([at("EditorTexture2D",["prefab"],!0)],zp);function Iu(r,i){var a=LC.decode(r),t=new $a(new Uint8Array(r),a.headerLength,a.dataLength);return Mm[a.type].decode(i,t).then(function(e){return e.name=a.name,e})}var kp=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,or({},e,{type:"arraybuffer"})).then(function(c){return Iu(c,n.engine).then(function(u){var d=u.curveBindings.map(function(f){var h=f.curve,_=h.keys.map(function(g){return o._parseKeyframeValue(g,n).then(function(y){g.value=y})});return Promise.all(_)});return Promise.all(d).then(function(){s(u)})}).catch(l)}).catch(l)})},a._parseKeyframeValue=function(e,n){var o,s=e.value;return typeof s=="object"&&((o=s)!=null&&o.refId)?new Promise(function(l){n.getResourceByRef(s).then(function(c){e.value=c,l(e.value)})}):Promise.resolve(e.value)},i}(Ve);kp=fe([at(Re.AnimationClip,["ani"])],kp);var Up=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,or({},e,{type:"json"})).then(function(c){var u=new zh,d=c.layers,f=[];d.forEach(function(h,_){var g=h.name,y=h.blendingMode,v=h.weight,p=h.stateMachine,m=new kh(g);if(m.blendingMode=y,m.weight=v,p){var A=p.states,S=m.stateMachine=new Uh;A.forEach(function(x,b){var C,w=x.name,E=x.speed,T=x.wrapMode,M=x.clipStartNormalizedTime,B=x.clipEndNormalizedTime,I=x.isDefaultState,F=x.clip,L=x.scripts,V=S.addState(w);I&&(S.defaultState=V),V.speed=E,V.wrapMode=T,V.clipStartTime=M,V.clipEndTime=B;var D=JSON.parse(L);(C=D)==null||C.forEach(function(N){V.addStateMachineScript(Ve.getClass(N))}),F&&f.push(new Promise(function(N){n.getResourceByRef(F).then(function(O){N({layerIndex:_,stateIndex:b,clip:O})})}))}),A.forEach(function(x){var b=x.name,C=x.transitions;C.forEach(function(w){var E=w.targetStateName,T=w.duration,M=w.offset,B=w.exitTime,I=S.findStateByName(b),F=S.findStateByName(E),L=new Oh;L.destinationState=F,L.duration=T,L.exitTime=B,L.offset=M,I.addTransition(L)})})}u.addLayer(m)}),Promise.all(f).then(function(h){h.forEach(function(_){var g=_.layerIndex,y=_.stateIndex,v=_.clip;u.layers[g].stateMachine.states[y].clip=v}),s(u)})}).catch(l)})},i}(Ve);Up=fe([at(Re.AnimatorController,["json"],!1)],Up);function kC(r){return/^data:(.+?);base64,/.test(r)}var Gp=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e){var n=e.url;return kC(n)?new Ne(function(o){var s=n.slice(13+RegExp.$1.length),l=Uint8Array.from(atob(s),function(c){return c.charCodeAt(0)});o(l.buffer)}):this.request(n,or({},e,{type:"arraybuffer"}))},i}(Ve);Gp=fe([at(Re.Buffer,["bin","r3bin"],!1)],Gp);var Hp=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(c){var u,d=new Float32Array(c,0,27),f=27*4,h=(u=new Uint16Array(c,f,1))==null?void 0:u[0],_=n.engine,g=new Rr(_,h);g.filterMode=Xt.Trilinear;for(var y=g.mipmapCount,v=f+2,p=0;p<y;p++)for(var m=h>>p,A=0;A<6;A++){var S=m*m*4,x=new Uint8Array(c,v,S);v+=S,g.setPixelBuffer(yn.PositiveX+A,x,p)}var b=new An(_),C=new p1;b.diffuseMode=Ha.SphericalHarmonics,C.copyFromArray(d),b.diffuseSphericalHarmonics=C,b.specularTexture=g,b.specularTextureDecodeRGBM=!0,s(b)}).catch(function(c){l(c)})})},i}(Ve);Hp=fe([at(Re.Env,["env"])],Hp);function Wp(r,i,a,t,e,n,o){try{var s=r[n](o),l=s.value}catch(c){a(c);return}s.done?i(l):Promise.resolve(l).then(t,e)}function Fu(r){return function(){var i=this,a=arguments;return new Promise(function(t,e){var n=r.apply(i,a);function o(l){Wp(n,t,e,o,s,"next",l)}function s(l){Wp(n,t,e,o,s,"throw",l)}o(void 0)})}}var Qp=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,{type:"json"}).then(function(c){var u=c.fontName,d=c.fontUrl;if(d)o._registerFont(u,d).then(function(){var h=new No(n.engine,u);s(h)}).catch(function(h){l("load font "+d+" fail")});else{var f=new No(n.engine,u);s(f)}}).catch(function(c){l(c)})})},a._registerFont=function(e,n){return Fu(function(){var o;return Du(this,function(s){switch(s.label){case 0:return o=new FontFace(e,"url("+n+")"),[4,o.load()];case 1:return s.sent(),document.fonts.add(o),[2]}})})()},i}(Ve);Qp=fe([at(Re.Font,["font"],!1)],Qp);var UC=function(r){le(i,r);function i(t,e){var n;return n=r.call(this,t)||this,n.url=e,n}var a=i.prototype;return a.instantiateSceneRoot=function(e){var n=e===void 0?this._defaultSceneRoot:this._sceneRoots[e];return n.clone()},a._onDestroy=function(){r.prototype._onDestroy.call(this);var e=this,n=e.textures,o=e.materials,s=e.meshes;if(n&&this._disassociationSuperResource(n),o&&this._disassociationSuperResource(o),s)for(var l=0,c=s.length;l<c;l++)this._disassociationSuperResource(s[l])},a._disassociationSuperResource=function(e){for(var n=0,o=e.length;n<o;n++)e[n]._disassociationSuperResource(this)},Lu(i,[{key:"extensionsData",get:function(){return this._extensionsData}},{key:"sceneRoots",get:function(){return this._sceneRoots}},{key:"defaultSceneRoot",get:function(){return this._defaultSceneRoot}}]),i}(ni),bt;(function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT"})(bt||(bt={}));var ui;(function(r){r.SCALAR="SCALAR",r.VEC2="VEC2",r.VEC3="VEC3",r.VEC4="VEC4",r.MAT2="MAT2",r.MAT3="MAT3",r.MAT4="MAT4"})(ui||(ui={}));var En;(function(r){r.TRANSLATION="translation",r.ROTATION="rotation",r.SCALE="scale",r.WEIGHTS="weights"})(En||(En={}));var ho;(function(r){r.Linear="LINEAR",r.Step="STEP",r.CubicSpine="CUBICSPLINE"})(ho||(ho={}));var iu;(function(r){r.PERSPECTIVE="perspective",r.ORTHOGRAPHIC="orthographic"})(iu||(iu={}));var jp;(function(r){r.JPEG="image/jpeg",r.PNG="image/png"})(jp||(jp={}));var xs;(function(r){r.OPAQUE="OPAQUE",r.MASK="MASK",r.BLEND="BLEND"})(xs||(xs={}));var wf;(function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR"})(wf||(wf={}));var au;(function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(au||(au={}));var Ss;(function(r){r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.REPEAT=10497]="REPEAT"})(Ss||(Ss={}));var Qh=function(){function r(a,t,e){var n=this;this.glTFResource=a,this.resourceManager=t,this.params=e,this.accessorBufferCache={},this._resourceCache=new Map,this._progress={taskDetail:{},taskComplete:{loaded:0,total:0}},this._onTaskDetail=function(o,s,l){var c,u,d=(c=n._progress.taskDetail)[u=o]||(c[u]={});d.loaded=s,d.total=l,n._setTaskDetailProgress(o,s,l)},this.contentRestorer=new KC(a)}var i=r.prototype;return i.get=function(t,e){var n=this,o=r._parsers[t];if(!o)return Promise.resolve(null);var s=this._resourceCache,l=t===0||t===1,c=l||e===void 0?""+t:t+":"+e,u=s.get(c);if(u)return u;if(l)u=o.parse(this);else{var d=this.glTF[GC[t]];d&&(e===void 0||d[e])?e===void 0?u=t===8?d.map(function(f,h){return n.get(t,h)}):Promise.all(d.map(function(f,h){return n.get(t,h)})):(u=o.parse(this,e),this._handleSubAsset(u,t,e)):u=Promise.resolve(null)}return s.set(c,u),u},i.parse=function(){var t=this,e=this.get(0).then(function(n){return t.glTF=n,Promise.all([t.get(1),t.get(5),t.get(6),t.get(7),t.get(9),t.get(10),t.get(2)]).then(function(){var o=t.glTFResource;return(o.skins||o.animations)&&t._createAnimator(t,o.animations),t.resourceManager.addContentRestorer(t.contentRestorer),o})});return this._addTaskCompletePromise(e),e},i._addTaskCompletePromise=function(t){var e=this,n=this._progress.taskComplete;n.total+=1,t.then(function(){e._setTaskCompleteProgress(++n.loaded,n.total)})},i._createAnimator=function(t,e){var n=t.glTFResource.defaultSceneRoot,o=n.addComponent(ai),s=new zh,l=new kh("layer"),c=new Uh;if(s.addLayer(l),o.animatorController=s,l.stateMachine=c,e)for(var u=0;u<e.length;u++){var d=e[u],f=d.name,h=c.makeUniqueStateName(f);h!==f&&console.warn("AnimatorState name is existed, name: "+f+" reset to "+h);var _=c.addState(h);_.clip=d}},i._handleSubAsset=function(t,e,n){var o=this,s=HC[e];if(s)if(e===8){var l,c;((l=this.glTFResource)[c=s]||(l[c]=[]))[n]=t}else{var u=this.glTFResource.url;t.then(function(d){var f,h;if(((f=o.glTFResource)[h=s]||(f[h]=[]))[n]=d,e===7)for(var _=0,g=d.length;_<g;_++){var y=d[_];o.resourceManager._onSubAssetSuccess(u+"?q="+s+"["+n+"]["+_+"]",y)}else{o.resourceManager._onSubAssetSuccess(u+"?q="+s+"["+n+"]",d);var v;e===2&&((v=o.glTF.scene)!=null?v:0)===n&&o.resourceManager._onSubAssetSuccess(""+u+"?q=defaultSceneRoot",d)}})}},r.addParser=function(t,e){this._parsers[t]=e},r}();(function(){Qh._parsers={}})();var Xp=function(i,a,t){this.data=i,this.interleaved=a,this.stride=t,this.vertexBindingInfos={}},Ae;(function(r){r[r.Schema=0]="Schema",r[r.Validator=1]="Validator",r[r.Scene=2]="Scene",r[r.Buffer=3]="Buffer",r[r.BufferView=4]="BufferView",r[r.Texture=5]="Texture",r[r.Material=6]="Material",r[r.Mesh=7]="Mesh",r[r.Entity=8]="Entity",r[r.Skin=9]="Skin",r[r.Animation=10]="Animation"})(Ae||(Ae={}));var bn,GC=(bn={},bn[2]="scenes",bn[3]="buffers",bn[5]="textures",bn[6]="materials",bn[7]="meshes",bn[8]="nodes",bn[9]="skins",bn[10]="animations",bn[4]="bufferViews",bn),li,HC=(li={},li[2]="_sceneRoots",li[5]="textures",li[6]="materials",li[7]="meshes",li[8]="entities",li[9]="skins",li[10]="animations",li);function Gn(r){return function(i){var a=new i;Qh.addParser(r,a)}}var je=function(){function r(){}return r.floatBufferToVector2Array=function(a){for(var t=a.length,e=new Array(t/2),n=0;n<t;n+=2)e[n/2]=new te(a[n],a[n+1]);return e},r.floatBufferToVector3Array=function(a){for(var t=a.length,e=new Array(t/3),n=0;n<t;n+=3)e[n/3]=new P(a[n],a[n+1],a[n+2]);return e},r.floatBufferToVector4Array=function(a){for(var t=a.length,e=new Array(t/4),n=0;n<t;n+=4)e[n/4]=new ue(a[n],a[n+1],a[n+2],a[n+3]);return e},r.floatBufferToColorArray=function(a,t){var e=a.length,n=new Array(e/(t?3:4));if(t)for(var o=0;o<e;o+=3)n[o/3]=new K(a[o],a[o+1],a[o+2],1);else for(var s=0;s<e;s+=4)n[s/4]=new K(a[s],a[s+1],a[s+2],a[s+3]);return n},r.getAccessorTypeSize=function(a){switch(a){case ui.SCALAR:return 1;case ui.VEC2:return 2;case ui.VEC3:return 3;case ui.VEC4:return 4;case ui.MAT2:return 4;case ui.MAT3:return 9;case ui.MAT4:return 16}},r.getComponentType=function(a){switch(a){case bt.BYTE:return Int8Array;case bt.UNSIGNED_BYTE:return Uint8Array;case bt.SHORT:return Int16Array;case bt.UNSIGNED_SHORT:return Uint16Array;case bt.UNSIGNED_INT:return Uint32Array;case bt.FLOAT:return Float32Array}},r.getNormalizedComponentScale=function(a){switch(a){case bt.BYTE:return 1/127;case bt.UNSIGNED_BYTE:return 1/255;case bt.SHORT:return 1/32767;case bt.UNSIGNED_SHORT:return 1/65535;default:throw new Error("Galacean.GLTFLoader: Unsupported normalized accessor component type.")}},r.getAccessorBuffer=function(a,t,e){var n=e.componentType,o=t[e.bufferView];return a.get(Ae.BufferView,e.bufferView).then(function(s){var l=o.buffer,c,u=(c=s.byteOffset)!=null?c:0,d,f=(d=e.byteOffset)!=null?d:0,h=r.getComponentType(n),_=r.getAccessorTypeSize(e.type),g=h.BYTES_PER_ELEMENT,y=_*g,v=e.count,p=o.byteStride,m;if(p!==void 0&&p!==y){var A=Math.floor(f/p),S=e.bufferView+":"+n+":"+A+":"+v,x=a.accessorBufferCache;if(m=x[S],!m){var b=u+A*p,C=v*(p/g),w=new h(s.buffer,b,C);x[S]=m=new Xp(w,!0,p),m.restoreInfo=new $p(new Jl(l,h,b,C))}}else{var E=u+f,T=v*_,M=new h(s.buffer,E,T);m=new Xp(M,!1,y),m.restoreInfo=new $p(new Jl(l,h,E,T))}return e.sparse?r.processingSparseData(a,e,m).then(function(){return m}):m})},r.bufferToVector3Array=function(a,t,e,n){for(var o=a.BYTES_PER_ELEMENT,s=e%t/o,l=t/o,c=new Array(n),u=0;u<n;u++){var d=s+u*l;c[u]=new P(a[d],a[d+1],a[d+2])}return c},r.getAccessorData=function(a,t,e){var n=a.bufferViews,o=n[t.bufferView],s=e[o.buffer],l=t.hasOwnProperty("byteOffset")?t.byteOffset:0,c=o.hasOwnProperty("byteOffset")?o.byteOffset:0,u=l+c,d=r.getAccessorTypeSize(t.type),f=d*t.count,h,_=(h=o.byteStride)!=null?h:0,g=r.getComponentType(t.componentType),y;if(_){var v=d*g.BYTES_PER_ELEMENT;y=new Uint8Array(t.count*v);for(var p=new Uint8Array(s,c,o.byteLength),m=0;m<t.count;m++)for(var A=0;A<v;A++)y[m*v+A]=p[m*_+l+A]}else y=new Uint8Array(s.slice(u,u+f*g.BYTES_PER_ELEMENT));var S=new g(y.buffer);if(t.sparse)for(var x=t.sparse,b=x.count,C=x.indices,w=x.values,E=n[C.bufferView],T=n[w.bufferView],M=e[E.buffer],B=e[T.buffer],I,F,L=((I=C.byteOffset)!=null?I:0)+((F=E.byteOffset)!=null?F:0),V=E.byteLength,D,N,O=((D=w.byteOffset)!=null?D:0)+((N=T.byteOffset)!=null?N:0),G=T.byteLength,Q=r.getComponentType(C.componentType),H=new Q(M,L,V/Q.BYTES_PER_ELEMENT),ee=new g(B,O,G/g.BYTES_PER_ELEMENT),ve=0;ve<b;ve++)for(var oe=H[ve],ne=0;ne<d;ne++)S[oe*d+ne]=ee[ve*d+ne];return S},r.getBufferViewData=function(a,t){var e=a.byteOffset,n=e===void 0?0:e,o=t[a.buffer];return o.slice(n,n+a.byteLength)},r.processingSparseData=function(a,t,e){var n=e.restoreInfo,o=a.glTF.bufferViews,s=r.getAccessorTypeSize(t.type),l=r.getComponentType(t.componentType),c=e.data.slice(),u=t.sparse,d=u.count,f=u.indices,h=u.values,_=o[f.bufferView],g=o[h.bufferView];return Promise.all([a.get(Ae.BufferView,f.bufferView),a.get(Ae.BufferView,h.bufferView)]).then(function(y){var v=y[0],p=y[1],m,A,S=((m=f.byteOffset)!=null?m:0)+((A=v.byteOffset)!=null?A:0),x=v.byteLength,b,C,w=((b=h.byteOffset)!=null?b:0)+((C=p.byteOffset)!=null?C:0),E=p.byteLength;n.typeSize=s,n.sparseCount=d;var T=r.getComponentType(f.componentType),M=x/T.BYTES_PER_ELEMENT,B=new T(v.buffer,S,M);n.sparseIndices=new Jl(_.buffer,T,S,M);var I=E/l.BYTES_PER_ELEMENT,F=new l(p.buffer,w,I);n.sparseValues=new Jl(g.buffer,l,w,I);for(var L=0;L<d;L++)for(var V=B[L],D=0;D<s;D++)c[V*s+D]=F[L*s+D];e.data=c})},r.getIndexFormat=function(a){switch(a){case bt.UNSIGNED_BYTE:return Wt.UInt8;case bt.UNSIGNED_SHORT:return Wt.UInt16;case bt.UNSIGNED_INT:return Wt.UInt32}},r.getElementFormat=function(a,t,e){if(e===void 0&&(e=!1),a==bt.FLOAT)switch(t){case 1:return ie.Float;case 2:return ie.Vector2;case 3:return ie.Vector3;case 4:return ie.Vector4}if(a==bt.SHORT)switch(t){case 2:return e?ie.NormalizedShort2:ie.Short2;case 3:case 4:return e?ie.NormalizedShort4:ie.Short4}if(a==bt.UNSIGNED_SHORT)switch(t){case 2:return e?ie.NormalizedUShort2:ie.UShort2;case 3:case 4:return e?ie.NormalizedUShort4:ie.UShort4}if(a==bt.BYTE)switch(t){case 2:case 3:case 4:return e?ie.NormalizedByte4:ie.Byte4}if(a==bt.UNSIGNED_BYTE)switch(t){case 2:case 3:case 4:return e?ie.NormalizedUByte4:ie.UByte4}},r.loadImageBuffer=function(a,t){return new Promise(function(e,n){var o=new window.Blob([a],{type:t}),s=new Image;s.onerror=function(){n(new Error("Failed to load image buffer"))},s.onload=function(){requestAnimationFrame(function(){e(s),s.onload=null,s.onerror=null,s.onabort=null})},s.crossOrigin="anonymous",s.src=URL.createObjectURL(o)})},r.parseGLB=function(a,t){var e=4,n=1179937895,o=12,s={JSON:1313821514,BIN:5130562},l=new DataView(t),c={magic:l.getUint32(0,!0),version:l.getUint32(e,!0),length:l.getUint32(2*e,!0)};if(c.magic!==n)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+c.magic.toString(16)),null;var u=l.getUint32(o,!0),d=l.getUint32(o+e,!0);if(d!==s.JSON)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+d.toString(16)),null;for(var f=new Uint8Array(t,o+2*e,u),h=JSON.parse(Ye.decodeText(f)),_=[],g=o+2*e+u,y=a.contentRestorer.glbBufferSlices;g<c.length;){if(u=l.getUint32(g,!0),d=l.getUint32(g+e,!0),d!==s.BIN)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+d.toString(16)),null;var v=g+2*e,p=t.slice(v,v+u);_.push(p),y.push(new te(v,u)),g+=u+2*e}return{glTF:h,buffers:_}},r.parseSampler=function(a,t){var e=t.filterMode,n=t.wrapModeU,o=t.wrapModeV;e!==void 0&&(a.filterMode=e),n!==void 0&&(a.wrapModeU=n),o!==void 0&&(a.wrapModeV=o)},r.getSamplerInfo=function(a){var t=a.minFilter,e=a.magFilter,n=a.wrapS,o=a.wrapT,s={};return(t||e)&&(s.mipmap=t>=au.NEAREST_MIPMAP_NEAREST,e===wf.NEAREST?s.filterMode=Xt.Point:t<=au.LINEAR_MIPMAP_NEAREST?s.filterMode=Xt.Bilinear:s.filterMode=Xt.Trilinear),n&&(s.wrapModeU=ou._wrapMap[n]),o&&(s.wrapModeV=ou._wrapMap[o]),s},r}(),Yp;(function(r){r[r.linear=1]="linear",r[r.sRGB=2]="sRGB"})(Yp||(Yp={}));var qp;(function(r){r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"})(qp||(qp={}));var Tf;(function(r){r[r.None=0]="None",r[r.BasisLZ=1]="BasisLZ",r[r.Zstd=2]="Zstd",r[r.ZLib=3]="ZLib"})(Tf||(Tf={}));var WC=function(){function r(a){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.keyValue={},this.globalData=null,this.parse(a)}var i=r.prototype;return i.parse=function(t){var e=t.buffer,n=t.byteOffset,o=new $a(t,12);this.vkFormat=o.nextUint32(),this.typeSize=o.nextUint32(),this.pixelWidth=o.nextUint32(),this.pixelHeight=o.nextUint32(),this.pixelDepth=o.nextUint32(),this.layerCount=o.nextUint32(),this.faceCount=o.nextUint32();var s=Math.max(1,o.nextUint32());this.supercompressionScheme=o.nextUint32();var l=o.nextUint32(),c=o.nextUint32(),u=o.nextUint32(),d=o.nextUint32(),f=o.nextUint64(),h=o.nextUint64(),_=new Array(s),g=s*3*8,y=new $a(t,o.offset,g);this.levels=_;for(var v=0;v<s;v++)_[v]={levelData:new Uint8Array(e,n+y.nextUint64(),y.nextUint64()),uncompressedByteLength:y.nextUint64()};var p=new $a(t,l,c),m={vendorId:p.skip(4).nextUint16(),descriptorType:p.nextUint16(),versionNumber:p.nextUint16(),descriptorBlockSize:p.nextUint16(),colorModel:p.nextUint8(),colorPrimaries:p.nextUint8(),transferFunction:p.nextUint8(),flags:p.nextUint8(),texelBlockDimension:[p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8()],bytesPlane:[p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8()],samples:[]};this.dataFormatDescriptor=m;for(var A=6,S=4,x=(m.descriptorBlockSize/4-A)/S,b=0;b<x;b++){var C={bitOffset:p.nextUint16(),bitLength:p.nextUint8(),channelType:p.nextUint8(),samplePosition:[p.nextUint8(),p.nextUint8(),p.nextUint8(),p.nextUint8()],sampleLower:-1/0,sampleUpper:1/0};C.channelType&64?(C.sampleLower=p.nextInt32(),C.sampleUpper=p.nextInt32()):(C.sampleLower=p.nextUint32(),C.sampleUpper=p.nextUint32()),m.samples[b]=C}for(var w=new $a(t,u,d,!0);w.position<d;){var E=w.nextUint32(),T=w.scan(E),M=Ye.decodeText(T),B=w.nextUint8Array(E-T.byteLength-1);this.keyValue[M]=M.match(/^ktx/i)?Ye.decodeText(B).replace(/^(.*)\x00$/,"$1"):B;var I=E%4?4-E%4:0;w.skip(I)}if(h<=0)return this;for(var F=new $a(t,f,h,!0),L=F.nextUint16(),V=F.nextUint16(),D=F.nextUint32(),N=F.nextUint32(),O=F.nextUint32(),G=F.nextUint32(),Q=new Array(s),H=0;H<s;H++)Q[H]={imageFlags:F.nextUint32(),rgbSliceByteOffset:F.nextUint32(),rgbSliceByteLength:F.nextUint32(),alphaSliceByteOffset:F.nextUint32(),alphaSliceByteLength:F.nextUint32()};var ee=f+F.position,ve=ee+D,oe=ve+N,ne=oe+O,Me=new Uint8Array(e,n+ee,D),He=new Uint8Array(e,n+ve,N),ot=new Uint8Array(e,n+oe,O),be=new Uint8Array(e,n+ne,G);this.globalData={endpointCount:L,selectorCount:V,imageDescs:Q,endpointsData:Me,selectorsData:He,tablesData:ot,extendedData:be}},Lu(r,[{key:"isSRGB",get:function(){return this.dataFormatDescriptor.transferFunction===2}},{key:"isUASTC",get:function(){return this.dataFormatDescriptor.colorModel===166}}]),r}(),ze;(function(r){r[r.ASTC=0]="ASTC",r[r.BC7=1]="BC7",r[r.BC1_BC3=2]="BC1_BC3",r[r.PVRTC=3]="PVRTC",r[r.ETC=4]="ETC",r[r.R8=5]="R8",r[r.R8G8=6]="R8G8",r[r.R8G8B8A8=7]="R8G8B8A8"})(ze||(ze={}));var QC=function(){function r(a,t){a===void 0&&(a=4),this.limitedCount=a,this._workerCreator=t,this._taskQueue=[],this._workerStatus=0,this._workerItems=new Array(a)}var i=r.prototype;return i.prepareWorker=function(){for(var t=this.limitedCount,e=new Array(t),n=0;n<t;n++)e.push(this._initWorker(n));return Promise.all(e)},i.postMessage=function(t){var e=this;return new Promise(function(n,o){var s=e._getIdleWorkerId();if(s!==-1){e._workerStatus|=1<<s;var l=e._workerItems,c;Promise.resolve((c=l[s])!=null?c:e._initWorker(s)).then(function(){var u=l[s];u.resolve=n,u.reject=o,u.worker.postMessage(t)}).catch(o)}else e._taskQueue.push({resolve:n,reject:o,message:t})})},i.destroy=function(){for(var t=this._workerItems,e=0,n=t.length;e<n;e++){var o=t[e];o.worker.terminate(),o.reject=null,o.resolve=null}t.length=0,this._taskQueue.length=0,this._workerStatus=0},i._initWorker=function(t){var e=this;return Promise.resolve(this._workerCreator()).then(function(n){return n.addEventListener("message",e._onMessage.bind(e,t)),e._workerItems[t]={worker:n,resolve:null,reject:null},n})},i._getIdleWorkerId=function(){for(var t=0,e=this.limitedCount;t<e;t++)if(!(this._workerStatus&1<<t))return t;return-1},i._onMessage=function(t,e){var n=e.data.error;n?this._workerItems[t].reject(n):this._workerItems[t].resolve(e.data),this._nextTask(t)},i._nextTask=function(t){if(this._taskQueue.length){var e=this._taskQueue.shift(),n=this._workerItems[t];n.resolve=e.resolve,n.reject=e.reject,n.worker.postMessage(e.message)}else this._workerStatus^=1<<t},r}(),Dm=function(){function r(a){this.workerLimitCount=a}var i=r.prototype;return i.init=function(){return this._initPromise||(this._initPromise=this._initTranscodeWorkerPool()),this._initPromise},i.destroy=function(){this._transcodeWorkerPool.destroy()},i._createTranscodePool=function(t,e){return this._transcodeWorkerPool=new QC(this.workerLimitCount,function(){return new Promise(function(n,o){var s=function(d){d.data.error?o(d.data.error):n(l)},l=new Worker(t),c={type:"init",transcoderWasm:e};l.addEventListener("message",s),l.postMessage(c)})}),this._transcodeWorkerPool.prepareWorker()},r}();function jC(){var r,i=function(t){return r||(r=new Promise(function(e,n){var o={wasmBinary:t,onRuntimeInitialized:function(){return e(o)},onAbort:n};self.BASIS(o)}).then(function(e){return e.initializeBasis(),e.KTX2File})),r};self.onmessage=function(t){var e=t.data;switch(e.type){case"init":i(e.transcoderWasm).then(function(){self.postMessage("init-completed")}).catch(function(n){return self.postMessage({error:n})});break;case"transcode":i().then(function(n){var o=Rf(e.buffer,e.format,n);o.type="transcoded",self.postMessage(o)}).catch(function(n){return self.postMessage({error:n})});break}}}var XC=function(){var i;return function(t){return i||(i=new Promise(function(e,n){var o={wasmBinary:t,onRuntimeInitialized:function(){return e(o)},onAbort:n};self.BASIS(o)}).then(function(e){return e.initializeBasis(),e.KTX2File})),i}},Kp=XC();function Rf(r,i,a){var t=function(B,I){switch(B){case 2:return I?3:2;case 4:return I?1:0;case 3:return I?9:8;case 7:return 13;case 0:return 10;case 1:return 7}},e=function(B){if(B.length===1)return B[0];for(var I=0,F=0;F<B.length;F++)I+=B[F].byteLength;for(var L=new Uint8Array(I),V=0,D=0;D<B.length;D++)L.set(B[D],V),V+=B[D].byteLength;return L},n=function(){l.close(),l.delete()},o;(function(M){M[M.ETC1=0]="ETC1",M[M.ETC2=1]="ETC2",M[M.BC1=2]="BC1",M[M.BC3=3]="BC3",M[M.BC4=4]="BC4",M[M.BC5=5]="BC5",M[M.BC7=7]="BC7",M[M.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",M[M.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",M[M.ASTC_4x4=10]="ASTC_4x4",M[M.RGBA8=13]="RGBA8"})(o||(o={}));var s;(function(M){M[M.ASTC=0]="ASTC",M[M.BC7=1]="BC7",M[M.BC1_BC3=2]="BC1_BC3",M[M.PVRTC=3]="PVRTC",M[M.ETC=4]="ETC",M[M.R8=5]="R8",M[M.RG8=6]="RG8",M[M.RGBA8=7]="RGBA8"})(s||(s={}));var l=new a(new Uint8Array(r));if(!l.isValid())throw n(),new Error("Invalid or unsupported .ktx2 file");if(!l.startTranscoding())throw n(),new Error("KTX2 startTranscoding failed");for(var c=l.getWidth(),u=l.getHeight(),d=l.getLayers()||1,f=l.getLevels(),h=l.getHasAlpha(),_=l.getFaces(),g=t(i,h),y=new Array(_),v=g===2||g===3||g===7,p=0;p<_;p++){for(var m=new Array(f),A=0;A<f;A++){for(var S=new Array(d),x=void 0,b=void 0,C=0;C<d;C++){var w=l.getImageLevelInfo(A,C,p);v&&A===0&&(c!==w.width||u!==w.height)?(c=x=w.width,u=b=w.height,console.warn("KTX2 transcode to BC will resize to width: "+c+", height: "+u+". You'd better use an image whose size if multiple of 4.")):(x=w.origWidth,b=w.origHeight);var E=new Uint8Array(l.getImageTranscodedSizeInBytes(A,C,0,g)),T=l.transcodeImage(E,A,C,p,g,0,-1,-1);if(!T)throw n(),new Error("transcodeImage failed.");S[C]=E}m[A]={data:e(S),width:x,height:b}}y[p]=m}return n(),{faces:y,width:c,height:u,hasAlpha:h,faceCount:_,format:g}}var YC=function(r){le(i,r);function i(t){return r.call(this,t)}var a=i.prototype;return a._initTranscodeWorkerPool=function(){var e=this;return Promise.all([fetch("https://mdn.alipayobjects.com/rms/afts/file/A*nG8SR6vCgXgAAAAAAAAAAAAAARQnAQ/basis_transcoder.js").then(function(n){return n.text()}),fetch("https://mdn.alipayobjects.com/rms/afts/file/A*qEUfQ7317KsAAAAAAAAAAAAAARQnAQ/basis_transcoder.wasm").then(function(n){return n.arrayBuffer()})]).then(function(n){var o=n[0],s=n[1];if(e.workerLimitCount===0)return new Promise(function(f,h){var _=document.createElement("script");_.src=URL.createObjectURL(new Blob([o],{type:"application/javascript"})),document.body.appendChild(_),_.onload=function(){Kp(s).then(function(){f(null)})},_.onerror=function(){h()}});var l=jC.toString(),c=l.substring(l.indexOf("{"),l.lastIndexOf("}")+1),u=`
        `+o+`
        `+Rf.toString()+`
        `+c+`
        `,d=URL.createObjectURL(new Blob([u],{type:"application/javascript"}));return e._createTranscodePool(d,s)})},a.transcode=function(e,n){return this.workerLimitCount===0?Kp().then(function(o){return Rf(e,n,o)}):this._transcodeWorkerPool.postMessage({buffer:e,format:n,type:"transcode"})},i}(Dm);function qC(){var r=function(s,l,c,u){var d=(c+3>>2)*(u+3>>2),f=d*16+65535>>16,h=s.memory,_=f+1-(h.buffer.byteLength>>16);_>0&&h.grow(_);var g=new Uint8Array(h.buffer,65536,d*16);return g.set(l),s.transcode(d)===0?g:null},i=function(s){return t=WebAssembly.instantiate(s,{env:{memory:new WebAssembly.Memory({initial:16})}}).then(function(l){return l.instance.exports}),t},a=function(s,l,c){var u=s.length,d=new Array(u),f=Promise.resolve();return l&&(n.init(),f=n._initPromise),f.then(function(){for(var h=0;h<u;h++){for(var _=s[h].length,g=new Array(_),y=0;y<_;y++){var v=s[h][y],p=v.buffer,m=v.levelHeight,A=v.levelWidth,S=v.uncompressedByteLength;l&&(p=n.decode(p.slice(),S));var x=p.byteLength/u,b=p.byteOffset,C=r(c,new Uint8Array(p.buffer,b+h*x,x),A,m);if(C)g[y]={data:C.slice(),width:A,height:m};else throw"buffer decoded error"}d[h]=g}return d})},t,e=function(){function o(){}var s=o.prototype;return s.init=function(){return this._initPromise||(this._initPromise=fetch(o.WasmModuleURL).then(function(c){if(c.ok)return c.arrayBuffer();throw new Error("Could not fetch the wasm component for the Zstandard decompression lib: "+c.status+" - "+c.statusText)}).then(function(c){return WebAssembly.instantiate(c,o.IMPORT_OBJECT)}).then(this._init)),this._initPromise},s._init=function(c){o.instance=c.instance,o.IMPORT_OBJECT.env.emscripten_notify_memory_growth()},s.decode=function(c,u){if(u===void 0&&(u=0),!o.instance)throw new Error("ZSTDDecoder: Await .init() before decoding.");var d=o.instance.exports,f=c.byteLength,h=d.malloc(f);o.heap.set(c,h),u=u||Number(d.ZSTD_findDecompressedSize(h,f));var _=d.malloc(u),g=d.ZSTD_decompress(_,u,h,f),y=o.heap.slice(_,_+g);return d.free(h),d.free(_),y},o}();(function(){e.IMPORT_OBJECT={env:{emscripten_notify_memory_growth:function(){e.heap=new Uint8Array(e.instance.exports.memory.buffer)}}}})(),function(){e.WasmModuleURL="https://mdn.alipayobjects.com/rms/afts/file/A*awNJR7KqIAEAAAAAAAAAAAAAARQnAQ/zstddec.wasm"}();var n=new e;self.onmessage=function(s){var l=s.data;switch(l.type){case"init":i(l.transcoderWasm).then(function(){self.postMessage("init-completed")}).catch(function(c){self.postMessage({error:c})});break;case"transcode":t.then(function(c){a(l.data,l.needZstd,c).then(function(u){self.postMessage(u)}).catch(function(u){return self.postMessage({error:u})})});break}}}var Pf=function(r){le(i,r);function i(t,e){var n;return n=r.call(this,t)||this,n.type=e,n}var a=i.prototype;return a._initTranscodeWorkerPool=function(){var e=this;return fetch(i.transcoderMap[this.type]).then(function(n){return n.arrayBuffer()}).then(function(n){var o=qC.toString(),s=URL.createObjectURL(new Blob([o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))],{type:"application/javascript"}));return e._createTranscodePool(s,n)})},a.transcode=function(e){for(var n=e.supercompressionScheme===Tf.Zstd,o=e.levels.length,s=e.faceCount,l={width:e.pixelWidth,height:e.pixelHeight,mipmaps:null},c={type:"transcode",format:0,needZstd:n,data:new Array(s)},u=c.data,d=0;d<s;d++){for(var f=new Array(o),h=0;h<o;h++){var _=e.levels[h],g=Math.floor(e.pixelWidth/(1<<h))||1,y=Math.floor(e.pixelHeight/(1<<h))||1,v=_.levelData.buffer,p=_.levelData.byteOffset,m=_.levelData.byteLength;f[h]={buffer:new Uint8Array(v,p,m),levelWidth:g,levelHeight:y,uncompressedByteLength:_.uncompressedByteLength}}u[d]=f}return this._transcodeWorkerPool.postMessage(c).then(function(A){return l.faces=A,l.hasAlpha=!0,l})},i}(Dm);(function(){var r;Pf.transcoderMap=(r={},r[ze.ASTC]="https://mdn.alipayobjects.com/rms/afts/file/A*0jiKRK6D1-kAAAAAAAAAAAAAARQnAQ/uastc_astc.wasm",r)})();var ns,kt=(ns=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.initialize=function(e,n){if(n.ktx2Loader){var o=n.ktx2Loader;return o.priorityFormats&&(kt._priorityFormats.etc1s=o.priorityFormats,kt._priorityFormats.uastc=o.priorityFormats),o.transcoder===1?kt._getKhronosTranscoder(o.workerCount).init():kt._getBinomialLLCTranscoder(o.workerCount).init()}},a.load=function(e,n){var o=this;return new Ne(function(s,l,c,u){o.request(e.url,{type:"arraybuffer"}).onProgress(c,u).then(function(d){return kt._parseBuffer(new Uint8Array(d),n.engine,e.params).then(function(f){var h=f.engine,_=f.result,g=f.targetFormat,y=f.params;return kt._createTextureByBuffer(h,_,g,y)})}).then(s).catch(l)})},i.release=function(){this._binomialLLCTranscoder&&this._binomialLLCTranscoder.destroy(),this._khronosTranscoder&&this._khronosTranscoder.destroy(),this._binomialLLCTranscoder=null,this._khronosTranscoder=null,this._isBinomialInit=!1},i._parseBuffer=function(e,n,o){var s,l=new WC(e),c,u=(c=(s=o)==null?void 0:s.priorityFormats)!=null?c:kt._priorityFormats[l.isUASTC?"uastc":"etc1s"],d=kt._decideTargetFormat(n,l,u),f;if(kt._isBinomialInit||!Pf.transcoderMap[d]||!l.isUASTC){var h=kt._getBinomialLLCTranscoder();f=h.init().then(function(){return h.transcode(e,d)})}else{var _=kt._getKhronosTranscoder();f=_.init().then(function(){return _.transcode(l)})}return f.then(function(g){return{engine:n,result:g,targetFormat:d,params:l.keyValue.GalaceanTextureParams}})},i._createTextureByBuffer=function(e,n,o,s){var l=n.width,c=n.height,u=n.faces,d=u.length,f=u[0],h=f.length>1,_=this._getEngineTextureFormat(o,n),g;if(d!==6){g=new vr(e,l,c,_,h);for(var y=0;y<f.length;y++){var v=f[y].data;g.setPixelBuffer(v,y)}}else{g=new Rr(e,c,_,h);for(var p=0;p<u.length;p++)for(var m=u[p],A=0;A<f.length;A++)g.setPixelBuffer(yn.PositiveX+p,m[A].data,A)}return s&&(g.wrapModeU=s[0],g.wrapModeV=s[1],g.filterMode=s[2],g.anisoLevel=s[3]),g},i._decideTargetFormat=function(e,n,o){var s=e._hardwareRenderer,l=this._detectSupportedFormat(s,o);return l===ze.PVRTC&&(!U.isPowerOf2(n.pixelWidth)||!U.isPowerOf2(n.pixelHeight)||n.pixelWidth!==n.pixelHeight)?(me.warn("PVRTC image need power of 2 and width===height, downgrade to RGBA8"),ze.R8G8B8A8):l===null?(me.warn("Can't support any compressed texture, downgrade to RGBA8"),ze.R8G8B8A8):l},i._detectSupportedFormat=function(e,n){for(var o=0;o<n.length;o++){var s=n[o],l=this._supportedMap[s];if(l){for(var c=0;c<l.length;c++)if(e.canIUse(l[c]))return s}else switch(n[o]){case ze.R8G8B8A8:return s;case ze.R8:case ze.R8G8:if(e.isWebGL2)return s}}return null},i._getBinomialLLCTranscoder=function(e){e===void 0&&(e=4),kt._isBinomialInit=!0;var n;return(n=this._binomialLLCTranscoder)!=null?n:this._binomialLLCTranscoder=new YC(e)},i._getKhronosTranscoder=function(e){e===void 0&&(e=4);var n;return(n=this._khronosTranscoder)!=null?n:this._khronosTranscoder=new Pf(e,ze.ASTC)},i._getEngineTextureFormat=function(e,n){var o=n.hasAlpha;switch(e){case ze.ASTC:return j.ASTC_4x4;case ze.ETC:return o?j.ETC2_RGBA8:j.ETC2_RGB;case ze.BC7:return j.BC7;case ze.BC1_BC3:return o?j.BC3:j.BC1;case ze.PVRTC:return o?j.PVRTC_RGBA4:j.PVRTC_RGB4;case ze.R8G8B8A8:return j.R8G8B8A8}},i}(Ve),function(){ns._isBinomialInit=!1}(),function(){ns._priorityFormats={etc1s:[ze.ETC,ze.BC7,ze.ASTC,ze.BC1_BC3,ze.PVRTC],uastc:[ze.ASTC,ze.BC7,ze.ETC,ze.BC1_BC3,ze.PVRTC]}}(),function(){var r;ns._supportedMap=(r={},r[ze.ASTC]=[J.astc],r[ze.ETC]=[J.etc],r[ze.BC7]=[J.bptc],r[ze.BC1_BC3]=[J.s3tc],r[ze.PVRTC]=[J.pvrtc,J.pvrtc_webkit],r)}(),ns);kt=fe([at(Re.KTX2,["ktx2"])],kt);var Jp;(function(r){r[r.BinomialLLC=0]="BinomialLLC",r[r.Khronos=1]="Khronos"})(Jp||(Jp={}));var KC=function(r){le(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t.bufferRequests=[],t.glbBufferSlices=[],t.bufferTextures=[],t.meshes=[],t}var a=i.prototype;return a.restoreContent=function(){var e=this;return new Ne(function(n,o){Promise.all(e.bufferRequests.map(function(s){return sa(s.url,s.config)})).then(function(s){if(e.isGLB){var l=e.glbBufferSlices,c=s[0],u=l.length;s.length=u;for(var d=0;d<u;d++){var f=l[d];s[d]=c.slice(f.x,f.x+f.y)}}Ne.all(e.bufferTextures.map(function(h){var _=h.bufferView,g=s[_.buffer],y,v=new Uint8Array(g,(y=_.byteOffset)!=null?y:0,_.byteLength),p=h.texture;return h.mimeType==="image/ktx2"?kt._parseBuffer(v,p.engine).then(function(m){for(var A=m.result,S=A.faces,x=S[0],b=0;b<x.length;b++)p.setPixelBuffer(x[b].data,b)}):je.loadImageBuffer(v,h.mimeType).then(function(m){p.setImageSource(m),p.generateMipmaps()})})).then(function(){for(var h=As(e.meshes),_;!(_=h()).done;){for(var g=_.value,y=g.mesh,v=As(g.vertexBuffers),p;!(p=v()).done;){var m=p.value,A=e._getBufferData(s,m.data);m.buffer.setData(A)}if(g.indexBuffer){var S=e._getBufferData(s,g.indexBuffer);y.setIndices(S)}for(var x=As(g.blendShapes),b;!(b=x()).done;){var C=b.value,w=C.blendShape.frames[0],E=C.position,T=e._getBufferData(s,E.buffer);if(w.deltaPositions=je.bufferToVector3Array(T,E.stride,E.byteOffset,E.count),C.normal){var M=C.normal,B=e._getBufferData(s,M.buffer);w.deltaNormals=je.bufferToVector3Array(B,M.stride,M.byteOffset,M.count)}if(C.tangent){var I=C.tangent,F=e._getBufferData(s,I.buffer);w.deltaTangents=je.bufferToVector3Array(F,I.stride,I.byteOffset,I.count)}}y.uploadData(!0)}n(e.resource)}).catch(o)}).catch(o)})},a._getBufferData=function(e,n){var o=n.main,s=e[o.bufferIndex],l=new o.TypedArray(s,o.byteOffset,o.length),c=n.sparseCount;if(c)for(var u=n.sparseIndices,d=e[u.bufferIndex],f=new u.TypedArray(d,u.byteOffset,u.length),h=n.sparseValues,_=e[h.bufferIndex],g=new h.TypedArray(_,h.byteOffset,h.length),y=n.typeSize,v=0;v<c;v++)for(var p=f[v],m=0;m<y;m++)l[p*y+m]=g[v*y+m];return l},i}(Ai),Lm=function(i,a){this.url=i,this.config=a},Im=function(i,a,t){this.texture=i,this.bufferView=a,this.mimeType=t},JC=function(){this.vertexBuffers=[],this.blendShapes=[]},Zp=function(i,a){this.buffer=i,this.data=a},$p=function(i,a,t,e,n){this.main=i,this.typeSize=a,this.sparseCount=t,this.sparseIndices=e,this.sparseValues=n},Jl=function(i,a,t,e){this.bufferIndex=i,this.TypedArray=a,this.byteOffset=t,this.length=e},ZC=function(i,a,t,e){this.blendShape=i,this.position=a,this.normal=t,this.tangent=e},_d=function(i,a,t,e){this.buffer=i,this.stride=a,this.byteOffset=t,this.count=e},tn=function(){function r(){}var i=r.prototype;return i.createAndParse=function(t,e,n){for(var o=arguments.length,s=new Array(o>3?o-3:0),l=3;l<o;l++)s[l-3]=arguments[l];throw"Not implemented."},i.additiveParse=function(t,e,n,o){for(var s=arguments.length,l=new Array(s>4?s-4:0),c=4;c<s;c++)l[c-4]=arguments[c];throw"Not implemented."},r}(),Kt;(function(r){r[r.CreateAndParse=0]="CreateAndParse",r[r.AdditiveParse=1]="AdditiveParse"})(Kt||(Kt={}));var Ue=function(){function r(){}return r.executeExtensionsCreateAndParse=function(a,t,e){a===void 0&&(a={});for(var n=arguments.length,o=new Array(n>3?n-3:0),s=3;s<n;s++)o[s-3]=arguments[s];for(var l=null,c=Object.keys(a),u=c.length-1;u>=0;--u){var d,f=c[u],h=a[f];if(l=(d=r)._createAndParse.apply(d,[].concat(f,t,h,e,o)),l)return l}},r.executeExtensionsAdditiveAndParse=function(a,t,e,n){for(var o=arguments.length,s=new Array(o>4?o-4:0),l=4;l<o;l++)s[l-4]=arguments[l];for(var c in a){var u,d=a[c];(u=r)._additiveParse.apply(u,[].concat(c,t,e,d,n,s))}},r.hasExtensionParser=function(a){var t;return!!((t=r._extensionParsers[a])!=null&&t.length)},r.getExtensionParser=function(a,t){var e,n=r._extensionParsers[a],o=(e=n)==null?void 0:e.length;if(o)for(var s=o-1;s>=0;--s){var l=n[s];if(l._mode===t)return l}},r._addExtensionParser=function(a,t){r._extensionParsers[a]||(r._extensionParsers[a]=[]),r._extensionParsers[a].push(t)},r._createAndParse=function(a,t,e,n){for(var o=arguments.length,s=new Array(o>4?o-4:0),l=4;l<o;l++)s[l-4]=arguments[l];var c=r.getExtensionParser(a,Kt.CreateAndParse);if(c){var u;return(u=c).createAndParse.apply(u,[].concat(t,e,n,s))}},r._additiveParse=function(a,t,e,n,o){for(var s=arguments.length,l=new Array(s>5?s-5:0),c=5;c<s;c++)l[c-5]=arguments[c];var u=r.getExtensionParser(a,Kt.AdditiveParse);if(u){var d;(d=u).additiveParse.apply(d,[].concat(t,e,n,o,l))}},r}();(function(){Ue._extensionParsers={}})();function rn(r,i){return function(a){var t=new a;t._mode=i,Ue._addExtensionParser(r,t)}}var ev=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var n=e.glTFResource,o=e.contentRestorer,s=n.url,l=o.bufferRequests,c={type:"arraybuffer"},u=this._isGLB(s);o.isGLB=u;var d=u?sa(s,c).onProgress(void 0,e._onTaskDetail).then(function(f){return l.push(new Lm(s,c)),je.parseGLB(e,f)}).then(function(f){var h=f.glTF,_=f.buffers;return e.buffers=_,h}):sa(s,{type:"json"}).onProgress(void 0,e._onTaskDetail);return d},a._isGLB=function(e){var n=e.lastIndexOf(".");return e.substring(n+1,n+4)==="glb"},i}(Ue);ev=fe([Gn(Ae.Schema)],ev);var Mf=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTF.animations[n],s=o.name,l=s===void 0?"AnimationClip"+n:s,c=Ue.executeExtensionsCreateAndParse(o.extensions,e,o)||Mf._parseStandardProperty(e,new Vh(l),o);return Promise.resolve(c).then(function(u){return Ue.executeExtensionsAdditiveAndParse(o.extensions,e,u,o),u})},i._parseStandardProperty=function(e,n,o){for(var s=function(m,A){var S=h[m],x=u[S.input],b=u[S.output],C=Promise.all([je.getAccessorBuffer(e,d,x),je.getAccessorBuffer(e,d,b)]).then(function(w){var E=w[0].data,T=w[1].data;if(b.normalized){for(var M=je.getNormalizedComponentScale(b.componentType),B=new Float32Array(T.length),I=0,F=T.length;I<F;I++)B[I]=T[I]*M;T=B}var L=T.length/E.length,V,D=(V=S.interpolation)!=null?V:ho.Linear,N;switch(D){case ho.CubicSpine:N=Gt.CubicSpine;break;case ho.Step:N=Gt.Step;break;case ho.Linear:N=Gt.Linear;break}E[E.length-1],_.push({type:b.type,interpolation:N,input:E,output:T,outputSize:L})});y.push(C)},l=this,c=e.glTF,u=c.accessors,d=c.bufferViews,f=o.channels,h=o.samplers,_=new Array,g=e.get(Ae.Entity),y=new Array,v=0,p=h.length;v<p;v++)s(v);return y.push(e.get(Ae.Scene)),Promise.all(y).then(function(){for(var m=0,A=f.length;m<A;m++){for(var S=f[m],x=S.target,b=g[x.node],C="",w=b;w.parent;)C=C===""?""+w.name:w.name+"/"+C,w=w.parent;if(e.glTFResource.sceneRoots.indexOf(w)!==-1){var E=void 0,T=void 0;switch(x.path){case En.TRANSLATION:E=ye,T="position";break;case En.ROTATION:E=ye,T="rotationQuaternion";break;case En.SCALE:E=ye,T="scale";break;case En.WEIGHTS:E=Jt,T="blendShapeWeights";break}var M=l._addCurve(x.path,S,_);if(x.path===En.WEIGHTS)for(var B=c.nodes[x.node].mesh,I=0,F=c.meshes[B].primitives.length;I<F;I++)n.addCurveBinding(C,E,I,T,M);else n.addCurveBinding(C,E,T,M)}}return n})},i._addCurve=function(e,n,o){var s=o[n.sampler],l=s.input,c=s.output,u=s.outputSize;switch(e){case En.TRANSLATION:case En.SCALE:{for(var d=new Js,f=d.interpolation=s.interpolation,h=0,_=0,g=l.length;_<g;_++){var y=new cr;y.time=l[_],f===Gt.CubicSpine?(y.inTangent=new P(c[h++],c[h++],c[h++]),y.value=new P(c[h++],c[h++],c[h++]),y.outTangent=new P(c[h++],c[h++],c[h++])):y.value=new P(c[h++],c[h++],c[h++]),d.addKey(y)}return d}case En.ROTATION:{for(var v=new zo,p=v.interpolation=s.interpolation,m=0,A=0,S=l.length;A<S;A++){var x=new cr;x.time=l[A],p===Gt.CubicSpine?(x.inTangent=new ue(c[m++],c[m++],c[m++],c[m++]),x.value=new xe(c[m++],c[m++],c[m++],c[m++]),x.outTangent=new ue(c[m++],c[m++],c[m++],c[m++])):x.value=new xe(c[m++],c[m++],c[m++],c[m++]),v.addKey(x)}return v}case En.WEIGHTS:{var b=new Ks;b.interpolation=s.interpolation;for(var C=0,w=0,E=l.length;w<E;w++){var T=new cr;T.time=l[w],b.interpolation===Gt.CubicSpine?(T.inTangent=Array.from(c.subarray(C,C+u)),C+=u,T.value=c.slice(C,C+u),C+=u,T.outTangent=Array.from(c.subarray(C,C+u)),C+=u):(T.value=c.slice(C,C+u),C+=u),b.addKey(T)}return b}}},i}(Ue);Mf=fe([Gn(Ae.Animation)],Mf);var tv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTF.buffers;return e.buffers?Promise.resolve(e.buffers[n]):this._parseSingleBuffer(e,o[n])},a._parseSingleBuffer=function(e,n){var o=e.glTFResource,s=e.contentRestorer,l=o.url,c=s.bufferRequests,u={type:"arraybuffer"},d=Ye.resolveAbsoluteUrl(l,n.uri);c.push(new Lm(d,u));var f=sa(d,u).onProgress(void 0,e._onTaskDetail);return e._addTaskCompletePromise(f),f},i}(Ue);tv=fe([Gn(Ae.Buffer)],tv);var rv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTFResource,s=e.glTF.nodes[n],l=o.engine,c=s.matrix,u=s.translation,d=s.rotation,f=s.scale,h=s.extensions,_=new hn(l,s.name||"_GLTF_ENTITY_"+n);_._markAsTemplate(o);var g=_.transform;if(c){var y=g.localMatrix;y.copyFromArray(c),g.localMatrix=y}else u&&g.setPosition(u[0],u[1],u[2]),d&&g.setRotationQuaternion(d[0],d[1],d[2],d[3]),f&&g.setScale(f[0],f[1],f[2]);var v=s.children;if(v)for(var p=0;p<v.length;p++){var m=v[p],A=e.get(Ae.Entity,m);_.addChild(A)}return Ue.executeExtensionsAdditiveAndParse(h,e,_,s),_},i}(Ue);rv=fe([Gn(Ae.Entity)],rv);var Ht=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTF.materials[n],s=e.glTFResource,l=s.engine,c=Ue.executeExtensionsCreateAndParse(o.extensions,e,o);return c||(c=new Zn(l),c.name=o.name,Ht._parseStandardProperty(e,c,o)),Promise.resolve(c).then(function(u){return u||(u=Ht._getDefaultMaterial(l)),Ue.executeExtensionsAdditiveAndParse(o.extensions,e,u,o),u._associationSuperResource(s),u})},i._getDefaultMaterial=function(e){var n;return(n=Ht)._defaultMaterial||(n._defaultMaterial=new ul(e))},i._checkOtherTextureTransform=function(e,n){var o;(o=e.extensions)!=null&&o.KHR_texture_transform&&me.warn(""+n+" texture always use the KHR_texture_transform of the base texture.")},i._parseStandardProperty=function(e,n,o){var s=o.pbrMetallicRoughness,l=o.normalTexture,c=o.occlusionTexture,u=o.emissiveTexture,d=o.emissiveFactor,f=o.alphaMode,h=o.alphaCutoff,_=o.doubleSided;if(s){var g=s.baseColorFactor,y=s.baseColorTexture,v=s.metallicFactor,p=s.roughnessFactor,m=s.metallicRoughnessTexture;g&&(n.baseColor=new K(K.linearToGammaSpace(g[0]),K.linearToGammaSpace(g[1]),K.linearToGammaSpace(g[2]),g[3])),y&&e.get(Ae.Texture,y.index).then(function(w){n.baseTexture=w,Ue.executeExtensionsAdditiveAndParse(y.extensions,e,n,y)}),n.constructor===Zn&&(n.metallic=v??1,n.roughness=p??1,m&&(Ht._checkOtherTextureTransform(m,"Roughness metallic"),e.get(Ae.Texture,m.index).then(function(w){n.roughnessMetallicTexture=w})))}if(n.constructor===Zn||n.constructor===Ya){if(u&&(Ht._checkOtherTextureTransform(u,"Emissive"),e.get(Ae.Texture,u.index).then(function(w){n.emissiveTexture=w})),d&&(n.emissiveColor=new K(K.linearToGammaSpace(d[0]),K.linearToGammaSpace(d[1]),K.linearToGammaSpace(d[2]))),l){var A=l.index,S=l.scale;Ht._checkOtherTextureTransform(l,"Normal"),e.get(Ae.Texture,A).then(function(w){n.normalTexture=w}),S!==void 0&&(n.normalTextureIntensity=S)}if(c){var x=c.index,b=c.strength,C=c.texCoord;Ht._checkOtherTextureTransform(c,"Occlusion"),e.get(Ae.Texture,x).then(function(w){n.occlusionTexture=w}),b!==void 0&&(n.occlusionTextureIntensity=b),C===na.UV1?n.occlusionTextureCoord=na.UV1:C>na.UV1&&me.warn("Occlusion texture uv coordinate must be UV0 or UV1.")}}switch(_?n.renderFace=vi.Double:n.renderFace=vi.Front,f){case xs.OPAQUE:n.isTransparent=!1;break;case xs.BLEND:n.isTransparent=!0;break;case xs.MASK:n.alphaCutoff=h??.5;break}},i}(Ue);Ht=fe([Gn(Ae.Material)],Ht);function Bf(r,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](r):r instanceof i}var pd,Cs=(pd=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){for(var o=function(_,g){var y=s.primitives[_];d[_]=new Promise(function(v){var p=Ue.executeExtensionsCreateAndParse(y.extensions,e,y,s);if(p)Bf(p,Nt)?(p._associationSuperResource(c),v(p)):p.then(function(S){S._associationSuperResource(c),v(S)});else{var m=new Nt(u,s.name||_+"");m._associationSuperResource(c);var A=new JC;A.mesh=m,e.contentRestorer.meshes.push(A),Cs._parseMeshFromGLTFPrimitive(e,m,A,s,y,l,function(S){return null},function(S,x){var b=y.targets[x],C=b[S];if(C){var w=l.accessors[C];return je.getAccessorBuffer(e,e.glTF.bufferViews,w)}else return null},function(){var S=l.accessors[y.indices];return e.get(Ae.Buffer).then(function(x){return je.getAccessorData(l,S,x)})},e.params.keepMeshData).then(v)}})},s=e.glTF.meshes[n],l=e.glTF,c=e.glTFResource,u=c.engine,d=new Array,f=0,h=s.primitives.length;f<h;f++)o(f);return Promise.all(d)},i._parseMeshFromGLTFPrimitive=function(e,n,o,s,l,c,u,d,f,h){var _=function(E){var T=g[y[E]],M=je.getAccessorBuffer(e,c.bufferViews,T).then(function(B){var I=je.getAccessorTypeSize(T.type),F=T.count,L=B.data,V,D=n.instanceId,N=B.vertexBindingInfos,O=T.normalized,G=je.getElementFormat(T.componentType,I,O),Q;O&&(Q=je.getNormalizedComponentScale(T.componentType));var H;if(B.interleaved){var ee=T.byteOffset||0,ve=B.stride;if(H=ee%ve,N[D]===void 0){V=new De(E,H,G,b);var oe=B.vertexBuffer;oe||(oe=new qr(A,mr.VertexBuffer,L,yt.Static,h),B.vertexBuffer=oe,o.vertexBuffers.push(new Zp(oe,B.restoreInfo))),n.setVertexBufferBinding(oe,ve,b),N[D]=b++}else V=new De(E,H,G,N[D])}else{H=0,V=new De(E,H,G,b);var ne=B.vertexBuffer;ne||(ne=new qr(A,mr.VertexBuffer,L,yt.Static,h),o.vertexBuffers.push(new Zp(ne,B.restoreInfo))),n.setVertexBufferBinding(ne,B.stride,b),N[D]=b++}if(S.push(V),E==="POSITION"){x=F;var Me=n.bounds,He=Me.min,ot=Me.max;if(T.min&&T.max)He.copyFromArray(T.min),ot.copyFromArray(T.max);else{var be=Cs._tempVector3;He.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ot.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var _t=H/L.BYTES_PER_ELEMENT,qe=L.length/F,st=0;st<F;st++){var ce=_t+st*qe;be.copyFromArray(L,ce),P.min(He,be,He),P.max(ot,be,ot)}}O&&(He.scale(Q),ot.scale(Q))}});C.push(M)},g=c.accessors,y=l.attributes,v=l.targets,p=l.indices,m=l.mode,A=n.engine,S=new Array,x,b=0,C=new Array;for(var w in y)_(w);return Promise.all(C).then(function(){if(n.setVertexElements(S),p!==void 0){var E=c.accessors[p],T=je.getAccessorBuffer(e,c.bufferViews,E).then(function(M){n.setIndices(M.data),n.addSubMesh(0,E.count,m),o.indexBuffer=M.restoreInfo});C.push(T)}else n.addSubMesh(0,x,m);return v&&C.push(Cs._createBlendShape(n,o,s,g,v,d)),Promise.all(C).then(function(){return n.uploadData(!h),Promise.resolve(n)})})},i._createBlendShape=function(e,n,o,s,l,c){for(var u=function(g,y){var v=d?d[g]:"blendShape"+g,p=Promise.all([c("POSITION",g),c("NORMAL",g),c("TANGENT",g)]).then(function(m){var A=m[0],S=m[1],x=m[2],b=l[g],C,w,E,T=null;if(A){C=s[b.POSITION];var M;T=je.bufferToVector3Array(A.data,A.stride,(M=C.byteOffset)!=null?M:0,C.count)}var B=null;if(S){w=s[b.NORMAL];var I;B=je.bufferToVector3Array(S.data,S.stride,(I=w.byteOffset)!=null?I:0,w.count)}var F=null;if(x){E=s[b.NORMAL];var L;F=je.bufferToVector3Array(x.data,x.stride,(L=E.byteOffset)!=null?L:0,E.count)}var V=new Lh(v);V.addFrame(1,T,B,F),e.addBlendShape(V);var D,N,O;n.blendShapes.push(new ZC(V,new _d(A.restoreInfo,A.stride,(D=C.byteOffset)!=null?D:0,C.count),S?new _d(S.restoreInfo,S.stride,(N=w.byteOffset)!=null?N:0,w.count):null,x?new _d(x.restoreInfo,x.stride,(O=E.byteOffset)!=null?O:0,E.count):null))});f.push(p)},d=o.extras?o.extras.targetNames:null,f=new Array,h=0,_=l.length;h<_;h++)u(h);return Promise.all(f)},i}(Ue),function(){pd._tempVector3=new P}(),pd);Cs=fe([Gn(Ae.Mesh)],Cs);var nv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTF,s=o.scenes,l=o.scene,c=l===void 0?0:l,u=e.glTFResource,d=s[n],f=d.extensions,h=u.engine,_=c===n,g=d.nodes,y;if(g.length===1)y=e.get(Ae.Entity,g[0]);else{y=new hn(h,"GLTF_ROOT");for(var v=0;v<g.length;v++){var p=e.get(Ae.Entity,g[v]);y.addChild(p)}}_&&(u._defaultSceneRoot=y);for(var m=new Array,A=0;A<g.length;A++)m.push(this._parseEntityComponent(e,g[A]));return Promise.all(m).then(function(){return Ue.executeExtensionsAdditiveAndParse(f,e,y,d),y})},a._parseEntityComponent=function(e,n){var o=this,s=e.glTF,l=e.glTFResource,c=s.nodes[n],u=c.camera,d=c.mesh,f=e.get(Ae.Entity,n),h;return u!==void 0&&this._createCamera(l,s.cameras[u],f),d!==void 0&&(h=this._createRenderer(e,c,f)),Promise.resolve(h).then(function(){var _=[],g=c.children;if(g)for(var y=0;y<g.length;y++)_.push(o._parseEntityComponent(e,g[y]));return Promise.all(_)})},a._createCamera=function(e,n,o){var s,l=n.orthographic,c=n.perspective,u=n.type,d=o.addComponent(rt);if(u===iu.ORTHOGRAPHIC){var f=l.xmag,h=l.ymag,_=l.zfar,g=l.znear;d.isOrthographic=!0,g!==void 0&&(d.nearClipPlane=g),_!==void 0&&(d.farClipPlane=_),d.orthographicSize=Math.max(h??0,f??0)/2}else if(u===iu.PERSPECTIVE){var y=c.aspectRatio,v=c.yfov,p=c.zfar,m=c.znear;y!==void 0&&(d.aspectRatio=y),v!==void 0&&(d.fieldOfView=v*180/Math.PI),p!==void 0&&(d.farClipPlane=p),m!==void 0&&(d.nearClipPlane=m)}(s=e).cameras||(s.cameras=[]),e.cameras.push(d),d.enabled=!1},a._createRenderer=function(e,n,o){for(var s=function(v){var p=h[v],m=p.material;g.push(Promise.all([e.get(Ae.Mesh,u),d!==void 0&&e.get(Ae.Skin,d),m!==void 0&&e.get(Ae.Material,m)]).then(function(A){var S=A[0],x=A[1],b=A[2],C=S[v],w;if(b||(b=Ht._getDefaultMaterial(e.glTFResource.engine)),x||_){var E=o.addComponent(Jt);E.mesh=C,x&&(E.rootBone=x._rootBone,E.bones=x._bones,l._computeLocalBounds(E,C,x._bones,x._rootBone,x.inverseBindMatrices),E.skin=x),_&&(E.blendShapeWeights=new Float32Array(_)),w=E}else w=o.addComponent(hr),w.mesh=C;w.setMaterial(b),C.vertexElements.forEach(function(T){T.semantic==="COLOR_0"&&(w.enableVertexColor=!0)}),Ue.executeExtensionsAdditiveAndParse(p.extensions,e,w,p)}))},l=this,c=e.glTF.meshes,u=n.mesh,d=n.skin,f=c[u],h=f.primitives,_=n.weights||f.weights,g=new Array,y=0;y<h.length;y++)s(y);return Promise.all(g)},a._computeLocalBounds=function(e,n,o,s,l){var c=o.indexOf(s);if(c!==-1)qt.transform(n.bounds,l[c],e.localBounds);else{var u=new $(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),d=this._computeApproximateBindMatrix(o,l,s,u);d!==0?($.multiplyScalar(u,1/d,u),qt.transform(n.bounds,u,e.localBounds)):e.localBounds.copyFrom(n.bounds)}},a._computeApproximateBindMatrix=function(e,n,o,s){for(var l=0,c=o.children,u=0,d=c.length;u<d;u++){var f=c[u],h=e.indexOf(f);h!==-1?($.add(s,n[h],s),l++):l+=this._computeApproximateBindMatrix(e,n,f,s)}return l},i}(Ue);nv=fe([Gn(Ae.Scene)],nv);var iv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=this,s=e.glTF,l=s.skins[n],c=l.inverseBindMatrices,u=l.skeleton,d=l.joints,f=l.name,h=f===void 0?"SKIN_"+n:f,_=d.length,g=new cm(h);g.inverseBindMatrices.length=_,g._bones.length=_;var y=s.accessors[c],v=je.getAccessorBuffer(e,s.bufferViews,y).then(function(p){for(var m=e.get(Ae.Entity),A=p.data,S=0;S<_;S++){var x=new $;x.copyFromArray(A,S*16),g.inverseBindMatrices[S]=x;var b=m[d[S]];if(g._bones[S]=b,g.joints[S]=b.name,u!==void 0){var C=m[u];g._rootBone=C,g.skeleton=C.name}else{var w=o._findSkeletonRootBone(d,m);if(w)g._rootBone=w,g.skeleton=w.name;else throw"Failed to find skeleton root bone."}}return g});return Promise.resolve(v)},a._findSkeletonRootBone=function(e,n){for(var o={},s=As(e),l;!(l=s()).done;){for(var c=l.value,u=new Array,d=n[c];d;)u.unshift(d),d=d.parent;o[c]=u}for(var f=null,h=0;;h++){var _=o[e[0]];if(h>=_.length)return f;for(var g=_[h],y=1,v=e.length;y<v;y++)if(_=o[e[y]],h>=_.length||g!==_[h])return f;f=g}},i}(Ue);iv=fe([Gn(Ae.Skin)],iv);var vd,ou=(vd=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTF.textures[n],s=e.glTFResource,l=e.glTF,c=s.engine,u=s.url,d=o.sampler,f=o.source,h=f===void 0?0:f,_=o.name,g=o.extensions,y=l.images[h],v=y.uri,p=y.bufferView,m=y.mimeType,A=y.name,S=Ue.executeExtensionsCreateAndParse(g,e,o);if(!S){var x=d!==void 0,b=d!==void 0&&je.getSamplerInfo(l.samplers[d]);if(v){var C,w=v.lastIndexOf("."),E=v.substring(w+1),T=E.startsWith("ktx")?Re.KTX:Re.Texture2D;S=c.resourceManager.load({url:Ye.resolveAbsoluteUrl(u,v),type:T,params:{mipmap:(C=b)==null?void 0:C.mipmap}}).onProgress(void 0,e._onTaskDetail).then(function(B){return B.name=_||A||B.name||"texture_"+n,x&&je.parseSampler(B,b),B}),e._addTaskCompletePromise(S)}else{var M=l.bufferViews[p];S=e.get(Ae.Buffer).then(function(B){var I=B[M.buffer],F=new Uint8Array(I,M.byteOffset,M.byteLength);return je.loadImageBuffer(F,m).then(function(L){var V,D=new vr(c,L.width,L.height,void 0,(V=b)==null?void 0:V.mipmap);D.setImageSource(L),D.generateMipmaps(),D.name=_||A||"texture_"+n,x&&je.parseSampler(D,b);var N=new Im(D,M,m);return e.contentRestorer.bufferTextures.push(N),D})})}}return Promise.resolve(S).then(function(B){return Ue.executeExtensionsAdditiveAndParse(g,e,B,o),B._associationSuperResource(s),B})},i}(Ue),function(){var r;vd._wrapMap=(r={},r[Ss.CLAMP_TO_EDGE]=rr.Clamp,r[Ss.MIRRORED_REPEAT]=rr.Mirror,r[Ss.REPEAT]=rr.Repeat,r)}(),vd);ou=fe([Gn(Ae.Texture)],ou);var av=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e){var n=e.glTF,o=n.asset.version,s=n.extensionsUsed,l=n.extensionsRequired,c=Number(o);if(!(c>=2&&c<3))throw"Only support glTF 2.x.";if(s){me.info("extensionsUsed: ",s);for(var u=0;u<s.length;u++){var d=s[u];Ue.hasExtensionParser(d)||me.warn("Extension "+d+" is not implemented, you can customize this extension in gltf.")}}if(l){me.info("extensionsRequired: "+l);for(var f=0;f<l.length;f++){var h=l[f];Ue.hasExtensionParser(h)||me.error("GLTF parser has not supported required extension "+h+".")}}return Promise.resolve(null)},i}(Ue);av=fe([Gn(Ae.Validator)],av);var ov=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.parse=function(e,n){var o=e.glTF.bufferViews[n],s=o.extensions,l=o.byteOffset,c=l===void 0?0:l,u=o.byteLength,d=o.buffer;return s?Ue.executeExtensionsCreateAndParse(s,e,o):e.get(Ae.Buffer,d).then(function(f){return new Uint8Array(f,c,u)})},i}(Ue);ov=fe([Gn(Ae.BufferView)],ov);var fc=function(){var r=function(v){for(var p=new Uint8Array(v.length),m=0;m<v.length;++m){var A=v.charCodeAt(m);p[m]=A>96?A-97:A>64?A-39:A+4}for(var S=0,x=0;x<v.length;++x)p[S++]=p[x]<60?l[p[x]]:(p[x]-60)*64+p[++x];return p.buffer.slice(0,S)},i=function(v,p,m,A,S,x){var b=u.exports.sbrk,C=m+3&-4,w=b(C*A),E=b(S.length),T=new Uint8Array(u.exports.memory.buffer);T.set(S,E);var M=v(w,m,A,E,S.length);if(M==0&&x&&x(w,C,A),p.set(T.subarray(w,w+m*A)),b(w-b(0)),M!=0)throw new Error("Malformed buffer data: "+M)},a=function(v){var p={object:new Worker(v),pending:0,requests:{}};return p.object.onmessage=function(m){var A=m.data;p.pending-=A.count,p.requests[A.id][A.action](A.value),delete p.requests[A.id]},p},t=function(v){for(var p="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(r(c))+"]), {}).then(function(result) {instance = result.instance; instance.exports.__wasm_call_ctors();});self.onmessage = workerProcess;"+i.toString()+n.toString(),m=new Blob([p],{type:"text/javascript"}),A=URL.createObjectURL(m),S=0;S<v;++S)_[S]=a(A);URL.revokeObjectURL(A)},e=function(v,p,m,A,S){for(var x=_[0],b=1;b<_.length;++b)_[b].pending<x.pending&&(x=_[b]);return new Promise(function(C,w){var E=new Uint8Array(m),T=g++;x.pending+=v,x.requests[T]={resolve:C,reject:w},x.object.postMessage({id:T,count:v,size:p,source:E,mode:A,filter:S},[E.buffer])})},n=function(v){d.then(function(){var p=v.data;try{var m=new Uint8Array(p.count*p.size);i(u.exports[p.mode],m,p.count,p.size,p.source,u.exports[p.filter]),self.postMessage({id:p.id,count:p.count,action:"resolve",value:m},[m.buffer])}catch(A){self.postMessage({id:p.id,count:p.count,action:"reject",value:A})}})},o="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",s="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",l=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]),c=Jn._detectSIMDSupported()?s:o,u,d=WebAssembly.instantiate(r(c),{}).then(function(y){u=y.instance,u.exports.__wasm_call_ctors()}),f={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},_=[],g=0;return{workerCount:4,ready:d,useWorkers:function(){t(this.workerCount)},decodeGltfBuffer:function(v,p,m,A,S){return this.workerCount>0&&_.length===0&&this.useWorkers(),_.length>0?e(v,p,m,h[A],f[S]):d.then(function(){var x=new Uint8Array(v*p);return i(u.exports[h[A]],x,v,p,m,u.exports[f[S]]),x})},release:function(){for(var v=0;v<_.length;v++)_[v].object.terminate()}}}(),sv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.initialize=function(e,n){var o,s=(o=n.glTF)==null?void 0:o.meshOpt;return s&&(fc.workerCount=s.workerCount,fc.useWorkers()),Promise.resolve()},a.load=function(e,n){var o=e.url,s=e.params,l=new UC(n.engine,o),c=new Qh(l,n,or({keepMeshData:!1},s));return new Ne(function(u,d,f,h){c._setTaskCompleteProgress=f,c._setTaskDetailProgress=h,c.parse().then(u).catch(d)})},i.release=function(){fc.release()},i}(Ve);sv=fe([at(Re.GLTF,["gltf","glb"])],sv);var ge,Za=Math.PI,bs=(ge=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){var c=n.engine;o.request(e.url,{type:"arraybuffer"}).then(function(u){for(var d=new Uint8Array(u),f=bs._parseHeader(d),h=f.width,_=f.height,g=f.dataPosition,y=bs._readPixels(d.subarray(g),h,_),v=_>>1,p=bs._convertToCubemap(y,h,_,v),m=new Rr(c,v),A=0;A<6;A++)m.setPixelBuffer(yn.PositiveX+A,p[A],0);m.generateMipmaps(),s(m)}).catch(l)})},i._convertToCubemap=function(e,n,o,s){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=n*o*4)throw"ConvertPanoramaToCubemap: input size is wrong";var l=this._createCubemapData(s,this._faceRight,e,n,o),c=this._createCubemapData(s,this._faceLeft,e,n,o),u=this._createCubemapData(s,this._faceUp,e,n,o),d=this._createCubemapData(s,this._faceBottom,e,n,o),f=this._createCubemapData(s,this._faceFront,e,n,o),h=this._createCubemapData(s,this._faceBack,e,n,o);return[l,c,u,d,f,h]},i._createCubemapData=function(e,n,o,s,l){for(var c=new Uint8ClampedArray(e*e*4),u=this._tempVector3.set(0,0,0).add(n[1]).subtract(n[0]).scale(1/e),d=this._temp2Vector3.set(0,0,0).add(n[3]).subtract(n[2]).scale(1/e),f=1/e,h=0,_=0;_<e;_++){for(var g=this._temp3Vector3.set(0,0,0).add(n[0]),y=this._temp4Vector3.set(0,0,0).add(n[2]),v=0;v<e;v++){var p=this._temp5Vector3.set(0,0,0).add(y).subtract(g).scale(h).add(g);p.normalize();var m=this._calcProjectionSpherical(p,o,s,l);this._RGBEToLinear(m),this._linearToRGBM(m,5);var A=_*e*4+v*4;c[A]=m.r,c[A+1]=m.g,c[A+2]=m.b,c[A+3]=m.a,g.add(u),y.add(d)}h+=f}return c},i._calcProjectionSpherical=function(e,n,o,s){for(var l=Math.atan2(e.z,e.x),c=Math.acos(e.y);l<-Za;)l+=2*Za;for(;l>Za;)l-=2*Za;var u=l/Za,d=c/Za;u=u*.5+.5;var f=Math.round(u*o);f<0?f=0:f>=o&&(f=o-1);var h=Math.round(d*s);h<0?h=0:h>=s&&(h=s-1);var _=s-h-1,g=_*o*4+f*4,y=n[g],v=n[g+1],p=n[g+2],m=n[g+3];return new K(y,v,p,m)},i._readStringLine=function(e,n){for(var o="",s="",l=n;l<e.length-n&&(s=String.fromCharCode(e[l]),s!=`
`);l++)o+=s;return o},i._parseHeader=function(e){var n=0,o=0,s=this._readStringLine(e,0);if(s[0]!="#"||s[1]!="?")throw"Bad HDR Format.";var l=!1,c=!1,u=0;do u+=s.length+1,s=this._readStringLine(e,u),s=="FORMAT=32-bit_rle_rgbe"?c=!0:s.length==0&&(l=!0);while(!l);if(!c)throw"HDR Bad header format, unsupported FORMAT";u+=s.length+1,s=this._readStringLine(e,u);var d=/^\-Y (.*) \+X (.*)$/g,f=d.exec(s);if(!f||f.length<3)throw"HDR Bad header format, no size";if(o=parseInt(f[2]),n=parseInt(f[1]),o<8||o>32767)throw"HDR Bad header format, unsupported size";return u+=s.length+1,{height:n,width:o,dataPosition:u}},i._readPixels=function(e,n,o){for(var s=n,l=e.byteLength,c=new Uint8Array(4*n*o),u=0,d=0,f=4*s,h=new Uint8Array(4),_=new Uint8Array(f),g=o;g>0&&d<l;){if(h[0]=e[d++],h[1]=e[d++],h[2]=e[d++],h[3]=e[d++],h[0]!=2||h[1]!=2||(h[2]<<8|h[3])!=s)throw"HDR Bad header format, wrong scan line width";for(var y=0,v=void 0;y<f&&d<l;){v=e[d++];var p=v>128;if(p&&(v-=128),v===0||y+v>f)throw"HDR Bad Format, bad scanline data (run)";if(p)for(var m=e[d++],A=0;A<v;A++)_[y++]=m;else _.set(e.subarray(d,d+v),y),y+=v,d+=v}for(var S=s,x=0;x<S;x++){var b=0;c[u]=_[x+b],b+=s,c[u+1]=_[x+b],b+=s,c[u+2]=_[x+b],b+=s,c[u+3]=_[x+b],u+=4}g--}return c},i._RGBEToLinear=function(e){var n=Math.pow(2,e.a-128)/255;e.r*=n,e.g*=n,e.b*=n,e.a=1},i._linearToRGBM=function(e,n){var o=Math.max(e.r,Math.max(e.g,e.b)),s=Math.min(o/n,1);s=Math.ceil(s*255);var l=65025/(s*n);e.r*=l,e.g*=l,e.b*=l,e.a*=s},i}(Ve),function(){ge._rightBottomBack=new P(1,-1,-1)}(),function(){ge._rightBottomFront=new P(1,-1,1)}(),function(){ge._rightUpBack=new P(1,1,-1)}(),function(){ge._rightUpFront=new P(1,1,1)}(),function(){ge._leftBottomBack=new P(-1,-1,-1)}(),function(){ge._leftBottomFront=new P(-1,-1,1)}(),function(){ge._leftUpBack=new P(-1,1,-1)}(),function(){ge._leftUpFront=new P(-1,1,1)}(),function(){ge._faceRight=[ge._rightBottomBack,ge._rightBottomFront,ge._rightUpBack,ge._rightUpFront]}(),function(){ge._faceLeft=[ge._leftBottomFront,ge._leftBottomBack,ge._leftUpFront,ge._leftUpBack]}(),function(){ge._faceUp=[ge._leftBottomFront,ge._rightBottomFront,ge._leftBottomBack,ge._rightBottomBack]}(),function(){ge._faceBottom=[ge._leftUpBack,ge._rightUpBack,ge._leftUpFront,ge._rightUpFront]}(),function(){ge._faceFront=[ge._leftBottomBack,ge._rightBottomBack,ge._leftUpBack,ge._rightUpBack]}(),function(){ge._faceBack=[ge._rightBottomFront,ge._leftBottomFront,ge._rightUpFront,ge._leftUpFront]}(),function(){ge._tempVector3=new P}(),function(){ge._temp2Vector3=new P}(),function(){ge._temp3Vector3=new P}(),function(){ge._temp4Vector3=new P}(),function(){ge._temp5Vector3=new P}(),ge);bs=fe([at(Re.HDR,["hdr"])],bs);var lv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e){return this.request(e.url,or({},e,{type:"json"}))},i}(Ve);lv=fe([at(Re.JSON,["json"],!1)],lv);var $C=12+13*4,eb=0;function tb(r,i){for(var a=[],t=$C+r.bytesOfKeyValueData,e=r.pixelWidth,n=r.pixelHeight,o=i?r.numberOfMipmapLevels:1,s=0;s<o;s++){var l=new Int32Array(r.buffer,t,1)[0];t+=4;for(var c=0;c<r.numberOfFaces;c++){var u=new Uint8Array(r.buffer,t,l);a.push({data:u,width:e,height:n}),t+=l,t+=3-(l+3)%4}e=Math.max(1,e*.5),n=Math.max(1,n*.5)}return a}function rb(r){if(r.byteLength>=12){var i=new Uint8Array(r,0,12);if(i[0]===171&&i[1]===75&&i[2]===84&&i[3]===88&&i[4]===32&&i[5]===49&&i[6]===49&&i[7]===187&&i[8]===13&&i[9]===10&&i[10]===26&&i[11]===10)return!0}return!1}function nb(r){switch(r){case de.RGB_S3TC_DXT1_EXT:return j.BC1;case de.RGBA_S3TC_DXT5_EXT:return j.BC3;case de.RGBA_BPTC_UNORM_EXT:return j.BC7;case de.RGB_ETC1_WEBGL:return j.ETC1_RGB;case de.RGB8_ETC2:return j.ETC2_RGB;case de.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return j.ETC2_RGBA5;case de.RGBA8_ETC2_EAC:return j.ETC2_RGBA8;case de.RGB_PVRTC_2BPPV1_IMG:return j.PVRTC_RGB2;case de.RGBA_PVRTC_2BPPV1_IMG:return j.PVRTC_RGBA2;case de.RGB_PVRTC_4BPPV1_IMG:return j.PVRTC_RGB4;case de.RGBA_PVRTC_4BPPV1_IMG:return j.PVRTC_RGBA4;case de.RGBA_ASTC_4X4_KHR:return j.ASTC_4x4;case de.RGBA_ASTC_5X5_KHR:return j.ASTC_5x5;case de.RGBA_ASTC_6X6_KHR:return j.ASTC_6x6;case de.RGBA_ASTC_8X8_KHR:return j.ASTC_8x8;case de.RGBA_ASTC_10X10_KHR:return j.ASTC_10x10;case de.RGBA_ASTC_12X12_KHR:return j.ASTC_12x12;default:var i=de[r];throw new Error("this format is not supported in Galacean Engine: "+i)}}var Fm={parse:function(i,a,t,e){if(e===void 0&&(e=!1),!rb(i))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var n=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(i,12,13*n),s=o.getUint32(0,!0),l=s===67305985,c={buffer:i,glType:o.getUint32(1*n,l),glTypeSize:o.getUint32(2*n,l),glFormat:o.getUint32(3*n,l),glInternalFormat:o.getUint32(4*n,l),glBaseInternalFormat:o.getUint32(5*n,l),pixelWidth:o.getUint32(6*n,l),pixelHeight:o.getUint32(7*n,l),pixelDepth:o.getUint32(8*n,l),numberOfArrayElements:o.getUint32(9*n,l),numberOfFaces:o.getUint32(10*n,l),numberOfMipmapLevels:o.getUint32(11*n,l),bytesOfKeyValueData:o.getUint32(12*n,l),loadType:eb};if(c.glType!==0)throw new Error("only compressed formats currently supported");if(c.numberOfMipmapLevels=Math.max(1,c.numberOfMipmapLevels),c.pixelHeight===0||c.pixelDepth!==0)throw new Error("only 2D textures currently supported");if(c.numberOfArrayElements!==0)throw new Error("texture arrays not currently supported");if(c.numberOfFaces!==a)throw new Error("number of faces expected"+a+", but found "+c.numberOfFaces);return t&&(c.mipmaps=tb(c,!0)),e&&(c.engineFormat=nb(c.glInternalFormat)),c}};function ib(r){var i=Fm.parse(r,1,!0,!0);return{mipmaps:i.mipmaps,engineFormat:i.engineFormat,internalFormat:i.glInternalFormat,width:i.pixelWidth,height:i.pixelHeight}}function ab(r){for(var i=[],a,t,e,n,o=0;o<r.length;o++){var s=Fm.parse(r[o],1,!0,!0);i.push(s.mipmaps),o===0&&(e=s.pixelWidth,n=s.pixelHeight,a=s.glInternalFormat,t=s.engineFormat)}return{mipmapsFaces:i,engineFormat:t,internalFormat:a,width:e,height:n}}var cv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){Promise.all(e.urls.map(function(c){return o.request(c,or({},e,{type:"arraybuffer"}))})).then(function(c){for(var u=ab(c),d=u.width,f=u.mipmapsFaces,h=u.engineFormat,_=f[0].length>1,g=new Rr(n.engine,d,h,_),y=0;y<6;y++)for(var v=f[y].length,p=0;p<v;p++){var m=f[y][p],A=m.data,S=m.width,x=m.height;g.setPixelBuffer(yn.PositiveX+y,A,p,0,0,S,x)}s(g)}).catch(function(c){l(c)})})},i}(Ve);cv=fe([at(Re.KTXCube,[])],cv);var uv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,or({},e,{type:"arraybuffer"})).then(function(c){for(var u=ib(c),d=u.width,f=u.height,h=u.mipmaps,_=u.engineFormat,g=h.length>1,y=new vr(n.engine,d,f,_,g),v=0;v<h.length;v++){var p=h[v],m=p.width,A=p.height,S=p.data;y.setPixelBuffer(S,v,0,0,m,A)}s(y)}).catch(function(c){l(c)})})},i}(Ve);uv=fe([at(Re.KTX,["ktx"])],uv);function Nm(r,i,a){if(typeof a=="object")for(var t in a)Nm(r[i],t,a[t]);else r[i]=a}var dv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,or({},e,{type:"json"})).then(function(c){var u=function(E){var T=_[E],M=T.type,B=T.value;switch(M){case"Vector2":m.setVector2(E,new te(B.x,B.y));break;case"Vector3":m.setVector3(E,new P(B.x,B.y,B.z));break;case"Vector4":m.setVector4(E,new ue(B.x,B.y,B.z,B.w));break;case"Color":m.setColor(E,new K(B.r,B.g,B.b,B.a));break;case"Float":m.setFloat(E,B);break;case"Texture":p.push(n.getResourceByRef(B).then(function(I){m.setTexture(E,I)}));break;case"Boolean":m.setInt(E,B?1:0);break;case"Integer":m.setInt(E,Number(B));break}},d=n.engine,f=c.name,h=c.shader,_=c.shaderData,g=c.macros,y=c.renderState,v=new In(d,Le.find(h));v.name=f;var p=new Array,m=v.shaderData;for(var A in _)u(A);for(var S=0,x=g.length;S<x;S++){var b=g[S],C=b.name,w=b.value;w==null?m.enableMacro(C):m.enableMacro(C,w)}return Nm(v,"renderState",y),Promise.all(p).then(function(){s(v)})}).catch(l)})},i}(Ve);dv=fe([at(Re.Material,["json"])],dv);var fv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){o.request(e.url,or({},e,{type:"arraybuffer"})).then(function(c){return Iu(c,n.engine)}).then(function(c){s(c)}).catch(l)})},i}(Ve);fv=fe([at(Re.Mesh,["mesh"])],fv);var hv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=n.engine;return this.request(e.url,or({},e,{type:"json"})).then(function(s){switch(s.type){case"sphere":return ut.createSubdivisionSurfaceSphere(o,s.sphereRadius,s.sphereStep);case"capsule":return ut.createCapsule(o,s.capsuleRadius,s.capsuleHeight,s.capsuleRadialSegments,s.capsuleHeightSegments);case"cone":return ut.createCone(o,s.coneRadius,s.coneHeight,s.coneRadialSegment,s.coneHeightSegment);case"cuboid":return ut.createCuboid(o,s.cuboidWidth,s.cuboidHeight,s.cuboidDepth);case"cylinder":return ut.createCylinder(o,s.cylinderRadiusTop,s.cylinderRadiusBottom,s.cylinderHeight,s.cylinderRadialSegment,s.cylinderHeightSegment);case"plane":return ut.createPlane(o,s.planeWidth,s.planeHeight,s.planeHorizontalSegments,s.planeVerticalSegments);case"torus":return ut.createTorus(o,s.torusRadius,s.torusTubeRadius,s.torusRadialSegments,s.torusTubularSegments,s.torusArc)}})},i}(Ve);hv=fe([at(Re.PrimitiveMesh,["mesh"],!1)],hv);var _v;(function(r){r.Sphere="sphere",r.Cuboid="cuboid",r.Plane="plane",r.Cylinder="cylinder",r.Torus="torus",r.Cone="cone",r.Capsule="capsule"})(_v||(_v={}));var pv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this,s=n.engine;return new Ne(function(l,c){o.request(e.url,{type:"json"}).then(function(u){return s.resourceManager.initVirtualResources(u.files),n.load({type:Re.Scene,url:u.scene}).then(function(d){s.sceneManager.activeScene=d,l()})}).catch(c)})},i}(Ve);pv=fe([at(Re.Project,["proj"],!1)],pv);var vv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){var c=e.url;o._registerFont(c,c).then(function(){var u=new No(n.engine,c);s(u)}).catch(function(u){l("load font "+c+" fail")})})},a._registerFont=function(e,n){return Fu(function(){var o;return Du(this,function(s){switch(s.label){case 0:return o=new FontFace(e,"url("+n+")"),[4,o.load()];case 1:return s.sent(),document.fonts.add(o),[2]}})})()},i}(Ve);vv=fe([at(Re.SourceFont,["ttf","otf","woff"],!1)],vv);var gv=function(r){le(i,r);function i(){var t;return t=r.apply(this,arguments)||this,t._tempRect=new Mn,t._tempVec2=new te,t._tempVec4=new ue,t}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l,c,u,d){var f=[];d(function(){for(var _=0;_<f.length;_++)f[_].cancel()});var h=o.request(e.url,or({},e,{type:"json"}));f.push(h),h.then(function(_){var g=function(T){var M=y[T];if(M.img){var B;f.push(n.load({url:Ye.resolveAbsoluteUrl(e.url,M.img),type:(B=M.type)!=null?B:Re.Texture2D,params:{format:x,mipmap:v}}).then(function(F){p&&(F.anisoLevel=p),m!==void 0&&(F.filterMode=m),A!==void 0&&(F.wrapModeU=A),S!==void 0&&(F.wrapModeV=S);for(var L=0;L<M.sprites.length;L++)w._addSprite(o._makeSprite(C,M.sprites[L],F))}).catch(l))}else for(var I=0;I<M.sprites.length;I++)w._addSprite(o._makeSprite(C,M.sprites[I]))},y=_.atlasItems,v=_.mipmap,p=_.anisoLevel,m=_.filterMode,A=_.wrapModeU,S=_.wrapModeV,x=_.format,b=y?y.length:0,C=n.engine,w=new tm(C);if(b<0){s(w);return}f.length=0;for(var E=0;E<y.length;E++)g(E);Ne.all(f).then(function(){s(w)}).catch(l)}).catch(l)})},a._makeSprite=function(e,n,o){var s=n.region,l=n.atlasRegionOffset,c=n.atlasRegion,u=n.pivot,d=n.border,f=n.width,h=n.height,_=new Rn(e,o,s?this._tempRect.set(s.x,s.y,s.w,s.h):void 0,u?this._tempVec2.set(u.x,u.y):void 0,d?this._tempVec4.set(d.x,d.y,d.z,d.w):void 0,n.name);if(o){var g=1/o.width,y=1/o.height;if(_.atlasRegion.set(c.x*g,c.y*y,c.w*g,c.h*y),l){var v=l.x,p=l.y,m=l.z,A=l.w;_.atlasRegionOffset.set(v*g,p*y,m*g,A*y)}n.atlasRotated&&(_.atlasRotated=!0)}return isNaN(f)||(_.width=f),isNaN(h)||(_.height=h),_},i}(Ve);gv=fe([at(Re.SpriteAtlas,["atlas"],!1)],gv);var mv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return this.request(e.url,or({},e,{type:"json"})).then(function(s){return s.belongToAtlas?o._loadFromAtlas(n,s):o._loadFromTexture(n,s)})},a._loadFromAtlas=function(e,n){var o=this;return e.getResourceByRef(n.belongToAtlas).then(function(s){return s.getSprite(n.fullPath)||o._loadFromTexture(e,n)})},a._loadFromTexture=function(e,n){return n.texture?e.getResourceByRef(n.texture).then(function(o){var s=new Rn(e.engine,o,n.region,n.pivot,n.border),l=n.width,c=n.height;return isNaN(l)||(s.width=l),isNaN(c)||(s.height=c),s}):new Ne(function(o){var s=new Rn(e.engine,null,n.region,n.pivot,n.border),l=n.width,c=n.height;isNaN(l)||(s.width=l),isNaN(c)||(s.height=c),o(s)})},i}(Ve);mv=fe([at(Re.Sprite,["sprite"],!1)],mv);var ob=function(r){le(i,r);function i(t,e,n){var o;return o=r.call(this,t)||this,o.url=e,o.requestConfig=n,o}var a=i.prototype;return a.restoreContent=function(){var e=this;return sa(this.url,this.requestConfig).then(function(n){var o=e.resource;return o.setImageSource(n),o.generateMipmaps(),o})},i}(Ai),yv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l,c,u){var d=e.url,f=or({},e,{type:"image"});o.request(d,f).onProgress(c,u).then(function(h){var _,g=(_=e.params)!=null?_:{},y=g.format,v=g.mipmap,p=g.anisoLevel,m=g.wrapModeU,A=g.wrapModeV,S=g.filterMode,x=new vr(n.engine,h.width,h.height,y,v);if(x.anisoLevel=p??x.anisoLevel,x.filterMode=S??x.filterMode,x.wrapModeU=m??x.wrapModeU,x.wrapModeV=A??x.wrapModeV,x.setImageSource(h),x.generateMipmaps(),d.indexOf("data:")!==0){var b=d.lastIndexOf("/");x.name=d.substring(b+1)}n.addContentRestorer(new ob(x,d,f)),s(x)}).catch(function(h){l(h)})})},i}(Ve);yv=fe([at(Re.Texture2D,["png","jpg","webp","jpeg"])],yv);var sb=function(r){le(i,r);function i(t,e,n){var o;return o=r.call(this,t)||this,o.urls=e,o.requestConfig=n,o}var a=i.prototype;return a.restoreContent=function(){var e=this;return new Ne(function(n,o){Promise.all(e.urls.map(function(s){return sa(s,e.requestConfig)})).then(function(s){for(var l=e.resource,c=0;c<6;c++)l.setImageSource(yn.PositiveX+c,s[c],0);l.generateMipmaps(),n(l)}).catch(function(s){o(s)})})},i}(Ai),Av=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this;return new Ne(function(s,l){var c=e.urls,u=or({},e,{type:"image"});Promise.all(c.map(function(d){return o.request(d,u)})).then(function(d){var f=d[0],h=f.width,_=f.height;if(h!==_){console.error("The cube texture must have the same width and height");return}for(var g=new Rr(n.engine,h),y=0;y<6;y++)g.setImageSource(yn.PositiveX+y,d[y],0);g.generateMipmaps(),n.addContentRestorer(new sb(g,c,u)),s(g)}).catch(function(d){l(d)})})},i}(Ve);Av=fe([at(Re.TextureCube,[""])],Av);var xv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.load=function(e,n){var o=this,s=n.engine;return new Ne(function(l,c){o.request(e.url,{type:"json"}).then(function(u){return zC.parse(s,u).then(function(d){var f=[],h=u.scene.ambient;if(h){var _=h.specularMode==="Custom",g=h.diffuseMode===Ha.SphericalHarmonics;d.ambientLight.diffuseIntensity=h.diffuseIntensity,d.ambientLight.specularIntensity=h.specularIntensity,d.ambientLight.diffuseMode=h.diffuseMode,d.ambientLight.diffuseSolidColor.copyFrom(h.diffuseSolidColor),d.ambientLight.specularTextureDecodeRGBM=!0,_&&h.customAmbientLight&&f.push(n.getResourceByRef(h.customAmbientLight).then(function(x){var b;d.ambientLight.specularTexture=(b=x)==null?void 0:b.specularTexture})),h.ambientLight&&(!_||g)&&f.push(n.getResourceByRef(h.ambientLight).then(function(x){if(!_){var b;d.ambientLight.specularTexture=(b=x)==null?void 0:b.specularTexture}if(g){var C;d.ambientLight.diffuseSphericalHarmonics=(C=x)==null?void 0:C.diffuseSphericalHarmonics}}))}var y=u.scene.background;switch(d.background.mode=y.mode,d.background.mode){case Si.SolidColor:d.background.solidColor.copyFrom(y.color);break;case Si.Sky:if(y.skyMesh&&y.skyMaterial){var v=n.getResourceByRef(y.skyMesh).then(function(x){d.background.sky.mesh=x}),p=n.getResourceByRef(y.skyMaterial).then(function(x){d.background.sky.material=x});f.push(v,p)}else me.warn("Sky background mode requires skyMesh and skyMaterial");break;case Si.Texture:if(y.texture){var m=n.getResourceByRef(y.texture).then(function(x){d.background.texture=x});f.push(m)}break}var A=u.scene.shadow;if(A){A.castShadows!=null&&(d.castShadows=A.castShadows),A.shadowResolution!=null&&(d.shadowResolution=A.shadowResolution),A.shadowDistance!=null&&(d.shadowDistance=A.shadowDistance),A.shadowCascades!=null&&(d.shadowCascades=A.shadowCascades);var S;d.shadowTwoCascadeSplits=(S=A.shadowTwoCascadeSplits)!=null?S:d.shadowTwoCascadeSplits,A.shadowFourCascadeSplits&&d.shadowFourCascadeSplits.copyFrom(A.shadowFourCascadeSplits)}return Promise.all(f).then(function(){l(d)})})}).catch(c)})},i}(Ve);xv=fe([at(Re.Scene,["scene"],!0)],xv);Wh.registerCustomParseComponent("TextRenderer",Fu(function(r,i){var a;return Du(this,function(t){return a=i.props,a.font||(r.font=No.createFromOS(r.engine,a.fontFamily||"Arial")),[2,r]})}));var Sv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){var s,l=e.glTF.extensions.KHR_lights_punctual.lights,c=l[o.light],u=c.color,d=c.intensity,f=d===void 0?1:d,h=c.type,_=c.range,g=c.spot,y=e.glTFResource,v;if(h==="directional"?v=n.addComponent(Wa):h==="point"?v=n.addComponent(Xa):h==="spot"&&(v=n.addComponent(kn)),u&&v.color.set(u[0],u[1],u[2],1),v.intensity=f,_&&!Bf(v,Wa)&&(v.distance=_),g&&Bf(v,kn)){var p=g.innerConeAngle,m=p===void 0?0:p,A=g.outerConeAngle,S=A===void 0?Math.PI/4:A;v.angle=m,v.penumbra=S-m}(s=y).lights||(s.lights=[]),y.lights.push(v)},i}(tn);Sv=fe([rn("KHR_lights_punctual",Kt.AdditiveParse)],Sv);var Cv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){var s=o.clearcoatFactor,l=s===void 0?0:s,c=o.clearcoatTexture,u=o.clearcoatRoughnessFactor,d=u===void 0?0:u,f=o.clearcoatRoughnessTexture,h=o.clearcoatNormalTexture;n.clearCoat=l,n.clearCoatRoughness=d,c&&(Ht._checkOtherTextureTransform(c,"Clear coat"),e.get(Ae.Texture,c.index).then(function(_){n.clearCoatTexture=_})),f&&(Ht._checkOtherTextureTransform(f,"Clear coat roughness"),e.get(Ae.Texture,f.index).then(function(_){n.clearCoatRoughnessTexture=_})),h&&(Ht._checkOtherTextureTransform(h,"Clear coat normal"),e.get(Ae.Texture,h.index).then(function(_){n.clearCoatNormalTexture=_}))},i}(tn);Cv=fe([rn("KHR_materials_clearcoat",Kt.AdditiveParse)],Cv);var bv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){var s=o.ior,l=s===void 0?1.5:s;n.ior=l},i}(tn);bv=fe([rn("KHR_materials_ior",Kt.AdditiveParse)],bv);var Ev=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,n,o){var s=e.glTFResource.engine,l=new Ya(s),c=n.diffuseFactor,u=n.diffuseTexture,d=n.specularFactor,f=n.glossinessFactor,h=n.specularGlossinessTexture;return c&&(l.baseColor=new K(K.linearToGammaSpace(c[0]),K.linearToGammaSpace(c[1]),K.linearToGammaSpace(c[2]),c[3])),u&&e.get(Ae.Texture,u.index).then(function(_){l.baseTexture=_,Ue.executeExtensionsAdditiveAndParse(u.extensions,e,l,u)}),d&&(l.specularColor=new K(K.linearToGammaSpace(d[0]),K.linearToGammaSpace(d[1]),K.linearToGammaSpace(d[2]))),f!==void 0&&(l.glossiness=f),h&&(Ht._checkOtherTextureTransform(h,"Specular glossiness"),e.get(Ae.Texture,h.index).then(function(_){l.specularGlossinessTexture=_})),l.name=o.name,Ht._parseStandardProperty(e,l,o),l},i}(tn);Ev=fe([rn("KHR_materials_pbrSpecularGlossiness",Kt.CreateAndParse)],Ev);var wv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,n,o){var s=e.glTFResource.engine,l=new Qc(s);return l.name=o.name,Ht._parseStandardProperty(e,l,o),l},i}(tn);wv=fe([rn("KHR_materials_unlit",Kt.CreateAndParse)],wv);var Tv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){var s=function(v){var p=_[v],m=p.material,A=p.variants;e.get(Ae.Material,m).then(function(S){g.push({renderer:n,material:S,variants:A.map(function(x){return f[x].name})})})},l,c=e.glTF,u=c.extensions,d=u.KHR_materials_variants,f=d.variants,h=e.glTFResource,_=o.mappings;(l=h)._extensionsData||(l._extensionsData={});var g=[];h.extensionsData.variants=g;for(var y=0;y<_.length;y++)s(y)},i}(tn);Tv=fe([rn("KHR_materials_variants",Kt.AdditiveParse)],Tv);var Rv=function(r){le(i,r);function i(){return r.apply(this,arguments)}return i}(tn);Rv=fe([rn("KHR_mesh_quantization",Kt.AdditiveParse)],Rv);var Pv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,n,o){return Fu(function(){var s,l,c,u,d,f,h,_,g,y,v,p,m,A,S,x;return Du(this,function(b){return s=e.glTF,l=e.glTFResource,c=l.engine,u=l.url,d=o.sampler,f=o.name,h=n.source,_=s.images[h],g=_.uri,y=_.bufferView,v=_.mimeType,p=_.name,m=d!==void 0&&je.getSamplerInfo(s.samplers[d]),g?(A=g.lastIndexOf("."),S=c.resourceManager.load({url:Ye.resolveAbsoluteUrl(u,g),type:Re.KTX2}).onProgress(void 0,e._onTaskDetail).then(function(C){return C.name||(C.name=f||p||"texture_"+A),d!==void 0&&je.parseSampler(C,m),C}),e._addTaskCompletePromise(S),[2,S]):(x=s.bufferViews[y],[2,e.get(Ae.Buffer,x.buffer).then(function(C){var w=new Uint8Array(C,x.byteOffset,x.byteLength);return kt._parseBuffer(w,c).then(function(E){var T=E.engine,M=E.result,B=E.targetFormat,I=E.params;return kt._createTextureByBuffer(T,M,B,I)}).then(function(E){E.name=f||p||"texture_"+y,d!==void 0&&je.parseSampler(E,m);var T=new Im(E,x,v);return e.contentRestorer.bufferTextures.push(T),E})})])})})()},i}(tn);Pv=fe([rn("KHR_texture_basisu",Kt.CreateAndParse)],Pv);var Mv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){var s=o.offset,l=o.rotation,c=o.scale,u=o.texCoord;s&&(n.tilingOffset.z=s[0],n.tilingOffset.w=s[1]),c&&(n.tilingOffset.x=c[0],n.tilingOffset.y=c[1]),l&&me.warn("rotation in KHR_texture_transform is not supported now"),u&&me.warn("texCoord in KHR_texture_transform is not supported now")},i}(tn);Mv=fe([rn("KHR_texture_transform",Kt.AdditiveParse)],Mv);var Bv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,n){var o=e.glTFResource.engine,s=o.resourceManager.getResourceByRef(n);return e._addTaskCompletePromise(s),s},i}(tn);Bv=fe([rn("GALACEAN_materials_remap",Kt.CreateAndParse)],Bv);var Dv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){e.glTFResource.engine;var s=o.events;s.map(function(l){var c=new Bu;c.functionName=l.functionName,c.time=l.time,c.parameter=l.parameter,n.addEvent(c)})},i}(tn);Dv=fe([rn("GALACEAN_animation_event",Kt.AdditiveParse)],Dv);var Lv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.createAndParse=function(e,n){return e.get(Ae.Buffer,n.buffer).then(function(o){return fc.decodeGltfBuffer(n.count,n.byteStride,new Uint8Array(o,n.byteOffset,n.byteLength),n.mode,n.filter)})},i}(tn);Lv=fe([rn("EXT_meshopt_compression",Kt.CreateAndParse)],Lv);var Iv=function(r){le(i,r);function i(){return r.apply(this,arguments)}var a=i.prototype;return a.additiveParse=function(e,n,o){var s=o.anisotropyStrength,l=s===void 0?0:s,c=o.anisotropyRotation,u=c===void 0?0:c,d=o.anisotropyTexture;n.anisotropy=l,n.anisotropyRotation=u,d&&(Ht._checkOtherTextureTransform(d,"Anisotropy texture"),e.get(Ae.Texture,d.index).then(function(f){n.anisotropyTexture=f}))},i}(tn);Iv=fe([rn("KHR_materials_anisotropy",Kt.AdditiveParse)],Iv);var lb="1.2.0-alpha.4";console.log("Galacean engine version: "+lb);for(var Fv in Rp)Ve.registerClass(Fv,Rp[Fv]);var bo=Object.freeze({Linear:Object.freeze({None:function(r){return r},In:function(r){return this.None(r)},Out:function(r){return this.None(r)},InOut:function(r){return this.None(r)}}),Quadratic:Object.freeze({In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}}),Cubic:Object.freeze({In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}}),Quartic:Object.freeze({In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}}),Quintic:Object.freeze({In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}}),Sinusoidal:Object.freeze({In:function(r){return 1-Math.sin((1-r)*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.sin(Math.PI*(.5-r)))}}),Exponential:Object.freeze({In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}}),Circular:Object.freeze({In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}}),Elastic:Object.freeze({In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(r){var i=1.70158;return r===1?1:r*r*((i+1)*r-i)},Out:function(r){var i=1.70158;return r===0?0:--r*r*((i+1)*r+i)+1},InOut:function(r){var i=2.5949095;return(r*=2)<1?.5*(r*r*((i+1)*r-i)):.5*((r-=2)*r*((i+1)*r+i)+2)}}),Bounce:Object.freeze({In:function(r){return 1-bo.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?bo.Bounce.In(r*2)*.5:bo.Bounce.Out(r*2-1)*.5+.5}}),generatePow:function(r){return r===void 0&&(r=4),r=r<Number.EPSILON?Number.EPSILON:r,r=r>1e4?1e4:r,{In:function(i){return Math.pow(i,r)},Out:function(i){return 1-Math.pow(1-i,r)},InOut:function(i){return i<.5?Math.pow(i*2,r)/2:(1-Math.pow(2-i*2,r))/2+.5}}}}),us=function(){return performance.now()},cb=function(){function r(){this._tweens={},this._tweensAddedDuringUpdate={}}return r.prototype.getAll=function(){var i=this;return Object.keys(this._tweens).map(function(a){return i._tweens[a]})},r.prototype.removeAll=function(){this._tweens={}},r.prototype.add=function(i){this._tweens[i.getId()]=i,this._tweensAddedDuringUpdate[i.getId()]=i},r.prototype.remove=function(i){delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]},r.prototype.update=function(i,a){i===void 0&&(i=us()),a===void 0&&(a=!1);var t=Object.keys(this._tweens);if(t.length===0)return!1;for(;t.length>0;){this._tweensAddedDuringUpdate={};for(var e=0;e<t.length;e++){var n=this._tweens[t[e]],o=!a;n&&n.update(i,o)===!1&&!a&&delete this._tweens[t[e]]}t=Object.keys(this._tweensAddedDuringUpdate)}return!0},r}(),_o={Linear:function(r,i){var a=r.length-1,t=a*i,e=Math.floor(t),n=_o.Utils.Linear;return i<0?n(r[0],r[1],t):i>1?n(r[a],r[a-1],a-t):n(r[e],r[e+1>a?a:e+1],t-e)},Bezier:function(r,i){for(var a=0,t=r.length-1,e=Math.pow,n=_o.Utils.Bernstein,o=0;o<=t;o++)a+=e(1-i,t-o)*e(i,o)*r[o]*n(t,o);return a},CatmullRom:function(r,i){var a=r.length-1,t=a*i,e=Math.floor(t),n=_o.Utils.CatmullRom;return r[0]===r[a]?(i<0&&(e=Math.floor(t=a*(1+i))),n(r[(e-1+a)%a],r[e],r[(e+1)%a],r[(e+2)%a],t-e)):i<0?r[0]-(n(r[0],r[0],r[1],r[1],-t)-r[0]):i>1?r[a]-(n(r[a],r[a],r[a-1],r[a-1],t-a)-r[a]):n(r[e?e-1:0],r[e],r[a<e+1?a:e+1],r[a<e+2?a:e+2],t-e)},Utils:{Linear:function(r,i,a){return(i-r)*a+r},Bernstein:function(r,i){var a=_o.Utils.Factorial;return a(r)/a(i)/a(r-i)},Factorial:function(){var r=[1];return function(i){var a=1;if(r[i])return r[i];for(var t=i;t>1;t--)a*=t;return r[i]=a,a}}(),CatmullRom:function(r,i,a,t,e){var n=(a-r)*.5,o=(t-i)*.5,s=e*e,l=e*s;return(2*i-2*a+n+o)*l+(-3*i+3*a-2*n-o)*s+n*e+i}}},ub=function(){function r(){}return r.nextId=function(){return r._nextId++},r._nextId=0,r}(),Df=new cb,is=function(){function r(i,a){a===void 0&&(a=Df),this._object=i,this._group=a,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=bo.Linear.None,this._interpolationFunction=_o.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=ub.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return r.prototype.getId=function(){return this._id},r.prototype.isPlaying=function(){return this._isPlaying},r.prototype.isPaused=function(){return this._isPaused},r.prototype.to=function(i,a){if(a===void 0&&(a=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=i,this._propertiesAreSetUp=!1,this._duration=a,this},r.prototype.duration=function(i){return i===void 0&&(i=1e3),this._duration=i,this},r.prototype.dynamic=function(i){return i===void 0&&(i=!1),this._isDynamic=i,this},r.prototype.start=function(i,a){if(i===void 0&&(i=us()),a===void 0&&(a=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var t in this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=i,this._startTime+=this._delayTime,!this._propertiesAreSetUp||a){if(this._propertiesAreSetUp=!0,!this._isDynamic){var e={};for(var n in this._valuesEnd)e[n]=this._valuesEnd[n];this._valuesEnd=e}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,a)}return this},r.prototype.startFromCurrentValues=function(i){return this.start(i,!0)},r.prototype._setupProperties=function(i,a,t,e,n){for(var o in t){var s=i[o],l=Array.isArray(s),c=l?"array":typeof s,u=!l&&Array.isArray(t[o]);if(!(c==="undefined"||c==="function")){if(u){var d=t[o];if(d.length===0)continue;for(var f=[s],h=0,_=d.length;h<_;h+=1){var g=this._handleRelativeValue(s,d[h]);if(isNaN(g)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}f.push(g)}u&&(t[o]=f)}if((c==="object"||l)&&s&&!u){a[o]=l?[]:{};var y=s;for(var v in y)a[o][v]=y[v];e[o]=l?[]:{};var d=t[o];if(!this._isDynamic){var p={};for(var v in d)p[v]=d[v];t[o]=d=p}this._setupProperties(y,a[o],d,e[o],n)}else(typeof a[o]>"u"||n)&&(a[o]=s),l||(a[o]*=1),u?e[o]=t[o].slice().reverse():e[o]=a[o]||0}}},r.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},r.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},r.prototype.pause=function(i){return i===void 0&&(i=us()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=i,this._group&&this._group.remove(this),this)},r.prototype.resume=function(i){return i===void 0&&(i=us()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=i-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},r.prototype.stopChainedTweens=function(){for(var i=0,a=this._chainedTweens.length;i<a;i++)this._chainedTweens[i].stop();return this},r.prototype.group=function(i){return i===void 0&&(i=Df),this._group=i,this},r.prototype.delay=function(i){return i===void 0&&(i=0),this._delayTime=i,this},r.prototype.repeat=function(i){return i===void 0&&(i=0),this._initialRepeat=i,this._repeat=i,this},r.prototype.repeatDelay=function(i){return this._repeatDelayTime=i,this},r.prototype.yoyo=function(i){return i===void 0&&(i=!1),this._yoyo=i,this},r.prototype.easing=function(i){return i===void 0&&(i=bo.Linear.None),this._easingFunction=i,this},r.prototype.interpolation=function(i){return i===void 0&&(i=_o.Linear),this._interpolationFunction=i,this},r.prototype.chain=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];return this._chainedTweens=i,this},r.prototype.onStart=function(i){return this._onStartCallback=i,this},r.prototype.onEveryStart=function(i){return this._onEveryStartCallback=i,this},r.prototype.onUpdate=function(i){return this._onUpdateCallback=i,this},r.prototype.onRepeat=function(i){return this._onRepeatCallback=i,this},r.prototype.onComplete=function(i){return this._onCompleteCallback=i,this},r.prototype.onStop=function(i){return this._onStopCallback=i,this},r.prototype.update=function(i,a){if(i===void 0&&(i=us()),a===void 0&&(a=!0),this._isPaused)return!0;var t,e,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(i>n)return!1;a&&this.start(i,!0)}if(this._goToEnd=!1,i<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),e=(i-this._startTime)/this._duration,e=this._duration===0||e>1?1:e;var o=this._easingFunction(e);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,e),e===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[t]=="string"&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=i+this._repeatDelayTime:this._startTime=i+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},r.prototype._updateProperties=function(i,a,t,e){for(var n in t)if(a[n]!==void 0){var o=a[n]||0,s=t[n],l=Array.isArray(i[n]),c=Array.isArray(s),u=!l&&c;u?i[n]=this._interpolationFunction(s,e):typeof s=="object"&&s?this._updateProperties(i[n],o,s,e):(s=this._handleRelativeValue(o,s),typeof s=="number"&&(i[n]=o+(s-o)*e))}},r.prototype._handleRelativeValue=function(i,a){return typeof a!="string"?a:a.charAt(0)==="+"||a.charAt(0)==="-"?i+parseFloat(a):parseFloat(a)},r.prototype._swapEndStartRepeatValues=function(i){var a=this._valuesStartRepeat[i],t=this._valuesEnd[i];typeof t=="string"?this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(t):this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=a},r}(),ti=Df;ti.getAll.bind(ti);ti.removeAll.bind(ti);ti.add.bind(ti);ti.remove.bind(ti);var db=ti.update.bind(ti);function Lf(r,i){return Lf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Lf(r,i)}function Nu(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(i&&i.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),i&&Lf(r,i)}function Nv(r,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Vm(r,i,a){return i&&Nv(r.prototype,i),a&&Nv(r,a),r}function Bn(r,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](r):r instanceof i}var fb=function(){function r(a){a===void 0&&(a=[]),this._flags=a,this.flag=!0,this._flags.push(this)}var i=r.prototype;return i.destroy=function(){Ye.removeFromArray(this._flags,this),this._flags=null},r}(),hb=function(){function r(){this._updateFlags=[]}var i=r.prototype;return i.register=function(){return new fb(this._updateFlags)},i.distribute=function(){for(var t=this._updateFlags,e=t.length-1;e>=0;e--)t[e].flag=!0},r}(),pl=function(){function r(){this._position=new P,this._worldScale=new P(1,1,1),this._transform=new Vu,this._invModelMatrix=new $,this._transform.owner=this,this._inverseWorldMatFlag=this._transform.registerWorldChangeFlag()}var i=r.prototype;return i.setRotation=function(t){console.log("Physics-lite don't support setRotation. Use Physics-PhysX instead!")},i.setPosition=function(t){t!==this._position&&this._position.copyFrom(t),this._setLocalPose()},i.setWorldScale=function(t){t!==this._worldScale&&this._worldScale.copyFrom(t),this._setLocalPose()},i.setContactOffset=function(t){console.log("Physics-lite don't support setContactOffset. Use Physics-PhysX instead!")},i.setMaterial=function(t){console.log("Physics-lite don't support setMaterial. Use Physics-PhysX instead!")},i.setUniqueID=function(t){this._id=t},i.setIsTrigger=function(t){console.log("Physics-lite don't support setIsTrigger. Use Physics-PhysX instead!")},i.destroy=function(){},i._updateHitResult=function(t,e,n,o,s){s===void 0&&(s=!1);var l=r._tempPoint;t.getPoint(e,l),s||P.transformCoordinate(l,this._transform.worldMatrix,l);var c=P.distance(o,l);c<n.distance&&(n.point.copyFrom(l),n.distance=c,n.shapeID=this._id)},i._getLocalRay=function(t){var e=this._getInvModelMatrix(),n=r._ray;return P.transformCoordinate(t.origin,e,n.origin),P.transformNormal(t.direction,e,n.direction),n.direction.normalize(),n},i._getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&($.invert(this._transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},i._setLocalPose=function(){var t=r._tempPoint;P.multiply(this._position,this._worldScale,t),this._transform.position=t},r}();(function(){pl._ray=new em})();(function(){pl._tempPoint=new P})();var Vu=function(){function r(){this._position=new P,this._rotation=new P,this._rotationQuaternion=new xe,this._scale=new P(1,1,1),this._worldRotationQuaternion=new xe,this._localMatrix=new $,this._worldMatrix=new $,this._updateFlagManager=new hb,this._isParentDirty=!0,this._parentTransformCache=null,this._dirtyFlag=188}var i=r.prototype;return i.setPosition=function(t,e,n){this._position.set(t,e,n),this.position=this._position},i.setRotationQuaternion=function(t,e,n,o){this._rotationQuaternion.set(t,e,n,o),this.rotationQuaternion=this._rotationQuaternion},i.setScale=function(t,e,n){this._scale.set(t,e,n),this.scale=this._scale},i.registerWorldChangeFlag=function(){return this._updateFlagManager.register()},i._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(132)&&(this._worldAssociatedChange(132),Bn(this._owner,po)))for(var t=this._owner._shapes,e=0,n=t.length;e<n;e++)t[e]._transform._updateWorldPositionFlag()},i._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(152)&&(this._worldAssociatedChange(152),Bn(this._owner,po)))for(var t=this._owner._shapes,e=0,n=t.length;e<n;e++)t[e]._transform._updateWorldRotationFlag()},i._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(160)&&(this._worldAssociatedChange(160),Bn(this._owner,po)))for(var t=this._owner._shapes,e=0,n=t.length;e<n;e++)t[e]._transform._updateWorldScaleFlag()},i._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(188)&&(this._worldAssociatedChange(188),Bn(this._owner,po)))for(var t=this._owner._shapes,e=0,n=t.length;e<n;e++)t[e]._transform._updateAllWorldFlag()},i._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;var t=null;if(Bn(this._owner,pl)){var e=this._owner._collider;t=e._transform}return this._parentTransformCache=t,this._isParentDirty=!1,t},i._isContainDirtyFlags=function(t){return(this._dirtyFlag&t)===t},i._isContainDirtyFlag=function(t){return(this._dirtyFlag&t)!=0},i._setDirtyFlagTrue=function(t){this._dirtyFlag|=t},i._setDirtyFlagFalse=function(t){this._dirtyFlag&=~t},i._worldAssociatedChange=function(t){this._dirtyFlag|=t,this._updateFlagManager.distribute()},Vm(r,[{key:"owner",set:function(t){this._owner=t}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t),this._setDirtyFlagTrue(64),this._updateWorldPositionFlag()}},{key:"rotationQuaternion",get:function(){return this._isContainDirtyFlag(2)&&(xe.rotationEuler(U.degreeToRadian(this._rotation.x),U.degreeToRadian(this._rotation.y),U.degreeToRadian(this._rotation.z),this._rotationQuaternion),this._setDirtyFlagFalse(2)),this._rotationQuaternion},set:function(t){this._rotationQuaternion!==t&&this._rotationQuaternion.copyFrom(t),this._setDirtyFlagTrue(65),this._setDirtyFlagFalse(2),this._updateWorldRotationFlag()}},{key:"worldRotationQuaternion",get:function(){if(this._isContainDirtyFlag(16)){var t=this._getParentTransform();t!=null?xe.multiply(t.worldRotationQuaternion,this.rotationQuaternion,this._worldRotationQuaternion):this._worldRotationQuaternion.copyFrom(this.rotationQuaternion),this._setDirtyFlagFalse(16)}return this._worldRotationQuaternion},set:function(t){this._worldRotationQuaternion!==t&&this._worldRotationQuaternion.copyFrom(t);var e=this._getParentTransform();e?(xe.invert(e.worldRotationQuaternion,r._tempQuat0),xe.multiply(t,r._tempQuat0,this._rotationQuaternion)):this._rotationQuaternion.copyFrom(t),this.rotationQuaternion=this._rotationQuaternion,this._setDirtyFlagFalse(16)}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale!==t&&this._scale.copyFrom(t),this._setDirtyFlagTrue(64),this._updateWorldScaleFlag()}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(64)&&($.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(64)),this._localMatrix},set:function(t){this._localMatrix!==t&&this._localMatrix.copyFrom(t),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(1),this._setDirtyFlagFalse(64),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(128)){var t=this._getParentTransform();t?$.multiply(t.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(128)}return this._worldMatrix},set:function(t){this._worldMatrix!==t&&this._worldMatrix.copyFrom(t);var e=this._getParentTransform();e?($.invert(e.worldMatrix,r._tempMat42),$.multiply(r._tempMat42,t,this._localMatrix)):this._localMatrix.copyFrom(t),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(128)}}]),r}();(function(){Vu._tempQuat0=new xe})();(function(){Vu._tempMat42=new $})();var Vv;(function(r){r[r.LocalEuler=1]="LocalEuler",r[r.LocalQuat=2]="LocalQuat",r[r.WorldPosition=4]="WorldPosition",r[r.WorldEuler=8]="WorldEuler",r[r.WorldQuat=16]="WorldQuat",r[r.WorldScale=32]="WorldScale",r[r.LocalMatrix=64]="LocalMatrix",r[r.WorldMatrix=128]="WorldMatrix",r[r.WmWp=132]="WmWp",r[r.WmWeWq=152]="WmWeWq",r[r.WmWpWeWq=156]="WmWpWeWq",r[r.WmWs=160]="WmWs",r[r.WmWpWs=164]="WmWpWs",r[r.WmWpWeWqWs=188]="WmWpWeWqWs"})(Vv||(Vv={}));var po=function(){function r(){this._shapes=[],this._transform=new Vu,this._transform.owner=this}var i=r.prototype;return i.addShape=function(t){var e=t._collider;e!==this&&(e&&e.removeShape(t),this._shapes.push(t),t._collider=this)},i.removeShape=function(t){var e=this._shapes.indexOf(t);e!==-1&&(this._shapes.splice(e,1),t._collider=null)},i.setWorldTransform=function(t,e){this._transform.setPosition(t.x,t.y,t.z),this._transform.setRotationQuaternion(e.x,e.y,e.z,e.w)},i.getWorldTransform=function(t,e){var n=this._transform,o=n.position,s=n.rotationQuaternion;t.set(o.x,o.y,o.z),e.set(s.x,s.y,s.z,s.w)},i.destroy=function(){},i._raycast=function(t,e,n){n.distance=Number.MAX_VALUE;for(var o=this._shapes,s=0,l=o.length;s<l;s++){var c=o[s];e(c._id)&&c._raycast(t,n)}return n.distance!=Number.MAX_VALUE},r}(),_b=function(r){Nu(i,r);function i(t,e){var n;return n=r.call(this)||this,n._transform.setPosition(t.x,t.y,t.z),n._transform.setRotationQuaternion(e.x,e.y,e.z,e.w),n}var a=i.prototype;return a.addForce=function(e){throw"Physics-lite don't support addForce. Use Physics-PhysX instead!"},a.addTorque=function(e){throw"Physics-lite don't support addTorque. Use Physics-PhysX instead!"},a.move=function(e,n){throw"Physics-lite don't support move. Use Physics-PhysX instead!"},a.sleep=function(){throw"Physics-lite don't support putToSleep. Use Physics-PhysX instead!"},a.setAngularDamping=function(e){throw"Physics-lite don't support setAngularDamping. Use Physics-PhysX instead!"},a.setAngularVelocity=function(e){throw"Physics-lite don't support setAngularVelocity. Use Physics-PhysX instead!"},a.setCenterOfMass=function(e){throw"Physics-lite don't support setCenterOfMass. Use Physics-PhysX instead!"},a.setCollisionDetectionMode=function(e){throw"Physics-lite don't support setCollisionDetectionMode. Use Physics-PhysX instead!"},a.setConstraints=function(e){throw"Physics-lite don't support setConstraints. Use Physics-PhysX instead!"},a.setInertiaTensor=function(e){throw"Physics-lite don't support setInertiaTensor. Use Physics-PhysX instead!"},a.setIsKinematic=function(e){throw"Physics-lite don't support setIsKinematic. Use Physics-PhysX instead!"},a.setLinearDamping=function(e){throw"Physics-lite don't support setLinearDamping. Use Physics-PhysX instead!"},a.setLinearVelocity=function(e){throw"Physics-lite don't support setLinearVelocity. Use Physics-PhysX instead!"},a.setMass=function(e){throw"Physics-lite don't support setMass. Use Physics-PhysX instead!"},a.setMaxAngularVelocity=function(e){throw"Physics-lite don't support setMaxAngularVelocity. Use Physics-PhysX instead!"},a.setMaxDepenetrationVelocity=function(e){throw"Physics-lite don't support setMaxDepenetrationVelocity. Use Physics-PhysX instead!"},a.setSleepThreshold=function(e){throw"Physics-lite don't support setSleepThreshold. Use Physics-PhysX instead!"},a.setSolverIterations=function(e){throw"Physics-lite don't support setSolverIterations. Use Physics-PhysX instead!"},a.wakeUp=function(){throw"Physics-lite don't support wakeUp. Use Physics-PhysX instead!"},i}(po),pb=function(){function r(a,t,e,n,o){}var i=r.prototype;return i.setBounciness=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setDynamicFriction=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setStaticFriction=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setBounceCombine=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setFrictionCombine=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.destroy=function(){},r}(),vb=function(){function r(a){a===void 0&&(a=0),this.length=0,this._elements=new Array(a)}var i=r.prototype;return i.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},i.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},i.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},i.deleteByIndex=function(t){var e=this._elements,n=null,o=this.length-1;return t!==o&&(n=e[o],e[t]=n),this.length--,n},i.garbageCollection=function(){this._elements.length=this.length},r}(),Om=function(){this.shapeID=-1,this.distance=0,this.point=new P,this.normal=new P},Es=function(r){Nu(i,r);function i(t,e,n){var o;return o=r.call(this)||this,o._halfSize=new P,o._boxMin=new P(-.5,-.5,-.5),o._boxMax=new P(.5,.5,.5),o._id=t,o._halfSize.set(e.x*.5,e.y*.5,e.z*.5),o._setBondingBox(),o}var a=i.prototype;return a.setPosition=function(e){r.prototype.setPosition.call(this,e),this._setBondingBox()},a.setWorldScale=function(e){r.prototype.setWorldScale.call(this,e),this._setBondingBox()},a.setSize=function(e){this._halfSize.set(e.x*.5,e.y*.5,e.z*.5),this._setBondingBox()},a._raycast=function(e,n){var o=this._getLocalRay(e),s=i._tempBox;s.min.set(-this._halfSize.x*this._worldScale.x,-this._halfSize.y*this._worldScale.y,-this._halfSize.z*this._worldScale.z),s.max.set(this._halfSize.x*this._worldScale.x,this._halfSize.y*this._worldScale.y,this._halfSize.z*this._worldScale.z);var l=o.intersectBox(s);return l!==-1?(this._updateHitResult(o,l,n,e.origin),!0):!1},a._setBondingBox=function(){var e=this._transform.position,n=this._worldScale,o=this._halfSize;this._boxMin.set(-o.x*n.x+e.x,-o.y*n.y+e.y,-o.z*n.z+e.z),this._boxMax.set(o.x*n.x+e.x,o.y*n.y+e.y,o.z*n.z+e.z)},i}(pl);(function(){Es._tempBox=new qt})();var ws=function(r){Nu(i,r);function i(t,e,n){var o;return o=r.call(this)||this,o._radius=1,o._maxScale=1,o._radius=e,o._id=t,o}var a=i.prototype;return a.setRadius=function(e){this._radius=e},a.setWorldScale=function(e){r.prototype.setWorldScale.call(this,e),this._maxScale=Math.max(e.x,e.y,e.z)},a._raycast=function(e,n){var o=i._tempSphere;P.transformCoordinate(this._transform.position,this._collider._transform.worldMatrix,o.center),o.radius=this.worldRadius;var s=e.intersectSphere(o);return s!==-1?(this._updateHitResult(e,s,n,e.origin,!0),!0):!1},Vm(i,[{key:"worldRadius",get:function(){return this._radius*this._maxScale}}]),i}(pl);(function(){ws._tempSphere=new ol})();var vl=function(){function r(a,t,e,n,o,s){this._colliders=[],this._sphere=new ol,this._box=new qt,this._currentEvents=new vb,this._eventMap={},this._eventPool=[],this._onContactEnter=a,this._onContactExit=t,this._onContactStay=e,this._onTriggerEnter=n,this._onTriggerExit=o,this._onTriggerStay=s}var i=r.prototype;return i.setGravity=function(t){console.log("Physics-lite don't support gravity. Use Physics-PhysX instead!")},i.addColliderShape=function(t){this._eventMap[t._id]={}},i.removeColliderShape=function(t){for(var e=this,n=e._eventPool,o=e._currentEvents,s=t._id,l=o.length-1;l>=0;l--){var c=o.get(l);(c.index1==s||c.index2==s)&&(o.deleteByIndex(l),n.push(c))}delete this._eventMap[s]},i.addCollider=function(t){this._colliders.push(t)},i.removeCollider=function(t){var e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1)},i.update=function(t){for(var e=this._colliders,n=0,o=e.length;n<o;n++)this._collisionDetection(t,e[n]);this._fireEvent()},i.raycast=function(t,e,n,o){var s=this._colliders,l;o&&(l=r._hitResult);for(var c=!1,u=r._currentHit,d=0,f=s.length;d<f;d++){var h=s[d];if(h._raycast(t,n,u)&&(c=!0,u.distance<e)){if(l)l.normal.copyFrom(u.normal),l.point.copyFrom(u.point),l.distance=u.distance,l.shapeID=u.shapeID;else return!0;e=u.distance}}return!c&&l?(l.shapeID=-1,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0)):c&&l&&o(l.shapeID,l.distance,l.point,l.normal),c},i.addCharacterController=function(t){throw"Physics-lite don't support addCharacterController. Use Physics-PhysX instead!"},i.removeCharacterController=function(t){throw"Physics-lite don't support removeCharacterController. Use Physics-PhysX instead!"},i._getTrigger=function(t,e){var n;return this._eventPool.length?(n=this._eventPool.pop(),n.index1=t,n.index2=e):n=new gb(t,e),this._eventMap[t][e]=n,n},i._collisionDetection=function(t,e){for(var n=this._colliders,o=e._shapes,s=0,l=o.length;s<l;s++){var c=o[s];if(Bn(c,Es)){r._updateWorldBox(c,this._box);for(var u=0,d=n.length;u<d;u++)for(var f=n[u]._shapes,h=0,_=f.length;h<_;h++){var g=f[h],y=g._id,v=c._id,p=y<v?this._eventMap[y][v]:this._eventMap[v][y];if(!(p!==void 0&&!p.alreadyInvoked)&&g!=c&&this._boxCollision(g))if(p===void 0){var m=y<v?this._getTrigger(y,v):this._getTrigger(v,y);m.state=0,m.alreadyInvoked=!1,this._currentEvents.add(m)}else p.state===0?(p.state=1,p.alreadyInvoked=!1):p.state===1&&(p.alreadyInvoked=!1)}}else if(Bn(c,ws)){r._upWorldSphere(c,this._sphere);for(var A=0,S=n.length;A<S;A++)for(var x=n[A]._shapes,b=0,C=x.length;b<C;b++){var w=x[b],E=w._id,T=c._id,M=E<T?this._eventMap[E][T]:this._eventMap[T][E];if(!(M!==void 0&&!M.alreadyInvoked)&&w!=c&&this._sphereCollision(w))if(M===void 0){var B=E<T?this._getTrigger(E,T):this._getTrigger(T,E);B.state=0,B.alreadyInvoked=!1,this._currentEvents.add(B)}else M.state===0?(M.state=1,M.alreadyInvoked=!1):M.state===1&&(M.alreadyInvoked=!1)}}}},i._fireEvent=function(){for(var t=this,e=t._eventPool,n=t._currentEvents,o=n.length-1;o>=0;o--){var s=n.get(o);s.alreadyInvoked?(s.state=2,this._eventMap[s.index1][s.index2]=void 0,this._onTriggerExit(s.index1,s.index2),n.deleteByIndex(o),e.push(s)):s.state==0?(this._onTriggerEnter(s.index1,s.index2),s.alreadyInvoked=!0):s.state==1&&(this._onTriggerStay(s.index1,s.index2),s.alreadyInvoked=!0)}},i._boxCollision=function(t){if(Bn(t,Es)){var e=r._tempBox;return r._updateWorldBox(t,e),wt.intersectsBoxAndBox(e,this._box)}else if(Bn(t,ws)){var n=r._tempSphere;return r._upWorldSphere(t,n),wt.intersectsSphereAndBox(n,this._box)}return!1},i._sphereCollision=function(t){if(Bn(t,Es)){var e=r._tempBox;return r._updateWorldBox(t,e),wt.intersectsSphereAndBox(this._sphere,e)}else if(Bn(t,ws)){var n=r._tempSphere;return r._upWorldSphere(t,n),wt.intersectsSphereAndSphere(n,this._sphere)}return!1},r._updateWorldBox=function(t,e){var n=t._transform.worldMatrix;e.min.copyFrom(t._boxMin),e.max.copyFrom(t._boxMax),qt.transform(e,n,e)},r._upWorldSphere=function(t,e){P.transformCoordinate(t._transform.position,t._transform.worldMatrix,e.center),e.radius=t.worldRadius},r}();(function(){vl._tempSphere=new ol})();(function(){vl._tempBox=new qt})();(function(){vl._currentHit=new Om})();(function(){vl._hitResult=new Om})();var Ov;(function(r){r[r.Enter=0]="Enter",r[r.Stay=1]="Stay",r[r.Exit=2]="Exit"})(Ov||(Ov={}));var gb=function(i,a){this.alreadyInvoked=!1,this.index1=i,this.index2=a},mb=function(r){Nu(i,r);function i(a,t){var e;return e=r.call(this)||this,e._transform.setPosition(a.x,a.y,a.z),e._transform.setRotationQuaternion(t.x,t.y,t.z,t.w),e}return i}(po),yb=function(){function r(){}var i=r.prototype;return i.initialize=function(){return Promise.resolve()},i.createPhysicsManager=function(){return null},i.createPhysicsScene=function(t,e,n,o,s,l,c){return new vl(e,n,o,s,l,c)},i.createStaticCollider=function(t,e){return new mb(t,e)},i.createDynamicCollider=function(t,e){return new _b(t,e)},i.createCharacterController=function(){throw"Physics-lite don't support createCharacterController. Use Physics-PhysX instead!"},i.createPhysicsMaterial=function(t,e,n,o,s){return new pb(t,e,n,o,s)},i.createBoxColliderShape=function(t,e,n){return new Es(t,e,n)},i.createSphereColliderShape=function(t,e,n){return new ws(t,e,n)},i.createPlaneColliderShape=function(t,e){throw"Physics-lite don't support PlaneColliderShape. Use Physics-PhysX instead!"},i.createCapsuleColliderShape=function(t,e,n,o){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createFixedJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createHingeJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createSpringJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},r}(),Ab="1.2.0-alpha.4";console.log("Galacean PhysicsLite version: "+Ab);const xb=""+new URL("background-mi8UMpPT.png",import.meta.url).href,Sb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIoAAAMZCAYAAADfnawUAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExODE0NUY0MkQ5OEE1OTg3NiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3Mzg1MThFNjg5NDgxMUUzOTkzRkJDMEM4MDJDNEY2OCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3Mzg1MThFNTg5NDgxMUUzOTkzRkJDMEM4MDJDNEY2OCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDQ4MDExNzQwNzIwNjgxMTgxNDVGNDJEOThBNTk4NzYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDE4MDExNzQwNzIwNjgxMTgxNDVGNDJEOThBNTk4NzYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5S8yE6AAAIiUlEQVR42uzdy24bVQCA4XPGuUI3SCAQVTdIFVXZAAtAArFCVN0j8TQ8Du/ARWJBWcECsgmqIItWAikLVk3iOKnn4MuMY3vG6Ti3OvH3SeklHdfTyZ9zjifpTPzqkwcpwAtkDgFCQSgIhQW0ErNhKyml/g8h28jDnW92Q8h774zFW8+7d++PHhTj8J1fvvn+yfvKDZfID7t/jH6dwvA1wUZrNXz++nuV4/L97u+jX5fbXqXHf22f7GsaPv/TR/uDvZmWfnonhKPW6SNKXPMiaLkUo0Eq3tqrIax2TT2cceqpDaxMaGzqGfxRVk49Y6VlcWmnnvFjMv37uuMSX/anZTaaJ8d2eGoGialhKC8apcJkPEvax+x/fzzluMQbNKJkvexHC9d48lnw4K0PKgu0H3e3Kou5eRZTdQvkWdsuqrq92wpbjbY7r6eP9ipP0FqP4fZHr1bifPLLs+rOxOY7VhkMW62WCRmLWS5qMTs+DcTJhSs3zBzzoREFoSAUhIJQEApCgbAyOk+SQvANBswcUaa+QAymHoSCUBAKQkEoCAWEglAQCkJhgfX/I9jYfwYTCkYUhIJQEApCQSggFITCBZrrikvlBXTGLzdVXkCnyZUOy4vijF8cZ/pxoysn1my7iNIFbzf385fHp/wphdnHLZ19Z4woCAWhIBSEglAQCggFoXCZoTw/6joqVMSvP304OKGb52l42nfjecg+/jeEV46LLYbne2fdPaPpTYpmnYqPNVc8XvTT9gul7lDFhtvVOVwJ6bfbIRysFo+Lph6aq/2iYOqNLiFPEyPKZd3ezOhxRaOMxSwvZ0TJe3PSf5sh7K1NjCgsif5NJ7tZg1B6G6Y/33DAlnrqiqYeLnAxW1cUy82IQrMRZfPW5nANW5xw67912p3hS+QxrbUY4up0ZTG0pu7R2n9UN+Wj12hzL4UHr8zzsQcWJ/yyrHpyrreveX6ObwS9TsuG/OT7Yct/av/Q190iN+82fKncnzm6k8e0f4zXN9d7f2+sTD2VeWZwT+0sGzxL+YH44tvXQip2IBb3p3z49oe1z//z7nY46HaK/ZzvA9j/u3d2/g7Hx0dFC8PH37t3/+T5i2Ae72z3jkqY2O6m6t+RtG5BcOezW6MPWl+3k8I/v+43D/C7u1OfeynUNVHp8ajdMc4uucODw9PXKJ2aDVhO7b12fSiH+21Hh5mxDEI5eHbgqHBqLJlIaBKL8yg0IhSEglAQCkJBKAgFhIJQEApC4XqFEn1/NUYUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKCy8lYXcqxhCiHNsu8zijJ+NKCz+iNK02nhJZV/yZw1GFISCUBAKQkEoCAWEwnk54YYRBaGw0FPPVfHV47NPx756zLUZUa5qLRutZa1REAqmniuee877/BhREApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglBAKAgFoSAUhIJQEAoIBaEgFISCUBAKQgGhIBSEglAQCkJBKCAUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglBAKAgFoSAUhIJQEAoIBaEgFISCUBAKQgGhIBSEglAQCkJBKCAUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglBAKAgFoSAUhIJQEAoIBaEgFISCUBAKQgGhIBSEglAQCkJBKCAUhIJQEApCQSgIBYSCUBAKQkEoCAWhgFAQCkJBKAgFoSAUEApCQSgIBaEgFIQCQkEoCAWhIBSEglAcAoSCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQQCgIBaEgFISCUBAKCAWhIBSEglAQCkIBoSAUhIJQEApCQSggFISCUBAKQkEoCAWEglAQCkJBKAgFoYBQEApCQSgIBaEgFBAKQkEoCAWhIBSEAkJBKAgFoSAUhIJQHAKEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhIJQEApCAaEgFISCUBAKQkEoIBSEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhIJQEApCAaEgFISCUBAKQkEoIBSEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhIJQEApCAaEgFISCUBAKQkEoIBSEglAQCkJBKAgFhIJQEApCQSgIBaGAUBAKQkEoCAWhIBQQCkJBKAgFoSAUhAJCQSgIBaEgFISCUEAoCAWhIBSEglAQCggFoSAUhMK1878AAwDAUxw9p1dTiwAAAABJRU5ErkJggg==",Cb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwkAAACACAYAAABAzCUBAAALhUlEQVR4Xu3dvWudBRQH4PdtPrpZB61WUUQHEUFXVycXcVKhm4vg5iDdxbWTgwiiu3+Ae50dXBURRdRarR8NbcGkSSu3lHKTe2N/vb3H3CNPhhbqyenpc859058hzfjGm6dvDN4IECBAgAABAgQIECBwS2B89YWXhATnQIAAAQIECBAgQIDAbQEhwTEQIECAAAECBAgQILBPQEhwEAQIECBAgAABAgQICAlugAABAgQIECBAgACBwwXGjz58y9ckuBACBAgQIECAAAECBG4LjD/tnRUSHAQBAgQIECBAgAABAkKCGyBAgAABAgQIECBAYL6AzyS4DAIECBAgQIAAAQIE9gkICQ6CAAECBAgQIECAAIH9IeGLP8/MfE3C5ubxYW19bWGqnZ2dYW93d+H3n/eOZso4OXHKBLIq98QpE8iq3BOnTCCrck+cMoGsyj3NOo1nPn9+JiScevjR4cR992eqc6p++fXnYWvr0sLvP+8dzZRxcuKUCWRV7olTJpBVuSdOmUBW5Z44ZQJZlXuaExLeOffcTEh4ZBISTiweEs5fWH5IMFN25Jw4ZQJZlXvilAlkVe6JUyaQVbknTplAVuWehITsUsIqB5VBceKUCWRV7olTJpBVuSdOmUBW5Z44ZQJZ1VHf0+gzCdmi5lUd9fLMZHfTAj6Dl90DJ07TAp7j2T1w4pQJZFXuqYeTkJDtaW6VI8/wOHHKBLIq98QpE8iq3BOnTCCrck+cMoGs6qjvaXz/21dmvibh+ObxYX19/Y5/gt3d3eG3ixeGyc/Tb9s72zO/dsdmUwWPP/bETLmZZgU5ZVfFiZPn0+E34Dnu493B6/DM9Mz0zPTMnAiMH58/PRMSspfHMFy7dm344cfvb/68zLdnnn524XZmyug4cToo4HWX3QQnTplAVuWeOGUCWZV74pQJZFVCQuY0eOFlUJw4ZQJZlXvilAlkVe6JUyaQVbknTplAVrWK9yQkZLsTEjiFAlnZKj4MzGR3mUBW5Z44ZQJZlXvilAlkVe4pcxISMichgVMokJV5QHHKBLIq98QpE8iq3BOnTCCrck99neKQsL3993D5yuV9f9Lr168Pl7b+Gvb29jKBA1XHjh27+Z2d19bW9v2XBx84GfUzE6fpQ3FP0ctm4MRpWsBzfPYefGzxscXHluw5yen/7RSHhK2tS8Pk3xdf5tvGxsYw+VcUNjc2F2prpoyNE6dpAa+77B44ccoEsir3xCkTyKrcE6dMIKs67J6EhAN+Xnj3dlDZew+D4JJJceIk4GU3wInTRMAzM7sDTpySZ6aQICRkrxROnG4J+OCSnQInTskH4UzJX3457RfwPzSzi+B0b05Cgr/8ZhfEiZOQcFc3ICRkXJw4CVPZDXDi9F9/tmw8++XL0TdTu3r1yvD7HxfvfkP/8h6T7+r80MlT0Xd3ntfGTNk6OHGaFvC6y+6BE6dMIKtyT5wygazKPXHKBLKqw+5pfP29p6KQMNwYhhuTH5b4Nk56jTd/XOzNTJkbJ05TAl532Tlw4pQJZFXuiVMmkFW5J06ZQFZ12D2Nr7375HL/5p/No4oAAQIECBAgQIAAgRUVEBJWdDHGIkCAAAECBAgQIHBUAkLCUcn7fQkQIECAAAECBAisqICQsKKLMRYBAgQIECBAgACBoxIYP/vkRV+TcFT6fl8CBAgQIECAAAECKygwfvVp9k+gruDsRiJAgAABAgQIECBAoEBASChA1ZIAAQIECBAgQIBAZwEhofP2zE6AAAECBAgQIECgQEBIKEDVkgABAgQIECBAgEBngfGbc2/7wuXOGzQ7AQIECBAgQIAAgSULjN99/YGQsGRU7QgQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgSEhAJULQkQIECAAAECBAh0FhASOm/P7AQIECBAgAABAgQKBISEAlQtCRAgQIAAAQIECHQWEBI6b8/sBAgQIECAAAECBAoEhIQCVC0JECBAgAABAgQIdBYQEjpvz+wECBAgQIAAAQIECgT+AXfxnAHod9PuAAAAAElFTkSuQmCC",bb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARQAAABACAYAAADbGIgsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpENUU3ODRGODg5MTcxMUUzQkM4MUMwODVFQjk3NkM0MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpENUU3ODRGOTg5MTcxMUUzQkM4MUMwODVFQjk3NkM0MyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQ1RTc4NEY2ODkxNzExRTNCQzgxQzA4NUVCOTc2QzQzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQ1RTc4NEY3ODkxNzExRTNCQzgxQzA4NUVCOTc2QzQzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+B/b3DwAAAu1JREFUeNrs3b9KHFEUB+CZIELeIE1IYZfKVrAXe8kzZLGwyhLTiE2U7SzEPIOkl7RBSBlfwELS+AaBNBsTEMQ5153xzsz++77yuuPO/HY53DlzvZbj8biYtp2NrWmeRBkNfv3xrVhU8pZ3V3m/KAAUFEBBARQUgEnKrpqyTRpRo/PdrPcavjutjH25PKt17PvNQTKbxwOz3DiUt7xnIW8zFMAtD6CgAAoKgIIC9KiVpzxRx7tJZ/v39bDW6w7234TjdTveTSS64zPxJELe8p7VvM1QALc8gIICKCgAk600eXFquXHUoKrbiGrD9eWvytja5utax6aWJkeNsLvXjoNMOttvQt7d5Z27R0m0HP7w6Gbp8zZDAdzyAAoKoKAATJZsykZNq1TTqc+G4KKSd7/Z5u5REokatU99jmYoAAoKoKAACgqgoABkWZmnk011yw8+fq6MfTj+VBmLlit3sddEW1L7Y/SV7bLlnSv15KjuMv1FyNsMBVBQAAUFUFAAJktuUp27X0QTXSxN7rOhmcr28cD9HhJ9LQVP6WIvj3nLO7rel2ujrBNI/UlElM2i5m2GArjlARQUQEEBmOz/Stl5b1pFx5+9+jPVYAe3q1FTu2ySTVd5F0VeQ28O8y6Dawi+88PWc2n6XZ73vM1QALc8gIICKCgACgrQo+R+KLlPGCKpLvjJ9lV18Ht1aO9iPTw+6ngPblenGuzdOZVP/LjWU4eiOM08C3mnHB7d1PwM6gtzTWQbWYS8zVAAtzyAggIoKACTtbJJdbTEO2rAJptWNaWOHwTNrL6WJrfVHGvSJMzNcdnyvt8X5aGdja3sHORthgK45QEUFEBBAXiOXjep7qu59U9q1WHbUisGo2ZW1Bx8kHeTtx3LOy/vhp+BvGvmbYYCuOUBFBRAQQFQUIAeJZfej853y5xfHC3H39tf7+3fm55sX1XOf/Xn25n9IJosD4+uLbJ3Ie+urk3eZiiAggIoKICCAvBcfwUYAPqPfQLD+W0zAAAAAElFTkSuQmCC",Eb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANYAAABLCAIAAACDee7kAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNTc1RDdFODg5Q0IxMUUzOTkzRkJDMEM4MDJDNEY2OCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyNTc1RDdFOTg5Q0IxMUUzOTkzRkJDMEM4MDJDNEY2OCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjI1NzVEN0U2ODlDQjExRTM5OTNGQkMwQzgwMkM0RjY4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjI1NzVEN0U3ODlDQjExRTM5OTNGQkMwQzgwMkM0RjY4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+jkUoGQAACkVJREFUeNrsXWtsHFcVnjuzM97d2t6sndSOndIoLeBIwA+CUJGAUlGgDxR+ILVqKhURKvgRKK+//dG4P4qEaoESCcQjAqGolRBCNGkSJAqoRfTlJMV2okRK48jONnYefqxd21nP3MvcO/uYuTNz74x3vLbX59PKsnfOnDn3u+eee8+9Z9fo8T2aAgCsHVSgAAAuCAAXBADABQGbFinu76PvLAEpgFXFk59NQxQEwEQMAIALAsAFAQBwQcA6zIj9mPvtU3iqQH8jFvAFiAXUtq39wJ/rdUFzfMi6flkhBFwQEHuSzfcmEAWZ81VeAEAsRPCZKC6IafyDKAhYiQvKfQbSEQBkxABwQQAAXBAALggAgAsCNidSCepCelrfuUcxsgqif8lvWL69fGWQlBYUunkUsIGk5randnyCqUZRDMAzE2ZhmO0FBG9H1RRG04lnrpmFEaVsHbEbmNq5B9kNjHY7WV4yr5yO1MAQhWbhPJ4phLWo8faI+Vl7F1RbO9u/9Wvtznuo9Uj+wTxrujD94kPW9fep9UEbSEbf/bnvHGF0qPQlw9LbL8/+fj9jxAwUsBW27f9dLIVzR5522LadALV2tj31K+3OXREbiKcLMwMP07Ol8AaK7Zn704Gl//yRtcjy93Hj7RHzAxMxYNNPxLXRQwelGklYIlDRE21QyueO2ArVuhuI6rJH3qLG2hO3Bze8CyoxGYmyAK1TodO0xBootSfaoGqcPfEJb7QLcutfjOkRc+hVS1E1RU2xA2jkvCWQL98SvuagVwOHhKvDiGVGp9iv0H6HaqBdTpgarx5C3Lew30l99iDKT7mzCX1haxUJt+1324MQbaDLzzj9BFvr3QWvvjIwdfpk2XTfajqVbd+596DR3kG7gs04H54auD18gq1uA+SXZ29cOvLT0lSBMhVEdGbxeo6RUuUs+9UfGZ96mC16KZWzo0Oj/Y86VEfJ4DKLN7aUFRLHgIu/3G+l0vYbTg/e9Y2f5Pc8UvZFBU0P/XP8Ly+w9tryWLNKnVPjmsukuPb03Lc39+PjTL+tAJXOv7bw6s/KCXIQA4VXfjF15kQY4Xqm/e69z+ltHRWDlYVTA6Xhk1XCbftHn3uIJbf2GFOM9m27vv2i0dlDO4jJc/o5ftajCy5OvD974b8snwtI6Fo6etXtu/XuXWy00YROffOoILZjszR/+Yytkws2tUFpkFzW8xQ7Pdfv/Rzrcls/whPjxYtvSaOFK0UkW1wKCTXg7DJWqjsQpfufdEfl5eKN4oU3q/pTqpJvtTR15fZ0feEJ/Z77aB9rVN66NVbhh4QRXjYgmPAetbvPQ3jOQ7g9xorXblW1t3T24tIibSAK0e/lZz26YK3KMHCU07ah2ivK2kJcvBjwZkUz/cleVXuibCKQIJvd75GQW8pGKgnYw8nLLK6XcLcZASZ59SdRQrrqLuiEq4BVEb1osQWHVtvWkiWAdCnGloPBUZD4OK1p1pwurNgTKQoGKCQWcUVBwvVBrb3YmYwJqcseNiG65KXrV/uhIsIxERNO7ce11tlsc0q8+gP4gX1BwKbfF/Si1UBbM2yU4ICxomdQSq3MMFFszbb3fv0Zc37KGdB+Ae3aMBr+aznRY7j1zjGzMF6byBD6yGPPCh5Reu+4OXa2qsHQPKbZKUE+jSxXXEinPHGkRVPK7bWDH6EpBG1g+OM4eb8Ap79OwlMywltSytYsEshz+jl+1qML3qErasZJJQKuamlFi9MCLdPW87XvCTLZpbdfLo78ze2CU2dOzb719+rMsu3zj3/swG8CNlMqmFu8unTzf8zggLWU7VJb0ryLcC7VmamsEYl8beuX97tgvDGv2yyFEq7KCLftMTIiebF+mIgBMBEHpH+iMLCCGO7sTsW4irE7e7Cjo7MZERYF7feRrEXiJqD4FCnJUlSfNiSTRxvLBVfBqeMy4NsZqe5xIKQAmj4Kprb3GbsfcKJRwGIn3TY3OqRMjtFzKja6THbyEaYNL9+ev3wWs3K3wD03PHaOu91eL2d1l/vNTc4M/4t5YMgGh9Gm931JYZsl9k+rOGl9cL4SRZP/GLWa6yrzQ4KLndQtPbGGiiYknNiEX7EJH2dk0+ZbQsKbwQWzX3km++D3w67enioMHXxkceJydTutO4tzRuhe03Lx5sXDTwtOR9oNsj2L3bfnMyjvWl8XL/373POvC7zpo9891PXNfqVyGpFIPZwARt8Dxse/KF55xKpGyT74A+XLB8IJ/2C4/9GlyIQ3BpCOAJp6ImaTiCoY4oSmC7i2KS+LNJw8f9V3O589eHf/g1aOrvIwBSVSD7dyflaw9pURrsQkfOO7oCJe9avlio9a3Yf0jBh75XkPiqRBlnXXXLABE1TCXi4mHMUmfKO7oLR8Daka0lLl43MWpsSbnry8L6ryt3vXUvR0VBOO+2rBHHVnlEg9nORxwkeEbR41jPAN74LiekEt075zXz8rXyuPXfMfA9ZIaL2gntvW98M/WKVFp/P8j7MuvGaeeoHdXu5Xrj6vDSudpsjgW+8eG3m+VsCXSD2cAFx9oV+Aq0eUKhTXC9qE373vYKqV1Qsyz7YJx+dOhm5ZNIELSusFszt2Z1zla3ODRxfDiVZTRuuuT4sO6IrjRe/tXH2ebj9UyPP1N14qF/AlVw8nAFdf6Bfg6hGjEC6oFzQ6erI7+tJdNcLnB48urfVcvNHqBRGKeZWrz4tms5JkPVzUxwVXQMZWF49w1OxrQWm9ID0QU7XqoJQyIjmgQ4GfNnLX58krEhOvh4vGT0i9YNwxIKwXpI9A8QhvAGBfENBEUdBcKF49fohk8tXzHzI2uDWNw7ZLEJmbePWQeke+ujehXxrUCK4u/z+8MjT90sHo06g2MawTz+kIXy8oDSJjp90GS+vhOP3axIjhGBASvTh5szBSeRwJNG/h7LGxm0xeDdBvLRQLxw+TbI1Azn4/4ZMnDqtZ1kFM3vASzqd3Pv1i+RVuI3H/Etv/P+imn/0k/c6NCF/0a2JlbF5zf7qnS3j+Y8uPe+W586JiCV1bUKOviPwHdBML6mwJRdfgN1jsgpx+vwFS+W6h/KRQf+KESzs07oGemu/t+Pko9yb8DzpA807Ezoactz5PESS6yCfPT1/V1XrUtbjfHm+9YISEMlpmHqxf/okon7zkcVL9yRIu69DV2CFIPCPmqqhQvfKxG42E+uPeHre9Ug2JyydNeL3ya+qC9go7k6If2KlCV+uSty+5q/2kaPF9vxlXLyiFHnNhwulv0RoqnzjhdcqvvQtqSOluRdGHjFTeZv8uHdUTxLh6wcRjoF8/aqB84oTXKb8yQDoCaK50BCUtjxprz5q3d7X5QeuMQIiCgA0RBblvpAMAYoQ4LQEXzPe/B0wCYCIGgAsCAOCCAHBBAABcENB04DPifZ8x1AiJNACwMmCMkffbyyAKAtZZFGTf9GABL4BVAnH+pYnABZX18T0jAEhHAIA1mogxUAJobNiDKAiAiRgALggAgAsCNi/+L8AAvUzdK5D3AAMAAAAASUVORK5CYII=",wb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABdwAAADbCAYAAAB3CFN7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3VpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDc5LjE2NDQ4OCwgMjAyMC8wNy8xMC0yMjowNjo1MyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxNTIxNGY4YS04N2Y0LTRjYjAtYWVjNy0zNjk1Y2JlNTRmOWIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTgxOUI0N0FCNjVDMTFFQkFGQzBGMTlENDFEOTJDRjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTgxOUI0NzlCNjVDMTFFQkFGQzBGMTlENDFEOTJDRjEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjAgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozYWM0MWM3YS02ZmMzLTQ0YTEtODY5My0yZWNlOTJiNGNiODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MTUyMTRmOGEtODdmNC00Y2IwLWFlYzctMzY5NWNiZTU0ZjliIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+QQh77QAAC2VJREFUeNrs3b1OG1kYBuA5K9+Au/QuIqUiPQVpQpVrsGsq6KhScAV0aU1HT5cqkehJmnRpuABkCQkJmrOzKKvVSnFihReYn+eRjtI4w/g7n745foVMqbU2AAAAAADAw/ylBAAAAAAA8HACdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQMBk0xeWUvaVa3Q+1Fpvh/SG9PEvfW73+8J+Y27pKf7T9tOxWfVHvrXrY+A6b9v1yqzSW3gOYl6ht/QVnoP05fNgaf/jpk1VlXl0pm1/rIb0hvTxLx08RbBkv+nz3NJTozxgFbPqj5y0axG4zrJdc7NKb+E5iHmF3tJXeA7Sl8+DvlIGAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQMAkfcH9/X1V7bgPHz40t7e3CjGSPv78+XNzcXFhU80tc0tP0fNnYRf66tu3b83Hjx83em2t9cE/r5Sy0evevn3bvHr1Sl+ZWWaWnsK8Qm/pK32lp/it4+PjR71+2fTDUPuBZ6MXJj5c8bim02mzWq02emm7n6shvfcx9vHBwcGmg+Sgfd/H9htzS0/pqf/tZXnse+lTX52cnDSLxWKjl7b3uwjUZtn+M//d65bLZTOfz3vTV091xjKzPAf1FOYVY+4tfaWv9BS/2Mtmw738o8+DvlIGAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQMBkiG/q7Oysef/+fefu6+joqHn37p2u64HXr18/+BovX75sTk9PFXMk+z1U5pae0lPAmM/vXXF9fa0IekpP6S1nLH2lr9BTPTHIwP3q6qr58uVLJ++Lfuhi/2C/zS09paeAIc8GsxM9hd5yxtJX+go9NQS+UgYAAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAwGTk7/+sXe8D1zlq1zvt1AuvA9d42a5TpRzNfg+VuaWn9BQw5vP7UF0rgZ7SU4PrLWcs9BV6qmfGHrhf1Vq/PPQipZQrrdQPof1WyBHt91CZW3pKTwFjPr+DnqIvveWMhb5CT/WPr5QBAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAwUQJgqEopVRXQUwCDMm9n8VwZ1prWWlfKoKf0FJhZoKeej99wBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgICJEgBjV2tVBPQUwDOaz+f3i5+bTqfNarVSCD2lp8DMAj3VA37DHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAETJQAAAAC67uvXr89+D5eXlzYCgF8SuAMAAACdt7W1pQgAdJ6vlAEAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQMFECAADCXpRSdhLXUUqAUfg6wPd0aVsBxkngDgBA2u6PBQC/VWvdUgUAhsJXygAAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIGCiBADP7/v37835+blCrHF3d9er+z05ObFpa2xvbzez2UwhwMwysxjl2UpPAWaWs5Wz1fB7SuAO0AH/HK4Wi4VCDIS9XG+5XDq0g5llZjHas5WeAswsZytnK4E7AADce/HiRbOzs9PJ+wIAAOgCgTsAABvZ3d29XwAAAPycP5oKAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAICAiRIA9Mr3dp0rw1p3j3z9EyVea7tdM2WATjGzzCye7mylpwAzy9nK2Yp7AneAfjmvtS6U4Xmo/XqllKUDFphZZhZjPVvpKcDMcrZyttJT//KVMgAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAiYjf//bpZRl4jpaCejZ3BqqvVrrzWNdXO09C6FPzCwzC58JATPLzHK2crZ6emMP3Gc/FoC5NQz77bp5xOvPlRjoETMLnK0AMwtnK56Yr5QBAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAEDARAkAALrvzZs3irDG4eFhs7u7qxAAAMCzE7gDAPTAp0+fFGGNxWKhCAAAQCcMMnDf3t5ulstlJ+8LoE9zqyv29vaam5ub3tyvvfQshD4xs8wsZys9BZhZZpazlZ7KGWTgPpvN7heAuTUM+/v7vQrc5/O5TQPMLHC2AjCznK0YIX80FQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAARMlAAB4Vm+UYK3Ddu0qAwAA0BcCdwCAZ1Rr/aQKP1dKWagCAADQJ75SBgAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAIE7gAAAAAAECBwBwAAAACAAIE7AAAAAAAECNwBAAAAACBA4A4AAAAAAAECdwAAAAAACBC4AwAAAABAgMAdAAAAAAACBO4AAAAAABAgcAcAAAAAgACBOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQECptW72wlKqco3OtO2P1aAavpTEZbbadTHA/T5o9/t4YPttbplbeooHafupPPbPCD2bhmrZrrlZZWbhOcjg55VKexaaWXgOMpjPg37DHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAQI3AEAAAAAIEDgDgAAAAAAAQJ3AAAAAAAIELgDAAAAAECAwB0AAAAAAAJKrVUVAAAAAADggfyGOwAAAAAABAjcAQAAAAAgQOAOAAAAAAABAncAAAAAAAgQuAMAAAAAQIDAHQAAAAAAAgTuAAAAAAAQIHAHAAAAAIAAgTsAAAAAAAT8LcAAEvrEkg6x8I0AAAAASUVORK5CYII=";async function Tb(){let r;(f=>{f[f.Alive=0]="Alive",f[f.Dead=1]="Dead"})(r||(r={}));let i;(f=>{f[f.Idel=0]="Idel",f[f.Start=1]="Start",f[f.End=2]="End"})(i||(i={}));const a=-3.1,t={fly:"fly",stateChange:"stateChange",showGui:"showGui",checkHitGui:"checkHitGui",checkHit:"checkHit",gameOver:"gameOver",addScore:"addScore",reStartGame:"reStartGame"};let e;const n=768,o=896,s=n/o,l=document.getElementById("canvas"),c=l.parentElement;let{clientWidth:u,clientHeight:d}=c;u/d>s?(u=d*s,l.style.width=u+"px",l.style.marginLeft=(c.clientWidth-u)/2+"px"):(d=u/s,l.style.height=d+"px",l.style.marginTop=(c.clientHeight-d)/2+"px"),SC.create({canvas:"canvas",physics:new yb}).then(f=>{f.canvas.resizeByClientSize(o/d);const _=f.sceneManager.activeScene.createRootEntity(),g=_.createChild("camera");g.transform.setPosition(.3,0,5);const y=g.addComponent(rt);y.isOrthographic=!0,y.orthographicSize=f.canvas.height/ei._pixelsPerUnit/2,f.resourceManager.load([{url:xb,type:Re.Texture2D},{url:Sb,type:Re.Texture2D},{url:Cb,type:Re.Texture2D},{url:bb,type:Re.Texture2D},{url:Eb,type:Re.Texture2D},{url:wb,type:Re.Texture2D}]).then(C=>{e=C;const w=_.createChild("nodeBg");w.transform.setPosition(.3,0,-10),w.addComponent(tt).sprite=new Rn(f,C[0]);const E=_.createChild("nodePipe");E.transform.setPosition(0,0,-3),E.addComponent(v);const T=_.createChild("nodeGround");T.transform.setPosition(.3,-4.125,-2),T.transform.setRotation(90,0,0);const M=T.addComponent(hr);M.mesh=ut.createPlane(f,7.68,1.28);const B=new Qc(f);M.setMaterial(B),B.baseTexture=C[2],B.tilingOffset.set(21,1,0,0),T.addComponent(m);const I=_.createChild("nodeBird");I.transform.setPosition(-1,1.15,0),I.addComponent(tt).sprite=new Rn(f,C[3]),I.addComponent(x);const F=_.createChild("nodeEff");F.transform.setPosition(0,0,-1),F.transform.setRotation(90,0,0);const L=F.addComponent(hr);L.mesh=ut.createPlane(f,20,20);const V=new Qc(f);L.setMaterial(V),V.isTransparent=!0,V.baseColor.set(0,0,0,0),F.addComponent(b);const D=_.createChild("nodeGui");D.transform.setPosition(.3,0,1);const N=D.createChild("nodeRestart");N.addComponent(tt).sprite=new Rn(f,C[4]);const O=D.createChild("nodeScore");O.transform.setPosition(0,3.2,0),O.transform.setScale(.3,.3,.3),O.addComponent(p),D.addComponent(S),_.addComponent(A)}),f.run();class v extends Bt{constructor(){super(...arguments);we(this,"_originPipe");we(this,"_nowPipeArr",[]);we(this,"_pipePool",[]);we(this,"_curStartTimeStamp");we(this,"_pipeHideX",4.6);we(this,"_pipeVerticalDis",10.8);we(this,"_pipeHorizontalDis",4);we(this,"_pipeRandomPosY",3.5);we(this,"_pipeDebutTime",3);we(this,"_pipeHorizontalV",3)}onAwake(){const E=this._originPipe=new hn(f),T=E.createChild("node1"),M=E.createChild("node2"),B=this._pipeVerticalDis;T.transform.setPosition(0,-B/2,0),M.transform.setPosition(0,B/2,0),M.transform.setScale(1,-1,1),T.addComponent(tt).sprite=new Rn(f,e[1]),M.addComponent(tt).sprite=new Rn(f,e[1]),this._pipePool.push(E),f.on(t.stateChange,I=>{switch(I){case 0:this.enabled=!1,this._destroyPipe();break;case 1:this.enabled=!0,this._curStartTimeStamp=f.time.actualElapsedTime;break;case 2:this.enabled=!1;break}}),f.on(t.checkHit,I=>{for(var F=this._nowPipeArr.length,L=0;L<F;L++){var V=this._nowPipeArr[L].transform.position;if(Math.abs(V.x)<.9){Math.abs(V.y-I)>1.2&&f.dispatch(t.gameOver);break}}})}onUpdate(E){const T=this._pipeDebutTime;if(f.time.actualElapsedTime-this._curStartTimeStamp>=T){let M=!1;const B=E*this._pipeHorizontalV,I=this._nowPipeArr.length,{_pipeHorizontalDis:F,_pipeRandomPosY:L,_pipeHideX:V}=this;if(I>0)for(let D=I-1;D>=0;D--){const O=this._nowPipeArr[D].transform,G=O.position;G.x<-V?this._destroyPipe(D):(!M&&G.x>-1&&G.x-B<=-1&&(f.dispatch(t.addScore),M=!0),O.setPosition(G.x-B,G.y,G.z)),D==I-1&&G.x<=V-F&&this._createPipe(V,L*Math.random()-L/2+.8,0)}else this._createPipe(V,L*Math.random()-L/2+.8,0)}}_createPipe(E,T,M){const B=this._pipePool,I=B.length>0?B.pop():this._originPipe.clone();I.transform.setPosition(E,T,M),this.entity.addChild(I),this._nowPipeArr.push(I)}_destroyPipe(E=-1){const{entity:T,_pipePool:M,_nowPipeArr:B}=this,I=F=>{T.removeChild(F),M.push(F)};if(E>=0)I(B[E]),B.splice(E,1);else{for(let F=B.length-1;F>=0;F--)I(B[F]);B.length=0}}}class p extends Bt{constructor(){super(...arguments);we(this,"_spriteArray",[]);we(this,"_numInv",2);we(this,"_scoreEntitys",[]);we(this,"_scoreRenderer",[]);we(this,"_myScore",0)}onAwake(){const E=this._spriteArray;for(var T=0;T<10;T++)E.push(new Rn(f,e[5],new Mn(T*.1,0,.1,1)));f.on(t.addScore,()=>{++this._myScore,this._showScore(""+this._myScore)}),f.on(t.stateChange,M=>{switch(M){case 0:this.entity.isActive=!1;break;case 1:this.entity.isActive=!0,this._myScore=0,this._showScore("0");break}})}_showScore(E){const T=E.length,{entity:M,_numInv:B,_scoreEntitys:I,_spriteArray:F,_scoreRenderer:L}=this;var V=I.length;let D,N;if(T>V)for(let G=V;G<T;G++)D=new hn(f),N=D.addComponent(tt),L.push(N),I.push(D),M.addChild(D);V=I.length;const O=(1-T)*B/2;for(let G=0;G<V;G++)D=I[G],G>=T?D.isActive=!1:(D.isActive=!0,D.transform.setPosition(O+G*B,0,0),L[G].sprite=F[parseInt(E[G])])}}class m extends Bt{constructor(){super(...arguments);we(this,"_groundMaterial");we(this,"_groundHorizontalV",8.2)}onAwake(){this._groundMaterial=this.entity.getComponent(hr).getMaterial(),f.on(t.stateChange,E=>{switch(E){case 0:case 1:this.enabled=!0;break;case 2:this.enabled=!1;break}}),f.on(t.checkHit,E=>{E<a&&f.dispatch(t.gameOver)})}onUpdate(E){this._groundMaterial.tilingOffset.z+=E*this._groundHorizontalV}}class A extends Bt{constructor(){super(...arguments);we(this,"_gameState")}onAwake(){f.on(t.reStartGame,()=>{this._setGameState(0)}),f.on(t.gameOver,()=>{this._setGameState(2)});const E=this.entity.addComponent(vf),T=new Hc;T.size.set(10,10,.001),E.addShape(T)}onStart(){this._setGameState(0)}onUpdate(){db(),f.inputManager.isKeyDown(La.Space)&&this._dispatchFly()}onPointerDown(){this._dispatchFly()}_dispatchFly(){switch(this._gameState){case 0:this._setGameState(1),f.dispatch(t.fly);break;case 1:f.dispatch(t.fly);break}}_setGameState(E){this._gameState!=E&&(this._gameState=E,f.dispatch(t.stateChange,E))}}class S extends Bt{onAwake(){const{entity:w}=this,E=w.findByName("nodeRestart"),T=E.addComponent(vf),M=new Hc;M.size.set(2.14,.75,.001),T.addShape(M),E.addComponent(Bt).onPointerClick=()=>{f.dispatch(t.reStartGame)},f.on(t.stateChange,B=>{switch(B){case 0:case 1:E.isActive=!1;break}}),f.on(t.showGui,()=>{E.isActive=!0})}}class x extends Bt{constructor(){super(...arguments);we(this,"_regions",[new te(0,0),new te(1/3,0),new te(2/3,0)]);we(this,"_reciprocalSliceWidth",1/3);we(this,"_reciprocalSliceHeight",1);we(this,"_frameInterval",.15);we(this,"_totalFrames",3);we(this,"_maxDropV",-8);we(this,"_gravity",-35);we(this,"_startFlyV",10);we(this,"_cumulativeTime",0);we(this,"_birdState",0);we(this,"_sprite");we(this,"_curFrameIndex");we(this,"_startY");we(this,"_flyStartTime");we(this,"_gameState");we(this,"_yoyoTween");we(this,"_dropTween")}onAwake(){this._initDataAndUI(),this._initTween(),this._initListener()}onUpdate(E){switch(this._birdState){case 0:const{_frameInterval:T,_totalFrames:M}=this;if(this._cumulativeTime+=E,this._cumulativeTime>=T){const B=Math.floor(this._cumulativeTime/T);this._cumulativeTime-=B*T,this._setFrameIndex((this._curFrameIndex+B)%M)}if(this._gameState==1){let B;const{_maxDropV:I,_startFlyV:F,_gravity:L}=this,V=this.entity.transform,D=V.position,N=f.time.actualElapsedTime-this._flyStartTime,O=(I-F)/L;N<=O?B=(F+(F+N*L))*N/2+this._startY:B=(I+F)*O/2+I*(N-O)+this._startY,V.setPosition(D.x,B,D.z)}break;case 1:this._setFrameIndex(0);break}}onLateUpdate(){f.dispatch(t.checkHit,this.entity.transform.position.y)}_initDataAndUI(){const{entity:E}=this,T=E.getComponent(tt);T.sprite=this._sprite=new Rn(f,e[3]),this._setFrameIndex(0)}_initTween(){const E=this.entity.transform,T=E.rotation,M=E.position;this._yoyoTween=new is(M).to({y:.25},380).repeat(1/0).onUpdate(B=>{E.position=B}).yoyo(!0).easing(bo.Sinusoidal.InOut),this._dropTween=new is(T).to({z:-90},380).onUpdate(B=>{E.rotation=B}).delay(520)}_initListener(){const E=this.entity.transform;f.on(t.fly,()=>{this._startY=E.position.y,this._flyStartTime=f.time.actualElapsedTime,this._yoyoTween.stop(),this._dropTween.stop(),E.setRotation(E.rotation.x,E.rotation.y,20),this._dropTween.start()}),f.on(t.stateChange,T=>{switch(this._gameState=T,T){case 0:E.setPosition(0,0,0),E.rotation=new P(0,0,0),this._birdState=0,this._yoyoTween.start();break;case 1:break;case 2:this._birdState=1,setTimeout(()=>{const{position:M,rotation:B}=E,I=M.y;I>a?(this._yoyoTween.stop(),this._dropTween.stop(),new is(B).duration((I-a)*40).to({z:-90}).onUpdate(F=>{E.rotation=F}).start(),new is(M).duration((I-a)*120).to({y:a}).onUpdate(F=>{E.position=F}).onComplete(()=>{f.dispatch(t.showGui)}).start()):f.dispatch(t.showGui)},300);break}})}_setFrameIndex(E){if(this._curFrameIndex!==E){this._curFrameIndex=E;const T=this._regions[E],M=this._sprite.region;M.set(T.x,T.y,this._reciprocalSliceWidth,this._reciprocalSliceHeight),this._sprite.region=M}}}class b extends Bt{onAwake(){const M=this.entity.getComponent(hr).getMaterial().baseColor,B=new is(M).to({a:1},80).repeat(1).yoyo(!0).delay(20);f.on(t.stateChange,I=>{switch(I){case 2:B.start();break}})}}})}function Rb(){return Yv.useEffect(()=>{Tb()},[]),gd.jsx("canvas",{id:"canvas",style:{width:"100vw",height:"100vh"}})}$0(document.getElementById("root")).render(gd.jsx(Yv.StrictMode,{children:gd.jsx(Rb,{})}));
